(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},9575:function(e,t,n){var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(0,t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0!==(s="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=s)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},5378:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++)n=arguments[r]??{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))});return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){var e;return null!==(e=h)&&void 0!==e?e:document}var c={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},l=n({},c),u={},h=null,d=function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0},f=function(){function e(t){var n=this;r(this,e),this.element=a().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),s=["notification",this.extraClasses];if(this.type&&s.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),c=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";s.push("animate__animated ".concat(o," ").concat(c)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=s.join(" "),this.dismissible){var l=a().createElement("button");l.className="delete",l.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",l)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var u=new p(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){u.pause()}),this.element.addEventListener("mouseout",function(){u.resume()}))}return s(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete u.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete u.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),p=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return s(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){l=n({},c)},e.setDefaults=function(e){l=n(n({},c),e)},e.setDoc=function(e){for(var t in u)u[t].remove();u={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},l),e),r=new f(t),i=function(e,t,n,r,i,s){if(u.position)return u.position;var o=a().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+d(t,n,r,i,s)),e.appendChild(o),u.position=o,o}(t.appendTo||a().body,t.position||l.position,t.offsetTop||l.offsetTop,t.offsetBottom||l.offsetBottom,t.offsetLeft||l.offsetLeft,t.offsetRight||l.offsetRight);if(t.single)for(var s=i.lastElementChild;s;)i.removeChild(s),s=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},6676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function r(e,t,r){var i,s=new Promise(function(s,o){n(i=e[t].apply(e,r)).then(s,o)});return s.request=i,s}function i(e,t,n){var i=r(e,t,n);return i.then(function(e){if(e)return new u(e,i.request)})}function s(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,t,n,i){i.forEach(function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})})}function a(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function c(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})})}function l(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function h(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function p(e){this._db=e}s(l,"_index",["name","keyPath","multiEntry","unique"]),o(l,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(l,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(u,"_cursor",["direction","key","primaryKey","value"]),o(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),h.prototype.createIndex=function(){return new l(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new l(this._store.index.apply(this._store,arguments))},s(h,"_store",["name","keyPath","indexNames","autoIncrement"]),o(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(h,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[h,l].forEach(function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,s=i[e].apply(i,n.slice(0,-1));s.onsuccess=function(){r(s.result)}})})}),[l,h].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(i){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)})})})}),e.openDb=function(e,t,n){var i=r(indexedDB,"open",[e,t]),s=i.request;return s&&(s.onupgradeneeded=function(e){n&&n(new f(s.result,e.oldVersion,s.transaction))}),i.then(function(e){return new p(e)})},e.deleteDb=function(e){return r(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})}(t)},2912:function(e,t,n){"use strict";function r(e){return"function"==typeof e}function i(e){const t=e(e=>{Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const s=i(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function o(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class a{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const e of i)e.remove(this);else i.remove(this);const{initialTeardown:o}=this;if(r(o))try{o()}catch(t){e=t instanceof s?t.errors:[t]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const t of a)try{u(t)}catch(n){e=e??[],n instanceof s?e=[...e,...n.errors]:e.push(n)}}if(e)throw new s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)u(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&o(t,e)}remove(e){const{_teardowns:t}=this;t&&o(t,e),e instanceof a&&e._removeParent(this)}}a.EMPTY=(()=>{const e=new a;return e.closed=!0,e})();const c=a.EMPTY;function l(e){return e instanceof a||e&&"closed"in e&&r(e.remove)&&r(e.add)&&r(e.unsubscribe)}function u(e){r(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function f(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function p(){}const g=m("C",void 0,void 0);function m(e,t,n){return{kind:e,value:t,error:n}}let y=null;function v(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!y;if(t&&(y={errorThrown:!1,error:null}),e(),t){const{errorThrown:e,error:t}=y;if(y=null,e)throw t}}else e()}class _ extends a{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,l(e)&&e.add(this)):this.destination=S}static create(e,t,n){return new C(e,t,n)}next(e){this.isStopped?b(m("N",e,void 0),this):this._next(e)}error(e){this.isStopped?b(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?b(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class C extends _{constructor(e,t,n){let i;if(super(),r(e))i=e;else if(e){let r;({next:i,error:t,complete:n}=e),this&&h.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe()):r=e,i=null==i?void 0:i.bind(r),t=null==t?void 0:t.bind(r),n=null==n?void 0:n.bind(r)}this.destination={next:i?E(i):p,error:E(t??w),complete:n?E(n):p}}}function E(e,t){return(...t)=>{try{e(...t)}catch(n){h.useDeprecatedSynchronousErrorHandling?function(e){h.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):f(n)}}}function w(e){throw e}function b(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const S={closed:!0,next:p,error:w,complete:p},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(e){return e}let T=(()=>{class e{constructor(e){e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const i=function(e){return e&&e instanceof _||function(e){return e&&r(e.next)&&r(e.error)&&r(e.complete)}(e)&&l(e)}(e)?e:new C(e,t,n);return v(()=>{const{operator:e,source:t}=this;i.add(e?e.call(i,t):t?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return new(t=I(t))((t,n)=>{const r=new C({next:t=>{try{e(t)}catch(i){n(i),r.unsubscribe()}},error:n,complete:t});this.subscribe(r)})}_subscribe(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}[P](){return this}pipe(...e){return function(e){return 0===e.length?O:1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}}(e)(this)}toPromise(e){return new(e=I(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function I(e){var t;return null!==(t=e??h.Promise)&&void 0!==t?t:Promise}const k=i(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let A=(()=>{class e extends T{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const t=new N(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new k}next(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){const t=this.observers.slice();for(const n of t)n.next(e)}})}error(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:t,isStopped:n,observers:r}=this;return t||n?c:(r.push(e),new a(()=>o(r,e)))}_checkFinalizedStatuses(e){const{hasError:t,thrownError:n,isStopped:r}=this;t?e.error(n):r&&e.complete()}asObservable(){const e=new T;return e.source=this,e}}return e.create=(e,t)=>new N(e,t),e})();class N extends A{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:c}}function M(e){return r(null==e?void 0:e.lift)}function x(e){return t=>{if(M(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class R extends _{constructor(e,t,n,r,i){super(e),this.onFinalize=i,this._next=t?function(n){try{t(n)}catch(r){e.error(r)}}:super._next,this._error=r?function(t){try{r(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function D(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>{r.next(e.call(t,n,i++))}))})}function L(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function B(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(c,l):u(s[0][2],e)}(i[e](t))}catch(n){u(s[0][3],n)}}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function V(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}const U=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $(e){return r(null==e?void 0:e.then)}function z(e){return r(e[P])}function H(e){return Symbol.asyncIterator&&r(null==e?void 0:e[Symbol.asyncIterator])}function G(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const q="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function W(e){return r(null==e?void 0:e[q])}function j(e){return B(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:e,done:n}=yield F(t.read());if(n)return yield F(void 0);yield yield F(e)}}finally{t.releaseLock()}})}function Z(e){return r(null==e?void 0:e.getReader)}function Y(e){if(e instanceof T)return e;if(null!=e){if(z(e))return function(e){return new T(t=>{const n=e[P]();if(r(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(U(e))return function(e){return new T(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($(e))return function(e){return new T(t=>{e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,f)})}(e);if(H(e))return K(e);if(W(e))return function(e){return new T(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Z(e))return function(e){return K(j(e))}(e)}throw G(e)}function K(e){return new T(t=>{(function(e,t){var n,r,i,s;return function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,a)}c((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=V(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(e=>t.error(e))})}function J(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Q(e,t,n=1/0){return r(t)?Q((n,r)=>D((e,i)=>t(n,e,r,i))(Y(e(n,r))),n):("number"==typeof t&&(n=t),x((t,r)=>function(e,t,n,r,i,s,o,a){const c=[];let l=0,u=0,h=!1;const d=()=>{h&&!c.length&&!l&&t.complete()},f=e=>l<r?p(e):c.push(e),p=e=>{l++;let i=!1;Y(n(e,u++)).subscribe(new R(t,e=>{t.next(e)},()=>{i=!0},void 0,()=>{if(i)try{for(l--;c.length&&l<r;){const e=c.shift();p(e)}d()}catch(e){t.error(e)}}))};return e.subscribe(new R(t,f,()=>{h=!0,d()})),()=>{}}(t,r,e,n)))}function X(e=1/0){return Q(O,e)}const ee=new T(e=>e.complete());function te(e){return e[e.length-1]}function ne(e){return r(te(e))?e.pop():void 0}function re(e){return function(e){return e&&r(e.schedule)}(te(e))?e.pop():void 0}function ie(e,t=0){return x((n,r)=>{n.subscribe(new R(r,n=>J(r,e,()=>r.next(n),t),()=>J(r,e,()=>r.complete(),t),n=>J(r,e,()=>r.error(n),t)))})}function se(e,t=0){return x((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(n=>{J(n,t,()=>{const r=e[Symbol.asyncIterator]();J(n,t,()=>{r.next().then(e=>{e.done?n.complete():n.next(e.value)})},0,!0)})})}function ae(e,t){return t?function(e,t){if(null!=e){if(z(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(U(e))return function(e,t){return new T(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if($(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(H(e))return oe(e,t);if(W(e))return function(e,t){return new T(n=>{let i;return J(n,t,()=>{i=e[q](),J(n,t,()=>{let e,t;try{({value:e,done:t}=i.next())}catch(r){return void n.error(r)}t?n.complete():n.next(e)},0,!0)}),()=>r(null==i?void 0:i.return)&&i.return()})}(e,t);if(Z(e))return function(e,t){return oe(j(e),t)}(e,t)}throw G(e)}(e,t):Y(e)}function ce(e){return e<=0?()=>ee:x((t,n)=>{let r=0;t.subscribe(new R(n,t=>{++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function le(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(ce(1)).subscribe(()=>e())}function ue(e){for(let t in e)if(e[t]===ue)return t;throw Error("Could not find renamed property on target object.")}function he(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function de(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(de).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function fe(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const pe=ue({__forward_ref__:ue});function ge(e){return e.__forward_ref__=ge,e.toString=function(){return de(this())},e}function me(e){return ye(e)?e():e}function ye(e){return"function"==typeof e&&e.hasOwnProperty(pe)&&e.__forward_ref__===ge}class ve extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function _e(e){return"string"==typeof e?e:null==e?"":String(e)}function Ce(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_e(e)}function Ee(e,t){const n=t?` in ${t}`:"";throw new ve("201",`No provider for ${Ce(e)} found${n}`)}function we(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}function be(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Se(e){return{providers:e.providers||[],imports:e.imports||[]}}function Pe(e){return Oe(e,Ie)||Oe(e,Ae)}function Oe(e,t){return e.hasOwnProperty(t)?e[t]:null}function Te(e){return e&&(e.hasOwnProperty(ke)||e.hasOwnProperty(Ne))?e[ke]:null}const Ie=ue({"\u0275prov":ue}),ke=ue({"\u0275inj":ue}),Ae=ue({ngInjectableDef:ue}),Ne=ue({ngInjectorDef:ue});var Me=(()=>((Me=Me||{})[Me.Default=0]="Default",Me[Me.Host=1]="Host",Me[Me.Self=2]="Self",Me[Me.SkipSelf=4]="SkipSelf",Me[Me.Optional=8]="Optional",Me))();let xe;function Re(e){const t=xe;return xe=e,t}function De(e,t,n){const r=Pe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Me.Optional?null:void 0!==t?t:void Ee(de(e),"Injector")}function Le(e){return{toString:e}.toString()}var Fe=(()=>((Fe=Fe||{})[Fe.OnPush=0]="OnPush",Fe[Fe.Default=1]="Default",Fe))(),Be=(()=>((Be=Be||{})[Be.Emulated=0]="Emulated",Be[Be.None=2]="None",Be[Be.ShadowDom=3]="ShadowDom",Be))();const Ve="undefined"!=typeof globalThis&&globalThis,Ue="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ze=Ve||"undefined"!=typeof global&&global||Ue||$e,He={},Ge=[],qe=ue({"\u0275cmp":ue}),We=ue({"\u0275dir":ue}),je=ue({"\u0275pipe":ue}),Ze=ue({"\u0275mod":ue}),Ye=ue({"\u0275loc":ue}),Ke=ue({"\u0275fac":ue}),Je=ue({__NG_ELEMENT_ID__:ue});let Qe=0;function Xe(e){return Le(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Fe.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Ge,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Be.Emulated,id:"c",styles:e.styles||Ge,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Qe++,n.inputs=it(e.inputs,t),n.outputs=it(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(et):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(tt):null,n})}function et(e){return at(e)||function(e){return e[We]||null}(e)}function tt(e){return function(e){return e[je]||null}(e)}const nt={};function rt(e){return Le(()=>{const t={type:e.type,bootstrap:e.bootstrap||Ge,declarations:e.declarations||Ge,imports:e.imports||Ge,exports:e.exports||Ge,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nt[e.id]=e.type),t})}function it(e,t){if(null==e)return He;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const st=Xe;function ot(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function at(e){return e[qe]||null}function ct(e,t){const n=e[Ze]||null;if(!n&&!0===t)throw new Error(`Type ${de(e)} does not have '\u0275mod' property.`);return n}function lt(e){return Array.isArray(e)&&"object"==typeof e[1]}function ut(e){return Array.isArray(e)&&!0===e[1]}function ht(e){return 0!=(8&e.flags)}function dt(e){return 2==(2&e.flags)}function ft(e){return 1==(1&e.flags)}function pt(e){return null!==e.template}function gt(e){return 0!=(512&e[2])}function mt(e,t){return e.hasOwnProperty(Ke)?e[Ke]:null}class yt{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function vt(){return _t}function _t(e){return e.type.prototype.ngOnChanges&&(e.setInput=Et),Ct}function Ct(){const e=bt(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===He)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Et(e,t,n,r){const i=bt(e)||function(e,t){return e[wt]=t}(e,{previous:He,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],c=o[a];s[a]=new yt(c&&c.currentValue,t,o===He),e[r]=t}vt.ngInherit=!0;const wt="__ngSimpleChanges__";function bt(e){return e[wt]||null}const St="http://www.w3.org/2000/svg";let Pt;function Ot(){return void 0!==Pt?Pt:"undefined"!=typeof document?document:void 0}function Tt(e){return!!e.listen}const It={createRenderer:(e,t)=>Ot()};function kt(e){for(;Array.isArray(e);)e=e[0];return e}function At(e,t){return kt(t[e])}function Nt(e,t){return kt(t[e.index])}function Mt(e,t){return e.data[t]}function xt(e,t){return e[t]}function Rt(e,t){const n=t[e];return lt(n)?n:n[0]}function Dt(e){return 4==(4&e[2])}function Lt(e){return 128==(128&e[2])}function Ft(e,t){return null==t?null:e[t]}function Bt(e){e[18]=0}function Vt(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Ut={lFrame:fn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function $t(){return Ut.bindingsEnabled}function zt(){return Ut.lFrame.lView}function Ht(){return Ut.lFrame.tView}function Gt(e){return Ut.lFrame.contextLView=e,e[8]}function qt(){let e=Wt();for(;null!==e&&64===e.type;)e=e.parent;return e}function Wt(){return Ut.lFrame.currentTNode}function jt(){const e=Ut.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Zt(e,t){const n=Ut.lFrame;n.currentTNode=e,n.isParent=t}function Yt(){return Ut.lFrame.isParent}function Kt(){Ut.lFrame.isParent=!1}function Jt(){return Ut.isInCheckNoChangesMode}function Qt(e){Ut.isInCheckNoChangesMode=e}function Xt(){const e=Ut.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function en(){return Ut.lFrame.bindingIndex}function tn(){return Ut.lFrame.bindingIndex++}function nn(e){const t=Ut.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function rn(e){Ut.lFrame.inI18n=e}function sn(e,t){const n=Ut.lFrame;n.bindingIndex=n.bindingRootIndex=e,on(t)}function on(e){Ut.lFrame.currentDirectiveIndex=e}function an(){return Ut.lFrame.currentQueryIndex}function cn(e){Ut.lFrame.currentQueryIndex=e}function ln(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function un(e,t,n){if(n&Me.SkipSelf){let r=t,i=e;for(;!(r=r.parent,null!==r||n&Me.Host||(r=ln(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}const r=Ut.lFrame=dn();return r.currentTNode=t,r.lView=e,!0}function hn(e){const t=dn(),n=e[1];Ut.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function dn(){const e=Ut.lFrame,t=null===e?null:e.child;return null===t?fn(e):t}function fn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function pn(){const e=Ut.lFrame;return Ut.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gn=pn;function mn(){const e=pn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function yn(){return Ut.lFrame.selectedIndex}function vn(e){Ut.lFrame.selectedIndex=e}function _n(){const e=Ut.lFrame;return Mt(e.tView,e.selectedIndex)}function Cn(){Ut.lFrame.currentNamespace=St}function En(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function wn(e,t,n){Pn(e,t,3,n)}function bn(e,t,n,r){(3&e[2])===n&&Pn(e,t,n,r)}function Sn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Pn(e,t,n,r){const i=r??-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(On(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function On(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}class Tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function In(e,t,n){const r=Tt(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],c=n[i++];r?e.setAttribute(t,a,c,o):t.setAttributeNS(o,a,c)}else{const o=s,a=n[++i];An(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function kn(e){return 3===e||4===e||6===e}function An(e){return 64===e.charCodeAt(0)}function Nn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Mn(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Mn(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function xn(e){return-1!==e}function Rn(e){return 32767&e}function Dn(e,t){let n=function(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ln=!0;function Fn(e){const t=Ln;return Ln=e,t}let Bn=0;function Vn(e,t){const n=$n(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Un(r.data,e),Un(t,null),Un(r.blueprint,null));const i=zn(e,t),s=e.injectorIndex;if(xn(i)){const e=Rn(i),n=Dn(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function Un(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $n(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function zn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hn(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Je)&&(r=n[Je]),null==r&&(r=n[Je]=Bn++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Gn(e,t,n){if(n&Me.Optional)return e;Ee(t,"NodeInjector")}function qn(e,t,n,r){if(n&Me.Optional&&void 0===r&&(r=null),0==(n&(Me.Self|Me.Host))){const i=e[9],s=Re(void 0);try{return i?i.get(t,r,n&Me.Optional):De(t,r,n&Me.Optional)}finally{Re(s)}}return Gn(r,t,n)}function Wn(e,t,n,r=Me.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Je)?e[Je]:void 0;return"number"==typeof t?t>=0?255&t:Zn:t}(n);if("function"==typeof s){if(!un(t,e,r))return r&Me.Host?Gn(i,n,r):qn(t,n,r,i);try{const e=s(r);if(null!=e||r&Me.Optional)return e;Ee(n)}finally{gn()}}else if("number"==typeof s){let i=null,o=$n(e,t),a=-1,c=r&Me.Host?t[16][6]:null;for((-1===o||r&Me.SkipSelf)&&(a=-1===o?zn(e,t):t[o+8],-1!==a&&Xn(r,!1)?(i=t[1],o=Rn(a),t=Dn(a,t)):o=-1);-1!==o;){const e=t[1];if(Qn(s,o,e.data)){const e=Yn(o,t,n,i,r,c);if(e!==jn)return e}a=t[o+8],-1!==a&&Xn(r,t[1].data[o+8]===c)&&Qn(s,o,t)?(i=e,o=Rn(a),t=Dn(a,t)):o=-1}}}return qn(t,n,r,i)}const jn={};function Zn(){return new er(qt(),zt())}function Yn(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],c=Kn(a,o,n,null==r?dt(a)&&Ln:r!=o&&0!=(3&a.type),i&Me.Host&&s===a);return null!==c?Jn(t,o,c,a):jn}function Kn(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,c=e.directiveStart,l=s>>20,u=i?a+l:e.directiveEnd;for(let h=r?a:a+l;h<u;h++){const e=o[h];if(h<c&&n===e||h>=c&&e.type===n)return h}if(i){const e=o[c];if(e&&pt(e)&&e.type===n)return c}return null}function Jn(e,t,n,r){let i=e[n];const s=t.data;if(function(e){return e instanceof Tn}(i)){const o=i;o.resolving&&function(e,t){throw new ve("200",`Circular dependency in DI detected for ${e}`)}(Ce(s[n]));const a=Fn(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?Re(o.injectImpl):null;un(e,r,Me.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=_t(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==c&&Re(c),Fn(a),o.resolving=!1,gn()}}return i}function Qn(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Xn(e,t){return!(e&Me.Self||e&Me.Host&&t)}class er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Wn(this._tNode,this._lView,e,n,t)}}function tr(e){return Le(()=>{const t=e.prototype.constructor,n=t[Ke]||nr(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Ke]||nr(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function nr(e){return ye(e)?()=>{const t=nr(me(e));return t&&t()}:mt(e)}function rr(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(kn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(qt(),e)}const ir="__parameters__";function sr(e,t,n){return Le(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(ir)?e[ir]:Object.defineProperty(e,ir,{value:[]})[ir];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class or{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=be({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ar=new or("AnalyzeForEntryComponents"),cr=Function;function lr(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),lr(r,t)):t!==e&&t.push(r)}return t}function ur(e,t){e.forEach(e=>Array.isArray(e)?ur(e,t):t(e))}function hr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function fr(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function pr(e,t,n){let r=mr(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function gr(e,t){const n=mr(e,t);if(n>=0)return e[1|n]}function mr(e,t){return function(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const s=r+(i-r>>1),o=e[s<<n];if(t===o)return s<<n;o>t?i=s:r=s+1}return~(i<<n)}(e,t,1)}const yr={},vr="__NG_DI_FLAG__",_r="ngTempTokenPath",Cr=/\n/gm,Er="__source",wr=ue({provide:String,useValue:ue});let br;function Sr(e){const t=br;return br=e,t}function Pr(e,t=Me.Default){if(void 0===br)throw new Error("inject() must be called from an injection context");return null===br?De(e,void 0,t):br.get(e,t&Me.Optional?null:void 0,t)}function Or(e,t=Me.Default){return(xe||Pr)(me(e),t)}function Tr(e){const t=[];for(let n=0;n<e.length;n++){const r=me(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=Me.Default;for(let t=0;t<r.length;t++){const i=r[t],s=kr(i);"number"==typeof s?-1===s?e=i.token:n|=s:e=i}t.push(Or(e,n))}else t.push(Or(r))}return t}function Ir(e,t){return e[vr]=t,e.prototype[vr]=t,e}function kr(e){return e[vr]}function Ar(e,t,n,r){const i=e[_r];throw t[Er]&&i.unshift(t[Er]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=de(t);if(Array.isArray(t))i=t.map(de).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):de(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Cr,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[_r]=null,e}const Nr=Ir(sr("Inject",e=>({token:e})),-1),Mr=Ir(sr("Optional"),8),xr=Ir(sr("SkipSelf"),4);let Rr,Dr;function Lr(e){var t;return(null===(t=function(){if(void 0===Rr&&(Rr=null,ze.trustedTypes))try{Rr=ze.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Rr}())||void 0===t?void 0:t.createHTML(e))||e}function Fr(e){var t;return(null===(t=function(){if(void 0===Dr&&(Dr=null,ze.trustedTypes))try{Dr=ze.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dr}())||void 0===t?void 0:t.createHTML(e))||e}class Br{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Vr extends Br{getTypeName(){return"HTML"}}class Ur extends Br{getTypeName(){return"Style"}}class $r extends Br{getTypeName(){return"Script"}}class zr extends Br{getTypeName(){return"URL"}}class Hr extends Br{getTypeName(){return"ResourceURL"}}function Gr(e){return e instanceof Br?e.changingThisBreaksApplicationSecurity:e}function qr(e,t){const n=Wr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Wr(e){return e instanceof Br&&e.getTypeName()||null}function jr(e){const t=new Yr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Lr(""),"text/html")}catch{return!1}}()?new Zr(t):t}class Zr{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Lr(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class Yr{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Lr(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=Lr(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kr=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Jr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qr(e){return(e=String(e)).match(Kr)||e.match(Jr)?e:"unsafe:"+e}function Xr(e){return(e=String(e)).split(",").map(e=>Qr(e.trim())).join(", ")}function ei(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function ti(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const ni=ei("area,br,col,hr,img,wbr"),ri=ei("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ii=ei("rp,rt"),si=ti(ni,ti(ri,ei("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ti(ii,ei("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ti(ii,ri)),oi=ei("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ai=ei("srcset"),ci=ti(oi,ai,ei("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ei("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),li=ei("script,style,template");class ui{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!si.hasOwnProperty(t))return this.sanitizedSomething=!0,!li.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let r=0;r<n.length;r++){const e=n.item(r),t=e.name,i=t.toLowerCase();if(!ci.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let s=e.value;oi[i]&&(s=Qr(s)),ai[i]&&(s=Xr(s)),this.buf.push(" ",t,'="',fi(s),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();si.hasOwnProperty(t)&&!ni.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(fi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const hi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,di=/([^\#-~ |!])/g;function fi(e){return e.replace(/&/g,"&amp;").replace(hi,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(di,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let pi;function gi(e,t){let n=null;try{pi=pi||jr(e);let r=t?String(t):"";n=pi.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=pi.getInertBodyElement(r)}while(r!==s);return Lr((new ui).sanitizeChildren(mi(n)||n))}finally{if(n){const e=mi(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function mi(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var yi=(()=>((yi=yi||{})[yi.NONE=0]="NONE",yi[yi.HTML=1]="HTML",yi[yi.STYLE=2]="STYLE",yi[yi.SCRIPT=3]="SCRIPT",yi[yi.URL=4]="URL",yi[yi.RESOURCE_URL=5]="RESOURCE_URL",yi))();function vi(e){const t=Ci();return t?Fr(t.sanitize(yi.HTML,e)||""):qr(e,"HTML")?Fr(Gr(e)):gi(Ot(),_e(e))}function _i(e){const t=Ci();return t?t.sanitize(yi.URL,e)||"":qr(e,"URL")?Gr(e):Qr(_e(e))}function Ci(){const e=zt();return e&&e[12]}const Ei="__ngContext__";function wi(e,t){e[Ei]=t}function bi(e){const t=function(e){return e[Ei]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Si(e){return e.ngOriginalError}function Pi(e,...t){e.error(...t)}class Oi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=(i=e)&&i.ngErrorLogger||Pi;var i;r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(Si(e)):null}_findOriginalError(e){let t=e&&Si(e);for(;t&&Si(t);)t=Si(t);return t||null}}const Ti=/^>|^->|<!--|-->|--!>|<!-$/g,Ii=/(<|>)/;const ki=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ze))();function Ai(e){return e instanceof Function?e():e}var Ni=(()=>((Ni=Ni||{})[Ni.Important=1]="Important",Ni[Ni.DashCase=2]="DashCase",Ni))();let Mi;function xi(e,t){return Mi(e,t)}function Ri(e){const t=e[3];return ut(t)?t[3]:t}function Di(e){return Fi(e[13])}function Li(e){return Fi(e[4])}function Fi(e){for(;null!==e&&!ut(e);)e=e[4];return e}function Bi(e,t,n,r,i){if(null!=r){let s,o=!1;ut(r)?s=r:lt(r)&&(o=!0,r=r[0]);const a=kt(r);0===e&&null!==n?null==i?Ki(t,n,a):Yi(t,n,a,i||null,!0):1===e&&null!==n?Yi(t,n,a,i||null,!0):2===e?cs(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==kt(n)&&Bi(t,e,r,s,i);for(let o=10;o<n.length;o++){const i=n[o];us(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function Vi(e,t){return Tt(e)?e.createText(t):e.createTextNode(t)}function Ui(e,t,n){Tt(e)?e.setValue(t,n):t.textContent=n}function $i(e,t){return e.createComment(function(e){return e.replace(Ti,e=>e.replace(Ii,"\u200b$1\u200b"))}(t))}function zi(e,t,n){return Tt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Hi(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Vt(i,-1)),n.splice(r,1)}function Gi(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Hi(i,r),t>0&&(e[n-1][4]=r[4]);const s=dr(e,10+t);!function(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function qi(e,t){if(!(256&t[2])){const n=t[11];Tt(n)&&n.destroyNode&&us(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Wi(e[1],e);for(;t;){let n=null;if(lt(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)lt(t)&&Wi(t[1],t),t=t[3];null===t&&(t=e),lt(t)&&Wi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Wi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):kt(t[e]),a=r[i=n[s+2]],c=n[s+3];"boolean"==typeof c?o.removeEventListener(n[s],a,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)r[e]();t[7]=null}}(e,t),1===t[1].type&&Tt(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ut(t[3])){n!==t[3]&&Hi(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function ji(e,t,n){return Zi(e,t.parent,n)}function Zi(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Be.None||t===Be.Emulated)return null}return Nt(r,n)}function Yi(e,t,n,r,i){Tt(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Ki(e,t,n){Tt(e)?e.appendChild(t,n):t.appendChild(n)}function Ji(e,t,n,r,i){null!==r?Yi(e,t,n,r,i):Ki(e,t,n)}function Qi(e,t){return Tt(e)?e.parentNode(t):t.parentNode}function Xi(e,t,n){return ns(e,t,n)}function es(e,t,n){return 40&e.type?Nt(e,n):null}let ts,ns=es;function rs(e,t){ns=e,ts=t}function is(e,t,n,r){const i=ji(e,r,t),s=t[11],o=Xi(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)Ji(s,i,n[a],o,!1);else Ji(s,i,n,o,!1);void 0!==ts&&ts(s,r,t,n,i)}function ss(e,t){if(null!==t){const n=t.type;if(3&n)return Nt(t,e);if(4&n)return as(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return ss(e,n);{const n=e[t.index];return ut(n)?as(-1,n):kt(n)}}if(32&n)return xi(t,e)()||kt(e[t.index]);{const n=os(e,t);return null!==n?Array.isArray(n)?n[0]:ss(Ri(e[16]),n):ss(e,t.next)}}return null}function os(e,t){return null!==t?e[16][6].projection[t.projection]:null}function as(e,t){const n=10+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return ss(e,r)}return t[7]}function cs(e,t,n){const r=Qi(e,t);r&&function(e,t,n,r){Tt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function ls(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],c=n.type;if(o&&0===t&&(a&&wi(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&c)ls(e,t,n.child,r,i,s,!1),Bi(t,e,i,a,s);else if(32&c){const o=xi(n,r);let c;for(;c=o();)Bi(t,e,i,c,s);Bi(t,e,i,a,s)}else 16&c?hs(e,t,r,n,i,s):Bi(t,e,i,a,s);n=o?n.projectionNext:n.next}}function us(e,t,n,r,i,s){ls(n,r,e.firstChild,t,i,s,!1)}function hs(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let c=0;c<a.length;c++)Bi(t,e,i,a[c],s);else ls(e,t,a,o[3],i,s,!0)}function ds(e,t,n){Tt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function fs(e,t,n){Tt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function ps(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const gs="ng-template";function ms(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==ps(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ys(e){return 4===e.type&&e.value!==gs}function vs(e,t,n){return t===(4!==e.type||n?e.value:gs)}function _s(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(kn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const c=t[a];if("number"!=typeof c){if(!o)if(4&r){if(r=2|1&r,""!==c&&!vs(e,c,n)||""===c&&1===t.length){if(Cs(r))return!1;o=!0}}else{const l=8&r?c:t[++a];if(8&r&&null!==e.attrs){if(!ms(e.attrs,l,n)){if(Cs(r))return!1;o=!0}continue}const u=Es(8&r?"class":c,i,ys(e),n);if(-1===u){if(Cs(r))return!1;o=!0;continue}if(""!==l){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==ps(t,l,0)||2&r&&l!==e){if(Cs(r))return!1;o=!0}}}}else{if(!o&&!Cs(r)&&!Cs(c))return!1;if(o&&Cs(c))continue;o=!1,r=c|1&r}}return Cs(r)||o}function Cs(e){return 0==(1&e)}function Es(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ws(e,t,n=!1){for(let r=0;r<t.length;r++)if(_s(e,t[r],n))return!0;return!1}function bs(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function Ss(e,t){return e?":not("+t.trim()+")":t}function Ps(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Cs(o)&&(t+=Ss(s,i),i=""),r=o,s=s||!Cs(r);n++}return""!==i&&(t+=Ss(s,i)),t}const Os={};function Ts(e){Is(Ht(),zt(),yn()+e,Jt())}function Is(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&wn(t,r,n)}else{const r=e.preOrderHooks;null!==r&&bn(t,r,0,n)}vn(n)}function ks(e,t){return e<<17|t<<2}function As(e){return e>>17&32767}function Ns(e){return 2|e}function Ms(e){return(131068&e)>>2}function xs(e,t){return-131069&e|t<<2}function Rs(e){return 1|e}function Ds(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];cn(i),n.contentQueries(2,t[s],s)}}}function Ls(e,t,n,r,i,s,o,a,c,l){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,Bt(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=c||e&&e[12]||null,u[9]=l||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function Fs(e,t,n,r,i){let s=e.data[t];if(null===s)s=Bs(e,t,n,r,i),Ut.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=jt();s.injectorIndex=null===e?-1:e.injectorIndex}return Zt(s,!0),s}function Bs(e,t,n,r,i){const s=Wt(),o=Yt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}function Vs(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Us(e,t,n){hn(t);try{const r=e.viewQuery;null!==r&&vo(1,r,n);const i=e.template;null!==i&&Hs(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ds(e,t),e.staticViewQueries&&vo(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)fo(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,mn()}}function $s(e,t,n,r){const i=t[2];if(256==(256&i))return;hn(t);const s=Jt();try{Bt(t),function(e){Ut.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Hs(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&wn(t,n,null)}else{const n=e.preOrderHooks;null!==n&&bn(t,n,0,null),Sn(t,0)}if(function(e){for(let t=Di(e);null!==t;t=Li(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Vt(r,1),n[2]|=1024}}}(t),function(e){for(let t=Di(e);null!==t;t=Li(t))for(let e=10;e<t.length;e++){const n=t[e],r=n[1];Lt(n)&&$s(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Ds(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&wn(t,n)}else{const n=e.contentHooks;null!==n&&bn(t,n,1),Sn(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)vn(~r);else{const i=r,s=n[++e],o=n[++e];sn(s,i),o(2,t[i])}}}finally{vn(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)uo(e,t[n])}(t,a);const c=e.viewQuery;if(null!==c&&vo(2,c,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&wn(t,n)}else{const n=e.viewHooks;null!==n&&bn(t,n,2),Sn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Vt(t[3],-1))}finally{mn()}}function zs(e,t,n,r){const i=t[10],s=!Jt(),o=Dt(t);try{s&&!o&&i.begin&&i.begin(),o&&Us(e,t,r),$s(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function Hs(e,t,n,r,i){const s=yn(),o=2&r;try{vn(-1),o&&t.length>20&&Is(e,t,20,Jt()),n(r,i)}finally{vn(s)}}function Gs(e,t,n){if(ht(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function qs(e,t,n){!$t()||(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Vn(n,t),wi(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=pt(r);s&&so(t,n,r);const c=Jn(t,e,a,n);wi(c,t),null!==o&&ao(0,a-i,c,r,0,o),s&&(Rt(n.index,t)[8]=c)}}(e,t,n,Nt(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Ut.lFrame.currentDirectiveIndex;try{vn(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];on(n),(null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs)&&eo(r,i)}}finally{vn(-1),on(o)}}(e,t,n))}function Ws(e,t,n=Nt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function js(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zs(e,t,n,r,i,s,o,a,c,l){const u=20+r,h=u+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Os);return n}(u,h),f="function"==typeof l?l():l;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:f,incompleteFirstPass:!1}}function Ys(e,t,n,r){const i=Co(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&Eo(e).push(r,i.length-1))}function Ks(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Js(e,t,n,r,i,s,o,a){const c=Nt(t,n);let l,u=t.inputs;!a&&null!=u&&(l=u[r])?(bo(e,n,l,r,i),dt(t)&&function(e,t){const n=Rt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,Tt(s)?s.setProperty(c,r,i):An(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function Qs(e,t,n,r){let i=!1;if($t()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];ws(n,o.selectors,!1)&&(i||(i=[]),Hn(Vn(n,t),e,o.type),pt(o)?(to(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,ro(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,c=Vs(e,t,s.length,null);for(let i=0;i<s.length;i++){const l=s[i];n.mergedAttrs=Nn(n.mergedAttrs,l.hostAttrs),io(e,n,t,c,l),no(c,l,o),null!==l.contentQueries&&(n.flags|=8),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(n.flags|=128);const u=l.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),c++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let c=t.directiveStart;c<n;c++){const e=r[c],n=e.inputs,l=null===i||ys(t)?null:co(n,i);s.push(l),o=Ks(n,c,o),a=Ks(e.outputs,c,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new ve("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Nn(n.mergedAttrs,n.attrs),i}function Xs(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function eo(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function to(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function no(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;pt(t)&&(n[""]=e)}}function ro(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function io(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=mt(i.type)),o=new Tn(s,pt(i),null);e.blueprint[r]=o,n[r]=o,Xs(e,t,0,r,Vs(e,n,i.hostVars,Os),i)}function so(e,t,n){const r=Nt(t,e),i=js(n),s=e[10],o=po(e,Ls(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function oo(e,t,n,r,i,s,o){if(null==s)Tt(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==o?_e(s):o(s,r||"",i);Tt(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}function ao(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function co(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function lo(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function uo(e,t){const n=Rt(t,e);if(Lt(n)){const e=n[1];80&n[2]?$s(e,n,e.template,n[8]):n[5]>0&&ho(n)}}function ho(e){for(let n=Di(e);null!==n;n=Li(n))for(let e=10;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];$s(e,t,e.template,t[8])}else t[5]>0&&ho(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=Rt(t[n],e);Lt(r)&&r[5]>0&&ho(r)}}function fo(e,t){const n=Rt(t,e),r=n[1];(function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Us(r,n,n[8])}function po(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function go(e){for(;e;){e[2]|=64;const t=Ri(e);if(gt(e)&&!t)return e;e=t}return null}function mo(e,t,n){const r=t[10];r.begin&&r.begin();try{$s(e,t,e.template,n)}catch(i){throw wo(t,i),i}finally{r.end&&r.end()}}function yo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=bi(n),i=r[1];zs(i,r,i.template,n)}}(e[8])}function vo(e,t,n){cn(0),t(e,n)}const _o=(()=>Promise.resolve(null))();function Co(e){return e[7]||(e[7]=[])}function Eo(e){return e.cleanup||(e.cleanup=[])}function wo(e,t){const n=e[9],r=n?n.get(Oi,null):null;r&&r.handleError(t)}function bo(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],c=t[o],l=e.data[o];null!==l.setInput?l.setInput(c,i,r,a):c[a]=i}}function So(e,t,n){const r=At(t,e);Ui(e[11],r,n)}function Po(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=fe(i,e):2==s&&(r=fe(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const Oo=new or("INJECTOR",-1);class To{get(e,t=yr){if(t===yr){const t=new Error(`NullInjectorError: No provider for ${de(e)}!`);throw t.name="NullInjectorError",t}return t}}const Io=new or("Set Injector scope."),ko={},Ao={};let No;function Mo(){return void 0===No&&(No=new To),No}function xo(e,t=null,n=null,r){return new Ro(e,n,t||Mo(),r)}class Ro{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&ur(t,n=>this.processProvider(n,e,t)),ur([e],e=>this.processInjectorType(e,[],i)),this.records.set(Oo,Fo(void 0,this));const s=this.records.get(Io);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:de(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=yr,n=Me.Default){this.assertNotDestroyed();const r=Sr(this),i=Re(void 0);try{if(!(n&Me.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(s=e)||"object"==typeof s&&s instanceof or)&&Pe(e);t=n&&this.injectableDefInScope(n)?Fo(Do(e),ko):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&Me.Self?Mo():this.parent).get(e,t=n&Me.Optional&&t===yr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_r]=o[_r]||[]).unshift(de(e)),r)throw o;return Ar(o,e,"R3InjectorError",this.source)}throw o}finally{Re(i),Sr(r)}var s}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(de(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=me(e)))return!1;let r=Te(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=Te(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{ur(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];ur(r,e=>this.processProvider(e,n,r||Ge))}}this.injectorDefTypes.add(s);const a=mt(s)||(()=>new s);this.records.set(s,Fo(a,ko));const c=r.providers;if(null!=c&&!o){const t=e;ur(c,e=>this.processProvider(e,t,c))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=Vo(e=me(e))?e:me(e&&e.provide);const i=function(e,t,n){return Bo(e)?Fo(void 0,e.useValue):Fo(Lo(e),ko)}(e);if(Vo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Fo(void 0,ko,!0),t.factory=()=>Tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){return t.value===ko&&(t.value=Ao,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}injectableDefInScope(e){if(!e.providedIn)return!1;const t=me(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Do(e){const t=Pe(e),n=null!==t?t.factory:mt(e);if(null!==n)return n;if(e instanceof or)throw new Error(`Token ${de(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=fr(t,"?");throw new Error(`Can't resolve all parameters for ${de(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[Ie]||e[Ae]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Lo(e,t,n){let r;if(Vo(e)){const t=me(e);return mt(t)||Do(t)}if(Bo(e))r=()=>me(e.useValue);else if(function(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Or(me(e.useExisting));else{const t=me(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return mt(t)||Do(t);r=()=>new t(...Tr(e.deps))}return r}function Fo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Bo(e){return null!==e&&"object"==typeof e&&wr in e}function Vo(e){return"function"==typeof e}const Uo=function(e,t,n){return function(e,t=null,n=null,r){const i=xo(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let $o=(()=>{class e{static create(e,t){return Array.isArray(e)?Uo(e,t,""):Uo(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=yr,e.NULL=new To,e.\u0275prov=be({token:e,providedIn:"any",factory:()=>Or(Oo)}),e.__NG_ELEMENT_ID__=-1,e})();function zo(e,t){En(bi(e)[1],qt())}function Ho(e){let t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let i;if(pt(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=Go(e.inputs),t.declaredInputs=Go(e.declaredInputs),t.outputs=Go(e.outputs);const n=i.hostBindings;n&&jo(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&qo(e,s),o&&Wo(e,o),he(e.inputs,i.inputs),he(e.declaredInputs,i.declaredInputs),he(e.outputs,i.outputs),pt(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Ho&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Nn(i.hostAttrs,n=Nn(n,i.hostAttrs))}}(r)}function Go(e){return e===He?{}:e===Ge?[]:e}function qo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function Wo(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function jo(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Zo=null;function Yo(){if(!Zo){const e=ze.Symbol;if(e&&e.iterator)Zo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Zo=n)}}}return Zo}class Ko{constructor(e){this.wrapped=e}static wrap(e){return new Ko(e)}static unwrap(e){return Ko.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Ko}}function Jo(e){return!!Qo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Yo()in e)}function Qo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Xo(e,t,n){return e[t]=n}function ea(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function ta(e,t,n,r){const i=ea(e,t,n);return ea(e,t+1,r)||i}function na(e,t,n,r,i){const s=ta(e,t,n,r);return ea(e,t+2,i)||s}function ra(e,t,n,r){const i=zt();return ea(i,tn(),t)&&(Ht(),function(e,t,n,r,i,s){const o=Nt(e,t);oo(t[11],o,s,e.value,n,r,i)}(_n(),i,e,t,n,r)),ra}function ia(e,t,n,r){return ea(e,tn(),n)?t+_e(n)+r:Os}function sa(e,t,n,r,i,s){const o=ta(e,en(),n,i);return nn(2),o?t+_e(n)+r+_e(i)+s:Os}function oa(e,t,n,r,i,s,o,a){const c=na(e,en(),n,i,o);return nn(3),c?t+_e(n)+r+_e(i)+s+_e(o)+a:Os}function aa(e,t,n,r,i,s,o,a){const c=zt(),l=Ht(),u=e+20,h=l.firstCreatePass?function(e,t,n,r,i,s,o,a,c){const l=t.consts,u=Fs(t,e,4,o||null,Ft(l,a));Qs(t,n,u,Ft(l,c)),En(t,u);const h=u.tViews=Zs(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,l);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,l,c,t,n,r,i,s,o):l.data[u];Zt(h,!1);const d=c[11].createComment("");is(l,c,d,h),wi(d,c),po(c,c[u]=lo(d,c,d,h)),ft(h)&&qs(l,c,h),null!=o&&Ws(c,h,a)}function ca(e){return xt(Ut.lFrame.contextLView,20+e)}function la(e,t=Me.Default){const n=zt();return null===n?Or(e,t):Wn(qt(),n,me(e),t)}function ua(e,t,n){const r=zt();return ea(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!1),ua}function ha(e,t,n,r,i){const s=i?"class":"style";bo(e,n,t.inputs[s],s,r)}function da(e,t,n,r){const i=zt(),s=Ht(),o=20+e,a=i[11],c=i[o]=zi(a,t,Ut.lFrame.currentNamespace),l=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,c=Fs(t,e,2,i,Ft(a,s));return Qs(t,n,c,Ft(a,o)),null!==c.attrs&&Po(c,c.attrs,!1),null!==c.mergedAttrs&&Po(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(o,s,i,0,t,n,r):s.data[o];Zt(l,!0);const u=l.mergedAttrs;null!==u&&In(a,c,u);const h=l.classes;null!==h&&fs(a,c,h);const d=l.styles;null!==d&&ds(a,c,d),64!=(64&l.flags)&&is(s,i,c,l),0===Ut.lFrame.elementDepthCount&&wi(c,i),Ut.lFrame.elementDepthCount++,ft(l)&&(qs(s,i,l),Gs(s,l,i)),null!==r&&Ws(i,l)}function fa(){let e=qt();Yt()?Kt():(e=e.parent,Zt(e,!1));const t=e;Ut.lFrame.elementDepthCount--;const n=Ht();n.firstCreatePass&&(En(n,e),ht(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&ha(n,t,zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&ha(n,t,zt(),t.stylesWithoutHost,!1)}function pa(e,t,n,r){da(e,t,n,r),fa()}function ga(e,t,n){const r=zt(),i=Ht(),s=e+20,o=i.firstCreatePass?function(e,t,n,r,i){const s=t.consts,o=Ft(s,r),a=Fs(t,e,8,"ng-container",o);return null!==o&&Po(a,o,!0),Qs(t,n,a,Ft(s,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(s,i,r,t,n):i.data[s];Zt(o,!0);const a=r[s]=r[11].createComment("");is(i,r,a,o),wi(a,r),ft(o)&&(qs(i,r,o),Gs(i,o,r)),null!=n&&Ws(r,o)}function ma(){let e=qt();const t=Ht();Yt()?Kt():(e=e.parent,Zt(e,!1)),t.firstCreatePass&&(En(t,e),ht(e)&&t.queries.elementEnd(e))}function ya(){return zt()}function va(e){return!!e&&"function"==typeof e.then}const _a=function(e){return!!e&&"function"==typeof e.subscribe};function Ca(e,t,n,r){const i=zt(),s=Ht(),o=qt();return function(e,t,n,r,i,s,o,a){const c=ft(r),l=e.firstCreatePass&&Eo(e),u=t[8],h=Co(t);let d=!0;if(3&r.type||a){const f=Nt(r,t),p=a?a(f):f,g=h.length,m=a?e=>a(kt(e[r.index])):r.index;if(Tt(n)){let o=null;if(!a&&c&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=wa(r,t,u,s,!1);const e=n.listen(p,i,s);h.push(s,e),l&&l.push(i,m,g,g+1)}}else s=wa(r,t,u,s,!0),p.addEventListener(i,s,o),h.push(s),l&&l.push(i,m,g,o)}else s=wa(r,t,u,s,!1);const f=r.outputs;let p;if(d&&null!==f&&(p=f[i])){const e=p.length;if(e)for(let n=0;n<e;n+=2){const e=t[p[n]][p[n+1]].subscribe(s),o=h.length;h.push(s,e),l&&l.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,!!n,r),Ca}function Ea(e,t,n,r){try{return!1!==n(r)}catch(i){return wo(e,i),!1}}function wa(e,t,n,r,i){return function n(s){if(s===Function)return r;const o=2&e.flags?Rt(e.index,t):t;0==(32&t[2])&&go(o);let a=Ea(t,0,r,s),c=n.__ngNextListenerFn__;for(;c;)a=Ea(t,0,c,s)&&a,c=c.__ngNextListenerFn__;return i&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function ba(e=1){return function(e){return(Ut.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Ut.lFrame.contextLView))[8]}(e)}function Sa(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const s=t[i];if("*"!==s){if(null===r?ws(e,s,!0):bs(r,s))return i}else n=i}return n}function Pa(e,t,n,r,i){const s=zt(),o=ia(s,t,n,r);return o!==Os&&Js(Ht(),_n(),s,e,o,s[11],i,!1),Pa}function Oa(e,t,n,r,i,s,o){const a=zt(),c=sa(a,t,n,r,i,s);return c!==Os&&Js(Ht(),_n(),a,e,c,a[11],o,!1),Oa}function Ta(e,t,n,r,i,s,o,a,c){const l=zt(),u=oa(l,t,n,r,i,s,o,a);return u!==Os&&Js(Ht(),_n(),l,e,u,l[11],c,!1),Ta}function Ia(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?As(s):Ms(s),c=!1;for(;0!==a&&(!1===c||o);){const n=e[a+1];ka(e[a],t)&&(c=!0,e[a+1]=r?Rs(n):Ns(n)),a=r?As(n):Ms(n)}c&&(e[n+1]=r?Ns(s):Rs(s))}function ka(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&mr(e,t)>=0}function Aa(e,t){return function(e,t,n,r){const i=zt(),s=Ht(),o=nn(2);s.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[yn()],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(e.flags&(t?16:32))})(s,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Ut.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=Ma(n=Na(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Na(i,e,t,n,r),null===s){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Ms(r))return e[As(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=Na(null,e,t,n[1],r),n=Ma(n,t.attrs,r),function(e,t,n,r){e[As(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else s=function(e,t,n){let r;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=Ma(r,e[s].hostAttrs,n);return Ma(r,t.attrs,n)}(e,t,r)}return void 0!==s&&(r?t.residualClasses=s:t.residualStyles=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=s?t.classBindings:t.styleBindings,a=As(o),c=Ms(o);e[r]=n;let l,u=!1;if(Array.isArray(n)){const e=n;l=e[1],(null===l||mr(e,l)>0)&&(u=!0)}else l=n;if(i)if(0!==c){const t=As(e[a+1]);e[r+1]=ks(t,a),0!==t&&(e[t+1]=xs(e[t+1],r)),e[a+1]=function(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=ks(a,0),0!==a&&(e[a+1]=xs(e[a+1],r)),a=r;else e[r+1]=ks(c,0),0===a?a=r:e[c+1]=xs(e[c+1],r),c=r;u&&(e[r+1]=Ns(e[r+1])),Ia(e,l,r,!0),Ia(e,l,r,!1),function(e,t,n,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&mr(s,t)>=0&&(n[r+1]=Rs(n[r+1]))}(t,l,e,r,s),o=ks(a,c),s?t.classBindings=o:t.styleBindings=o}(i,s,t,n,o,r)}}(s,e,o,r),t!==Os&&ea(i,o,t)&&function(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const c=e.data,l=c[a+1];Ra(function(e){return 1==(1&e)}(l)?xa(c,t,n,i,Ms(l),o):void 0)||(Ra(s)||function(e){return 2==(2&e)}(l)&&(s=xa(c,null,n,i,a,o)),function(e,t,n,r,i){const s=Tt(e);if(t)i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Ni.DashCase;if(null==i)s?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const o="string"==typeof i&&i.endsWith("!important");o&&(i=i.slice(0,-10),t|=Ni.Important),s?e.setStyle(n,r,i,t):n.style.setProperty(r,i,o?"important":"")}}}(r,o,At(yn(),n),i,s))}(s,s.data[yn()],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=de(Gr(e)))),e}(t,n),r,o)}(e,t,null,!0),Aa}function Na(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=Ma(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function Ma(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),pr(e,o,!!n||t[++s]))}return void 0===e?null:e}function xa(e,t,n,r,i,s){const o=null===t;let a;for(;i>0;){const t=e[i],s=Array.isArray(t),c=s?t[1]:t,l=null===c;let u=n[i+1];u===Os&&(u=l?Ge:void 0);let h=l?gr(u,r):c===r?u:void 0;if(s&&!Ra(h)&&(h=gr(t,r)),Ra(h)&&(a=h,o))return a;const d=e[i+1];i=o?As(d):Ms(d)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=gr(e,r))}return a}function Ra(e){return void 0!==e}function Da(e,t=""){const n=zt(),r=Ht(),i=e+20,s=r.firstCreatePass?Fs(r,i,1,t,null):r.data[i],o=n[i]=Vi(n[11],t);is(r,n,o,s),Zt(s,!1)}function La(e){return Fa("",e,""),La}function Fa(e,t,n){const r=zt(),i=ia(r,e,t,n);return i!==Os&&So(r,yn(),i),Fa}function Ba(e,t,n,r,i){const s=zt(),o=sa(s,e,t,n,r,i);return o!==Os&&So(s,yn(),o),Ba}function Va(e,t,n,r,i,s,o){const a=zt(),c=oa(a,e,t,n,r,i,s,o);return c!==Os&&So(a,yn(),c),Va}function Ua(e,t,n){const r=zt();return ea(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!0),Ua}const $a=void 0;var za=["en",[["a","p"],["AM","PM"],$a],[["AM","PM"],$a,$a],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],$a,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],$a,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",$a,"{1} 'at' {0}",$a],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){const t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let Ha={};function Ga(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Wa(t);if(n)return n;const r=t.split("-")[0];if(n=Wa(r),n)return n;if("en"===r)return za;throw new Error(`Missing locale data for the locale "${e}".`)}function qa(e){return Ga(e)[ja.PluralCase]}function Wa(e){return e in Ha||(Ha[e]=ze.ng&&ze.ng.common&&ze.ng.common.locales&&ze.ng.common.locales[e]),Ha[e]}var ja=(()=>((ja=ja||{})[ja.LocaleId=0]="LocaleId",ja[ja.DayPeriodsFormat=1]="DayPeriodsFormat",ja[ja.DayPeriodsStandalone=2]="DayPeriodsStandalone",ja[ja.DaysFormat=3]="DaysFormat",ja[ja.DaysStandalone=4]="DaysStandalone",ja[ja.MonthsFormat=5]="MonthsFormat",ja[ja.MonthsStandalone=6]="MonthsStandalone",ja[ja.Eras=7]="Eras",ja[ja.FirstDayOfWeek=8]="FirstDayOfWeek",ja[ja.WeekendRange=9]="WeekendRange",ja[ja.DateFormat=10]="DateFormat",ja[ja.TimeFormat=11]="TimeFormat",ja[ja.DateTimeFormat=12]="DateTimeFormat",ja[ja.NumberSymbols=13]="NumberSymbols",ja[ja.NumberFormats=14]="NumberFormats",ja[ja.CurrencyCode=15]="CurrencyCode",ja[ja.CurrencySymbol=16]="CurrencySymbol",ja[ja.CurrencyName=17]="CurrencyName",ja[ja.Currencies=18]="Currencies",ja[ja.Directionality=19]="Directionality",ja[ja.PluralCase=20]="PluralCase",ja[ja.ExtraData=21]="ExtraData",ja))();const Za=["zero","one","two","few","many"],Ya="en-US",Ka={marker:"element"},Ja={marker:"ICU"};var Qa=(()=>((Qa=Qa||{})[Qa.SHIFT=2]="SHIFT",Qa[Qa.APPEND_EAGERLY=1]="APPEND_EAGERLY",Qa[Qa.COMMENT=2]="COMMENT",Qa))();let Xa=Ya;function ec(e){(function(e,t){null==e&&we(t,e,null,"!=")})(e,"Expected localeId to be defined"),"string"==typeof e&&(Xa=e.toLowerCase().replace(/_/g,"-"))}function tc(e,t,n){const r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?es(e,0,n):kt(n[i])}function nc(e,t,n,r,i){const s=t.insertBeforeIndex;if(Array.isArray(s)){let o=r,a=null;if(3&t.type||(a=o,o=i),null!==o&&0==(2&t.flags))for(let t=1;t<s.length;t++)Yi(e,o,n[s[t]],a,!1)}}function rc(e,t){if(e.push(t),e.length>1)for(let n=e.length-2;n>=0;n--){const r=e[n];ic(r)||sc(r,t)&&null===oc(r)&&ac(r,t.index)}}function ic(e){return!(64&e.type)}function sc(e,t){return ic(t)||e.index>t.index}function oc(e){const t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function ac(e,t){const n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(rs(tc,nc),e.insertBeforeIndex=t)}function cc(e,t){const n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function lc(e,t,n){const r=Bs(e,n,64,null,null);return rc(t,r),r}function uc(e,t){const n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function hc(e){return e>>>17}function dc(e){return(131070&e)>>>1}let fc=0,pc=0;function gc(e,t,n,r){const i=n[11];let s,o=null;for(let a=0;a<t.length;a++){const c=t[a];if("string"==typeof c){const e=t[++a];null===n[e]&&(n[e]=Vi(i,c))}else if("number"==typeof c)switch(1&c){case 0:const l=hc(c);let u,h;if(null===o&&(o=l,s=Qi(i,r)),l===o?(u=r,h=s):(u=null,h=kt(n[l])),null!==h){const t=dc(c);Yi(i,h,n[t],u,!1);const r=cc(e,t);if(null!==r&&"object"==typeof r){const t=uc(r,n);null!==t&&gc(e,r.create[t],n,n[r.anchorIdx])}}break;case 1:const d=t[++a],f=t[++a];oo(i,At(c>>>1,n),null,null,d,f,null);break;default:throw new Error(`Unable to determine the type of mutate operation for "${c}"`)}else switch(c){case Ja:const e=t[++a],r=t[++a];null===n[r]&&wi(n[r]=$i(i,e),n);break;case Ka:const s=t[++a],o=t[++a];null===n[o]&&wi(n[o]=zi(i,s,null),n)}}}function mc(e,t,n,r,i){for(let s=0;s<n.length;s++){const o=n[s],a=n[++s];if(o&i){let i="";for(let o=s+1;o<=s+a;o++){const s=n[o];if("string"==typeof s)i+=s;else if("number"==typeof s)if(s<0)i+=_e(t[r-s]);else{const a=s>>>2;switch(3&s){case 1:const s=n[++o],c=n[++o],l=e.data[a];"string"==typeof l?oo(t[11],t[a],null,l,s,i,c):Js(e,l,t,s,i,t[11],c,!1);break;case 0:const u=t[a];null!==u&&Ui(t[11],u,i);break;case 2:vc(e,cc(e,a),t,i);break;case 3:yc(e,cc(e,a),r,t)}}}}else{const i=n[s+1];if(i>0&&3==(3&i)){const n=cc(e,i>>>2);t[n.currentCaseLViewIndex]<0&&yc(e,n,r,t)}}s+=a}}function yc(e,t,n,r){let i=r[t.currentCaseLViewIndex];if(null!==i){let s=fc;i<0&&(i=r[t.currentCaseLViewIndex]=~i,s=-1),mc(e,r,t.update[i],n,s)}}function vc(e,t,n,r){const i=function(e,t){let n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:{const r=function(e,t){const n=qa(t)(parseInt(e,10)),r=Za[n];return void 0!==r?r:"other"}(t,Xa);n=e.cases.indexOf(r),-1===n&&"other"!==r&&(n=e.cases.indexOf("other"));break}case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(uc(t,n)!==i&&(_c(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){const r=n[t.anchorIdx];r&&gc(e,t.create[i],n,r)}}function _c(e,t,n){let r=uc(t,n);if(null!==r){const i=t.remove[r];for(let t=0;t<i.length;t++){const r=i[t];if(r>0){const e=At(r,n);null!==e&&cs(n[11],e)}else _c(e,cc(e,~r),n)}}}function Cc(){const e=[];let t,n,r=-1;function i(e,t){r=0;const i=uc(e,t);n=null!==i?e.remove[i]:Ge}function s(){if(r<n.length){const o=n[r++];return o>0?t[o]:(e.push(r,n),i(t[1].data[~o],t),s())}return 0===e.length?null:(n=e.pop(),r=e.pop(),s())}return function(n,r){for(t=r;e.length;)e.pop();return i(n.value,r),s}}const Ec=/\ufffd(\d+):?\d*\ufffd/gi,wc=/\ufffd(\d+)\ufffd/,bc=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,Sc=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,Pc=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,Oc=/\uE500/g;function Tc(e,t,n,r,i,s,o){const a=Vs(e,r,1,null);let c=a<<Qa.SHIFT,l=jt();t===l&&(l=null),null===l&&(c|=Qa.APPEND_EAGERLY),o&&(c|=Qa.COMMENT,function(e){void 0===Mi&&(Mi=e())}(Cc)),i.push(c,null===s?"":s);const u=Bs(e,a,o?32:1,null===s?"":s,null);rc(n,u);const h=u.index;return Zt(u,!1),null!==l&&t!==l&&function(e,t){let n=e.insertBeforeIndex;null===n?(rs(tc,nc),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){e!=t&&we(n,e,t,"==")}(Array.isArray(n),!0,"Expecting array here"),n.push(t))}(l,h),u}function Ic(e,t,n,r,i,s,o){const a=o.match(Ec),c=Tc(e,t,n,s,r,a?null:o,!1);a&&kc(i,o,c.index,null,0,null)}function kc(e,t,n,r,i,s){const o=e.length,a=o+1;e.push(null,null);const c=o+2,l=t.split(Ec);let u=0;for(let h=0;h<l.length;h++){const t=l[h];if(1&h){const n=i+parseInt(t,10);e.push(-1-n),u|=Ac(n)}else""!==t&&e.push(t)}return e.push(n<<2|(r?1:0)),r&&e.push(r,s),e[o]=u,e[a]=e.length-c,u}function Ac(e){return 1<<Math.min(e,31)}function Nc(e){let t,n,r="",i=0,s=!1;for(;null!==(t=Sc.exec(e));)s?t[0]===`\ufffd/*${n}\ufffd`&&(i=t.index,s=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],s=!0);return r+=e.substr(i),r}function Mc(e,t,n,r,i,s){let o=0;const a={type:i.type,currentCaseLViewIndex:Vs(e,t,1,null),anchorIdx:s,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(Ac(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,s),function(e,t,n){const r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,s,a);const c=i.values;for(let l=0;l<c.length;l++){const s=c[l],u=[];for(let e=0;e<s.length;e++){const t=s[e];if("string"!=typeof t){const n=u.push(t)-1;s[e]=`\x3c!--\ufffd${n}\ufffd--\x3e`}}o=Dc(e,a,t,n,r,i.cases[l],s.join(""),u)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,s)}function xc(e){const t=[],n=[];let r=1,i=0;const s=Rc(e=e.replace(bc,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""}));for(let o=0;o<s.length;){let e=s[o++].trim();1===r&&(e=e.replace(/\s*(?:=)?(\w+)\s*/,"$1")),e.length&&t.push(e);const i=Rc(s[o++]);t.length>n.length&&n.push(i)}return{type:r,mainBinding:i,cases:t,values:n}}function Rc(e){if(!e)return[];let t=0;const n=[],r=[],i=/[{}]/g;let s;for(i.lastIndex=0;s=i.exec(e);){const i=s.index;if("}"==s[0]){if(n.pop(),0==n.length){const n=e.substring(t,i);bc.test(n)?r.push(xc(n)):r.push(n),t=i+1}}else{if(0==n.length){const n=e.substring(t,i);r.push(n),t=i+1}n.push("{")}}const o=e.substring(t);return r.push(o),r}function Dc(e,t,n,r,i,s,o,a){const c=[],l=[],u=[];t.cases.push(s),t.create.push(c),t.remove.push(l),t.update.push(u);const h=jr(Ot()).getInertBodyElement(o),d=mi(h)||h;return d?Lc(e,t,n,r,c,l,u,d,i,a,0):0}function Lc(e,t,n,r,i,s,o,a,c,l,u){let h=0,d=a.firstChild;for(;d;){const a=Vs(e,n,1,null);switch(d.nodeType){case Node.ELEMENT_NODE:const f=d,p=f.tagName.toLowerCase();if(si.hasOwnProperty(p)){Vc(i,Ka,p,c,a),e.data[a]=p;const g=f.attributes;for(let e=0;e<g.length;e++){const t=g.item(e),n=t.name.toLowerCase();t.value.match(Ec)?ci.hasOwnProperty(n)&&kc(o,t.value,a,t.name,0,oi[n]?Qr:ai[n]?Xr:null):Uc(i,a,t)}h=Lc(e,t,n,r,i,s,o,d,a,l,u+1)|h,Fc(s,a,u)}break;case Node.TEXT_NODE:const g=d.textContent||"",m=g.match(Ec);Vc(i,null,m?"":g,c,a),Fc(s,a,u),m&&(h=kc(o,g,a,null,0,null)|h);break;case Node.COMMENT_NODE:const y=wc.exec(d.textContent||"");if(y){const t=l[parseInt(y[1],10)];Vc(i,Ja,"",c,a),Mc(e,n,r,c,t,a),Bc(s,a,u)}}d=d.nextSibling}return h}function Fc(e,t,n){0===n&&e.push(t)}function Bc(e,t,n){0===n&&(e.push(~t),e.push(t))}function Vc(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function Uc(e,t,n){e.push(t<<1|1,n.name,n.value)}function $c(e,t,n=-1){const r=Ht(),i=zt(),s=20+e,o=Ft(r.consts,t),a=jt();r.firstCreatePass&&function(e,t,n,r,i,s){const o=jt(),a=[],c=[],l=[[]],u=function(e){return e.replace(Oc," ")}(i=function(e,t){if(function(e){return-1===e}(t))return Nc(e);{const n=e.indexOf(`:${t}\ufffd`)+2+t.toString().length,r=e.search(new RegExp(`\ufffd\\/\\*\\d+:${t}\ufffd`));return Nc(e.substring(n,r))}}(i,s)).split(Pc);for(let h=0;h<u.length;h++){let r=u[h];if(0==(1&h)){const s=Rc(r);for(let r=0;r<s.length;r++){let u=s[r];if(0==(1&r)){const t=u;""!==t&&Ic(e,o,l[0],a,c,n,t)}else{const r=u;if("object"!=typeof r)throw new Error(`Unable to parse ICU expression in "${i}" message.`);Mc(e,n,c,t,r,Tc(e,o,l[0],n,a,"",!0).index)}}}else{const t=47===r.charCodeAt(0),n=(r.charCodeAt(t?1:0),20+Number.parseInt(r.substring(t?2:1)));if(t)l.shift(),Zt(jt(),!1);else{const t=lc(e,l[0],n);l.unshift([]),Zt(t,!0)}}}e.data[r]={create:a,update:c}}(r,null===a?0:a.index,i,s,o,n);const c=r.data[s],l=Zi(r,a===i[6]?null:a,i);(function(e,t,n,r){const i=e[11];for(let s=0;s<t.length;s++){const o=t[s++],a=t[s],c=(o&Qa.COMMENT)===Qa.COMMENT,l=(o&Qa.APPEND_EAGERLY)===Qa.APPEND_EAGERLY,u=o>>>Qa.SHIFT;let h=e[u];null===h&&(h=e[u]=c?i.createComment(a):Vi(i,a)),l&&null!==n&&Yi(i,n,h,r,!1)}})(i,c.create,l,a&&8&a.type?i[a.index]:null),rn(!0)}function zc(){rn(!1)}function Hc(e,t,n){$c(e,t,n),zc()}function Gc(e){return function(e){e&&(fc|=1<<Math.min(pc,31)),pc++}(ea(zt(),tn(),e)),Gc}function qc(e){!function(e,t,n){if(pc>0){const r=e.data[n];mc(e,t,Array.isArray(r)?r:r.update,en()-pc-1,fc)}fc=0,pc=0}(Ht(),zt(),e+20)}function Wc(e,t,n,r,i){if(e=me(e),Array.isArray(e))for(let s=0;s<e.length;s++)Wc(e[s],t,n,r,i);else{const s=Ht(),o=zt();let a=Vo(e)?e:me(e.provide),c=Lo(e);const l=qt(),u=1048575&l.providerIndexes,h=l.directiveStart,d=l.providerIndexes>>20;if(Vo(e)||!e.multi){const r=new Tn(c,i,la),f=Yc(a,t,i?u:u+d,h);-1===f?(Hn(Vn(l,o),s,a),jc(s,e,t.length),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(r),o.push(r)):(n[f]=r,o[f]=r)}else{const f=Yc(a,t,u+d,h),p=Yc(a,t,u,u+d),g=f>=0&&n[f],m=p>=0&&n[p];if(i&&!m||!i&&!g){Hn(Vn(l,o),s,a);const u=function(e,t,n,r,i){const s=new Tn(e,n,la);return s.multi=[],s.index=t,s.componentProviders=0,Zc(s,i,r&&!n),s}(i?Jc:Kc,n.length,i,r,c);!i&&m&&(n[p].providerFactory=u),jc(s,e,t.length,0),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(u),o.push(u)}else jc(s,e,f>-1?f:p,Zc(n[i?p:f],c,!i&&r));!i&&r&&m&&n[p].componentProviders++}}}function jc(e,t,n,r){const i=Vo(t);if(i||function(e){return!!e.useClass}(t)){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function Zc(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function Yc(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function Kc(e,t,n,r){return Qc(this.multi,[])}function Jc(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Jn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),Qc(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],Qc(i,s);return s}function Qc(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Xc(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ht();if(r.firstCreatePass){const i=pt(e);Wc(n,r.data,r.blueprint,i,!0),Wc(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class el{}const tl="ngComponent";class nl{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${de(e)}. Did you add it to @NgModule.entryComponents?`);return t[tl]=e,t}(e)}}let rl=(()=>{class e{}return e.NULL=new nl,e})();function il(...e){}function sl(e,t){return new al(Nt(e,t))}const ol=function(){return sl(qt(),zt())};let al=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=ol,e})();function cl(e){return e instanceof al?e.nativeElement:e}class ll{}let ul=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>hl(),e})();const hl=function(){const e=zt(),t=Rt(qt().index,e);return function(e){return e[11]}(lt(t)?t:e)};let dl=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>null}),e})();class fl{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const pl=new fl("12.2.16");class gl{constructor(){}supports(e){return Jo(e)}create(e){return new yl(e)}}const ml=(e,t)=>t;class yl{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||ml}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<El(n,r,i)?t:n,o=El(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Jo(e))throw new Error(`Error trying to diff '${de(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Yo()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new vl(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Cl),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Cl),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class vl{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class _l{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class Cl{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new _l,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function El(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class wl{constructor(){}supports(e){return e instanceof Map||Qo(e)}create(){return new bl}}class bl{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Qo(e)))throw new Error(`Error trying to diff '${de(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Sl(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Sl{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Pl(){return new Ol([new gl])}let Ol=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Pl()),deps:[[e,new xr,new Mr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:Pl}),e})();function Tl(){return new Il([new wl])}let Il=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Tl()),deps:[[e,new xr,new Mr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:Tl}),e})();function kl(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(kt(s)),ut(s))for(let e=10;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&kl(t[1],t,n,r)}const o=n.type;if(8&o)kl(e,t,n.child,r);else if(32&o){const e=xi(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=os(t,n);if(Array.isArray(e))r.push(...e);else{const n=Ri(t[16]);kl(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class Al{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return kl(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ut(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Gi(e,n),dr(t,n))}this._attachedToViewContainer=!1}qi(this._lView[1],this._lView)}onDestroy(e){Ys(this._lView[1],this._lView,null,e)}markForCheck(){go(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){mo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Qt(!0);try{mo(e,t,n)}finally{Qt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,us(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Nl extends Al{constructor(e){super(e),this._view=e}detectChanges(){yo(this._view)}checkNoChanges(){!function(e){Qt(!0);try{yo(e)}finally{Qt(!1)}}(this._view)}get context(){return null}}const Ml=function(e){return function(e,t,n){if(dt(e)&&!n){const n=Rt(e.index,t);return new Al(n,n)}return 47&e.type?new Al(t[16],t):null}(qt(),zt(),16==(16&e))};let xl=(()=>{class e{}return e.__NG_ELEMENT_ID__=Ml,e})();const Rl=[new wl],Dl=new Ol([new gl]),Ll=new Il(Rl),Fl=function(){return $l(qt(),zt())};let Bl=(()=>{class e{}return e.__NG_ELEMENT_ID__=Fl,e})();const Vl=Bl,Ul=class extends Vl{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ls(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Us(t,n,e),new Al(n)}};function $l(e,t){return 4&e.type?new Ul(t,e,sl(e,t)):null}class zl{}class Hl{}const Gl=function(){return Kl(qt(),zt())};let ql=(()=>{class e{}return e.__NG_ELEMENT_ID__=Gl,e})();const Wl=ql,jl=class extends Wl{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return sl(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const e=zn(this._hostTNode,this._hostLView);if(xn(e)){const t=Dn(e,this._hostLView),n=Rn(e);return new er(t[1].data[n+8],t)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Zl(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(zl,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(ut(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new jl(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-10?(t[4]=n[i],hr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=as(i,s),a=n[11],c=Qi(a,s[7]);return null!==c&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,us(e,r,n,1,i,s)}(r,s[6],a,n,c,o),e.attachToViewContainerRef(),hr(Yl(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Zl(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);n&&(dr(Yl(this._lContainer),t),qi(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);return n&&null!=dr(Yl(this._lContainer),t)?new Al(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function Zl(e){return e[8]}function Yl(e){return e[8]||(e[8]=[])}function Kl(e,t){let n;const r=t[e.index];if(ut(r))n=r;else{let i;if(8&e.type)i=kt(r);else{const n=t[11];i=n.createComment("");const r=Nt(e,t);Yi(n,Qi(n,r),i,function(e,t){return Tt(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=lo(r,t,i,e),po(t,n)}return new jl(n,e,t)}const Jl={};class Ql extends rl{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=at(e);return new tu(t,this.ngModule)}}function Xl(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const eu=new or("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ki});class tu extends el{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ps).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Xl(this.componentDef.inputs)}get outputs(){return Xl(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,Jl,i);return s!==Jl||r===Jl?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(ll,It),o=i.get(dl,null),a=s.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",l=n?function(e,t,n){if(Tt(e))return e.selectRootElement(t,n===Be.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):zi(s.createRenderer(null,this.componentDef),c,function(e){const t=e.toLowerCase();return"svg"===t?St:"math"===t?"http://www.w3.org/1998/MathML/":null}(c)),u=this.componentDef.onPush?576:528,h=function(e,t){return{components:[],scheduler:e||ki,clean:_o,playerHandler:t||null,flags:0}}(),d=Zs(0,null,null,1,0,null,null,null,null,null),f=Ls(null,d,h,u,null,null,s,a,o,i);let p,g;hn(f);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=Fs(o,20,2,"#host",null),c=a.mergedAttrs=t.hostAttrs;null!==c&&(Po(a,c,!0),null!==e&&(In(i,e,c),null!==a.classes&&fs(i,e,a.classes),null!==a.styles&&ds(i,e,a.styles)));const l=r.createRenderer(e,t),u=Ls(n,js(t),null,t.onPush?64:16,n[20],a,r,l,s||null,null);return o.firstCreatePass&&(Hn(Vn(a,n),o,t.type),to(o,a),ro(a,n.length,1)),po(n,u),n[20]=u}(l,this.componentDef,f,s,a);if(l)if(n)In(a,l,["ng-version",pl.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Cs(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&In(a,l,e),t&&t.length>0&&fs(a,l,t.join(" "))}if(g=Mt(d,20),void 0!==t){const e=g.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}p=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=qt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),io(e,r,t,Vs(e,t,1,null),n));const i=Jn(t,e,r.directiveStart,r);wi(i,t);const s=Nt(r,t);return s&&wi(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=qt();t.contentQueries(1,o,e.directiveStart)}const a=qt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(vn(a.index),Xs(n[1],a,0,a.directiveStart,a.directiveEnd,t),eo(t,o)),o}(e,this.componentDef,f,h,[zo]),Us(d,f,null)}finally{mn()}return new nu(this.componentType,p,sl(g,f),f,g)}}class nu extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new Nl(r),this.componentType=e}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const ru=new Map;class iu extends zl{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Ql(this);const n=ct(e),r=e[Ye]||null;r&&ec(r),this._bootstrapComponents=Ai(n.bootstrap),this._r3Injector=xo(e,t,[{provide:zl,useValue:this},{provide:rl,useValue:this.componentFactoryResolver}],de(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=$o.THROW_IF_NOT_FOUND,n=Me.Default){return e===$o||e===zl||e===Oo?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class su extends Hl{constructor(e){super(),this.moduleType=e,null!==ct(e)&&function(e){const t=new Set;!function e(n){const r=ct(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${de(t)} vs ${de(t.name)}`)}(i,ru.get(i),n),ru.set(i,n));const s=Ai(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new iu(this.moduleType,e)}}function ou(e,t,n){const r=Xt()+e,i=zt();return i[r]===Os?Xo(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function au(e,t,n,r){return hu(zt(),Xt(),e,t,n,r)}function cu(e,t,n,r,i){return du(zt(),Xt(),e,t,n,r,i)}function lu(e,t,n,r,i,s,o){return function(e,t,n,r,i,s,o,a,c){const l=t+n;return function(e,t,n,r,i,s){const o=ta(e,t,n,r);return ta(e,t+2,i,s)||o}(e,l,i,s,o,a)?Xo(e,l+4,c?r.call(c,i,s,o,a):r(i,s,o,a)):uu(e,l+4)}(zt(),Xt(),e,t,n,r,i,s,o)}function uu(e,t){const n=e[t];return n===Os?void 0:n}function hu(e,t,n,r,i,s){const o=t+n;return ea(e,o,i)?Xo(e,o+1,s?r.call(s,i):r(i)):uu(e,o+1)}function du(e,t,n,r,i,s,o){const a=t+n;return ta(e,a,i,s)?Xo(e,a+2,o?r.call(o,i,s):r(i,s)):uu(e,a+2)}function fu(e,t){const n=Ht();let r;const i=e+20;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new ve("302",`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=mt(r.type)),o=Re(la);try{const e=Fn(!1),t=s();return Fn(e),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,zt(),i,t),t}finally{Re(o)}}function pu(e,t,n){const r=e+20,i=zt(),s=xt(i,r);return yu(i,mu(i,r)?hu(i,Xt(),t,s.transform,n,s):s.transform(n))}function gu(e,t,n,r,i){const s=e+20,o=zt(),a=xt(o,s);return yu(o,mu(o,s)?function(e,t,n,r,i,s,o,a){const c=t+n;return na(e,c,i,s,o)?Xo(e,c+3,a?r.call(a,i,s,o):r(i,s,o)):uu(e,c+3)}(o,Xt(),t,a.transform,n,r,i,a):a.transform(n,r,i))}function mu(e,t){return e[1].data[t].pure}function yu(e,t){return Ko.isWrapped(t)&&(t=Ko.unwrap(t),e[en()]=Os),t}function vu(e){return t=>{setTimeout(e,void 0,t)}}const _u=class extends A{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,i,s;let o=e,c=t||(()=>null),l=n;if(e&&"object"==typeof e){const t=e;o=null===(r=t.next)||void 0===r?void 0:r.bind(t),c=null===(i=t.error)||void 0===i?void 0:i.bind(t),l=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(c=vu(c),o&&(o=vu(o)),l&&(l=vu(l)));const u=super.subscribe({next:o,error:c,complete:l});return e instanceof a&&e.add(u),u}};function Cu(){return this._results[Yo()]()}class Eu{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Yo(),n=Eu.prototype;n[t]||(n[t]=Cu)}get changes(){return this._changes||(this._changes=new _u)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=lr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class wu{constructor(e){this.queryList=e,this.matches=null}clone(){return new wu(this.queryList)}setDirty(){this.queryList.setDirty()}}class bu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new bu(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==Ru(e,t).matches&&this.queries[t].setDirty()}}class Su{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Pu{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new Pu(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Ou{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Ou(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,Tu(t,i)),this.matchTNodeWithReadOption(e,t,Kn(t,e,i,!1,!1))}else n===Bl?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kn(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===al||r===ql||r===Bl&&4&t.type)this.addMatch(t.index,-2);else{const n=Kn(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function Tu(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function Iu(e,t,n,r){return-1===n?function(e,t){return 11&e.type?sl(e,t):4&e.type?$l(e,t):null}(t,e):-2===n?function(e,t,n){return n===al?sl(t,e):n===Bl?$l(t,e):n===ql?Kl(t,e):void 0}(e,t,r):Jn(e,e[1],n,t)}function ku(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,s=n.matches,o=[];for(let e=0;e<s.length;e+=2){const i=s[e];o.push(i<0?null:Iu(t,r[i],s[e+1],n.metadata.read))}i.matches=o}return i.matches}function Au(e,t,n,r){const i=e.queries.getByIndex(n),s=i.matches;if(null!==s){const o=ku(e,t,i,n);for(let e=0;e<s.length;e+=2){const n=s[e];if(n>0)r.push(o[e/2]);else{const i=s[e+1],o=t[-n];for(let e=10;e<o.length;e++){const t=o[e];t[17]===t[3]&&Au(t[1],t,i,r)}if(null!==o[9]){const e=o[9];for(let t=0;t<e.length;t++){const n=e[t];Au(n[1],n,i,r)}}}}}return r}function Nu(e){const t=zt(),n=Ht(),r=an();cn(r+1);const i=Ru(n,r);if(e.dirty&&Dt(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?Au(n,t,r,[]):ku(n,t,i,r);e.reset(s,cl),e.notifyOnChanges()}return!0}return!1}function Mu(e,t,n){const r=Ht();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Pu),e.queries.track(new Ou(t,n))}(r,new Su(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){const r=new Eu(4==(4&n));Ys(e,t,r,r.destroy),null===t[19]&&(t[19]=new bu),t[19].queries.push(new wu(r))}(r,zt(),t)}function xu(){return e=zt(),t=an(),e[19].queries[t].queryList;var e,t}function Ru(e,t){return e.queries.getByIndex(t)}function Du(e,t){return $l(e,t)}const Lu=new or("Application Initializer");let Fu=(()=>{class e{constructor(e){this.appInits=e,this.resolve=il,this.reject=il,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(va(t))e.push(t);else if(_a(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(Lu,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Bu=new or("AppId"),Vu={provide:Bu,useFactory:function(){return`${Uu()}${Uu()}${Uu()}`},deps:[]};function Uu(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const $u=new or("Platform Initializer"),zu=new or("Platform ID"),Hu=new or("appBootstrapListener");let Gu=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const qu=new or("LocaleId"),Wu=new or("DefaultCurrencyCode");class ju{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Zu=function(e){return new su(e)},Yu=Zu,Ku=function(e){return Promise.resolve(Zu(e))},Ju=function(e){const t=Zu(e),n=Ai(ct(e).declarations).reduce((e,t)=>{const n=at(t);return n&&e.push(new tu(n)),e},[]);return new ju(t,n)},Qu=Ju,Xu=function(e){return Promise.resolve(Ju(e))};let eh=(()=>{class e{constructor(){this.compileModuleSync=Yu,this.compileModuleAsync=Ku,this.compileModuleAndAllComponentsSync=Qu,this.compileModuleAndAllComponentsAsync=Xu}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const th=(()=>Promise.resolve(0))();function nh(e){"undefined"==typeof Zone?th.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class rh{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new _u(!1),this.onMicrotaskEmpty=new _u(!1),this.onStable=new _u(!1),this.onError=new _u(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ze,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,oh(e),e.isCheckStableRunning=!0,sh(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),oh(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return ah(e),n.invokeTask(i,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),ch(e)}},onInvoke:(n,r,i,s,o,a,c)=>{try{return ah(e),n.invoke(i,s,o,a,c)}finally{e.shouldCoalesceRunChangeDetection&&t(),ch(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,oh(e),sh(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!rh.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(rh.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,ih,il,il);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const ih={};function sh(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function oh(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ah(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ch(e){e._nesting--,sh(e)}class lh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new _u,this.onMicrotaskEmpty=new _u,this.onStable=new _u,this.onError=new _u}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let uh=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{rh.assertNotInAngularZone(),nh(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())nh(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Or(rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),hh=(()=>{class e{constructor(){this._applications=new Map,fh.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return fh.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class dh{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let fh=new dh,ph=!0,gh=!1;let mh;const yh=new or("AllowMultipleToken");class vh{constructor(e,t){this.name=e,this.token=t}}function _h(e,t,n=[]){const r=`Platform: ${t}`,i=new or(r);return(t=[])=>{let s=Ch();if(!s||s.injector.get(yh,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:Io,useValue:"platform"});!function(e){if(mh&&!mh.destroyed&&!mh.injector.get(yh,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");mh=e.get(Eh);const t=e.get($u,null);t&&t.forEach(e=>e())}($o.create({providers:e,name:r}))}return function(e){const t=Ch();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Ch(){return mh&&!mh.destroyed?mh:null}let Eh=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new lh:("zone.js"===e?void 0:e)||new rh({enableLongStackTrace:(gh=!0,ph),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:rh,useValue:n}];return n.run(()=>{const i=$o.create({providers:r,parent:this.injector,name:e.moduleType.name}),s=e.create(i),o=s.injector.get(Oi,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});s.onDestroy(()=>{Sh(this._modules,s),e.unsubscribe()})}),function(e,n,r){try{const t=r();return va(t)?t.catch(t=>{throw n.runOutsideAngular(()=>e.handleError(t)),t}):t}catch(t){throw n.runOutsideAngular(()=>e.handleError(t)),t}}(o,n,()=>{const e=s.injector.get(Fu);return e.runInitializers(),e.donePromise.then(()=>(ec(s.injector.get(qu,Ya)||Ya),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const n=wh({},t);return function(e,t,n){const r=new su(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(bh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${de(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function wh(e,t){return Array.isArray(t)?t.reduce(wh,e):Object.assign(Object.assign({},e),t)}let bh=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new T(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),o=new T(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{rh.assertNotInAngularZone(),nh(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{rh.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){const t=re(e),n=function(e,t){return"number"==typeof te(e)?e.pop():1/0}(e),r=e;return r.length?1===r.length?Y(r[0]):X(n)(ae(r,t)):ee}(s,o.pipe(function(e={}){const{connector:t=(()=>new A),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return e=>{let s=null,o=null,a=null,c=0,l=!1,u=!1;const h=()=>{null==o||o.unsubscribe(),o=null},d=()=>{h(),s=a=null,l=u=!1},f=()=>{const e=s;d(),null==e||e.unsubscribe()};return x((e,p)=>{c++,!u&&!l&&h();const g=a=a??t();p.add(()=>{c--,0===c&&!u&&!l&&(o=le(f,i))}),g.subscribe(p),s||(s=new C({next:e=>g.next(e),error:e=>{u=!0,h(),o=le(d,n,e),g.error(e)},complete:()=>{l=!0,h(),o=le(d,r),g.complete()}}),ae(e).subscribe(s))})(e)}}()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof el?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(zl),i=n.create($o.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(uh,null),a=o&&i.injector.get(hh);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),Sh(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Sh(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Hu,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Or(rh),Or($o),Or(Oi),Or(rl),Or(Fu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Sh(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Ph{}class Oh{}const Th={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Ih=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||Th}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>kh(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>kh(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Or(eh),Or(Oh,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function kh(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const Ah=_h(null,"core",[{provide:zu,useValue:"unknown"},{provide:Eh,deps:[$o]},{provide:hh,deps:[]},{provide:Gu,deps:[]}]),Nh=[{provide:bh,useClass:bh,deps:[rh,$o,Oi,rl,Fu]},{provide:eu,deps:[rh],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Fu,useClass:Fu,deps:[[new Mr,Lu]]},{provide:eh,useClass:eh,deps:[]},Vu,{provide:Ol,useFactory:function(){return Dl},deps:[]},{provide:Il,useFactory:function(){return Ll},deps:[]},{provide:qu,useFactory:function(e){return ec(e=e||"undefined"!=typeof $localize&&$localize.locale||Ya),e},deps:[[new Nr(qu),new Mr,new xr]]},{provide:Wu,useValue:"USD"}];let Mh=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Or(bh))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:Nh}),e})(),xh=null;function Rh(){return xh}const Dh=new or("DocumentToken");let Lh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:Fh,token:e,providedIn:"platform"}),e})();function Fh(){return Or(Vh)}const Bh=new or("Location Initialized");let Vh=(()=>{class e extends Lh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rh().getBaseHref(this._doc)}onPopState(e){const t=Rh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=Rh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){Uh()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){Uh()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh))},e.\u0275prov=be({factory:$h,token:e,providedIn:"platform"}),e})();function Uh(){return!!window.history.pushState}function $h(){return new Vh(Or(Dh))}function zh(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Hh(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Gh(e){return e&&"?"!==e[0]?"?"+e:e}let qh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:Wh,token:e,providedIn:"root"}),e})();function Wh(e){const t=Or(Dh).location;return new Zh(Or(Lh),t&&t.origin||"")}const jh=new or("appBaseHref");let Zh=(()=>{class e extends qh{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return zh(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+Gh(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+Gh(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+Gh(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh),Or(jh,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Yh=(()=>{class e extends qh{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=zh(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+Gh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+Gh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh),Or(jh,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Kh=(()=>{class e{constructor(e,t){this._subject=new _u,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=Hh(Qh(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+Gh(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Qh(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Gh(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Gh(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Or(qh),Or(Lh))},e.normalizeQueryParams=Gh,e.joinWithSlash=zh,e.stripTrailingSlash=Hh,e.\u0275prov=be({factory:Jh,token:e,providedIn:"root"}),e})();function Jh(){return new Kh(Or(qh),Or(Lh))}function Qh(e){return e.replace(/\/index.html$/,"")}var Xh=(()=>((Xh=Xh||{})[Xh.Decimal=0]="Decimal",Xh[Xh.Percent=1]="Percent",Xh[Xh.Currency=2]="Currency",Xh[Xh.Scientific=3]="Scientific",Xh))(),ed=(()=>((ed=ed||{})[ed.Zero=0]="Zero",ed[ed.One=1]="One",ed[ed.Two=2]="Two",ed[ed.Few=3]="Few",ed[ed.Many=4]="Many",ed[ed.Other=5]="Other",ed))(),td=(()=>((td=td||{})[td.Format=0]="Format",td[td.Standalone=1]="Standalone",td))(),nd=(()=>((nd=nd||{})[nd.Narrow=0]="Narrow",nd[nd.Abbreviated=1]="Abbreviated",nd[nd.Wide=2]="Wide",nd[nd.Short=3]="Short",nd))(),rd=(()=>((rd=rd||{})[rd.Short=0]="Short",rd[rd.Medium=1]="Medium",rd[rd.Long=2]="Long",rd[rd.Full=3]="Full",rd))(),id=(()=>((id=id||{})[id.Decimal=0]="Decimal",id[id.Group=1]="Group",id[id.List=2]="List",id[id.PercentSign=3]="PercentSign",id[id.PlusSign=4]="PlusSign",id[id.MinusSign=5]="MinusSign",id[id.Exponential=6]="Exponential",id[id.SuperscriptingExponent=7]="SuperscriptingExponent",id[id.PerMille=8]="PerMille",id[id.Infinity=9]="Infinity",id[id.NaN=10]="NaN",id[id.TimeSeparator=11]="TimeSeparator",id[id.CurrencyDecimal=12]="CurrencyDecimal",id[id.CurrencyGroup=13]="CurrencyGroup",id))();function sd(e,t){return hd(Ga(e)[ja.DateFormat],t)}function od(e,t){return hd(Ga(e)[ja.TimeFormat],t)}function ad(e,t){return hd(Ga(e)[ja.DateTimeFormat],t)}function cd(e,t){const n=Ga(e),r=n[ja.NumberSymbols][t];if(void 0===r){if(t===id.CurrencyDecimal)return n[ja.NumberSymbols][id.Decimal];if(t===id.CurrencyGroup)return n[ja.NumberSymbols][id.Group]}return r}const ld=qa;function ud(e){if(!e[ja.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[ja.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function hd(e,t){for(let n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function dd(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const fd=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,pd={},gd=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var md=(()=>((md=md||{})[md.Short=0]="Short",md[md.ShortGMT=1]="ShortGMT",md[md.Long=2]="Long",md[md.Extended=3]="Extended",md))(),yd=(()=>((yd=yd||{})[yd.FullYear=0]="FullYear",yd[yd.Month=1]="Month",yd[yd.Date=2]="Date",yd[yd.Hours=3]="Hours",yd[yd.Minutes=4]="Minutes",yd[yd.Seconds=5]="Seconds",yd[yd.FractionalSeconds=6]="FractionalSeconds",yd[yd.Day=7]="Day",yd))(),vd=(()=>((vd=vd||{})[vd.DayPeriods=0]="DayPeriods",vd[vd.Days=1]="Days",vd[vd.Months=2]="Months",vd[vd.Eras=3]="Eras",vd))();function _d(e,t,n,r){let i=function(e){if(Md(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[t,n=1,r=1]=e.split("-").map(e=>+e);return Cd(t,n-1,r)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let n;if(n=e.match(fd))return function(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,s=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const o=Number(e[4]||0)-n,a=Number(e[5]||0)-r,c=Number(e[6]||0),l=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return s.call(t,o,a,c,l),t}(n)}const t=new Date(e);if(!Md(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=Ed(n,t)||t;let s,o=[];for(;t;){if(s=gd.exec(t),!s){o.push(t);break}{o=o.concat(s.slice(1));const e=o.pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();r&&(a=Nd(r,a),i=function(e,t,n){const r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(Nd(t,r)-r))}(i,r));let c="";return o.forEach(e=>{const t=function(e){if(Ad[e])return Ad[e];let t;switch(e){case"G":case"GG":case"GGG":t=Pd(vd.Eras,nd.Abbreviated);break;case"GGGG":t=Pd(vd.Eras,nd.Wide);break;case"GGGGG":t=Pd(vd.Eras,nd.Narrow);break;case"y":t=Sd(yd.FullYear,1,0,!1,!0);break;case"yy":t=Sd(yd.FullYear,2,0,!0,!0);break;case"yyy":t=Sd(yd.FullYear,3,0,!1,!0);break;case"yyyy":t=Sd(yd.FullYear,4,0,!1,!0);break;case"Y":t=kd(1);break;case"YY":t=kd(2,!0);break;case"YYY":t=kd(3);break;case"YYYY":t=kd(4);break;case"M":case"L":t=Sd(yd.Month,1,1);break;case"MM":case"LL":t=Sd(yd.Month,2,1);break;case"MMM":t=Pd(vd.Months,nd.Abbreviated);break;case"MMMM":t=Pd(vd.Months,nd.Wide);break;case"MMMMM":t=Pd(vd.Months,nd.Narrow);break;case"LLL":t=Pd(vd.Months,nd.Abbreviated,td.Standalone);break;case"LLLL":t=Pd(vd.Months,nd.Wide,td.Standalone);break;case"LLLLL":t=Pd(vd.Months,nd.Narrow,td.Standalone);break;case"w":t=Id(1);break;case"ww":t=Id(2);break;case"W":t=Id(1,!0);break;case"d":t=Sd(yd.Date,1);break;case"dd":t=Sd(yd.Date,2);break;case"c":case"cc":t=Sd(yd.Day,1);break;case"ccc":t=Pd(vd.Days,nd.Abbreviated,td.Standalone);break;case"cccc":t=Pd(vd.Days,nd.Wide,td.Standalone);break;case"ccccc":t=Pd(vd.Days,nd.Narrow,td.Standalone);break;case"cccccc":t=Pd(vd.Days,nd.Short,td.Standalone);break;case"E":case"EE":case"EEE":t=Pd(vd.Days,nd.Abbreviated);break;case"EEEE":t=Pd(vd.Days,nd.Wide);break;case"EEEEE":t=Pd(vd.Days,nd.Narrow);break;case"EEEEEE":t=Pd(vd.Days,nd.Short);break;case"a":case"aa":case"aaa":t=Pd(vd.DayPeriods,nd.Abbreviated);break;case"aaaa":t=Pd(vd.DayPeriods,nd.Wide);break;case"aaaaa":t=Pd(vd.DayPeriods,nd.Narrow);break;case"b":case"bb":case"bbb":t=Pd(vd.DayPeriods,nd.Abbreviated,td.Standalone,!0);break;case"bbbb":t=Pd(vd.DayPeriods,nd.Wide,td.Standalone,!0);break;case"bbbbb":t=Pd(vd.DayPeriods,nd.Narrow,td.Standalone,!0);break;case"B":case"BB":case"BBB":t=Pd(vd.DayPeriods,nd.Abbreviated,td.Format,!0);break;case"BBBB":t=Pd(vd.DayPeriods,nd.Wide,td.Format,!0);break;case"BBBBB":t=Pd(vd.DayPeriods,nd.Narrow,td.Format,!0);break;case"h":t=Sd(yd.Hours,1,-12);break;case"hh":t=Sd(yd.Hours,2,-12);break;case"H":t=Sd(yd.Hours,1);break;case"HH":t=Sd(yd.Hours,2);break;case"m":t=Sd(yd.Minutes,1);break;case"mm":t=Sd(yd.Minutes,2);break;case"s":t=Sd(yd.Seconds,1);break;case"ss":t=Sd(yd.Seconds,2);break;case"S":t=Sd(yd.FractionalSeconds,1);break;case"SS":t=Sd(yd.FractionalSeconds,2);break;case"SSS":t=Sd(yd.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Od(md.Short);break;case"ZZZZZ":t=Od(md.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Od(md.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Od(md.Long);break;default:return null}return Ad[e]=t,t}(e);c+=t?t(i,n,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function Cd(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function Ed(e,t){const n=function(e){return Ga(e)[ja.LocaleId]}(e);if(pd[n]=pd[n]||{},pd[n][t])return pd[n][t];let r="";switch(t){case"shortDate":r=sd(e,rd.Short);break;case"mediumDate":r=sd(e,rd.Medium);break;case"longDate":r=sd(e,rd.Long);break;case"fullDate":r=sd(e,rd.Full);break;case"shortTime":r=od(e,rd.Short);break;case"mediumTime":r=od(e,rd.Medium);break;case"longTime":r=od(e,rd.Long);break;case"fullTime":r=od(e,rd.Full);break;case"short":const t=Ed(e,"shortTime"),n=Ed(e,"shortDate");r=wd(ad(e,rd.Short),[t,n]);break;case"medium":const i=Ed(e,"mediumTime"),s=Ed(e,"mediumDate");r=wd(ad(e,rd.Medium),[i,s]);break;case"long":const o=Ed(e,"longTime"),a=Ed(e,"longDate");r=wd(ad(e,rd.Long),[o,a]);break;case"full":const c=Ed(e,"fullTime"),l=Ed(e,"fullDate");r=wd(ad(e,rd.Full),[c,l])}return r&&(pd[n][t]=r),r}function wd(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function bd(e,t,n="-",r,i){let s="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,s=n));let o=String(e);for(;o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),s+o}function Sd(e,t,n=0,r=!1,i=!1){return function(s,o){let a=function(e,t){switch(e){case yd.FullYear:return t.getFullYear();case yd.Month:return t.getMonth();case yd.Date:return t.getDate();case yd.Hours:return t.getHours();case yd.Minutes:return t.getMinutes();case yd.Seconds:return t.getSeconds();case yd.FractionalSeconds:return t.getMilliseconds();case yd.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,s);if((n>0||a>-n)&&(a+=n),e===yd.Hours)0===a&&-12===n&&(a=12);else if(e===yd.FractionalSeconds)return function(e,t){return bd(e,3).substr(0,t)}(a,t);const c=cd(o,id.MinusSign);return bd(a,t,c,r,i)}}function Pd(e,t,n=td.Format,r=!1){return function(i,s){return function(e,t,n,r,i,s){switch(n){case vd.Months:return function(e,t,n){const r=Ga(e),i=hd([r[ja.MonthsFormat],r[ja.MonthsStandalone]],t);return hd(i,n)}(t,i,r)[e.getMonth()];case vd.Days:return function(e,t,n){const r=Ga(e),i=hd([r[ja.DaysFormat],r[ja.DaysStandalone]],t);return hd(i,n)}(t,i,r)[e.getDay()];case vd.DayPeriods:const o=e.getHours(),a=e.getMinutes();if(s){const e=function(e){const t=Ga(e);return ud(t),(t[ja.ExtraData][2]||[]).map(e=>"string"==typeof e?dd(e):[dd(e[0]),dd(e[1])])}(t),n=function(e,t,n){const r=Ga(e);ud(r);const i=hd([r[ja.ExtraData][0],r[ja.ExtraData][1]],t)||[];return hd(i,n)||[]}(t,i,r),s=e.findIndex(e=>{if(Array.isArray(e)){const[t,n]=e,r=o>=t.hours&&a>=t.minutes,i=o<n.hours||o===n.hours&&a<n.minutes;if(t.hours<n.hours){if(r&&i)return!0}else if(r||i)return!0}else if(e.hours===o&&e.minutes===a)return!0;return!1});if(-1!==s)return n[s]}return function(e,t,n){const r=Ga(e),i=hd([r[ja.DayPeriodsFormat],r[ja.DayPeriodsStandalone]],t);return hd(i,n)}(t,i,r)[o<12?0:1];case vd.Eras:return function(e,t){return hd(Ga(e)[ja.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,s,e,t,n,r)}}function Od(e){return function(t,n,r){const i=-1*r,s=cd(n,id.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case md.Short:return(i>=0?"+":"")+bd(o,2,s)+bd(Math.abs(i%60),2,s);case md.ShortGMT:return"GMT"+(i>=0?"+":"")+bd(o,1,s);case md.Long:return"GMT"+(i>=0?"+":"")+bd(o,2,s)+":"+bd(Math.abs(i%60),2,s);case md.Extended:return 0===r?"Z":(i>=0?"+":"")+bd(o,2,s)+":"+bd(Math.abs(i%60),2,s);default:throw new Error(`Unknown zone width "${e}"`)}}}function Td(e){return Cd(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function Id(e,t=!1){return function(n,r){let i;if(t){const e=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,t=n.getDate();i=1+Math.floor((t+e)/7)}else{const e=Td(n),t=function(e){const t=Cd(e,0,1).getDay();return Cd(e,0,1+(t<=4?4:11)-t)}(e.getFullYear()),r=e.getTime()-t.getTime();i=1+Math.round(r/6048e5)}return bd(i,e,cd(r,id.MinusSign))}}function kd(e,t=!1){return function(n,r){return bd(Td(n).getFullYear(),e,cd(r,id.MinusSign),t)}}const Ad={};function Nd(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function Md(e){return e instanceof Date&&!isNaN(e.valueOf())}const xd=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Rd(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class Dd{}let Ld=(()=>{class e extends Dd{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(ld(t||this.locale)(e)){case ed.Zero:return"zero";case ed.One:return"one";case ed.Two:return"two";case ed.Few:return"few";case ed.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Or(qu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Fd(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let Bd=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Jo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${de(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(la(Ol),la(Il),la(al),la(ul))},e.\u0275dir=st({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class Vd{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ud=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch{throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new Vd(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new $d(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new $d(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(la(ql),la(Bl),la(Ol))},e.\u0275dir=st({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class $d{constructor(e,t){this.record=e,this.view=t}}let zd=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new Hd,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Gd("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Gd("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(la(ql),la(Bl))},e.\u0275dir=st({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class Hd{constructor(){this.$implicit=null,this.ngIf=null}}function Gd(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${de(t)}'.`)}function qd(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${de(e)}'`)}let Wd=(()=>{class e{constructor(e){this.locale=e}transform(t,n="mediumDate",r,i){if(null==t||""===t||t!=t)return null;try{return _d(t,n,i||this.locale,r)}catch(s){throw qd(e,s.message)}}}return e.\u0275fac=function(t){return new(t||e)(la(qu,16))},e.\u0275pipe=ot({name:"date",type:e,pure:!0}),e})(),jd=(()=>{class e{constructor(e){this._locale=e}transform(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,s,o=!1){let a="",c=!1;if(isFinite(e)){let l=function(e){let t,n,r,i,s,o=Math.abs(e)+"",a=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(s=o.length))t=[0],n=1;else{for(s--;"0"===o.charAt(s);)s--;for(n-=r,t=[],i=0;r<=s;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),a=n-1,n=1),{digits:t,exponent:a,integerLen:n}}(e);o&&(l=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(l));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(s){const e=s.match(xd);if(null===e)throw new Error(`${s} is not a valid digit info`);const t=e[1],n=e[3],r=e[5];null!=t&&(u=Rd(t)),null!=n&&(h=Rd(n)),null!=r?d=Rd(r):null!=n&&h>d&&(d=h)}!function(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let o=s+e.integerLen,a=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(let e=o;e<r.length;e++)r[e]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let e=1;e<o;e++)r[e]=0}if(a>=5)if(o-1<0){for(let t=0;t>o;t--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let c=0!==s;const l=t+e.integerLen,u=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,c&&(0===r[n]&&n>=l?r.pop():c=!1),t>=10?1:0},0);u&&(r.unshift(u),e.integerLen++)}(l,h,d);let f=l.digits,p=l.integerLen;const g=l.exponent;let m=[];for(c=f.every(e=>!e);p<u;p++)f.unshift(0);for(;p<0;p++)f.unshift(0);p>0?m=f.splice(p,f.length):(m=f,f=[0]);const y=[];for(f.length>=t.lgSize&&y.unshift(f.splice(-t.lgSize,f.length).join(""));f.length>t.gSize;)y.unshift(f.splice(-t.gSize,f.length).join(""));f.length&&y.unshift(f.join("")),a=y.join(cd(n,r)),m.length&&(a+=cd(n,i)+m.join("")),g&&(a+=cd(n,id.Exponential)+"+"+g)}else a=cd(n,id.Infinity);return a=e<0&&!c?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf,a}(e,function(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=o[0],c=o[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<c.length;u++){const e=c.charAt(u);"0"===e?n.minFrac=n.maxFrac=u+1:"#"===e?n.maxFrac=u+1:n.posSuf+=e}const l=a.split(",");if(n.gSize=l[1]?l[1].length:0,n.lgSize=l[2]||l[1]?(l[2]||l[1]).length:0,s){const e=i.length-n.posPre.length-n.posSuf.length,t=s.indexOf("#");n.negPre=s.substr(0,t).replace(/'/g,""),n.negSuf=s.substr(t+e).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return Ga(e)[ja.NumberFormats][t]}(t,Xh.Decimal),cd(t,id.MinusSign)),t,id.Group,id.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),r,n)}catch(i){throw qd(e,i.message)}}}return e.\u0275fac=function(t){return new(t||e)(la(qu,16))},e.\u0275pipe=ot({name:"number",type:e,pure:!0}),e})();let Zd=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[{provide:Dd,useClass:Ld}]}),e})();let Yd=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>new Kd(Or(Dh),window)}),e})();class Kd{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Jd(this.window.history)||Jd(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Jd(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Qd{}class Xd extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new Xd,xh||(xh=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(tf=tf||document.querySelector("base"),tf?tf.getAttribute("href"):null);return null==t?null:function(e){ef=ef||document.createElement("a"),ef.setAttribute("href",e);const t=ef.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){tf=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Fd(document.cookie,e)}}let ef,tf=null;const nf=new or("TRANSITION_ID"),rf=[{provide:Lu,useFactory:function(e,t,n){return()=>{n.get(Fu).donePromise.then(()=>{const n=Rh(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let e=0;e<r.length;e++)n.remove(r[e])})}},deps:[nf,Dh,$o],multi:!0}];class sf{static init(){var e;e=new sf,fh=e}addToWindow(e){ze.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),ze.getAllAngularRootElements=()=>e.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(e=>{const t=ze.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){return null==t?null:e.getTestability(t)??(n?Rh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}let of=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const af=new or("EventManagerPlugins");let cf=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Or(af),Or(rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class lf{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=Rh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let uf=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),hf=(()=>{class e extends uf{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(df),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(df))}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function df(e){Rh().remove(e)}const ff={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},pf=/%COMP%/g;function gf(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?gf(e,i,n):(i=i.replace(pf,e),n.push(i))}return n}function mf(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let yf=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new vf(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Be.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new _f(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Be.ShadowDom:return new Cf(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=gf(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Or(cf),Or(hf),Or(Bu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class vf{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(ff[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=ff[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=ff[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(Ni.DashCase|Ni.Important)?e.style.setProperty(t,n,r&Ni.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Ni.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,mf(n)):this.eventManager.addEventListener(e,t,mf(n))}}class _f extends vf{constructor(e,t,n,r){super(e),this.component=n;const i=gf(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(pf,r+"-"+n.id),this.hostAttr=function(e){return"_nghost-%COMP%".replace(pf,e)}(r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class Cf extends vf{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=gf(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Ef=(()=>{class e extends lf{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const wf=["alt","control","meta","shift"],bf={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Sf={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Pf={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Of=(()=>{class e extends lf{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rh().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(wf.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Sf.hasOwnProperty(t)&&(t=Sf[t]))}return bf[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),wf.forEach(r=>{r!=n&&Pf[r](e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Tf=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return Or(If)},token:e,providedIn:"root"}),e})(),If=(()=>{class e extends Tf{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case yi.NONE:return t;case yi.HTML:return qr(t,"HTML")?Gr(t):gi(this._doc,String(t)).toString();case yi.STYLE:return qr(t,"Style")?Gr(t):t;case yi.SCRIPT:if(qr(t,"Script"))return Gr(t);throw new Error("unsafe value used in a script context");case yi.URL:return Wr(t),qr(t,"URL")?Gr(t):Qr(String(t));case yi.RESOURCE_URL:if(qr(t,"ResourceURL"))return Gr(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(e){return new Vr(e)}(e)}bypassSecurityTrustStyle(e){return function(e){return new Ur(e)}(e)}bypassSecurityTrustScript(e){return function(e){return new $r(e)}(e)}bypassSecurityTrustUrl(e){return function(e){return new zr(e)}(e)}bypassSecurityTrustResourceUrl(e){return function(e){return new Hr(e)}(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh))},e.\u0275prov=be({factory:function(){return function(e){return new If(e.get(Dh))}(Or(Oo))},token:e,providedIn:"root"}),e})();const kf=_h(Ah,"browser",[{provide:zu,useValue:"browser"},{provide:$u,useValue:function(){Xd.makeCurrent(),sf.init()},multi:!0},{provide:Dh,useFactory:function(){return e=document,Pt=e,document;var e},deps:[]}]),Af=[[],{provide:Io,useValue:"root"},{provide:Oi,useFactory:function(){return new Oi},deps:[]},{provide:af,useClass:Ef,multi:!0,deps:[Dh,rh,zu]},{provide:af,useClass:Of,multi:!0,deps:[Dh]},[],{provide:yf,useClass:yf,deps:[cf,hf,Bu]},{provide:ll,useExisting:yf},{provide:uf,useExisting:hf},{provide:hf,useClass:hf,deps:[Dh]},{provide:uh,useClass:uh,deps:[rh]},{provide:cf,useClass:cf,deps:[af,rh]},{provide:Qd,useClass:of,deps:[]},[]];let Nf=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:Bu,useValue:t.appId},{provide:nf,useExisting:Bu},rf]}}}return e.\u0275fac=function(t){return new(t||e)(Or(e,12))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:Af,imports:[Zd,Mh]}),e})();"undefined"!=typeof window&&window;const{isArray:Mf}=Array,{getPrototypeOf:xf,prototype:Rf,keys:Df}=Object;function Lf(e){if(1===e.length){const t=e[0];if(Mf(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&xf(e)===Rf}(t)){const e=Df(t);return{args:e.map(e=>t[e]),keys:e}}}return{args:e,keys:null}}const{isArray:Ff}=Array;function Bf(e){return D(t=>function(e,t){return Ff(t)?e(...t):e(t)}(e,t))}function Vf(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}let Uf=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(la(ul),la(al))},e.\u0275dir=st({type:e}),e})(),$f=(()=>{class e extends Uf{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Ho]}),e})();const zf=new or("NgValueAccessor"),Hf={provide:zf,useExisting:ge(()=>qf),multi:!0},Gf=new or("CompositionEventMode");let qf=(()=>{class e extends Uf{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=Rh()?Rh().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(la(ul),la(al),la(Gf,8))},e.\u0275dir=st({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&Ca("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[Xc([Hf]),Ho]}),e})();function Wf(e){return null==e||0===e.length}function jf(e){return null!=e&&"number"==typeof e.length}const Zf=new or("NgValidators"),Yf=new or("NgAsyncValidators"),Kf=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Jf{static min(e){return function(e){return t=>{if(Wf(t.value)||Wf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(e)}static max(e){return function(e){return t=>{if(Wf(t.value)||Wf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(e)}static required(e){return Qf(e)}static requiredTrue(e){return function(e){return!0===e.value?null:{required:!0}}(e)}static email(e){return function(e){return Wf(e.value)||Kf.test(e.value)?null:{email:!0}}(e)}static minLength(e){return function(e){return t=>Wf(t.value)||!jf(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(e)}static maxLength(e){return Xf(e)}static pattern(e){return function(e){if(!e)return ep;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(Wf(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return op(e)}static composeAsync(e){return cp(e)}}function Qf(e){return Wf(e.value)?{required:!0}:null}function Xf(e){return t=>jf(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function ep(e){return null}function tp(e){return null!=e}function np(e){const t=va(e)?ae(e):e;return _a(t),t}function rp(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function ip(e,t){return t.map(t=>t(e))}function sp(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function op(e){if(!e)return null;const t=e.filter(tp);return 0==t.length?null:function(e){return rp(ip(e,t))}}function ap(e){return null!=e?op(sp(e)):null}function cp(e){if(!e)return null;const t=e.filter(tp);return 0==t.length?null:function(e){return function(...e){const t=ne(e),{args:n,keys:r}=Lf(e),i=new T(e=>{const{length:t}=n;if(!t)return void e.complete();const i=new Array(t);let s=t,o=t;for(let a=0;a<t;a++){let t=!1;Y(n[a]).subscribe(new R(e,e=>{t||(t=!0,o--),i[a]=e},()=>s--,void 0,()=>{(!s||!t)&&(o||e.next(r?Vf(r,i):i),e.complete())}))}});return t?i.pipe(Bf(t)):i}(ip(e,t).map(np)).pipe(D(rp))}}function lp(e){return null!=e?cp(sp(e)):null}function up(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function hp(e){return e._rawValidators}function dp(e){return e._rawAsyncValidators}function fp(e){return e?Array.isArray(e)?e:[e]:[]}function pp(e,t){return Array.isArray(e)?e.includes(t):e===t}function gp(e,t){const n=fp(t);return fp(e).forEach(e=>{pp(n,e)||n.push(e)}),n}function mp(e,t){return fp(t).filter(t=>!pp(e,t))}let yp=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=ap(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=lp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e}),e})(),vp=(()=>{class e extends yp{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Ho]}),e})();class _p extends yp{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Cp{constructor(e){this._cd=e}is(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}let Ep=(()=>{class e extends Cp{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(la(_p,2))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Aa("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[Ho]}),e})(),wp=(()=>{class e extends Cp{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(la(vp,10))},e.\u0275dir=st({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&Aa("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[Ho]}),e})();function bp(e,t){return[...t.path,e]}function Sp(e,t){Tp(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&kp(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&kp(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Pp(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),Ip(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Op(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Tp(e,t){const n=hp(e);null!==t.validator?e.setValidators(up(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=dp(e);null!==t.asyncValidator?e.setAsyncValidators(up(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();Op(t._rawValidators,i),Op(t._rawAsyncValidators,i)}function Ip(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=hp(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=dp(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return Op(t._rawValidators,r),Op(t._rawAsyncValidators,r),n}function kp(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Ap(e,t){Tp(e,t)}function Np(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function Mp(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function xp(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===qf?n=e:function(e){return Object.getPrototypeOf(e.constructor)===$f}(e)?r=e:i=e}),i||r||n||null}function Rp(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Dp="VALID",Lp="INVALID",Fp="PENDING",Bp="DISABLED";function Vp(e){return(Hp(e)?e.validators:e)||null}function Up(e){return Array.isArray(e)?ap(e):e||null}function $p(e,t){return(Hp(t)?t.asyncValidators:e)||null}function zp(e){return Array.isArray(e)?lp(e):e||null}function Hp(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class Gp{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Up(this._rawValidators),this._composedAsyncValidatorFn=zp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Dp}get invalid(){return this.status===Lp}get pending(){return this.status==Fp}get disabled(){return this.status===Bp}get enabled(){return this.status!==Bp}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Up(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=zp(e)}addValidators(e){this.setValidators(gp(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(gp(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(mp(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(mp(e,this._rawAsyncValidators))}hasValidator(e){return pp(this._rawValidators,e)}hasAsyncValidator(e){return pp(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Fp,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Bp,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Dp,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Dp||this.status===Fp)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Bp:Dp}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Fp,this._hasOwnPendingAsyncValidator=!0;const t=np(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;let r=e;return t.forEach(e=>{r=r instanceof Wp?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof jp&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new _u,this.statusChanges=new _u}_calculateStatus(){return this._allControlsDisabled()?Bp:this.errors?Lp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Fp)?Fp:this._anyControlsHaveStatus(Lp)?Lp:Dp}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Hp(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class qp extends Gp{constructor(e=null,t,n){super(Vp(t),$p(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Rp(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Rp(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Wp extends Gp{constructor(e,t,n){super(Vp(t),$p(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof qp?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class jp extends Gp{constructor(e,t,n){super(Vp(t),$p(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof qp?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const Zp={provide:vp,useExisting:ge(()=>Kp)},Yp=(()=>Promise.resolve(null))();let Kp=(()=>{class e extends vp{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new _u,this.form=new Wp({},ap(e),lp(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Yp.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Sp(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Yp.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),Rp(this._directives,e)})}addFormGroup(e){Yp.then(()=>{const t=this._findContainer(e.path),n=new Wp({});Ap(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Yp.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){Yp.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,Mp(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(la(Zf,10),la(Yf,10))},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&Ca("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Xc([Zp]),Ho]}),e})();const Jp={provide:_p,useExisting:ge(()=>Xp)},Qp=(()=>Promise.resolve(null))();let Xp=(()=>{class e extends _p{constructor(e,t,n,r){super(),this.control=new qp,this._registered=!1,this.update=new _u,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=xp(0,r)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),Np(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?bp(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Sp(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){Qp.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,n=""===t||t&&"false"!==t;Qp.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(la(vp,9),la(Zf,10),la(Yf,10),la(zf,10))},e.\u0275dir=st({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Xc([Jp]),Ho,vt]}),e})(),eg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),tg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();const ng={provide:zf,useExisting:ge(()=>rg),multi:!0};let rg=(()=>{class e extends $f{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=t=>{e(""==t?null:parseFloat(t))}}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&Ca("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[Xc([ng]),Ho]}),e})();const ig=new or("NgModelWithFormControlWarning"),sg={provide:vp,useExisting:ge(()=>og)};let og=(()=>{class e extends vp{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new _u,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ip(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Sp(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){Pp(e.control||null,e,!1),Rp(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,Mp(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(Pp(t||null,e),n instanceof qp&&(Sp(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);Ap(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return Ip(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Tp(this.form,this),this._oldForm&&Ip(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(la(Zf,10),la(Yf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&Ca("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Xc([sg]),Ho,vt]}),e})();const ag={provide:_p,useExisting:ge(()=>cg)};let cg=(()=>{class e extends _p{constructor(e,t,n,r,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new _u,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=xp(0,r)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),Np(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return bp(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(la(vp,13),la(Zf,10),la(Yf,10),la(zf,10),la(ig,8))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Xc([ag]),Ho,vt]}),e._ngModelWarningSentOnce=!1,e})();const lg={provide:zf,useExisting:ge(()=>hg),multi:!0};function ug(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let hg=(()=>{class e extends $f{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const n=ug(t,e);this.setProperty("value",n)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&Ca("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Xc([lg]),Ho]}),e})(),dg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(ug(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(la(al),la(ul),la(hg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const fg={provide:zf,useExisting:ge(()=>gg),multi:!0};function pg(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let gg=(()=>{class e extends $f{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const n=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(n.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const n=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const r=e.item(t),i=this._getOptionValue(r.value);n.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const r=e.item(t);if(r.selected){const e=this._getOptionValue(r.value);n.push(e)}}}this.value=n,e(n)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&Ca("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Xc([fg]),Ho]}),e})(),mg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(pg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(pg(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(la(al),la(ul),la(gg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const yg={provide:Zf,useExisting:ge(()=>vg),multi:!0};let vg=(()=>{class e{constructor(){this._required=!1}get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!=`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?Qf(e):null}registerOnValidatorChange(e){this._onChange=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&ra("required",t.required?"":null)},inputs:{required:"required"},features:[Xc([yg])]}),e})();const _g={provide:Zf,useExisting:ge(()=>Cg),multi:!0};let Cg=(()=>{class e{constructor(){this._validator=ep}ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this.enabled()?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=this.enabled()?Xf(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):ep}enabled(){return null!=this.maxlength}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&ra("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Xc([_g]),vt]}),e})(),Eg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[[tg]]}),e})(),wg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[Eg]}),e})(),bg=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:ig,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[Eg]}),e})(),Sg=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,s=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,s=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,s=null!=t.asyncValidator?t.asyncValidator:null)),new Wp(n,{asyncValidators:s,updateOn:r,validators:i})}control(e,t,n){return new qp(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new jp(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof qp||e instanceof Wp||e instanceof jp?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return new e},token:e,providedIn:bg}),e})();function Pg(...e){return ae(e,re(e))}function Og(e,t){return r(t)?Q(e,t,1):Q(e,1)}function Tg(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>e.call(t,n,i++)&&r.next(n)))})}class Ig{}class kg{}class Ag{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Ag?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Ag;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Ag?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Ng{encodeKey(e){return Rg(e)}encodeValue(e){return Rg(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const Mg=/%(\d[a-f0-9])/gi,xg={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Rg(e){return encodeURIComponent(e).replace(Mg,(e,t)=>{var n;return null!==(n=xg[t])&&void 0!==n?n:e})}function Dg(e){return`${e}`}class Lg{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Ng,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Lg({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Dg(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(Dg(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Fg{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Bg(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Vg(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Ug(e){return"undefined"!=typeof FormData&&e instanceof FormData}class $g{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ag),this.context||(this.context=new Fg),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new Lg,this.urlWithParams=t}serializeBody(){return null===this.body?null:Bg(this.body)||Vg(this.body)||Ug(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Lg?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ug(this.body)?null:Vg(this.body)?this.body.type||null:Bg(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Lg?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let c=e.headers||this.headers,l=e.params||this.params;const u=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(c=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),c)),e.setParams&&(l=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),l)),new $g(n,r,s,{params:l,headers:c,context:u,reportProgress:a,responseType:i,withCredentials:o})}}var zg=(()=>((zg=zg||{})[zg.Sent=0]="Sent",zg[zg.UploadProgress=1]="UploadProgress",zg[zg.ResponseHeader=2]="ResponseHeader",zg[zg.DownloadProgress=3]="DownloadProgress",zg[zg.Response=4]="Response",zg[zg.User=5]="User",zg))();class Hg{constructor(e,t=200,n="OK"){this.headers=e.headers||new Ag,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Gg extends Hg{constructor(e={}){super(e),this.type=zg.ResponseHeader}clone(e={}){return new Gg({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class qg extends Hg{constructor(e={}){super(e),this.type=zg.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new qg({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Wg extends Hg{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function jg(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let Zg=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof $g)r=e;else{let i,s;i=n.headers instanceof Ag?n.headers:new Ag(n.headers),n.params&&(s=n.params instanceof Lg?n.params:new Lg({fromObject:n.params})),r=new $g(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=Pg(r).pipe(Og(e=>this.handler.handle(e)));if(e instanceof $g||"events"===n.observe)return i;const s=i.pipe(Tg(e=>e instanceof qg));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(D(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(D(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Lg).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,jg(n,t))}post(e,t,n={}){return this.request("POST",e,jg(n,t))}put(e,t,n={}){return this.request("PUT",e,jg(n,t))}}return e.\u0275fac=function(t){return new(t||e)(Or(Ig))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class Yg{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const Kg=new or("HTTP_INTERCEPTORS");let Jg=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Qg=/^\)\]\}',?\n/;let Xg=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new T(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new Ag(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new Gg({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),c=null;204!==i&&(c=void 0===n.response?n.responseText:n.response),0===i&&(i=c?200:0);let l=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof c){const e=c;c=c.replace(Qg,"");try{c=""!==c?JSON.parse(c):null}catch(u){c=e,l&&(l=!1,c={error:u,text:c})}}l?(t.next(new qg({body:c,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new Wg({error:c,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new Wg({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let c=!1;const l=r=>{c||(t.next(s()),c=!0);let i={type:zg.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&!!n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:zg.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",l),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:zg.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",o),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",l),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Or(Qd))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const em=new or("XSRF_COOKIE_NAME"),tm=new or("XSRF_HEADER_NAME");class nm{}let rm=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Fd(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh),Or(zu),Or(em))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),im=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(nm),Or(tm))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),sm=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(Kg,[]);this.chain=e.reduceRight((e,t)=>new Yg(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(kg),Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),om=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:im,useClass:Jg}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:em,useValue:t.cookieName}:[],t.headerName?{provide:tm,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[im,{provide:Kg,useExisting:im,multi:!0},{provide:nm,useClass:rm},{provide:em,useValue:"XSRF-TOKEN"},{provide:tm,useValue:"X-XSRF-TOKEN"}]}),e})(),am=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[Zg,{provide:Ig,useClass:sm},Xg,{provide:kg,useExisting:Xg}],imports:[[om.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class cm extends A{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function lm(e,t,n){e?J(n,e,t):t()}const um=i(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function hm(...e){return X(1)(ae(e,re(e)))}function dm(e){return new T(t=>{Y(e()).subscribe(t)})}function fm(){return x((e,t)=>{let n=null;e._refCount++;const r=new R(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class pm extends T{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,M(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new a;const t=this.getSubject();e.add(this.source.subscribe(new R(t,void 0,()=>{this._teardown(),t.complete()},e=>{this._teardown(),t.error(e)},()=>this._teardown()))),e.closed&&(this._connection=null,e=a.EMPTY)}return e}refCount(){return fm()(this)}}function gm(e,t){return x((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(new R(r,n=>{null==i||i.unsubscribe();let o=0;const c=s++;Y(e(n,c)).subscribe(i=new R(r,e=>r.next(t?t(n,e,c,o++):e),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function mm(e,t,n,r,i){return(s,o)=>{let a=n,c=t,l=0;s.subscribe(new R(o,t=>{const n=l++;c=a?e(c,t,n):(a=!0,t),r&&o.next(c)},i&&(()=>{a&&o.next(c),o.complete()})))}}function ym(e,t){return x(mm(e,t,arguments.length>=2,!0))}function vm(e){return x((t,n)=>{let r,i=null,s=!1;i=t.subscribe(new R(n,void 0,void 0,o=>{r=Y(e(o,vm(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}function _m(e){return e<=0?()=>ee:x((t,n)=>{let r=[];t.subscribe(new R(n,t=>{r.push(t),e<r.length&&r.shift()},()=>{for(const e of r)n.next(e);n.complete()},void 0,()=>{r=null}))})}function Cm(e=Em){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>r?n.complete():n.error(e())))})}function Em(){return new um}function wm(e){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>{r||n.next(e),n.complete()}))})}function bm(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Tg((t,n)=>e(t,n,r)):O,ce(1),n?wm(t):Cm(()=>new um))}function Sm(e,t,n){const i=r(e)||t||n?{next:e,error:t,complete:n}:e;return i?x((e,t)=>{var n;null===(n=i.subscribe)||void 0===n||n.call(i);let r=!0;e.subscribe(new R(t,e=>{var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},()=>{var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},e=>{var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},()=>{var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):O}class Pm{constructor(e,t){this.id=e,this.url=t}}class Om extends Pm{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Tm extends Pm{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Im extends Pm{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class km extends Pm{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Am extends Pm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Nm extends Pm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mm extends Pm{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class xm extends Pm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Rm extends Pm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Dm{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Lm{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Fm{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bm{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vm{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Um{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $m{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const zm="primary";class Hm{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Gm(e){return new Hm(e)}const qm="ngNavigationCancelingError";function Wm(e){const t=Error("NavigationCancelingError: "+e);return t[qm]=!0,t}function jm(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Zm(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!Ym(e[i],t[i]))return!1;return!0}function Ym(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function Km(e){return Array.prototype.concat.apply([],e)}function Jm(e){return e.length>0?e[e.length-1]:null}function Qm(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Xm(e){return _a(e)?e:va(e)?ae(Promise.resolve(e)):Pg(e)}const ey={exact:function e(t,n,r){if(!ly(t.segments,n.segments)||!sy(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:ry},ty={exact:function(e,t){return Zm(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Ym(e[n],t[n]))},ignored:()=>!0};function ny(e,t,n){return ey[n.paths](e.root,t.root,n.matrixParams)&&ty[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ry(e,t,n){return iy(e,t,t.segments,n)}function iy(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!ly(i,n)||t.hasChildren()||!sy(i,n,r))}if(e.segments.length===n.length){if(!ly(e.segments,n)||!sy(e.segments,n,r))return!1;for(const n in t.children)if(!e.children[n]||!ry(e.children[n],t.children[n],r))return!1;return!0}{const i=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(ly(e.segments,i)&&sy(e.segments,i,r)&&e.children[zm])&&iy(e.children[zm],t,s,r)}}function sy(e,t,n){return t.every((t,r)=>ty[n](e[r].parameters,t.parameters))}class oy{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Gm(this.queryParams)),this._queryParamMap}toString(){return dy.serialize(this)}}class ay{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Qm(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return fy(this)}}class cy{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Gm(this.parameters)),this._parameterMap}toString(){return Cy(this)}}function ly(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class uy{}class hy{parse(e){const t=new Py(e);return new oy(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`${`/${py(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${my(t)}=${my(e)}`).join("&"):`${my(t)}=${my(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const dy=new hy;function fy(e){return e.segments.map(e=>Cy(e)).join("/")}function py(e,t){if(!e.hasChildren())return fy(e);if(t){const t=e.children[zm]?py(e.children[zm],!1):"",n=[];return Qm(e.children,(e,t)=>{t!==zm&&n.push(`${t}:${py(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return Qm(e.children,(e,r)=>{r===zm&&(n=n.concat(t(e,r)))}),Qm(e.children,(e,r)=>{r!==zm&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===zm?[py(e.children[zm],!1)]:[`${n}:${py(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[zm]?`${fy(e)}/${t[0]}`:`${fy(e)}/(${t.join("//")})`}}function gy(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function my(e){return gy(e).replace(/%3B/gi,";")}function yy(e){return gy(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function vy(e){return decodeURIComponent(e)}function _y(e){return vy(e.replace(/\+/g,"%20"))}function Cy(e){return`${yy(e.path)}${function(e){return Object.keys(e).map(t=>`;${yy(t)}=${yy(e[t])}`).join("")}(e.parameters)}`}const Ey=/^[^\/()?;=#]+/;function wy(e){const t=e.match(Ey);return t?t[0]:""}const by=/^[^=?&#]+/,Sy=/^[^?&#]+/;class Py{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ay([],{}):new ay([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[zm]=new ay(e,t)),n}parseSegment(){const e=wy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new cy(vy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=wy(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=wy(this.remaining);e&&(n=e,this.capture(n))}e[vy(t)]=vy(n)}parseQueryParam(e){const t=function(e){const t=e.match(by);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Sy);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=_y(t),i=_y(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=wy(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=zm);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s[zm]:new ay([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class Oy{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Ty(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Ty(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Iy(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return Iy(e,this._root).map(e=>e.value)}}function Ty(e,t){if(e===t.value)return t;for(const n of t.children){const t=Ty(e,n);if(t)return t}return null}function Iy(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Iy(e,n);if(r.length)return r.unshift(t),r}return[]}class ky{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Ay(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class Ny extends Oy{constructor(e,t){super(e),this.snapshot=t,Fy(this,e)}toString(){return this.snapshot.toString()}}function My(e,t){const n=function(e,t){const n=new Dy([],{},{},"",{},zm,t,null,e.root,-1,{});return new Ly("",new ky(n,[]))}(e,t),r=new cm([new cy("",{})]),i=new cm({}),s=new cm({}),o=new cm({}),a=new cm(""),c=new xy(r,i,o,a,s,zm,t,n.root);return c.snapshot=n.root,new Ny(new ky(c,[]),n)}class xy{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(D(e=>Gm(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(D(e=>Gm(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ry(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Dy{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=c,this._lastPathIndex=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Gm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Gm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Ly extends Oy{constructor(e,t){super(t),this.url=e,Fy(this,t)}toString(){return By(this._root)}}function Fy(e,t){t.value._routerState=e,t.children.forEach(t=>Fy(e,t))}function By(e){const t=e.children.length>0?` { ${e.children.map(By).join(", ")} } `:"";return`${e.value}${t}`}function Vy(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Zm(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Zm(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Zm(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Zm(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Uy(e,t){return Zm(e.params,t.params)&&function(e,t){return ly(e,t)&&e.every((e,n)=>Zm(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Uy(e.parent,t.parent))}function $y(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return $y(e,t,r);return $y(e,t)})}(e,t,n);return new ky(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return zy(t,e),e}}const n=function(e){return new xy(new cm(e.url),new cm(e.params),new cm(e.queryParams),new cm(e.fragment),new cm(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(t=>$y(e,t));return new ky(n,r)}}function zy(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)zy(e.children[n],t.children[n])}function Hy(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Gy(e){return"object"==typeof e&&null!=e&&e.outlets}function qy(e,t,n,r,i){let s={};return r&&Qm(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new oy(n.root===e?t:Wy(n.root,e,t),s,i)}function Wy(e,t,n){const r={};return Qm(e.children,(e,i)=>{r[i]=e===t?n:Wy(e,t,n)}),new ay(e.segments,r)}class jy{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Hy(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(Gy);if(r&&r!==Jm(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Zy{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Yy(e,t,n){if(e||(e=new ay([],{})),0===e.segments.length&&e.hasChildren())return Ky(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if(Gy(o))break;const a=`${o}`,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&c&&"object"==typeof c&&void 0===c.outlets){if(!ev(a,c,t))return s;r+=2}else{if(!ev(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new ay(e.segments.slice(0,r.pathIndex),{});return t.children[zm]=new ay(e.segments.slice(r.pathIndex),e.children),Ky(t,0,i)}return r.match&&0===i.length?new ay(e.segments,{}):r.match&&!e.hasChildren()?Jy(e,t,n):r.match?Ky(e,0,i):Jy(e,t,n)}function Ky(e,t,n){if(0===n.length)return new ay(e.segments,{});{const r=function(e){return Gy(e[0])?e[0].outlets:{[zm]:e}}(n),i={};return Qm(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=Yy(e.children[r],t,n))}),Qm(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new ay(e.segments,i)}}function Jy(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if(Gy(s)){const e=Qy(s.outlets);return new ay(r,e)}if(0===i&&Hy(n[0])){r.push(new cy(e.segments[t].path,Xy(n[0]))),i++;continue}const o=Gy(s)?s.outlets[zm]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&Hy(a)?(r.push(new cy(o,Xy(a))),i+=2):(r.push(new cy(o,{})),i++)}return new ay(r,{})}function Qy(e){const t={};return Qm(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=Jy(new ay([],{}),0,e))}),t}function Xy(e){const t={};return Qm(e,(e,n)=>t[n]=`${e}`),t}function ev(e,t,n){return e==n.path&&Zm(t,n.parameters)}class tv{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Vy(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=Ay(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Qm(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=Ay(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=Ay(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Um(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Bm(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Vy(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),nv(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function nv(e){Vy(e.value),e.children.forEach(nv)}class rv{constructor(e,t){this.routes=e,this.module=t}}function iv(e){return"function"==typeof e}function sv(e){return e instanceof oy}const ov=Symbol("INITIAL_VALUE");function av(){return gm(e=>function(...e){const t=re(e),n=ne(e),{args:r,keys:i}=Lf(e);if(0===r.length)return ae([],t);const s=new T(function(e,t,n=O){return r=>{lm(t,()=>{const{length:i}=e,s=new Array(i);let o=i,a=i;for(let c=0;c<i;c++)lm(t,()=>{const i=ae(e[c],t);let l=!1;i.subscribe(new R(r,e=>{s[c]=e,l||(l=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,t,i?e=>Vf(i,e):O));return n?s.pipe(Bf(n)):s}(e.map(e=>e.pipe(ce(1),function(...e){const t=re(e);return x((n,r)=>{(t?hm(e,n,t):hm(e,n)).subscribe(r)})}(ov)))).pipe(ym((e,t)=>{let n=!1;return t.reduce((e,r,i)=>e!==ov?e:(r===ov&&(n=!0),n||!1!==r&&i!==t.length-1&&!sv(r)?e:r),e)},ov),Tg(e=>e!==ov),D(e=>sv(e)?e:!0===e),ce(1)))}let cv=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&pa(0,"router-outlet")},directives:function(){return[o_]},encapsulation:2}),e})();function lv(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];uv(r,hv(t,r))}}function uv(e,t){e.children&&lv(e.children,t)}function hv(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function dv(e){const t=e.children&&e.children.map(dv),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==zm&&(n.component=cv),n}function fv(e){return e.outlet||zm}function pv(e,t){const n=e.filter(e=>fv(e)===t);return n.push(...e.filter(e=>fv(e)!==t)),n}const gv={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function mv(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},gv):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||jm)(n,e,t);if(!i)return Object.assign({},gv);const s={};Qm(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function yv(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>vv(e,t,n)&&fv(n)!==zm)}(e,n,r)){const i=new ay(t,function(e,t,n,r){const i={};i[zm]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&fv(s)!==zm){const n=new ay([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[fv(s)]=n}return i}(e,t,r,new ay(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>vv(e,t,n))}(e,n,r)){const s=new ay(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(vv(e,n,a)&&!i[fv(a)]){const n=new ay([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[fv(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new ay(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function vv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function _v(e,t,n,r){return!!(fv(e)===r||r!==zm&&vv(t,n,e))&&("**"===e.path||mv(t,e,n).matched)}function Cv(e,t,n){return 0===t.length&&!e.children[n]}class Ev{constructor(e){this.segmentGroup=e||null}}class wv{constructor(e){this.urlTree=e}}function bv(e){return new T(t=>t.error(new Ev(e)))}function Sv(e){return new T(t=>t.error(new wv(e)))}function Pv(e){return new T(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Ov{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(zl)}apply(){const e=yv(this.urlTree.root,[],[],this.config).segmentGroup,t=new ay(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,zm).pipe(D(e=>this.createUrlTree(Tv(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(vm(e=>{if(e instanceof wv)return this.allowRedirects=!1,this.match(e.urlTree);throw e instanceof Ev?this.noMatchError(e):e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,zm).pipe(D(t=>this.createUrlTree(Tv(t),e.queryParams,e.fragment))).pipe(vm(e=>{throw e instanceof Ev?this.noMatchError(e):e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new ay([],{[zm]:e}):e;return new oy(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(D(e=>new ay([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return ae(r).pipe(Og(r=>{const i=n.children[r],s=pv(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(D(e=>({segment:e,outlet:r})))}),ym((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Tg((t,n)=>e(t,n,r)):O,_m(1),n?wm(t):Cm(()=>new um))}())}expandSegment(e,t,n,r,i,s){return ae(n).pipe(Og(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(vm(e=>{if(e instanceof Ev)return Pg(null);throw e}))),bm(e=>!!e),vm((e,n)=>{if(e instanceof um||"EmptyError"===e.name){if(Cv(t,r,i))return Pg(new ay([],{}));throw new Ev(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return _v(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):bv(t):bv(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Sv(i):this.lineralizeSegments(n,i).pipe(Q(n=>{const i=new ay(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:c,positionalParamSegments:l}=mv(t,r,i);if(!o)return bv(t);const u=this.applyRedirectCommands(a,r.redirectTo,l);return r.redirectTo.startsWith("/")?Sv(u):this.lineralizeSegments(r,u).pipe(Q(r=>this.expandSegment(e,t,n,r.concat(i.slice(c)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?Pg(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(D(e=>(n._loadedConfig=e,new ay(r,{})))):Pg(new ay(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=mv(t,n,r);if(!s)return bv(t);const c=r.slice(a);return this.getChildConfig(e,n,r).pipe(Q(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:l}=yv(t,o,c,s),u=new ay(a.segments,a.children);if(0===l.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(D(e=>new ay(o,e)));if(0===s.length&&0===l.length)return Pg(new ay(o,{}));const h=fv(n)===i;return this.expandSegment(r,u,s,l,h?zm:i,!0).pipe(D(e=>new ay(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?Pg(new rv(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Pg(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Q(n=>{return n?this.configLoader.load(e.injector,t).pipe(D(e=>(t._loadedConfig=e,e))):(r=t,new T(e=>e.error(Wm(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))));var r})):Pg(new rv([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?Pg(r.map(r=>{const i=e.get(r);let s;if((o=i)&&iv(o.canLoad))s=i.canLoad(t,n);else{if(!iv(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}var o;return Xm(s)})).pipe(av(),Sm(e=>{if(!sv(e))return;const t=Wm(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),D(e=>!0===e)):Pg(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Pg(n);if(r.numberOfChildren>1||!r.children[zm])return Pv(e.redirectTo);r=r.children[zm]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new oy(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Qm(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return Qm(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new ay(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Tv(e){const t={};for(const n of Object.keys(e.children)){const r=Tv(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children[zm]){const t=e.children[zm];return new ay(e.segments.concat(t.segments),t.children)}return e}(new ay(e.segments,t))}class Iv{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class kv{constructor(e,t){this.component=e,this.route=t}}function Av(e,t,n){const r=e._root;return Mv(r,t?t._root:null,n,[r.value])}function Nv(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Mv(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ay(t);return e.children.forEach(e=>{(function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!ly(e.url,t.url);case"pathParamsOrQueryParamsChange":return!ly(e.url,t.url)||!Zm(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Uy(e,t)||!Zm(e.queryParams,t.queryParams);case"paramsChange":default:return!Uy(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Iv(r)):(s.data=o.data,s._resolvedData=o._resolvedData),Mv(e,t,s.component?a?a.children:null:n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new kv(a.outlet.component,o))}else o&&xv(t,a,i),i.canActivateChecks.push(new Iv(r)),Mv(e,null,s.component?a?a.children:null:n,r,i)})(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),Qm(s,(e,t)=>xv(e,n.getContext(t),i)),i}function xv(e,t,n){const r=Ay(e),i=e.value;Qm(r,(e,r)=>{xv(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new kv(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class Rv{}function Dv(e){return new T(t=>t.error(e))}class Lv{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=yv(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,zm);if(null===t)return null;const n=new Dy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},zm,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new ky(n,t),i=new Ly(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=Ry(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=pv(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=Bv(n);return r.sort((e,t)=>e.value.outlet===zm?-1:t.value.outlet===zm?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return Cv(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!_v(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?Jm(n).parameters:{};i=new Dy(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$v(e),fv(e),e.component,e,Vv(t),Uv(t)+n.length,zv(e))}else{const r=mv(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new Dy(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$v(e),fv(e),e.component,e,Vv(t),Uv(t)+s.length,zv(e))}const a=(u=e).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:c,slicedSegments:l}=yv(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);var u;if(0===l.length&&c.hasChildren()){const e=this.processChildren(a,c);return null===e?null:[new ky(i,e)]}if(0===a.length&&0===l.length)return[new ky(i,[])];const h=fv(e)===r,d=this.processSegment(a,c,l,h?zm:r);return null===d?null:[new ky(i,d)]}}function Fv(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function Bv(e){const t=[],n=new Set;for(const r of e){if(!Fv(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=Bv(r.children);t.push(new ky(r.value,e))}return t.filter(e=>!n.has(e))}function Vv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Uv(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function $v(e){return e.data||{}}function zv(e){return e.resolve||{}}function Hv(e){return gm(t=>{const n=e(t);return n?ae(n).pipe(D(()=>t)):Pg(t)})}class Gv extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const qv=new or("ROUTES");class Wv{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe(D(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new rv(Km(r.injector.get(qv,void 0,Me.Self|Me.Optional)).map(dv),r)}),vm(e=>{throw t._loader$=void 0,e}));return t._loader$=new pm(n,()=>new A).pipe(fm()),t._loader$}loadModuleFactory(e){return"string"==typeof e?ae(this.loader.load(e)):Xm(e()).pipe(Q(e=>e instanceof Hl?Pg(e):ae(this.compiler.compileModuleAsync(e))))}}class jv{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Zv,this.attachRef=null}}class Zv{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new jv,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Yv{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function Kv(e){throw e}function Jv(e,t,n){return t.parse("/")}function Qv(e,t){return Pg(null)}const Xv={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},e_={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let t_=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=Kv,this.malformedUriErrorHandler=Jv,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Qv,afterPreactivation:Qv},this.urlHandlingStrategy=new Yv,this.routeReuseStrategy=new Gv,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(zl),this.console=i.get(Gu);const c=i.get(rh);this.isNgZoneEnabled=c instanceof rh&&rh.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new oy(new ay([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Wv(s,o,e=>this.triggerEvent(new Dm(e)),e=>this.triggerEvent(new Lm(e))),this.routerState=My(this.currentUrlTree,this.rootComponentType),this.transitions=new cm({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const t=this.events;return e.pipe(Tg(e=>0!==e.id),D(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),gm(e=>{let n=!1,r=!1;return Pg(e).pipe(Sm(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),gm(e=>{const n=this.browserUrlTree.toString(),i=!this.navigated||e.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||i)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return n_(e.source)&&(this.browserUrlTree=e.extractedUrl),Pg(e).pipe(gm(e=>{const n=this.transitions.getValue();return t.next(new Om(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?ee:Promise.resolve(e)}),function(e,t,n,r){return gm(i=>function(e,t,n,r,i){return new Ov(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(D(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Sm(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,i,s){return Q(o=>function(e,t,n,i,s="emptyOnly",o="legacy"){try{const r=new Lv(e,t,n,i,s,o).recognize();return null===r?Dv(new Rv):Pg(r)}catch(r){return Dv(r)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),i,s).pipe(D(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Sm(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new Am(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(i&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new Om(n,this.serializeUrl(r),i,s);t.next(a);const c=My(r,this.rootComponentType).snapshot;return Pg(Object.assign(Object.assign({},e),{targetSnapshot:c,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ee}),Hv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Sm(e=>{const t=new Nm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),D(e=>Object.assign(Object.assign({},e),{guards:Av(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return Q(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?Pg(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ae(e).pipe(Q(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Pg(s.map(s=>{const o=Nv(s,t,i);let a;if(function(e){return e&&iv(e.canDeactivate)}(o))a=Xm(o.canDeactivate(e,t,n,r));else{if(!iv(o))throw new Error("Invalid CanDeactivate guard");a=Xm(o(e,t,n,r))}return a.pipe(bm())})).pipe(av()):Pg(!0)}(e.component,e.route,n,t,r)),bm(e=>!0!==e,!0))}(o,r,i,e).pipe(Q(n=>n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ae(t).pipe(Og(t=>hm(function(e,t){return null!==e&&t&&t(new Fm(e)),Pg(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Vm(e)),Pg(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>dm(()=>Pg(t.guards.map(i=>{const s=Nv(i,t.node,n);let o;if(function(e){return e&&iv(e.canActivateChild)}(s))o=Xm(s.canActivateChild(r,e));else{if(!iv(s))throw new Error("Invalid CanActivateChild guard");o=Xm(s(r,e))}return o.pipe(bm())})).pipe(av())));return Pg(i).pipe(av())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Pg(r.map(r=>dm(()=>{const i=Nv(r,t,n);let s;if(function(e){return e&&iv(e.canActivate)}(i))s=Xm(i.canActivate(t,e));else{if(!iv(i))throw new Error("Invalid CanActivate guard");s=Xm(i(t,e))}return s.pipe(bm())}))).pipe(av()):Pg(!0)}(e,t.route,n))),bm(e=>!0!==e,!0))}(r,s,e,t):Pg(n)),D(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Sm(e=>{if(sv(e.guardsResult)){const t=Wm(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new Mm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Tg(e=>!!e.guardsResult||(this.restoreHistory(e),this.cancelNavigationTransition(e,""),!1)),Hv(e=>{if(e.guards.canActivateChecks.length)return Pg(e).pipe(Sm(e=>{const t=new xm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),gm(e=>{let t=!1;return Pg(e).pipe(function(e,t){return Q(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return Pg(n);let s=0;return ae(i).pipe(Og(n=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return Pg({});const s={};return ae(i).pipe(Q(i=>function(e,t,n,r){const i=Nv(e,t,r);return Xm(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Sm(e=>{s[i]=e}))),_m(1),Q(()=>Object.keys(s).length===i.length?Pg(s):ee))}(e._resolve,e,t,r).pipe(D(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),Ry(e,n).resolve),null)))}(n.route,r,e,t)),Sm(()=>s++),_m(1),Q(e=>s===i.length?Pg(n):ee))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Sm({next:()=>t=!0,complete:()=>{t||(this.restoreHistory(e),this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),Sm(e=>{const t=new Rm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),Hv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),D(e=>{const t=function(e,t,n){const r=$y(e,t._root,n?n._root:void 0);return new Ny(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Sm(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),((e,t,n)=>D(r=>(new tv(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,e=>this.triggerEvent(e)),Sm({next(){n=!0},complete(){n=!0}}),function(e){return x((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var t;if(!n&&!r){const t=`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(e),this.cancelNavigationTransition(e,t)):this.cancelNavigationTransition(e,t)}(null===(t=this.currentNavigation)||void 0===t?void 0:t.id)===e.id&&(this.currentNavigation=null)}),vm(n=>{if(r=!0,function(e){return e&&e[qm]}(n)){const r=sv(n.url);r||(this.navigated=!0,this.restoreHistory(e,!0));const i=new Im(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),r={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||n_(e.source)};this.scheduleNavigation(t,"imperative",null,r,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.restoreHistory(e,!0);const r=new km(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(i){e.reject(i)}}return ee}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){lv(e),this.config=e.map(dv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,c=o?this.currentUrlTree.fragment:i;let l=null;switch(s){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,i){if(0===n.length)return qy(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new jy(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Qm(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new jy(n,t,r)}(n);if(s.toRoot())return qy(t.root,new ay([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new Zy(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new Zy(e,e===t.root,0)}const r=Hy(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Zy(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?Ky(o.segmentGroup,o.index,s.commands):Yy(o.segmentGroup,o.index,s.commands);return qy(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,l,c??null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=sv(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},Xv):!1===t?Object.assign({},e_):t,sv(e))return ny(this.currentUrlTree,e,n);const r=this.parseUrl(e);return ny(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Tm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,t,n,r,i){var s,o;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),c=n_(t)&&a&&!n_(a.source),l=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(c&&l)return Promise.resolve(!0);let u,h,d;i?(u=i.resolve,h=i.reject,d=i.promise):d=new Promise((e,t)=>{u=e,h=t});const f=++this.navigationId;let p;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),p=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(s=this.browserPageId)&&void 0!==s?s:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):p=0,this.setTransition({id:f,targetPageId:p,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}restoreHistory(e,t=!1){var n,r;if("computed"===this.canceledNavigationResolution){const t=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===t?this.currentUrlTree===(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)&&0===t&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(t)}else"replace"===this.canceledNavigationResolution&&(t&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){const n=new Im(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(Or(cr),Or(uy),Or(Zv),Or(Kh),Or($o),Or(Ph),Or(eh),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function n_(e){return"imperative"!==e}let r_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.commands=[],this.onChanges=new A,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}onClick(){const e={skipLocationChange:s_(this.skipLocationChange),replaceUrl:s_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:s_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(la(t_),la(xy),rr("tabindex"),la(ul),la(al))},e.\u0275dir=st({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&Ca("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})(),i_=(()=>{class e{constructor(e,t,n){this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.onChanges=new A,this.subscription=e.events.subscribe(e=>{e instanceof Tm&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;const s={skipLocationChange:s_(this.skipLocationChange),replaceUrl:s_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,s),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:s_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(la(t_),la(xy),la(qh))},e.\u0275dir=st({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&Ca("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(Ua("href",t.href,_i),ra("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})();function s_(e){return""===e||!!e}let o_=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new _u,this.deactivateEvents=new _u,this.name=r||zm,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new a_(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(la(Zv),la(ql),la(rl),rr("name"),la(xl))},e.\u0275dir=st({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class a_{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===xy?this.route:e===Zv?this.childContexts:this.parent.get(e,t)}}class c_{}class l_{preload(e,t){return Pg(null)}}let u_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new Wv(t,n,t=>e.triggerEvent(new Dm(t)),t=>e.triggerEvent(new Lm(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Tg(e=>e instanceof Tm),Og(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(zl);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ae(n).pipe(X(),D(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?Pg(t._loadedConfig):this.loader.load(e.injector,t)).pipe(Q(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Or(t_),Or(Ph),Or(eh),Or($o),Or(c_))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),h_=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Om?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Tm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof $m&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new $m(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(t_),Or(Yd),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const d_=new or("ROUTER_CONFIGURATION"),f_=new or("ROUTER_FORROOT_GUARD"),p_=[Kh,{provide:uy,useClass:hy},{provide:t_,useFactory:function(e,t,n,r,i,s,o,a={},c,l){const u=new t_(null,e,t,n,r,i,s,Km(o));return c&&(u.urlHandlingStrategy=c),l&&(u.routeReuseStrategy=l),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[uy,Zv,Kh,$o,Ph,eh,qv,d_,[class{},new Mr],[class{},new Mr]]},Zv,{provide:xy,useFactory:function(e){return e.routerState.root},deps:[t_]},{provide:Ph,useClass:Ih},u_,l_,class{preload(e,t){return t().pipe(vm(()=>Pg(null)))}},{provide:d_,useValue:{enableTracing:!1}}];function g_(){return new vh("Router",t_)}let m_=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[p_,C_(t),{provide:f_,useFactory:__,deps:[[t_,new Mr,new xr]]},{provide:d_,useValue:n||{}},{provide:qh,useFactory:v_,deps:[Lh,[new Nr(jh),new Mr],d_]},{provide:h_,useFactory:y_,deps:[t_,Yd,d_]},{provide:c_,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:l_},{provide:vh,multi:!0,useFactory:g_},[E_,{provide:Lu,multi:!0,useFactory:w_,deps:[E_]},{provide:S_,useFactory:b_,deps:[E_]},{provide:Hu,multi:!0,useExisting:S_}]]}}static forChild(t){return{ngModule:e,providers:[C_(t)]}}}return e.\u0275fac=function(t){return new(t||e)(Or(f_,8),Or(t_,8))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function y_(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new h_(e,t,n)}function v_(e,t,n={}){return n.useHash?new Yh(e,t):new Zh(e,t)}function __(e){return"guarded"}function C_(e){return[{provide:ar,multi:!0,useValue:e},{provide:qv,multi:!0,useValue:e}]}let E_=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(Bh,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let e=null;const t=new Promise(t=>e=t),n=this.injector.get(t_),r=this.injector.get(d_);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?Pg(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(d_),n=this.injector.get(u_),r=this.injector.get(h_),i=this.injector.get(t_),s=this.injector.get(bh);e===s.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(t){return new(t||e)(Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function w_(e){return e.appInitializer.bind(e)}function b_(e){return e.bootstrapListener.bind(e)}const S_=new or("Router Initializer");class P_{}const O_="*";function T_(e,t=null){return{type:2,steps:e,options:t}}function I_(e){return{type:6,styles:e,offset:null}}function k_(e){Promise.resolve(null).then(e)}class A_{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){k_(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class N_{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?k_(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function M_(){return"undefined"!=typeof window&&void 0!==window.document}function x_(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function R_(e){switch(e.length){case 0:return new A_;case 1:return e[0];default:return new N_(e)}}function D_(e,t,n,r,i={},s={}){const o=[],a=[];let c=-1,l=null;if(r.forEach(e=>{const n=e.offset,r=n==c,u=r&&l||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),a){case"!":a=i[n];break;case O_:a=s[n];break;default:a=t.normalizeStyleValue(n,r,a,o)}u[r]=a}),r||a.push(u),l=u,c=n}),o.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${o.join(e)}`)}return a}function L_(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&F_(n,"start",e)));break;case"done":e.onDone(()=>r(n&&F_(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&F_(n,"destroy",e)))}}function F_(e,t,n){const r=B_(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),i=e._data;return null!=i&&(r._data=i),r}function B_(e,t,n,r,i="",s=0,o){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function V_(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function U_(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let $_=(e,t)=>!1,z_=(e,t)=>!1,H_=(e,t,n)=>[];const G_=x_();(G_||"undefined"!=typeof Element)&&($_=M_()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),z_=(()=>{if(G_||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):z_}})(),H_=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let q_=null,W_=!1;function j_(e){q_||(q_=("undefined"!=typeof document?document.body:null)||{},W_=!!q_.style&&"WebkitAppearance"in q_.style);let t=!0;return q_.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in q_.style,!t&&W_&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in q_.style)),t}const Z_=z_,Y_=$_,K_=H_;function J_(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let Q_=(()=>{class e{validateStyleProperty(e){return j_(e)}matchesElement(e,t){return Z_(e,t)}containsElement(e,t){return Y_(e,t)}query(e,t,n){return K_(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,s=[],o){return new A_(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),X_=(()=>{class e{}return e.NOOP=new Q_,e})();const eC="ng-enter",tC="ng-leave",nC="ng-trigger",rC=".ng-trigger",iC="ng-animating",sC=".ng-animating";function oC(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:aC(parseFloat(t[1]),t[2])}function aC(e,t){switch(t){case"s":return 1e3*e;default:return e}}function cC(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,s="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=aC(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=aC(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=e;if(!n){let n=!1,s=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(s,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:s}}(e,t,n)}function lC(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function uC(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else lC(e,n);return n}function hC(e,t,n){return n?t+":"+n+";":""}function dC(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=hC(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=hC(0,wC(n),e.style[n]));e.setAttribute("style",t)}function fC(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=EC(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),x_()&&dC(e))}function pC(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=EC(t);e.style[n]=""}),x_()&&dC(e))}function gC(e){return Array.isArray(e)?1==e.length?e[0]:T_(e):e}const mC=new RegExp("{{\\s*(.+?)\\s*}}","g");function yC(e){let t=[];if("string"==typeof e){let n;for(;n=mC.exec(e);)t.push(n[1]);mC.lastIndex=0}return t}function vC(e,t,n){const r=e.toString(),i=r.replace(mC,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function _C(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const CC=/-+([a-z0-9])/g;function EC(e){return e.replace(CC,(...e)=>e[1].toUpperCase())}function wC(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function bC(e,t){return 0===e||0===t}function SC(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let s=t[0],o=[];if(r.forEach(e=>{s.hasOwnProperty(e)||o.push(e),s[e]=n[e]}),o.length)for(var i=1;i<t.length;i++){let n=t[i];o.forEach(function(t){n[t]=OC(e,t)})}}return t}function PC(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function OC(e,t){return window.getComputedStyle(e)[t]}function TC(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],s=r[2],o=r[3];t.push(AC(i,o));"<"==s[0]&&!("*"==i&&"*"==o)&&t.push(AC(o,i))}(e,n,t)):n.push(e),n}const IC=new Set(["true","1"]),kC=new Set(["false","0"]);function AC(e,t){const n=IC.has(e)||kC.has(e),r=IC.has(t)||kC.has(t);return(i,s)=>{let o="*"==e||e==i,a="*"==t||t==s;return!o&&n&&"boolean"==typeof i&&(o=i?IC.has(e):kC.has(e)),!a&&r&&"boolean"==typeof s&&(a=s?IC.has(t):kC.has(t)),o&&a}}const NC=new RegExp("s*:selfs*,?","g");function MC(e,t,n){return new xC(e).build(t,n)}class xC{constructor(e){this._driver=e}build(e,t){const n=new RC(t);return this._resetContextStyleTimingState(n),PC(this,gC(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],s=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,s.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(e=>{if(DC(e)){const t=e;Object.keys(t).forEach(e=>{yC(t[e]).forEach(e=>{s.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=_C(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=PC(this,gC(e.animation),t);return{type:1,matchers:TC(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:LC(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>PC(this,e,t)),options:LC(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=PC(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:LC(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return FC(cC(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=FC(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||cC(r,t),FC(n.duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;let r,i=e.styles?e.styles:I_({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,s=!1;if(!i){s=!0;const e={};n.easing&&(e.easing=n.easing),i=I_(e)}t.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,t);o.isEmptyStep=s,r=o}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==O_?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(DC(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=t.collectedStyles[t.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=yC(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const c=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let c=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(DC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(DC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),l=0;return null!=c&&(r++,l=n.offset=c),o=o||l<0||l>1,s=s||l<a,a=l,i.push(l),n});o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&t.errors.push("Please ensure that all keyframe offsets are in order");const l=e.steps.length;let u=0;r>0&&r<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(u=1/(l-1));const h=l-1,d=t.currentTime,f=t.currentAnimateTimings,p=f.duration;return c.forEach((e,r)=>{const s=u>0?r==h?1:u*r:i[r],o=s*p;t.currentTime=d+f.delay+o,f.duration=o,this._validateStyleAst(e,t),e.offset=s,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:PC(this,gC(e.animation),t),options:LC(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:LC(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:LC(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,s]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(NC,"")),[e=e.replace(/@\*/g,rC).replace(/@\w+/g,e=>rC+"-"+e.substr(1)).replace(/:animating/g,sC),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,V_(t.collectedStyles,t.currentQuerySelector,{});const o=PC(this,gC(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:e.selector,options:LC(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:cC(e.timings,t.errors,!0);return{type:12,animation:PC(this,gC(e.animation),t),timings:n,options:null}}}class RC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function DC(e){return!Array.isArray(e)&&"object"==typeof e}function LC(e){return e?(e=lC(e)).params&&(e.params=function(e){return e?lC(e):null}(e.params)):e={},e}function FC(e,t,n){return{duration:e,delay:t,easing:n}}function BC(e,t,n,r,i,s,o=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class VC{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const UC=new RegExp(":enter","g"),$C=new RegExp(":leave","g");function zC(e,t,n,r,i,s={},o={},a,c,l=[]){return(new HC).buildKeyframes(e,t,n,r,i,s,o,a,c,l)}class HC{buildKeyframes(e,t,n,r,i,s,o,a,c,l=[]){c=c||new VC;const u=new qC(e,t,c,r,i,l,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),PC(this,n,u);const h=u.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(o).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([o],null,u.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[BC(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&t.transformIntoNewTimeline(s)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?oC(n.duration):null,s=null!=n.delay?oC(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),PC(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=GC);const e=oC(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>PC(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?oC(e.options.delay):0;e.steps.forEach(s=>{const o=t.createSubContext(e.options);i&&o.delayNextStep(i),PC(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return cC(t.params?vC(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,s=t.createSubContext().currentTimeline;s.easing=n.easing,e.styles.forEach(e=>{s.forwardTime((e.offset||0)*i),s.setStyles(e.styles,e.easing,t.errors,t.options),s.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(s),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?oC(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=GC);let s=n;const o=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{t.currentQueryIndex=r;const o=t.createSubContext(e.options,n);i&&o.delayNextStep(i),n===t.element&&(a=o.currentTimeline),PC(this,e.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(s),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,s=Math.abs(i.duration),o=s*(t.currentQueryTotal-1);let a=s*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const c=t.currentTimeline;a&&c.delayNextStep(a);const l=c.currentTime;PC(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-l+(r.startTime-n.currentTimeline.startTime)}}const GC={};class qC{constructor(e,t,n,r,i,s,o,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=GC,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new WC(this._driver,t,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=oC(n.duration)),null!=n.delay&&(r.delay=oC(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{(!t||!e.hasOwnProperty(n))&&(e[n]=vC(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new qC(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=GC,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},i=new jC(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,s){let o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(UC,"."+this._enterClassName)).replace($C,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),o.push(...t)}return!i&&0==o.length&&s.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),o}}class WC{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new WC(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||O_,this._currentKeyframe[e]=O_}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},s=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=O_})):uC(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(s).forEach(e=>{const t=vC(s[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:O_),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=uC(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?e.add(n):r==O_&&t.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=e.size?_C(e.values()):[],s=t.size?_C(t.values()):[];if(n){const e=r[0],t=lC(e);e.offset=0,t.offset=1,r=[e,t]}return BC(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class jC extends WC{constructor(e,t,n,r,i,s,o=!1){super(e,t,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],s=n+t,o=t/s,a=uC(e[0],!1);a.offset=0,i.push(a);const c=uC(e[0],!1);c.offset=ZC(o),i.push(c);const l=e.length-1;for(let r=1;r<=l;r++){let o=uC(e[r],!1);o.offset=ZC((t+o.offset*n)/s),i.push(o)}n=s,t=0,r="",e=i}return BC(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function ZC(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class YC{}class KC extends YC{normalizePropertyName(e,t){return EC(e)}normalizeStyleValue(e,t,n,r){let i="";const s=n.toString().trim();if(JC[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return s+i}}const JC=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function QC(e,t,n,r,i,s,o,a,c,l,u,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:c,preStyleProps:l,postStyleProps:u,totalTime:h,errors:d}}const XC={};class eE{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],s=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):s}build(e,t,n,r,i,s,o,a,c,l){const u=[],h=this.ast.options&&this.ast.options.params||XC,d=this.buildStyles(n,o&&o.params||XC,u),f=a&&a.params||XC,p=this.buildStyles(r,f,u),g=new Set,m=new Map,y=new Map,v="void"===r,_={params:Object.assign(Object.assign({},h),f)},C=l?[]:zC(e,t,this.ast.animation,i,s,d,p,_,c,u);let E=0;if(C.forEach(e=>{E=Math.max(e.duration+e.delay,E)}),u.length)return QC(t,this._triggerName,n,r,v,d,p,[],[],m,y,E,u);C.forEach(e=>{const n=e.element,r=V_(m,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=V_(y,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&g.add(n)});const w=_C(g.values());return QC(t,this._triggerName,n,r,v,d,p,C,w,m,y,E)}}class tE{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){const n={},r=lC(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let s=i[e];s.length>1&&(s=vC(s,r,t));const o=this.normalizer.normalizePropertyName(e,t);s=this.normalizer.normalizeStyleValue(e,o,s,t),n[o]=s})}}),n}}class nE{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new tE(e.style,e.options&&e.options.params||{},n)}),rE(this.states,"true","1"),rE(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new eE(e,t,this.states))}),this.fallbackTransition=function(e,t,n){return new eE(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},t)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function rE(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const iE=new VC;class sE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=MC(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=D_(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let s;const o=new Map;if(i?(s=zC(this._driver,t,i,eC,tC,{},{},n,iE,r),s.forEach(e=>{const t=V_(o,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);o.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,O_)})});const a=R_(s.map(e=>{const t=o.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=B_(t,"","","");return L_(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const oE="ng-animate-queued",aE="ng-animate-disabled",cE=".ng-animate-disabled",lE=[],uE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},hE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},dE="__ng_removed";class fE{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=(n?e.value:e)??null,n){const t=lC(e);delete t.value,this.options=t}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const pE="void",gE=new fE(pE);class mE{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,SE(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const s=V_(this._elementListeners,e,[]),o={name:t,phase:n,callback:r};s.push(o);const a=V_(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(SE(e,nC),SE(e,nC+"-"+t),a[t]=gE),()=>{this._engine.afterFlush(()=>{const e=s.indexOf(o);e>=0&&s.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),s=new vE(this.id,t,e);let o=this._engine.statesByElement.get(e);o||(SE(e,nC),SE(e,nC+"-"+t),this._engine.statesByElement.set(e,o={}));let a=o[t];const c=new fE(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&c.absorbOptions(a.options),o[t]=c,a||(a=gE),c.value!==pE&&a.value===c.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,c.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(c.value,c.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{pC(e,n),fC(e,r)})}return}const l=V_(this._engine.playersByElement,e,[]);l.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let u=i.matchTransition(a.value,c.value,e,c.params),h=!1;if(!u){if(!r)return;u=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:u,fromState:a,toState:c,player:s,isFallbackTransition:h}),h||(SE(e,oE),s.onStart(()=>{PE(e,oE)})),s.onDone(()=>{let t=this.players.indexOf(s);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(s);e>=0&&n.splice(e,1)}}),this.players.push(s),l.push(s),s}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,rC,!0);n.forEach(e=>{if(e[dE])return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const s=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,pE,r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&R_(s).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const s=this._triggers[i].fallbackTransition,o=n[i]||gE,a=new fE(pE),c=new vE(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:s,fromState:o,toState:a,player:c,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e[dE];(!r||r===uE)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){SE(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(t=>{if(t.name==n.triggerName){const r=B_(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,L_(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class yE{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new mE(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(_E(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!_E(t))return;const i=t[dE];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),SE(e,aE)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),PE(e,aE))}removeNode(e,t,n,r){if(_E(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t[dE]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return _E(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,rC,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,sC,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return R_(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[dE];if(t&&t.setForRemoval){if(e[dE]=uE,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,cE)&&this.markElementAsDisabled(e,!1),this.driver.query(e,cE,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)SE(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?R_(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new VC,r=[],i=new Map,s=[],o=new Map,a=new Map,c=new Map,l=new Set;this.disabledNodes.forEach(e=>{l.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)l.add(t[n])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=wE(h,this.collectedEnterElements),f=new Map;let p=0;d.forEach((e,t)=>{const n=eC+p++;f.set(t,n),e.forEach(e=>SE(e,n))});const g=[],m=new Set,y=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const e=this.collectedLeaveElements[A],t=e[dE];t&&t.setForRemoval&&(g.push(e),m.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>m.add(e)):y.add(e))}const v=new Map,_=wE(h,Array.from(m));_.forEach((e,t)=>{const n=tC+p++;v.set(t,n),e.forEach(e=>SE(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=f.get(t);e.forEach(e=>PE(e,n))}),_.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>PE(e,n))}),g.forEach(e=>{this.processLeaveNode(e)})});const C=[],E=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(C.push(t),this.collectedEnterElements.length){const e=i[dE];if(e&&e.setForMove)return void t.destroy()}const l=!u||!this.driver.containsElement(u,i),h=v.get(i),d=f.get(i),p=this._buildInstruction(e,n,d,h,l);if(p.errors&&p.errors.length)E.push(p);else{if(l)return t.onStart(()=>pC(i,p.fromStyles)),t.onDestroy(()=>fC(i,p.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>pC(i,p.fromStyles)),t.onDestroy(()=>fC(i,p.toStyles)),void r.push(t);p.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,p.timelines),s.push({instruction:p,player:t,element:i}),p.queriedElements.forEach(e=>V_(o,e,[]).push(t)),p.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),p.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=c.get(t);r||c.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(E.length){const e=[];E.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),C.forEach(e=>e.destroy()),this.reportError(e)}const w=new Map,b=new Map;s.forEach(e=>{const t=e.element;n.has(t)&&(b.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,w))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{V_(w,t,[]).push(e),e.destroy()})});const S=g.filter(e=>IE(e,a,c)),P=new Map;EE(P,this.driver,y,c,O_).forEach(e=>{IE(e,a,c)&&S.push(e)});const O=new Map;d.forEach((e,t)=>{EE(O,this.driver,new Set(e),a,"!")}),S.forEach(e=>{const t=P.get(e),n=O.get(e);P.set(e,Object.assign(Object.assign({},t),n))});const T=[],I=[],k={};s.forEach(e=>{const{element:t,player:s,instruction:o}=e;if(n.has(t)){if(l.has(t))return s.onDestroy(()=>fC(t,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let e=k;if(b.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=b.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>b.set(t,e))}const n=this._buildAnimation(s.namespaceId,o,w,i,O,P);if(s.setRealPlayer(n),e===k)T.push(s);else{const t=this.playersByElement.get(e);t&&t.length&&(s.parentPlayer=R_(t)),r.push(s)}}else pC(t,o.fromStyles),s.onDestroy(()=>fC(t,o.toStyles)),I.push(s),l.has(t)&&r.push(s)}),I.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=R_(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let A=0;A<g.length;A++){const e=g[A],t=e[dE];if(PE(e,tC),t&&t.hasAnimation)continue;let n=[];if(o.size){let t=o.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,sC,!0);for(let e=0;e<r.length;e++){let t=o.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?OE(this,e,r):this.processLeaveNode(e)}return g.length=0,T.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),T}elementContainsData(e,t){let n=!1;const r=t[dE];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let s=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(s=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==pE;t.forEach(t=>{t.queued||!e&&t.triggerName!=r||s.push(t)})}}return(n||r)&&(s=s.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),s}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName;for(const o of t.timelines){const e=o.element,a=e!==r,c=V_(n,e,[]);this._getPreviousPlayers(e,a,i,s,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)})}pC(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,s){const o=t.triggerName,a=t.element,c=[],l=new Set,u=new Set,h=t.timelines.map(t=>{const h=t.element;l.add(h);const d=h[dE];if(d&&d.removedBeforeQueried)return new A_(t.duration,t.delay);const f=h!==a,p=function(e){const t=[];return TE(e,t),t}((n.get(h)||lE).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),g=i.get(h),m=s.get(h),y=D_(0,this._normalizer,0,t.keyframes,g,m),v=this._buildPlayer(t,y,p);if(t.subTimeline&&r&&u.add(h),f){const t=new vE(e,o,h);t.setRealPlayer(v),c.push(t)}return v});c.forEach(e=>{V_(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),l.forEach(e=>SE(e,iC));const d=R_(h);return d.onDestroy(()=>{l.forEach(e=>PE(e,iC)),fC(a,t.toStyles)}),u.forEach(e=>{V_(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new A_(e.duration,e.delay)}}class vE{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new A_,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>L_(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){V_(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function _E(e){return e&&1===e.nodeType}function CE(e,t){const n=e.style.display;return e.style.display=t??"none",n}function EE(e,t,n,r,i){const s=[];n.forEach(e=>s.push(CE(e)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(e=>{const n=s[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[dE]=hE,o.push(r))}),e.set(r,s)});let a=0;return n.forEach(e=>CE(e,s[a++])),o}function wE(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function s(e){if(!e)return 1;let t=i.get(e);if(t)return t;const o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:s(o),i.set(e,t),t}return t.forEach(e=>{const t=s(e);1!==t&&n.get(t).push(e)}),n}const bE="$$classes";function SE(e,t){if(e.classList)e.classList.add(t);else{let n=e[bE];n||(n=e[bE]={}),n[t]=!0}}function PE(e,t){if(e.classList)e.classList.remove(t);else{let n=e[bE];n&&delete n[t]}}function OE(e,t,n){R_(n).onDone(()=>e.processLeaveNode(t))}function TE(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof N_?TE(r.players,t):t.push(r)}}function IE(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class kE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new yE(e,t,n),this._timelineEngine=new sE(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const s=e+"-"+r;let o=this._triggerCache[s];if(!o){const e=[],t=MC(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);o=function(e,t,n){return new nE(e,t,n)}(r,t,this._normalizer),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(t,r,o)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=U_(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=U_(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function AE(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=ME(t[0]),t.length>1&&(r=ME(t[t.length-1]))):t&&(n=ME(t)),n||r?new NE(e,n,r):null}let NE=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&fC(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(fC(this._element,this._initialStyles),this._endStyles&&(fC(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(pC(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(pC(this._element,this._endStyles),this._endStyles=null),fC(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function ME(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];xE(i)&&(t=t||{},t[i]=e[i])}return t}function xE(e){return"display"===e||"position"===e}const RE="animation",DE="animationend";class LE{constructor(e,t,n,r,i,s,o){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){(function(e,t){const n=zE(e,"").trim();let r=0;n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++;return n}(n)+1,t=`${n}, ${t}`),$E(e,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),UE(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){FE(this._element,this._name,"paused")}resume(){FE(this._element,this._name,"running")}setPosition(e){const t=BE(this._element,this._name);this._position=e*this._duration,$E(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),UE(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=zE(e,"").split(","),r=VE(n,t);r>=0&&(n.splice(r,1),$E(e,"",n.join(",")))}(this._element,this._name))}}function FE(e,t,n){$E(e,"PlayState",n,BE(e,t))}function BE(e,t){const n=zE(e,"");return n.indexOf(",")>0?VE(n.split(","),t):VE([n],t)}function VE(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function UE(e,t,n){n?e.removeEventListener(DE,t):e.addEventListener(DE,t)}function $E(e,t,n,r){const i=RE+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function zE(e,t){return e.style[RE+t]||""}class HE{constructor(e,t,n,r,i,s,o,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new LE(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:OC(this.element,n))})}this.currentSnapshot=e}}class GE extends A_{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=J_(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class qE{constructor(){this._count=0}validateStyleProperty(e){return j_(e)}matchesElement(e,t){return Z_(e,t)}containsElement(e,t){return Y_(e,t)}query(e,t,n){return K_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>J_(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const s=document.createElement("style");return s.textContent=r,s}animate(e,t,n,r,i,s=[],o){const a=s.filter(e=>e instanceof HE),c={};bC(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const l=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=SC(e,t,c));if(0==n)return new GE(e,l);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,u,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=AE(e,t),f=new HE(e,t,u,n,r,i,l,d);return f.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),f}}class WE{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:OC(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class jE{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(ZE().toString()),this._cssKeyframesDriver=new qE}validateStyleProperty(e){return j_(e)}matchesElement(e,t){return Z_(e,t)}containsElement(e,t){return Y_(e,t)}query(e,t,n){return K_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const c={},l=s.filter(e=>e instanceof WE);bC(n,r)&&l.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const u=AE(e,t=SC(e,t=t.map(e=>uC(e,!1)),c));return new WE(e,t,a,u)}}function ZE(){return M_()&&Element.prototype.animate||{}}let YE=(()=>{class e extends P_{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:Be.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?T_(e):e;return QE(this._renderer,null,t,"register",[n]),new KE(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(Or(ll),Or(Dh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class KE extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new JE(this._id,e,t||{},this._renderer)}}class JE{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return QE(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function QE(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const XE="@.disabled";let ew=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new tw("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const s=t=>{Array.isArray(t)?t.forEach(s):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(s),new nw(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(Or(ll),Or(kE),Or(rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class tw{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){"@"==t.charAt(0)&&t==XE?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class nw extends tw{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==XE?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if("@"==t.charAt(0)){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let rw=(()=>{class e extends kE{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh),Or(X_),Or(YC))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const iw=new or("AnimationModuleType"),sw=[{provide:P_,useClass:YE},{provide:YC,useFactory:function(){return new KC}},{provide:kE,useClass:rw},{provide:ll,useFactory:function(e,t,n){return new ew(e,t,n)},deps:[yf,kE,rh]}],ow=[{provide:X_,useFactory:function(){return"function"==typeof ZE()?new jE:new qE}},{provide:iw,useValue:"BrowserAnimations"},...sw],aw=[{provide:X_,useClass:Q_},{provide:iw,useValue:"NoopAnimations"},...sw];let cw=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?aw:ow}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:ow,imports:[Nf]}),e})();var lw=n(9575),uw=n.n(lw);function hw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,i)}function dw(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){hw(s,r,i,o,a,"next",e)}function a(e){hw(s,r,i,o,a,"throw",e)}o(void 0)})}}class fw{static expectToBe(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error(`A default switch case did not observe the correct value, expected ${t}, but got ${e} instead.`)}static expectToBeMultiple(e,t){let n=!1;for(const r of t)if(e===r){n=!0;break}if(!1===n)throw new Error(`A default switch case did not observe the correct value, expected a value among ${t}, but got ${e} instead.`)}static getNonNullable(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}function pw(e,t){e&&console.log(t)}function gw(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);{const n=e,r=t;for(const e of Object.keys(n)){if(!(e in r))return!1;if(!1===gw(n[e],r[e]))return!1}return!0}}return e===t}function mw(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(const t in e)if(null!=e[t]&&!1===mw(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function yw(e,t){if(mw(e)&&mw(t))return gw(e,t);throw new Error(`Comparing non comparable objects: ${e.constructor.name} and ${t.constructor.name}`)}class vw{constructor(e){this.value=e}static of(e){return new vw(e)}static ofNullable(e){return null==e?vw.empty():vw.of(e)}static empty(){return new vw(null)}isPresent(){return null!=this.value}isAbsent(){return null==this.value}get(){if(this.isPresent())return this.value;throw new Error("Value is absent")}getOrElse(e){return this.isPresent()?this.value:e}equals(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&yw(this.value,e.value)}equalsValue(e){return this.equals(vw.of(e))}toString(){return this.isAbsent()?"MGPOptional.empty()":`MGPOptional.of(${this.value})`}map(e){return this.isPresent()?vw.of(e(this.get())):vw.empty()}}const _w=function(e,t){if(!e)throw Cw(t)},Cw=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},Ew=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},ww={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0;let l=(15&o)<<2|c>>6,u=63&c;a||(u=64,s||(l=64)),r.push(n[t>>2],n[(3&t)<<4|o>>4],n[l],n[u])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ew(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();r.push(t<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},bw=function(e){const t=Ew(e);return ww.encodeByteArray(t,!0)},Sw=function(e){return bw(e).replace(/\./g,"")},Pw=function(e){try{return ww.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ow(e){return Tw(void 0,e)}function Tw(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)!t.hasOwnProperty(n)||!Iw(n)||(e[n]=Tw(e[n],t[n]));return e}function Iw(e){return"__proto__"!==e}class kw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Aw(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Sw(JSON.stringify({alg:"none",type:"JWT"})),Sw(JSON.stringify(s)),""].join(".")}function Nw(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Mw(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Nw())}function xw(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function Rw(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Dw(){const e=Nw();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Lw(){return"object"==typeof indexedDB}function Fw(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function Bw(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Vw extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Vw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Uw.prototype.create)}}class Uw{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace($w,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error";return new Vw(r,`${this.serviceName}: ${s} (${r}).`,n)}}const $w=/\{\$([^}]+)}/g;function zw(e){return JSON.parse(e)}function Hw(e){return JSON.stringify(e)}const Gw=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=zw(Pw(s[0])||""),n=zw(Pw(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}};function qw(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ww(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function jw(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Zw(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Yw(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(Kw(n)&&Kw(s)){if(!Yw(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Kw(e){return null!==e&&"object"==typeof e}function Jw(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Qw(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Xw(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eb{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):u<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const e=(s<<5|s>>>27)+r+l+i+n[u]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class tb{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of["next","error","complete"])if(n in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=nb),void 0===r.error&&(r.error=nb),void 0===r.complete&&(r.complete=nb);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nb(){}function rb(e,t){return`${e} failed: ${t} argument `}const ib=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function sb(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function ob(e){return e&&e._delegate?e._delegate:e}class ab{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const cb="[DEFAULT]";class lb{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new kw;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:cb})}catch{}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=cb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return dw(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=cb){return this.instances.has(e)}getOptions(e=cb){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===cb?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=cb){return this.component?this.component.multipleInstances?e:cb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ub{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lb(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const hb=[];var db=(()=>{return(e=db||(db={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",db;var e})();const fb={debug:db.DEBUG,verbose:db.VERBOSE,info:db.INFO,warn:db.WARN,error:db.ERROR,silent:db.SILENT},pb=db.INFO,gb={[db.DEBUG]:"log",[db.VERBOSE]:"log",[db.INFO]:"info",[db.WARN]:"warn",[db.ERROR]:"error"},mb=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=gb[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class yb{constructor(e){this.name=e,this._logLevel=pb,this._logHandler=mb,this._userLogHandler=null,hb.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in db))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?fb[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,db.DEBUG,...e),this._logHandler(this,db.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,db.VERBOSE,...e),this._logHandler(this,db.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,db.INFO,...e),this._logHandler(this,db.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,db.WARN,...e),this._logHandler(this,db.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,db.ERROR,...e),this._logHandler(this,db.ERROR,...e)}}class vb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const _b="@firebase/app",Cb=new yb("@firebase/app"),Eb="[DEFAULT]",wb={[_b]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},bb=new Map,Sb=new Map;function Pb(e,t){try{e.container.addComponent(t)}catch(n){Cb.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ob(e){const t=e.name;if(Sb.has(t))return Cb.debug(`There were multiple attempts to register component ${t}.`),!1;Sb.set(t,e);for(const n of bb.values())Pb(n,e);return!0}function Tb(e,t){return e.container.getProvider(t)}const Ib=new Uw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class kb{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ab("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ib.create("app-deleted",{appName:this._name})}}const Ab="9.6.6";function Nb(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:Eb,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw Ib.create("bad-app-name",{appName:String(r)});const i=bb.get(r);if(i){if(Yw(e,i.options)&&Yw(n,i.config))return i;throw Ib.create("duplicate-app",{appName:r})}const s=new ub(r);for(const a of Sb.values())s.addComponent(a);const o=new kb(e,n,s);return bb.set(r,o),o}function Mb(e=Eb){const t=bb.get(e);if(!t)throw Ib.create("no-app",{appName:e});return t}function xb(){return Array.from(bb.values())}function Rb(e,t,n){var r;let i=null!==(r=wb[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Cb.warn(e.join(" "))}Ob(new ab(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}Ob(new ab("platform-logger",e=>new vb(e),"PRIVATE")),Rb(_b,"0.7.16",""),Rb(_b,"0.7.16","esm2017"),Rb("fire-js",""),Rb("firebase","9.6.6","app");var Db=n(6676);const Lb="@firebase/installations",Fb="w:0.5.5",Bb="FIS_v2",Vb=new Uw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Ub(e){return e instanceof Vw&&e.code.includes("request-failed")}function $b({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function zb(e){return{token:e.token,requestStatus:2,expiresIn:Yb(e.expiresIn),creationTime:Date.now()}}function Hb(e,t){return Gb.apply(this,arguments)}function Gb(){return(Gb=dw(function*(e,t){const n=(yield t.json()).error;return Vb.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})).apply(this,arguments)}function qb({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Wb(e,{refreshToken:t}){const n=qb(e);return n.append("Authorization",function(e){return`${Bb} ${e}`}(t)),n}function jb(e){return Zb.apply(this,arguments)}function Zb(){return(Zb=dw(function*(e){const t=yield e();return t.status>=500&&t.status<600?e():t})).apply(this,arguments)}function Yb(e){return Number(e.replace("s","000"))}function Kb(e,t){return Jb.apply(this,arguments)}function Jb(){return(Jb=dw(function*(e,{fid:t}){const n=$b(e),r={method:"POST",headers:qb(e),body:JSON.stringify({fid:t,authVersion:Bb,appId:e.appId,sdkVersion:Fb})},i=yield jb(()=>fetch(n,r));if(i.ok){const e=yield i.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:zb(e.authToken)}}throw yield Hb("Create Installation",i)})).apply(this,arguments)}function Qb(e){return new Promise(t=>{setTimeout(t,e)})}const Xb=/^[cdef][\w-]{21}$/;function eS(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return Xb.test(t)?t:""}catch{return""}}function tS(e){return`${e.appName}!${e.appId}`}const nS=new Map;function rS(e,t){const n=tS(e);iS(n,t),function(e,t){const n=(!sS&&"BroadcastChannel"in self&&(sS=new BroadcastChannel("[Firebase] FID Change"),sS.onmessage=e=>{iS(e.data.key,e.data.fid)}),sS);n&&n.postMessage({key:e,fid:t}),0===nS.size&&sS&&(sS.close(),sS=null)}(n,t)}function iS(e,t){const n=nS.get(e);if(n)for(const r of n)r(t)}let sS=null;const oS="firebase-installations-store";let aS=null;function cS(){return aS||(aS=(0,Db.openDb)("firebase-installations-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(oS)}})),aS}function lS(e,t){return uS.apply(this,arguments)}function uS(){return(uS=dw(function*(e,t){const n=tS(e),r=(yield cS()).transaction(oS,"readwrite"),i=r.objectStore(oS),s=yield i.get(n);return yield i.put(t,n),yield r.complete,(!s||s.fid!==t.fid)&&rS(e,t.fid),t})).apply(this,arguments)}function hS(e){return dS.apply(this,arguments)}function dS(){return(dS=dw(function*(e){const t=tS(e),n=(yield cS()).transaction(oS,"readwrite");yield n.objectStore(oS).delete(t),yield n.complete})).apply(this,arguments)}function fS(e,t){return pS.apply(this,arguments)}function pS(){return(pS=dw(function*(e,t){const n=tS(e),r=(yield cS()).transaction(oS,"readwrite"),i=r.objectStore(oS),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.complete,o&&(!s||s.fid!==o.fid)&&rS(e,o.fid),o})).apply(this,arguments)}function gS(e){return mS.apply(this,arguments)}function mS(){return(mS=dw(function*(e){let t;const n=yield fS(e,n=>{const r=yS(n),i=vS(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})).apply(this,arguments)}function yS(e){return bS(e||{fid:eS(),registrationStatus:0})}function vS(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Vb.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return _S.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:CS(e)}:{installationEntry:t}}function _S(){return(_S=dw(function*(e,t){try{return lS(e,yield Kb(e,t))}catch(n){throw Ub(n)&&409===n.customData.serverCode?yield hS(e):yield lS(e,{fid:t.fid,registrationStatus:0}),n}})).apply(this,arguments)}function CS(e){return ES.apply(this,arguments)}function ES(){return(ES=dw(function*(e){let t=yield wS(e);for(;1===t.registrationStatus;)yield Qb(100),t=yield wS(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield gS(e);return n||t}return t})).apply(this,arguments)}function wS(e){return fS(e,e=>{if(!e)throw Vb.create("installation-not-found");return bS(e)})}function bS(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function SS(e,t){return PS.apply(this,arguments)}function PS(){return(PS=dw(function*({appConfig:e,platformLoggerProvider:t},n){const r=OS(e,n),i=Wb(e,n),s=t.getImmediate({optional:!0});s&&i.append("x-firebase-client",s.getPlatformInfoString());const o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:Fb}})},a=yield jb(()=>fetch(r,o));if(a.ok)return zb(yield a.json());throw yield Hb("Generate Auth Token",a)})).apply(this,arguments)}function OS(e,{fid:t}){return`${$b(e)}/${t}/authTokens:generate`}function TS(e){return IS.apply(this,arguments)}function IS(){return(IS=dw(function*(e,t=!1){let n;const r=yield fS(e.appConfig,r=>{if(!RS(r))throw Vb.create("not-registered");const i=r.authToken;if(!t&&DS(i))return r;if(1===i.requestStatus)return n=kS(e,t),r;{if(!navigator.onLine)throw Vb.create("app-offline");const t=LS(r);return n=MS(e,t),t}});return n?yield n:r.authToken})).apply(this,arguments)}function kS(e,t){return AS.apply(this,arguments)}function AS(){return(AS=dw(function*(e,t){let n=yield NS(e.appConfig);for(;1===n.authToken.requestStatus;)yield Qb(100),n=yield NS(e.appConfig);const r=n.authToken;return 0===r.requestStatus?TS(e,t):r})).apply(this,arguments)}function NS(e){return fS(e,e=>{if(!RS(e))throw Vb.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function MS(e,t){return xS.apply(this,arguments)}function xS(){return(xS=dw(function*(e,t){try{const n=yield SS(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield lS(e.appConfig,r),n}catch(n){if(!Ub(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield lS(e.appConfig,n)}else yield hS(e.appConfig);throw n}})).apply(this,arguments)}function RS(e){return void 0!==e&&2===e.registrationStatus}function DS(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function LS(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function FS(){return(FS=dw(function*(e){const t=e,{installationEntry:n,registrationPromise:r}=yield gS(t.appConfig);return r?r.catch(console.error):TS(t).catch(console.error),n.fid})).apply(this,arguments)}function BS(){return(BS=dw(function*(e,t=!1){const n=e;return yield VS(n.appConfig),(yield TS(n,t)).token})).apply(this,arguments)}function VS(e){return US.apply(this,arguments)}function US(){return(US=dw(function*(e){const{registrationPromise:t}=yield gS(e);t&&(yield t)})).apply(this,arguments)}function $S(e){return Vb.create("missing-app-config-values",{valueName:e})}const zS="installations";Ob(new ab(zS,e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw $S("App Configuration");if(!e.name)throw $S("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw $S(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:Tb(t,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),Ob(new ab("installations-internal",e=>{const t=Tb(e.getProvider("app").getImmediate(),zS).getImmediate();return{getId:()=>function(e){return FS.apply(this,arguments)}(t),getToken:e=>function(e){return BS.apply(this,arguments)}(t,e)}},"PRIVATE")),Rb(Lb,"0.5.5"),Rb(Lb,"0.5.5","esm2017");const HS="@firebase/remote-config",GS=new Uw("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class qS{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}fetch(e){var t=this;return dw(function*(){const[n,r]=yield Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);if(r&&t.isCachedDataFresh(e.cacheMaxAgeMillis,n))return r;e.eTag=r&&r.eTag;const i=yield t.client.fetch(e),s=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===i.status&&s.push(t.storage.setLastSuccessfulFetchResponse(i)),yield Promise.all(s),i})()}}function WS(e=navigator){return e.languages&&e.languages[0]||e.language}class jS{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}fetch(e){var t=this;return dw(function*(){const[n,r]=yield Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${t.projectId}/namespaces/${t.namespace}:fetch?key=${t.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},o={sdk_version:t.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:t.appId,language_code:WS()},a={method:"POST",headers:s,body:JSON.stringify(o)},c=fetch(i,a),l=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let u;try{yield Promise.race([c,l]),u=yield c}catch(g){let e="fetch-client-network";throw"AbortError"===g.name&&(e="fetch-timeout"),GS.create(e,{originalErrorMessage:g.message})}let h=u.status;const d=u.headers.get("ETag")||void 0;let f,p;if(200===u.status){let e;try{e=yield u.json()}catch(m){throw GS.create("fetch-client-parse",{originalErrorMessage:m.message})}f=e.entries,p=e.state}if("INSTANCE_STATE_UNSPECIFIED"===p?h=500:"NO_CHANGE"===p?h=304:("NO_TEMPLATE"===p||"EMPTY_CONFIG"===p)&&(f={}),304!==h&&200!==h)throw GS.create("fetch-status",{httpStatus:h});return{status:h,eTag:d,config:f}})()}}class ZS{constructor(e,t){this.client=e,this.storage=t}fetch(e){var t=this;return dw(function*(){const n=(yield t.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return t.attemptFetch(e,n)})()}attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r=this;return dw(function*(){yield function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(GS.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,t);try{const t=yield r.client.fetch(e);return yield r.storage.deleteThrottleMetadata(),t}catch(i){if(!function(e){if(!(e instanceof Vw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(i))throw i;const t={throttleEndTimeMillis:Date.now()+sb(n),backoffCount:n+1};return yield r.storage.setThrottleMetadata(t),r.attemptFetch(e,t)}})()}}class YS{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function KS(e,t){const n=e.target.error||void 0;return GS.create(t,{originalErrorMessage:n&&n.message})}const JS="app_namespace_store";class QS{constructor(e,t,n,r=function(){return new Promise((e,n)=>{try{const t=indexedDB.open("firebase_remote_config",1);t.onerror=e=>{n(KS(e,"storage-open"))},t.onsuccess=t=>{e(t.target.result)},t.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(JS,{keyPath:"compositeKey"})}}}catch(t){n(GS.create("storage-open",{originalErrorMessage:t}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(e){var t=this;return dw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([JS],"readonly").objectStore(JS),o=t.createCompositeKey(e);try{const e=s.get(o);e.onerror=e=>{i(KS(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;r(t?t.value:void 0)}}catch(a){i(GS.create("storage-get",{originalErrorMessage:a&&a.message}))}})})()}set(e,t){var n=this;return dw(function*(){const r=yield n.openDbPromise;return new Promise((i,s)=>{const o=r.transaction([JS],"readwrite").objectStore(JS),a=n.createCompositeKey(e);try{const e=o.put({compositeKey:a,value:t});e.onerror=e=>{s(KS(e,"storage-set"))},e.onsuccess=()=>{i()}}catch(c){s(GS.create("storage-set",{originalErrorMessage:c&&c.message}))}})})()}delete(e){var t=this;return dw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([JS],"readwrite").objectStore(JS),o=t.createCompositeKey(e);try{const e=s.delete(o);e.onerror=e=>{i(KS(e,"storage-delete"))},e.onsuccess=()=>{r()}}catch(a){i(GS.create("storage-delete",{originalErrorMessage:a&&a.message}))}})})()}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class XS{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var e=this;return dw(function*(){const t=e.storage.getLastFetchStatus(),n=e.storage.getLastSuccessfulFetchTimestampMillis(),r=e.storage.getActiveConfig(),i=yield t;i&&(e.lastFetchStatus=i);const s=yield n;s&&(e.lastSuccessfulFetchTimestampMillis=s);const o=yield r;o&&(e.activeConfig=o)})()}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function eP(){return tP.apply(this,arguments)}function tP(){return(tP=dw(function*(){if(!Lw())return!1;try{return yield Fw()}catch{return!1}})).apply(this,arguments)}Ob(new ab("remote-config",function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw GS.create("registration-window");if(!Lw())throw GS.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw GS.create("registration-project-id");if(!s)throw GS.create("registration-api-key");if(!o)throw GS.create("registration-app-id");const a=new QS(o,n.name,t=t||"firebase"),c=new XS(a),l=new yb(HS);l.logLevel=db.ERROR;const u=new jS(r,Ab,t,i,s,o),h=new ZS(u,a),d=new qS(h,a,c,l),f=new YS(n,d,c,a,l);return function(e){const t=ob(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0}))}(f),f},"PUBLIC").setMultipleInstances(!0)),Rb(HS,"0.3.4"),Rb(HS,"0.3.4","esm2017");const nP="/firebase-messaging-sw.js",rP="/firebase-cloud-messaging-push-scope",iP="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",sP="google.c.a.c_id",oP="google.c.a.c_l",aP="google.c.a.ts",cP="google.c.a.e";var lP=(()=>(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(lP||(lP={})),lP))();function uP(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function hP(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}const dP="fcm_token_details_db",fP="fcm_token_object_Store";function pP(e){return gP.apply(this,arguments)}function gP(){return(gP=dw(function*(e){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(dP))return null;let t=null;return(yield(0,Db.openDb)(dP,5,function(){var n=dw(function*(n){var r;if(n.oldVersion<2||!n.objectStoreNames.contains(fP))return;const i=n.transaction.objectStore(fP),s=yield i.index("fcmSenderId").get(e);if(yield i.clear(),s)if(2===n.oldVersion){const e=s;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:uP(e.vapidKey)}}}else if(3===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:uP(e.auth),p256dh:uP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:uP(e.vapidKey)}}}else if(4===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:uP(e.auth),p256dh:uP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:uP(e.vapidKey)}}}});return function(e){return n.apply(this,arguments)}}())).close(),yield(0,Db.deleteDb)(dP),yield(0,Db.deleteDb)("fcm_vapid_details_db"),yield(0,Db.deleteDb)("undefined"),mP(t)?t:null})).apply(this,arguments)}function mP(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}const yP="firebase-messaging-store";let vP=null;function _P(){return vP||(vP=(0,Db.openDb)("firebase-messaging-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(yP)}})),vP}function CP(e){return EP.apply(this,arguments)}function EP(){return(EP=dw(function*(e){const t=OP(e),n=yield(yield _P()).transaction(yP).objectStore(yP).get(t);if(n)return n;{const t=yield pP(e.appConfig.senderId);if(t)return yield wP(e,t),t}})).apply(this,arguments)}function wP(e,t){return bP.apply(this,arguments)}function bP(){return(bP=dw(function*(e,t){const n=OP(e),r=(yield _P()).transaction(yP,"readwrite");return yield r.objectStore(yP).put(t,n),yield r.complete,t})).apply(this,arguments)}function SP(e){return PP.apply(this,arguments)}function PP(){return(PP=dw(function*(e){const t=OP(e),n=(yield _P()).transaction(yP,"readwrite");yield n.objectStore(yP).delete(t),yield n.complete})).apply(this,arguments)}function OP({appConfig:e}){return e.appId}const TP=new Uw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function IP(e,t){return kP.apply(this,arguments)}function kP(){return(kP=dw(function*(e,t){const n=yield DP(e),r=FP(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(RP(e.appConfig),i)).json()}catch(o){throw TP.create("token-subscribe-failed",{errorInfo:o})}if(s.error)throw TP.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw TP.create("token-subscribe-no-token");return s.token})).apply(this,arguments)}function AP(e,t){return NP.apply(this,arguments)}function NP(){return(NP=dw(function*(e,t){const n=yield DP(e),r=FP(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(`${RP(e.appConfig)}/${t.token}`,i)).json()}catch(o){throw TP.create("token-update-failed",{errorInfo:o})}if(s.error)throw TP.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw TP.create("token-update-no-token");return s.token})).apply(this,arguments)}function MP(e,t){return xP.apply(this,arguments)}function xP(){return(xP=dw(function*(e,t){const n={method:"DELETE",headers:yield DP(e)};try{const r=yield(yield fetch(`${RP(e.appConfig)}/${t}`,n)).json();if(r.error)throw TP.create("token-unsubscribe-failed",{errorInfo:r.error.message})}catch(r){throw TP.create("token-unsubscribe-failed",{errorInfo:r})}})).apply(this,arguments)}function RP({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function DP(e){return LP.apply(this,arguments)}function LP(){return(LP=dw(function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})).apply(this,arguments)}function FP({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==iP&&(i.web.applicationPubKey=r),i}function BP(e){return VP.apply(this,arguments)}function VP(){return(VP=dw(function*(e){const t=yield WP(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:uP(t.getKey("auth")),p256dh:uP(t.getKey("p256dh"))},r=yield CP(e.firebaseDependencies);if(r){if(ZP(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?zP(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{yield MP(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return GP(e.firebaseDependencies,n)}return GP(e.firebaseDependencies,n)})).apply(this,arguments)}function UP(e){return $P.apply(this,arguments)}function $P(){return($P=dw(function*(e){const t=yield CP(e.firebaseDependencies);t&&(yield MP(e.firebaseDependencies,t.token),yield SP(e.firebaseDependencies));const n=yield e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()})).apply(this,arguments)}function zP(e,t){return HP.apply(this,arguments)}function HP(){return(HP=dw(function*(e,t){try{const n=yield AP(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield wP(e.firebaseDependencies,r),n}catch(n){throw yield UP(e),n}})).apply(this,arguments)}function GP(e,t){return qP.apply(this,arguments)}function qP(){return(qP=dw(function*(e,t){const n={token:yield IP(e,t),createTime:Date.now(),subscriptionOptions:t};return yield wP(e,n),n.token})).apply(this,arguments)}function WP(e,t){return jP.apply(this,arguments)}function jP(){return(jP=dw(function*(e,t){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:hP(t)})})).apply(this,arguments)}function ZP(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function YP(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i)}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){if(!t.fcmOptions)return;e.fcmOptions={};const n=t.fcmOptions.link;n&&(e.fcmOptions.link=n);const r=t.fcmOptions.analytics_label;r&&(e.fcmOptions.analyticsLabel=r)}(t,e),t}function KP(e){return"object"==typeof e&&!!e&&sP in e}function JP(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function QP(e){return TP.create("missing-app-config-values",{valueName:e})}JP("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),JP("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class XP{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw QP("App Configuration Object");if(!e.name)throw QP("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw QP(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function eO(e){return tO.apply(this,arguments)}function tO(){return(tO=dw(function*(e){try{e.swRegistration=yield navigator.serviceWorker.register(nP,{scope:rP}),e.swRegistration.update().catch(()=>{})}catch(t){throw TP.create("failed-service-worker-registration",{browserErrorMessage:t.message})}})).apply(this,arguments)}function nO(e,t){return rO.apply(this,arguments)}function rO(){return(rO=dw(function*(e,t){if(!t&&!e.swRegistration&&(yield eO(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw TP.create("invalid-sw-registration");e.swRegistration=t}})).apply(this,arguments)}function iO(e,t){return sO.apply(this,arguments)}function sO(){return(sO=dw(function*(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=iP)})).apply(this,arguments)}function oO(){return(oO=dw(function*(e,t){if(!navigator)throw TP.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw TP.create("permission-blocked");return yield iO(e,null==t?void 0:t.vapidKey),yield nO(e,null==t?void 0:t.serviceWorkerRegistration),BP(e)})).apply(this,arguments)}function aO(e,t,n){return cO.apply(this,arguments)}function cO(){return(cO=dw(function*(e,t,n){const r=lO(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[sP],message_name:n[oP],message_time:n[aP],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function lO(e){switch(e){case lP.NOTIFICATION_CLICKED:return"notification_open";case lP.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function uO(){return(uO=dw(function*(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===lP.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(YP(n)):e.onMessageHandler.next(YP(n)));const r=n.data;KP(r)&&"1"===r[cP]&&(yield aO(e,n.messageType,r))})).apply(this,arguments)}const hO="@firebase/messaging";function dO(){return fO.apply(this,arguments)}function fO(){return(fO=dw(function*(){try{yield Fw()}catch{return!1}return"undefined"!=typeof window&&Lw()&&Bw()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}Ob(new ab("messaging",e=>{const t=new XP(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>function(e,t){return uO.apply(this,arguments)}(t,e)),t},"PUBLIC")),Ob(new ab("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>function(e,t){return oO.apply(this,arguments)}(t,e)}},"PRIVATE")),Rb(hO,"0.9.8"),Rb(hO,"0.9.8","esm2017");const pO="analytics",gO="firebase_id",mO="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",yO="https://www.googletagmanager.com/gtag/js",vO=new yb("@firebase/analytics");function _O(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function CO(e,t){const n=document.createElement("script");n.src=`${yO}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function EO(e,t,n,r,i,s){return wO.apply(this,arguments)}function wO(){return(wO=dw(function*(e,t,n,r,i,s){const o=r[i];try{if(o)yield t[o];else{const e=(yield _O(n)).find(e=>e.measurementId===i);e&&(yield t[e.appId])}}catch(a){vO.error(a)}e("config",i,s)})).apply(this,arguments)}function bO(e,t,n,r,i){return SO.apply(this,arguments)}function SO(){return(SO=dw(function*(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=yield _O(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),yield Promise.all(s),e("event",r,i||{})}catch(s){vO.error(s)}})).apply(this,arguments)}function PO(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(yO))return t;return null}const OO=new Uw("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),TO=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function IO(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function kO(e){return AO.apply(this,arguments)}function AO(){return(AO=dw(function*(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:IO(r)},s=mO.replace("{app-id}",n),o=yield fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=yield o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch{}throw OO.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()})).apply(this,arguments)}function NO(e){return MO.apply(this,arguments)}function MO(){return(MO=dw(function*(e,t=TO,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw OO.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw OO.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new FO;return setTimeout(dw(function*(){a.abort()}),void 0!==n?n:6e4),xO({appId:r,apiKey:i,measurementId:s},o,a,t)})).apply(this,arguments)}function xO(e,t,n){return RO.apply(this,arguments)}function RO(){return(RO=dw(function*(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=TO){const{appId:s,measurementId:o}=e;try{yield DO(r,t)}catch(a){if(o)return vO.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}try{const t=yield kO(e);return i.deleteThrottleMetadata(s),t}catch(a){if(!LO(a)){if(i.deleteThrottleMetadata(s),o)return vO.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}const t=503===Number(a.customData.httpStatus)?sb(n,i.intervalMillis,30):sb(n,i.intervalMillis),c={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return i.setThrottleMetadata(s,c),vO.debug(`Calling attemptFetch again in ${t} millis`),xO(e,c,r,i)}})).apply(this,arguments)}function DO(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(OO.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function LO(e){if(!(e instanceof Vw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class FO{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}function BO(){return VO.apply(this,arguments)}function VO(){return(VO=dw(function*(){if(!Lw())return vO.warn(OO.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield Fw()}catch(e){return vO.warn(OO.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0})).apply(this,arguments)}function UO(){return(UO=dw(function*(e,t,n,r,i,s,o){var a;const c=NO(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&vO.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>vO.error(e)),t.push(c);const l=BO().then(e=>{if(e)return r.getId()}),[u,h]=yield Promise.all([c,l]);PO()||CO(s,u.measurementId),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d[gO]=h),i("config",u.measurementId,d),u.measurementId})).apply(this,arguments)}class $O{constructor(e){this.app=e}_delete(){return delete zO[this.app.options.appId],Promise.resolve()}}let zO={},HO=[];const GO={};let qO,WO,jO="dataLayer",ZO=!1;function YO(e,t,n){!function(){const e=[];if(xw()&&e.push("This is a browser extension environment."),Bw()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=OO.create("invalid-analytics-context",{errorInfo:t});vO.warn(n.message)}}();const r=e.options.appId;if(!r)throw OO.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw OO.create("no-api-key");vO.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=zO[r])throw OO.create("already-exists",{id:r});if(!ZO){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(jO);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){function i(){return(i=dw(function*(i,s,o){try{"event"===i?yield bO(e,t,n,s,o):"config"===i?yield EO(e,t,n,r,s,o):e("set",s)}catch(a){vO.error(a)}})).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(zO,HO,GO,jO,"gtag");WO=e,qO=t,ZO=!0}return zO[r]=function(e,t,n,r,i,s,o){return UO.apply(this,arguments)}(e,HO,GO,t,qO,jO,n),new $O(e)}function KO(){return(KO=dw(function*(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=yield t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}})).apply(this,arguments)}function JO(){return QO.apply(this,arguments)}function QO(){return(QO=dw(function*(){if(xw()||!Bw()||!Lw())return!1;try{return yield Fw()}catch{return!1}})).apply(this,arguments)}const XO="@firebase/analytics";Ob(new ab(pO,(e,{options:t})=>YO(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),Ob(new ab("analytics-internal",function(e){try{const t=e.getProvider(pO).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=ob(e),function(e,t,n,r,i){return KO.apply(this,arguments)}(WO,zO[e.app.options.appId],t,n,r).catch(e=>vO.error(e))}(t,e,n,r)}}catch(t){throw OO.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),Rb(XO,"0.7.5"),Rb(XO,"0.7.5","esm2017");class eT extends a{constructor(e,t){super()}schedule(e,t=0){return this}}const tT={setInterval(...e){const{delegate:t}=tT;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=tT;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0};class nT extends eT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return tT.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;tT.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,o(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const rT={now:()=>(rT.delegate||Date).now(),delegate:void 0};class iT{constructor(e,t=iT.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}iT.now=rT.now;class sT extends iT{constructor(e,t=iT.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}const oT=new class extends sT{}(class extends nT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!=n&&n>0||null==n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}),aT=new sT(nT),cT=new fl("7.2.0"),lT="__angularfire_symbol__analyticsIsSupported",uT="__angularfire_symbol__remoteConfigIsSupported",hT="__angularfire_symbol__messagingIsSupported";function dT(e,t,n){if(t){if(1===t.length)return t[0];const e=t.filter(e=>e.app===n);if(1===e.length)return e[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[lT]||(globalThis[lT]=JO().then(e=>globalThis.__angularfire_symbol__analyticsIsSupportedValue=e)),globalThis[hT]||(globalThis[hT]=dO().then(e=>globalThis.__angularfire_symbol__messagingIsSupportedValue=e)),globalThis[uT]||(globalThis[uT]=eP().then(e=>globalThis.__angularfire_symbol__remoteConfigIsSupportedValue=e));const fT=(e,t)=>{const n=t?[t]:xb(),r=[];return n.forEach(t=>{t.container.getProvider(e).instances.forEach(e=>{r.includes(e)||r.push(e)})}),r};function pT(){}class gT{constructor(e,t=oT){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class mT{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",pT,{},pT,pT)),t.pipe(Sm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let yT=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new gT(Zone.current)),this.insideAngular=e.run(()=>new gT(Zone.current,aT)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(Or(rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function vT(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function _T(e){return vT().ngZone.runOutsideAngular(()=>e())}function CT(e){return vT().ngZone.run(()=>e())}function ET(e){return vT(),function(e){return function(t){return(t=t.lift(new mT(e.ngZone))).pipe(se(e.outsideAngular),ie(e.insideAngular))}}(vT())(e)}const wT=(e,t)=>{const n=void 0;return function(){return t&&setTimeout(()=>{"scheduled"===t.state&&t.invoke()},10),CT(()=>e.apply(n,arguments))}},bT=(e,t)=>function(){let n;for(let e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&(t&&(n||(n=CT(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",pT,{},pT,pT)))),arguments[e]=wT(arguments[e],n));const r=_T(()=>e.apply(this,arguments));if(!t){if(r instanceof T){const e=vT();return r.pipe(se(e.outsideAngular),ie(e.insideAngular))}return CT(()=>r)}return r instanceof T?r.pipe(ET):r instanceof Promise?CT(()=>new Promise((e,t)=>r.then(t=>CT(()=>e(t)),e=>CT(()=>t(e))))):"function"==typeof r&&n?function(){return setTimeout(()=>{n&&"scheduled"===n.state&&n.invoke()},10),r.apply(this,arguments)}:CT(()=>r)};class ST{constructor(e){return e}}class PT{constructor(){return xb()}}const OT=new or("angularfire2._apps"),TT={provide:ST,useFactory:function(e){return e&&1===e.length?e[0]:new ST(Mb())},deps:[[new Mr,OT]]},IT={provide:PT,deps:[[new Mr,OT]]};function kT(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new ST(r)}}let AT=(()=>{class e{constructor(e){Rb("angularfire",cT.full,"core"),Rb("angularfire",cT.full,"app"),Rb("angular",pl.full,e.toString())}}return e.\u0275fac=function(t){return new(t||e)(Or(zu))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[TT,IT]}),e})();const NT=bT(Nb,!0),MT=new Map,xT={activated:!1,tokenObservers:[]},RT={initialized:!1,enabled:!1};function DT(e){return MT.get(e)||xT}function LT(e,t){MT.set(e,t)}function FT(){return RT}class BT{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return dw(function*(){t.stop();try{t.pending=new kw,yield function(e){return new Promise(t=>{setTimeout(t,e)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new kw,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(n){t.retryPolicy(n)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const VT=new Uw("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function UT(e){if(!DT(e).activated)throw VT.create("use-before-activation",{appName:e.name})}function $T(e,t){return zT.apply(this,arguments)}function zT(){return(zT=dw(function*({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=yield fetch(e,s)}catch(h){throw VT.create("fetch-network-error",{originalErrorMessage:h.message})}if(200!==o.status)throw VT.create("fetch-status-error",{httpStatus:o.status});try{a=yield o.json()}catch(h){throw VT.create("fetch-parse-error",{originalErrorMessage:h.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw VT.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=1e3*Number(c[1]),u=Date.now();return{token:a.attestationToken,expireTimeMillis:u+l,issuedAtTimeMillis:u}})).apply(this,arguments)}function HT(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}const GT="firebase-app-check-store";let qT=null;function WT(){return qT||(qT=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(VT.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(GT,{keyPath:"compositeKey"})}}}catch(n){t(VT.create("storage-open",{originalErrorMessage:n.message}))}}),qT)}function jT(){return(jT=dw(function*(e,t){const n=(yield WT()).transaction(GT,"readwrite"),r=n.objectStore(GT).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(VT.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})})).apply(this,arguments)}const ZT=new yb("@firebase/app-check");function YT(e,t){return Lw()?function(e,t){return function(e,t){return jT.apply(this,arguments)}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{ZT.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function KT(){return FT().enabled}function JT(){return QT.apply(this,arguments)}function QT(){return(QT=dw(function*(){const e=FT();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const XT={error:"UNKNOWN_ERROR"};function eI(e){return ww.encodeString(JSON.stringify(e),!1)}function tI(e){return nI.apply(this,arguments)}function nI(){return(nI=dw(function*(e,t=!1){const n=e.app;UT(n);const r=DT(n);let i,s=r.token;if(!s){const e=yield r.cachedTokenPromise;e&&oI(e)&&(s=e)}if(!t&&s&&oI(s))return{token:s.token};let o,a=!1;if(KT()){r.exchangeTokenPromise||(r.exchangeTokenPromise=$T(HT(n,yield JT()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=yield r.exchangeTokenPromise;return yield YT(n,t),LT(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=yield r.exchangeTokenPromise}catch(c){"appCheck/throttled"===c.code?ZT.warn(c.message):ZT.error(c),i=c}return s?(o={token:s.token},LT(n,Object.assign(Object.assign({},r),{token:s})),yield YT(n,s)):o=aI(i),a&&sI(n,o),o})).apply(this,arguments)}function rI(e,t){const n=DT(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),LT(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function iI(e){const{app:t}=e,n=DT(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new BT(dw(function*(){let n;if(n=DT(t).token?yield tI(e,!0):yield tI(e),n.error)throw n.error}),()=>!0,()=>{const e=DT(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),LT(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function sI(e,t){const n=DT(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch{}}function oI(e){return e.expireTimeMillis-Date.now()>0}function aI(e){return{token:eI(XT),error:e}}class cI{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=DT(this.app);for(const t of e)rI(this.app,t.next);return Promise.resolve()}}const lI="app-check-internal";Ob(new ab("app-check",e=>function(e,t){return new cI(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("platform-logger")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(lI).initialize()})),Ob(new ab(lI,e=>function(e){return{getToken:t=>tI(e,t),addTokenListener:t=>function(e,t,n,r){const{app:i}=e,s=DT(i),o={next:n,error:r,type:t};if(LT(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&oI(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),iI(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>iI(e))}(e,"INTERNAL",t),removeTokenListener:t=>rI(e.app,t)}}(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),Rb("@firebase/app-check","0.5.3");class uI{constructor(){return fT("app-check")}}"undefined"!=typeof window&&window;const hI=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},dI=new Uw("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),fI=new yb("@firebase/auth");function pI(e,...t){fI.logLevel<=db.ERROR&&fI.error(`Auth (9.6.6): ${e}`,...t)}function gI(e,...t){throw _I(e,...t)}function mI(e,...t){return _I(e,...t)}function yI(e,t,n){const r=Object.assign(Object.assign({},hI()),{[t]:n});return new Uw("auth","Firebase",r).create(t,{appName:e.name})}function vI(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&gI(e,"argument-error"),yI(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function _I(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return dI.create(e,...t)}function CI(e,t,...n){if(!e)throw _I(t,...n)}function EI(e){const t="INTERNAL ASSERTION FAILED: "+e;throw pI(t),new Error(t)}function wI(e,t){e||EI(t)}const bI=new Map;function SI(e){wI(e instanceof Function,"Expected a class definition");let t=bI.get(e);return t?(wI(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,bI.set(e,t),t)}function PI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function OI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class TI{constructor(e,t){this.shortDelay=e,this.longDelay=t,wI(t>e,"Short delay should be less than long delay!"),this.isMobile=Mw()||Rw()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===OI()||"https:"===OI()||xw()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function II(e,t){wI(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class kI{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void EI("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void EI("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void EI("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const AI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},NI=new TI(3e4,6e4);function MI(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function xI(e,t,n,r){return RI.apply(this,arguments)}function RI(){return(RI=dw(function*(e,t,n,r,i={}){return DI(e,i,dw(function*(){let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=Jw(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),kI.fetch()(VI(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))})).apply(this,arguments)}function DI(e,t,n){return LI.apply(this,arguments)}function LI(){return(LI=dw(function*(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},AI),t);try{const t=new UI(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw $I(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw $I(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw $I(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw yI(e,a,o);gI(e,a)}}catch(i){if(i instanceof Vw)throw i;gI(e,"network-request-failed")}})).apply(this,arguments)}function FI(e,t,n,r){return BI.apply(this,arguments)}function BI(){return(BI=dw(function*(e,t,n,r,i={}){const s=yield xI(e,t,n,r,i);return"mfaPendingCredential"in s&&gI(e,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function VI(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?II(e.config,i):`${e.config.apiScheme}://${i}`}class UI{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(mI(this.auth,"network-request-failed")),NI.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $I(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=mI(e,t,r);return i.customData._tokenResponse=n,i}function zI(){return(zI=dw(function*(e,t){return xI(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function HI(e,t){return GI.apply(this,arguments)}function GI(){return(GI=dw(function*(e,t){return xI(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function qI(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function WI(){return(WI=dw(function*(e,t=!1){const n=ob(e),r=yield n.getIdToken(t),i=ZI(r);CI(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:qI(jI(i.auth_time)),issuedAtTime:qI(jI(i.iat)),expirationTime:qI(jI(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function jI(e){return 1e3*Number(e)}function ZI(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return pI("JWT malformed, contained fewer than 3 sections"),null;try{const e=Pw(n);return e?JSON.parse(e):(pI("Failed to decode base64 JWT payload"),null)}catch(i){return pI("Caught error parsing JWT payload as JSON",i),null}}function YI(e,t){return KI.apply(this,arguments)}function KI(){return(KI=dw(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(r){throw r instanceof Vw&&JI(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})).apply(this,arguments)}function JI({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class QI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(dw(function*(){yield t.iteration()}),n)}iteration(){var e=this;return dw(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&e.schedule(!0))}e.schedule()})()}}class XI{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=qI(this.lastLoginAt),this.creationTime=qI(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ek(e){return tk.apply(this,arguments)}function tk(){return(tk=dw(function*(e){var t;const n=e.auth,r=yield e.getIdToken(),i=yield YI(e,HI(n,{idToken:r}));CI(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?ik(s.providerUserInfo):[],a=rk(e.providerData,o),c=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new XI(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(e,l)})).apply(this,arguments)}function nk(){return(nk=dw(function*(e){const t=ob(e);yield ek(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function rk(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function ik(e){return e.map(e=>{var{providerId:t}=e,n=L(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function sk(){return(sk=dw(function*(e,t){const n=yield DI(e,{},dw(function*(){const n=Jw({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=VI(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",kI.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class ok{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){CI(e.idToken,"internal-error"),CI(void 0!==e.idToken,"internal-error"),CI(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=ZI(e);return CI(t,"internal-error"),CI(void 0!==t.exp,"internal-error"),CI(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return dw(function*(){return CI(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return dw(function*(){const{accessToken:r,refreshToken:i,expiresIn:s}=yield function(e,t){return sk.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(r,i,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ok;return n&&(CI("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(CI("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(CI("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ok,this.toJSON())}_performRefresh(){return EI("not implemented")}}function ak(e,t){CI("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ck{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=L(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new QI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new XI(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){var t=this;return dw(function*(){const n=yield YI(t,t.stsTokenManager.getToken(t.auth,e));return CI(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return WI.apply(this,arguments)}(this,e)}reload(){return function(e){return nk.apply(this,arguments)}(this)}_assign(e){this!==e&&(CI(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new ck(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){CI(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return dw(function*(){let r=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ek(n)),yield n.auth._persistUserIfCurrent(n),r&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return dw(function*(){const t=yield e.getIdToken();return yield YI(e,function(e,t){return zI.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:_,isAnonymous:C,providerData:E,stsTokenManager:w}=t;CI(v&&w,e,"internal-error");const b=ok.fromJSON(this.name,w);CI("string"==typeof v,e,"internal-error"),ak(u,e.name),ak(h,e.name),CI("boolean"==typeof _,e,"internal-error"),CI("boolean"==typeof C,e,"internal-error"),ak(d,e.name),ak(f,e.name),ak(p,e.name),ak(g,e.name),ak(m,e.name),ak(y,e.name);const S=new ck({uid:v,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:C,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:b,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(S.providerData=E.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static _fromIdTokenResponse(e,t,n=!1){return dw(function*(){const r=new ok;r.updateFromServerResponse(t);const i=new ck({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield ek(i),i})()}}const lk=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return dw(function*(){return!0})()}_set(e,t){var n=this;return dw(function*(){n.storage[e]=t})()}_get(e){var t=this;return dw(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return dw(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function uk(e,t,n){return`firebase:${e}:${t}:${n}`}class hk{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=uk(this.userKey,r.apiKey,i),this.fullPersistenceKey=uk("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return dw(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?ck._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return dw(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return dw(function*(){if(!t.length)return new hk(SI(lk),e,n);const r=(yield Promise.all(t.map(function(){var e=dw(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let i=r[0]||SI(lk);const s=uk(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){const r=ck._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&(yield i._set(s,o.toJSON())),yield Promise.all(t.map(function(){var e=dw(function*(e){if(e!==i)try{yield e._remove(s)}catch{}});return function(t){return e.apply(this,arguments)}}())),new hk(i,e,n)):new hk(i,e,n)})()}}function dk(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(mk(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(fk(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(vk(t))return"Blackberry";if(_k(t))return"Webos";if(pk(t))return"Safari";if((t.includes("chrome/")||gk(t))&&!t.includes("edge/"))return"Chrome";if(yk(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function fk(e=Nw()){return/firefox\//i.test(e)}function pk(e=Nw()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function gk(e=Nw()){return/crios\//i.test(e)}function mk(e=Nw()){return/iemobile/i.test(e)}function yk(e=Nw()){return/android/i.test(e)}function vk(e=Nw()){return/blackberry/i.test(e)}function _k(e=Nw()){return/webos/i.test(e)}function Ck(e=Nw()){return/iphone|ipad|ipod/i.test(e)}function Ek(e=Nw()){return Ck(e)||yk(e)||_k(e)||vk(e)||/windows phone/i.test(e)||mk(e)}function wk(e,t=[]){let n;switch(e){case"Browser":n=dk(Nw());break;case"Worker":n=`${dk(Nw())}-${e}`;break;default:n=e}return`${n}/JsCore/9.6.6/${t.length?t.join(","):"FirebaseCore-web"}`}class bk{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Pk(this),this.idTokenSubscription=new Pk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dI,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=SI(t)),this._initializationPromise=this.queue(dw(function*(){var r,i;if(!n._deleted&&(n.persistenceManager=yield hk.create(n,e),!n._deleted)){if(null===(r=n._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(i=n.currentUser)||void 0===i?void 0:i.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return dw(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t)}})()}initializeCurrentUser(e){var t=this;return dw(function*(){var n;let r=yield t.assertedPersistence.getCurrentUser();if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const i=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null==r?void 0:r._redirectEventId,o=yield t.tryRedirectSignIn(e);(!i||i===s)&&(null==o?void 0:o.user)&&(r=o.user)}return r?r._redirectEventId?(CI(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===r._redirectEventId?t.directlySetCurrentUser(r):t.reloadAndSetCurrentUserOrClear(r)):t.reloadAndSetCurrentUserOrClear(r):t.directlySetCurrentUser(null)})()}tryRedirectSignIn(e){var t=this;return dw(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return dw(function*(){try{yield ek(e)}catch(n){if("auth/network-request-failed"!==n.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return dw(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return dw(function*(){const n=e?ob(e):null;return n&&CI(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e){var t=this;return dw(function*(){if(!t._deleted)return e&&CI(t.tenantId===e.tenantId,t,"tenant-id-mismatch"),t.queue(dw(function*(){yield t.directlySetCurrentUser(e),t.notifyAuthListeners()}))})()}signOut(){var e=this;return dw(function*(){return(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null)})()}setPersistence(e){var t=this;return this.queue(dw(function*(){yield t.assertedPersistence.setPersistence(SI(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Uw("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return dw(function*(){const r=yield n.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return dw(function*(){if(!t.redirectPersistenceManager){const n=e&&SI(e)||t._popupRedirectResolver;CI(n,t,"argument-error"),t.redirectPersistenceManager=yield hk.create(t,[SI(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return dw(function*(){var n,r;return t._isInitialized&&(yield t.queue(dw(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return dw(function*(){if(e===t.currentUser)return t.queue(dw(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return CI(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return dw(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return CI(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return dw(function*(){const t={"X-Client-Version":e.clientVersion};return e.app.options.appId&&(t["X-Firebase-gmpid"]=e.app.options.appId),t})()}}function Sk(e){return ob(e)}class Pk{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new tb(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return CI(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ok(e,t,n){const r=Sk(e);CI(r._canInitEmulator,r,"emulator-config-failed"),CI(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Tk(t),{host:o,port:a}=function(e){const t=Tk(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ik(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ik(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Tk(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ik(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class kk{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return EI("not implemented")}_getIdTokenResponse(e){return EI("not implemented")}_linkToIdToken(e,t){return EI("not implemented")}_getReauthenticationResolver(e){return EI("not implemented")}}function Ak(){return(Ak=dw(function*(e,t){return xI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Nk(){return(Nk=dw(function*(e,t){return FI(e,"POST","/v1/accounts:signInWithPassword",MI(e,t))})).apply(this,arguments)}function Mk(e,t){return xk.apply(this,arguments)}function xk(){return(xk=dw(function*(e,t){return xI(e,"POST","/v1/accounts:sendOobCode",MI(e,t))})).apply(this,arguments)}function Rk(e,t){return Dk.apply(this,arguments)}function Dk(){return(Dk=dw(function*(e,t){return Mk(e,t)})).apply(this,arguments)}function Lk(e,t){return Fk.apply(this,arguments)}function Fk(){return(Fk=dw(function*(e,t){return Mk(e,t)})).apply(this,arguments)}function Bk(){return(Bk=dw(function*(e,t){return FI(e,"POST","/v1/accounts:signInWithEmailLink",MI(e,t))})).apply(this,arguments)}function Vk(){return(Vk=dw(function*(e,t){return FI(e,"POST","/v1/accounts:signInWithEmailLink",MI(e,t))})).apply(this,arguments)}class Uk extends kk{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Uk(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Uk(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return dw(function*(){switch(t.signInMethod){case"password":return function(e,t){return Nk.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return Bk.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:gI(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return dw(function*(){switch(n.signInMethod){case"password":return function(e,t){return Ak.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return Vk.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:gI(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function $k(e,t){return zk.apply(this,arguments)}function zk(){return(zk=dw(function*(e,t){return FI(e,"POST","/v1/accounts:signInWithIdp",MI(e,t))})).apply(this,arguments)}class Hk extends kk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hk(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):gI("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=L(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Hk(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return $k(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,$k(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$k(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Jw(t)}return e}}class Gk{constructor(e){var t,n,r,i,s,o;const a=Qw(Xw(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);CI(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Qw(Xw(e)).link,n=t?Qw(Xw(t)).deep_link_id:null,r=Qw(Xw(e)).deep_link_id;return(r?Qw(Xw(r)).link:null)||r||n||t||e}(e);try{return new Gk(t)}catch{return null}}}let qk=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Uk._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Gk.parseLink(t);return CI(n,"argument-error"),Uk._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class Wk{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class jk extends Wk{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let Zk=(()=>{class e extends jk{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Hk._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})();function Yk(e,t){return Kk.apply(this,arguments)}function Kk(){return(Kk=dw(function*(e,t){return FI(e,"POST","/v1/accounts:signUp",MI(e,t))})).apply(this,arguments)}class Jk{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return dw(function*(){const i=yield ck._fromIdTokenResponse(e,n,r),s=Qk(n);return new Jk({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return dw(function*(){yield e._updateTokensIfNecessary(n,!0);const r=Qk(n);return new Jk({user:e,providerId:r,_tokenResponse:n,operationType:t})})()}}function Qk(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Xk extends Vw{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Xk.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Xk(e,t,n,r)}}function eA(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw"auth/multi-factor-auth-required"===n.code?Xk._fromErrorAndOperation(e,n,t,r):n})}function tA(e,t){return nA.apply(this,arguments)}function nA(){return(nA=dw(function*(e,t,n=!1){const r=yield YI(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return Jk._forOperation(e,"link",r)})).apply(this,arguments)}function rA(){return(rA=dw(function*(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=yield YI(e,eA(r,i,t,e),n);CI(s.idToken,r,"internal-error");const o=ZI(s.idToken);CI(o,r,"internal-error");const{sub:a}=o;return CI(e.uid===a,r,"user-mismatch"),Jk._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&gI(r,"user-mismatch"),s}})).apply(this,arguments)}function iA(e,t){return sA.apply(this,arguments)}function sA(){return(sA=dw(function*(e,t,n=!1){const r="signIn",i=yield eA(e,r,t),s=yield Jk._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function oA(){return(oA=dw(function*(e,t){return iA(Sk(e),t)})).apply(this,arguments)}function aA(e,t,n){var r;CI((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),CI(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(CI(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(CI(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function cA(e,t,n){return lA.apply(this,arguments)}function lA(){return(lA=dw(function*(e,t,n){const r=ob(e),i={requestType:"PASSWORD_RESET",email:t};n&&aA(r,i,n),yield Lk(r,i)})).apply(this,arguments)}function uA(e,t,n){return hA.apply(this,arguments)}function hA(){return(hA=dw(function*(e,t,n){const r=Sk(e),i=yield Yk(r,{returnSecureToken:!0,email:t,password:n}),s=yield Jk._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(s.user),s})).apply(this,arguments)}function dA(e,t,n){return function(e,t){return oA.apply(this,arguments)}(ob(e),qk.credential(t,n))}function fA(e,t){return pA.apply(this,arguments)}function pA(){return(pA=dw(function*(e,t){const n=ob(e),r={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&aA(n.auth,r,t);const{email:i}=yield Rk(n.auth,r);i!==e.email&&(yield e.reload())})).apply(this,arguments)}function gA(e,t){return mA.apply(this,arguments)}function mA(){return(mA=dw(function*(e,t){return xI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function yA(e,t){return vA.apply(this,arguments)}function vA(){return(vA=dw(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=ob(e),i={idToken:yield r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield YI(r,gA(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),yield r._updateTokensIfNecessary(s)})).apply(this,arguments)}function _A(e,t,n,r){return ob(e).onAuthStateChanged(t,n,r)}new WeakMap;const CA="__sak";class EA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(CA,"1"),this.storage.removeItem(CA),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const wA=(()=>{class e extends EA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Nw();return pk(e)||Ck(e)}()&&function(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Ek(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Dw()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return dw(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return dw(function*(){const r=yield t().call(n,e);return n.localCache[e]=JSON.stringify(r),r})()}_remove(e){var t=()=>super._remove,n=this;return dw(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),bA=(()=>{class e extends EA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let SA=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return dw(function*(){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=t.handlersMap[i];if(!(null==o?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(function(){var e=dw(function*(e){return e(n.origin,s)});return function(t){return e.apply(this,arguments)}}()),c=yield function(e){return Promise.all(e.map(function(){var e=dw(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function PA(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class OA{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return dw(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const l=PA("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function TA(){return window}function IA(){return void 0!==TA().WorkerGlobalScope&&"function"==typeof TA().importScripts}function kA(){return(kA=dw(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const AA="firebaseLocalStorageDb",NA="firebaseLocalStorage",MA="fbase_key";class xA{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function RA(e,t){return e.transaction([NA],t?"readwrite":"readonly").objectStore(NA)}function DA(){const e=indexedDB.open(AA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(NA,{keyPath:MA})}catch(r){n(r)}}),e.addEventListener("success",dw(function*(){const n=e.result;n.objectStoreNames.contains(NA)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(AA);return new xA(e).toPromise()}(),t(yield DA()))}))})}function LA(e,t,n){return FA.apply(this,arguments)}function FA(){return(FA=dw(function*(e,t,n){const r=RA(e,!0).put({[MA]:t,value:n});return new xA(r).toPromise()})).apply(this,arguments)}function BA(){return(BA=dw(function*(e,t){const n=RA(e,!1).get(t),r=yield new xA(n).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function VA(e,t){const n=RA(e,!0).delete(t);return new xA(n).toPromise()}const UA=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return dw(function*(){return e.db||(e.db=yield DA()),e.db})()}_withRetries(e){var t=this;return dw(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(r){if(n++>3)throw r;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return dw(function*(){return IA()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return dw(function*(){e.receiver=SA._getInstance(IA()?self:null),e.receiver._subscribe("keyChanged",function(){var t=dw(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=dw(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return dw(function*(){var t,n;if(e.activeServiceWorker=yield function(){return kA.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new OA(e.activeServiceWorker);const r=yield e.sender._send("ping",{},800);!r||(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return dw(function*(){if(t.sender&&t.activeServiceWorker&&function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return dw(function*(){try{if(!indexedDB)return!1;const e=yield DA();return yield LA(e,CA,"1"),yield VA(e,CA),!0}catch{}return!1})()}_withPendingWrite(e){var t=this;return dw(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return dw(function*(){return n._withPendingWrite(dw(function*(){return yield n._withRetries(n=>LA(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return dw(function*(){const n=yield t._withRetries(t=>function(e,t){return BA.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return dw(function*(){return t._withPendingWrite(dw(function*(){return yield t._withRetries(t=>VA(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return dw(function*(){const t=yield e._withRetries(e=>{const t=RA(e,!1).getAll();return new xA(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of t)r.add(i),JSON.stringify(e.localCache[i])!==JSON.stringify(s)&&(e.notifyListeners(i,s),n.push(i));for(const i of Object.keys(e.localCache))e.localCache[i]&&!r.has(i)&&(e.notifyListeners(i,null),n.push(i));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval(dw(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function $A(e){return`__${e}${Math.floor(1e6*Math.random())}`}function zA(e,t){return t?SI(t):(CI(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}$A("rcb"),new TI(3e4,6e4);class HA extends kk{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $k(e,this._buildIdpRequest())}_linkToIdToken(e,t){return $k(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return $k(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function GA(e){return iA(e.auth,new HA(e),e.bypassAuthState)}function qA(e){const{auth:t,user:n}=e;return CI(n,t,"internal-error"),function(e,t){return rA.apply(this,arguments)}(n,new HA(e),e.bypassAuthState)}function WA(e){return jA.apply(this,arguments)}function jA(){return(jA=dw(function*(e){const{auth:t,user:n}=e;return CI(n,t,"internal-error"),tA(n,new HA(e),e.bypassAuthState)})).apply(this,arguments)}class ZA{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=dw(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(r){e.reject(r)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return dw(function*(){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const c={auth:t.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(c))}catch(l){t.reject(l)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return GA;case"linkViaPopup":case"linkViaRedirect":return WA;case"reauthViaPopup":case"reauthViaRedirect":return qA;default:gI(this.auth,"internal-error")}}resolve(e){wI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){wI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const YA=new TI(2e3,1e4);function KA(e,t,n){return JA.apply(this,arguments)}function JA(){return(JA=dw(function*(e,t,n){const r=Sk(e);vI(e,t,Wk);const i=zA(r,n);return new QA(r,"signInViaPopup",t,i).executeNotNull()})).apply(this,arguments)}let QA=(()=>{class e extends ZA{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return dw(function*(){const t=yield e.execute();return CI(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return dw(function*(){wI(1===e.filter.length,"Popup operations only handle one event");const t=PA();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(mI(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(mI(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(mI(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,YA.get())};e()}}return e.currentPopupAction=null,e})();const XA=new Map;class eN extends ZA{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return dw(function*(){let n=XA.get(t.auth._key());if(!n){try{const r=(yield function(e,t){return tN.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(r)}catch(r){n=()=>Promise.reject(r)}XA.set(t.auth._key(),n)}return t.bypassAuthState||XA.set(t.auth._key(),()=>Promise.resolve(null)),n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return dw(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const r=yield n.auth._redirectUserForId(e.eventId);if(r)return n.user=r,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return dw(function*(){})()}cleanUp(){}}function tN(){return(tN=dw(function*(e,t){const n=rN(t),r=nN(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})).apply(this,arguments)}function nN(e){return SI(e._redirectPersistence)}function rN(e){return uk("pendingRedirect",e.config.apiKey,e.name)}function iN(e,t){return sN.apply(this,arguments)}function sN(){return(sN=dw(function*(e,t,n=!1){const r=Sk(e),i=zA(r,t),s=yield new eN(r,i,n).execute();return s&&!n&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})).apply(this,arguments)}class oN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return cN(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!cN(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(mI(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(aN(e))}saveEventToCache(e){this.cachedEventUids.add(aN(e)),this.lastProcessedEventTime=Date.now()}}function aN(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function cN({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function lN(e){return uN.apply(this,arguments)}function uN(){return(uN=dw(function*(e,t={}){return xI(e,"GET","/v1/projects",t)})).apply(this,arguments)}const hN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dN=/^https?/;function fN(){return(fN=dw(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield lN(e);for(const n of t)try{if(pN(n))return}catch{}gI(e,"unauthorized-domain")})).apply(this,arguments)}function pN(e){const t=PI(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!dN.test(n))return!1;if(hN.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const gN=new TI(3e4,6e4);function mN(){const e=TA().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let yN=null;function vN(e){return yN=yN||function(e){return new Promise((t,n)=>{var r,i,s;function o(){mN(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{mN(),n(mI(e,"network-request-failed"))},timeout:gN.get()})}if(null===(i=null===(r=TA().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=TA().gapi)||void 0===s?void 0:s.load)){const t=$A("iframefcb");return TA()[t]=()=>{gapi.load?o():n(mI(e,"network-request-failed"))},function(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=mI("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw yN=null,e})}(e),yN}const _N=new TI(5e3,15e3),CN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wN(e){const t=e.config;CI(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?II(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Ab},i=EN.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Jw(r).slice(1)}`}function bN(){return(bN=dw(function*(e){const t=yield vN(e),n=TA().gapi;return CI(n,e,"internal-error"),t.open({where:document.body,url:wN(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:CN,dontclear:!0},t=>new Promise(function(){var n=dw(function*(n,r){yield t.restyle({setHideOnLeave:!1});const i=mI(e,"network-request-failed"),s=TA().setTimeout(()=>{r(i)},_N.get());function o(){TA().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const SN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class PN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ON(e,t,n,r,i,s){CI(e.config.authDomain,e,"auth-domain-config-required"),CI(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ab,eventId:i};if(t instanceof Wk){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",jw(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof jk){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const c of Object.keys(a))void 0===a[c]&&delete a[c];return`${function({config:e}){return e.emulator?II(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Jw(a).slice(1)}`}const TN="webStorageSupport",IN=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bA,this._completeRedirectFn=iN}_openPopup(e,t,n,r){var i=this;return dw(function*(){var s;wI(null===(s=i.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");const o=ON(e,t,n,PI(),r);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},SN),{width:r.toString(),height:i.toString(),top:s,left:o}),l=Nw().toLowerCase();n&&(a=gk(l)?"_blank":n),fk(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=Nw()){var t;return Ck(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new PN(null);const h=window.open(t||"",a,u);CI(h,e,"popup-blocked");try{h.focus()}catch{}return new PN(h)}(e,o,PA())})()}_openRedirect(e,t,n,r){var i=this;return dw(function*(){return yield i._originValidation(e),function(e){TA().location.href=e}(ON(e,t,n,PI(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(wI(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){var t=this;return dw(function*(){const n=yield function(e){return bN.apply(this,arguments)}(e),r=new oN(e);return n.register("authEvent",t=>(CI(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=n,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(TN,{type:TN},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[TN];void 0!==i&&t(!!i),gI(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return fN.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ek()||pk()||Ck()}};var kN="@firebase/auth";class AN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return dw(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){CI(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function NN(e=Mb()){const t=Tb(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=Tb(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Yw(n.getOptions(),t??{}))return e;gI(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:IN,persistence:[UA,wA,bA]})}!function(e){Ob(new ab("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),{apiKey:i,authDomain:s}=r.options;return(t=>{CI(i&&!i.includes(":"),"invalid-api-key",{appName:t.name}),CI(!(null==s?void 0:s.includes(":")),"argument-error",{appName:t.name});const r={apiKey:i,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wk(e)},o=new bk(t,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(SI);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,n),o})(r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Ob(new ab("auth-internal",e=>{const t=Sk(e.getProvider("auth").getImmediate());return new AN(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rb(kN,"0.19.8",void 0),Rb(kN,"0.19.8","esm2017")}("Browser");class MN{constructor(e){return e}}class xN{constructor(){return fT("auth")}}const RN=new or("angularfire2.auth-instances");function DN(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new MN(r)}}const LN={provide:xN,deps:[[new Mr,RN]]},FN={provide:MN,useFactory:function(e,t){const n=dT("auth",e,t);return n&&new MN(n)},deps:[[new Mr,RN],ST]};let BN=(()=>{class e{constructor(){Rb("angularfire",cT.full,"auth")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[FN,LN]}),e})();const VN=bT(Ok,!0),UN=bT(uA,!0),$N=bT(NN,!0),zN=bT(_A,!0),HN=bT(fA,!0),GN=bT(cA,!0),qN=bT(dA,!0),WN=bT(KA,!0),jN=bT(yA,!0);var ZN,YN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},KN={},JN=JN||{},QN=YN||self;function XN(){}function eM(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function tM(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var nM="closure_uid_"+(1e9*Math.random()>>>0),rM=0;function iM(e,t,n){return e.call.apply(e.bind,arguments)}function sM(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function oM(e,t,n){return(oM=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?iM:sM).apply(null,arguments)}function aM(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function cM(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function lM(){this.s=this.s,this.o=this.o}var uM={};lM.prototype.s=!1,lM.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,nM)&&e[nM]||(e[nM]=++rM)}(this);delete uM[e]}},lM.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const hM=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},dM=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function fM(e){return Array.prototype.concat.apply([],arguments)}function pM(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function gM(e){return/^[\s\xa0]*$/.test(e)}var mM,yM=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function vM(e,t){return-1!=e.indexOf(t)}function _M(e,t){return e<t?-1:e>t?1:0}e:{var CM=QN.navigator;if(CM){var EM=CM.userAgent;if(EM){mM=EM;break e}}mM=""}function wM(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function bM(e){const t={};for(const n in e)t[n]=e[n];return t}var SM="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function PM(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<SM.length;t++)n=SM[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function OM(e){return OM[" "](e),e}OM[" "]=XN;var TM,IM=vM(mM,"Opera"),kM=vM(mM,"Trident")||vM(mM,"MSIE"),AM=vM(mM,"Edge"),NM=AM||kM,MM=vM(mM,"Gecko")&&!(vM(mM.toLowerCase(),"webkit")&&!vM(mM,"Edge"))&&!(vM(mM,"Trident")||vM(mM,"MSIE"))&&!vM(mM,"Edge"),xM=vM(mM.toLowerCase(),"webkit")&&!vM(mM,"Edge");function RM(){var e=QN.document;return e?e.documentMode:void 0}e:{var DM="",LM=function(){var e=mM;return MM?/rv:([^\);]+)(\)|;)/.exec(e):AM?/Edge\/([\d\.]+)/.exec(e):kM?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):xM?/WebKit\/(\S+)/.exec(e):IM?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(LM&&(DM=LM?LM[1]:""),kM){var FM=RM();if(null!=FM&&FM>parseFloat(DM)){TM=String(FM);break e}}TM=DM}var BM={};function VM(){return e=BM,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=yM(String(TM)).split("."),n=yM("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=_M(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||_M(0==i[2].length,0==s[2].length)||_M(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}var UM=QN.document&&kM&&(RM()||parseInt(TM,10))||void 0,$M=function(){if(!QN.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{QN.addEventListener("test",XN,t),QN.removeEventListener("test",XN,t)}catch{}return e}();function zM(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function HM(e,t){if(zM.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(MM){e:{try{OM(t.nodeName);var i=!0;break e}catch{}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:GM[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&HM.Z.h.call(this)}}zM.prototype.h=function(){this.defaultPrevented=!0},cM(HM,zM);var GM={2:"touch",3:"pen",4:"mouse"};HM.prototype.h=function(){HM.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var qM="closure_listenable_"+(1e6*Math.random()|0),WM=0;function jM(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++WM,this.ca=this.fa=!1}function ZM(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function YM(e){this.src=e,this.g={},this.h=0}function KM(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=hM(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ZM(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function JM(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}YM.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=JM(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new jM(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var QM="closure_lm_"+(1e6*Math.random()|0),XM={};function ex(e,t,n,r,i){if(r&&r.once)return nx(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ex(e,t[s],n,r,i);return null}return n=lx(n),e&&e[qM]?e.N(t,n,tM(r)?!!r.capture:!!r,i):tx(e,t,n,!1,r,i)}function tx(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=tM(i)?!!i.capture:!!i,a=ax(e);if(a||(e[QM]=a=new YM(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=ox;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)$M||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(sx(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function nx(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)nx(e,t[s],n,r,i);return null}return n=lx(n),e&&e[qM]?e.O(t,n,tM(r)?!!r.capture:!!r,i):tx(e,t,n,!0,r,i)}function rx(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)rx(e,t[s],n,r,i);else r=tM(r)?!!r.capture:!!r,n=lx(n),e&&e[qM]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=JM(s=e.g[t],n,r,i))&&(ZM(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ax(e))&&(t=e.g[t.toString()],e=-1,t&&(e=JM(t,n,r,i)),(n=-1<e?t[e]:null)&&ix(n))}function ix(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[qM])KM(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(sx(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ax(t))?(KM(n,e),0==n.h&&(n.src=null,t[QM]=null)):ZM(e)}}}function sx(e){return e in XM?XM[e]:XM[e]="on"+e}function ox(e,t){if(e.ca)e=!0;else{t=new HM(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&ix(e),e=n.call(r,t)}return e}function ax(e){return(e=e[QM])instanceof YM?e:null}var cx="__closure_events_fn_"+(1e9*Math.random()>>>0);function lx(e){return"function"==typeof e?e:(e[cx]||(e[cx]=function(t){return e.handleEvent(t)}),e[cx])}function ux(){lM.call(this),this.i=new YM(this),this.P=this,this.I=null}function hx(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new zM(t,e);else if(t instanceof zM)t.target=t.target||e;else{var i=t;PM(t=new zM(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=dx(o,r,!0,t)&&i}if(i=dx(o=t.g=e,r,!0,t)&&i,i=dx(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=dx(o=t.g=n[s],r,!1,t)&&i}function dx(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&KM(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}cM(ux,lM),ux.prototype[qM]=!0,ux.prototype.removeEventListener=function(e,t,n,r){rx(this,e,t,n,r)},ux.prototype.M=function(){if(ux.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ZM(n[r]);delete t.g[e],t.h--}}this.I=null},ux.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ux.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var fx=QN.JSON.stringify;function px(){var e=Ex;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var gx,mx=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new yx,e=>e.reset());class yx{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function vx(e){QN.setTimeout(()=>{throw e},0)}function _x(e,t){gx||function(){var e=QN.Promise.resolve(void 0);gx=function(){e.then(wx)}}(),Cx||(gx(),Cx=!0),Ex.add(e,t)}var Cx=!1,Ex=new class{constructor(){this.h=this.g=null}add(e,t){const n=mx.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function wx(){for(var e;e=px();){try{e.h.call(e.g)}catch(n){vx(n)}var t=mx;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Cx=!1}function bx(e,t){ux.call(this),this.h=e||1,this.g=t||QN,this.j=oM(this.kb,this),this.l=Date.now()}function Sx(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Px(e,t,n){if("function"==typeof e)n&&(e=oM(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=oM(e.handleEvent,e)}return 2147483647<Number(t)?-1:QN.setTimeout(e,t||0)}function Ox(e){e.g=Px(()=>{e.g=null,e.i&&(e.i=!1,Ox(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}cM(bx,ux),(ZN=bx.prototype).da=!1,ZN.S=null,ZN.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),hx(this,"tick"),this.da&&(Sx(this),this.start()))}},ZN.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ZN.M=function(){bx.Z.M.call(this),Sx(this),delete this.g};class Tx extends lM{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ox(this)}M(){super.M(),this.g&&(QN.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ix(e){lM.call(this),this.h=e,this.g={}}cM(Ix,lM);var kx=[];function Ax(e,t,n,r){Array.isArray(n)||(n&&(kx[0]=n.toString()),n=kx);for(var i=0;i<n.length;i++){var s=ex(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Nx(e){wM(e.g,function(e,t){this.g.hasOwnProperty(t)&&ix(e)},e),e.g={}}function Mx(){this.g=!0}function xx(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return fx(n)}catch{return t}}(e,n)+(r?" "+r:"")})}Ix.prototype.M=function(){Ix.Z.M.call(this),Nx(this)},Ix.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mx.prototype.Aa=function(){this.g=!1},Mx.prototype.info=function(){};var Rx={},Dx=null;function Lx(){return Dx=Dx||new ux}function Fx(e){zM.call(this,Rx.Ma,e)}function Bx(e){const t=Lx();hx(t,new Fx(t,e))}function Vx(e,t){zM.call(this,Rx.STAT_EVENT,e),this.stat=t}function Ux(e){const t=Lx();hx(t,new Vx(t,e))}function $x(e,t){zM.call(this,Rx.Na,e),this.size=t}function zx(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return QN.setTimeout(function(){e()},t)}Rx.Ma="serverreachability",cM(Fx,zM),Rx.STAT_EVENT="statevent",cM(Vx,zM),Rx.Na="timingevent",cM($x,zM);var Hx={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Gx={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function qx(){}function Wx(){}qx.prototype.h=null;var jx,Zx={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Yx(){zM.call(this,"d")}function Kx(){zM.call(this,"c")}function Jx(){}function Qx(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Ix(this),this.P=eR,this.W=new bx(e=NM?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Xx}function Xx(){this.i=null,this.g="",this.h=!1}cM(Yx,zM),cM(Kx,zM),cM(Jx,qx),Jx.prototype.g=function(){return new XMLHttpRequest},Jx.prototype.i=function(){return{}},jx=new Jx;var eR=45e3,tR={},nR={};function rR(e,t,n){e.K=1,e.v=OR(CR(t)),e.s=n,e.U=!0,iR(e,null)}function iR(e,t){e.F=Date.now(),cR(e),e.A=CR(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),VR(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Xx,e.g=VD(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Tx(oM(e.Ia,e,e.g),e.O)),Ax(e.V,e.g,"readystatechange",e.gb),t=e.H?bM(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Bx(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function sR(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function oR(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=aR(e,n),r==nR){4==t&&(e.o=4,Ux(14),i=!1),xx(e.j,e.m,null,"[Incomplete Response]");break}if(r==tR){e.o=4,Ux(15),xx(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}xx(e.j,e.m,r,null),fR(e,r)}sR(e)&&r!=nR&&r!=tR&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Ux(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ND(t),t.L=!0,Ux(11))):(xx(e.j,e.m,n,"[Invalid Chunked Response]"),dR(e),hR(e))}function aR(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?nR:(n=Number(t.substring(n,r)),isNaN(n)?tR:(r+=1)+n>t.length?nR:(t=t.substr(r,n),e.C=r+n,t))}function cR(e){e.Y=Date.now()+e.P,lR(e,e.P)}function lR(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=zx(oM(e.eb,e),t)}function uR(e){e.B&&(QN.clearTimeout(e.B),e.B=null)}function hR(e){0==e.l.G||e.I||RD(e.l,e)}function dR(e){uR(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Sx(e.W),Nx(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function fR(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||qR(n.i,e)))if(n.I=e.N,!e.J&&qR(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=zx(oM(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;xD(n),wD(n)}AD(n),Ux(18)}if(1>=GR(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else LD(n,11)}else if((e.J||n.g==e)&&xD(n),!gM(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.U=l[0],l=l[1],2==n.G)if("c"==l[0]){n.J=l[1],n.la=l[2];const t=l[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=l[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(vM(e,"spdy")||vM(e,"quic")||vM(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(WR(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,PR(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=BD(r,r.H?r.la:null,r.W),o.J){jR(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(uR(a),cR(a)),r.g=o}else kD(r);0<n.l.length&&PD(n)}else"stop"!=l[0]&&"close"!=l[0]||LD(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?LD(n,7):ED(n):"noop"!=l[0]&&n.j&&n.j.wa(l),n.A=0)}Bx(4)}catch{}}function pR(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(eM(e)||"string"==typeof e)dM(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(eM(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(eM(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function gR(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof gR)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function mR(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];yR(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)yR(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function yR(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(ZN=Qx.prototype).setTimeout=function(e){this.P=e},ZN.gb=function(e){e=e.target;const t=this.L;t&&3==mD(e)?t.l():this.Ia(e)},ZN.Ia=function(e){try{if(e==this.g)e:{const u=mD(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>u)&&(3!=u||NM||this.g&&(this.h.h||this.g.ga()||yD(this.g)))){this.I||4!=u||7==t||Bx(8==t||0>=h?3:2),uR(this);var n=this.g.ba();this.N=n;t:if(sR(this)){var r=yD(this.g);e="";var i=r.length,s=4==mD(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){dR(this),hR(this);var o="";break t}this.h.i=new QN.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!gM(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,Ux(12),dR(this),hR(this);break e}xx(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,fR(this,n)}this.U?(oR(this,u,o),NM&&this.i&&3==u&&(Ax(this.V,this.W,"tick",this.fb),this.W.start())):(xx(this.j,this.m,o,null),fR(this,o)),4==u&&dR(this),this.i&&!this.I&&(4==u?RD(this.l,this):(this.i=!1,cR(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Ux(12)):(this.o=0,Ux(13)),dR(this),hR(this)}}}catch{}},ZN.fb=function(){if(this.g){var e=mD(this.g),t=this.g.ga();this.C<t.length&&(uR(this),oR(this,e,t),this.i&&4!=e&&cR(this))}},ZN.cancel=function(){this.I=!0,dR(this)},ZN.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(Bx(3),Ux(17)),dR(this),this.o=2,hR(this)):lR(this,this.Y-e)},(ZN=gR.prototype).R=function(){mR(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},ZN.T=function(){return mR(this),this.g.concat()},ZN.get=function(e,t){return yR(this.h,e)?this.h[e]:t},ZN.set=function(e,t){yR(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},ZN.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var vR=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function _R(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof _R){this.g=void 0!==t?t:e.g,ER(this,e.j),this.s=e.s,wR(this,e.i),bR(this,e.m),this.l=e.l,t=e.h;var n=new DR;n.i=t.i,t.g&&(n.g=new gR(t.g),n.h=t.h),SR(this,n),this.o=e.o}else e&&(n=String(e).match(vR))?(this.g=!!t,ER(this,n[1]||"",!0),this.s=TR(n[2]||""),wR(this,n[3]||"",!0),bR(this,n[4]),this.l=TR(n[5]||"",!0),SR(this,n[6]||"",!0),this.o=TR(n[7]||"")):(this.g=!!t,this.h=new DR(null,this.g))}function CR(e){return new _R(e)}function ER(e,t,n){e.j=n?TR(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function wR(e,t,n){e.i=n?TR(t,!0):t}function bR(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function SR(e,t,n){t instanceof DR?(e.h=t,function(e,t){t&&!e.j&&(LR(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(FR(this,t),VR(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=IR(t,xR)),e.h=new DR(t,e.g))}function PR(e,t,n){e.h.set(t,n)}function OR(e){return PR(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function TR(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function IR(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,kR),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function kR(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}_R.prototype.toString=function(){var e=[],t=this.j;t&&e.push(IR(t,AR,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(IR(t,AR,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(IR(n,"/"==n.charAt(0)?MR:NR,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",IR(n,RR)),e.join("")};var AR=/[#\/\?@]/g,NR=/[#\?:]/g,MR=/[#\?]/g,xR=/[#\?@]/g,RR=/#/g;function DR(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function LR(e){e.g||(e.g=new gR,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function FR(e,t){LR(e),t=UR(e,t),yR(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,yR((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&mR(e)))}function BR(e,t){return LR(e),t=UR(e,t),yR(e.g.h,t)}function VR(e,t,n){FR(e,t),0<n.length&&(e.i=null,e.g.set(UR(e,t),pM(n)),e.h+=n.length)}function UR(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function $R(e){this.l=e||zR,e=QN.PerformanceNavigationTiming?0<(e=QN.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(QN.g&&QN.g.Ea&&QN.g.Ea()&&QN.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ZN=DR.prototype).add=function(e,t){LR(this),this.i=null,e=UR(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ZN.forEach=function(e,t){LR(this),this.g.forEach(function(n,r){dM(n,function(n){e.call(t,n,r,this)},this)},this)},ZN.T=function(){LR(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},ZN.R=function(e){LR(this);var t=[];if("string"==typeof e)BR(this,e)&&(t=fM(t,this.g.get(UR(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=fM(t,e[n])}return t},ZN.set=function(e,t){return LR(this),this.i=null,BR(this,e=UR(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ZN.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},ZN.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var zR=10;function HR(e){return!!e.h||!!e.g&&e.g.size>=e.j}function GR(e){return e.h?1:e.g?e.g.size:0}function qR(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function WR(e,t){e.g?e.g.add(t):e.h=t}function jR(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ZR(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return pM(e.i)}function YR(){}function KR(){this.g=new YR}function JR(e,t,n){const r=n||"";try{pR(e,function(e,n){let i=e;tM(e)&&(i=fx(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function QR(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function XR(e){this.l=e.$b||null,this.j=e.ib||!1}function eD(e,t){ux.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=tD,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$R.prototype.cancel=function(){if(this.i=ZR(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},YR.prototype.stringify=function(e){return QN.JSON.stringify(e,void 0)},YR.prototype.parse=function(e){return QN.JSON.parse(e,void 0)},cM(XR,qx),XR.prototype.g=function(){return new eD(this.l,this.j)},XR.prototype.i=function(e){return function(){return e}}({}),cM(eD,ux);var tD=0;function nD(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function rD(e){e.readyState=4,e.l=null,e.j=null,e.A=null,iD(e)}function iD(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ZN=eD.prototype).open=function(e,t){if(this.readyState!=tD)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,iD(this)},ZN.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||QN).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},ZN.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,rD(this)),this.readyState=tD},ZN.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,iD(this)),this.g&&(this.readyState=3,iD(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==QN.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nD(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},ZN.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?rD(this):iD(this),3==this.readyState&&nD(this)}},ZN.Ua=function(e){this.g&&(this.response=this.responseText=e,rD(this))},ZN.Ta=function(e){this.g&&(this.response=e,rD(this))},ZN.ha=function(){this.g&&rD(this)},ZN.setRequestHeader=function(e,t){this.v.append(e,t)},ZN.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ZN.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(eD.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var sD=QN.JSON.parse;function oD(e){ux.call(this),this.headers=new gR,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=aD,this.K=this.L=!1}cM(oD,ux);var aD="",cD=/^https?$/i,lD=["POST","PUT"];function uD(e){return"content-type"==e.toLowerCase()}function hD(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,dD(e),pD(e)}function dD(e){e.D||(e.D=!0,hx(e,"complete"),hx(e,"error"))}function fD(e){if(e.h&&void 0!==JN&&(!e.C[1]||4!=mD(e)||2!=e.ba()))if(e.v&&4==mD(e))Px(e.Fa,0,e);else if(hx(e,"readystatechange"),4==mD(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(vR)[1]||null;if(!i&&QN.self&&QN.self.location){var s=QN.self.location.protocol;i=s.substr(0,s.length-1)}r=!cD.test(i?i.toLowerCase():"")}n=r}if(n)hx(e,"complete"),hx(e,"success");else{e.m=6;try{var o=2<mD(e)?e.g.statusText:""}catch{o=""}e.j=o+" ["+e.ba()+"]",dD(e)}}finally{pD(e)}}}function pD(e,t){if(e.g){gD(e);const n=e.g,r=e.C[0]?XN:null;e.g=null,e.C=null,t||hx(e,"ready");try{n.onreadystatechange=r}catch{}}}function gD(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(QN.clearTimeout(e.A),e.A=null)}function mD(e){return e.g?e.g.readyState:0}function yD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case aD:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function vD(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return wM(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):PR(e,t,n))}function _D(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function CD(e){this.za=0,this.l=[],this.h=new Mx,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=_D("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=_D("baseRetryDelayMs",5e3,e),this.$a=_D("retryDelaySeedMs",1e4,e),this.Ya=_D("forwardChannelMaxRetries",2,e),this.ra=_D("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new $R(e&&e.concurrentRequestLimit),this.Ca=new KR,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function ED(e){if(bD(e),3==e.G){var t=e.V++,n=CR(e.F);PR(n,"SID",e.J),PR(n,"RID",t),PR(n,"TYPE","terminate"),TD(e,n),(t=new Qx(e,e.h,t,void 0)).K=2,t.v=OR(CR(n)),n=!1,QN.navigator&&QN.navigator.sendBeacon&&(n=QN.navigator.sendBeacon(t.v.toString(),"")),!n&&QN.Image&&((new Image).src=t.v,n=!0),n||(t.g=VD(t.l,null),t.g.ea(t.v)),t.F=Date.now(),cR(t)}FD(e)}function wD(e){e.g&&(ND(e),e.g.cancel(),e.g=null)}function bD(e){wD(e),e.u&&(QN.clearTimeout(e.u),e.u=null),xD(e),e.i.cancel(),e.m&&("number"==typeof e.m&&QN.clearTimeout(e.m),e.m=null)}function SD(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&PD(e)}function PD(e){HR(e.i)||e.m||(e.m=!0,_x(e.Ha,e),e.C=0)}function OD(e,t){var n;n=t?t.m:e.V++;const r=CR(e.F);PR(r,"SID",e.J),PR(r,"RID",n),PR(r,"AID",e.U),TD(e,r),e.o&&e.s&&vD(r,e.o,e.s),n=new Qx(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=ID(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),WR(e.i,n),rR(n,r,t)}function TD(e,t){e.j&&pR({},function(e,n){PR(t,n,e)})}function ID(e,t,n){n=Math.min(e.l.length,n);var r=e.j?oM(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{JR(a,e,"req"+n+"_")}catch{r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function kD(e){e.g||e.u||(e.Y=1,_x(e.Ga,e),e.A=0)}function AD(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=zx(oM(e.Ga,e),DD(e,e.A)),e.A++,0))}function ND(e){null!=e.B&&(QN.clearTimeout(e.B),e.B=null)}function MD(e){e.g=new Qx(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=CR(e.oa);PR(t,"RID","rpc"),PR(t,"SID",e.J),PR(t,"CI",e.N?"0":"1"),PR(t,"AID",e.U),TD(e,t),PR(t,"TYPE","xmlhttp"),e.o&&e.s&&vD(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=OR(CR(t)),n.s=null,n.U=!0,iR(n,e)}function xD(e){null!=e.v&&(QN.clearTimeout(e.v),e.v=null)}function RD(e,t){var n=null;if(e.g==t){xD(e),ND(e),e.g=null;var r=2}else{if(!qR(e.i,t))return;n=t.D,jR(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;hx(r=Lx(),new $x(r,n,t,i)),PD(e)}else kD(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(GR(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=zx(oM(e.Ha,e,t),DD(e,e.C)),e.C++,0)))}(e,t)||2==r&&AD(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:LD(e,5);break;case 4:LD(e,10);break;case 3:LD(e,6);break;default:LD(e,2)}}function DD(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function LD(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=oM(e.jb,e);n||(n=new _R("//www.google.com/images/cleardot.gif"),QN.location&&"http"==QN.location.protocol||ER(n,"https"),OR(n)),function(e,t){const n=new Mx;if(QN.Image){const r=new Image;r.onload=aM(QR,n,r,"TestLoadImage: loaded",!0,t),r.onerror=aM(QR,n,r,"TestLoadImage: error",!1,t),r.onabort=aM(QR,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=aM(QR,n,r,"TestLoadImage: timeout",!1,t),QN.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else Ux(2);e.G=0,e.j&&e.j.va(t),FD(e),bD(e)}function FD(e){e.G=0,e.I=-1,e.j&&((0!=ZR(e.i).length||0!=e.l.length)&&(e.i.i.length=0,pM(e.l),e.l.length=0),e.j.ua())}function BD(e,t,n){let r=function(e){return e instanceof _R?CR(e):new _R(e,void 0)}(n);if(""!=r.i)t&&wR(r,t+"."+r.i),bR(r,r.m);else{const e=QN.location;r=function(e,t,n,r){var i=new _R(null,void 0);return e&&ER(i,e),t&&wR(i,t),n&&bR(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&wM(e.aa,function(e,t){PR(r,t,e)}),n=e.sa,(t=e.D)&&n&&PR(r,t,n),PR(r,"VER",e.ma),TD(e,r),r}function VD(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new oD(n&&e.Ba&&!e.qa?new XR({ib:!0}):e.qa)).L=e.H,t}function UD(){}function $D(){if(kM&&!(10<=Number(UM)))throw Error("Environmental error: no available transport.")}function zD(e,t){ux.call(this),this.g=new CD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!gM(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!gM(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new qD(this)}function HD(e){Yx.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function GD(){Kx.call(this),this.status=1}function qD(e){this.g=e}(ZN=oD.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():jx.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:jx),this.g.onreadystatechange=oM(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void hD(this,s)}e=n||"";const i=new gR(this.headers);r&&pR(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=uD;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=QN.FormData&&e instanceof QN.FormData,!(0<=hM(lD,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gD(this),0<this.B&&((this.K=function(e){return kM&&VM()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=oM(this.pa,this)):this.A=Px(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){hD(this,s)}},ZN.pa=function(){void 0!==JN&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,hx(this,"timeout"),this.abort(8))},ZN.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,hx(this,"complete"),hx(this,"abort"),pD(this))},ZN.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),pD(this,!0)),oD.Z.M.call(this)},ZN.Fa=function(){this.s||(this.F||this.v||this.l?fD(this):this.cb())},ZN.cb=function(){fD(this)},ZN.ba=function(){try{return 2<mD(this)?this.g.status:-1}catch{return-1}},ZN.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},ZN.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),sD(t)}},ZN.Da=function(){return this.m},ZN.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(ZN=CD.prototype).ma=8,ZN.G=1,ZN.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}},ZN.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Qx(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=bM(s),PM(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ID(this,i,t),PR(n=CR(this.F),"RID",e),PR(n,"CVER",22),this.D&&PR(n,"X-HTTP-Session-Id",this.D),TD(this,n),this.o&&s&&vD(n,this.o,s),WR(this.i,i),this.Ra&&PR(n,"TYPE","init"),this.ja?(PR(n,"$req",t),PR(n,"SID","null"),i.$=!0,rR(i,n,null)):rR(i,n,t),this.G=2}}else 3==this.G&&(e?OD(this,e):0==this.l.length||HR(this.i)||OD(this))},ZN.Ga=function(){if(this.u=null,MD(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=zx(oM(this.bb,this),e)}},ZN.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ux(10),wD(this),MD(this))},ZN.ab=function(){null!=this.v&&(this.v=null,wD(this),AD(this),Ux(19))},ZN.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Ux(2)):(this.h.info("Failed to ping google.com"),Ux(1))},(ZN=UD.prototype).xa=function(){},ZN.wa=function(){},ZN.va=function(){},ZN.ua=function(){},ZN.Oa=function(){},$D.prototype.g=function(e,t){return new zD(e,t)},cM(zD,ux),zD.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),_x(oM(e.hb,e,t))),Ux(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=BD(e,null,e.W),PD(e)},zD.prototype.close=function(){ED(this.g)},zD.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,SD(this.g,t)}else this.v?((t={}).__data__=fx(e),SD(this.g,t)):SD(this.g,e)},zD.prototype.M=function(){this.g.j=null,delete this.j,ED(this.g),delete this.g,zD.Z.M.call(this)},cM(HD,Yx),cM(GD,Kx),cM(qD,UD),qD.prototype.xa=function(){hx(this.g,"a")},qD.prototype.wa=function(e){hx(this.g,new HD(e))},qD.prototype.va=function(e){hx(this.g,new GD(e))},qD.prototype.ua=function(){hx(this.g,"b")},$D.prototype.createWebChannel=$D.prototype.g,zD.prototype.send=zD.prototype.u,zD.prototype.open=zD.prototype.m,zD.prototype.close=zD.prototype.close,Hx.NO_ERROR=0,Hx.TIMEOUT=8,Hx.HTTP_ERROR=6,Gx.COMPLETE="complete",Wx.EventType=Zx,Zx.OPEN="a",Zx.CLOSE="b",Zx.ERROR="c",Zx.MESSAGE="d",ux.prototype.listen=ux.prototype.N,oD.prototype.listenOnce=oD.prototype.O,oD.prototype.getLastError=oD.prototype.La,oD.prototype.getLastErrorCode=oD.prototype.Da,oD.prototype.getStatus=oD.prototype.ba,oD.prototype.getResponseJson=oD.prototype.Qa,oD.prototype.getResponseText=oD.prototype.ga,oD.prototype.send=oD.prototype.ea;var WD=KN.createWebChannelTransport=function(){return new $D},jD=KN.getStatEventTarget=function(){return Lx()},ZD=KN.ErrorCode=Hx,YD=KN.EventType=Gx,KD=KN.Event=Rx,JD=KN.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},QD=KN.FetchXmlHttpFactory=XR,XD=KN.WebChannel=Wx,eL=KN.XhrIo=oD;const tL="@firebase/firestore";class nL{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nL.UNAUTHENTICATED=new nL(null),nL.GOOGLE_CREDENTIALS=new nL("google-credentials-uid"),nL.FIRST_PARTY=new nL("first-party-uid"),nL.MOCK_USER=new nL("mock-user");let rL="9.6.5";const iL=new yb("@firebase/firestore");function sL(){return iL.logLevel}function oL(e,...t){if(iL.logLevel<=db.DEBUG){const n=t.map(lL);iL.debug(`Firestore (${rL}): ${e}`,...n)}}function aL(e,...t){if(iL.logLevel<=db.ERROR){const n=t.map(lL);iL.error(`Firestore (${rL}): ${e}`,...n)}}function cL(e,...t){if(iL.logLevel<=db.WARN){const n=t.map(lL);iL.warn(`Firestore (${rL}): ${e}`,...n)}}function lL(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return e}}function uL(e="Unexpected state"){const t=`FIRESTORE (${rL}) INTERNAL ASSERTION FAILED: `+e;throw aL(t),new Error(t)}function hL(e,t){e||uL()}function dL(e,t){return e}const fL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pL extends Vw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class gL{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class mL{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nL.UNAUTHENTICATED))}shutdown(){}}class vL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class _L{constructor(e){this.t=e,this.currentUser=nL.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let r=this.i;const i=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new gL;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new gL,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(dw(function*(){yield t.promise,yield i(n.currentUser)}))},a=e=>{oL("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(oL("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new gL)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(oL("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(hL("string"==typeof t.accessToken),new mL(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return hL(null===e||"string"==typeof e),new nL(e)}}class CL{constructor(e,t,n){this.type="FirstParty",this.user=nL.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class EL{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new CL(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(nL.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bL{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable(()=>{return null!=(e=n).error&&oL("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token);var e})};const n=e=>{oL("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):oL("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(hL("string"==typeof e.token),new wL(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class SL{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function PL(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}SL.I=-1;class OL{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=PL(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function TL(e,t){return e<t?-1:e>t?1:0}function IL(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class kL{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pL(fL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pL(fL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pL(fL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pL(fL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return kL.fromMillis(Date.now())}static fromDate(e){return kL.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new kL(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?TL(this.nanoseconds,e.nanoseconds):TL(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class AL{constructor(e){this.timestamp=e}static fromTimestamp(e){return new AL(e)}static min(){return new AL(new kL(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function NL(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ML(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function xL(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class RL{constructor(e,t,n){void 0===t?t=0:t>e.length&&uL(),void 0===n?n=e.length-t:n>e.length-t&&uL(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===RL.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof RL?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class DL extends RL{construct(e,t,n){return new DL(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new pL(fL.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new DL(t)}static emptyPath(){return new DL([])}}const LL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FL extends RL{construct(e,t,n){return new FL(e,t,n)}static isValidIdentifier(e){return LL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FL.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new FL(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new pL(fL.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new pL(fL.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new pL(fL.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new pL(fL.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FL(t)}static emptyPath(){return new FL([])}}class BL{constructor(e){this.fields=e,e.sort(FL.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return IL(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class VL{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new VL(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new VL(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return TL(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}VL.EMPTY_BYTE_STRING=new VL("");const UL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $L(e){if(hL(!!e),"string"==typeof e){let t=0;const n=UL.exec(e);if(hL(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:zL(e.seconds),nanos:zL(e.nanos)}}function zL(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function HL(e){return"string"==typeof e?VL.fromBase64String(e):VL.fromUint8Array(e)}function GL(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function qL(e){const t=e.mapValue.fields.__previous_value__;return GL(t)?qL(t):t}function WL(e){const t=$L(e.mapValue.fields.__local_write_time__.timestampValue);return new kL(t.seconds,t.nanos)}function jL(e){return null==e}function ZL(e){return 0===e&&1/e==-1/0}class YL{constructor(e){this.path=e}static fromPath(e){return new YL(DL.fromString(e))}static fromName(e){return new YL(DL.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===DL.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return DL.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new YL(new DL(e.slice()))}}function KL(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?GL(e)?4:10:uL()}function JL(e,t){if(e===t)return!0;const n=KL(e);if(n!==KL(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return WL(e).isEqual(WL(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=$L(e.timestampValue),r=$L(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,HL(e.bytesValue).isEqual(HL(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return zL(e.geoPointValue.latitude)===zL(t.geoPointValue.latitude)&&zL(e.geoPointValue.longitude)===zL(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return zL(e.integerValue)===zL(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=zL(e.doubleValue),r=zL(t.doubleValue);return n===r?ZL(n)===ZL(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return IL(e.arrayValue.values||[],t.arrayValue.values||[],JL);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(NL(n)!==NL(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!JL(n[i],r[i])))return!1;return!0}(e,t);default:return uL()}var r}function QL(e,t){return void 0!==(e.values||[]).find(e=>JL(e,t))}function XL(e,t){if(e===t)return 0;const n=KL(e),r=KL(t);if(n!==r)return TL(n,r);switch(n){case 0:return 0;case 1:return TL(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=zL(e.integerValue||e.doubleValue),r=zL(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return eF(e.timestampValue,t.timestampValue);case 4:return eF(WL(e),WL(t));case 5:return TL(e.stringValue,t.stringValue);case 6:return function(e,t){const n=HL(e),r=HL(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=TL(n[i],r[i]);if(0!==e)return e}return TL(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=TL(zL(e.latitude),zL(t.latitude));return 0!==n?n:TL(zL(e.longitude),zL(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=XL(n[i],r[i]);if(e)return e}return TL(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=TL(r[o],s[o]);if(0!==e)return e;const t=XL(n[r[o]],i[s[o]]);if(0!==t)return t}return TL(r.length,s.length)}(e.mapValue,t.mapValue);default:throw uL()}}function eF(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return TL(e,t);const n=$L(e),r=$L(t),i=TL(n.seconds,r.seconds);return 0!==i?i:TL(n.nanos,r.nanos)}function tF(e){return nF(e)}function nF(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=$L(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?HL(e.bytesValue).toBase64():"referenceValue"in e?YL.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=nF(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${nF(e.fields[i])}`;return n+"}"}(e.mapValue):uL();var t}function rF(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iF(e){return!!e&&"integerValue"in e}function sF(e){return!!e&&"arrayValue"in e}function oF(e){return!!e&&"nullValue"in e}function aF(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function cF(e){return!!e&&"mapValue"in e}function lF(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ML(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=lF(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=lF(e.arrayValue.values[n]);return t}return Object.assign({},e)}class uF{constructor(e){this.value=e}static empty(){return new uF({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!cF(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=lF(t)}setAll(e){let t=FL.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=lF(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());cF(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return JL(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];cF(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ML(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new uF(lF(this.value))}}function hF(e){const t=[];return ML(e.fields,(e,n)=>{const r=new FL([e]);if(cF(n)){const e=hF(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new BL(t)}class dF{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new dF(e,0,AL.min(),uF.empty(),0)}static newFoundDocument(e,t,n){return new dF(e,1,t,n,0)}static newNoDocument(e,t){return new dF(e,2,t,uF.empty(),0)}static newUnknownDocument(e,t){return new dF(e,3,t,uF.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=uF.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=uF.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof dF&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new dF(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class fF{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function pF(e,t=null,n=[],r=[],i=null,s=null,o=null){return new fF(e,t,n,r,i,s,o)}function gF(e){const t=dL(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+tF(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),jL(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=IF(t.startAt)),t.endAt&&(e+="|ub:",e+=IF(t.endAt)),t.R=e}return t.R}function mF(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!AF(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!JL(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!MF(e.startAt,t.startAt)&&MF(e.endAt,t.endAt)}function yF(e){return YL.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class vF extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new _F(e,t,n):"array-contains"===t?new bF(e,n):"in"===t?new SF(e,n):"not-in"===t?new PF(e,n):"array-contains-any"===t?new OF(e,n):new vF(e,t,n)}static P(e,t,n){return"in"===t?new CF(e,n):new EF(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(XL(t,this.value)):null!==t&&KL(this.value)===KL(t)&&this.v(XL(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return uL()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class _F extends vF{constructor(e,t,n){super(e,t,n),this.key=YL.fromName(n.referenceValue)}matches(e){const t=YL.comparator(e.key,this.key);return this.v(t)}}class CF extends vF{constructor(e,t){super(e,"in",t),this.keys=wF(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class EF extends vF{constructor(e,t){super(e,"not-in",t),this.keys=wF(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function wF(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>YL.fromName(e.referenceValue))}class bF extends vF{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return sF(t)&&QL(t.arrayValue,this.value)}}class SF extends vF{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&QL(this.value.arrayValue,t)}}class PF extends vF{constructor(e,t){super(e,"not-in",t)}matches(e){if(QL(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!QL(this.value.arrayValue,t)}}class OF extends vF{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!sF(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>QL(this.value.arrayValue,e))}}class TF{constructor(e,t){this.position=e,this.before=t}}function IF(e){return`${e.before?"b":"a"}:${e.position.map(e=>tF(e)).join(",")}`}class kF{constructor(e,t="asc"){this.field=e,this.dir=t}}function AF(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function NF(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?YL.comparator(YL.fromName(o.referenceValue),n.key):XL(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function MF(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!JL(e.position[n],t.position[n]))return!1;return!0}class xF{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null}}function RF(e){return new xF(e)}function DF(e){return!jL(e.limit)&&"F"===e.limitType}function LF(e){return!jL(e.limit)&&"L"===e.limitType}function FF(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function BF(e){for(const t of e.filters)if(t.V())return t.field;return null}function VF(e){return null!==e.collectionGroup}function UF(e){const t=dL(e);if(null===t.S){t.S=[];const e=BF(t),n=FF(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new kF(e)),t.S.push(new kF(FL.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new kF(FL.keyField(),e))}}}return t.S}function $F(e){const t=dL(e);if(!t.D)if("F"===t.limitType)t.D=pF(t.path,t.collectionGroup,UF(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of UF(t))e.push(new kF(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new TF(t.endAt.position,!t.endAt.before):null,r=t.startAt?new TF(t.startAt.position,!t.startAt.before):null;t.D=pF(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function zF(e,t){return mF($F(e),$F(t))&&e.limitType===t.limitType}function HF(e){return`${gF($F(e))}|lt:${e.limitType}`}function GF(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${tF(t.value)}`;var t}).join(", ")}]`),jL(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: "+IF(e.startAt)),e.endAt&&(t+=", endAt: "+IF(e.endAt)),`Target(${t})`}($F(e))}; limitType=${e.limitType})`}function qF(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):YL.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!NF(n.startAt,UF(n),r)||n.endAt&&NF(n.endAt,UF(n),r)));var n,r}function WF(e){return(t,n)=>{let r=!1;for(const i of UF(e)){const e=jF(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function jF(e,t,n){const r=e.field.isKeyField()?YL.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?XL(r,i):uL()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return uL()}}function ZF(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ZL(t)?"-0":t}}function YF(e){return{integerValue:""+e}}function KF(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!ZL(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?YF(t):ZF(e,t)}class JF{constructor(){this._=void 0}}function QF(e,t,n){return e instanceof tB?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof nB?rB(e,t):e instanceof iB?sB(e,t):function(e,t){const n=eB(e,t),r=aB(n)+aB(e.N);return iF(n)&&iF(e.N)?YF(r):ZF(e.k,r)}(e,t)}function XF(e,t,n){return e instanceof nB?rB(e,t):e instanceof iB?sB(e,t):n}function eB(e,t){return e instanceof oB?iF(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}class tB extends JF{}class nB extends JF{constructor(e){super(),this.elements=e}}function rB(e,t){const n=cB(t);for(const r of e.elements)n.some(e=>JL(e,r))||n.push(r);return{arrayValue:{values:n}}}class iB extends JF{constructor(e){super(),this.elements=e}}function sB(e,t){let n=cB(t);for(const r of e.elements)n=n.filter(e=>!JL(e,r));return{arrayValue:{values:n}}}class oB extends JF{constructor(e,t){super(),this.k=e,this.N=t}}function aB(e){return zL(e.integerValue||e.doubleValue)}function cB(e){return sF(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class lB{constructor(e,t){this.field=e,this.transform=t}}class uB{constructor(e,t){this.version=e,this.transformResults=t}}class hB{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hB}static exists(e){return new hB(void 0,e)}static updateTime(e){return new hB(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function dB(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class fB{}function pB(e,t,n){e instanceof _B?function(e,t,n){const r=e.value.clone(),i=wB(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof CB?function(e,t,n){if(!dB(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=wB(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(EB(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function gB(e,t,n){var r;e instanceof _B?function(e,t,n){if(!dB(e.precondition,t))return;const r=e.value.clone(),i=bB(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(vB(t),r).setHasLocalMutations()}(e,t,n):e instanceof CB?function(e,t,n){if(!dB(e.precondition,t))return;const r=bB(e.fieldTransforms,n,t),i=t.data;i.setAll(EB(e)),i.setAll(r),t.convertToFoundDocument(vB(t),i).setHasLocalMutations()}(e,t,n):dB(e.precondition,r=t)&&r.convertToNoDocument(AL.min())}function mB(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=eB(r.transform,e||null);null!=i&&(null==n&&(n=uF.empty()),n.set(r.field,i))}return n||null}function yB(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&IL(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof nB&&r instanceof nB||n instanceof iB&&r instanceof iB?IL(n.elements,r.elements,JL):n instanceof oB&&r instanceof oB?JL(n.N,r.N):n instanceof tB&&r instanceof tB);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}function vB(e){return e.isFoundDocument()?e.version:AL.min()}class _B extends fB{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class CB extends fB{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function EB(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function wB(e,t,n){const r=new Map;hL(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,XF(o,a,n[i]))}return r}function bB(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,QF(e,s,t))}return r}class SB extends fB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class PB extends fB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class OB{constructor(e){this.count=e}}var TB,IB;function kB(e){switch(e){default:return uL();case fL.CANCELLED:case fL.UNKNOWN:case fL.DEADLINE_EXCEEDED:case fL.RESOURCE_EXHAUSTED:case fL.INTERNAL:case fL.UNAVAILABLE:case fL.UNAUTHENTICATED:return!1;case fL.INVALID_ARGUMENT:case fL.NOT_FOUND:case fL.ALREADY_EXISTS:case fL.PERMISSION_DENIED:case fL.FAILED_PRECONDITION:case fL.ABORTED:case fL.OUT_OF_RANGE:case fL.UNIMPLEMENTED:case fL.DATA_LOSS:return!0}}function AB(e){if(void 0===e)return aL("GRPC error has no .code"),fL.UNKNOWN;switch(e){case TB.OK:return fL.OK;case TB.CANCELLED:return fL.CANCELLED;case TB.UNKNOWN:return fL.UNKNOWN;case TB.DEADLINE_EXCEEDED:return fL.DEADLINE_EXCEEDED;case TB.RESOURCE_EXHAUSTED:return fL.RESOURCE_EXHAUSTED;case TB.INTERNAL:return fL.INTERNAL;case TB.UNAVAILABLE:return fL.UNAVAILABLE;case TB.UNAUTHENTICATED:return fL.UNAUTHENTICATED;case TB.INVALID_ARGUMENT:return fL.INVALID_ARGUMENT;case TB.NOT_FOUND:return fL.NOT_FOUND;case TB.ALREADY_EXISTS:return fL.ALREADY_EXISTS;case TB.PERMISSION_DENIED:return fL.PERMISSION_DENIED;case TB.FAILED_PRECONDITION:return fL.FAILED_PRECONDITION;case TB.ABORTED:return fL.ABORTED;case TB.OUT_OF_RANGE:return fL.OUT_OF_RANGE;case TB.UNIMPLEMENTED:return fL.UNIMPLEMENTED;case TB.DATA_LOSS:return fL.DATA_LOSS;default:return uL()}}(IB=TB||(TB={}))[IB.OK=0]="OK",IB[IB.CANCELLED=1]="CANCELLED",IB[IB.UNKNOWN=2]="UNKNOWN",IB[IB.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",IB[IB.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",IB[IB.NOT_FOUND=5]="NOT_FOUND",IB[IB.ALREADY_EXISTS=6]="ALREADY_EXISTS",IB[IB.PERMISSION_DENIED=7]="PERMISSION_DENIED",IB[IB.UNAUTHENTICATED=16]="UNAUTHENTICATED",IB[IB.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",IB[IB.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",IB[IB.ABORTED=10]="ABORTED",IB[IB.OUT_OF_RANGE=11]="OUT_OF_RANGE",IB[IB.UNIMPLEMENTED=12]="UNIMPLEMENTED",IB[IB.INTERNAL=13]="INTERNAL",IB[IB.UNAVAILABLE=14]="UNAVAILABLE",IB[IB.DATA_LOSS=15]="DATA_LOSS";class NB{constructor(e,t){this.comparator=e,this.root=t||xB.EMPTY}insert(e,t){return new NB(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xB.BLACK,null,null))}remove(e){return new NB(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xB.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new MB(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new MB(this.root,e,this.comparator,!1)}getReverseIterator(){return new MB(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new MB(this.root,e,this.comparator,!0)}}class MB{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xB{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??xB.RED,this.left=r??xB.EMPTY,this.right=i??xB.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new xB(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return xB.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return xB.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xB.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xB.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw uL();const e=this.left.check();if(e!==this.right.check())throw uL();return e+(this.isRed()?0:1)}}xB.EMPTY=null,xB.RED=!0,xB.BLACK=!1,xB.EMPTY=new class{constructor(){this.size=0}get key(){throw uL()}get value(){throw uL()}get color(){throw uL()}get left(){throw uL()}get right(){throw uL()}copy(e,t,n,r,i){return this}insert(e,t,n){return new xB(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class RB{constructor(e){this.comparator=e,this.data=new NB(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new DB(this.data.getIterator())}getIteratorFrom(e){return new DB(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof RB)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new RB(this.comparator);return t.data=e,t}}class DB{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const LB=new NB(YL.comparator);function FB(){return LB}const BB=new NB(YL.comparator);function VB(){return BB}const UB=new NB(YL.comparator);const $B=new RB(YL.comparator);function zB(...e){let t=$B;for(const n of e)t=t.add(n);return t}const HB=new RB(TL);function GB(){return HB}class qB{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,WB.createSynthesizedTargetChangeForCurrentChange(e,t)),new qB(AL.min(),n,GB(),FB(),zB())}}class WB{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new WB(VL.EMPTY_BYTE_STRING,t,zB(),zB(),zB())}}class jB{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class ZB{constructor(e,t){this.targetId=e,this.M=t}}class YB{constructor(e,t,n=VL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class KB{constructor(){this.F=0,this.L=XB(),this.B=VL.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=zB(),t=zB(),n=zB();return this.L.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:uL()}}),new WB(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=XB()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class JB{constructor(e){this.et=e,this.nt=new Map,this.st=FB(),this.it=QB(),this.rt=new RB(TL)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:uL()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((e,n)=>{this.lt(n)&&t(n)})}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(yF(e))if(0===n){const n=new YL(e.path);this.at(t,n,dF.newNoDocument(n,AL.min()))}else hL(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((n,r)=>{const i=this.wt(r);if(i){if(n.current&&yF(i.target)){const t=new YL(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,dF.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}});let n=zB();this.it.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new qB(e,t,this.rt,this.st,n);return this.st=FB(),this.it=QB(),this.rt=new RB(TL),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new KB,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new RB(TL),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||oL("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new KB),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function QB(){return new NB(YL.comparator)}function XB(){return new NB(YL.comparator)}const eV={asc:"ASCENDING",desc:"DESCENDING"},tV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class nV{constructor(e,t){this.databaseId=e,this.C=t}}function rV(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iV(e,t){return e.C?t.toBase64():t.toUint8Array()}function sV(e,t){return rV(e,t.toTimestamp())}function oV(e){return hL(!!e),AL.fromTimestamp(function(e){const t=$L(e);return new kL(t.seconds,t.nanos)}(e))}function aV(e,t){return(n=e,new DL(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function cV(e){const t=DL.fromString(e);return hL(IV(t)),t}function lV(e,t){return aV(e.databaseId,t.path)}function uV(e,t){const n=cV(t);if(n.get(1)!==e.databaseId.projectId)throw new pL(fL.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new pL(fL.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new YL(fV(n))}function hV(e,t){return aV(e.databaseId,t)}function dV(e){return new DL(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function fV(e){return hL(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function pV(e,t,n){return{name:lV(e,t),fields:n.value.mapValue.fields}}function gV(e,t){return{documents:[hV(e,t.path)]}}function mV(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=hV(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=hV(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(aF(e.value))return{unaryFilter:{field:bV(e.field),op:"IS_NAN"}};if(oF(e.value))return{unaryFilter:{field:bV(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aF(e.value))return{unaryFilter:{field:bV(e.field),op:"IS_NOT_NAN"}};if(oF(e.value))return{unaryFilter:{field:bV(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bV(e.field),op:wV(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>{return{field:bV((t=e).field),direction:EV(t.dir)};var t})}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=(a=t.limit,e.C||jL(a)?a:{value:a});var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=_V(t.startAt)),t.endAt&&(n.structuredQuery.endAt=_V(t.endAt)),n}function yV(e){let t=function(e){const t=cV(e);return 4===t.length?DL.emptyPath():fV(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){hL(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=vV(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new kF(SV((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,jL(t)?null:t}(n.limit));let c=null;n.startAt&&(c=CV(n.startAt));let l=null;return n.endAt&&(l=CV(n.endAt)),function(e,t,n,r,i,s,o,a){return new xF(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,l)}function vV(e){return e?void 0!==e.unaryFilter?[OV(e)]:void 0!==e.fieldFilter?[PV(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>vV(e)).reduce((e,t)=>e.concat(t)):uL():[]}function _V(e){return{before:e.before,values:e.position}}function CV(e){return new TF(e.values||[],!!e.before)}function EV(e){return eV[e]}function wV(e){return tV[e]}function bV(e){return{fieldPath:e.canonicalString()}}function SV(e){return FL.fromServerFormat(e.fieldPath)}function PV(e){return vF.create(SV(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return uL()}}(e.fieldFilter.op),e.fieldFilter.value)}function OV(e){switch(e.unaryFilter.op){case"IS_NAN":const t=SV(e.unaryFilter.field);return vF.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=SV(e.unaryFilter.field);return vF.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=SV(e.unaryFilter.field);return vF.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=SV(e.unaryFilter.field);return vF.create(i,"!=",{nullValue:"NULL_VALUE"});default:return uL()}}function TV(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function IV(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function kV(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=NV(t)),t=AV(e.get(n),t);return NV(t)}function AV(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function NV(e){return e+"\x01\x01"}class MV{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}MV.store="owner",MV.key="owner";class xV{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}xV.store="mutationQueues",xV.keyPath="userId";class RV{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}RV.store="mutations",RV.keyPath="batchId",RV.userMutationsIndex="userMutationsIndex",RV.userMutationsKeyPath=["userId","batchId"];class DV{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,kV(t)]}static key(e,t,n){return[e,kV(t),n]}}DV.store="documentMutations",DV.PLACEHOLDER=new DV;class LV{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}LV.store="remoteDocuments",LV.readTimeIndex="readTimeIndex",LV.readTimeIndexPath="readTime",LV.collectionReadTimeIndex="collectionReadTimeIndex",LV.collectionReadTimeIndexPath=["parentPath","readTime"];class FV{constructor(e){this.byteSize=e}}FV.store="remoteDocumentGlobal",FV.key="remoteDocumentGlobalKey";class BV{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}BV.store="targets",BV.keyPath="targetId",BV.queryTargetsIndexName="queryTargetsIndex",BV.queryTargetsKeyPath=["canonicalId","targetId"];class VV{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}VV.store="targetDocuments",VV.keyPath=["targetId","path"],VV.documentTargetsIndex="documentTargetsIndex",VV.documentTargetsKeyPath=["path","targetId"];class UV{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}UV.key="targetGlobalKey",UV.store="targetGlobal";class $V{constructor(e,t){this.collectionId=e,this.parent=t}}$V.store="collectionParents",$V.keyPath=["collectionId","parent"];class zV{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}zV.store="clientMetadata",zV.keyPath="clientId";class HV{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}HV.store="bundles",HV.keyPath="bundleId";class GV{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}GV.store="namedQueries",GV.keyPath="name";const qV="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WV{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&uL(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new WV((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof WV?t:WV.resolve(t)}catch(t){return WV.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):WV.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):WV.reject(t)}static resolve(e){return new WV((t,n)=>{t(e)})}static reject(e){return new WV((t,n)=>{n(e)})}static waitFor(e){return new WV((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=WV.resolve(!1);for(const n of e)t=t.next(e=>e?WV.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}function jV(e){return"IndexedDbTransactionError"===e.name}class ZV{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&pB(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&gB(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&gB(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(AL.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),zB())}isEqual(e){return this.batchId===e.batchId&&IL(this.mutations,e.mutations,(e,t)=>yB(e,t))&&IL(this.baseMutations,e.baseMutations,(e,t)=>yB(e,t))}}class YV{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){hL(e.mutations.length===n.length);let r=UB;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new YV(e,t,n,r)}}class KV{constructor(e,t,n,r,i=AL.min(),s=AL.min(),o=VL.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new KV(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new KV(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new KV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class JV{constructor(e){this.Gt=e}}function QV(e){const t=yV({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?function(e,t,n){return new xF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}(t,t.limit,"L"):t}class XV{constructor(){this.zt=new eU}addToCollectionParentIndex(e,t){return this.zt.add(t),WV.resolve()}getCollectionParents(e,t){return WV.resolve(this.zt.getEntries(t))}}class eU{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new RB(DL.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new RB(DL.comparator)).toArray()}}class tU{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new tU(e,tU.DEFAULT_COLLECTION_PERCENTILE,tU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}tU.DEFAULT_COLLECTION_PERCENTILE=10,tU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tU.DEFAULT=new tU(41943040,tU.DEFAULT_COLLECTION_PERCENTILE,tU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tU.DISABLED=new tU(-1,0,0);class nU{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new nU(0)}static re(){return new nU(-1)}}function rU(e){return iU.apply(this,arguments)}function iU(){return(iU=dw(function*(e){if(e.code!==fL.FAILED_PRECONDITION||e.message!==qV)throw e;oL("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class sU{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){ML(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return xL(this.inner)}}class oU{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.bn(e,t,n))}bn(e,t,n){return this.Je.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}vn(e,t){return this.Je.getEntries(e,t).next(t=>this.Vn(e,t).next(()=>t))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return YL.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.Sn(e,t.path):VF(t)?this.Dn(e,t,n):this.Cn(e,t,n);var r}Sn(e,t){return this.Rn(e,new YL(t)).next(e=>{let t=VB();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Dn(e,t,n){const r=t.collectionGroup;let i=VB();return this.Jt.getCollectionParents(e,r).next(s=>WV.forEach(s,s=>{const o=(a=t,c=s.child(r),new xF(c,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,c;return this.Cn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Nn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=dF.newInvalidDocument(n),r=r.insert(n,i)),gB(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{qF(t,n)||(r=r.remove(e))}),r))}Nn(e,t,n){let r=zB();for(const s of t)for(const e of s.mutations)e instanceof CB&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class aU{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=zB(),r=zB();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new aU(e,t.fromCache,n,r)}}class cU{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(AL.min())?this.Fn(e,t):this.Mn.vn(e,r).next(i=>{const s=this.Ln(t,i);return(DF(t)||LF(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(sL()<=db.DEBUG&&oL("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),GF(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))});var i}Ln(e,t){let n=new RB(WF(e));return t.forEach((t,r)=>{qF(e,r)&&(n=n.add(r))}),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return sL()<=db.DEBUG&&oL("QueryEngine","Using full collection scan to execute query:",GF(t)),this.Mn.getDocumentsMatchingQuery(e,t,AL.min())}}class lU{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new NB(TL),this.Kn=new sU(e=>gF(e),mF),this.jn=AL.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new oU(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function uU(e,t){return hU.apply(this,arguments)}function hU(){return(hU=dw(function*(e,t){const n=dL(e);let r=n.An,i=n.Wn;const s=yield n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.An.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new oU(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=zB();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next(e=>({Gn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.An=r,n.Wn=i,n.Un.On(n.Wn),s})).apply(this,arguments)}function dU(e,t){const n=dL(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=WV.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);hL(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.An.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}function fU(e){const t=dL(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.He.getLastRemoteSnapshotVersion(e))}function pU(e,t){const n=dL(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.He.addMatchingKeys(e,s.addedDocuments,a)));let l=c.withSequenceNumber(e.currentSequenceNumber);var u,h,d;t.targetMismatches.has(a)?l=l.withResumeToken(VL.EMPTY_BYTE_STRING,AL.min()).withLastLimboFreeSnapshotVersion(AL.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,r)),i=i.insert(a,l),h=l,d=s,(0===(u=c).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.He.updateTargetData(e,l))});let a=FB();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n,r,i){let s=zB();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=FB();return n.forEach((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(AL.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):oL("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(AL.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next(t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return WV.waitFor(o).next(()=>s.apply(e)).next(()=>n.Wn.Vn(e,a)).next(()=>a)}).then(e=>(n.qn=i,e))}function gU(e,t){const n=dL(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)))}function mU(e,t){const n=dL(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.He.getTargetData(e,t).next(i=>i?(r=i,WV.resolve(r)):n.He.allocateTargetId(e).next(i=>(r=new KV(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e})}function yU(e,t,n){return vU.apply(this,arguments)}function vU(){return(vU=dw(function*(e,t,n){const r=dL(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!jV(o))throw o;oL("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)})).apply(this,arguments)}function _U(e,t,n){const r=dL(e);let i=AL.min(),s=zB();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=dL(e),i=r.Kn.get(n);return void 0!==i?WV.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,$F(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:AL.min(),n?s:zB())).next(e=>({documents:e,zn:s})))}class CU{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return WV.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:oV(n.createTime)}),WV.resolve()}getNamedQuery(e,t){return WV.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(n=t).name,query:QV(n.bundledQuery),readTime:oV(n.readTime)}),WV.resolve();var n}}class EU{constructor(){this.ts=new RB(wU.es),this.ns=new RB(wU.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new wU(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.os(new wU(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new YL(new DL([])),n=new wU(t,e),r=new wU(t,e+1),i=[];return this.ns.forEachInRange([n,r],e=>{this.os(e),i.push(e.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new YL(new DL([])),n=new wU(t,e),r=new wU(t,e+1);let i=zB();return this.ns.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new wU(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class wU{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return YL.comparator(e.key,t.key)||TL(e.fs,t.fs)}static ss(e,t){return TL(e.fs,t.fs)||YL.comparator(e.key,t.key)}}class bU{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new RB(wU.es)}checkEmpty(e){return WV.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++;const s=new ZV(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new wU(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return WV.resolve(s)}lookupMutationBatch(e,t){return WV.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.gs(t+1),r=n<0?0:n;return WV.resolve(this.An.length>r?this.An[r]:null)}getHighestUnacknowledgedBatchId(){return WV.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return WV.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wU(t,0),r=new wU(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],e=>{const t=this._s(e.fs);i.push(t)}),WV.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new RB(TL);return t.forEach(e=>{const t=new wU(e,0),r=new wU(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],e=>{n=n.add(e.fs)})}),WV.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;YL.isDocumentKey(i)||(i=i.child(""));const s=new wU(new YL(i),0);let o=new RB(TL);return this.ws.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)},s),WV.resolve(this.ys(o))}ys(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){hL(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return WV.forEach(t.mutations,r=>{const i=new wU(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ws=n})}ee(e){}containsKey(e,t){const n=new wU(t,0),r=this.ws.firstAfterOrEqual(n);return WV.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return WV.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class SU{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new NB(YL.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return WV.resolve(n?n.document.mutableCopy():dF.newInvalidDocument(t))}getEntries(e,t){let n=FB();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():dF.newInvalidDocument(e))}),WV.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=FB();const i=new YL(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||qF(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return WV.resolve(r)}Es(e,t){return WV.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new PU(this)}getSize(e){return WV.resolve(this.size)}}class PU extends class{constructor(){this.changes=new sU(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:AL.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:dF.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?WV.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)}),WV.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class OU{constructor(e){this.persistence=e,this.Is=new sU(e=>gF(e),mF),this.lastRemoteSnapshotVersion=AL.min(),this.highestTargetId=0,this.As=0,this.Rs=new EU,this.targetCount=0,this.bs=nU.ie()}forEachTarget(e,t){return this.Is.forEach((e,n)=>t(n)),WV.resolve()}getLastRemoteSnapshotVersion(e){return WV.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return WV.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),WV.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),WV.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new nU(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,WV.resolve()}updateTargetData(e,t){return this.ae(t),WV.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,WV.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),WV.waitFor(i).next(()=>r)}getTargetCount(e){return WV.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return WV.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),WV.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),WV.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),WV.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return WV.resolve(n)}containsKey(e,t){return WV.resolve(this.Rs.containsKey(t))}}class TU{constructor(e,t){this.Ps={},this.Be=new SL(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new OU(this),this.Jt=new XV,this.Je=new SU(this.Jt,e=>this.referenceDelegate.vs(e)),this.k=new JV(t),this.Ye=new CU(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new bU(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){oL("MemoryPersistence","Starting transaction:",e);const r=new IU(this.Be.next());return this.referenceDelegate.Vs(),n(r).next(e=>this.referenceDelegate.Ss(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ds(e,t){return WV.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class IU extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}{constructor(e){super(),this.currentSequenceNumber=e}}class kU{constructor(e){this.persistence=e,this.Cs=new EU,this.Ns=null}static ks(e){return new kU(e)}get xs(){if(this.Ns)return this.Ns;throw uL()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),WV.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),WV.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),WV.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return WV.forEach(this.xs,n=>{const r=YL.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return WV.or([()=>WV.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}class AU{constructor(){this.activeTargetIds=GB()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class NU{constructor(){this.pi=new AU,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new AU,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class MU{Ei(e){}shutdown(){}}class xU{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){oL("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){oL("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const RU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class DU{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class LU extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);oL("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then(e=>(oL("RestConnection","Received: ",e),e),t=>{throw cL("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+rL,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Ui(e,t){return`${this.Fi}/v1/${t}:${RU[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise((i,s)=>{const o=new eL;o.listenOnce(YD.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ZD.NO_ERROR:const t=o.getResponseJson();oL("Connection","XHR received:",JSON.stringify(t)),i(t);break;case ZD.TIMEOUT:oL("Connection",'RPC "'+e+'" timed out'),s(new pL(fL.DEADLINE_EXCEEDED,"Request time out"));break;case ZD.HTTP_ERROR:const n=o.getStatus();if(oL("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(fL).indexOf(t)>=0?t:fL.UNKNOWN}(e.status);s(new pL(t,e.message))}else s(new pL(fL.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new pL(fL.UNAVAILABLE,"Connection failed."));break;default:uL()}}finally{oL("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=WD(),s=jD(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new QD({})),this.qi(o.initMessageHeaders,t,n),Mw()||Rw()||Nw().indexOf("Electron/")>=0||Dw()||Nw().indexOf("MSAppHost/")>=0||xw()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");oL("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let l=!1,u=!1;const h=new DU({Vi:e=>{u?oL("Connection","Not sending because WebChannel is closed:",e):(l||(oL("Connection","Opening WebChannel transport."),c.open(),l=!0),oL("Connection","WebChannel sending:",e),c.send(e))},Si:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return d(c,XD.EventType.OPEN,()=>{u||oL("Connection","WebChannel transport opened.")}),d(c,XD.EventType.CLOSE,()=>{u||(u=!0,oL("Connection","WebChannel transport closed"),h.Oi())}),d(c,XD.EventType.ERROR,e=>{u||(u=!0,cL("Connection","WebChannel transport errored:",e),h.Oi(new pL(fL.UNAVAILABLE,"The operation could not be completed")))}),d(c,XD.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];hL(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){oL("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=TB[e];if(void 0!==t)return AB(t)}(e),n=i.message;void 0===t&&(t=fL.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.Oi(new pL(t,n)),c.close()}else oL("Connection","WebChannel received:",n),h.Mi(n)}}),d(s,KD.STAT_EVENT,e=>{e.stat===JD.PROXY?oL("Connection","Detected buffering proxy"):e.stat===JD.NOPROXY&&oL("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.$i()},0),h}}function FU(){return"undefined"!=typeof document?document:null}function BU(e){return new nV(e,!0)}class VU{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&oL("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class UU{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new VU(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return dw(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return dw(function*(){if(e.lr())return e.close(0)})()}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(e,t){var n=this;return dw(function*(){n.yr(),n.pr(),n.ur.cancel(),n.rr++,4!==e?n.ur.reset():t&&t.code===fL.RESOURCE_EXHAUSTED?(aL(t.toString()),aL("Using maximum backoff delay to prevent overloading the backend."),n.ur.Xi()):t&&t.code===fL.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Tr(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.rr===t&&this.Ir(e,n)},t=>{e(()=>{const e=new pL(fL.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)})})}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(e=>{n(()=>this.Ar(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}dr(){var e=this;this.state=5,this.ur.Zi(dw(function*(){e.state=0,e.start()}))}Ar(e){return oL("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(oL("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $U extends UU{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:uL(),s=t.targetChange.targetIds||[],o=function(e,t){return e.C?(hL(void 0===t||"string"==typeof t),VL.fromBase64String(t||"")):(hL(void 0===t||t instanceof Uint8Array),VL.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?fL.UNKNOWN:AB(e.code);return new pL(t,e.message||"")}(a);n=new YB(i,s,o,c||null)}else if("documentChange"in t){const r=t.documentChange,i=uV(e,r.document.name),s=oV(r.document.updateTime),o=new uF({mapValue:{fields:r.document.fields}}),a=dF.newFoundDocument(i,s,o);n=new jB(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=uV(e,r.document),s=r.readTime?oV(r.readTime):AL.min(),o=dF.newNoDocument(i,s);n=new jB([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=uV(e,r.document);n=new jB([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return uL();{const e=t.filter,r=new OB(e.count||0);n=new ZB(e.targetId,r)}}var r;return n}(this.k,e),n=function(e){if(!("targetChange"in e))return AL.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?AL.min():t.readTime?oV(t.readTime):AL.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=dV(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=yF(r)?{documents:gV(e,r)}:{query:mV(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=iV(e,t.resumeToken):t.snapshotVersion.compareTo(AL.min())>0&&(n.readTime=rV(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return uL()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=dV(this.k),t.removeTarget=e,this.gr(t)}}class zU extends UU{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(hL(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(hL(void 0!==t),e.map(e=>function(e,t){let n=oV(e.updateTime?e.updateTime:t);return n.isEqual(AL.min())&&(n=oV(t)),new uB(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=oV(e.commitTime);return this.listener.Cr(n,t)}return hL(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=dV(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof _B)n={update:pV(e,t.key,t.value)};else if(t instanceof SB)n={delete:lV(e,t.key)};else if(t instanceof CB)n={update:pV(e,t.key,t.data),updateMask:TV(t.fieldMask)};else{if(!(t instanceof PB))return uL();n={verify:lV(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof tB)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof nB)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof iB)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof oB)return{fieldPath:t.field.canonicalString(),increment:n.N};throw uL()}(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:sV(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:uL()),n;var r}(this.k,e))};this.gr(t)}}class HU extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new pL(fL.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.Bi(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===fL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pL(fL.UNKNOWN,e.toString())})}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.ji(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===fL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pL(fL.UNKNOWN,e.toString())})}terminate(){this.$r=!0}}class GU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(aL(t),this.Lr=!1):oL("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class qU{constructor(e,t,n,r,i){var s=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(e=>{n.enqueueAndForget(dw(function*(){var e;n$(s)&&(oL("RemoteStore","Restarting streams for network reachability change."),yield(e=dw(function*(e){const t=dL(e);t.Gr.add(4),yield ZU(t),t.Jr.set("Unknown"),t.Gr.delete(4),yield WU(t)}),function(t){return e.apply(this,arguments)})(s))}))}),this.Jr=new GU(n,r)}}function WU(e){return jU.apply(this,arguments)}function jU(){return(jU=dw(function*(e){if(n$(e))for(const t of e.zr)yield t(!0)})).apply(this,arguments)}function ZU(e){return YU.apply(this,arguments)}function YU(){return(YU=dw(function*(e){for(const t of e.zr)yield t(!1)})).apply(this,arguments)}function KU(e,t){const n=dL(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),t$(n)?e$(n):A$(n).lr()&&QU(n,t))}function JU(e,t){const n=dL(e),r=A$(n);n.Wr.delete(t),r.lr()&&XU(n,t),0===n.Wr.size&&(r.lr()?r._r():n$(n)&&n.Jr.set("Unknown"))}function QU(e,t){e.Yr.X(t.targetId),A$(e).Pr(t)}function XU(e,t){e.Yr.X(t),A$(e).vr(t)}function e$(e){e.Yr=new JB({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),A$(e).start(),e.Jr.Br()}function t$(e){return n$(e)&&!A$(e).hr()&&e.Wr.size>0}function n$(e){return 0===dL(e).Gr.size}function r$(e){e.Yr=void 0}function i$(e){return s$.apply(this,arguments)}function s$(){return(s$=dw(function*(e){e.Wr.forEach((t,n)=>{QU(e,t)})})).apply(this,arguments)}function o$(e,t){return a$.apply(this,arguments)}function a$(){return(a$=dw(function*(e,t){r$(e),t$(e)?(e.Jr.Kr(t),e$(e)):e.Jr.set("Unknown")})).apply(this,arguments)}function c$(e,t,n){return l$.apply(this,arguments)}function l$(){return(l$=dw(function*(e,t,n){if(e.Jr.set("Online"),t instanceof YB&&2===t.state&&t.cause)try{yield(r=dw(function*(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}),function(e,t){return r.apply(this,arguments)})(e,t)}catch(r){oL("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield u$(e,r)}else if(t instanceof jB?e.Yr.ot(t):t instanceof ZB?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(AL.min()))try{const t=yield fU(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(VL.EMPTY_BYTE_STRING,n.snapshotVersion)),XU(e,t);const r=new KV(n.target,t,1,n.sequenceNumber);QU(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){oL("RemoteStore","Failed to raise snapshot:",r),yield u$(e,r)}var r})).apply(this,arguments)}function u$(e,t,n){return h$.apply(this,arguments)}function h$(){return(h$=dw(function*(e,t,n){if(!jV(t))throw t;e.Gr.add(1),yield ZU(e),e.Jr.set("Offline"),n||(n=()=>fU(e.localStore)),e.asyncQueue.enqueueRetryable(dw(function*(){oL("RemoteStore","Retrying IndexedDB access"),yield n(),e.Gr.delete(1),yield WU(e)}))})).apply(this,arguments)}function d$(e,t){return t().catch(n=>u$(e,n,t))}function f$(e){return p$.apply(this,arguments)}function p$(){return(p$=dw(function*(e){const t=dL(e),n=N$(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;g$(t);)try{const e=yield gU(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,m$(t,e)}catch(i){yield u$(t,i)}y$(t)&&v$(t)})).apply(this,arguments)}function g$(e){return n$(e)&&e.Qr.length<10}function m$(e,t){e.Qr.push(t);const n=N$(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function y$(e){return n$(e)&&!N$(e).hr()&&e.Qr.length>0}function v$(e){N$(e).start()}function _$(e){return C$.apply(this,arguments)}function C$(){return(C$=dw(function*(e){N$(e).kr()})).apply(this,arguments)}function E$(e){return w$.apply(this,arguments)}function w$(){return(w$=dw(function*(e){const t=N$(e);for(const n of e.Qr)t.Dr(n.mutations)})).apply(this,arguments)}function b$(e,t,n){return S$.apply(this,arguments)}function S$(){return(S$=dw(function*(e,t,n){const r=e.Qr.shift(),i=YV.from(r,t,n);yield d$(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield f$(e)})).apply(this,arguments)}function P$(e,t){return O$.apply(this,arguments)}function O$(){return(O$=dw(function*(e,t){var n;t&&N$(e).Sr&&(yield(n=dw(function*(e,t){if(kB(n=t.code)&&n!==fL.ABORTED){const n=e.Qr.shift();N$(e).wr(),yield d$(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield f$(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),y$(e)&&v$(e)})).apply(this,arguments)}function T$(e,t){return I$.apply(this,arguments)}function I$(){return(I$=dw(function*(e,t){const n=dL(e);n.asyncQueue.verifyOperationInProgress(),oL("RemoteStore","RemoteStore received new credentials");const r=n$(n);n.Gr.add(3),yield ZU(n),r&&n.Jr.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),yield WU(n)})).apply(this,arguments)}function k$(){return(k$=dw(function*(e,t){const n=dL(e);t?(n.Gr.delete(2),yield WU(n)):t||(n.Gr.add(2),yield ZU(n),n.Jr.set("Unknown"))})).apply(this,arguments)}function A$(e){return e.Xr||(e.Xr=function(e,t,n){const r=dL(e);return r.Or(),new $U(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:i$.bind(null,e),Ni:o$.bind(null,e),br:c$.bind(null,e)}),e.zr.push(function(){var t=dw(function*(t){t?(e.Xr.wr(),t$(e)?e$(e):e.Jr.set("Unknown")):(yield e.Xr.stop(),r$(e))});return function(e){return t.apply(this,arguments)}}())),e.Xr}function N$(e){return e.Zr||(e.Zr=function(e,t,n){const r=dL(e);return r.Or(),new zU(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:_$.bind(null,e),Ni:P$.bind(null,e),Nr:E$.bind(null,e),Cr:b$.bind(null,e)}),e.zr.push(function(){var t=dw(function*(t){t?(e.Zr.wr(),yield f$(e)):(yield e.Zr.stop(),e.Qr.length>0&&(oL("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))});return function(e){return t.apply(this,arguments)}}())),e.Zr}class M${constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new gL,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new M$(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new pL(fL.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function x$(e,t){if(aL("AsyncQueue",`${t}: ${e}`),jV(e))return new pL(fL.UNAVAILABLE,`${t}: ${e}`);throw e}class R${constructor(e){this.comparator=e?(t,n)=>e(t,n)||YL.comparator(t.key,n.key):(e,t)=>YL.comparator(e.key,t.key),this.keyedMap=VB(),this.sortedSet=new NB(this.comparator)}static emptySet(e){return new R$(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof R$)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new R$;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class D${constructor(){this.eo=new NB(YL.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):uL():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,n)=>{e.push(n)}),e}}class L${constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new L$(e,t,R$.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zF(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class F${constructor(){this.so=void 0,this.listeners=[]}}class B${constructor(){this.queries=new sU(e=>HF(e),zF),this.onlineState="Unknown",this.io=new Set}}function V$(e,t){return U$.apply(this,arguments)}function U$(){return(U$=dw(function*(e,t){const n=dL(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new F$),i)try{s.so=yield n.onListen(r)}catch(o){const e=x$(o,`Initialization of query '${GF(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&q$(n)})).apply(this,arguments)}function $$(e,t){return z$.apply(this,arguments)}function z$(){return(z$=dw(function*(e,t){const n=dL(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)})).apply(this,arguments)}function H$(e,t){const n=dL(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.oo(i)&&(r=!0);e.so=i}}r&&q$(n)}function G$(e,t,n){const r=dL(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function q$(e){e.io.forEach(e=>{e.next()})}class W${constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new L$(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=L$.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class j${constructor(e){this.key=e}}class Z${constructor(e){this.key=e}}class Y${constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=zB(),this.mutatedKeys=zB(),this.Ao=WF(e),this.Ro=new R$(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new D$,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=DF(this.query)&&r.size===this.query.limit?r.last():null,c=LF(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const l=r.get(e),u=qF(this.query,t)?t:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.Vo(l,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ao(u,a)>0||c&&this.Ao(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),DF(this.query)||LF(this.query))for(;s.size>this.query.limit;){const e=DF(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return uL()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc)),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new L$(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new D$,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(e=>this.To=this.To.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.To=this.To.delete(e)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=zB(),this.Ro.forEach(e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))});const t=[];return e.forEach(e=>{this.Io.has(e)||t.push(new Z$(e))}),this.Io.forEach(n=>{e.has(n)||t.push(new j$(n))}),t}ko(e){this.To=e.zn,this.Io=zB();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return L$.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class K${constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class J${constructor(e){this.key=e,this.$o=!1}}class Q${constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new sU(e=>HF(e),zF),this.Fo=new Map,this.Lo=new Set,this.Bo=new NB(YL.comparator),this.Uo=new Map,this.qo=new EU,this.Ko={},this.jo=new Map,this.Qo=nU.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function X$(e,t){return ez.apply(this,arguments)}function ez(){return(ez=dw(function*(e,t){const n=Tz(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=yield mU(n.localStore,$F(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=yield tz(n,t,r,"current"===s),n.isPrimaryClient&&KU(n.remoteStore,e)}return i})).apply(this,arguments)}function tz(e,t,n,r){return nz.apply(this,arguments)}function nz(){return(nz=dw(function*(e,t,n,r){e.Go=(t,n,r)=>{return(i=dw(function*(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=yield _U(e.localStore,t.query,!1).then(({documents:e})=>t.view.Po(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return _z(e,t.targetId,o.Co),o.snapshot}),function(e,t,n,r){return i.apply(this,arguments)})(e,t,n,r);var i};const i=yield _U(e.localStore,t,!0),s=new Y$(t,i.zn),o=s.Po(i.documents),a=WB.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);_z(e,n,c.Co);const l=new K$(t,n,s);return e.Mo.set(t,l),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),c.snapshot})).apply(this,arguments)}function rz(e,t){return iz.apply(this,arguments)}function iz(){return(iz=dw(function*(e,t){const n=dL(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter(e=>!zF(e,t))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield yU(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),JU(n.remoteStore,r.targetId),yz(n,r.targetId)}).catch(rU))):(yz(n,r.targetId),yield yU(n.localStore,r.targetId,!0))})).apply(this,arguments)}function sz(){return(sz=dw(function*(e,t,n){const r=Iz(e);try{const e=yield function(e,t){const n=dL(e),r=kL.now(),i=t.reduce((e,t)=>e.add(t.key),zB());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Wn.vn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=mB(e,s.get(e.key));null!=t&&o.push(new CB(e.key,t,hF(t.value.mapValue),hB.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new NB(TL)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),yield wz(r,e.changes),yield f$(r.remoteStore)}catch(i){const e=x$(i,"Failed to persist write");n.reject(e)}})).apply(this,arguments)}function oz(e,t){return az.apply(this,arguments)}function az(){return(az=dw(function*(e,t){const n=dL(e);try{const e=yield pU(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Uo.get(t);r&&(hL(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?hL(r.$o):e.removedDocuments.size>0&&(hL(r.$o),r.$o=!1))}),yield wz(n,e,t)}catch(r){yield rU(r)}})).apply(this,arguments)}function cz(e,t,n){const r=dL(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=dL(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)}),r&&q$(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function lz(e,t,n){return uz.apply(this,arguments)}function uz(){return(uz=dw(function*(e,t,n){const r=dL(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new NB(YL.comparator);e=e.insert(s,dF.newNoDocument(s,AL.min()));const n=zB().add(s),i=new qB(AL.min(),new Map,new RB(TL),e,n);yield oz(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),Ez(r)}else yield yU(r.localStore,t,!1).then(()=>yz(r,t,n)).catch(rU)})).apply(this,arguments)}function hz(e,t){return dz.apply(this,arguments)}function dz(){return(dz=dw(function*(e,t){const n=dL(e),r=t.batch.batchId;try{const e=yield dU(n.localStore,t);mz(n,r,null),gz(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield wz(n,e)}catch(i){yield rU(i)}})).apply(this,arguments)}function fz(e,t,n){return pz.apply(this,arguments)}function pz(){return(pz=dw(function*(e,t,n){const r=dL(e);try{const e=yield function(e,t){const n=dL(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.An.lookupMutationBatch(e,t).next(t=>(hL(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t))).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(r.localStore,t);mz(r,t,n),gz(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield wz(r,e)}catch(i){yield rU(i)}})).apply(this,arguments)}function gz(e,t){(e.jo.get(t)||[]).forEach(e=>{e.resolve()}),e.jo.delete(t)}function mz(e,t,n){const r=dL(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function yz(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach(t=>{e.qo.containsKey(t)||vz(e,t)})}function vz(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(JU(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Ez(e))}function _z(e,t,n){for(const r of n)r instanceof j$?(e.qo.addReference(r.key,t),Cz(e,r)):r instanceof Z$?(oL("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||vz(e,r.key)):uL()}function Cz(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(oL("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Ez(e))}function Ez(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new YL(DL.fromString(t)),r=e.Qo.next();e.Uo.set(r,new J$(n)),e.Bo=e.Bo.insert(n,r),KU(e.remoteStore,new KV($F(RF(n.path)),r,2,SL.I))}}function wz(e,t,n){return bz.apply(this,arguments)}function bz(){return(bz=dw(function*(e,t,n){const r=dL(e),i=[],s=[],o=[];var a;r.Mo.isEmpty()||(r.Mo.forEach((e,a)=>{o.push(r.Go(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=aU.$n(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),r.Oo.br(i),yield(a=dw(function*(e,t){const n=dL(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>WV.forEach(t,t=>WV.forEach(t.kn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>WV.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!jV(r))throw r;oL("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.qn.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.qn=n.qn.insert(e,r)}}}),function(e,t){return a.apply(this,arguments)})(r.localStore,s))})).apply(this,arguments)}function Sz(e,t){return Pz.apply(this,arguments)}function Pz(){return(Pz=dw(function*(e,t){const n=dL(e);if(!n.currentUser.isEqual(t)){oL("SyncEngine","User change. New user:",t.toKey());const e=yield uU(n.localStore,t);n.currentUser=t,(r=n).jo.forEach(e=>{e.forEach(e=>{e.reject(new pL(fL.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.jo.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield wz(n,e.Gn)}var r})).apply(this,arguments)}function Oz(e,t){const n=dL(e),r=n.Uo.get(t);if(r&&r.$o)return zB().add(r.key);{let e=zB();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}function Tz(e){const t=dL(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=oz.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Oz.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lz.bind(null,t),t.Oo.br=H$.bind(null,t.eventManager),t.Oo.zo=G$.bind(null,t.eventManager),t}function Iz(e){const t=dL(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=hz.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=fz.bind(null,t),t}class kz{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return dw(function*(){t.k=BU(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return function(e,t,n,r){return new lU(e,t,n,r)}(this.persistence,new cU,e.initialUser,this.k)}Yo(e){return new TU(kU.ks,this.k)}Jo(e){return new NU}terminate(){var e=this;return dw(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Az{initialize(e,t){var n=this;return dw(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>cz(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=Sz.bind(null,n.syncEngine),yield function(e,t){return k$.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new B$}createDatastore(e){const t=BU(e.databaseInfo.databaseId),n=new LU(e.databaseInfo);return new HU(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>cz(this.syncEngine,e,0),s=xU.Pt()?new xU:new MU,new qU(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Q$(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=dw(function*(e){const t=dL(e);oL("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),yield ZU(t),t.Hr.shutdown(),t.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class Nz{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Mz{constructor(e,t,n,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=nL.UNAUTHENTICATED,this.clientId=OL.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var e=dw(function*(e){oL("FirestoreClient","Received user=",e.uid),yield i.authCredentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(n,e=>(oL("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}getConfiguration(){var e=this;return dw(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new pL(fL.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new gL;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(dw(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const e=x$(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function xz(e,t){return Rz.apply(this,arguments)}function Rz(){return(Rz=dw(function*(e,t){e.asyncQueue.verifyOperationInProgress(),oL("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(function(){var e=dw(function*(e){r.isEqual(e)||(yield uU(t.localStore,e),r=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function Dz(e,t){return Lz.apply(this,arguments)}function Lz(){return(Lz=dw(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield Fz(e);oL("FirestoreClient","Initializing OnlineComponentProvider");const r=yield e.getConfiguration();yield t.initialize(n,r),e.setCredentialChangeListener(e=>T$(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>T$(t.remoteStore,n)),e.onlineComponents=t})).apply(this,arguments)}function Fz(e){return Bz.apply(this,arguments)}function Bz(){return(Bz=dw(function*(e){return e.offlineComponents||(oL("FirestoreClient","Using default OfflineComponentProvider"),yield xz(e,new kz)),e.offlineComponents})).apply(this,arguments)}function Vz(e){return Uz.apply(this,arguments)}function Uz(){return(Uz=dw(function*(e){return e.onlineComponents||(oL("FirestoreClient","Using default OnlineComponentProvider"),yield Dz(e,new Az)),e.onlineComponents})).apply(this,arguments)}function $z(e){return zz.apply(this,arguments)}function zz(){return(zz=dw(function*(e){const t=yield Vz(e),n=t.eventManager;return n.onListen=X$.bind(null,t.syncEngine),n.onUnlisten=rz.bind(null,t.syncEngine),n})).apply(this,arguments)}class Hz{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Gz{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gz&&e.projectId===this.projectId&&e.database===this.database}}const qz=new Map;function Wz(e,t,n){if(!n)throw new pL(fL.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function jz(e){if(!YL.isDocumentKey(e))throw new pL(fL.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Zz(e){if(YL.isDocumentKey(e))throw new pL(fL.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Yz(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":uL()}function Kz(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new pL(fL.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yz(e);throw new pL(fL.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Jz{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new pL(fL.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new pL(fL.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new pL(fL.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qz{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jz({}),this._settingsFrozen=!1,e instanceof Gz?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new pL(fL.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gz(e.options.projectId)}(e))}get app(){if(!this._app)throw new pL(fL.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new pL(fL.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jz(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new yL;switch(e.type){case"gapi":const t=e.client;return hL(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new EL(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new pL(fL.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=qz.get(e);t&&(oL("ComponentProvider","Removing Datastore"),qz.delete(e),t.terminate())}(this),Promise.resolve()}}function Xz(e,t,n,r={}){var i;const s=(e=Kz(e,Qz))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&cL("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=nL.MOCK_USER;else{t=Aw(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new pL(fL.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new nL(s)}e._authCredentials=new vL(new mL(t,n))}}class eH{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nH(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new eH(this.firestore,e,this._key)}}class tH{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new tH(this.firestore,e,this._query)}}class nH extends tH{constructor(e,t,n){super(e,t,RF(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new eH(this.firestore,null,new YL(e))}withConverter(e){return new nH(this.firestore,e,this._path)}}function rH(e,t,...n){if(e=ob(e),Wz("collection","path",t),e instanceof Qz){const r=DL.fromString(t,...n);return Zz(r),new nH(e,null,r)}{if(!(e instanceof eH||e instanceof nH))throw new pL(fL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(DL.fromString(t,...n));return Zz(r),new nH(e.firestore,null,r)}}function iH(e,t,...n){if(e=ob(e),1===arguments.length&&(t=OL.A()),Wz("doc","path",t),e instanceof Qz){const r=DL.fromString(t,...n);return jz(r),new eH(e,null,new YL(r))}{if(!(e instanceof eH||e instanceof nH))throw new pL(fL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(DL.fromString(t,...n));return jz(r),new eH(e.firestore,e instanceof nH?e.converter:null,new YL(r))}}class sH{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new VU(this,"async_queue_retry"),this.bc=()=>{const e=FU();e&&oL("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=FU();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=FU();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new gL;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}Vc(){var e=this;return dw(function*(){if(0!==e.gc.length){try{yield e.gc[0](),e.gc.shift(),e.ur.reset()}catch(t){if(!jV(t))throw t;oL("AsyncQueue","Operation failed with retryable error: "+t)}e.gc.length>0&&e.ur.Zi(()=>e.Vc())}})()}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(e=>{throw this.Ec=e,this.Ic=!1,aL("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ic=!1,e))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=M$.createAndSchedule(this,e,t,n,e=>this.Sc(e));return this.Tc.push(r),r}Pc(){this.Ec&&uL()}verifyOperationInProgress(){}Dc(){var e=this;return dw(function*(){let t;do{t=e.mc,yield t}while(t!==e.mc)})()}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function oH(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class aH extends Qz{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new sH,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||uH(this),this._firestoreClient.terminate()}}function cH(e=Mb()){return Tb(e,"firestore").getImmediate()}function lH(e){return e._firestoreClient||uH(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function uH(e){var t;const n=e._freezeSettings(),r=(i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new Hz(e._databaseId,i,e._persistenceKey,(s=n).host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));var i,s;e._firestoreClient=new Mz(e._authCredentials,e._appCheckCredentials,e._queue,r)}class hH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new pL(fL.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FL(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class dH{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dH(VL.fromBase64String(e))}catch(t){throw new pL(fL.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new dH(VL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fH{constructor(e){this._methodName=e}}class pH{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pL(fL.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pL(fL.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return TL(this._lat,e._lat)||TL(this._long,e._long)}}const gH=/^__.*__$/;class mH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new CB(e,this.data,this.fieldMask,t,this.fieldTransforms):new _B(e,this.data,t,this.fieldTransforms)}}class yH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new CB(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vH(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw uL()}}class _H{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new _H(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return MH(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(vH(this.$c)&&gH.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class CH{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||BU(e)}Qc(e,t,n,r=!1){return new _H({$c:e,methodName:t,jc:n,path:FL.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function EH(e){const t=e._freezeSettings(),n=BU(e._databaseId);return new CH(e._databaseId,!!t.ignoreUndefinedProperties,n)}function wH(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);IH("Data must be an object, but it was:",o,r);const a=OH(r,o);let c,l;if(s.merge)c=new BL(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=kH(t,r,n);if(!o.contains(i))throw new pL(fL.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);xH(e,i)||e.push(i)}c=new BL(e),l=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=o.fieldTransforms;return new mH(new uF(a),c,l)}class bH extends fH{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bH}}class SH extends fH{_toFieldTransform(e){return new lB(e.path,new tB)}isEqual(e){return e instanceof SH}}function PH(e,t){if(TH(e=ob(e)))return IH("Unsupported field value:",t,e),OH(e,t);if(e instanceof fH)return function(e,t){if(!vH(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=PH(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=ob(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return KF(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=kL.fromDate(e);return{timestampValue:rV(t.k,n)}}if(e instanceof kL){const n=new kL(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:rV(t.k,n)}}if(e instanceof pH)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof dH)return{bytesValue:iV(t.k,e._byteString)};if(e instanceof eH){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aV(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${Yz(e)}`)}(e,t)}function OH(e,t){const n={};return xL(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ML(e,(e,r)=>{const i=PH(r,t.Mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function TH(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof kL||e instanceof pH||e instanceof dH||e instanceof eH||e instanceof fH)}function IH(e,t,n){if(!TH(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Yz(n);throw t.qc("an object"===r?e+" a custom object":e+" "+r)}var r}function kH(e,t,n){if((t=ob(t))instanceof hH)return t._internalPath;if("string"==typeof t)return NH(e,t);throw MH("Field path arguments must be of type string or ",e,!1,void 0,n)}const AH=new RegExp("[~\\*/\\[\\]]");function NH(e,t,n){if(t.search(AH)>=0)throw MH(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new hH(...t.split("."))._internalPath}catch{throw MH(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function MH(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new pL(fL.INVALID_ARGUMENT,a+e+c)}function xH(e,t){return e.some(e=>e.isEqual(t))}class RH{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new eH(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new DH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(LH("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class DH extends RH{data(){return super.data()}}function LH(e,t){return"string"==typeof t?NH(e,t):t instanceof hH?t._internalPath:t._delegate._internalPath}class FH{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class BH extends RH{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new VH(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(LH("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class VH extends BH{data(e={}){return super.data(e)}}class UH{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new FH(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new VH(this._firestore,this._userDataWriter,n.key,n,new FH(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pL(fL.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new VH(e._firestore,e._userDataWriter,n.doc.key,n.doc,new FH(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new VH(e._firestore,e._userDataWriter,t.doc.key,t.doc,new FH(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:$H(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function $H(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return uL()}}function zH(e){if(LF(e)&&0===e.explicitOrderBy.length)throw new pL(fL.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function HH(e,...t){for(const n of t)e=n._apply(e);return e}class GH extends class{}{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=EH(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new pL(fL.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){jH(o,s);const t=[];for(const n of o)t.push(WH(r,e,n));a={arrayValue:{values:t}}}else a=WH(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||jH(o,s),a=function(e,t,n,r=!1){return PH(n,e.Qc(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);const c=vF.create(i,s,a);return function(e,t){if(t.V()){const n=BF(e);if(null!==n&&!n.isEqual(t.field))throw new pL(fL.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=FF(e);null!==r&&function(e,t,n){if(!n.isEqual(t))throw new pL(fL.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new pL(fL.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new tH(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new xF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function qH(e,t,n){const r=t,i=LH("where",e);return new GH(i,r,n)}function WH(e,t,n){if("string"==typeof(n=ob(n))){if(""===n)throw new pL(fL.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!VF(t)&&-1!==n.indexOf("/"))throw new pL(fL.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(DL.fromString(n));if(!YL.isDocumentKey(r))throw new pL(fL.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rF(e,new YL(r))}if(n instanceof eH)return rF(e,n._key);throw new pL(fL.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yz(n)}.`)}function jH(e,t){if(!Array.isArray(e)||0===e.length)throw new pL(fL.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new pL(fL.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function ZH(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function YH(e){e=Kz(e,eH);const t=Kz(e.firestore,aH);return function(e,t,n={}){const r=new gL;return e.asyncQueue.enqueueAndForget(dw(function*(){return function(e,t,n,r,i){const s=new Nz({next:s=>{t.enqueueAndForget(()=>$$(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new pL(fL.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new pL(fL.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new W$(RF(n.path),s,{includeMetadataChanges:!0,wo:!0});return V$(e,o)}(yield $z(e),e.asyncQueue,t,n,r)})),r.promise}(lH(t),e._key).then(n=>iG(t,e,n))}class KH extends class{convertValue(e,t="none"){switch(KL(e)){case 0:return null;case 1:return e.booleanValue;case 2:return zL(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(HL(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw uL()}}convertObject(e,t){const n={};return ML(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new pH(zL(e.latitude),zL(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=qL(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(WL(e));default:return null}}convertTimestamp(e){const t=$L(e);return new kL(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=DL.fromString(e);hL(IV(n));const r=new Gz(n.get(1),n.get(3)),i=new YL(n.popFirst(5));return r.isEqual(t)||aL(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new dH(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new eH(this.firestore,null,t)}}function JH(e){e=Kz(e,tH);const t=Kz(e.firestore,aH),n=lH(t),r=new KH(t);return zH(e._query),function(e,t,n={}){const r=new gL;return e.asyncQueue.enqueueAndForget(dw(function*(){return function(e,t,n,r,i){const s=new Nz({next:n=>{t.enqueueAndForget(()=>$$(e,o)),n.fromCache&&"server"===r.source?i.reject(new pL(fL.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new W$(n,s,{includeMetadataChanges:!0,wo:!0});return V$(e,o)}(yield $z(e),e.asyncQueue,t,n,r)})),r.promise}(n,e._query).then(n=>new UH(t,r,e,n))}function QH(e,t,n){e=Kz(e,eH);const r=Kz(e.firestore,aH),i=ZH(e.converter,t,n);return rG(r,[wH(EH(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,hB.none())])}function XH(e,t,n,...r){e=Kz(e,eH);const i=Kz(e.firestore,aH),s=EH(i);let o;return o="string"==typeof(t=ob(t))||t instanceof hH?function(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[kH(t,r,n)],c=[i];if(s.length%2!=0)throw new pL(fL.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(kH(t,s[d])),c.push(s[d+1]);const l=[],u=uF.empty();for(let d=a.length-1;d>=0;--d)if(!xH(l,a[d])){const e=a[d];let t=c[d];t=ob(t);const n=o.Bc(e);if(t instanceof bH)l.push(e);else{const r=PH(t,n);null!=r&&(l.push(e),u.set(e,r))}}const h=new BL(l);return new yH(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qc(1,t,n);IH("Data must be an object, but it was:",i,r);const s=[],o=uF.empty();ML(r,(e,r)=>{const a=NH(t,e,n);r=ob(r);const c=i.Bc(a);if(r instanceof bH)s.push(a);else{const e=PH(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new BL(s);return new yH(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),rG(i,[o.toMutation(e._key,hB.exists(!0))])}function eG(e){return rG(Kz(e.firestore,aH),[new SB(e._key,hB.none())])}function tG(e,t){const n=Kz(e.firestore,aH),r=iH(e),i=ZH(e.converter,t);return rG(n,[wH(EH(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,hB.exists(!1))]).then(()=>r)}function nG(e,...t){var n,r,i;e=ob(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||oH(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(oH(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,l,u;if(e instanceof eH)l=Kz(e.firestore,aH),u=RF(e._key.path),c={next:n=>{t[o]&&t[o](iG(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Kz(e,tH);l=Kz(n.firestore,aH),u=n._query;const r=new KH(l);c={next:e=>{t[o]&&t[o](new UH(l,r,n,e))},error:t[o+1],complete:t[o+2]},zH(e._query)}return function(e,t,n,r){const i=new Nz(r),s=new W$(t,i,n);return e.asyncQueue.enqueueAndForget(dw(function*(){return V$(yield $z(e),s)})),()=>{i.nc(),e.asyncQueue.enqueueAndForget(dw(function*(){return $$(yield $z(e),s)}))}}(lH(l),u,a,c)}function rG(e,t){return function(e,t){const n=new gL;return e.asyncQueue.enqueueAndForget(dw(function*(){return function(e,t,n){return sz.apply(this,arguments)}(yield function(e){return Vz(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(lH(e),t)}function iG(e,t,n){const r=n.docs.get(t._key),i=new KH(e);return new BH(e,i,t._key,r,new FH(n.hasPendingWrites,n.fromCache),t.converter)}function sG(){return new SH("serverTimestamp")}!function(e,t=!0){rL="9.6.6",Ob(new ab("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new aH(r,new _L(e.getProvider("auth-internal")),new bL(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),Rb(tL,"3.4.4",e),Rb(tL,"3.4.4","esm2017")}();class oG{constructor(e){return e}}const aG=new or("angularfire2.firestore-instances");function cG(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new oG(r)}}const lG={provide:class{constructor(){return fT("firestore")}},deps:[[new Mr,aG]]},uG={provide:oG,useFactory:function(e,t){const n=dT("firestore",e,t);return n&&new oG(n)},deps:[[new Mr,aG],ST]};let hG=(()=>{class e{constructor(){Rb("angularfire",cT.full,"fst")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[uG,lG]}),e})();const dG=bT(tG,!0),fG=bT(rH,!0),pG=bT(Xz,!0),gG=bT(eG,!0),mG=bT(iH,!0),yG=bT(YH,!0),vG=bT(JH,!0),_G=bT(cH,!0),CG=bT(nG,!0),EG=bT(HH,!0),wG=bT(QH,!0),bG=bT(XH,!0),SG=bT(qH,!0);let PG=(()=>{class e{constructor(e,t){this.collectionName=e,this.firestore=t;this.collection=fG(t,this.collectionName).withConverter({fromFirestore:e=>e.data(),toFirestore:e=>e})}create(e){var t=this;return dw(function*(){return(yield dG(t.collection,{...e})).id})()}read(e){var t=this;return dw(function*(){const n=yield yG(mG(t.collection,e));return n.exists()?vw.of(fw.getNonNullable(n.data())):vw.empty()})()}exists(e){var t=this;return dw(function*(){return(yield t.read(e)).isPresent()})()}update(e,t){var n=this;return dw(function*(){return bG(mG(n.collection,e),t)})()}delete(e){return gG(mG(this.collection,e))}set(t,n){return pw(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),wG(mG(this.collection,t),n)}subscribeToChanges(e,t){return CG(mG(this.collection,e),e=>{t(vw.ofNullable(e.data()))})}findWhere(e){var t=this;return dw(function*(){return(yield vG(t.constructQuery(e))).docs.map(e=>({id:e.id,data:e.data()}))})()}observingWhere(t,n){return CG(this.constructQuery(t),t=>{const r=[],i=[],s=[];t.docChanges().forEach(e=>{const t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":i.push(t);break;case"removed":s.push(t)}}),r.length>0&&(pw(e.VERBOSE,"firebase gave us "+r.length+" NEW "+this.collectionName),n.onDocumentCreated(r)),i.length>0&&(pw(e.VERBOSE,"firebase gave us "+i.length+" MODIFIED "+this.collectionName),n.onDocumentModified(i)),s.length>0&&(pw(e.VERBOSE,"firebase gave us "+s.length+" DELETED "+this.collectionName),n.onDocumentDeleted(s))})}constructQuery(e){let t=EG(this.collection);for(const n of e)t=EG(t,SG(n[0],n[1],n[2]));return fw.getNonNullable(t)}}return e.VERBOSE=!1,e})();class OG{static success(e){return new TG(e)}static failure(e){return new IG(e)}constructor(){}equals(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&yw(this.get(),e.get())}}class TG extends OG{constructor(e){super(),this.value=e}isSuccess(){return!0}isFailure(){return!1}get(){return this.value}getReason(){throw new Error("Cannot get failure reason from a success")}getReasonOr(e){return e}toOptional(){return vw.of(this.value)}toString(){return`MGPFallible.success(${this.value})`}}class IG extends OG{constructor(e){super(),this.reason=e}isSuccess(){return!1}isFailure(){return!0}get(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}getReason(){return this.reason}getReasonOr(e){return this.getReason()}toOptional(){return vw.empty()}toString(){return`MGPFallible.failure(${this.reason})`}}class kG{constructor(e){this.reason=e}static ofFallible(e){return e.isSuccess()?kG.SUCCESS:kG.failure(e.getReason())}static failure(e){return new kG(e)}isFailure(){return!1===this.isSuccess()}isSuccess(){return null==this.reason}getReason(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}toFallible(e){return this.isSuccess()?OG.success(e):OG.failure(this.getReason())}toFailedFallible(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return OG.failure(this.getReason())}}kG.SUCCESS=new kG(null);let AG=(()=>{class e extends PG{constructor(e){super("errors",e)}findErrors(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}return e.\u0275fac=function(t){return new(t||e)(Or(oG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),NG=(()=>{class e{constructor(t,n){this.errorDAO=t,this.router=n,e.setSingletonInstance(this)}static setSingletonInstance(t){e.singleton=vw.of(t)}static logError(e,t,n){if(this.singleton.isAbsent())throw new Error(`${e}: ${t} (extra data: ${n})`);return this.singleton.get().logError(e,t,n),kG.failure(e+": "+t)}logError(e,t,n){var r=this;return dw(function*(){const i=r.router.url,s=yield r.errorDAO.findErrors(e,i,t,n);if(0===s.length){const s={component:e,route:i,message:t,firstEncounter:sG(),lastEncounter:sG(),occurences:1};null!=n&&(s.data=n),yield r.errorDAO.create(s)}else{const e=s[0].id,t=s[0].data;yield r.errorDAO.update(e,{lastEncounter:sG(),occurences:t.occurences+1})}})()}}return e.\u0275fac=function(t){return new(t||e)(Or(AG),Or(t_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function MG(e,t){if(!1===e)throw NG.logError("Assertion failure",t),new Error(`Assertion failure: ${t}`)}class xG{constructor(e){this.value=e}}xG.HARD_DRAW=new xG(0),xG.RESIGN=new xG(1),xG.ESCAPE=new xG(2),xG.VICTORY=new xG(3),xG.TIMEOUT=new xG(4),xG.UNACHIEVED=new xG(5),xG.AGREED_DRAW_BY_ZERO=new xG(6),xG.AGREED_DRAW_BY_ONE=new xG(7);class RG{constructor(e,t){this.id=e,this.data=t}getTurn(){return this.data.turn}isHardDraw(){return this.data.result===xG.HARD_DRAW.value}isAgreedDraw(){return this.data.result===xG.AGREED_DRAW_BY_ZERO.value||this.data.result===xG.AGREED_DRAW_BY_ONE.value}getDrawAccepter(){return this.data.result===xG.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(MG(this.data.result===xG.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),fw.getNonNullable(this.data.playerOne))}isWin(){return this.data.result===xG.VICTORY.value}isTimeout(){return this.data.result===xG.TIMEOUT.value}isResign(){return this.data.result===xG.RESIGN.value}getWinner(){return vw.ofNullable(this.data.winner)}getLoser(){return vw.ofNullable(this.data.loser)}setWinnerAndLoser(e,t){return new RG(this.id,{...this.data,winner:e,loser:t})}}let DG=(()=>{class e extends PG{constructor(t){super("parties",t),pw(e.VERBOSE,"PartDAO.constructor")}updateAndBumpIndex(e,t,n,r){var i=this;return dw(function*(){return r={...r,lastUpdate:{index:n+1,player:t.value}},i.update(e,r)})()}observeActiveParts(e){return this.observingWhere([["result","==",xG.UNACHIEVED.value]],e)}userHasActivePart(e){var t=this;return dw(function*(){const n=yield t.findWhere([["playerZero","==",e],["result","==",xG.UNACHIEVED.value]]),r=yield t.findWhere([["playerOne","==",e],["result","==",xG.UNACHIEVED.value]]);return n.length>0||r.length>0})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(oG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class LG{static mapBiArray(e,t){const n=[];let r=0;for(;r<e.length;){n[r]=[];let i=0;for(;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}static createTable(e,t,n){const r=[];let i=t-1;for(;i>=0;){r[i]=[];let t=e-1;for(;t>=0;)r[i][t]=n,t--;i--}return r}static copyBiArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=LG.copyImmutableArray(e[n]),n++;return t}static copyImmutableArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=e[n],n++;return t}static sortByDescending(e,t){e.sort((e,n)=>{const r=t(e),i=t(n);return r<i?1:r>i?-1:0})}static compareArray(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===yw(e[n],t[n]))return!1;return!0}static compareTable(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===LG.compareArray(e[n],t[n]))return!1;return!0}}let FG=(()=>{class e extends PG{constructor(t){super("chats",t),pw(e.VERBOSE,"ChatDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(oG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),BG=(()=>{class e{}return e.CANNOT_SEND_MESSAGE=()=>$localize`You're not allowed to send a message here.`,e.FORBIDDEN_MESSAGE=()=>$localize`This message is forbidden.`,e})(),VG=(()=>{class e{constructor(t){this.chatDAO=t,this.followedChatId=vw.empty(),pw(e.VERBOSE,"ChatService.constructor")}startObserving(t,n){if(pw(e.VERBOSE,"ChatService.startObserving "+t),!this.followedChatId.isAbsent())throw this.followedChatId.equalsValue(t)?new Error(`WTF :: Already observing chat '${t}'`):new Error(`Cannot ask to watch '${t}' while watching '${this.followedChatId.get()}'`);pw(e.VERBOSE,"[start watching chat "+t),this.followedChatId=vw.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToChanges(t,n)}stopObserving(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");pw(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=vw.empty(),this.followedChatUnsubscribe()}isObserving(){return this.followedChatId.isPresent()}deleteChat(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)})()}createNewChat(e){var t=this;return dw(function*(){return t.chatDAO.set(e,{messages:[]})})()}sendMessage(e,t,n){var r=this;return dw(function*(){if(r.followedChatId.isAbsent())return kG.failure("Cannot send message if not observing chat");const i=r.followedChatId.get();if(!1===r.userCanSendMessage(e,i))return kG.failure(BG.CANNOT_SEND_MESSAGE());if(r.isForbiddenMessage(t))return kG.failure(BG.FORBIDDEN_MESSAGE());const s=(yield r.chatDAO.read(i)).get(),o=LG.copyImmutableArray(s.messages),a={content:t,sender:e,postedTime:Date.now(),currentTurn:n};return o.push(a),yield r.chatDAO.update(i,{messages:o}),kG.SUCCESS})()}userCanSendMessage(e,t){return""!==e}isForbiddenMessage(e){return""===e}ngOnDestroy(){this.isObserving()&&this.stopObserving()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(FG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class UG{constructor(e,t,n){this.onDocumentCreated=e,this.onDocumentModified=t,this.onDocumentDeleted=n}}let $G=(()=>{class e extends PG{constructor(t){super(e.COLLECTION_NAME,t),pw(e.VERBOSE,"JoueursDAO.constructor")}usernameIsAvailable(e){var t=this;return dw(function*(){return 0===(yield t.findWhere([["username","==",e]])).length})()}setUsername(e,t){var n=this;return dw(function*(){yield n.update(e,{username:t})})()}markVerified(e){var t=this;return dw(function*(){yield t.update(e,{verified:!0})})()}observeUserByUsername(e,t){return this.observingWhere([["username","==",e],["verified","==",!0]],t)}observeActiveUsers(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}}return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(Or(oG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),zG=(()=>{class e{constructor(e){this.userDAO=e,this.activeUsersBS=new cm([]),this.activeUsersObs=this.activeUsersBS.asObservable()}startObserving(){pw(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");const t=new UG(t=>{pw(e.VERBOSE,"our DAO gave us "+t.length+" new user(s)");const n=this.activeUsersBS.value.concat(...t);this.activeUsersBS.next(this.sort(n))},t=>{let n=this.activeUsersBS.value;pw(e.VERBOSE,"our DAO updated "+t.length+" user(s)");for(const e of t)n.forEach(t=>{t.id===e.id&&(t.data=e.data)}),n=this.sort(n);this.activeUsersBS.next(n)},e=>{const t=this.activeUsersBS.value.filter(t=>!e.some(e=>e.id===t.id));this.activeUsersBS.next(this.sort(t))});this.unsubscribe=this.userDAO.observeActiveUsers(t)}stopObserving(){this.unsubscribe(),this.activeUsersBS.next([])}sort(e){return e.sort((e,t)=>fw.getNonNullable(fw.getNonNullable(e.data).last_changed).seconds-fw.getNonNullable(fw.getNonNullable(t.data).last_changed).seconds)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or($G))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),HG=(()=>{class e{constructor(e,t){this.activeUsersService=e,this.joueursDAO=t}getActiveUsersObs(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}unSubFromActiveUsersObs(){this.activeUsersService.stopObserving()}observeUserByUsername(e,t){return this.joueursDAO.observeUserByUsername(e,t)}}return e.\u0275fac=function(t){return new(t||e)(Or(zG),Or($G))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class GG extends A{constructor(e=1/0,t=1/0,n=rT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:i,_windowTime:s}=this;t||(n.push(e),!r&&n.push(i.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:r}=this,i=r.slice();for(let s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2)r=t;r&&n.splice(0,r+1)}}}const qG="@firebase/database";let WG="";class jG{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Hw(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:zw(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ZG{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return qw(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const YG=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new jG(t)}}catch{}return new ZG},KG=YG("localStorage"),JG=YG("sessionStorage"),QG=new yb("@firebase/database"),XG=function(){let e=1;return function(){return e++}}(),eq=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,_w(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new eb;n.update(t);const r=n.digest();return ww.encodeByteArray(r)},tq=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=tq.apply(null,r):t+="object"==typeof r?Hw(r):r,t+=" "}return t};let nq=null,rq=!0;const iq=function(...e){if(!0===rq&&(rq=!1,null===nq&&!0===JG.get("logging_enabled")&&function(e,t){_w(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(QG.logLevel=db.VERBOSE,nq=QG.log.bind(QG),t&&JG.set("logging_enabled",!0)):"function"==typeof e?nq=e:(nq=null,JG.remove("logging_enabled"))}(!0)),nq){const t=tq.apply(null,e);nq(t)}},sq=function(e){return function(...t){iq(e,...t)}},oq=function(...e){const t="FIREBASE INTERNAL ERROR: "+tq(...e);QG.error(t)},aq=function(...e){const t=`FIREBASE FATAL ERROR: ${tq(...e)}`;throw QG.error(t),new Error(t)},cq=function(...e){const t="FIREBASE WARNING: "+tq(...e);QG.warn(t)},lq=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},uq="[MIN_NAME]",hq="[MAX_NAME]",dq=function(e,t){if(e===t)return 0;if(e===uq||t===hq)return-1;if(t===uq||e===hq)return 1;{const n=Cq(e),r=Cq(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},fq=function(e,t){return e===t?0:e<t?-1:1},pq=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Hw(t))},gq=function(e){if("object"!=typeof e||null===e)return Hw(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Hw(t[r]),n+=":",n+=gq(e[t[r]]);return n+="}",n},mq=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function yq(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const vq=function(e){_w(!lq(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,1-t)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},_q=new RegExp("^-?(0*)\\d{1,10}$"),Cq=function(e){if(_q.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Eq=function(e){try{e()}catch(t){setTimeout(()=>{throw cq("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},wq=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class bq{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){cq(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Sq{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(iq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',cq(e)}}let Pq=(()=>{class e{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return e.OWNER="owner",e})();const Oq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Tq="long_polling";class Iq{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=KG.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&KG.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function kq(e,t,n){let r;if(_w("string"==typeof t,"typeof type must == string"),_w("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Tq)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return yq(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Aq{constructor(){this.counters_={}}incrementCounter(e,t=1){qw(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Ow(this.counters_)}}const Nq={},Mq={};function xq(e){const t=e.toString();return Nq[t]||(Nq[t]=new Aq),Nq[t]}class Rq{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Eq(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Dq{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=sq(e),this.stats_=xq(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),kq(t,Tq,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Rq(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Lq((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Oq.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Dq.forceAllow_=!0}static forceDisallow(){Dq.forceDisallow_=!0}static isAvailable(){return!(!Dq.forceAllow_&&(Dq.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Hw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=bw(t),r=mq(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Hw(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Lq{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=XG(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Lq.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){iq("frame writing exception"),i.stack&&iq(i.stack),iq(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||iq("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;(!e||"loaded"===e||"complete"===e)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{iq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}let Fq=null;"undefined"!=typeof MozWebSocket?Fq=MozWebSocket:"undefined"!=typeof WebSocket&&(Fq=WebSocket);let Bq=(()=>{class e{constructor(t,n,r,i,s,o,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=sq(this.connId),this.stats_=xq(n),this.connURL=e.connectionURL_(n,o,a,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Oq.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),kq(e,"websocket",i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,KG.set("previous_websocket_failure",!0);try{this.mySock=new Fq(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Fq&&!e.forceDisallow_}static previouslyFailed(){return KG.isInMemoryStorage||!0===KG.get("previous_websocket_failure")}markConnectionHealthy(){KG.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=zw(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(_w(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Hw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=mq(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e})();class Vq{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Dq,Bq]}initTransports_(e){const t=Bq&&Bq.isAvailable();let n=t&&!Bq.previouslyFailed();if(e.webSocketOnly&&(t||cq("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Bq];else{const e=this.transports_=[];for(const t of Vq.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class Uq{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=sq("c:"+this.id+":"),this.transportManager_=new Vq(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=wq(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=pq("t",e),n=pq("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=pq("t",e),n=pq("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=pq("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?oq("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):oq("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&cq("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),wq(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):wq(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(KG.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class $q{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class zq{constructor(e){this.allowedEvents_=e,this.listeners_={},_w(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){_w(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Hq extends zq{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!Mw()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Hq}getInitialEvent(e){return _w("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Gq{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function qq(){return new Gq("")}function Wq(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function jq(e){return e.pieces_.length-e.pieceNum_}function Zq(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Gq(e.pieces_,t)}function Yq(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Kq(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Jq(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Gq(t,0)}function Qq(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Gq)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Gq(n,0)}function Xq(e){return e.pieceNum_>=e.pieces_.length}function eW(e,t){const n=Wq(e),r=Wq(t);if(null===n)return t;if(n===r)return eW(Zq(e),Zq(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function tW(e,t){const n=Kq(e,0),r=Kq(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=dq(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function nW(e,t){if(jq(e)!==jq(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function rW(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(jq(e)>jq(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class iW{constructor(e,t){this.errorPrefix_=t,this.parts_=Kq(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ib(this.parts_[n]);sW(this)}}function sW(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+oW(e))}function oW(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class aW extends zq{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new aW}getInitialEvent(e){return _w("visible"===e,"Unknown event type: "+e),[this.visible_]}}const cW=1e3;let lW,uW=(()=>{class e extends $q{constructor(t,n,r,i,s,o,a,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=e.nextPersistentConnectionId_++,this.log_=sq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=cW,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");aW.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Hq.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Hw(i)),_w(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new kw,n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const r=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,r,!1,null),t.resolve(r)):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const e=this.outstandingGets_[i];void 0===e||r!==e||(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),t.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),_w(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_w(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){const n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r};t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const o=s.d,a=s.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_("listen response",s),"ok"!==a&&this.removeListen_(r,i),t.onComplete&&t.onComplete(a,o))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&qw(e,"w")){const n=Ww(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();cq(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Gw(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Gw(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),_w(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{"ok"!==e.s&&this.log_("reportStats","Error sending stats: "+e.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Hw(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):oq("Unrecognized action received from server: "+Hw(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){_w(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=cW,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=cW,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=cW),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return dw(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+e.nextConnectionId_++,a=t.lastSessionId;let c=!1,l=null;const u=function(){l?l.close():(c=!0,s())};t.realtime_={close:u,sendRequest:function(e){_w(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};const h=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[e,n]=yield Promise.all([t.authTokenProvider_.getToken(h),t.appCheckTokenProvider_.getToken(h)]);c?iq("getToken() completed but was canceled"):(iq("getToken() completed. Creating connection."),t.authToken_=e&&e.accessToken,t.appCheckToken_=n&&n.token,l=new Uq(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,i,s,e=>{cq(e+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(n){t.log_("Failed to get token: "+n),c||(t.repoInfo_.nodeAdmin&&cq(n),u())}}})()}interrupt(e){iq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){iq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],jw(this.interruptReasons_)&&(this.reconnectDelay_=cW,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>gq(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Gq(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){iq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){iq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+WG.replace(/\./g,"-")]=1,Mw()?e["framework.cordova"]=1:Rw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Hq.getInstance().currentlyOnline();return jw(this.interruptReasons_)&&e}}return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e})();class hW{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new hW(e,t)}}class dW{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new hW(uq,e),r=new hW(uq,t);return 0!==this.compare(n,r)}minPost(){return hW.MIN}}class fW extends dW{static get __EMPTY_NODE(){return lW}static set __EMPTY_NODE(e){lW=e}compare(e,t){return dq(e.name,t.name)}isDefinedOn(e){throw Cw("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return hW.MIN}maxPost(){return new hW(hq,lW)}makePost(e,t){return _w("string"==typeof e,"KeyIndex indexValue must always be a string."),new hW(e,lW)}toString(){return".key"}}const pW=new fW;class gW{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let mW,yW=(()=>{class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??vW.EMPTY_NODE,this.right=s??vW.EMPTY_NODE}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return vW.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return vW.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})();class vW{constructor(e,t=vW.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new vW(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,yW.BLACK,null,null))}remove(e){return new vW(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,yW.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new gW(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new gW(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new gW(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new gW(this.root_,null,this.comparator_,!0,e)}}function _W(e,t){return dq(e.name,t.name)}function CW(e,t){return dq(e,t)}vW.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new yW(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const EW=function(e){return"number"==typeof e?"number:"+vq(e):"string:"+e},wW=function(e){if(e.isLeafNode()){const t=e.val();_w("string"==typeof t||"number"==typeof t||"object"==typeof t&&qw(t,".sv"),"Priority must be a string or number.")}else _w(e===mW||e.isEmpty(),"priority of unexpected type.");_w(e===mW||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let bW,SW,PW,OW=(()=>{class e{constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,_w(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),wW(this.priorityNode_)}static set __childrenNodeConstructor(e){bW=e}static get __childrenNodeConstructor(){return bW}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Xq(t)?this:".priority"===Wq(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const r=Wq(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(_w(".priority"!==r||1===jq(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(Zq(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+EW(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?vq(this.value_):this.value_,this.lazyHash_=eq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(_w(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return _w(i>=0,"Unknown leaf type: "+n),_w(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e})();const TW=new class extends dW{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?dq(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return hW.MIN}maxPost(){return new hW(hq,new OW("[PRIORITY-POST]",PW))}makePost(e,t){const n=SW(e);return new hW(t,new OW("[PRIORITY-POST]",n))}toString(){return".priority"}},IW=Math.log(2);class kW{constructor(e){this.count=parseInt(Math.log(e+1)/IW,10),this.current_=this.count-1;const t=(e=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&t}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const AW=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new yW(a,o.node,yW.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=i(t,c),u=i(c+1,r);return o=e[c],a=n?n(o):o,new yW(a,o.node,yW.BLACK,l,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const l=i(s+1,a),u=e[s],h=n?n(u):u;c(new yW(h,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,yW.BLACK):(a(r,yW.BLACK),a(r,yW.RED))}return s}(new kW(e.length));return new vW(r||t,s)};let NW;const MW={};class xW{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return _w(MW&&TW,"ChildrenNode.ts has not been loaded"),NW=NW||new xW({".priority":MW},{".priority":TW}),NW}get(e){const t=Ww(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof vW?t:null}hasIndex(e){return qw(this.indexSet_,e.toString())}addIndex(e,t){_w(e!==pW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(hW.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?AW(n,e.getCompare()):MW;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=s,new xW(l,c)}addToIndexes(e,t){const n=Zw(this.indexes_,(n,r)=>{const i=Ww(this.indexSet_,r);if(_w(i,"Missing index implementation for "+r),n===MW){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(hW.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),AW(n,i.getCompare())}return MW}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new hW(e.name,r))),i.insert(e,e.node)}});return new xW(n,this.indexSet_)}removeFromIndexes(e,t){const n=Zw(this.indexes_,n=>{if(n===MW)return n;{const r=t.get(e.name);return r?n.remove(new hW(e.name,r)):n}});return new xW(n,this.indexSet_)}}let RW,DW=(()=>{class e{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&wW(this.priorityNode_),this.children_.isEmpty()&&_w(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return RW||(RW=new e(new vW(CW),null,xW.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||RW}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?RW:t}}getChild(e){const t=Wq(e);return null===t?this:this.getImmediateChild(t).getChild(Zq(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(_w(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const r=new hW(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?RW:this.priorityNode_;return new e(i,o,s)}}updateChild(e,t){const n=Wq(e);if(null===n)return t;{_w(".priority"!==Wq(e)||1===jq(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Zq(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(TW,(o,a)=>{n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){const e=[];for(const t in n)e[t]=n[t];return e}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+EW(this.getPriority().val())+":"),this.forEachChild(TW,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":eq(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new hW(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new hW(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new hW(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,hW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,hW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===LW?-1:0}withIndex(t){if(t===pW||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===pW||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(TW),n=t.getIterator(TW);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===pW?null:this.indexMap_.get(e.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})();const LW=new class extends DW{constructor(){super(new vW(CW),DW.EMPTY_NODE,xW.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return DW.EMPTY_NODE}isEmpty(){return!1}};function FW(e,t=null){if(null===e)return DW.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),_w(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new OW(e,FW(t));if(e instanceof Array){let n=DW.EMPTY_NODE;return yq(e,(t,r)=>{if(qw(e,t)&&"."!==t.substring(0,1)){const e=FW(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(FW(t))}{const n=[];let r=!1;if(yq(e,(e,t)=>{if("."!==e.substring(0,1)){const i=FW(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new hW(e,i)))}}),0===n.length)return DW.EMPTY_NODE;const i=AW(n,_W,e=>e.name,CW);if(r){const e=AW(n,TW.getCompare());return new DW(i,FW(t),new xW({".priority":e},{".priority":TW}))}return new DW(i,FW(t),xW.Default)}}Object.defineProperties(hW,{MIN:{value:new hW(uq,DW.EMPTY_NODE)},MAX:{value:new hW(hq,LW)}}),fW.__EMPTY_NODE=DW.EMPTY_NODE,OW.__childrenNodeConstructor=DW,function(e){mW=e}(LW),function(e){PW=e}(LW),function(e){SW=e}(FW);class BW extends dW{constructor(e){super(),this.indexPath_=e,_w(!Xq(e)&&".priority"!==Wq(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?dq(e.name,t.name):i}makePost(e,t){const n=FW(e),r=DW.EMPTY_NODE.updateChild(this.indexPath_,n);return new hW(t,r)}maxPost(){const e=DW.EMPTY_NODE.updateChild(this.indexPath_,LW);return new hW(hq,e)}toString(){return Kq(this.indexPath_,0).join("/")}}const VW=new class extends dW{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?dq(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return hW.MIN}maxPost(){return hW.MAX}makePost(e,t){const n=FW(e);return new hW(t,n)}toString(){return".value"}};function UW(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class $W{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=TW}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return _w(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _w(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:uq}hasEnd(){return this.endSet_}getIndexEndValue(){return _w(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _w(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:hq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return _w(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===TW}copy(){const e=new $W;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zW(e){const t={};if(e.isDefault())return t;let n;return e.index_===TW?n="$priority":e.index_===VW?n="$value":e.index_===pW?n="$key":(_w(e.index_ instanceof BW,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Hw(n),e.startSet_&&(t.startAt=Hw(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Hw(e.indexStartName_))),e.endSet_&&(t.endAt=Hw(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Hw(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function HW(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==TW&&(t.i=e.index_.toString()),t}class GW extends $q{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=sq("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(_w(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=GW.getListenId_(e,n),o={};this.listens_[s]=o;const a=zW(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),Ww(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=GW.getListenId_(e,t);delete this.listens_[n]}get(e){const t=zW(e._queryParams),n=e._path.toString(),r=new kw;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Jw(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=zw(o.responseText)}catch{cq("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&cq("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class qW{constructor(){this.rootNode_=DW.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function WW(){return{value:null,children:new Map}}function jW(e,t,n){if(Xq(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=Wq(t);e.children.has(r)||e.children.set(r,WW()),jW(e.children.get(r),t=Zq(t),n)}}function ZW(e,t){if(Xq(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(TW,(t,n)=>{jW(e,new Gq(t),n)}),ZW(e,t)}}if(e.children.size>0){const n=Wq(t);return t=Zq(t),e.children.has(n)&&ZW(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function YW(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{YW(r,new Gq(t.toString()+"/"+e),n)})}class KW{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&yq(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class JW{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new KW(e);const n=1e4+2e4*Math.random();wq(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;yq(e,(e,r)=>{r>0&&qw(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),wq(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var QW=(()=>(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(QW||(QW={})),QW))();function XW(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class ej{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=QW.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Xq(this.path)){if(null!=this.affectedTree.value)return _w(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Gq(e));return new ej(qq(),t,this.revert)}}return _w(Wq(this.path)===e,"operationForChild called for unrelated child."),new ej(Zq(this.path),this.affectedTree,this.revert)}}class tj{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=QW.OVERWRITE}operationForChild(e){return Xq(this.path)?new tj(this.source,qq(),this.snap.getImmediateChild(e)):new tj(this.source,Zq(this.path),this.snap)}}class nj{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=QW.MERGE}operationForChild(e){if(Xq(this.path)){const t=this.children.subtree(new Gq(e));return t.isEmpty()?null:t.value?new tj(this.source,qq(),t.value):new nj(this.source,qq(),t)}return _w(Wq(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new nj(this.source,Zq(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class rj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Xq(e))return this.isFullyInitialized()&&!this.filtered_;const t=Wq(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function ij(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Cw("Should only compare child_ events.");const r=new hW(t.childName,t.snapshotNode),i=new hW(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function sj(e,t){return{eventCache:e,serverCache:t}}function oj(e,t,n,r){return sj(new rj(t,n,r),e.serverCache)}function aj(e,t,n,r){return sj(e.eventCache,new rj(t,n,r))}function cj(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function lj(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let uj;class hj{constructor(e,t=(()=>(uj||(uj=new vW(fq)),uj))()){this.value=e,this.children=t}static fromObject(e){let t=new hj(null);return yq(e,(e,n)=>{t=t.set(new Gq(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:qq(),value:this.value};if(Xq(e))return null;{const n=Wq(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Zq(e),t);return null!=i?{path:Qq(new Gq(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Xq(e))return this;{const t=Wq(e),n=this.children.get(t);return null!==n?n.subtree(Zq(e)):new hj(null)}}set(e,t){if(Xq(e))return new hj(t,this.children);{const n=Wq(e),r=(this.children.get(n)||new hj(null)).set(Zq(e),t),i=this.children.insert(n,r);return new hj(this.value,i)}}remove(e){if(Xq(e))return this.children.isEmpty()?new hj(null):new hj(null,this.children);{const t=Wq(e),n=this.children.get(t);if(n){const r=n.remove(Zq(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new hj(null):new hj(this.value,i)}return this}}get(e){if(Xq(e))return this.value;{const t=Wq(e),n=this.children.get(t);return n?n.get(Zq(e)):null}}setTree(e,t){if(Xq(e))return t;{const n=Wq(e),r=(this.children.get(n)||new hj(null)).setTree(Zq(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new hj(this.value,i)}}fold(e){return this.fold_(qq(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(Qq(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,qq(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Xq(e))return null;{const r=Wq(e),i=this.children.get(r);return i?i.findOnPath_(Zq(e),Qq(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,qq(),t)}foreachOnPath_(e,t,n){if(Xq(e))return this;{this.value&&n(t,this.value);const r=Wq(e),i=this.children.get(r);return i?i.foreachOnPath_(Zq(e),Qq(t,r),n):new hj(null)}}foreach(e){this.foreach_(qq(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(Qq(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class dj{constructor(e){this.writeTree_=e}static empty(){return new dj(new hj(null))}}function fj(e,t,n){if(Xq(t))return new dj(new hj(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=eW(i,t);return s=s.updateChild(o,n),new dj(e.writeTree_.set(i,s))}{const r=new hj(n),i=e.writeTree_.setTree(t,r);return new dj(i)}}}function pj(e,t,n){let r=e;return yq(n,(e,n)=>{r=fj(r,Qq(t,e),n)}),r}function gj(e,t){if(Xq(t))return dj.empty();{const n=e.writeTree_.setTree(t,new hj(null));return new dj(n)}}function mj(e,t){return null!=yj(e,t)}function yj(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eW(n.path,t)):null}function vj(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(TW,(e,n)=>{t.push(new hW(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new hW(e,n.value))}),t}function _j(e,t){if(Xq(t))return e;{const n=yj(e,t);return new dj(null!=n?new hj(n):e.writeTree_.subtree(t))}}function Cj(e){return e.writeTree_.isEmpty()}function Ej(e,t){return wj(qq(),e.writeTree_,t)}function wj(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(_w(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=wj(Qq(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(Qq(e,".priority"),r)),n}}function bj(e,t){return Rj(t,e)}function Sj(e,t){if(e.snap)return rW(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&rW(Qq(e.path,n),t))return!0;return!1}function Pj(e){return e.visible}function Oj(e,t,n){let r=dj.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)rW(n,e)?(t=eW(n,e),r=fj(r,t,s.snap)):rW(e,n)&&(t=eW(e,n),r=fj(r,qq(),s.snap.getChild(t)));else{if(!s.children)throw Cw("WriteRecord should have .snap or .children");if(rW(n,e))t=eW(n,e),r=pj(r,t,s.children);else if(rW(e,n))if(t=eW(e,n),Xq(t))r=pj(r,qq(),s.children);else{const e=Ww(s.children,Wq(t));if(e){const n=e.getChild(Zq(t));r=fj(r,qq(),n)}}}}}return r}function Tj(e,t,n,r,i){if(r||i){const s=_j(e.visibleWrites,t);return!i&&Cj(s)?n:i||null!=n||mj(s,qq())?Ej(Oj(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(rW(e.path,t)||rW(t,e.path))},t),n||DW.EMPTY_NODE):null}{const r=yj(e.visibleWrites,t);if(null!=r)return r;{const r=_j(e.visibleWrites,t);return Cj(r)?n:null!=n||mj(r,qq())?Ej(r,n||DW.EMPTY_NODE):null}}}function Ij(e,t,n,r){return Tj(e.writeTree,e.treePath,t,n,r)}function kj(e,t){return function(e,t,n){let r=DW.EMPTY_NODE;const i=yj(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(TW,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=_j(e.visibleWrites,t);return n.forEachChild(TW,(e,t)=>{const n=Ej(_j(i,new Gq(e)),t);r=r.updateImmediateChild(e,n)}),vj(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return vj(_j(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Aj(e,t,n,r){return function(e,t,n,r,i){_w(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Qq(t,n);if(mj(e.visibleWrites,s))return null;{const t=_j(e.visibleWrites,s);return Cj(t)?i.getChild(n):Ej(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Nj(e,t){return function(e,t){return yj(e.visibleWrites,t)}(e.writeTree,Qq(e.treePath,t))}function Mj(e,t,n){return function(e,t,n,r){const i=Qq(t,n),s=yj(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?Ej(_j(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function xj(e,t){return Rj(Qq(e.treePath,t),e.writeTree)}function Rj(e,t){return{treePath:e,writeTree:t}}class Dj{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;_w("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),_w(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,UW(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Cw("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,UW(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Lj=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Fj{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new rj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Mj(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:lj(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const c=_j(e.visibleWrites,t),l=yj(c,qq());if(null!=l)a=l;else{if(null==n)return[];a=Ej(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function Bj(e,t,n,r,i,s){const o=t.eventCache;if(null!=Nj(r,n))return t;{let a,c;if(Xq(n))if(_w(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=lj(t),i=kj(r,n instanceof DW?n:DW.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Ij(r,lj(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const l=Wq(n);if(".priority"===l){_w(1===jq(n),"Can't have a priority with additional path components");const i=o.getNode();c=t.serverCache.getNode();const s=Aj(r,n,i,c);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=Zq(n);let h;if(o.isCompleteForChild(l)){c=t.serverCache.getNode();const e=Aj(r,n,o.getNode(),c);h=null!=e?o.getNode().getImmediateChild(l).updateChild(u,e):o.getNode().getImmediateChild(l)}else h=Mj(r,l,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),l,h,u,i,s):o.getNode()}}return oj(t,a,o.isFullyInitialized()||Xq(n),e.filter.filtersNodes())}}function Vj(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(Xq(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=Wq(n);if(!c.isCompleteForPath(n)&&jq(n)>1)return t;const i=Zq(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,Lj,null)}const h=aj(t,l,c.isFullyInitialized()||Xq(n),u.filtersNodes());return Bj(e,h,n,i,new Fj(i,h,s),a)}function Uj(e,t,n,r,i,s,o){const a=t.eventCache;let c,l;const u=new Fj(i,t,s);if(Xq(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=oj(t,l,!0,e.filter.filtersNodes());else{const i=Wq(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=oj(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=Zq(n),l=a.getNode().getImmediateChild(i);let h;if(Xq(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===Yq(s)&&e.getChild(Jq(s)).isEmpty()?e:e.updateChild(s,r):DW.EMPTY_NODE}c=l.equals(h)?t:oj(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function $j(e,t){return e.eventCache.isCompleteForChild(t)}function zj(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function Hj(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Xq(n)?r:new hj(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const c=zj(0,t.serverCache.getNode().getImmediateChild(n),r);l=Vj(e,l,new Gq(n),c,i,s,o,a)}}),c.children.inorderTraversal((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!c){const c=zj(0,t.serverCache.getNode().getImmediateChild(n),r);l=Vj(e,l,new Gq(n),c,i,s,o,a)}}),l}function Gj(e,t){const n=lj(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Xq(t)&&!n.getImmediateChild(Wq(t)).isEmpty())?n.getChild(t):null}function qj(e,t,n,r){t.type===QW.MERGE&&null!==t.source.queryId&&(_w(lj(e.viewCache_),"We should always have a full cache before handling merges"),_w(cj(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new Dj;let o,a;if(n.type===QW.OVERWRITE){const c=n;c.source.fromUser?o=Uj(e,t,c.path,c.snap,r,i,s):(_w(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!Xq(c.path),o=Vj(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===QW.MERGE){const c=n;c.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,c)=>{const l=Qq(n,r);$j(t,Wq(l))&&(a=Uj(e,a,l,c,i,s,o))}),r.foreach((r,c)=>{const l=Qq(n,r);$j(t,Wq(l))||(a=Uj(e,a,l,c,i,s,o))}),a}(e,t,c.path,c.children,r,i,s):(_w(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=Hj(e,t,c.path,c.children,r,i,a,s))}else if(n.type===QW.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=Nj(r,n))return t;{const a=new Fj(r,t,i),c=t.eventCache.getNode();let l;if(Xq(n)||".priority"===Wq(n)){let n;if(t.serverCache.isFullyInitialized())n=Ij(r,lj(t));else{const e=t.serverCache.getNode();_w(e instanceof DW,"serverChildren would be complete if leaf node"),n=kj(r,e)}n=n,l=e.filter.updateFullNode(c,n,s)}else{const i=Wq(n);let u=Mj(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=null!=u?e.filter.updateChild(c,i,u,Zq(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,DW.EMPTY_NODE,Zq(n),a,s):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Ij(r,lj(t)),o.isLeafNode()&&(l=e.filter.updateFullNode(l,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=Nj(r,qq()),oj(t,l,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=Nj(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(Xq(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Vj(e,t,n,c.getNode().getChild(n),i,s,a,o);if(Xq(n)){let r=new hj(null);return c.getNode().forEachChild(pW,(e,t)=>{r=r.set(new Gq(e),t)}),Hj(e,t,n,r,i,s,a,o)}return t}{let l=new hj(null);return r.foreach((e,t)=>{const r=Qq(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))}),Hj(e,t,n,l,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==QW.LISTEN_COMPLETE)throw Cw("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache;return Bj(e,aj(t,s.getNode(),s.isFullyInitialized()||Xq(n),s.isFiltered()),n,r,Lj,i)}(e,t,n.path,r,s)}const c=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=cj(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(cj(t)))}}(t,o,c),{viewCache:o,changes:c}}(e.processor_,i,t,n,r);return function(e,t){_w(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),_w(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,s.viewCache),_w(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,function(e,t,n,r){return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),ij(e,i,"child_removed",t,r,n),ij(e,i,"child_added",t,r,n),ij(e,i,"child_moved",s,r,n),ij(e,i,"child_changed",t,r,n),ij(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r?[r]:e.eventRegistrations_)}(e,s.changes,s.viewCache.eventCache.getNode(),null)}let Wj,jj;function Zj(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return _w(null!=s,"SyncTree gave us an op for an invalid query."),qj(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(qj(s,t,n,r));return i}}function Yj(e,t){let n=null;for(const r of e.views.values())n=n||Gj(r,t);return n}class Kj{constructor(e){this.listenProvider_=e,this.syncPointTree_=new hj(null),this.pendingWriteTree_={visibleWrites:dj.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Jj(e,t,n,r,i){return function(e,t,n,r,i){_w(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=fj(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?tZ(e,new tj({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Qj(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);_w(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&Sj(t,r.path)?i=!1:rW(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(function(e){e.visibleWrites=Oj(e.allWrites,Pj,qq()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=gj(e.visibleWrites,r.path):yq(r.children,t=>{e.visibleWrites=gj(e.visibleWrites,Qq(r.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new hj(null);return null!=r.snap?t=t.set(qq(),!0):yq(r.children,e=>{t=t.set(new Gq(e),!0)}),tZ(e,new ej(r.path,t,n))}return[]}function Xj(e,t,n){return tZ(e,new tj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function eZ(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=Yj(n,eW(e,t));if(r)return r});return Tj(r,t,i,n,!0)}function tZ(e,t){return nZ(t,e.syncPointTree_,null,bj(e.pendingWriteTree_,qq()))}function nZ(e,t,n,r){if(Xq(e.path))return rZ(e,t,n,r);{const i=t.get(qq());null==n&&null!=i&&(n=Yj(i,qq()));let s=[];const o=Wq(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=xj(r,o);s=s.concat(nZ(a,c,e,t))}return i&&(s=s.concat(Zj(i,e,r,n))),s}}function rZ(e,t,n,r){const i=t.get(qq());null==n&&null!=i&&(n=Yj(i,qq()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=xj(r,t),c=e.operationForChild(t);c&&(s=s.concat(rZ(c,i,o,a)))}),i&&(s=s.concat(Zj(i,e,r,n))),s}function iZ(e,t){return e.tagToQueryMap.get(t)}function sZ(e){const t=e.indexOf("$");return _w(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Gq(e.substr(0,t))}}function oZ(e,t,n){const r=e.syncPointTree_.get(t);return _w(r,"Missing sync point for query tag that we're tracking"),Zj(r,n,bj(e.pendingWriteTree_,t),null)}class aZ{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new aZ(t)}node(){return this.node_}}class cZ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Qq(this.path_,e);return new cZ(this.syncTree_,t)}node(){return eZ(this.syncTree_,this.path_)}}const lZ=function(e,t,n){return e&&"object"==typeof e?(_w(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?uZ(e[".sv"],t,n):"object"==typeof e[".sv"]?hZ(e[".sv"],t):void _w(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},uZ=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:_w(!1,"Unexpected server value: "+e)}},hZ=function(e,t,n){e.hasOwnProperty("increment")||_w(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&_w(!1,"Unexpected increment value: "+r);const i=t.node();if(_w(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},dZ=function(e,t,n){return fZ(e,new aZ(t),n)};function fZ(e,t,n){const r=e.getPriority().val(),i=lZ(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=lZ(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new OW(s,FW(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new OW(i))),r.forEachChild(TW,(e,r)=>{const i=fZ(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class pZ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function gZ(e,t){let n=t instanceof Gq?t:new Gq(t),r=e,i=Wq(n);for(;null!==i;){const e=Ww(r.node.children,i)||{children:{},childCount:0};r=new pZ(i,r,e),n=Zq(n),i=Wq(n)}return r}function mZ(e){return e.node.value}function yZ(e,t){e.node.value=t,wZ(e)}function vZ(e){return e.node.childCount>0}function _Z(e,t){yq(e.node.children,(n,r)=>{t(new pZ(n,e,r))})}function CZ(e,t,n,r){n&&!r&&t(e),_Z(e,e=>{CZ(e,t,!0,r)}),n&&r&&t(e)}function EZ(e){return new Gq(null===e.parent?e.name:EZ(e.parent)+"/"+e.name)}function wZ(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===mZ(e)&&!vZ(e)}(n),i=qw(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,wZ(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,wZ(e))}(e.parent,e.name,e)}const bZ=/[\[\].#$\/\u0000-\u001F\u007F]/,SZ=/[\[\].#$\u0000-\u001F\u007F]/,PZ=10485760,OZ=function(e){return"string"==typeof e&&0!==e.length&&!bZ.test(e)},TZ=function(e){return"string"==typeof e&&0!==e.length&&!SZ.test(e)},IZ=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!lq(e)||e&&"object"==typeof e&&qw(e,".sv")},kZ=function(e,t,n,r){r&&void 0===t||AZ(rb(e,"value"),t,n)},AZ=function(e,t,n){const r=n instanceof Gq?new iW(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+oW(r));if("function"==typeof t)throw new Error(e+"contains a function "+oW(r)+" with contents = "+t.toString());if(lq(t))throw new Error(e+"contains "+t.toString()+" "+oW(r));if("string"==typeof t&&t.length>PZ/3&&ib(t)>PZ)throw new Error(e+"contains a string greater than "+PZ+" utf8 bytes "+oW(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(yq(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!OZ(t)))throw new Error(e+" contains an invalid key ("+t+") "+oW(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=ib(t),sW(e)})(r,t),AZ(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=ib(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+oW(r)+" in addition to actual children.")}},NZ=function(e,t,n,r){if(!(r&&void 0===n||TZ(n)))throw new Error(rb(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},MZ=function(e,t){if(".info"===Wq(t))throw new Error(e+" failed = Can't modify data under /.info/")};class xZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function RZ(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null!==n&&!nW(s,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function DZ(e,t,n){RZ(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(LZ(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>rW(e,t)||rW(t,e))}function LZ(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();nq&&iq("event: "+n.toString()),Eq(r)}}}class FZ{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=WW(),this.transactionQueueTree_=new pZ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function BZ(e){const t=e.infoData_.getNode(new Gq(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function VZ(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:BZ(e)})}function UZ(e,t,n,r,i){e.dataUpdateCount++;const s=new Gq(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=Zw(n,e=>FW(e));o=function(e,t,n,r){const i=iZ(e,r);if(i){const r=sZ(i),s=r.path,o=r.queryId,a=eW(s,t),c=hj.fromObject(n);return oZ(e,s,new nj(XW(o),a,c))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=FW(n);o=function(e,t,n,r){const i=iZ(e,r);if(null!=i){const r=sZ(i),s=r.path,o=r.queryId,a=eW(s,t);return oZ(e,s,new tj(XW(o),a,n))}return[]}(e.serverSyncTree_,s,t,i)}else if(r){const t=Zw(n,e=>FW(e));o=function(e,t,n){const r=hj.fromObject(n);return tZ(e,new nj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=FW(n);o=Xj(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=KZ(e,s)),DZ(e.eventQueue_,a,o)}function $Z(e,t){zZ(e,"connected",t),!1===t&&function(e){WZ(e,"onDisconnectEvents");const t=VZ(e),n=WW();YW(e.onDisconnect_,qq(),(r,i)=>{const s=function(e,t,n,r){return fZ(t,new cZ(n,e),r)}(r,i,e.serverSyncTree_,t);jW(n,r,s)});let r=[];YW(n,qq(),(t,n)=>{r=r.concat(Xj(e.serverSyncTree_,t,n));const i=tY(e,t);KZ(e,i)}),e.onDisconnect_=WW(),DZ(e.eventQueue_,qq(),r)}(e)}function zZ(e,t,n){const r=new Gq("/.info/"+t),i=FW(n);e.infoData_.updateSnapshot(r,i);const s=Xj(e.infoSyncTree_,r,i);DZ(e.eventQueue_,r,s)}function HZ(e){return e.nextWriteId_++}function GZ(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&ZW(e.onDisconnect_,t),jZ(0,n,r,i)})}function qZ(e,t,n,r){const i=FW(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&jW(e.onDisconnect_,t,i),jZ(0,r,n,s)})}function WZ(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),iq(n,...t)}function jZ(e,t,n,r){t&&Eq(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function ZZ(e,t,n){return eZ(e.serverSyncTree_,t,n)||DW.EMPTY_NODE}function YZ(e,t=e.transactionQueueTree_){if(t||eY(e,t),mZ(t)){const n=QZ(e,t);_w(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=ZZ(e,t,r);let s=i;const o=i.hash();for(let l=0;l<n.length;l++){const e=n[l];_w(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=eW(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),c=t;e.server_.put(c.toString(),a,r=>{WZ(e,"transaction put response",{path:c.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Qj(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();eY(e,gZ(e.transactionQueueTree_,t)),YZ(e,e.transactionQueueTree_),DZ(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Eq(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)n[e].status=3===n[e].status?4:0;else{cq("transaction at "+c.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}KZ(e,t)}},o)}(e,EZ(t),n)}else vZ(t)&&_Z(t,t=>{YZ(e,t)})}function KZ(e,t){const n=JZ(e,t),r=EZ(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],c=eW(n,a.path);let l,u=!1;if(_w(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,l=a.abortReason,i=i.concat(Qj(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,l="maxretry",i=i.concat(Qj(e.serverSyncTree_,a.currentWriteId,!0));else{const n=ZZ(e,a.path,s);a.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){AZ("transaction failed: Data returned ",r,a.path);let t=FW(r);"object"==typeof r&&null!=r&&qw(r,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,c=VZ(e),l=dZ(t,n,c);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=HZ(e),s.splice(s.indexOf(o),1),i=i.concat(Jj(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally)),i=i.concat(Qj(e.serverSyncTree_,o,!0))}else u=!0,l="nodata",i=i.concat(Qj(e.serverSyncTree_,a.currentWriteId,!0))}DZ(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===l?()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot):()=>t[o].onComplete(new Error(l),!1,null)))}eY(e,e.transactionQueueTree_);for(let o=0;o<r.length;o++)Eq(r[o]);YZ(e,e.transactionQueueTree_)}(e,QZ(e,n),r),r}function JZ(e,t){let n,r=e.transactionQueueTree_;for(n=Wq(t);null!==n&&void 0===mZ(r);)r=gZ(r,n),n=Wq(t=Zq(t));return r}function QZ(e,t){const n=[];return XZ(e,t,n),n.sort((e,t)=>e.order-t.order),n}function XZ(e,t,n){const r=mZ(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);_Z(t,t=>{XZ(e,t,n)})}function eY(e,t){const n=mZ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,yZ(t,n.length>0?n:void 0)}_Z(t,t=>{eY(e,t)})}function tY(e,t){const n=EZ(JZ(e,t)),r=gZ(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{nY(e,t)}),nY(e,r),CZ(r,t=>{nY(e,t)}),n}function nY(e,t){const n=mZ(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(_w(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(_w(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(Qj(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?yZ(t,void 0):n.length=s+1,DZ(e.eventQueue_,EZ(t),i);for(let e=0;e<r.length;e++)Eq(r[e])}}const rY=function(e,t){const n=iY(e),r=n.namespace;return"firebase.com"===n.domain&&aq(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&aq("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&cq("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Iq(n.host,n.secure,r,t,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new Gq(n.pathString)}},iY=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch{}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):cq(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class sY{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new kw;return GZ(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){MZ("OnDisconnect.remove",this._path);const e=new kw;return qZ(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){MZ("OnDisconnect.set",this._path),kZ("OnDisconnect.set",e,this._path,!1);const t=new kw;return qZ(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){MZ("OnDisconnect.setWithPriority",this._path),kZ("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(lq(t))throw new Error(rb(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!IZ(t))throw new Error(rb(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new kw;return function(e,t,n,r,i){const s=FW(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&jW(e.onDisconnect_,t,s),jZ(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){MZ("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=rb(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];yq(t,(e,t)=>{const r=new Gq(e);if(AZ(i,t,Qq(n,r)),".priority"===Yq(r)&&!IZ(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=Kq(r);for(let t=0;t<i.length;t++)if((".priority"!==i[t]||t!==i.length-1)&&!OZ(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(tW);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&rW(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new kw;return function(e,t,n,r){if(jw(n))return iq("onDisconnect().update() called with empty data.  Don't do anything."),void jZ(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&yq(n,(n,r)=>{const i=FW(r);jW(e.onDisconnect_,Qq(t,n),i)}),jZ(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class oY{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Xq(this._path)?null:Yq(this._path)}get ref(){return new aY(this._repo,this._path)}get _queryIdentifier(){const e=HW(this._queryParams),t=gq(e);return"{}"===t?"default":t}get _queryObject(){return HW(this._queryParams)}isEqual(e){if(!((e=ob(e))instanceof oY))return!1;const t=this._repo===e._repo,n=nW(this._path,e._path);return t&&n&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class aY extends oY{constructor(e,t){super(e,t,new $W,!1)}get parent(){const e=Jq(this._path);return null===e?null:new aY(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function cY(e,t){return(e=ob(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===Wq((e=ob(e))._path)?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),NZ(e,t,n,r)}("child","path",t,!1):NZ("child","path",t,!1),new aY(e._repo,Qq(e._path,t))}(e._root,t):e._root}function lY(e){return e=ob(e),new sY(e._repo,e._path)}function uY(e,t){e=ob(e),MZ("set",e._path),kZ("set",t,e._path,!1);const n=new kw;return function(e,t,n,r,i){WZ(e,"set",{path:t.toString(),value:n,priority:r});const s=VZ(e),o=FW(n,r),a=eZ(e.serverSyncTree_,t),c=dZ(o,a,s),l=HZ(e),u=Jj(e.serverSyncTree_,t,c,l,!0);RZ(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||cq("set at "+t+" failed: "+n);const o=Qj(e.serverSyncTree_,l,!s);DZ(e.eventQueue_,t,o),jZ(0,i,n,r)});const h=tY(e,t);KZ(e,h),DZ(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}(function(e){_w(!Wj,"__referenceConstructor has already been defined"),Wj=e})(aY),function(e){_w(!jj,"__referenceConstructor has already been defined"),jj=e}(aY);const hY={};function dY(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||aq("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),iq("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=rY(s,i),l=c.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=rY(s,i),l=c.repoInfo):o=!c.repoInfo.secure;const u=i&&o?new Pq(Pq.OWNER):new Sq(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!OZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),TZ(e)}(n))throw new Error(rb(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),Xq(c.path)||aq("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=hY[t.name];i||(i={},hY[t.name]=i);let s=i[e.toURLString()];return s&&aq("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new FZ(e,false,n,r),i[e.toURLString()]=s,s}(l,e,u,new bq(e.name,n));return new fY(h,e)}class fY{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=xq(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new GW(e.repoInfo_,(t,n,r,i)=>{UZ(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>$Z(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Hw(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new uW(e.repoInfo_,t,(t,n,r,i)=>{UZ(e,t,n,r,i)},t=>{$Z(e,t)},t=>{!function(e,t){yq(t,(t,n)=>{zZ(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return Mq[n]||(Mq[n]=t()),Mq[n]}(e.repoInfo_,()=>new JW(e.stats_,e.server_)),e.infoData_=new qW,e.infoSyncTree_=new Kj({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Xj(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),zZ(e,"connected",!1),e.serverSyncTree_=new Kj({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);DZ(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new aY(this._repo,qq())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=hY[t];(!n||n[e.key]!==e)&&aq(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&aq("Cannot call "+e+" on a deleted database.")}}function pY(e=Mb(),t){return Tb(e,"database").getImmediate({identifier:t})}function gY(e,t,n,r={}){(e=ob(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&aq("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&aq('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Pq(Pq.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Aw(r.mockUserToken,e.app.options.projectId);s=new Pq(t)}!function(e,t,n,r){e.repoInfo_=new Iq(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}const mY={".sv":"timestamp"};function yY(){return mY}uW.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},uW.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},WG="9.6.6",Ob(new ab("database",(e,{instanceIdentifier:t})=>dY(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Rb(qG,"0.12.5",void 0),Rb(qG,"0.12.5","esm2017");class vY{constructor(e){return e}}const _Y=new or("angularfire2.database-instances");function CY(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new vY(r)}}const EY={provide:class{constructor(){return fT("database")}},deps:[[new Mr,_Y]]},wY={provide:vY,useFactory:function(e,t){const n=dT("database",e,t);return n&&new vY(n)},deps:[[new Mr,_Y],ST]};let bY=(()=>{class e{constructor(){Rb("angularfire",cT.full,"rtdb")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[wY,EY]}),e})();const SY=bT(gY,!0),PY=bT(pY,!0),OY=bT(lY,!0),TY=bT(cY,!0),IY=bT(uY,!0);class kY{constructor(e){this.db=e}setOffline(e){return IY(TY(this.db,"/status/"+e),kY.OFFLINE)}launchAutomaticPresenceUpdate(e){var t=this;return dw(function*(){const n=TY(t.db,"/status/"+e);yield IY(n,kY.ONLINE),yield OY(n).set(kY.OFFLINE)})()}}kY.OFFLINE={state:"offline",last_changed:yY()},kY.ONLINE={state:"online",last_changed:yY()},kY.\u0275fac=function(e){return new(e||kY)(Or(vY))},kY.\u0275prov=be({token:kY,factory:kY.\u0275fac,providedIn:"root"});class AY{static createUserWithEmailAndPassword(e,t,n){return UN(e,t,n)}static sendEmailVerification(e){return HN(e)}static sendPasswordResetEmail(e,t){return GN(e,t)}static signInWithEmailAndPassword(e,t,n){return dw(function*(){return(yield qN(e,t,n)).user})()}static signInWithPopup(e,t){return dw(function*(){return(yield WN(e,t)).user})()}static updateProfile(e,t){return jN(e,t)}}class NY{constructor(e,t,n){this.email=e,this.username=t,this.verified=n}isConnected(){return this.email.isPresent()}}NY.NOT_CONNECTED=new NY(vw.empty(),vw.empty(),!1);let MY=(()=>{class e{constructor(t,n,r){var i=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=vw.empty(),this.uid=vw.empty(),this.userUnsubscribe=vw.empty(),pw(e.VERBOSE,"AuthenticationService constructor"),this.userRS=new GG(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=zN(this.auth,function(){var t=dw(function*(t){null==t?(pw(e.VERBOSE,"User is not connected"),i.userUnsubscribe.isPresent()&&i.userUnsubscribe.get()(),i.userRS.next(NY.NOT_CONNECTED),i.user=vw.empty(),i.uid=vw.empty()):(MG(i.uid.isAbsent(),"AuthenticationService received a double update for an user, this is unexpected"),i.uid=vw.of(t.uid),yield i.connectivityDAO.launchAutomaticPresenceUpdate(t.uid),i.userUnsubscribe=vw.of(i.userDAO.subscribeToChanges(t.uid,n=>{if(n.isPresent()){const r=n.get().username;pw(e.VERBOSE,`User ${r} is connected, and the verified status is ${i.emailVerified(t)}`);const s=!0===i.emailVerified(t)&&null!=r;if(!0===s&&!1===n.get().verified)return i.userDAO.markVerified(t.uid);const o=new NY(vw.ofNullable(t.email),vw.ofNullable(r),s);i.user=vw.of(o),i.userRS.next(o)}})))});return function(e){return t.apply(this,arguments)}}())}emailVerified(e){return e.emailVerified}sendPasswordResetEmail(e){var t=this;return dw(function*(){try{return yield AY.sendPasswordResetEmail(t.auth,e),kG.SUCCESS}catch(n){return kG.failure(t.mapFirebaseError(n))}})()}doRegister(t,n,r){var i=this;return dw(function*(){return pw(e.VERBOSE,"AuthenticationService.doRegister("+n+")"),(yield i.userDAO.usernameIsAvailable(t))?i.registerAfterUsernameCheck(t,n,r):OG.failure($localize`This username is already in use.`)})()}registerAfterUsernameCheck(e,t,n){var r=this;return dw(function*(){try{const i=yield AY.createUserWithEmailAndPassword(r.auth,t,n),s=fw.getNonNullable(i.user);return yield r.createUser(s.uid,e),OG.success(s)}catch(i){return OG.failure(r.mapFirebaseError(i))}})()}mapFirebaseError(e){switch(e.code){case"auth/email-already-in-use":return $localize`This email address is already in use.`;case"auth/invalid-email":return $localize`This email address is invalid.`;case"auth/user-not-found":case"auth/wrong-password":return $localize`You have entered invalid credentials.`;case"auth/invalid-credential":return $localize`The credential is invalid or has expired, please try again.`;case"auth/weak-password":return $localize`Your password is too weak, please use a stronger password.`;case"auth/too-many-requests":return $localize`There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later.`;case"auth/popup-closed-by-user":return $localize`You closed the authentication popup without finalizing your log in.`;default:return NG.logError("AuthenticationService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}sendEmailVerification(){var t=this;return dw(function*(){pw(e.VERBOSE,"AuthenticationService.sendEmailVerification()");const n=vw.ofNullable(t.auth.currentUser);if(!n.isPresent())return NG.logError("AuthenticationService","Unlogged users cannot request for email verification");if(t.emailVerified(n.get()))return NG.logError("AuthenticationService","Verified users should not ask email verification after being verified");try{return yield AY.sendEmailVerification(n.get()),kG.SUCCESS}catch(r){return kG.failure(t.mapFirebaseError(r))}})()}doEmailLogin(t,n){var r=this;return dw(function*(){pw(e.VERBOSE,"AuthenticationService.doEmailLogin("+t+")");try{return yield AY.signInWithEmailAndPassword(r.auth,t,n),kG.SUCCESS}catch(i){return kG.failure(r.mapFirebaseError(i))}})()}createUser(e,t){var n=this;return dw(function*(){null==t?yield n.userDAO.set(e,{verified:!1}):yield n.userDAO.set(e,{username:t,verified:!1})})()}doGoogleLogin(){var e=this;return dw(function*(){return kG.ofFallible(yield e.registerOrLoginWithGoogle())})()}registerOrLoginWithGoogle(){var e=this;return dw(function*(){try{const t=new Zk;t.addScope("profile"),t.addScope("email");const n=yield AY.signInWithPopup(e.auth,t);return!1===(yield e.userDAO.exists(n.uid))&&(yield e.createUser(n.uid)),OG.success(n)}catch(t){return OG.failure(e.mapFirebaseError(t))}})()}disconnect(){var e=this;return dw(function*(){const t=vw.ofNullable(e.auth.currentUser);if(t.isPresent()){const n=t.get().uid;return yield e.connectivityDAO.setOffline(n),yield e.auth.signOut(),kG.SUCCESS}return kG.failure("Cannot disconnect a non-connected user")})()}getUserObs(){return this.userObs}setUsername(e){var t=this;return dw(function*(){if(""===e)return kG.failure($localize`Your username may not be empty.`);try{if(!1===(yield t.userDAO.usernameIsAvailable(e)))return kG.failure($localize`This username is already in use, please select a different one.`);const n=fw.getNonNullable(t.auth.currentUser);return yield AY.updateProfile(n,{displayName:e}),yield t.userDAO.setUsername(n.uid,e),yield t.userDAO.markVerified(n.uid),yield t.reloadUser(),kG.SUCCESS}catch(n){return kG.failure(t.mapFirebaseError(n))}})()}setPicture(e){var t=this;return dw(function*(){try{const n=fw.getNonNullable(t.auth.currentUser);return yield AY.updateProfile(n,{photoURL:e}),kG.SUCCESS}catch(n){return kG.failure(t.mapFirebaseError(n))}})()}reloadUser(){var e=this;return dw(function*(){const t=fw.getNonNullable(e.auth.currentUser);yield t.getIdToken(!0),yield t.reload()})()}ngOnDestroy(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or($G),Or(MN),Or(kY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class xY{constructor(e){this.value=e}static of(e){switch(e){case"CREATOR":return xY.CREATOR;case"RANDOM":return xY.RANDOM;default:return MG("CHOSEN_PLAYER"===e,"Invalid value for FirstPlayer: "+e+"."),xY.CHOSEN_PLAYER}}}xY.CREATOR=new xY("CREATOR"),xY.RANDOM=new xY("RANDOM"),xY.CHOSEN_PLAYER=new xY("CHOSEN_PLAYER");class RY{constructor(e){this.value=e}static of(e){switch(e){case"STANDARD":return RY.STANDARD;case"BLITZ":return RY.BLITZ;case"CUSTOM":return RY.CUSTOM;default:throw new Error("Invalid part type: "+e+".")}}}RY.STANDARD=new RY("STANDARD"),RY.BLITZ=new RY("BLITZ"),RY.CUSTOM=new RY("CUSTOM"),RY.NORMAL_MOVE_DURATION=120,RY.NORMAL_PART_DURATION=1800,RY.BLITZ_MOVE_DURATION=30,RY.BLITZ_PART_DURATION=900;class DY{constructor(e){this.value=e}}DY.PART_CREATED=new DY(0),DY.CONFIG_PROPOSED=new DY(2),DY.PART_STARTED=new DY(3),DY.PART_FINISHED=new DY(4);class LY{}class FY extends LY{static disjunction3(e,t,n,r,i){return new class extends FY{encodeMove(s){return r(s)?{type:"T1",encoded:e.encode(s)}:i(s)?{type:"T2",encoded:t.encode(s)}:{type:"T3",encoded:n.encode(s)}}decodeMove(r){const i=fw.getNonNullable(r).type,s=fw.getNonNullable(r).encoded;return"T1"===i?e.decode(s):"T2"===i?t.decode(s):n.decode(s)}}}encode(e){return this.encodeMove(e)}decode(e){return MG(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}class BY extends FY{static ofN(e,t,n){return new class extends BY{maxValue(){return e}encodeNumber(e){return t(e)}decodeNumber(e){return n(e)}}}static tuple(e,t,n){return new class extends BY{maxValue(){let t=0;return Object.keys(e).forEach(n=>{t=t*e[n].shift()+e[n].maxValue()}),t}encodeNumber(n){const r=t(n);let i=0;return Object.keys(r).forEach(t=>{i=i*e[t].shift()+e[t].encode(r[t])}),i}decodeNumber(t){const r={};let i=t;return Object.keys(e).reverse().forEach(t=>{const n=i%e[t].shift();i=(i-n)/e[t].shift(),r[t]=e[t].decode(n)}),n(r)}}}static disjunction(e,t,n){return new class extends BY{maxValue(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}encodeNumber(r){return n(r)?2*e.encodeNumber(r):2*t.encodeNumber(r)+1}decodeNumber(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}}static numberEncoder(e){return new class extends BY{maxValue(){return e}encodeNumber(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}decodeNumber(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}}shift(){return this.maxValue()+1}encodeMove(e){return this.encodeNumber(e)}decodeMove(e){return MG("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}BY.booleanEncoder=new class extends BY{maxValue(){return 1}encodeNumber(e){return e?1:0}decodeNumber(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}};class VY{constructor(e){this.value=e}static of(e){switch(e){case 0:return VY.ZERO;case 1:return VY.ONE;default:return fw.expectToBe(e,2),VY.NONE}}static fromTurn(e){return e%2==0?VY.ZERO:VY.ONE}toString(){return"Player "+this.value}equals(e){return this===e}getScoreModifier(){return 0===this.value?-1:1}getPreVictory(){return this.getVictoryValue()-this.getScoreModifier()}getDefeatValue(){return MG(this!==VY.NONE,"Should not call getDefeatValue on Player.NONE!"),this===VY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}getVictoryValue(){return MG(this!==VY.NONE,"Should not call getVictoryValue on Player.NONE!"),this===VY.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}getOpponent(){switch(this){case VY.ZERO:return VY.ONE;case VY.ONE:return VY.ZERO;default:return fw.expectToBe(this,VY.NONE),VY.NONE}}}VY.numberEncoder=BY.ofN(2,e=>e.value,e=>VY.of(e)),VY.ZERO=new VY(0),VY.ONE=new VY(1),VY.NONE=new VY(2);class UY{static rematchAccepted(e,t){return $Y("RematchAccepted",{typeGame:e,partId:t})}static getPlayer(e){return VY.of(fw.getNonNullable(e.data).player)}static getTypeGame(e){return fw.getNonNullable(e.data).typeGame}static getPartId(e){return fw.getNonNullable(e.data).partId}}function $Y(e,t){return{code:e,data:t}}function zY(e){return t=>$Y(e,{player:t.value})}UY.drawProposed=zY("DrawProposed"),UY.drawAccepted=$Y("DrawAccepted",{}),UY.drawRefused=zY("DrawRefused"),UY.takeBackAsked=zY("TakeBackAsked"),UY.takeBackRefused=zY("TakeBackRefused"),UY.takeBackAccepted=zY("TakeBackAccepted"),UY.rematchProposed=zY("RematchProposed"),UY.addTurnTime=zY("AddTurnTime"),UY.addGlobalTime=zY("AddGlobalTime");let HY=(()=>{class e extends PG{constructor(t){super("joiners",t),pw(e.VERBOSE,"JoinerDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(oG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),GY=(()=>{class e{constructor(t){this.joinerDAO=t,this.joinerUnsubscribe=vw.empty(),pw(e.VERBOSE,"JoinerService.constructor")}subscribeToChanges(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=vw.of(this.joinerDAO.subscribeToChanges(e,t))}unsubscribe(){MG(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=vw.empty()}createInitialJoiner(t,n){var r=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.createInitialJoiner("+t+", "+n+")"),r.set(n,{candidates:[],chosenPlayer:null,firstPlayer:xY.RANDOM.value,partType:RY.STANDARD.value,partStatus:DY.PART_CREATED.value,maximalMoveDuration:RY.NORMAL_MOVE_DURATION,totalPartDuration:RY.NORMAL_PART_DURATION,creator:t})})()}joinGame(t,n){var r=this;return dw(function*(){pw(e.VERBOSE,"JoinerService.joinGame("+t+", "+n+")");const i=yield r.joinerDAO.read(t);if(i.isAbsent())return kG.failure("Game does not exist");const s=LG.copyImmutableArray(i.get().candidates);return s.includes(n)?kG.failure("User already in the game"):(n===i.get().creator||(s[s.length]=n,yield r.joinerDAO.update(t,{candidates:s})),kG.SUCCESS)})()}cancelJoining(t){var n=this;return dw(function*(){if(pw(e.VERBOSE,"JoinerService.cancelJoining("+t+"); this.observedJoinerId = "+n.observedJoinerId),null==n.observedJoinerId)throw new Error("cannot cancel joining when not observing a joiner");const r=yield n.joinerDAO.read(n.observedJoinerId);if(!r.isAbsent()){const e=r.get(),i=LG.copyImmutableArray(e.candidates),s=i.indexOf(t);let o=e.chosenPlayer,a=e.partStatus;if(i.splice(s,1),o===t)o=null,a=DY.PART_CREATED.value;else if(-1===s)throw new Error("someone that was not candidate nor chosenPlayer just left the chat: "+t);return n.joinerDAO.update(n.observedJoinerId,{chosenPlayer:o,partStatus:a,candidates:i})}})()}updateCandidates(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.reviewConfig"),MG(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(n.observedJoinerId,{candidates:t})})()}deleteJoiner(){var t=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),MG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(t.observedJoinerId)})()}proposeConfig(t,n,r,i,s){var o=this;return dw(function*(){return pw(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:s}}),pw(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),MG(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(o.observedJoinerId,{partStatus:DY.CONFIG_PROPOSED.value,chosenPlayer:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:s,firstPlayer:i.value})})()}setChosenPlayer(t){return pw(e.VERBOSE,`JoinerService.setChosenPlayer(${t})`),MG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(this.observedJoinerId,{chosenPlayer:t})}reviewConfig(){var t=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.reviewConfig"),MG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(t.observedJoinerId,{partStatus:DY.PART_CREATED.value})})()}reviewConfigRemoveChosenPlayerAndUpdateCandidates(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.reviewConfig"),MG(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(n.observedJoinerId,{partStatus:DY.PART_CREATED.value,chosenPlayer:null,candidates:t})})()}acceptConfig(){return pw(e.VERBOSE,"JoinerService.acceptConfig"),MG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(this.observedJoinerId,{partStatus:DY.PART_STARTED.value})}createJoiner(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)})()}readJoinerById(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),(yield n.joinerDAO.read(t)).get()})()}set(t,n){var r=this;return dw(function*(){return pw(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)})()}updateJoinerById(t,n){var r=this;return dw(function*(){return pw(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(HY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),qY=(()=>{class e{constructor(t,n,r){this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=vw.empty(),pw(e.VERBOSE,"GameService.constructor")}getPartValidity(e,t){var n=this;return dw(function*(){const r=yield n.partDAO.read(e);return r.isAbsent()?kG.failure("NONEXISTENT_PART"):r.get().typeGame===t?kG.SUCCESS:kG.failure("WRONG_GAME_TYPE")})()}createUnstartedPart(t,n){return pw(e.VERBOSE,"GameService.createPart("+t+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t,turn:-1,result:xG.UNACHIEVED.value,listMoves:[]})}createChat(t){return pw(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}createPartJoinerAndChat(t,n){var r=this;return dw(function*(){pw(e.VERBOSE,"GameService.createGame("+t+", "+n+")");const i=yield r.createUnstartedPart(t,n);return yield r.joinerService.createInitialJoiner(t,i),yield r.createChat(i),i})()}startGameWithConfig(t,n,r,i){pw(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));const s=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,s)}getStartingConfig(e){let t,n,r=xY.of(e.firstPlayer);return r===xY.RANDOM&&(r=Math.random()<.5?xY.CREATOR:xY.CHOSEN_PLAYER),r===xY.CREATOR?(t=e.creator,n=fw.getNonNullable(e.chosenPlayer)):(t=fw.getNonNullable(e.chosenPlayer),n=e.creator),{playerZero:t,playerOne:n,turn:0,beginning:sG(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}deletePart(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)})()}acceptConfig(t,n){var r=this;return dw(function*(){return pw(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),yield r.joinerService.acceptConfig(),r.startGameWithConfig(t,VY.ONE,0,n)})()}startObserving(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");pw(e.VERBOSE,"[start watching part "+t),this.followedPartId=vw.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}resign(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:xG.RESIGN.value,request:null})}notifyTimeout(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:xG.TIMEOUT.value,request:null})}sendRequest(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}proposeDraw(e,t,n){return this.sendRequest(e,n,t,UY.drawProposed(n))}acceptDraw(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===VY.ZERO?xG.AGREED_DRAW_BY_ZERO:xG.AGREED_DRAW_BY_ONE).value,request:null})}refuseDraw(e,t,n){return this.sendRequest(e,n,t,UY.drawRefused(n))}proposeRematch(e,t,n){return this.sendRequest(e,n,t,UY.rematchProposed(n))}acceptRematch(t,n,r){var i=this;return dw(function*(){pw(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t});const s=fw.getNonNullable(t.data),o=yield i.joinerService.readJoinerById(t.id);let a;a=s.playerZero===o.creator?xY.CHOSEN_PLAYER:xY.CREATOR;const c={...o,candidates:[],firstPlayer:a.value,partStatus:DY.PART_STARTED.value},l=yield i.joinerService.createJoiner(c),u=i.getStartingConfig(c),h={lastUpdate:{index:0,player:r.value},typeGame:s.typeGame,result:xG.UNACHIEVED.value,listMoves:[],...u};return yield i.partDAO.set(l,h),yield i.createChat(l),i.sendRequest(t.id,r,n,UY.rematchAccepted(s.typeGame,l))})()}askTakeBack(e,t,n){return this.sendRequest(e,n,t,UY.takeBackAsked(n))}acceptTakeBack(e,t,n,r){var i=this;return dw(function*(){MG(n!==VY.NONE,"Illegal for observer to make request"),MG(UY.getPlayer(fw.getNonNullable(t.data.request))!==n,"Illegal to accept your own request");const s=UY.takeBackAccepted(n);let o=t.data.listMoves.slice(0,t.data.listMoves.length-1);o.length%2===n.value&&(o=o.slice(0,o.length-1));const a={request:s,listMoves:o,turn:o.length,lastUpdateTime:sG(),remainingMsForZero:fw.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:fw.getNonNullable(t.data.remainingMsForOne)-r[1]},c=t.data.lastUpdate.index;return yield i.partDAO.updateAndBumpIndex(e,n,c,a)})()}refuseTakeBack(e,t,n){MG(n!==VY.NONE,"Illegal for observer to make request");const r=UY.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}addGlobalTime(e,t,n,r){var i=this;return dw(function*(){MG(r!==VY.NONE,"Illegal for observer to make request");let s={request:UY.addGlobalTime(r.getOpponent())};return s=r===VY.ZERO?{...s,remainingMsForOne:fw.getNonNullable(n.remainingMsForOne)+3e5}:{...s,remainingMsForZero:fw.getNonNullable(n.remainingMsForZero)+3e5},yield i.partDAO.updateAndBumpIndex(e,r,t,s)})()}addTurnTime(e,t,n){var r=this;return dw(function*(){const i={request:UY.addTurnTime(e.getOpponent())};return yield r.partDAO.updateAndBumpIndex(n,e,t,i)})()}stopObserving(){pw(e.VERBOSE,"GameService.stopObserving();"),MG(this.followedPartId.isPresent(),"!!! GameService.stopObserving: we already stop watching doc"),pw(e.VERBOSE,"stopped watching joiner "+this.followedPartId+"]"),this.followedPartId=vw.empty(),this.followedPartUnsubscribe()}updateDBBoard(t,n,r,i,s,o,a,c){var l=this;return dw(function*(){pw(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:s,msToSubstract:i,notifyDraw:o,winner:a,loser:c}});const u=(yield l.partDAO.read(t)).get(),h=u.lastUpdate.index,d=u.turn+1,f=LG.copyImmutableArray(u.listMoves);f[f.length]=r;let p={listMoves:f,turn:d,request:null,lastUpdateTime:sG()};return p=l.updateScore(p,s),p=l.substractMs(p,u,i),null!=a?p={...p,winner:a,loser:c,result:xG.VICTORY.value}:!0===o&&(p={...p,result:xG.HARD_DRAW.value}),yield l.partDAO.updateAndBumpIndex(t,n,h,p)})()}updateScore(e,t){return void 0!==t?{...e,scorePlayerZero:t[0],scorePlayerOne:t[1]}:e}substractMs(e,t,n){return n[0]>0?{...e,remainingMsForZero:fw.getNonNullable(t.remainingMsForZero)-n[0]}:n[1]>0?{...e,remainingMsForOne:fw.getNonNullable(t.remainingMsForOne)-n[1]}:e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(DG),Or(GY),Or(VG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class WY{static getNavigatorLanguage(){return navigator.language}static getLocale(){const e=(localStorage.getItem("locale")||WY.getNavigatorLanguage()||"fr").slice(0,2).toLowerCase();return["en","fr"].some(t=>t===e)?e:"fr"}}let jY=(()=>{class e{constructor(){}changeTheme(e){localStorage.setItem("theme",e)}getTheme(){return vw.ofNullable(localStorage.getItem("theme"))}changeLanguage(e){localStorage.setItem("locale",e.toLowerCase())}getLanguage(){return WY.getLocale()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ZY=(()=>{class e{constructor(e,t){this.document=e,this.userSettingsService=t,this.availableThemes=["dark","light"];const n=this.getStoredTheme();n.isPresent()?this.loadTheme(n.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}getStoredTheme(){const e=this.userSettingsService.getTheme();if(e.isPresent()){const t=e.get();if(this.availableThemes.some(e=>e===t))return vw.of(t)}return vw.empty()}loadTheme(e){this.loadStyle(e+".css"),this.theme=e}loadStyle(e){const t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{const n=this.document.createElement("link");n.id="theme",n.rel="stylesheet",n.href=`${e}`,t.appendChild(n)}}getTheme(){return this.theme}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh),Or(jY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var YY={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},KY={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},JY={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},QY={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},XY={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},eK={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]};function tK(e){return(tK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){rK(e,t,n[t])})}return e}function sK(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,s=c}finally{try{!r&&null!=a.return&&a.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var oK={},aK={};try{"undefined"!=typeof window&&(oK=window),"undefined"!=typeof document&&(aK=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch{}var cK=(oK.navigator||{}).userAgent,lK=void 0===cK?"":cK,uK=oK,hK=aK,dK=!!hK.documentElement&&!!hK.head&&"function"==typeof hK.addEventListener&&"function"==typeof hK.createElement,fK=(~lK.indexOf("MSIE")||lK.indexOf("Trident/"),"___FONT_AWESOME___"),pK="svg-inline--fa",gK=[1,2,3,4,5,6,7,8,9,10],mK=gK.concat([11,12,13,14,15,16,17,18,19,20]),yK={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},vK=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",yK.GROUP,yK.SWAP_OPACITY,yK.PRIMARY,yK.SECONDARY].concat(gK.map(function(e){return"".concat(e,"x")})).concat(mK.map(function(e){return"w-".concat(e)})),uK.FontAwesomeConfig||{});hK&&"function"==typeof hK.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=sK(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=hK.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(vK[n]=r)});var _K=iK({},{familyPrefix:"fa",replacementClass:pK,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},vK);_K.autoReplaceSvg||(_K.observeMutations=!1);var CK=iK({},_K);uK.FontAwesomeConfig=CK;var EK=uK||{};EK[fK]||(EK[fK]={}),EK[fK].styles||(EK[fK].styles={}),EK[fK].hooks||(EK[fK].hooks={}),EK[fK].shims||(EK[fK].shims=[]);var wK=EK[fK],bK=[];dK&&((hK.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(hK.readyState)||hK.addEventListener("DOMContentLoaded",function e(){hK.removeEventListener("DOMContentLoaded",e),bK.map(function(e){return e()})}));var SK,PK="pending",OK="fulfilled",TK="rejected",IK=function(){},kK="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,AK="undefined"==typeof setImmediate?setTimeout:setImmediate,NK=[];function MK(){for(var e=0;e<NK.length;e++)NK[e][0](NK[e][1]);NK=[],SK=!1}function xK(e,t){NK.push([e,t]),SK||(SK=!0,AK(MK,0))}function RK(e){var t=e.owner,n=t._state,r=t._data,i=e[n],s=e.then;if("function"==typeof i){n=OK;try{r=i(r)}catch(o){BK(s,o)}}DK(s,r)||(n===OK&&LK(s,r),n===TK&&BK(s,r))}function DK(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===tK(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?FK(e,r):LK(e,r))},function(t){n||(n=!0,BK(e,t))}),!0}}catch(i){return n||BK(e,i),!0}return!1}function LK(e,t){(e===t||!DK(e,t))&&FK(e,t)}function FK(e,t){e._state===PK&&(e._state="settled",e._data=t,xK(UK,e))}function BK(e,t){e._state===PK&&(e._state="settled",e._data=t,xK($K,e))}function VK(e){e._then=e._then.forEach(RK)}function UK(e){e._state=OK,VK(e)}function $K(e){e._state=TK,VK(e),!e._handled&&kK&&global.process.emit("unhandledRejection",e._data,e)}function zK(e){global.process.emit("rejectionHandled",e)}function HK(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof HK))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){BK(t,e)}try{e(function(e){LK(t,e)},n)}catch(r){n(r)}}(e,this)}HK.prototype={constructor:HK,_state:PK,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(IK),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===TK&&kK&&xK(zK,this)),this._state===OK||this._state===TK?xK(RK,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},HK.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new HK(function(t,n){var r=[],i=0;function s(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,a=0;a<e.length;a++)(o=e[a])&&"function"==typeof o.then?o.then(s(a),n):r[a]=o;i||t(r)})},HK.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new HK(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},HK.resolve=function(e){return e&&"object"===tK(e)&&e.constructor===HK?e:new HK(function(t){t(e)})},HK.reject=function(e){return new HK(function(t,n){n(e)})};var GK={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function qK(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function WK(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function jK(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function ZK(e){return e.size!==GK.size||e.x!==GK.x||e.y!==GK.y||e.rotate!==GK.rotate||e.flipX||e.flipY}function YK(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),s="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(s," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var KK={x:0,y:0,width:"100%",height:"100%"};function JK(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function QK(e){return"g"===e.tag?e.children:[e]}function XK(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,s=e.iconName,o=e.transform,a=e.symbol,c=e.title,l=e.maskId,u=e.titleId,h=e.extra,d=e.watchable,f=void 0!==d&&d,p=r.found?r:n,g=p.width,m=p.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(g/m*16)),_=[CK.replacementClass,s?"".concat(CK.familyPrefix,"-").concat(s):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),C={children:[],attributes:iK({},h.attributes,{"data-prefix":i,"data-icon":s,class:_,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(g," ").concat(m)})},E=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(g/m*16*.0625,"em")}:{};f&&(C.attributes["data-fa-i2svg"]=""),c&&C.children.push({tag:"title",attributes:{id:C.attributes["aria-labelledby"]||"title-".concat(u||qK())},children:[c]});var w=iK({},C,{prefix:i,iconName:s,main:n,mask:r,maskId:l,transform:o,symbol:a,styles:iK({},E,h.styles)}),b=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,s=e.maskId,o=r.icon,a=i.icon,c=YK({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),l={tag:"rect",attributes:iK({},KK,{fill:"white"})},u=o.children?{children:o.children.map(JK)}:{},h={tag:"g",attributes:iK({},c.inner),children:[JK(iK({tag:o.tag,attributes:iK({},o.attributes,c.path)},u))]},d={tag:"g",attributes:iK({},c.outer),children:[h]},f="mask-".concat(s||qK()),p="clip-".concat(s||qK()),g={tag:"mask",attributes:iK({},KK,{id:f,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[l,d]},m={tag:"defs",children:[{tag:"clipPath",attributes:{id:p},children:QK(a)},g]};return t.push(m,{tag:"rect",attributes:iK({fill:"currentColor","clip-path":"url(#".concat(p,")"),mask:"url(#".concat(f,")")},KK)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,s=jK(e.styles);if(s.length>0&&(n.style=s),ZK(i)){var o=YK({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:iK({},o.outer),children:[{tag:"g",attributes:iK({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:iK({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),S=b.attributes;return w.children=b.children,w.attributes=S,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:iK({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(CK.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,s=e.styles,o=e.transform;if(ZK(o)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=jK(iK({},s,{"transform-origin":"".concat(a.x+o.x/16,"em ").concat(a.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var eJ=function(e,t,n,r){var i,s,o,a=Object.keys(e),c=a.length,l=void 0!==r?function(e,t){return function(n,r,i,s){return e.call(t,n,r,i,s)}}(t,r):t;for(void 0===n?(i=1,o=e[a[0]]):(i=0,o=n);i<c;i++)o=l(o,e[s=a[i]],s,e);return o};function tJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,s=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof wK.hooks.addPack||i?wK.styles[e]=iK({},wK.styles[e]||{},s):wK.hooks.addPack(e,s),"fas"===e&&tJ("fa",t)}var nJ=wK.styles,rJ=wK.shims,iJ=function(){var e=function(e){return eJ(nJ,function(t,n,r){return t[r]=eJ(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in nJ;eJ(rJ,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function sJ(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function oJ(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,s=void 0===i?[]:i;return"string"==typeof e?WK(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(WK(e[n]),'" ')},"").trim()}(r),">").concat(s.map(oJ).join(""),"</").concat(t,">")}iJ();function aJ(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}(aJ.prototype=Object.create(Error.prototype)).constructor=aJ;var cJ={fill:"currentColor"},lJ={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},uJ=(iK({},cJ,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),iK({},lJ,{attributeName:"opacity"}));function hJ(e){var t=e[0],n=e[1],r=sK(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(CK.familyPrefix,"-").concat(yK.GROUP)},children:[{tag:"path",attributes:{class:"".concat(CK.familyPrefix,"-").concat(yK.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(CK.familyPrefix,"-").concat(yK.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function dJ(){CK.autoAddCss&&!mJ&&(function(e){if(e&&dK){var t=hK.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=hK.head.childNodes,r=null,i=n.length-1;i>-1;i--){var s=n[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}hK.head.insertBefore(t,r)}}(function(){var e="fa",t=pK,n=CK.familyPrefix,r=CK.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var s=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(s,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),mJ=!0)}function fJ(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return oJ(e)})}}),Object.defineProperty(e,"node",{get:function(){if(dK){var t=hK.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function pJ(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return sJ(gJ.definitions,n,r)||sJ(wK.styles,n,r)}iK({},cJ,{cx:"256",cy:"364",r:"28"}),iK({},lJ,{attributeName:"r",values:"28;14;28;28;14;28;"}),iK({},uJ,{values:"1;0;1;1;0;1;"}),iK({},cJ,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),iK({},uJ,{values:"1;0;0;0;0;1;"}),iK({},cJ,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),iK({},uJ,{values:"0;0;1;1;0;0;"});var gJ=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&nK(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=iK({},e.definitions[t]||{},i[t]),tJ(t,i[t]),iJ()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,s=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][s]=o}),e}}]),e}()),mJ=!1,yJ=function(e){return function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(e)},vJ=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:pJ(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:pJ(i||{})),e(r,iK({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?GK:n,i=t.symbol,s=void 0!==i&&i,o=t.mask,a=void 0===o?null:o,c=t.maskId,l=void 0===c?null:c,u=t.title,h=void 0===u?null:u,d=t.titleId,f=void 0===d?null:d,p=t.classes,g=void 0===p?[]:p,m=t.attributes,y=void 0===m?{}:m,v=t.styles,_=void 0===v?{}:v;if(e){var C=e.prefix,E=e.iconName,w=e.icon;return fJ(iK({type:"icon"},e),function(){return dJ(),CK.autoA11y&&(h?y["aria-labelledby"]="".concat(CK.replacementClass,"-title-").concat(f||qK()):(y["aria-hidden"]="true",y.focusable="false")),XK({icons:{main:hJ(w),mask:a?hJ(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:C,iconName:E,transform:iK({},GK,r),symbol:s,title:h,maskId:l,titleId:f,extra:{attributes:y,styles:_,classes:g}})})}});const _J=["*"],CJ=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let EJ=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),wJ=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e){t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t;for(const e of t.icon[2])"string"==typeof e&&(this.definitions[t.prefix][e]=t)}}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),bJ=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[vt]}),e})(),SJ=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(la(ul),la(al))},e.\u0275cmp=Xe({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[vt],ngContentSelectors:_J,decls:1,vars:0,template:function(e,t){1&e&&(function(e){const t=zt()[16][6];if(!t.projection){const n=t.projection=fr(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?Sa(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}(),function(e,t=0,n){const r=zt(),i=Ht(),s=Fs(i,20+e,16,null,n||null);null===s.projection&&(s.projection=t),Kt(),64!=(64&s.flags)&&function(e,t,n){hs(t[11],0,t,n,ji(e,n,t),Xi(n.parent||t[6],n,t))}(i,r,s)}(0))},encapsulation:2}),e})(),PJ=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=this.icon??this.config.fallbackIcon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=((e,t)=>(e=>void 0!==e.prefix&&void 0!==e.iconName)(e)?e:Array.isArray(e)&&2===e.length?{prefix:e[0],iconName:e[1]}:"string"==typeof e?{prefix:t,iconName:e}:void 0)(e,this.config.defaultPrefix);return"icon"in t?t:this.iconLibrary.getIconDefinition(t.prefix,t.iconName)??((e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null)}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?yJ(this.transform):this.transform;return{title:this.title,transform:t,classes:[...CJ(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=vJ(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(la(Tf),la(EJ),la(wJ),la(bJ,8),la(SJ,8))},e.\u0275cmp=Xe({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(Ua("innerHTML",t.renderedIconHTML,vi),ra("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[vt],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),OJ=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function TJ(e,t){if(1&e){const e=ya();ga(0),da(1,"div",9),da(2,"a",10),Da(3),fa(),da(4,"div",12),da(5,"a",24),Ca("click",function(){return Gt(e),ba().logout()}),Hc(6,25),fa(),fa(),fa(),ma()}if(2&e){const e=ba();Ts(3),La(e.username)}}const IJ=function(){return["/register"]},kJ=function(){return["/login"]};function AJ(e,t){1&e&&(da(0,"div",26),da(1,"a",27),da(2,"strong"),Hc(3,28),fa(),fa(),da(4,"a",29),Hc(5,30),fa(),fa()),2&e&&(Ts(1),ua("routerLink",ou(2,IJ)),Ts(3),ua("routerLink",ou(3,kJ)))}const NJ=function(){return["/"]},MJ=function(){return["/play"]},xJ=function(){return["/lobby"]},RJ=function(){return["/local"]},DJ=function(){return["/tutorial"]},LJ=function(){return["/settings"]};let FJ=(()=>{class e{constructor(e,t){this.router=e,this.authenticationService=t,this.username="connecting...",this.faCog=KY,this.showMenu=!1}ngOnInit(){this.userSub=this.authenticationService.getUserObs().subscribe(e=>{this.username=e.username.isPresent()?e.username.get():e.email.isPresent()?e.email.get():""})}logout(){var e=this;return dw(function*(){yield e.authenticationService.disconnect(),yield e.router.navigate(["/"])})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(la(t_),la(MY))},e.\u0275cmp=Xe({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){let e,t,n,r,i,s,o,a,c,l,u;return e=$localize`Home`,t=$localize`Play online`,n=$localize`Create a game`,r=$localize`Join a game`,i=$localize`Play offline`,s=$localize`Create a game`,o=$localize`Learn the rules`,a=$localize`Settings`,c=$localize`Log out`,l=$localize`Register`,u=$localize`Log in`,[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],e,[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],t,[1,"navbar-dropdown"],n,r,i,s,o,[1,"navbar-end"],["data-tooltip",a,1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["connect",""],["id","logout",1,"navbar-item",3,"click"],c,[1,"buttons"],[1,"button","is-primary",3,"routerLink"],l,[1,"button","is-light",3,"routerLink"],u]},template:function(e,t){if(1&e&&(da(0,"nav",0),da(1,"div",1),da(2,"a",2),pa(3,"img",3),fa(),da(4,"a",4),Ca("click",function(){return t.showMenu=!t.showMenu}),pa(5,"span",5),pa(6,"span",5),pa(7,"span",5),fa(),fa(),da(8,"div",6),Ca("click",function(){return t.showMenu=!t.showMenu}),da(9,"div",7),da(10,"a",2),Hc(11,8),fa(),da(12,"div",9),da(13,"a",10),Hc(14,11),fa(),da(15,"div",12),da(16,"a",2),Hc(17,13),fa(),da(18,"a",2),Hc(19,14),fa(),fa(),fa(),da(20,"div",9),da(21,"a",10),Hc(22,15),fa(),da(23,"div",12),da(24,"a",2),Hc(25,16),fa(),da(26,"a",2),Hc(27,17),fa(),fa(),fa(),fa(),da(28,"div",18),da(29,"a",19),pa(30,"fa-icon",20),fa(),da(31,"div",21),aa(32,TJ,7,1,"ng-container",22),aa(33,AJ,6,4,"ng-template",null,23,Du),fa(),fa(),fa(),fa()),2&e){const e=ca(34);Ts(2),ua("routerLink",ou(12,NJ)),Ts(2),ua("ngClass",t.showMenu?"is-active":""),Ts(4),ua("ngClass",t.showMenu?"is-active":""),Ts(2),ua("routerLink",ou(13,NJ)),Ts(6),ua("routerLink",ou(14,MJ)),Ts(2),ua("routerLink",ou(15,xJ)),Ts(6),ua("routerLink",ou(16,RJ)),Ts(2),ua("routerLink",ou(17,DJ)),Ts(3),ua("routerLink",ou(18,LJ)),Ts(1),ua("icon",t.faCog),Ts(2),ua("ngIf",t.username)("ngIfElse",e)}},directives:[i_,Bd,PJ,zd],encapsulation:2}),e})(),BJ=(()=>{class e{constructor(e,t){this._themeService=e,this._errorLoggerService=t}}return e.\u0275fac=function(t){return new(t||e)(la(ZY),la(NG))},e.\u0275cmp=Xe({type:e,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container","mt-2"]],template:function(e,t){1&e&&(pa(0,"app-header"),da(1,"main",0),pa(2,"router-outlet"),fa())},directives:[FJ,o_],encapsulation:2}),e})();class VJ{constructor(e,t){this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}}class UJ extends VJ{isDown(){return 1===this.y}isUp(){return-1===this.y}isLeft(){return-1===this.x}isRight(){return 1===this.x}toInt(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}toString(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}class $J{of(e,t){for(const n of this.all)if(n.x===e&&n.y===t)return OG.success(n);return OG.failure("Invalid x and y in direction construction")}fromDelta(e,t){return 0===e&&0===t?OG.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):OG.failure(`Invalid delta for direction: ${e}, ${t}`)}fromMove(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}fromString(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return OG.failure(`Invalid direction string ${e}`)}}fromInt(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return OG.failure(`Invalid int direction: ${e}`)}}}class zJ extends UJ{constructor(e,t){super(e,t)}isDiagonal(){return 0!==this.x&&0!==this.y}getOpposite(){return zJ.factory.of(-this.x,-this.y).get()}}zJ.UP=new zJ(0,-1),zJ.UP_RIGHT=new zJ(1,-1),zJ.RIGHT=new zJ(1,0),zJ.DOWN_RIGHT=new zJ(1,1),zJ.DOWN=new zJ(0,1),zJ.DOWN_LEFT=new zJ(-1,1),zJ.LEFT=new zJ(-1,0),zJ.UP_LEFT=new zJ(-1,-1),zJ.factory=new class extends $J{constructor(){super(...arguments),this.all=[zJ.UP,zJ.UP_RIGHT,zJ.RIGHT,zJ.DOWN_RIGHT,zJ.DOWN,zJ.DOWN_LEFT,zJ.LEFT,zJ.UP_LEFT]}},zJ.DIRECTIONS=zJ.factory.all,zJ.encoder=new class extends LY{encode(e){return e.toString()}decode(e){return MG("string"==typeof e,"Invalid encoded direction"),zJ.factory.fromString(e).get()}};class HJ extends UJ{constructor(e,t){super(e,t)}getOpposite(){return HJ.factory.of(-this.x,-this.y).get()}}HJ.UP=new HJ(0,-1),HJ.RIGHT=new HJ(1,0),HJ.DOWN=new HJ(0,1),HJ.LEFT=new HJ(-1,0),HJ.factory=new class extends $J{constructor(){super(...arguments),this.all=[HJ.UP,HJ.RIGHT,HJ.DOWN,HJ.LEFT]}of(e,t){return 0===e&&-1===t?OG.success(HJ.UP):1===e&&0===t?OG.success(HJ.RIGHT):0===e&&1===t?OG.success(HJ.DOWN):-1===e&&0===t?OG.success(HJ.LEFT):OG.failure("Invalid orthogonal from x and y")}},HJ.ORTHOGONALS=HJ.factory.all,HJ.encoder=new class extends LY{encode(e){return e.toString()}decode(e){return MG("string"==typeof e,"Invalid encoded orthogonal"),HJ.factory.fromString(e).get()}};class GJ{constructor(e,t){this.x=e,this.y=t}static numberEncoder(e,t){return BY.tuple([BY.numberEncoder(e),BY.numberEncoder(t)],e=>[e.x,e.y],e=>new GJ(e[0],e[1]))}getNext(e,t){return new GJ(this.x+(t=t??1)*e.x,this.y+t*e.y)}getPrevious(e,t){return this.getNext(e,-(t=t??1))}getLeft(e){return new GJ(this.x+e.y,this.y+-e.x)}getRight(e){return new GJ(this.x+-e.y,this.y+e.x)}getOpposite(){return new GJ(-this.x,-this.y)}isInRange(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}isNotInRange(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}getDirectionToward(e){return zJ.factory.fromMove(this,e)}getOrthogonalDistance(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}getDistance(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");const t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}isHexagonallyAlignedWith(e){const t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}isAlignedWith(e){const t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}getVectorToward(e){return new GJ(e.x-this.x,e.y-this.y)}getMinimalVectorToward(e){return this.getVectorToward(e).toVector()}getCoordsToward(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];const t=this.getDirectionToward(e).get();let n=this.getNext(t,1);const r=[];for(;!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}toVector(){const e=Math.abs(this.x),t=Math.abs(this.y),n=Math.max(e,t);let r=this.x,i=this.y,s=2;for(;s<=n;)r%s==0&&i%s==0?(r/=s,i/=s):s++;return new GJ(r,i)}isBetween(e,t){const n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}equals(e){return this===e||e.x===this.x&&e.y===this.y}compareTo(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}toString(){return"("+this.x+", "+this.y+")"}}GJ.encoder=new class extends LY{encode(e){return{x:e.x,y:e.y}}decode(e){const t=e;return MG(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new GJ(t.x,t.y)}};var qJ=n(5378);let WJ=(()=>{class e{infoMessage(e){this.message(e,"is-info")}gameMessage(e){this.message(e,"is-warning")}criticalMessage(e){this.message(e,"is-danger")}message(e,t){(0,qJ.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),jJ=(()=>{class e{constructor(e){this.messageDisplayer=e,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=vw.empty(),this.imagesLocation="assets/images/"}message(e){this.messageDisplayer.gameMessage(e)}cancelMove(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?kG.SUCCESS:(this.messageDisplayer.gameMessage(e),kG.failure(e))}cancelMoveAttempt(){}getPlayerClass(e){switch(e){case VY.ZERO:return"player0";case VY.ONE:return"player1";default:return fw.expectToBe(e,VY.NONE),""}}pass(){var e=this;return dw(function*(){return NG.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name})})()}getTurn(){return this.rules.node.gameState.turn}getCurrentPlayer(){return this.rules.node.gameState.getCurrentPlayer()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}range(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),ZJ=(()=>{class e extends jJ{getHexaCoordsBy(e,t){const n=new GJ(e,t);return this.getHexaCoordsAt(n)}getHexaCoordsAt(e){let t="";const n=this.hexaLayout.getHexaCoordsAt(e);for(const r of n)t+=r.x+" "+r.y+" ";return t+=n[0].x+" "+n[0].y,t}getCenterBy(e,t){const n=new GJ(e,t);return this.getCenterAt(n)}getCenterAt(e){return this.hexaLayout.getCenterAt(e)}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class YJ{constructor(e){this.value=e}static from(e){switch(e){case YJ.ZERO.value:return YJ.ZERO;case YJ.ONE.value:return YJ.ONE;case YJ.EMPTY.value:return YJ.EMPTY;case YJ.NONE.value:return YJ.NONE;default:throw new Error("FourStatePiece has no value matching "+e)}}static ofPlayer(e){switch(e){case VY.ZERO:return YJ.ZERO;case VY.ONE:return YJ.ONE;default:throw new Error("FourStatePiece.ofPlayer can only be called with Player.ZERO and Player.ONE.")}}equals(e){return this===e}is(e){return this.value===e.value}isPlayer(){return this===YJ.ZERO||this===YJ.ONE}}YJ.ZERO=new YJ(VY.ZERO.value),YJ.ONE=new YJ(VY.ONE.value),YJ.EMPTY=new YJ(VY.NONE.value),YJ.NONE=new YJ(3);class KJ extends UJ{constructor(e,t){super(e,t)}static getAngle(e){switch(e){case KJ.UP:return 0;case KJ.UP_RIGHT:return 60;case KJ.RIGHT:return 120;case KJ.DOWN:return 180;case KJ.DOWN_LEFT:return 240;default:return fw.expectToBe(e,KJ.LEFT),300}}getOpposite(){return KJ.factory.of(-this.x,-this.y).get()}}KJ.UP=new KJ(0,-1),KJ.LEFT=new KJ(-1,0),KJ.UP_RIGHT=new KJ(1,-1),KJ.DOWN_LEFT=new KJ(-1,1),KJ.RIGHT=new KJ(1,0),KJ.DOWN=new KJ(0,1),KJ.factory=new class extends $J{constructor(){super(...arguments),this.all=[KJ.UP,KJ.UP_RIGHT,KJ.RIGHT,KJ.DOWN,KJ.DOWN_LEFT,KJ.LEFT]}},KJ.encoder=new class extends BY{maxValue(){return 5}encodeNumber(e){switch(e){case KJ.UP:return 0;case KJ.UP_RIGHT:return 1;case KJ.RIGHT:return 2;case KJ.DOWN:return 3;case KJ.DOWN_LEFT:return 4;default:return 5}}decodeNumber(e){return MG(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),KJ.factory.all[e]}};class JJ{constructor(e,t,n){this.size=e,this.origin=t,this.orientation=n}getCenterAt(e){const t=this.orientation.conversionMatrix;return new GJ(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}getCornerOffset(e){const t=2*Math.PI*(this.orientation.startAngle+e)/6;return new GJ(this.size*Math.cos(t),this.size*Math.sin(t))}getHexaCoordsAt(e){const t=this.getCenterAt(e),n=[];for(let r=0;r<6;r+=1){const e=this.getCornerOffset(r);n.push(new GJ(t.x+e.x,t.y+e.y))}return n}}class QJ{}class XJ extends QJ{constructor(){super(),this.startAngle=.5,this.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],this.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3]}}XJ.INSTANCE=new XJ;class eQ extends QJ{constructor(){super(),this.startAngle=0,this.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],this.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3]}isOnBorder(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}isOnTopRightBorder(e,t){return 0===t.y}isOnRightBorder(e,t){return t.x===e.width-1}isOnLeftBorder(e,t){return 0===t.x}isOnBottomLeftBorder(e,t){return t.y===e.height-1}isOnTopLeftBorder(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}isOnBottomRightBorder(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}getAllBorders(e){const t=[];return e.forEachCoord((n,r)=>{this.isOnBorder(e,n)&&t.push(n)}),t}isTopCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}isTopLeftCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isTopRightCorner(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}isBottomCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}isBottomLeftCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isBottomRightCorner(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}eQ.INSTANCE=new eQ;let tQ=(()=>{class e{}return e.CANNOT_CHOOSE_OPPONENT_PIECE=()=>$localize`You cannot pick a piece of the opponent.`,e.MUST_CLICK_ON_EMPTY_SPACE=()=>$localize`You must click on an empty space.`,e.CANNOT_SELF_CAPTURE=()=>$localize`Your landing space should be empty or contain a piece of the opponent.`,e.MUST_CHOOSE_PLAYER_PIECE=()=>$localize`You must pick one of your pieces.`,e.CANNOT_PASS=()=>$localize`You cannot pass your turn.`,e.MUST_LAND_ON_EMPTY_SPACE=()=>$localize`You must drop your piece on an empty space.`,e.MUST_PASS=()=>$localize`You must pass your turn.`,e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=()=>$localize`You have selected an empty space, you must select one of your own pieces.`,e.MOVE_CANNOT_BE_STATIC=()=>$localize`You must choose different starting and ending coordinates.`,e})();class nQ{constructor(e,t){this.ruler=e,this.name=t}toString(){return this.name}}class rQ{constructor(e){this.value=e}static fromWinner(e){return new rQ(e===VY.NONE?0:e.getVictoryValue())}toString(){return""+this.value}}class iQ{static toComparableObjectSet(e){const t=[];return e.forEach(e=>{t.some(t=>t.equals(e))||t.push(e)}),t}static toComparableSet(e){const t=[];return e.forEach(e=>{t.some(t=>yw(t,e))||t.push(e)}),t}}class sQ{constructor(e){this.values=void 0===e?[]:iQ.toComparableSet(e)}equals(e){if(e.size()!==this.size())return!1;for(const t of this)if(!1===e.contains(t))return!1;return!0}toString(){let e="";for(const t of this)e+=null==t?"null, ":t.toString()+", ";return"["+e.slice(0,-2)+"]"}add(e){return!this.contains(e)&&(this.values.push(e),!0)}union(e){for(const t of e)this.add(t)}contains(e){for(const t of this.values)if(yw(t,e))return!0;return!1}size(){return this.values.length}toList(){const e=[];for(const t of this)e.push(t);return e}getAnyElement(){return this.size()>0?vw.of(this.values[0]):vw.empty()}[Symbol.iterator](){return this.values.values()}}class oQ{constructor(e){this.turn=e}getCurrentPlayer(){return VY.fromTurn(this.turn)}getCurrentOpponent(){return this.turn%2==1?VY.ZERO:VY.ONE}}class aQ extends oQ{constructor(e,t){super(t),this.board=e}getPieceAt(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}isOnBoard(e){return e.isInRange(this.board[0].length,this.board.length)}getPieceAtXY(e,t){return this.getPieceAt(new GJ(e,t))}forEachCoord(e){for(const[t,n]of this.getCoordsAndContents())e(t,n)}getCoordsAndContents(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++){const r=new GJ(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}getCopiedBoard(){return LG.copyBiArray(this.board)}}class cQ extends aQ{static getInitialState(){const e=YJ.EMPTY,t=YJ.NONE,n=YJ.ZERO,r=YJ.ONE;return new cQ([[t,t,t,t,r,r,r,r,r],[t,t,t,r,r,r,r,r,r],[t,t,e,e,r,r,r,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,n,n,n,e,e,t,t],[n,n,n,n,n,n,t,t,t],[n,n,n,n,n,t,t,t,t]],0)}isInBoard(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==YJ.NONE}isPiece(e){return this.getPieceAt(e).isPlayer()}getScores(){const e=[14,14];for(let t=0;t<9;t++)for(let n=0;n<9;n++)this.getPieceAtXY(n,t)===YJ.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===YJ.ONE&&(e[0]=e[0]-1);return e}}class lQ{}class uQ extends lQ{constructor(e,t){super(),this.coord=new GJ(e,t)}}class hQ extends uQ{constructor(e,t,n){if(super(e.x,e.y),this.dir=t,this.lastPiece=n,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!")}static fromSingleCoord(e,t){try{return OG.success(new hQ(e,t,vw.empty()))}catch(n){return OG.failure(n.message)}}static fromDoubleCoord(e,t,n){const r=[e,t];LG.sortByDescending(r,hQ.sortCoord);const i=r[1].getDirectionToward(r[0]).get(),s=KJ.factory.fromDelta(i.x,i.y);if(s.isFailure())return OG.failure("Invalid direction");const o=s.get();return r[1].getDistance(r[0])>2?OG.failure("Distance between first coord and last coord is too great"):o.equals(n)?hQ.fromSingleCoord(r[1],n):o.getOpposite().equals(n)?hQ.fromSingleCoord(r[0],n):OG.success(new hQ(r[1],n,vw.of(r[0])))}static sortCoord(e){return 9*e.y+e.x}toString(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}isSingleCoord(){return this.lastPiece.isAbsent()}equals(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}hQ.encoder=new class extends BY{maxValue(){return 104831}encodeNumber(e){const t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;{const n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}}decodeNumber(e){const t=e%8;e=(e-t)/8;const n=KJ.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;const s=new GJ(i,r);if(0===e)return hQ.fromSingleCoord(s,n).get();{const t=(e=(e-1)/2)%9,r=(e=(e-t)/9)%9;e=(e-r)/9;const i=new GJ(r,t);return hQ.fromDoubleCoord(s,i,n).get()}}};var dQ=(()=>(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(dQ||(dQ={})),dQ))();class fQ{constructor(){this.map=[],this.isImmutable=!1}makeImmutable(){this.isImmutable=!0}get(e){for(const t of this.map)if(yw(t.key,e))return vw.of(t.value);return vw.empty()}forEach(e){for(let t=0;t<this.map.length;t++)e(this.getByIndex(t))}getByIndex(e){return this.map[e]}putAll(e){this.checkImmutability("putAll");for(const t of e.map)this.put(t.key,t.value)}checkImmutability(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}put(e,t){this.checkImmutability("put");for(const n of this.map)if(yw(n.key,e)){const e=n.value;return n.value=t,vw.of(e)}return this.map.push({key:e,value:t}),vw.empty()}containsKey(e){return this.map.some(t=>yw(t.key,e))}size(){return this.map.length}listKeys(){return this.map.map(e=>e.key)}getKeySet(){return new sQ(this.listKeys())}filter(e){const t=new fQ;for(const n of this.map)e(n.key,n.value)&&t.set(n.key,n.value);return t}replace(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}set(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}delete(e){this.checkImmutability("delete");for(let t=0;t<this.map.length;t++)if(yw(this.map[t].key,e)){const e=this.map[t].value,n=this.map.slice(0,t),r=this.map.slice(t+1);return this.map=n.concat(r),e}throw new Error('No Value to delete for key "'+e.toString()+'"!')}getCopy(){const e=new this.constructor;for(const t of this.listKeys())e.set(t,this.get(t).get());return e}equals(e){const t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;for(const r of t){const t=this.get(r).get(),n=e.get(r);if(MG(n.isPresent(),"value is absent in a map even though its key is present!"),!1===yw(t,n.get()))return!1}return!0}}class pQ extends fQ{reverse(){const e=new pQ;for(const t of this.listKeys()){const n=this.get(t).get();if(e.containsKey(n))e.get(n).get().add(t);else{const r=new sQ;r.add(t),e.set(n,r)}}return e}}let gQ=(()=>{class e{}return e.createdNodes=0,e.minimaxTime=0,e})();class mQ{constructor(e,t=vw.empty(),n=vw.empty(),r){if(this.gameState=e,this.mother=t,this.move=n,this.minimaxCreator=r,this.childs=vw.empty(),this.hopedValue=new fQ,this.ownValue=new fQ,this.possibleMoves=new fQ,this.ownValue=new fQ,null!=r){const e=r.getBoardValue(this);this.ownValue.set(r.name,e),this.hopedValue.set(r.name,e.value)}gQ.createdNodes++,pw(mQ.VERBOSE||!1,"creating "+this.myToString())}static getScoreStatus(e){const t=!1;return e===Number.MAX_SAFE_INTEGER||e===Number.MIN_SAFE_INTEGER?(pw(mQ.VERBOSE||t,"VICTORY"),dQ.VICTORY):e===Number.MIN_SAFE_INTEGER+1?(pw(mQ.VERBOSE||t,"PRE_VICTORY_MIN"),dQ.PRE_VICTORY):e===Number.MAX_SAFE_INTEGER-1?(pw(mQ.VERBOSE||t,"PRE_VICTORY_MAX"),dQ.PRE_VICTORY):(pw(mQ.VERBOSE||t,"DEFAULT"),dQ.DEFAULT)}findBestMove(e,t,n=!1,r=!0){const i=(new Date).getTime();let s=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);for(;s.gameState.turn>this.gameState.turn+1;)s=s.mother.get(),e--;return gQ.minimaxTime+=(new Date).getTime()-i,s.move.get()}alphaBeta(e,t,n,r,i,s){if(e<1)return pw(mQ.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+e),this;if(r.ruler.getGameStatus(this).isEndGame)return pw(mQ.VERBOSE||!1,"isLeaf-EndGame("+mQ.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+e),this;const o=this.getPossibleMoves(r);MG(o.length>0,"Minimax "+r.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=vw.of([]));let a=[];const c=this.gameState.getCurrentPlayer();let l=c===VY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER;const u=c===VY.ZERO?(e,t)=>e<t:(e,t)=>e>t;for(const f of o){const o=this.getOrCreateChild(f,r).alphaBeta(e-1,t,n,r,i,s),h=o.getHopedValue(r);if(u(h,l)||0===a.length?(l=h,a=[o]):h===l&&a.push(o),s&&u(l,c===VY.ZERO?t:n))break;c===VY.ZERO?n=Math.min(l,n):t=Math.max(l,t)}let h;h=i?a[Math.floor(Math.random()*a.length)]:a[0];const d=h.hopedValue.get(r.toString()).get();return this.hopedValue.put(r.toString(),d),h}getPossibleMoves(e){const t=this.possibleMoves.get(e.name);if(t.isAbsent()){const t=e.getListMoves(this);return this.possibleMoves.set(e.name,new sQ(t)),t}return t.get().toList()}getOrCreateChild(e,t){let n=this.getSonByMove(e);if(n.isAbsent()){const r=t.ruler.isLegal(e,this.gameState);MG(r.isSuccess(),"The minimax has accepted an illegal move, this should not happen.");const i=t.ruler.applyLegalMove(e,this.gameState,r.get());n=vw.of(new mQ(i,vw.of(this),vw.of(e),t)),this.childs.get().push(n.get())}return n.get()}getSonByMove(e){MG(this.childs.isPresent(),"Cannot get son of uncalculated node");for(const t of this.childs.get())if(t.move.isPresent()&&t.move.equalsValue(e))return vw.of(t);return vw.empty()}getInitialNode(){let e=this;for(;e.mother.isPresent();)e=e.mother.get();return e}getHopedValue(e){return this.hopedValue.get(e.name).get()}getOwnValue(e){const t=this.ownValue.get(e.name);if(t.isAbsent()){const t=e.getBoardValue(this);return this.ownValue.set(e.name,t),t}return t.get()}myToString(){let e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}hasMoves(){return this.childs.isPresent()}countDescendants(){if(this.childs.isAbsent())return 0;let e=this.childs.get().length;for(const t of this.childs.get())e+=t.countDescendants();return e}}mQ.VERBOSE=!1,mQ.minimaxes=new fQ;class yQ{constructor(e,t){this.isEndGame=e,this.winner=t}static getVictory(e){return MG(e!==VY.NONE,"getVictory called with Player.NONE"),e===VY.ZERO?yQ.ZERO_WON:yQ.ONE_WON}static getDefeat(e){return MG(e!==VY.NONE,"getVictory called with Player.NONE"),e===VY.ZERO?yQ.ONE_WON:yQ.ZERO_WON}toBoardValue(){return this.winner!==VY.NONE?this.winner.getVictoryValue():0}}yQ.ZERO_WON=new yQ(!0,VY.ZERO),yQ.ONE_WON=new yQ(!0,VY.ONE),yQ.DRAW=new yQ(!0,VY.NONE),yQ.ONGOING=new yQ(!1,VY.NONE);class vQ{constructor(e){this.stateType=e,this.setInitialBoard()}choose(e){const t=!1;pw(t,"Rules.choose: "+e.toString()+" was proposed");const n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){pw(t,"Rules.choose: current node has moves");const r=this.node.getSonByMove(e);if(r.isPresent())return MG(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),pw(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(pw(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return pw(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;pw(t,"Rules.choose: Move is legal, let's apply it");const r=this.applyLegalMove(e,this.node.gameState,n.get()),i=new mQ(r,vw.of(this.node),vw.of(e));return this.node=i,!0}setInitialBoard(){if(null==this.node){const e=this.stateType.getInitialState();mQ.ruler=this,this.node=new mQ(e)}else this.node=this.node.getInitialNode()}applyMoves(e,t,n){let r=0;for(const i of e){const e=n(i),s=this.isLegal(e,t);MG(s.isSuccess(),"Can't create state from invalid moves ("+r+"): "+s.toString()+"."),t=this.applyLegalMove(e,t,s.get()),r++}return t}}let _Q=(()=>{class e{}return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=()=>$localize`You cannot move more than 3 of your pieces!`,e.NOT_ENOUGH_PIECE_TO_PUSH=()=>$localize`You don't have enough pieces to push that group!`,e.CANNOT_PUSH_YOUR_OWN_PIECES=()=>$localize`You cannot push this piece because it is blocked by one of yours!`,e.MUST_ONLY_TRANSLATE_YOUR_PIECES=()=>$localize`This line contains pieces of your opponent or empty spaces, which is forbidden.`,e.TRANSLATION_IMPOSSIBLE=()=>$localize`This move is impossible, some landing spaces are occupied.`,e.LINE_AND_COORD_NOT_ALIGNED=()=>$localize`This space is not aligned with the current line.`,e})();class CQ extends vQ{static isLegal(e,t){const n=this.getFirstPieceValidity(e,t);return n.isFailure()?n.toFailedFallible():e.isSingleCoord()?CQ.isLegalPush(e,t):CQ.isLegalSideStep(e,t)}static getFirstPieceValidity(e,t){const n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?kG.failure(tQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===YJ.ofPlayer(t.getCurrentOpponent())?kG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):kG.SUCCESS}static isLegalPush(e,t){let n=1,r=e.coord.getNext(e.dir);const i=YJ.ofPlayer(t.getCurrentPlayer()),s=YJ.EMPTY,o=t.getCopiedBoard();for(o[e.coord.y][e.coord.x]=s;n<=3&&t.isOnBoard(r)&&t.getPieceAt(r)===i;)n++,r=r.getNext(e.dir);return n>3?OG.failure(_Q.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(r)||(o[r.y][r.x]=i,t.getPieceAt(r)===s)?OG.success(o):CQ.isLegalRealPush(r,e,t,n,o)}static isLegalRealPush(e,t,n,r,i){let s=0;const o=YJ.ofPlayer(n.getCurrentOpponent()),a=YJ.ofPlayer(n.getCurrentPlayer());for(;s<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)s++,e=e.getNext(t.dir);return s>=r?OG.failure(_Q.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===YJ.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===a)?OG.failure(_Q.CANNOT_PUSH_YOUR_OWN_PIECES()):OG.success(i)}static isLegalSideStep(e,t){let n=e.lastPiece.get();const r=e.coord.getDirectionToward(n).get();n=n.getNext(r);let i=e.coord;const s=YJ.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();for(;!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==s)return OG.failure(_Q.MUST_ONLY_TRANSLATE_YOUR_PIECES());const n=i.getNext(e.dir);if(o[i.y][i.x]=YJ.EMPTY,n.isInRange(9,9)){if(t.isPiece(n))return OG.failure(_Q.TRANSLATION_IMPOSSIBLE());t.getPieceAt(n)===YJ.EMPTY&&(o[n.y][n.x]=s)}i=i.getNext(r)}return OG.success(o)}static getGameStatus(e){const t=e.gameState.getScores();return t[0]>5?yQ.ZERO_WON:t[1]>5?yQ.ONE_WON:yQ.ONGOING}applyLegalMove(e,t,n){return new cQ(n,t.turn+1)}isLegal(e,t){return CQ.isLegal(e,t)}getGameStatus(e){return CQ.getGameStatus(e)}}class EQ extends nQ{getListMoves(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<9;i++)for(let e=0;e<9;e++){const s=new GJ(e,i);if(!1!==n.getPieceAt(s).is(r))for(const e of KJ.factory.all){const r=hQ.fromSingleCoord(s,e).get();if(this.isAcceptablePush(r,n)){t.push(r);for(const r of KJ.factory.all)for(let i=1;i<=2&&!r.equals(e);i++){const o=s.getNext(r,i);if(!o.isInRange(9,9))break;{const r=hQ.fromDoubleCoord(s,o,e).get();CQ.isLegal(r,n).isSuccess()&&t.push(r)}}}}}return new sQ(t).toList()}isAcceptablePush(e,t){const n=t.getScores(),r=CQ.isLegal(e,t);if(r.isSuccess()){const e=t.getCurrentOpponent().value;return!(new cQ(r.get(),t.turn+1).getScores()[e]>n[e])}return!1}getBoardValue(e){const t=CQ.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState.getScores();return new rQ(n[1]-n[0])}}class wQ{constructor(e,t,n){this.title=e,this.instruction=t,this.state=n,this.previousMove=vw.empty()}static fromMove(e,t,n,r,i,s){return new SQ(e,t,n,r,i,s)}static forClick(e,t,n,r,i,s){return new OQ(e,t,n,r,i,s)}static anyMove(e,t,n,r,i){return new PQ(e,t,n,r,i)}static fromPredicate(e,t,n,r,i,s){return new TQ(e,t,n,r,i,s)}static informational(e,t,n){return new IQ(e,t,n)}isMove(){return!1}isAnyMove(){return!1}isClick(){return!1}isPredicate(){return!1}isInformation(){return!1}hasSolution(){return!1}withPreviousMove(e){return this.previousMove=vw.of(e),this}}class bQ extends wQ{constructor(e,t,n,r,i){super(e,t,n),this.solution=r,this.successMessage=i}hasSolution(){return!0}getSolution(){return this.solution}getSuccessMessage(){return this.successMessage}}class SQ extends bQ{constructor(e,t,n,r,i,s){super(e,t,n,r[0],i),this.acceptedMoves=r,this.failureMessage=s,MG(r.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational")}isMove(){return!0}getFailureMessage(){return this.failureMessage}}class PQ extends bQ{constructor(e,t,n,r,i){super(e,t,n,r,i)}isAnyMove(){return!0}}class OQ extends wQ{constructor(e,t,n,r,i,s){super(e,t,n),this.acceptedClicks=r,this.successMessage=i,this.failureMessage=s}isClick(){return!0}getSuccessMessage(){return this.successMessage}getFailureMessage(){return this.failureMessage}}class TQ extends bQ{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this.predicate=i}isPredicate(){return!0}}class IQ extends wQ{isInformation(){return!0}}const kQ=YJ.EMPTY,AQ=YJ.NONE,NQ=YJ.ZERO,MQ=YJ.ONE;class xQ{constructor(){this.tutorial=[wQ.informational($localize`Initial board and goal of the game`,$localize`At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!`,cQ.getInitialState()),wQ.anyMove($localize`Moving a piece`,$localize`At each turn, move one, two, or three pieces either along their line, or on their side.
        For your moves you can therefore choose between up to 6 directions.
        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).
        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>
        You're playing Dark, make any move!`,cQ.getInitialState(),hQ.fromSingleCoord(new GJ(2,6),KJ.UP).get(),$localize`Congratulations!`),wQ.fromMove($localize`Pushing`,$localize`To push one opponent piece, you must move at least two of your pieces.
        To push two opponent pieces, you must move three of your pieces.
        If one of your pieces is in the way, it will be impossible to push.
        You cannot move more than three pieces.<br/><br/>
        Only one push towards the right is possible here, find it. (You're playing Dark).`,new cQ([[AQ,AQ,AQ,AQ,kQ,NQ,NQ,MQ,MQ],[AQ,AQ,AQ,kQ,kQ,kQ,kQ,kQ,kQ],[AQ,AQ,kQ,NQ,NQ,NQ,MQ,NQ,kQ],[AQ,kQ,kQ,kQ,kQ,kQ,kQ,kQ,kQ],[kQ,kQ,kQ,kQ,NQ,NQ,NQ,MQ,MQ],[kQ,kQ,kQ,kQ,kQ,kQ,kQ,kQ,AQ],[kQ,kQ,kQ,kQ,NQ,MQ,kQ,AQ,AQ],[kQ,kQ,kQ,NQ,kQ,kQ,AQ,AQ,AQ],[kQ,kQ,NQ,kQ,kQ,AQ,AQ,AQ,AQ]],0),[hQ.fromSingleCoord(new GJ(4,4),KJ.RIGHT).get()],$localize`Congratulations! You know everything you need to start a game!`,$localize`Failed!`)]}}function RQ(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",6),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onPieceClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Oa("id","piece_",e,"_",t,""),ua("ngClass",n.getPieceClasses(e,t)),ra("cx",n.getCenterBy(e,t).x)("cy",n.getCenterBy(e,t).y)("r",.5*n.SPACE_SIZE)}}function DQ(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"polyline",4),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onCaseClick(t,n)}),fa(),aa(2,RQ,1,6,"circle",5),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Oa("id","case_",t,"_",r,""),ua("ngClass",i.getSquareClasses(t,r)),ra("points",i.getHexaCoordsBy(t,r)),Ts(1),ua("ngIf",i.isPiece(n))}}function LQ(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,DQ,3,5,"g",3),fa()),2&e){const e=t.$implicit,n=ba(2);Ts(1),ua("ngIf",n.isBoard(e))}}function FQ(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,LQ,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function BQ(e,t){1&e&&(Cn(),da(0,"marker",7),pa(1,"polygon",8),fa()),2&e&&Pa("id","arrowhead_",t.$implicit.dir.toString(),"")}function VQ(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),pa(1,"line",9),da(2,"line",10),Ca("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),da(3,"polygon",11),Ca("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),Pa("id","line_start_",e.dir.toString(),""),ra("x1",e.startCenter.x)("y1",e.startCenter.y)("x2",e.middle.x)("y2",e.middle.y),Ts(1),Pa("id","line_end_",e.dir.toString(),""),ra("x1",e.middle.x)("y1",e.middle.y)("x2",e.landingCenter.x)("y2",e.landingCenter.y),Ts(1),Pa("id","direction_",e.dir.toString(),""),ra("transform",e.transformation)}}class UQ{constructor(e,t,n,r,i,s){this.startCenter=e,this.middle=t,this.landingCenter=n,this.landing=r,this.dir=i,this.transformation=s}}let $Q=(()=>{class e extends ZJ{constructor(e){super(e),this.moveds=[],this.directions=[],this.selecteds=[],this.rules=new CQ(cQ),this.availableMinimaxes=[new EQ(this.rules,"Dummy")],this.encoder=hQ.encoder,this.tutorial=(new xQ).tutorial,this.scores=vw.of([0,0]),this.SPACE_SIZE=30,this.hexaLayout=new JJ(this.SPACE_SIZE,new GJ(-8*this.SPACE_SIZE,2*this.SPACE_SIZE),XJ.INSTANCE),this.updateBoard()}updateBoard(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=vw.of(this.rules.node.gameState.getScores())}hidePreviousMove(){this.moveds=[]}cancelMoveAttempt(){this.directions=[],this.selecteds=[]}showPreviousMove(){const e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}showPushingMove(e){const t=this.rules.node.mother.get().gameState;let n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}showSideStepMove(e){let t=e.lastPiece.get();const n=e.coord.getDirectionToward(t).get();t=t.getNext(n);let r=e.coord;for(;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}onPieceClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#piece_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=n.rules.node.gameState.getCurrentOpponent();return n.hexaBoard[t][e].is(i)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t)})()}opponentClick(e,t){var n=this;return dw(function*(){return(yield n.tryChoosingDirection(e,t)).isSuccess()?kG.SUCCESS:n.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE())})()}firstClick(e,t){var n=this;return dw(function*(){return n.selecteds=[new GJ(e,t)],n.showPossibleDirections(),kG.SUCCESS})()}showPossibleDirections(){this.directions=[],this.showDirection(1===this.selecteds.length)}showDirection(e){const t=this.rules.node.gameState,n=YJ.ofPlayer(t.getCurrentPlayer()),r=this.selecteds[0],i=this.selecteds[this.selecteds.length-1];for(const s of KJ.factory.all){let o,a=r.getNext(s,1);if(t.isOnBoard(a)&&t.getPieceAt(a)===n){if(e)continue;if(a=i.getNext(s,1),t.isOnBoard(a)&&t.getPieceAt(a)===n)continue}if(o=e?hQ.fromSingleCoord(r,s).get():hQ.fromDoubleCoord(r,i,s).get(),this.rules.isLegal(o,t).isSuccess()){const e=this.getCenterAt(r),t=this.getCenterAt(a),n=this.getMiddleOfArrow(s,a,t),i=t.x+" "+t.y,o=KJ.getAngle(s)+150,c=new UQ(e,n,t,a,s,"rotate("+o+" "+i+") translate("+i+")");this.directions.push(c)}}}getMiddleOfArrow(e,t,n){const r=t.getPrevious(e),i=this.getCenterAt(r);return new GJ(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}isBoard(e){return e!==YJ.NONE}isPiece(e){return e!==YJ.EMPTY}secondClick(e,t){var n=this;return dw(function*(){const r=n.selecteds[0],i=new GJ(e,t);if(i.equals(r))return n.cancelMoveAttempt(),kG.SUCCESS;if(!1===i.isHexagonallyAlignedWith(r))return n.cancelMoveAttempt(),n.firstClick(e,t);const s=i.getDistance(r);if(s>2)return n.cancelMove(_Q.CANNOT_MOVE_MORE_THAN_THREE_PIECES());const o=r.getDirectionToward(i).get();n.selecteds=[r];for(let e=0;e<s;e++)n.selecteds.push(r.getNext(o,e+1));if(3===n.selecteds.length){const r=n.selecteds[1],i=n.rules.node.gameState.getCurrentPlayer();if(!1===n.hexaBoard[r.y][r.x].is(i))return n.cancelMoveAttempt(),n.firstClick(e,t)}return n.showPossibleDirections(),kG.SUCCESS})()}thirdClick(e,t){var n=this;return dw(function*(){const r=new GJ(e,t),i=n.selecteds[0];if(r.equals(i))return n.deselectExtremity(!0);const s=n.selecteds[n.selecteds.length-1];return r.equals(s)?n.deselectExtremity(!1):3===n.selecteds.length&&r.equals(n.selecteds[1])?(n.cancelMoveAttempt(),kG.SUCCESS):n.tryExtension(r,i,s)})()}tryExtension(e,t,n){var r=this;return dw(function*(){const i=zJ.factory.fromMove(t,e);if(i.isSuccess()){const s=zJ.factory.fromMove(n,e);if(i.equals(s)){const i=t.getDistance(e),s=n.getDistance(e);return 2===Math.max(i,s)?(r.selecteds.push(e),LG.sortByDescending(r.selecteds,hQ.sortCoord),r.showPossibleDirections(),kG.SUCCESS):r.cancelMove(_Q.CANNOT_MOVE_MORE_THAN_THREE_PIECES())}}const s=r.cancelMove(_Q.LINE_AND_COORD_NOT_ALIGNED());return yield r.firstClick(e.x,e.y),s})()}deselectExtremity(e){var t=this;return dw(function*(){return t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),kG.SUCCESS})()}chooseDirection(e){var t=this;return dw(function*(){const n=t.canUserPlay("#direction_"+e.toString());return n.isFailure()?t.cancelMove(n.getReason()):t._chooseDirection(e)})()}_chooseDirection(e){var t=this;return dw(function*(){const n=t.rules.node.gameState;let r;const i=t.selecteds[0];return r=1===t.selecteds.length?hQ.fromSingleCoord(i,e).get():hQ.fromDoubleCoord(i,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(r,n,t.scores.get())})()}onCaseClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#case_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.tryChoosingDirection(e,t)})()}tryChoosingDirection(e,t){var n=this;return dw(function*(){const r=new GJ(e,t);for(const e of n.directions)if(e.landing.equals(r))return n._chooseDirection(e.dir);return kG.failure("not a direction")})()}getSquareClasses(e,t){const n=new GJ(e,t),r=[];return this.moveds.some(e=>e.equals(n))&&r.push("moved"),r}getPieceClasses(e,t){const n=new GJ(e,t),r=VY.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(e=>e.equals(n))&&i.push("highlighted"),i}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-abalone"]],features:[Ho],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,FQ,2,1,"g",1),da(2,"defs"),aa(3,BQ,2,1,"marker",2),fa(),aa(4,VQ,4,12,"g",1),fa()),2&e&&(Ts(1),ua("ngForOf",t.hexaBoard),Ts(2),ua("ngForOf",t.directions),Ts(1),ua("ngForOf",t.directions))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class zQ{constructor(e){this.x=e}static from(e){switch(e){case 0:return zQ.ZERO;case 1:return zQ.ONE;case 2:return zQ.TWO;default:return MG(3===e,"Invalid Apagos Coord "+e),zQ.THREE}}equals(e){return this.x===e.x}}zQ.ZERO=new zQ(0),zQ.ONE=new zQ(1),zQ.TWO=new zQ(2),zQ.THREE=new zQ(3);let HQ=(()=>{class e{}return e.PIECE_SHOULD_MOVE_DOWNWARD=()=>$localize`Pieces should only move downward!`,e.CANNOT_LAND_ON_A_FULL_SQUARE=()=>$localize`That square is already full, you cannot put a piece in it!`,e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=()=>$localize`You have no pieces in that square, select one that contains at least one of your pieces!`,e.NO_PIECE_REMAINING_TO_DROP=()=>$localize`There are no remaining pieces of that color to drop!`,e.NO_POSSIBLE_TRANSFER_REMAINS=()=>$localize`There is no possible transfer from that square!`,e})();class GQ extends lQ{constructor(e,t,n){super(),this.landing=e,this.piece=t,this.starting=n}static drop(e,t){return fw.getNonNullable(GQ.ALL_MOVES.find(n=>n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(vw.empty())))}static transfer(e,t){if(e.x<=t.x)return OG.failure(HQ.PIECE_SHOULD_MOVE_DOWNWARD());const n=fw.getNonNullable(GQ.ALL_MOVES.find(n=>n.landing.equals(t)&&n.piece.equals(vw.empty())&&n.starting.equals(vw.of(e))));return OG.success(n)}isDrop(){return this.piece.isPresent()}toString(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}equals(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}GQ.ALL_MOVES=[new GQ(zQ.ZERO,vw.of(VY.ZERO),vw.empty()),new GQ(zQ.ONE,vw.of(VY.ZERO),vw.empty()),new GQ(zQ.TWO,vw.of(VY.ZERO),vw.empty()),new GQ(zQ.THREE,vw.of(VY.ZERO),vw.empty()),new GQ(zQ.ZERO,vw.of(VY.ONE),vw.empty()),new GQ(zQ.ONE,vw.of(VY.ONE),vw.empty()),new GQ(zQ.TWO,vw.of(VY.ONE),vw.empty()),new GQ(zQ.THREE,vw.of(VY.ONE),vw.empty()),new GQ(zQ.TWO,vw.empty(),vw.of(zQ.THREE)),new GQ(zQ.ONE,vw.empty(),vw.of(zQ.THREE)),new GQ(zQ.ZERO,vw.empty(),vw.of(zQ.THREE)),new GQ(zQ.ONE,vw.empty(),vw.of(zQ.TWO)),new GQ(zQ.ZERO,vw.empty(),vw.of(zQ.TWO)),new GQ(zQ.ZERO,vw.empty(),vw.of(zQ.ONE))],GQ.encoder=new class extends BY{maxValue(){return GQ.ALL_MOVES.length}encodeNumber(e){const t=GQ.ALL_MOVES.findIndex(t=>t.equals(e));return MG(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}decodeNumber(e){return MG(e<GQ.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),GQ.ALL_MOVES[e]}};class qQ{constructor(e){this.containing=e}static from(e,t,n){if(e+t>n)return OG.failure("invalid starting space");const r=new fQ;r.set(VY.ZERO,e),r.set(VY.ONE,t),r.set(VY.NONE,n),r.makeImmutable();const i=new qQ(r);return OG.success(i)}isFull(){return this.count(VY.ZERO)+this.count(VY.ONE)>=this.count(VY.NONE)}count(e){return this.containing.get(e).get()}addPiece(e){MG(e!==VY.NONE,"should not call ApagosSquare.addPiece with Player.NONE");let t=this.count(VY.ZERO),n=this.count(VY.ONE);const r=this.count(VY.NONE);return e===VY.ZERO?t++:n++,qQ.from(t,n,r).get()}substractPiece(e){MG(e!==VY.NONE,"should not call ApagosSquare.addPiece with Player.NONE");let t=this.count(VY.ZERO),n=this.count(VY.ONE);const r=this.count(VY.NONE);return e===VY.ZERO?t--:n--,qQ.from(t,n,r).get()}getDominatingPlayer(){const e=this.count(VY.ZERO),t=this.count(VY.ONE);return e>t?VY.ZERO:t>e?VY.ONE:VY.NONE}equals(e){return this.containing.equals(e.containing)}}let WQ=(()=>{class e extends oQ{constructor(e,t,n){super(e),this.board=t,this.remaining=n,this.remaining.makeImmutable()}static getInitialState(){return e.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}static fromRepresentation(t,n,r,i){const s=[];for(let e=0;e<4;e++){const t=qQ.from(n[0][e],n[1][e],n[2][e]).get();s.push(t)}const o=new fQ;return o.set(VY.ZERO,r),o.set(VY.ONE,i),new e(t,s,o)}getPieceAt(e){return this.board[e.x]}updateAt(t,n){const r=[];for(let e=0;e<4;e++)r.push(t.x===e?n:this.board[e]);const i=this.getRemainingCopy();return new e(this.turn,r,i)}getRemainingCopy(){return this.remaining.getCopy()}getRemaining(e){return this.remaining.get(e).get()}equals(e){return this.turn===e.turn&&LG.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}return e.PIECES_PER_PLAYER=10,e})();class jQ extends vQ{static get(){return null==jQ.singleton&&(jQ.singleton=new jQ(WQ)),mQ.ruler=this.singleton,this.singleton}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}applyLegalDrop(e,t){const n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);const i=new WQ(t.turn+1,t.board,n),s=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(s);if(e.landing===zQ.THREE)return i.updateAt(e.landing,o);{const t=zQ.from(e.landing.x+1),n=i.getPieceAt(t);return i.updateAt(e.landing,n).updateAt(t,o)}}applyLegalTransfer(e,t){const n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),s=t.getPieceAt(e.landing).addPiece(n);let o=t.updateAt(r,i);return o=o.updateAt(e.landing,s),new WQ(o.turn+1,o.board,o.remaining)}isLegal(e,t){return t.getPieceAt(e.landing).isFull()?OG.failure(HQ.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}isLegalDrop(e,t){return t.getRemaining(e.piece.get())<=0?OG.failure(HQ.NO_PIECE_REMAINING_TO_DROP()):OG.success(void 0)}isLegalSlideDown(e,t){const n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?OG.failure(HQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):OG.success(void 0)}getGameStatus(e){const t=e.gameState;for(let r=0;r<4;r++)if(!1===t.getPieceAt(zQ.from(r)).isFull())return yQ.ONGOING;const n=t.getPieceAt(zQ.THREE).getDominatingPlayer();return yQ.getVictory(n)}}class ZQ extends nQ{getListMoves(e){const t=e.gameState;return GQ.ALL_MOVES.filter(function(e){return jQ.get().isLegal(e,t).isSuccess()})}getBoardValue(e){const t=jQ.get().getGameStatus(e);if(t.isEndGame)return rQ.fromWinner(t.winner);const n=e.gameState.board[3].getDominatingPlayer();return new rQ(n.getScoreModifier())}}class YQ{constructor(){this.tutorial=[wQ.informational($localize`Initial board and goal of the game`,$localize`At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!`,WQ.getInitialState()),wQ.anyMove($localize`Drop`,$localize`There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You play Light.<br/><br/>Drop a piece on one of those three squares.`,WQ.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),GQ.drop(zQ.ZERO,VY.ZERO),$localize`Congratulations!`),wQ.fromPredicate($localize`Transfer`,$localize`The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!`,WQ.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),GQ.transfer(zQ.TWO,zQ.ZERO).get(),(e,t)=>e.isDrop()?kG.failure($localize`This move is a drop, please do a transfer!`):kG.SUCCESS,$localize`Congratulations!`),wQ.fromPredicate($localize`Victory`,$localize`When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!`,WQ.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),GQ.drop(zQ.TWO,VY.ONE),(e,t)=>e.isDrop()?e.piece.equalsValue(VY.ONE)?kG.SUCCESS:kG.failure($localize`You actively made your opponent win!`):kG.failure($localize`Wrong choice, your opponent will win in the next turn no matter which piece is dropped!`),$localize`Congratulations!`)]}}function KQ(e,t){if(1&e&&(Cn(),pa(0,"circle",5)),2&e){const e=t.$implicit,n=ba();ra("cx",(e+1)*n.PIECE_RADIUS)("cy",n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function JQ(e,t){if(1&e){const e=ya();Cn(),da(0,"polygon",7),Ca("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.Player.ZERO)}),fa()}if(2&e){const e=ba().index,t=ba();Pa("id","dropArrow_zero_",e,""),ua("ngClass",t.getArrowClasses(e,t.Player.ZERO)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.Player.ZERO))}}function QQ(e,t){if(1&e){const e=ya();Cn(),da(0,"polygon",7),Ca("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.Player.ONE)}),fa()}if(2&e){const e=ba().index,t=ba();Pa("id","dropArrow_one_",e,""),ua("ngClass",t.getArrowClasses(e,t.Player.ONE)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.Player.ONE))}}function XQ(e,t){if(1&e){const e=ya();Cn(),ga(0),da(1,"circle",8),Ca("click",function(){Gt(e);const t=ba().index;return ba().onSquareClick(t)}),fa(),ma()}if(2&e){const e=t.$implicit,n=ba(),r=n.index,i=n.$implicit,s=ba();Ts(1),Ta("id","square_",r,"_piece_",e,"_out_of_",i.count(s.Player.NONE),""),ua("ngClass",s.getPieceClasses(r,e,i)),ra("cx",s.getCircleCenter(r,e,i).x)("cy",s.getCircleCenter(r,e,i).y)}}function eX(e,t){if(1&e){const e=ya();Cn(),ga(0),aa(1,JQ,1,4,"polygon",6),aa(2,QQ,1,4,"polygon",6),da(3,"rect",7),Ca("click",function(){const t=Gt(e).index;return ba().onSquareClick(t)}),fa(),aa(4,XQ,2,6,"ng-container",3),ma()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),ua("ngIf",r.canDisplayArrow(n,r.Player.ZERO)),Ts(1),ua("ngIf",r.canDisplayArrow(n,r.Player.ONE)),Ts(1),Pa("id","square_",n,""),ua("ngClass",r.getSquareClasses(n)),ra("x",n*r.SPACE_SIZE)("y",(5-n)*r.SPACE_SIZE*.25)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ua("ngForOf",r.range(e.count(r.Player.NONE)))}}function tX(e,t){if(1&e&&(Cn(),pa(0,"circle",9)),2&e){const e=t.$implicit,n=ba();ra("cx",4*n.SPACE_SIZE-(e+1)*n.PIECE_RADIUS)("cy",2.25*n.SPACE_SIZE+3*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}let nX=(()=>{class e extends jJ{constructor(t){super(t),this.Player=VY,this.ARROW_COORD=e.getArrowCoord(),this.PIECES_PER_PLAYER=WQ.PIECES_PER_PLAYER,this.selectedPiece=vw.empty(),this.leftPiece=vw.empty(),this.droppedPiece=vw.empty(),this.displayableArrow=[],this.rules=new jQ(WQ),this.availableMinimaxes=[new ZQ(this.rules,"ApagosDummyMinimax")],this.encoder=GQ.encoder,this.tutorial=(new YQ).tutorial,this.PIECE_RADIUS=200/(this.PIECES_PER_PLAYER+1),this.updateBoard()}static getArrowCoord(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}cancelMoveAttempt(){this.selectedPiece=vw.empty(),this.showPossibleDrops()}updateBoard(){const e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(VY.ZERO).get(),this.remainingOne=e.remaining.get(VY.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}hideLastMove(){this.movedSquare=[],this.droppedPiece=vw.empty(),this.leftPiece=vw.empty(),this.selectedPiece=vw.empty()}showLastMove(){const e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}showLastDrop(e){const t=e.piece.get();let n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));const r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=vw.of({square:n,piece:r})}getLowestPlayerPiece(e,t){const n=e.count(t);return t===VY.ZERO?n-1:e.count(VY.NONE)-n}showLastTransfer(e){const t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=vw.of({square:r,piece:i});const s=e.landing.x,o=this.getLowestPlayerPiece(this.board[s],n);this.droppedPiece=vw.of({square:s,piece:o})}showPossibleDrops(){this.displayableArrow=[];const e=this.rules.node.gameState;for(let t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(VY.ZERO).get()>0&&this.displayableArrow.push({x:t,player:VY.ZERO}),e.remaining.get(VY.ONE).get()>0&&this.displayableArrow.push({x:t,player:VY.ONE}))}getCircleCenter(e,t,n){const r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(VY.NONE))return new GJ(r,i);const s=n.count(VY.NONE),o=2*t*Math.PI/s-Math.PI/2,a=.3*this.SPACE_SIZE,c=a*Math.cos(o),l=a*Math.sin(o);return new GJ(r+c,i+l)}canDisplayArrow(e,t){return this.displayableArrow.some(n=>n.x===e&&n.player.equals(t))}getArrowClasses(e,t){return[this.getPlayerClass(t)]}getArrowTransform(e,t){let n=t===VY.ZERO?0:.5*this.SPACE_SIZE;return n+=e*this.SPACE_SIZE,"translate("+n+", "+(3-e)*this.SPACE_SIZE*.25+")"}getSquareClasses(e){const t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}onArrowClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#dropArrow_"+(t===VY.ZERO?"zero":"one")+"_"+e);if(r.isFailure())return n.cancelMove(r.getReason());const i=zQ.from(e);let s;if(n.selectedPiece.isPresent()){const e=n.selectedPiece.get().square;s=GQ.transfer(zQ.from(e),i).get()}else s=GQ.drop(i,t);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e,t,n){const r={square:e,piece:t},i=[];let s=n.count(VY.ZERO),o=n.count(VY.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===VY.ZERO?s++:o++}const a=n.count(VY.NONE)-(o+s),c=this.getPieceColor(t,s,a);return""!==c&&i.push(c),i}getPieceColor(e,t,n){return e<t?"player0":e>=t+n?"player1":""}onSquareClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#square_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.selectedPiece.isPresent()&&t.selectedPiece.get().square===e)return t.cancelMoveAttempt(),kG.SUCCESS;const r=t.rules.node.gameState.getCurrentPlayer(),i=t.board[e];return i.count(r)<=0?t.cancelMove(HQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=vw.of({square:e,piece:t.getLowestPlayerPiece(i,r)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(HQ.NO_POSSIBLE_TRANSFER_REMAINS()):kG.SUCCESS)})()}showAndGetPossibleTranfers(){this.displayableArrow=[];let e=this.selectedPiece.get().square-1;const t=this.rules.node.gameState.getCurrentPlayer();for(;0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-apagos"]],features:[Ho],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,KQ,1,3,"circle",1),da(2,"g",2),aa(3,eX,5,9,"ng-container",3),fa(),aa(4,tX,1,3,"circle",4),fa()),2&e&&(Ts(1),ua("ngForOf",t.range(t.remainingZero)),Ts(1),ra("transform","translate(0, "+2*t.PIECE_RADIUS+")"),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.range(t.remainingOne)))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),rX=(()=>{class e extends jJ{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class iX extends aQ{constructor(e,t,n){super(e,t),this.captured=n}static getInitialState(){const e=LG.createTable(6,2,4);return new iX(e,0,[0,0])}getCapturedCopy(){return[this.captured[0],this.captured[1]]}}let sX=(()=>{class e{}return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=()=>$localize`You cannot distribute from the opponent's home.`,e.MUST_CHOOSE_NONEMPTY_HOUSE=()=>$localize`You should choose a non-empty house to distribute.`,e.SHOULD_DISTRIBUTE=()=>$localize`You should distribute but you do not.`,e})(),oX=(()=>{class e extends vQ{applyLegalMove(t,n,r){pw(e.VERBOSE,{called:"AwaleRules.applyLegalMove",move:t,state:n});const i=t.x,s=n.getCurrentPlayer().value,o=n.getCurrentPlayer().getOpponent().value;let a=n.getCopiedBoard();const c=e.distribute(i,s,a);if(c.y===s)return new iX(a,n.turn+1,n.captured);{let t=[0,0];const r=LG.copyBiArray(a);return t[s]=e.capture(c.x,o,s,a),t[s]>0&&e.isStarving(o,a)&&(a=r,t=[0,0]),e.isStarving(s,a)&&!1===e.canDistribute(o,a)&&(t[o]+=e.mansoon(o,a)),t[0]+=n.captured[0],t[1]+=n.captured[1],new iX(a,n.turn+1,t)}}static mansoon(e,t){let n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}static isLegal(t,n){const r=n.getCurrentPlayer().value,i=n.getCurrentPlayer().getOpponent().value,s=t.x;if(0===n.getPieceAtXY(s,r))return OG.failure(sX.MUST_CHOOSE_NONEMPTY_HOUSE());const o=e.isStarving(i,n.board),a=!1===e.doesDistribute(s,r,n.board);return o&&a?OG.failure(sX.SHOULD_DISTRIBUTE()):OG.success(void 0)}isLegal(t,n){return e.isLegal(t,n)}static doesDistribute(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}static canDistribute(t,n){for(let r=0;r<6;r++)if(e.doesDistribute(r++,t,n))return!0;return!1}static isStarving(e,t){let n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}static distribute(e,t,n){const r=e,i=t;let s=n[t][e];for(n[t][e]=0;s>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,s--);return new GJ(e,t)}static capture(e,t,n,r){MG(t!==n,"AwaleRules.capture called with wrong values of x and player");let i=r[t][e];if(i<2||i>3)return 0;let s=0,o=-1,a=-1;0===n&&(o=1,a=6);do{s+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==a&&(2===i||3===i));return s}static getGameStatus(e){const t=e.gameState;return t.captured[0]>24?yQ.ZERO_WON:t.captured[1]>24?yQ.ONE_WON:24===t.captured[0]&&24===t.captured[1]?yQ.DRAW:yQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class aX extends lQ{constructor(e){super(),this.x=e}static from(e){switch(e){case 0:return aX.ZERO;case 1:return aX.ONE;case 2:return aX.TWO;case 3:return aX.THREE;case 4:return aX.FOUR;default:return MG(5===e,"Invalid x for AwaleMove: "+e),aX.FIVE}}equals(e){return e===this||e.x===this.x}toString(){return"AwaleMove("+this.x+")"}}aX.ZERO=new aX(0),aX.ONE=new aX(1),aX.TWO=new aX(2),aX.THREE=new aX(3),aX.FOUR=new aX(4),aX.FIVE=new aX(5),aX.encoder=new class extends BY{maxValue(){return 5}encodeNumber(e){return e.x}decodeNumber(e){return aX.from(e)}};class cX extends nQ{getListMoves(e){const t=[],n=e.gameState,r=n.turn%2;let i,s=0;do{0!==n.getPieceAtXY(s,r)&&(i=aX.from(s),oX.isLegal(i,n).isSuccess()&&(i=aX.from(s),t.push(i))),s++}while(s<6);return this.orderMoves(e,t)}orderMoves(e,t){const n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return LG.sortByDescending(t,t=>{const i=e.gameState.getCopiedBoard(),s=i[n][t.x],o=oX.distribute(t.x,n,i);let a,c=0;return o.y===n?(a=0,s<=6&&(c=10)):a=oX.capture(o.x,r,n,i),100*a+c-s}),t}getBoardValue(e){const t=oX.getGameStatus(e);if(t.isEndGame)return rQ.fromWinner(t.winner);const n=e.gameState.getCapturedCopy();return new rQ(n[1]-n[0])}}class lX{constructor(){this.tutorial=[wQ.anyMove($localize`Sowing`,$localize`Awalé is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.
         Let's see how seeds are sown.
         As you're playing first, the 6 houses on the top are yours.<br/><br>
         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house.`,iX.getInitialState(),aX.ZERO,$localize`Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.
        This is how seeds are sown:
        one by one from the house next to the one they come from, clockwise.`),wQ.anyMove($localize`Big sowing`,$localize`You are now the second player (on the bottom).
        When there are enough seeds to make a full turn, something else happens.<br/><br/>
        Sow the house that contains 12 seeds.`,new iX([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),aX.ONE,$localize`See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds).`),wQ.fromMove($localize`Simple capture`,$localize`After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.
         Then, the player looks at the preceding house:
         if it is still in the opponent's side and contains two or three seeds, they are also captured.
         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>
         You are the second player, try to capture some pieces!`,new iX([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[aX.ZERO],$localize`Well done! This was a simple capture, now let us see how to make multiple captures.`,$localize`Failed. Try again and sow from the leftmost house.`),wQ.fromMove($localize`Multiple captures`,$localize`By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.
        As these are consecutive houses, all seeds in them will be captured.<br/><br/>
        Capture them.`,new iX([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[aX.ZERO],$localize`Nice, you win 3 points from the first house, and 2 from the second!`,$localize`Failed. Try again.`),wQ.fromMove($localize`Interrupted capture`,$localize`By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>
        Do it.`,new iX([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[aX.ZERO],$localize`Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house.`,$localize`Failed. Try again.`),wQ.fromMove($localize`Capture on the other side only`,$localize`Try to capture the two leftmost houses of the opponent.`,new iX([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[aX.ONE],$localize`Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!`,$localize`You have only captured one house, try again!`),wQ.fromMove($localize`Do not starve`,$localize`You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>
        Try it.`,new iX([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[aX.ZERO],$localize`Sadly, you cannot capture here, otherwise the opponent could not play after you.
        When this happens, the move can be made, but no capture takes place!`,$localize`Failed. Try again.`),wQ.anyMove($localize`Feeding is mandatory`,$localize`You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>
        Go ahead!`,new iX([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),aX.THREE,$localize`Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.
        It is often a good way to have easy captures!`),wQ.anyMove($localize`End of the game`,$localize`A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>
         Sow the house on the top right.`,new iX([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),aX.FIVE,$localize`Also, as soon as on player cannot play, the other player captures all the seeds in its own side.
         Here, it was the first player's turn, and the second player has taken all the remaining seeds.`)]}}function uX(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",4),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"text",5),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),Da(3),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","click_",n,"_",r,""),ua("ngClass",i.getSquareClasses(n,r)),ra("cx",50+100*n)("cy",50+120*r),Ts(1),ra("x",50+100*n)("y",66+120*r),Ts(1),Fa(" ",e," ")}}function hX(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,uX,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let dX=(()=>{class e extends rX{constructor(e){super(e),this.last=vw.empty(),this.captured=[],this.moved=[],this.scores=vw.of([0,0]),this.rules=new oX(iX),this.availableMinimaxes=[new cX(this.rules,"AwaleMinimax")],this.encoder=aX.encoder,this.tutorial=(new lX).tutorial,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState;this.scores=vw.of(e.getCapturedCopy()),this.hidePreviousMove();const t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){const n=e.getCurrentOpponent().value;this.last=vw.of(new GJ(t.get().x,n)),this.showPreviousMove()}else this.last=vw.empty()}hidePreviousMove(){this.captured=[],this.moved=[]}showPreviousMove(){const e=this.rules.node.mother.get().gameState;for(let t=0;t<=1;t++)for(let n=0;n<=5;n++){const r=new GJ(n,t),i=this.board[t][n],s=e.getPieceAt(r);this.last.equalsValue(r)||(i<s?this.captured.push(r):i>s&&this.moved.push(r))}}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(t!==n.rules.node.gameState.getCurrentPlayer().value)return n.cancelMove(sX.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME());n.last=vw.empty();const i=aX.from(e);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}getSquareClasses(e,t){const n=new GJ(e,t);return this.captured.some(e=>e.equals(n))?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(e=>e.equals(n))?["moved"]:[]}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-awale-component"]],features:[Ho],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),pa(1,"rect",1),aa(2,hX,2,1,"g",2),pa(3,"line",3),fa()),2&e&&(Ts(2),ua("ngForOf",t.board))},directives:[Ud,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class fX extends uQ{constructor(e,t){if(super(e.x,e.y),e.equals(t))throw new Error(tQ.MOVE_CANNOT_BE_STATIC());this.end=t}static getEncoder(e,t,n){return new class extends BY{constructor(){super(...arguments),this.shiftAX=t,this.shiftDY=this.shiftAX*e,this.shiftDX=this.shiftDY*t}maxValue(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}decodeNumber(r){const i=r%t;r/=t;const s=new GJ((r-=r%1)%e,i);r/=e;const o=(r-=r%1)%t;r/=t;const a=new GJ((r-=r%1)%e,o);return n(a,s)}}}length(){return this.coord.getDistance(this.end)}getDirection(){return zJ.factory.fromMove(this.coord,this.end)}}let pX=(()=>{class e{}return e.LANDING_ON_OCCUPIED_CASE=()=>$localize`You cannot land on an occupied square.`,e.THRONE_IS_LEFT_FOR_GOOD=()=>$localize`Once you left the central throne, you cannot return to it.`,e.SOLDIERS_CANNOT_SIT_ON_THRONE=()=>$localize`Soldiers cannot sit on the throne.`,e.SOMETHING_IN_THE_WAY=()=>$localize`Something is in the way.`,e.MOVE_MUST_BE_ORTHOGONAL=()=>$localize`Tafl moves must be orthogonal.`,e})();class gX extends fX{constructor(e,t){if(super(e,t),e.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(t.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+t.toString()+".");const n=e.getDirectionToward(t);if(n.isFailure()||n.get().isDiagonal())throw new Error(pX.MOVE_MUST_BE_ORTHOGONAL())}equals(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"TaflMove("+this.coord+"->"+this.end+")"}}class mX extends gX{static of(e,t){return new mX(e,t)}static from(e,t){try{const n=new mX(e,t);return OG.success(n)}catch(n){return OG.failure(n.message)}}getMaximalDistance(){return 7}}mX.encoder=fX.getEncoder(7,7,mX.of);const yX={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:VY.ZERO};class vX{constructor(e,t){this.owner=e,this.king=t}isKing(){return this.king}getOwner(){return this.owner}}vX.UNOCCUPIED=new vX(VY.NONE,!1),vX.PLAYER_ONE_KING=new vX(VY.ONE,!0),vX.INVADERS=new vX(VY.ZERO,!1),vX.DEFENDERS=new vX(VY.ONE,!1);class _X{constructor(e){this.value=e}}_X.NONE=new _X("NONE"),_X.OPPONENT=new _X("OPPONENT"),_X.PLAYER=new _X("PLAYER");class CX extends aQ{isCentralThrone(e){return e.equals(this.getCentralThrone())}getCentralThrone(){const e=(this.board.length-1)/2;return new GJ(e,e)}getRelativeOwner(e,t){const n=this.getAbsoluteOwner(t);let r;return r=n===VY.NONE?_X.NONE:e===n?_X.PLAYER:_X.OPPONENT,r}getAbsoluteOwner(e){return this.getPieceAt(e).getOwner()}}class EX extends CX{static getInitialState(){const e=vX.UNOCCUPIED,t=vX.INVADERS,n=vX.DEFENDERS;return new EX([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,n,e,e,e],[t,t,n,vX.PLAYER_ONE_KING,n,t,t],[e,e,e,n,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}from(e,t){return new EX(e,t)}}let wX=(()=>{class e extends vQ{constructor(e,t,n){super(e),this.config=t,this.generateMove=n}isLegal(t,n){pw(e.VERBOSE,{tablutRules_isLegal:{move:t,state:n}});const r=n.getCurrentPlayer(),i=this.getMoveValidity(r,t,n);return i.isFailure()?OG.failure(i.getReason()):OG.success(void 0)}getMoveValidity(e,t,n){const r=n.getRelativeOwner(e,t.coord);if(r===_X.NONE)return kG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE());if(r===_X.OPPONENT)return kG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==_X.NONE)return kG.failure(pX.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return kG.failure(pX.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return kG.failure(pX.THRONE_IS_LEFT_FOR_GOOD())}const i=t.coord.getDirectionToward(t.end).get(),s=t.coord.getOrthogonalDistance(t.end);let o=t.coord.getNext(i);for(let a=1;a<s;a++){if(n.getPieceAt(o)!==vX.UNOCCUPIED)return kG.failure(pX.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return kG.SUCCESS}isThrone(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}isExternalThrone(e){const t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}tryCapture(e,t,n,r){const i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===_X.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):vw.empty()}captureKing(e,t,n,r){const i=t.getNext(n),{backCoord:s,back:o,backInRange:a,left:c,leftCoord:l,right:u,rightCoord:h}=this.getSurroundings(i,n,e,r);return!1===a?this.captureKingAgainstTheWall(c,u,i):o===_X.NONE&&this.isThrone(r,s)?this.captureKingAgainstThrone(s,i,c,u):o===_X.PLAYER?this.captureKingWithAtLeastASandwich(r,i,c,l,u,h):vw.empty()}getSurroundings(e,t,n,r){const i=e.getNext(t),s=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=s?r.getRelativeOwner(n,i):_X.NONE,a=e.getLeft(t),c=a.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,a):_X.NONE,l=e.getRight(t),u=l.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,l):_X.NONE;return{backCoord:i,back:o,backInRange:s,leftCoord:a,left:c,rightCoord:l,right:u}}captureKingAgainstTheWall(t,n,r){let i=t===_X.PLAYER?1:0;return i+=n===_X.PLAYER?1:0,2===i&&this.config.BORDER_CAN_SURROUND_KING?(pw(e.VERBOSE||!1,"king captured by 3 invaders against 1 border"),vw.of(r)):vw.empty()}captureKingAgainstThrone(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return vw.of(t)}else{const e=r===_X.PLAYER,i=n===_X.PLAYER||e;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&i)return vw.of(t)}return vw.empty()}capturePawn(t,n,r,i){const s=!1,o=n.getNext(r),a=o.getNext(r);let c=_X.NONE;return a.isInRange(this.config.WIDTH,this.config.WIDTH)&&(c=i.getRelativeOwner(t,a)),c===_X.NONE?!1===this.isThrone(i,a)?(pw(e.VERBOSE||s,"cannot capture a pawn without an ally; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),vw.empty()):(pw(e.VERBOSE||s,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),vw.of(o)):c===_X.PLAYER?(pw(e.VERBOSE||s,"pawn captured by 2 opponents; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),vw.of(o)):(pw(e.VERBOSE||s,"no captures; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),vw.empty())}captureKingWithAtLeastASandwich(t,n,r,i,s,o){if(!1===this.kingTouchCentralThrone(t,n)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return vw.of(n);const a=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,c=this.isThrone(t,i),l=r===_X.PLAYER||c&&a,u=this.isThrone(t,o);return l&&(s===_X.PLAYER||u&&a)?(pw(e.VERBOSE||!1,"king captured by 4 invaders"),vw.of(n)):vw.empty()}kingTouchCentralThrone(e,t){const n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}applyLegalMove(t,n){pw(e.VERBOSE,{TablutRules_applyLegalMove:{move:t,state:n}});const r=n.turn,i=n.getCopiedBoard(),s=n.getCurrentPlayer(),o=t.coord,a=t.end;i[a.y][a.x]=i[o.y][o.x],i[o.y][o.x]=vX.UNOCCUPIED;for(const e of HJ.ORTHOGONALS){const r=this.tryCapture(s,t.end,e,n);r.isPresent()&&(i[r.get().y][r.get().x]=vX.UNOCCUPIED)}return n.from(i,r+1)}getGameStatus(e){const t=this.getWinner(e.gameState);return t.isPresent()?yQ.getVictory(t.get()):yQ.ONGOING}getWinner(e){const t=!1,n=this.getKingCoord(e);if(n.isAbsent())return pw(t,"The king is dead, victory to invader"),vw.of(this.getInvader());const r=n.get();return this.isExternalThrone(r)?(pw(t,"The king escape, victory to defender"),vw.of(this.getDefender())):this.isPlayerImmobilized(VY.ZERO,e)?(pw(t,"Zero has no move, victory to one"),vw.of(VY.ONE)):this.isPlayerImmobilized(VY.ONE,e)?(pw(t,"One has no move, victory to zero"),vw.of(VY.ZERO)):(pw(t,"no victory"),vw.empty())}getKingCoord(t){pw(e.VERBOSE,{TablutRules_getKingCoord:{state:t,con:this.config}});for(let e=0;e<this.config.WIDTH;e++)for(let n=0;n<this.config.WIDTH;n++)if(t.getPieceAtXY(n,e).isKing())return vw.of(new GJ(n,e));return vw.empty()}getInvader(){return this.config.INVADER}getDefender(){return this.config.INVADER.getOpponent()}isPlayerImmobilized(e,t){return 0===this.getPlayerListMoves(e,t).length}getPlayerListMoves(t,n){const r=[],i=this.getPlayerListPawns(t,n);pw(e.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:t,state:n}});for(const e of i){const t=this.getPossibleDestinations(e,n);for(const n of t){const t=this.generateMove(e,n);r.push(t)}}return r}getPlayerListPawns(e,t){const n=[];for(let r=0;r<this.config.WIDTH;r++)for(let i=0;i<this.config.WIDTH;i++){const s=new GJ(i,r);t.getAbsoluteOwner(s)===e&&n.push(s)}return n}getPossibleDestinations(e,t){const n=[];let r;for(const i of HJ.ORTHOGONALS){r=e.getNext(i,1);let s=!1;for(;r.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(r)===VY.NONE?this.isExternalThrone(r)?t.getPieceAt(e).isKing()&&n.push(r):t.isCentralThrone(r)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&n.push(r):n.push(r):s=!0,r=r.getNext(i,1)}return n}}return e.VERBOSE=!1,e})();class bX extends wX{constructor(){super(EX,yX,mX.of)}static get(){return null==bX.singleton&&(bX.singleton=new bX),mQ.ruler=this.singleton,bX.singleton}}class SX extends rX{constructor(e,t,n){super(e),this.VERBOSE=t,this.generateMove=n,this.NONE=vX.UNOCCUPIED,this.captureds=[],this.chosen=new GJ(-1,-1),this.lastMove=vw.empty()}getViewBox(){const e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}updateBoard(){pw(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove()}showPreviousMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState.getCurrentOpponent();for(const n of HJ.ORTHOGONALS){const r=this.lastMove.get().end.getNext(n,1);if(r.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){const n=e.getRelativeOwner(t,r)===_X.OPPONENT,i=this.rules.node.gameState.getPieceAt(r)===vX.UNOCCUPIED;n&&i&&this.captureds.push(r)}}}onClick(e,t){var n=this;return dw(function*(){pw(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")");const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t)})()}chooseDestination(e,t){var n=this;return dw(function*(){pw(n.VERBOSE,"TaflComponent.chooseDestination");const r=n.chosen,i=new GJ(e,t),s=n.generateMove(r,i);return s.isSuccess()?(n.cancelMove(),yield n.chooseMove(s.get(),n.rules.node.gameState)):n.cancelMove(s.getReason())})()}choosePiece(e,t){return pw(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===vX.UNOCCUPIED?this.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new GJ(e,t),pw(this.VERBOSE,"selected piece = ("+e+", "+t+")"),kG.SUCCESS):this.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE())}pieceBelongToCurrentPlayer(e,t){const n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new GJ(e,t);return n.getRelativeOwner(r,i)===_X.PLAYER}cancelMoveAttempt(){this.chosen=new GJ(-1,-1)}isThrone(e,t){return this.rules.isThrone(this.rules.node.gameState,new GJ(e,t))}isCentralThrone(e,t){return!1===this.rules.node.gameState.isCentralThrone(new GJ(e,t))}getPieceClasses(e,t){const n=[],r=new GJ(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}getRectClasses(e,t){const n=[],r=new GJ(e,t);if(this.captureds.some(e=>e.equals(r)))n.push("captured");else if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;(r.equals(e)||r.equals(t))&&n.push("moved")}return n}getClickables(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new GJ(n,t));return e}isClickable(e,t){return this.pieceBelongToCurrentPlayer(e,t)}isInvader(e,t){return this.board[t][e]===vX.INVADERS}isKing(e,t){return this.board[t][e].isKing()}getKingPolyline(e,t){return 85+100*e+" "+(85+100*t)+" "+(30+100*e)+" "+(30+100*t)+" "+(50+100*e)+" "+(10+100*t)+" "+(70+100*e)+" "+(30+100*t)+" "+(15+100*e)+" "+(85+100*t)}}class PX extends nQ{getListMoves(e){pw(!1,{TaflMinimax_getListMoves:{node:e}});const t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}orderMoves(e,t){const n=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?LG.sortByDescending(t,e=>-e.end.getOrthogonalDistance(n)):LG.sortByDescending(t,e=>e.coord.equals(n)?this.ruler.isExternalThrone(e.end)?2:1:0),t}getBoardValue(e){const t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new rQ(n.get().getVictoryValue());const r=this.ruler.getPlayerListPawns(VY.ZERO,t).length,i=this.ruler.getPlayerListPawns(VY.ONE,t).length;let s=[1,2][this.ruler.config.INVADER.value];s*=VY.ZERO.getScoreModifier();let o=[2,1][this.ruler.config.INVADER.value];return o*=VY.ONE.getScoreModifier(),new rQ(r*s+i*o)}}class OX{constructor(e,t){this.directThreats=e,this.mover=t}equals(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}class TX extends OX{constructor(e,t){super(new sQ([e]),t),this.directThreat=e,this.mover=t}}class IX extends sQ{constructor(e){if(super(),this.map=[],this.values=[],void 0!==e)for(const t of e)this.add(t)}add(e){const t=this.toFields(e);let n=this.map;for(const i of t[0])void 0===n[i]&&(n[i]=[]),n=n[i];const r=t[1];return void 0===n[r]&&(n[r]=!0,this.values.push(e),!0)}contains(e){const t=this.toFields(e);let n=this.map;for(const r of t[0]){if(void 0===n[r])return!1;n=n[r]}return void 0!==n[t[1]]}[Symbol.iterator](){return this.values.values()}}class kX extends IX{toFields(e){return[[e.y],e.x]}}class AX extends PX{constructor(e,t){super(e,t),this.width=this.ruler.config.WIDTH,this.maxInfluence=16*(2*this.width-2),this.scoreByThreatenedPiece=16*this.maxInfluence+1,this.scoreBySafePiece=16*this.scoreByThreatenedPiece+1}getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState,r=vX.UNOCCUPIED;let i=0;const s=this.getPiecesMap(n),o=this.getThreatMap(n,s),a=this.filterThreatMap(o,n);for(const c of[VY.ZERO,VY.ONE])for(const e of s.get(c).get())if(a.get(e).isPresent())i+=c.getScoreModifier()*this.scoreByThreatenedPiece;else{i+=c.getScoreModifier()*this.scoreBySafePiece;let t=0;for(const i of HJ.ORTHOGONALS){let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&n.getPieceAt(s)===r;)t++,s=s.getNext(i,1)}i+=t*c.getScoreModifier()}return new rQ(i)}getPiecesMap(e){const t=vX.UNOCCUPIED,n=new fQ,r=[],i=[];for(let s=0;s<this.width;s++)for(let n=0;n<this.width;n++){const o=new GJ(n,s);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===VY.ZERO?r.push(o):i.push(o))}return n.set(VY.ZERO,new kX(r)),n.set(VY.ONE,new kX(i)),n}getThreatMap(e,t){const n=new fQ;for(const r of[VY.ZERO,VY.ONE])for(const i of t.get(r).get()){const t=this.getThreats(i,e);this.isThreatReal(i,e,t)&&n.set(i,new sQ(t))}return n}getThreats(e,t){const n=t.getAbsoluteOwner(e).getOpponent(),r=[];for(const i of HJ.ORTHOGONALS){const s=e.getPrevious(i,1);if(this.isAThreat(s,t,n)){const o=[];for(const r of HJ.ORTHOGONALS){if(r===i.getOpposite())continue;let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&t.getPieceAt(s)===vX.UNOCCUPIED;)s=s.getNext(r);s.isInRange(this.width,this.width)&&t.getAbsoluteOwner(s)===n&&!1===e.getNext(i,1).equals(s)&&o.push(s)}r.push(new TX(s,new kX(o)))}}return r}isAThreat(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==VY.ONE&&t.getPieceAt(e)!==vX.UNOCCUPIED))}isThreatReal(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;for(const r of n)if(r.mover.size()>0)return!0;return!1}filterThreatMap(e,t){const n=new fQ,r=e.listKeys(),i=r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentPlayer()),s=new kX(r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentOpponent()));for(const o of i){const t=e.get(o).get(),r=[];for(const e of t)if(!1===s.contains(e.directThreat)){const t=[];for(const n of e.mover)!1===s.contains(n)&&t.push(n);t.length>0&&r.push(new TX(e.directThreat,new kX(t)))}r.length>0&&n.set(o,new sQ(r))}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}class NX extends AX{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=vX.UNOCCUPIED;let s=0;const o=this.getPiecesMap(n),a=this.getThreatMap(n,o),c=this.filterThreatMap(a,n);for(const l of[VY.ZERO,VY.ONE]){const e=new kX;for(const t of o.get(l).get())if(c.get(t).isPresent())s+=l.getScoreModifier()*NX.SCORE_BY_THREATENED_PIECE;else{s+=l.getScoreModifier()*NX.SCORE_BY_SAFE_PIECE;for(const s of HJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=NX.CONTROL_VALUE[t.y][t.x];s+=l.getScoreModifier()*e}}return new rQ(s)}}NX.SCORE_BY_THREATENED_PIECE=530,NX.SCORE_BY_SAFE_PIECE=16*NX.SCORE_BY_THREATENED_PIECE+1,NX.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];class MX extends NX{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=vX.UNOCCUPIED;let s=0,o=0,a=0;const c=this.getPiecesMap(n),l=this.getThreatMap(n,c),u=this.filterThreatMap(l,n);for(const d of[VY.ZERO,VY.ONE]){const e=new kX;for(const t of c.get(d).get())if(u.get(t).isPresent())o+=d.getScoreModifier();else{s+=d.getScoreModifier();for(const s of HJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=NX.CONTROL_VALUE[t.y][t.x];a+=d.getScoreModifier()*e}}const h=this.getStepForEscape(n);return new rQ(531*h*17*17+531*s*17+531*o+a)}getStepForEscape(e){const t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}_getStepForEscape(e,t,n,r){const i=this.getNextGen(e,n,r);return 0===i.length?vw.empty():i.some(e=>this.ruler.isExternalThrone(e))?vw.of(t):(t++,r.push(...i),this._getStepForEscape(e,t,i,r))}getNextGen(e,t,n){const r=[];for(const i of t)for(const t of HJ.ORTHOGONALS){let s=i.getNext(t,1);for(;s.isInRange(this.ruler.config.WIDTH,this.ruler.config.WIDTH)&&e.getPieceAt(s)===vX.UNOCCUPIED;)n.every(e=>!1===e.equals(s))&&r.push(s),s=s.getNext(t,1)}return r}}MX.SCORE_BY_THREATENED_PIECE=530,MX.SCORE_BY_SAFE_PIECE=16*NX.SCORE_BY_THREATENED_PIECE+1,MX.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];const xX=vX.UNOCCUPIED,RX=vX.INVADERS,DX=vX.DEFENDERS,LX=vX.PLAYER_ONE_KING;class FX{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne.`,EX.getInitialState()),wQ.anyMove($localize`Moving`,$localize`All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move.`,EX.getInitialState(),mX.of(new GJ(3,1),new GJ(1,1)),$localize`Congratulations!`),wQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new EX([[xX,xX,xX,RX,xX,xX,xX],[xX,xX,xX,RX,xX,xX,xX],[RX,xX,xX,DX,xX,xX,xX],[xX,xX,DX,LX,DX,RX,RX],[xX,xX,RX,xX,xX,xX,xX],[xX,xX,xX,DX,xX,RX,xX],[xX,xX,xX,RX,xX,xX,xX]],1),[mX.of(new GJ(3,5),new GJ(2,5))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),wQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new EX([[xX,xX,xX,RX,xX,xX,xX],[xX,xX,RX,xX,xX,xX,xX],[xX,xX,xX,DX,xX,xX,xX],[RX,DX,xX,xX,DX,RX,RX],[xX,DX,xX,xX,xX,xX,xX],[xX,RX,xX,LX,xX,RX,xX],[xX,xX,xX,RX,xX,xX,xX]],12),[mX.of(new GJ(2,1),new GJ(3,1)),mX.of(new GJ(3,0),new GJ(3,1))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),wQ.fromMove($localize`Capturing the king on his throne`,$localize`To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king.`,new EX([[xX,xX,xX,xX,xX,xX,xX],[xX,xX,xX,DX,xX,xX,xX],[xX,xX,xX,RX,xX,xX,xX],[xX,RX,xX,LX,RX,xX,xX],[xX,xX,xX,RX,xX,xX,xX],[xX,DX,xX,xX,xX,xX,xX],[xX,xX,xX,xX,xX,xX,xX]],72),[mX.of(new GJ(1,3),new GJ(2,3))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),wQ.fromMove($localize`Capturing the king next to his throne`,$localize`Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king.`,new EX([[xX,xX,RX,xX,xX,xX,xX],[xX,xX,xX,RX,xX,xX,xX],[xX,xX,xX,LX,RX,xX,xX],[xX,RX,DX,xX,DX,xX,xX],[xX,xX,xX,RX,xX,xX,xX],[xX,xX,xX,xX,xX,xX,xX],[xX,xX,xX,xX,xX,xX,xX]],72),[mX.of(new GJ(2,0),new GJ(2,2))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`),wQ.fromMove($localize`Capturing the king far from his throne`,$localize`When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king.`,new EX([[xX,xX,xX,xX,xX,xX,xX],[xX,xX,xX,xX,xX,xX,xX],[xX,RX,xX,RX,xX,xX,xX],[RX,xX,xX,xX,DX,xX,xX],[xX,xX,xX,DX,xX,xX,xX],[xX,xX,xX,xX,xX,xX,xX],[xX,LX,xX,RX,xX,xX,xX]],72),[mX.of(new GJ(3,6),new GJ(2,6))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function BX(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",6),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function VX(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",7),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function UX(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,BX,1,1,"polyline",4),aa(2,VX,1,1,"ng-template",null,5,Du),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ua("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function $X(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(3,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(4,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(5,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function zX(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"polyline",13),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();Ts(1),ra("points",n.getKingPolyline(e,t))}}function HX(e,t){if(1&e){const e=ya();Cn(),da(0,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(1,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(3,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function GX(e,t){if(1&e&&(Cn(),aa(0,zX,2,1,"g",9),aa(1,HX,4,16,"ng-template",null,12,Du)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ua("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function qX(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",8),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,$X,6,20,"g",9),aa(3,GX,3,2,"ng-template",null,10,Du),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ua("ngClass",r.getPieceClasses(t,n)),ra("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),ua("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function WX(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",2),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,UX,4,2,"g",3),aa(3,qX,5,6,"g",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Oa("id","click_",e,"_",n,""),ua("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ua("ngIf",r.board[n][e]===r.NONE&&r.isThrone(e,n)),Ts(1),ua("ngIf",r.board[n][e]!==r.NONE)}}function jX(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,WX,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function ZX(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",14),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Oa("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let YX=(()=>{class e extends SX{constructor(e){super(e,!1,mX.from),this.rules=bX.get(),this.availableMinimaxes=[new PX(this.rules,"DummyBot"),new AX(this.rules,"Piece > Influence"),new NX(this.rules,"Piece > Control"),new MX(this.rules,"Escape > Piece > Control")],this.encoder=mX.encoder,this.tutorial=(new FX).tutorial}ngOnInit(){this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-brandhub"]],features:[Ho],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,jX,2,1,"g",1),aa(2,ZX,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.getClickables()))},directives:[Ud,Bd,zd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),KX=(()=>{class e extends jJ{constructor(){super(...arguments),this.SPACE_SIZE=50}getTriangleCornerCoords(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}getTriangleCoordinate(e,t){return this.getTriangleCornerCoords(e,t).map(e=>e.x+","+e.y).reduce((e,t)=>e+","+t)}getDownwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new GJ(.5*this.SPACE_SIZE*e,i);return[o,new GJ(n,s),new GJ(r,i),o]}getUpwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new GJ(.5*this.SPACE_SIZE*e,s);return[o,new GJ(n,i),new GJ(r,s),o]}getPyramidCoordinate(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}getDownwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}getUpwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),JX=(()=>{class e{}return e.INVALID_DISTANCE=()=>$localize`Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is.`,e.NOT_ENOUGH_TILES_TO_EXCHANGE=()=>$localize`You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it.`,e.FIRST_CLICK_SHOULD_NOT_BE_NULL=()=>$localize`Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles.`,e.CANNOT_CAPTURE_FROM_EMPTY=()=>$localize`You cannot capture from an empty space.`,e.CANNOT_CAPTURE_OWN_PIECES=()=>$localize`You cannot capture your own pieces.`,e})();class QX{constructor(e,t){this.direction=e,this.str=t}static fromCoords(e,t){const n=e.getVectorToward(t),r=QX.STEPS.findIndex(e=>e.direction.equals(n));if(-1===r)throw new Error(JX.INVALID_DISTANCE());return QX.STEPS[r]}toInt(){return QX.STEPS.findIndex(e=>e.direction.equals(this.direction))}equals(e){return this===e}toString(){return this.str}}QX.LEFT=new QX(new VJ(-2,0),"LEFT"),QX.UP_LEFT=new QX(zJ.UP_LEFT,"UP_LEFT"),QX.UP_RIGHT=new QX(zJ.UP_RIGHT,"UP_RIGHT"),QX.RIGHT=new QX(new VJ(2,0),"RIGHT"),QX.DOWN_LEFT=new QX(zJ.DOWN_LEFT,"DOWN_LEFT"),QX.DOWN_RIGHT=new QX(zJ.DOWN_RIGHT,"DOWN_RIGHT"),QX.STEPS=[QX.LEFT,QX.UP_LEFT,QX.UP_RIGHT,QX.RIGHT,QX.DOWN_LEFT,QX.DOWN_RIGHT];class XX extends lQ{constructor(e,t,n,r){super(),this.start=e,this.step=t,this.landingCoord=n,this.capture=r}static fromMovement(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");const n=new GJ(e.x+t.direction.x,e.y+t.direction.y);if(n.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new XX(vw.of(e),vw.of(t),vw.of(n),vw.empty())}static fromTilesExchange(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new XX(vw.empty(),vw.empty(),vw.empty(),vw.of(e))}static fromCoordToCoord(e,t){const n=QX.fromCoords(e,t);return XX.fromMovement(e,n)}isTileExchange(){return this.capture.isPresent()}toString(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}equals(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}XX.encoder=new class extends BY{maxValue(){return 1035}encodeNumber(e){if(e.isTileExchange()){const t=e.capture.get().y;return 10*e.capture.get().x+t}{const t=e.start.get().y,n=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*n+t}}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?XX.fromTilesExchange(new GJ(n,t)):XX.fromMovement(new GJ(n,t),QX.STEPS[e-1])}};class e1{static getNeighbors(e){let t;const n=new GJ(e.x-1,e.y),r=new GJ(e.x+1,e.y);return t=(e.x+e.y)%2==1?[n,r,new GJ(e.x,e.y-1)]:[n,r,new GJ(e.x,e.y+1)],t}static getFakeNeighbors(e){return new GJ(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}static getCommonNeighbor(e,t){const n=e1.getNeighbors(e),r=e1.getNeighbors(t);let i=0;for(;i<n.length;){const e=n[i];let t=0;for(;t<r.length;){if(e.equals(r[t]))return vw.of(e);t++}i++}return vw.empty()}}class t1 extends aQ{static getEmptyNeighbors(e,t,n){const r=[];for(const i of e1.getNeighbors(t))i.isInRange(e[0].length,e.length)&&e[i.y][i.x]===n&&r.push(i);return r}getEmptyNeighboors(e,t){return t1.getEmptyNeighbors(this.board,e,t)}}class n1 extends t1{constructor(e,t,n,r){super(e,t),this.tiles=n,this.captures=r}static getTilesUpperLeftCoord(e){const t=e.x-e.x%3;let n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new GJ(t,n)}static getPresentNeighboorEntrances(e){return[new GJ(e.x+1,e.y-1),new GJ(e.x+3,e.y+0),new GJ(e.x+3,e.y+1),new GJ(e.x+1,e.y+2),new GJ(e.x-1,e.y+1),new GJ(e.x-1,e.y+0)].filter(n1.isInRange)}static getInitialState(){const e=YJ.EMPTY,t=YJ.NONE,n=YJ.ZERO,r=YJ.ONE;return new n1([[t,t,t,t,t,t,n,e,n,t,t,t,t,t,t],[t,t,t,e,e,n,e,e,e,n,e,e,t,t,t],[e,r,e,r,e,e,n,e,n,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[e,n,e,n,e,e,e,e,e,e,e,n,e,n,e],[n,e,e,e,n,e,e,e,e,e,n,e,e,e,n],[e,n,e,n,e,e,r,e,r,e,e,n,e,n,e],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t]],0,[0,0],[0,0])}applyLegalMovement(e){pw(n1.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});const t=e.start.get(),n=e.landingCoord.get(),r=this.getCopiedBoard();return r[n.y][n.x]=YJ.ofPlayer(this.getCurrentPlayer()),r[t.y][t.x]=YJ.EMPTY,new n1(r,this.turn,this.tiles,this.captures)}doMovementCaptures(e){pw(n1.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});const t=this.getCapturedNeighbors(e.landingCoord.get());let n=this;for(const r of t)n=n.capture(r);return n}getCapturedNeighbors(e){const t=this.getCurrentOpponent();return e1.getNeighbors(e).filter(e=>!e.isNotInRange(15,10)&&!!this.getPieceAt(e).is(t)&&this.isSurrounded(e))}isSurrounded(e){return 0===this.getEmptyNeighboors(e,YJ.EMPTY).length}capture(e){pw(n1.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});const t=this.getCopiedBoard(),n=[this.captures[0],this.captures[1]];return pw(n1.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=YJ.EMPTY,n[this.getCurrentPlayer().value]+=1,new n1(t,this.turn,this.tiles,n)}removeTilesIfNeeded(e,t){pw(n1.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});let n=this;const r=n1.getTilesUpperLeftCoord(e);if(this.isTileEmpty(r)&&this.isDeconnectable(r)){n=this.deconnectTile(r,t);const e=n1.getPresentNeighboorEntrances(r);for(const r of e){const e=n.getPieceAt(r);e===YJ.EMPTY?n=n.removeTilesIfNeeded(r,t):e.is(this.getCurrentOpponent())&&n.isSurrounded(r)&&(n=n.capture(r))}}return n}isTileEmpty(e){MG(this.getPieceAt(e)!==YJ.NONE,"Should not call isTileEmpty on removed tile");for(let t=0;t<2;t++)for(let n=0;n<3;n++){const r=e.getNext(new VJ(n,t),1);if(this.getPieceAt(r)!==YJ.EMPTY)return!1}return!0}isDeconnectable(e){const t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;let n=0;for(let r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}areNeighboor(e,t){return e+1===t||0===e&&5===t}getPresentNeighboorTilesRelativeIndexes(e){const t=[];let n=vw.empty();for(let r=0;r<6;r++){const i=e.getNext(n1.NEIGHBOORS_TILES_DIRECTIONS[r],1);i.isInRange(15,10)&&this.getPieceAt(i)!==YJ.NONE&&(n.isAbsent()&&(n=vw.of(r)),t.push(r-n.get()))}return t}deconnectTile(e,t){pw(n1.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});const n=this.getCopiedBoard(),r=e.x,i=e.y;for(let o=0;o<2;o++)for(let e=0;e<3;e++)n[i+o][r+e]=YJ.NONE;const s=[this.tiles[0],this.tiles[1]];return t&&(s[this.getCurrentPlayer().value]+=1),new n1(n,this.turn,s,this.captures)}getLegalLandings(e){const t=[];for(const n of QX.STEPS){const r=e.getNext(n.direction,1);this.isOnBoard(r)&&this.getPieceAt(r)===YJ.EMPTY&&t.push(r)}return t}getPiecesByFreedom(){const e=[[0,0,0,0],[0,0,0,0]];for(let t=0;t<10;t++)for(let n=0;n<15;n++){const r=this.board[t][n];if(r.isPlayer()){const i=this.getEmptyNeighboors(new GJ(n,t),YJ.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}n1.VERBOSE=!1,n1.NEIGHBOORS_TILES_DIRECTIONS=[new VJ(0,-2),new VJ(3,-1),new VJ(3,1),new VJ(0,2),new VJ(-3,1),new VJ(-3,-1)],n1.isInRange=e=>e.isInRange(15,10);let r1=(()=>{class e extends vQ{applyLegalMove(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}applyLegalTileExchange(t,n){const r=n.getCopiedBoard(),i=t.capture.get();r[i.y][i.x]=YJ.EMPTY;const s=[n.captures[0],n.captures[1]];s[n.getCurrentPlayer().value]+=1;const o=[n.tiles[0],n.tiles[1]];o[n.getCurrentPlayer().value]-=2;const a=new n1(r,n.turn,o,s),c=a.removeTilesIfNeeded(i,!1),l=new n1(c.getCopiedBoard(),c.turn+1,c.tiles,c.captures);return pw(e.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:n,afterCapture:a,afterTileRemoval:c,resultingState:l}}),l}applyLegalMovement(t,n){const r=n.applyLegalMovement(t),i=r.removeTilesIfNeeded(t.start.get(),!0),s=i.doMovementCaptures(t),o=new n1(s.board,n.turn+1,s.tiles,s.captures);return pw(e.VERBOSE,{ab_state:n,afterMovement:r,afterTilesRemoved:i,afterCaptures:s,resultingState:o}),o}isLegal(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}isLegalTileExchange(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return OG.failure(JX.NOT_ENOUGH_TILES_TO_EXCHANGE());const n=t.getPieceAt(e.capture.get());return n===YJ.NONE||n===YJ.EMPTY?OG.failure(JX.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?OG.failure(JX.CANNOT_CAPTURE_OWN_PIECES()):OG.success(void 0)}isLegalMovement(e,t){if(t.getPieceAt(e.start.get())===YJ.NONE){const t="Cannot start with a coord outside the board "+e.start.get().toString()+".";return OG.failure(t)}if(t.getPieceAt(e.landingCoord.get())===YJ.NONE){const t="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return OG.failure(t)}const n=t.getPieceAt(e.start.get());return n===YJ.EMPTY?OG.failure(tQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n.is(t.getCurrentOpponent())?OG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE()):OG.success(void 0)}static getGameStatus(e){const t=e.gameState;return t.captures[0]>=18?yQ.ZERO_WON:t.captures[1]>=18?yQ.ONE_WON:yQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class i1 extends nQ{getListMoves(e){let t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}getListExchanges(e){const t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=YJ.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(let s=0;s<10;s++)for(let e=0;e<15;e++){const r=new GJ(e,s);if(n.getPieceAt(r)===i){const e=XX.fromTilesExchange(r);t.push(e)}}return t}getListMovement(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<10;i++)for(let e=0;e<15;e++){const s=new GJ(e,i);if(n.getPieceAt(s).is(r)){const e=n.getLegalLandings(s);for(const n of e){const e=XX.fromCoordToCoord(s,n);t.push(e)}}}return t}getBoardValue(e){const t=r1.getGameStatus(e);if(t.isEndGame)return rQ.fromWinner(t.winner);const n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new rQ(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}getPiecesScore(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}getPlayerPiecesScore(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}putCaptureFirst(e,t){return LG.sortByDescending(t,t=>this.moveCapturesList(e,t).length),t}moveCapturesList(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}let s1=(()=>{class e extends i1{getBoardValue(t){const n=r1.getGameStatus(t);if(n.isEndGame)return rQ.fromWinner(n.winner);const r=t.gameState,i=this.getPiecesMap(r),s=this.getThreatMap(r,i),o=this.filterThreatMap(s,r);let a=0;for(const c of[VY.ZERO,VY.ONE])for(const t of i.get(c).get())o.get(t).isPresent()?a+=c.getScoreModifier()*e.SCORE_BY_THREATENED_PIECE:a+=c.getScoreModifier()*e.SCORE_BY_SAFE_PIECE;return a+=r.tiles[1]-r.tiles[0],new rQ(a)}getPiecesMap(e){const t=new fQ,n=[],r=[];for(let i=0;i<10;i++)for(let t=0;t<15;t++){const s=new GJ(t,i),o=e.getPieceAt(s);o===YJ.ZERO?n.push(s):o===YJ.ONE&&r.push(s)}return t.set(VY.ZERO,new kX(n)),t.set(VY.ONE,new kX(r)),t}getThreatMap(e,t){const n=new fQ;for(const r of[VY.ZERO,VY.ONE])for(const i of t.get(r).get()){const t=this.getThreat(i,e);t.isPresent()&&n.set(i,t.get())}return n}getThreat(e,t){const n=VY.of(t.getPieceAt(e).value).getOpponent();let r=vw.empty();const i=[],s=e1.getNeighbors(e).filter(e=>e.isInRange(15,10));for(const o of s){const e=t.getPieceAt(o);if(e.is(n))i.push(o);else if(e===YJ.EMPTY){if(r.isPresent())return vw.empty();r=vw.of(o)}}if(r.isPresent()){const e=[];for(const s of QX.STEPS){const o=r.get().getNext(s.direction,1);o.isInRange(15,10)&&t.getPieceAt(o).is(n)&&i.every(e=>!1===e.equals(o))&&e.push(o)}if(e.length>0)return vw.of(new OX(new kX(i),new kX(e)))}return vw.empty()}filterThreatMap(e,t){const n=new fQ,r=e.listKeys(),i=r.filter(e=>t.getPieceAt(e).is(t.getCurrentPlayer())),s=new kX(r.filter(e=>t.getPieceAt(e).is(t.getCurrentOpponent())));for(const o of i){const t=e.get(o).get();MG(1===t.directThreats.size(),"oldThreat must contain exactly one direct threat");const r=t.directThreats.getAnyElement().get();let i=vw.empty();if(!1===s.contains(r)){const e=[];for(const n of t.mover)!1===s.contains(n)&&e.push(n);e.length>0&&(i=vw.of(new OX(t.directThreats,new kX(e))))}i.isPresent()&&n.set(o,i.get())}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e})();const o1=YJ.EMPTY,a1=YJ.NONE,c1=YJ.ZERO,l1=YJ.ONE;class u1{constructor(){this.tutorial=[wQ.informational($localize`Board and goal of the game`,$localize`Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.
         The triangles are the spaces on which pieces move during the game.
         The tiles can be removed from the board (you will see how later).
         The dark pieces belong to the first player and can only move on the dark spaces,
         while the light pieces belong to the second player and can only move on the light spaces.
         The goal of the game is to capture all of the opponent's pieces.`,n1.getInitialState()),wQ.anyMove($localize`Move`,$localize`To move a piece, you need to:
        <ol>
          <li>Click on one of your pieces.</li>
          <li>Click on one of the triangular space highlighted in yellow.</li>
        </ol>
        You can pass through the opponent's pieces.
        You're playing first, hence you're playing Dark.<br/><br/>
        Perform any move.`,n1.getInitialState(),XX.fromCoordToCoord(new GJ(3,5),new GJ(5,5)),$localize`Congratulations! Let's see captures now.`),wQ.fromMove($localize`Capture`,$localize`Every piece has three neighboring triangular spaces (2 on the sides).
        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!
        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>
        You're playing Light, make a capture.`,new n1([[a1,a1,a1,a1,a1,a1,c1,o1,c1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,c1,o1,o1,o1,o1,o1,c1,o1,o1,a1,a1,a1],[o1,l1,o1,l1,c1,l1,o1,o1,c1,o1,o1,l1,o1,l1,o1],[l1,o1,o1,o1,o1,o1,o1,o1,o1,o1,l1,o1,o1,o1,l1],[o1,l1,o1,l1,o1,o1,o1,o1,o1,o1,o1,l1,o1,l1,o1],[o1,c1,o1,c1,o1,o1,o1,o1,o1,o1,o1,c1,o1,c1,o1],[c1,o1,o1,o1,c1,o1,o1,o1,o1,o1,c1,o1,o1,o1,c1],[o1,c1,o1,c1,o1,o1,l1,o1,l1,o1,o1,c1,o1,c1,o1],[a1,a1,a1,o1,o1,l1,o1,o1,o1,l1,o1,o1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,l1,o1,l1,a1,a1,a1,a1,a1,a1]],3,[0,0],[0,0]),[XX.fromCoordToCoord(new GJ(5,2),new GJ(4,1)),XX.fromCoordToCoord(new GJ(3,4),new GJ(4,3))],$localize`Congratulations!`,$localize`Failed, you have not captured any piece.`),wQ.fromMove($localize`Gain a tile`,$localize`When a tile is empty, it can become removable from the board.
        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.
        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.
        For example, here, the topmost dark piece will not disconnect its tile when leaving it.
        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>
        Perform a move that lets you gain two tiles.`,new n1([[a1,a1,a1,a1,a1,a1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,l1,o1,o1,a1,a1,a1,a1,a1,a1],[o1,o1,o1,a1,a1,a1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[o1,o1,l1,o1,o1,o1,o1,c1,o1,a1,a1,a1,a1,a1,a1],[o1,o1,o1,l1,o1,o1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[o1,o1,o1,o1,o1,o1,o1,o1,o1,o1,o1,c1,a1,a1,a1],[o1,o1,c1,o1,o1,l1,o1,o1,o1,o1,c1,o1,o1,o1,c1],[o1,o1,o1,o1,o1,o1,l1,o1,l1,o1,o1,c1,o1,c1,o1],[a1,a1,a1,o1,o1,l1,o1,o1,o1,l1,o1,o1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,l1,o1,l1,a1,a1,a1,a1,a1,a1]],2,[0,0],[0,0]),[XX.fromCoordToCoord(new GJ(2,6),new GJ(4,6)),XX.fromCoordToCoord(new GJ(2,6),new GJ(3,5)),XX.fromCoordToCoord(new GJ(2,6),new GJ(3,7))],$localize`Congratulations!`,$localize`Failed, you have not gained the two tiles that you could, try again!`),wQ.fromMove($localize`Exchanging a tile`,$localize`When you have a tile, you can see it on the left of the board.
        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.
        This will cost you two tiles.
        If any tiles are removed during that turn, nobody will get them.<br/><br/>
        Gain some time and capture the last piece!`,new n1([[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,c1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,o1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,o1,l1,o1,l1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,l1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,l1,o1,l1,a1,a1,a1,a1,a1,a1]],1,[0,2],[0,0]),[XX.fromTilesExchange(new GJ(5,5))],$localize`Congratulations!`,$localize`It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!`),wQ.fromMove($localize`Special capture`,$localize`When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!
        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>
        A move that demonstrate both of these things can be done on this board by Light. Try it!`,new n1([[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,o1,o1,c1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,c1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,c1,l1,o1,l1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,l1,c1,o1,o1,o1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,o1,o1,l1,a1,a1,a1,a1,a1,a1,a1,a1,a1],[a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1,a1]],1,[0,0],[0,0]),[XX.fromCoordToCoord(new GJ(7,6),new GJ(6,5)),XX.fromCoordToCoord(new GJ(7,6),new GJ(8,5))],$localize`Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.
        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space.`,$localize`Failed!`)]}}function h1(e,t){if(1&e&&(Cn(),pa(0,"polygon",13)),2&e){const e=ba().index,t=ba().index,n=ba();ua("ngClass",n.getPyramidClass(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function d1(e,t){if(1&e&&(Cn(),pa(0,"polygon",15)),2&e){const e=ba(2).index,t=ba().index,n=ba();ua("ngClass",n.getEmptyClass(e,t)),ra("points",n.getTriangleCoordinate(e,t))}}function f1(e,t){if(1&e&&(Cn(),aa(0,d1,1,2,"polygon",14)),2&e){const e=ba().index,t=ba().index;ua("ngIf",ba().isEmptyCase(e,t))}}function p1(e,t){if(1&e&&(Cn(),pa(0,"polygon",16)),2&e){const e=ba().index,t=ba().index,n=ba();Oa("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function g1(e,t){if(1&e&&(Cn(),pa(0,"polygon",17)),2&e){const e=ba().index,t=ba().index,n=ba();Oa("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function m1(e,t){if(1&e){const e=ya();Cn(),da(0,"g",8),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),aa(1,h1,1,2,"polygon",9),aa(2,f1,1,1,"ng-template",null,10,Du),aa(4,p1,1,3,"polygon",11),aa(5,g1,1,3,"polygon",12),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(3),i=ba().index,s=ba();Oa("id","click_",n,"_",i,""),Ts(1),ua("ngIf",s.isPyramid(n,i))("ngIfElse",r),Ts(3),ua("ngIf",e!==s.NONE),Ts(1),ua("ngIf",e!==s.NONE)}}function y1(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,m1,6,6,"g",7),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function v1(e,t){if(1&e&&(Cn(),pa(0,"polygon",18)),2&e){const e=t.$implicit;ra("points",ba().getTriangleCoordinate(e.x,e.y))}}function _1(e,t){if(1&e&&(Cn(),pa(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastStart.get().x,e.lastStart.get().y))}}function C1(e,t){if(1&e&&(Cn(),pa(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastEnd.get().x,e.lastEnd.get().y))}}function E1(e,t){if(1&e&&(Cn(),pa(0,"polygon",20)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}function w1(e,t){if(1&e&&(Cn(),da(0,"g",21),pa(1,"polygon",22),da(2,"text",23),Da(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,0))("stroke",e.lastTurnWasTilesExchange(0)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+0*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),La(e.tiles[0])}}function b1(e,t){if(1&e&&(Cn(),da(0,"g",24),pa(1,"polygon",25),da(2,"text",26),Da(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,9))("stroke",e.lastTurnWasTilesExchange(1)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+9*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),La(e.tiles[1])}}let S1=(()=>{class e extends KX{constructor(e){super(e),this.tiles=[0,0],this.NONE=YJ.NONE,this.chosenCoord=vw.empty(),this.lastStart=vw.empty(),this.lastEnd=vw.empty(),this.highlights=[],this.scores=vw.of([0,0]),this.rules=new r1(n1),this.availableMinimaxes=[new i1(this.rules,"Normal"),new s1(this.rules,"Piece > Threat > Tiles")],this.encoder=XX.encoder,this.tutorial=(new u1).tutorial,this.SPACE_SIZE=70,this.updateBoard()}updateBoard(){this.chosenCoord=vw.empty(),this.state=this.rules.node.gameState,this.scores=vw.of(this.state.captures),this.tiles=this.state.tiles;const e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=vw.empty(),this.lastEnd=vw.empty()),this.board=this.rules.node.gameState.board}showHighlight(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}cancelMoveAttempt(){this.chosenCoord=vw.empty(),this.highlights=[]}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new GJ(e,t);return n.chosenCoord.isAbsent()?n.firstClick(i):n.secondClick(i)})()}firstClick(e){var t=this;return dw(function*(){const n=t.state.getPieceAt(e);if(n.is(t.state.getCurrentOpponent())){const n=XX.fromTilesExchange(e);return t.chooseMove(n,t.state,t.state.captures)}return n.is(t.state.getCurrentPlayer())?(t.chosenCoord=vw.of(e),t.showHighlight(),kG.SUCCESS):t.cancelMove(JX.FIRST_CLICK_SHOULD_NOT_BE_NULL())})()}secondClick(e){var t=this;return dw(function*(){if(e.equals(t.chosenCoord.get()))return t.cancelMoveAttempt(),kG.SUCCESS;if(t.highlights.some(t=>t.equals(e))){const n=XX.fromCoordToCoord(t.chosenCoord.get(),e);return t.chooseMove(n,t.state,t.state.captures)}return t.cancelMove(JX.INVALID_DISTANCE())})()}isPyramid(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}wasOpponent(e,t){const n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}getPyramidClass(e,t){const n=this.board[t][e];return n===YJ.ZERO?this.getPlayerClass(VY.ZERO):n===YJ.ONE?this.getPlayerClass(VY.ONE):"captured"}isEmptyCase(e,t){return this.board[t][e]===YJ.EMPTY||this.wasRemoved(e,t)}wasRemoved(e,t){const n=this.rules.node.mother;if(this.board[t][e]===YJ.NONE&&n.isPresent()){const r=n.get().gameState.getPieceAtXY(e,t);return r===YJ.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}getEmptyClass(e,t){return this.board[t][e]===YJ.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}getTilesCountCoordinate(e,t){const n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}getLineCoordinate(e,t){const n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}mustShowTilesOf(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}lastTurnWasTilesExchange(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-coerceo"]],features:[Ho],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,y1,2,1,"g",1),aa(2,v1,1,1,"polygon",2),aa(3,_1,1,1,"polygon",3),aa(4,C1,1,1,"polygon",3),aa(5,E1,1,1,"polygon",4),aa(6,w1,4,6,"g",5),aa(7,b1,4,6,"g",6),fa()),2&e&&(ra("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.highlights),Ts(1),ua("ngIf",t.lastStart.isPresent()),Ts(1),ua("ngIf",t.lastEnd.isPresent()),Ts(1),ua("ngIf",t.chosenCoord.isPresent()),Ts(1),ua("ngIf",t.mustShowTilesOf(0)),Ts(1),ua("ngIf",t.mustShowTilesOf(1)))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),P1=(()=>{class e{}return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=()=>$localize`Your piece should land on a neighboring square.`,e.CANNOT_DROP_AFTER_TURN_40=()=>$localize`You cannot drop a piece during the moving phase.`,e.CANNOT_MOVE_BEFORE_TURN_40=()=>$localize`You cannot move a piece before both players have dropped all of their pieces.`,e.MUST_JUMP_OVER_PIECES=()=>$localize`A jump must be made over a piece, not over an empty square.`,e.MUST_DROP_IN_CENTRAL_ZONE=()=>$localize`A drop must occur in the central zone of the board.`,e.INVALID_JUMP=()=>$localize`A jump must land two squares from its original position, and be done in a straight line in any direction.`,e.SAME_LOCATION_VISITED_IN_JUMP=()=>$localize`You are visiting the same location twice in a move, you are not allowed to do so.`,e})();class O1 extends aQ{static getInitialState(){const e=LG.createTable(O1.WIDTH,O1.HEIGHT,VY.NONE);return new O1(e,0)}isShelter(e){return 0===e.x||e.x===O1.WIDTH-1?O1.SHELTERS_INDICES.some(t=>e.y===t):(0===e.y||e.y===O1.HEIGHT-1)&&O1.SHELTERS_INDICES.some(t=>e.x===t)}isCentralZone(e){return e.x>=O1.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=O1.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=O1.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=O1.CENTRAL_ZONE_BOTTOM_RIGHT.y}isDropPhase(){return this.turn<40}getSidePieces(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}O1.WIDTH=17,O1.HEIGHT=17,O1.CENTRAL_ZONE_TOP_LEFT=new GJ(4,6),O1.CENTRAL_ZONE_BOTTOM_RIGHT=new GJ(12,10),O1.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],O1.ALL_SHELTERS=new sQ(O1.SHELTERS_INDICES.flatMap(e=>[new GJ(e,0),new GJ(e,O1.HEIGHT-1),new GJ(0,e),new GJ(O1.WIDTH-1,e)])).toList();class T1 extends uQ{constructor(e){super(e.x,e.y)}static of(e){return e.isInRange(O1.WIDTH,O1.HEIGHT)?OG.success(new T1(e)):OG.failure("Move out of board")}toString(){return`ConspirateursMoveDrop(${this.coord.toString()})`}equals(e){return!!e.isDrop()&&this.coord.equals(e.coord)}isDrop(){return!0}isSimple(){return!1}isJump(){return!1}}T1.encoder=class{static getEncoder(e,t,n){return new class extends BY{constructor(){super(...arguments),this.shiftX=t}maxValue(){return(e-1)*this.shiftX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftX+e.coord.y}decodeNumber(r){const i=r%t;r/=t;const s=new GJ((r-=r%1)%e,i);return n(s)}}}}.getEncoder(O1.WIDTH,O1.HEIGHT,e=>T1.of(e).get());class I1 extends fX{constructor(e,t){super(e,t)}static of(e,t){return e.isInRange(O1.WIDTH,O1.HEIGHT)&&t.isInRange(O1.WIDTH,O1.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?OG.success(new I1(e,t)):OG.failure(P1.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):OG.failure("Move out of board")}toString(){return`ConspirateursMoveSimple(${this.coord.toString()} -> ${this.end.toString()})`}equals(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}isDrop(){return!1}isSimple(){return!0}isJump(){return!1}}I1.encoder=fX.getEncoder(O1.WIDTH,O1.HEIGHT,(e,t)=>I1.of(e,t).get());class k1 extends lQ{constructor(e){super(),this.coords=e}static of(e){if(e.length<2)return OG.failure("ConspirateursMoveJump requires at least one jump, so two coords");for(const t of e)if(t.isNotInRange(O1.WIDTH,O1.HEIGHT))return OG.failure("Move out of board");for(let t=1;t<e.length;t++)if(e[t-1].getDirectionToward(e[t]).isFailure()||2!==e[t-1].getDistance(e[t]))return OG.failure(P1.INVALID_JUMP());return new kX(e).size()===e.length?OG.success(new k1(e)):OG.failure(P1.SAME_LOCATION_VISITED_IN_JUMP())}addJump(e){const t=LG.copyImmutableArray(this.coords);return t.push(e),k1.of(t)}getStartingCoord(){return this.coords[0]}getEndingCoord(){return this.coords[this.coords.length-1]}getLandingCoords(){return this.coords.slice(1)}getJumpedOverCoords(){const e=[];for(let t=1;t<this.coords.length;t++){const n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}toString(){return`ConspirateursMoveJump(${this.coords.map(e=>e.toString()).reduce((e,t)=>e+" -> "+t)})`}equals(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}isDrop(){return!1}isSimple(){return!1}isJump(){return!0}}k1.encoder=new class extends FY{constructor(){super(...arguments),this.coordEncoder=GJ.numberEncoder(O1.WIDTH,O1.HEIGHT)}encodeMove(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}decodeMove(e){MG(null!=fw.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");const t=fw.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return k1.of(t).get()}};const A1=FY.disjunction3(T1.encoder,I1.encoder,k1.encoder,e=>e.isDrop(),e=>e.isSimple());class N1 extends vQ{constructor(){super(O1)}static get(){return N1.singleton.isAbsent()&&(N1.singleton=vw.of(new N1)),N1.singleton.get()}applyLegalMove(e,t,n){const r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=VY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{const n=e.getStartingCoord(),i=e.getEndingCoord();r[n.y][n.x]=VY.NONE,r[i.y][i.x]=t.getCurrentPlayer()}return new O1(r,t.turn+1)}isLegal(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}dropLegality(e,t){return t.turn>=40?OG.failure(P1.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord)!==VY.NONE?OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?OG.failure(P1.MUST_DROP_IN_CENTRAL_ZONE()):OG.success(void 0)}simpleMoveLegality(e,t){return t.turn<40?OG.failure(P1.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end)!==VY.NONE?OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE()):OG.success(void 0)}jumpLegality(e,t){if(t.turn<40)return OG.failure(P1.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE());for(const n of e.getJumpedOverCoords())if(t.getPieceAt(n)===VY.NONE)return OG.failure(P1.MUST_JUMP_OVER_PIECES());for(const n of e.getLandingCoords())if(t.getPieceAt(n)!==VY.NONE)return OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE());return OG.success(void 0)}jumpTargetsFrom(e){const t=[new GJ(e.x+2,e.y),new GJ(e.x-2,e.y),new GJ(e.x,e.y+2),new GJ(e.x,e.y-2),new GJ(e.x+2,e.y+2),new GJ(e.x+2,e.y-2),new GJ(e.x-2,e.y+2),new GJ(e.x-2,e.y-2)],n=[];for(const r of t)k1.of([e,r]).isSuccess()&&n.push(r);return n}nextJumps(e,t){const n=e.getEndingCoord(),r=[];for(const i of this.jumpTargetsFrom(n)){const n=e.addJump(i);n.isSuccess()&&this.jumpLegality(n.get(),t).isSuccess()&&r.push(n.get())}return r}jumpHasPossibleNextTargets(e,t){return this.nextJumps(e,t).length>0}getGameStatus(e){const t=e.gameState,n=[0,0];for(const r of O1.ALL_SHELTERS){const e=t.getPieceAt(r);if(e!==VY.NONE&&(n[e.value]+=1,20===n[e.value]))return yQ.getVictory(e)}return yQ.ONGOING}}N1.singleton=vw.empty();class M1 extends nQ{getListMoves(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}getListMovesDrop(e){const t=[],n=O1.CENTRAL_ZONE_TOP_LEFT,r=O1.CENTRAL_ZONE_BOTTOM_RIGHT;for(let i=n.y;i<=r.y;i++)for(let s=n.x;s<=r.x;s++)e.getPieceAtXY(s,i)===VY.NONE&&t.push(T1.of(new GJ(s,i)).get());return t}getListMovesAfterDrop(e){let t=[];const n=e.getCurrentPlayer();for(let r=0;r<O1.HEIGHT;r++)for(let i=0;i<O1.WIDTH;i++){const s=new GJ(i,r);e.getPieceAt(s)===n&&(t=t.concat(this.getListSimpleMoves(e,s)),t=t.concat(this.getListJumps(e,s)))}return t}getListSimpleMoves(e,t){const n=[],r=[new GJ(t.x+1,t.y),new GJ(t.x-1,t.y),new GJ(t.x,t.y+1),new GJ(t.x,t.y-1),new GJ(t.x+1,t.y+1),new GJ(t.x+1,t.y-1),new GJ(t.x-1,t.y+1),new GJ(t.x-1,t.y-1)];for(const i of r){const r=I1.of(t,i);r.isSuccess()&&N1.get().simpleMoveLegality(r.get(),e).isSuccess()&&n.push(r.get())}return n}getListJumps(e,t){const n=new sQ;for(const r of N1.get().jumpTargetsFrom(t)){const i=k1.of([t,r]).get();N1.get().jumpLegality(i,e).isSuccess()&&(n.add(i),n.union(this.getListJumpStartingFrom(e,i)))}return n.toList()}getListJumpStartingFrom(e,t){const n=N1.get().nextJumps(t,e),r=new sQ(n);for(const i of n)r.union(this.getListJumpStartingFrom(e,i));return r}getBoardValue(e){const t=e.gameState;let n=0;const r=new fQ;r.set(VY.ZERO,0),r.set(VY.ONE,0);for(let i=0;i<O1.HEIGHT;i++)for(let e=0;e<O1.WIDTH;e++){const s=new GJ(e,i),o=t.getPieceAt(s);if(o!==VY.NONE)if(t.isShelter(s)){if(n+=20*o.getScoreModifier(),r.replace(o,r.get(o).get()+1),20===r.get(o).get())return new rQ(o.getVictoryValue())}else{let e=100;for(const n of O1.ALL_SHELTERS)if(t.getPieceAt(n)===VY.NONE){const t=s.getOrthogonalDistance(n);e=Math.min(e,t)}n-=o.getScoreModifier()*e}}return new rQ(n)}}const x1=VY.NONE,R1=VY.ZERO,D1=VY.ONE;class L1{constructor(){this.tutorial=[wQ.informational($localize`Board and aim of the game`,$localize`Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially.`,O1.getInitialState()),wQ.anyMove($localize`Initial phase`,$localize`In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone.`,O1.getInitialState(),T1.of(new GJ(7,7)).get(),$localize`Congratulations!`),wQ.fromPredicate($localize`Simple move`,$localize`Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move.`,new O1([[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,R1,D1,D1,R1,R1,D1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,D1,R1,D1,R1,R1,R1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,D1,x1,x1,x1,x1,x1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,R1,D1,D1,D1,R1,R1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,D1,D1,D1,D1,D1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1]],40),I1.of(new GJ(4,6),new GJ(3,5)).get(),(e,t)=>e.isSimple()?kG.SUCCESS:kG.failure($localize`You have made a jump, not a simple move. Try again!`),$localize`Congratulations!`),wQ.fromPredicate($localize`Jumps`,$localize`The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful).`,new O1([[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,R1,D1,D1,R1,R1,D1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,D1,R1,D1,R1,R1,R1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,D1,x1,x1,x1,x1,x1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,R1,D1,D1,D1,R1,R1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,D1,D1,D1,D1,D1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1]],40),k1.of([new GJ(6,7),new GJ(6,5)]).get(),(e,t)=>e.isJump()?kG.SUCCESS:kG.failure($localize`You have not performed a jump. Try again!`),$localize`Congratulations!`),wQ.fromMove($localize`Chaining jumps in a single move`,$localize`Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it.`,new O1([[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,D1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,D1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,D1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,R1,x1,D1,R1,R1,D1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,x1,R1,D1,R1,R1,R1,R1,D1,x1,x1,x1,x1],[x1,x1,x1,x1,R1,D1,x1,x1,x1,x1,x1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,R1,D1,D1,D1,R1,R1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,D1,R1,D1,D1,D1,D1,D1,D1,R1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1],[x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1,x1]],40),[k1.of([new GJ(8,6),new GJ(6,4),new GJ(6,2),new GJ(6,0)]).get()],$localize`Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does.`,$localize`You have not performed a triple jump. Try again!`)]}}function F1(e,t){if(1&e){const e=ya();Cn(),da(0,"rect",9),Ca("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba().$implicit,t=ba(2);ra("x",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.x+t.STROKE_WIDTH)("y",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.y+t.STROKE_WIDTH)("width",t.SPACE_SIZE-3*t.STROKE_WIDTH)("height",t.SPACE_SIZE-3*t.STROKE_WIDTH)}}function B1(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",6),Ca("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Oa("id","piece_",t,"_",r,""),ua("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function V1(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",6),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t.coord)}),fa(),aa(2,F1,1,4,"rect",7),aa(3,B1,1,6,"circle",8),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","click_",n,"_",r,""),ua("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngIf",e.isShelter),Ts(1),ua("ngIf",e.hasPiece)}}function U1(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,V1,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function $1(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",10),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngClass",n.viewInfo.boardInfo[e.y][e.x].shelterClasses),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function z1(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=t.$implicit,n=ba();Pa("id","sidePiece_0_",e,""),ra("cx",-n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function H1(e,t){if(1&e&&(Cn(),pa(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Pa("id","sidePiece_1_",e,""),ra("cx",1715+n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function G1(e,t){if(1&e&&(Cn(),pa(0,"rect",13)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.CENTRAL_ZONE_START.x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.CENTRAL_ZONE_START.y+e.STROKE_WIDTH)("width",e.CENTRAL_ZONE_SIZE.x*e.SPACE_SIZE)("height",e.CENTRAL_ZONE_SIZE.y*e.SPACE_SIZE)}}let q1=(()=>{class e extends jJ{constructor(e){super(e),this.ALL_SHELTERS=O1.ALL_SHELTERS,this.CENTRAL_ZONE_START=O1.CENTRAL_ZONE_TOP_LEFT,this.CENTRAL_ZONE_SIZE=new VJ(O1.CENTRAL_ZONE_BOTTOM_RIGHT.x-O1.CENTRAL_ZONE_TOP_LEFT.x+1,O1.CENTRAL_ZONE_BOTTOM_RIGHT.y-O1.CENTRAL_ZONE_TOP_LEFT.y+1),this.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},this.selected=vw.empty(),this.jumpInConstruction=vw.empty(),this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH),this.rules=N1.get(),this.availableMinimaxes=[new M1(this.rules,"ConspirateursMinimax")],this.encoder=A1,this.tutorial=(new L1).tutorial}ngOnInit(){this.updateBoard()}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}updateViewInfo(){const e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(let t=0;t<O1.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(let n=0;n<O1.WIDTH;n++){const r=new GJ(n,t),i=e.getPieceAt(r),s={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i!==VY.NONE,isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(s)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}updateOccupiedShelters(){for(const e of O1.ALL_SHELTERS){const t=this.viewInfo.boardInfo[e.y][e.x];t.isShelter=!0,t.hasPiece&&t.shelterClasses.push("highlighted")}}updateSelected(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){const e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;for(const r of e.coords)this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}else{const e=this.selected.get();this.viewInfo.boardInfo[e.y][e.x].pieceClasses.push("selected")}}updateVictory(){const e=this.getState(),t=N1.get().getGameStatus(this.rules.node);if(!0===t.isEndGame)for(const n of O1.ALL_SHELTERS)e.getPieceAt(n)===t.winner&&this.viewInfo.boardInfo[n.y][n.x].squareClasses.push("victory")}showLastMove(){const e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";for(const t of e.coords)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=t.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=t.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}cancelMoveAttempt(){this.jumpInConstruction=vw.empty(),this.selected=vw.empty(),this.updateBoard()}onClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());const r=t.getState();if(r.getPieceAt(e)===t.getCurrentPlayer())return t.selected=vw.of(e),t.jumpInConstruction=vw.empty(),t.updateViewInfo(),kG.SUCCESS;if(t.jumpInConstruction.isPresent())return t.constructJump(e);if(t.selected.isPresent())return t.selectNextCoord(e);if(r.isDropPhase()){const n=T1.of(e);return MG(n.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(n.get(),r)}return t.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE())})()}constructJump(e){var t=this;return dw(function*(){const n=t.jumpInConstruction.get(),r=t.getState();if(e.equals(n.getEndingCoord()))return t.chooseMove(n,r);{const i=n.addJump(e);if(i.isFailure())return t.cancelMove(i.getReason());const s=t.rules.jumpLegality(i.get(),r);return s.isFailure()?t.cancelMove(s.getReason()):t.updateJump(i.get())}})()}updateJump(e){var t=this;return dw(function*(){const n=t.getState();return t.rules.jumpHasPossibleNextTargets(e,n)?(t.jumpInConstruction=vw.of(e),t.updateViewInfo(),kG.SUCCESS):t.chooseMove(e,n)})()}selectNextCoord(e){var t=this;return dw(function*(){const n=t.selected.get(),r=I1.of(n,e);if(r.isSuccess())return t.chooseMove(r.get(),t.getState());{const r=k1.of([n,e]);return r.isFailure()?t.cancelMove(r.getReason()):t.updateJump(r.get())}})()}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-conspirateurs"]],features:[Ho],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,U1,2,1,"g",1),aa(2,$1,2,5,"g",1),aa(3,z1,1,4,"circle",2),aa(4,H1,1,4,"circle",3),aa(5,G1,1,4,"rect",4),pa(6,"polyline",5),fa()),2&e&&(Ts(1),ua("ngForOf",t.viewInfo.boardInfo),Ts(1),ua("ngForOf",t.ALL_SHELTERS),Ts(1),ua("ngForOf",t.range(t.viewInfo.sidePieces[0])),Ts(1),ua("ngForOf",t.range(t.viewInfo.sidePieces[1])),Ts(1),ua("ngIf",t.viewInfo.dropPhase),Ts(1),ra("points",t.viewInfo.lastMoveArrow))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class W1{constructor(e,t){this.owner=e,this.otherPieceType=t}static of(e,t){return e===VY.ZERO?t?W1.ZERO_SECOND:W1.ZERO_FIRST:e===VY.ONE?t?W1.ONE_SECOND:W1.ONE_FIRST:W1.EMPTY}toString(){return`DiamPiece(${this.owner}, ${this.otherPieceType})`}}W1.encoder=BY.tuple([VY.numberEncoder,BY.booleanEncoder],e=>[e.owner,e.otherPieceType],e=>W1.of(e[0],e[1])),W1.EMPTY=new W1(VY.NONE,!1),W1.ZERO_FIRST=new W1(VY.ZERO,!1),W1.ZERO_SECOND=new W1(VY.ZERO,!0),W1.ONE_FIRST=new W1(VY.ONE,!1),W1.ONE_SECOND=new W1(VY.ONE,!0),W1.PLAYER_PIECES=[W1.ZERO_FIRST,W1.ZERO_SECOND,W1.ONE_FIRST,W1.ONE_SECOND];class j1 extends lQ{constructor(e,t){if(super(),this.target=e,this.piece=t,t===W1.EMPTY)throw new Error("Cannot drop an empty piece")}isDrop(){return!0}getTarget(){return this.target}equals(e){return!(this.target!==e.target||this.piece!==e.piece)}toString(){return`DiamMoveDrop(${this.target}, ${this.piece})`}}j1.encoder=BY.tuple([BY.numberEncoder(7),W1.encoder],e=>[e.target,e.piece],e=>new j1(e[0],e[1]));class Z1 extends lQ{constructor(e,t){super(),this.start=e,this.moveDirection=t}static fromRepresentation(e,t){return new Z1(new GJ(e.x,3-e.y),t)}isDrop(){return!1}getTarget(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}equals(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}toString(){return`DiamMoveShift(${this.start}, ${this.moveDirection})`}}Z1.encoder=BY.tuple([GJ.numberEncoder(8,4),BY.booleanEncoder],e=>[e.start,"clockwise"===e.moveDirection],e=>new Z1(e[0],e[1]?"clockwise":"counterclockwise"));const Y1=BY.disjunction(j1.encoder,Z1.encoder,e=>e.isDrop());let K1=(()=>{class e{}return e.NO_MORE_PIECES_OF_THIS_TYPE=()=>$localize`You do not have any pieces of this type anymore.`,e.SPACE_IS_FULL=()=>$localize`You cannot play here: this space is already full.`,e.TARGET_STACK_TOO_HIGH=()=>$localize`You cannot add more pieces to the target stack, as it will contain more than 4 pieces.`,e.MUST_SHIFT_TO_NEIGHBOR=()=>$localize`To perform a shift, you must move the pieces to a neighboring space.`,e.MUST_SELECT_PIECE_FIRST=()=>$localize`You must first select either a piece from the side, or a stack of pieces to shift on the board.`,e})(),J1=(()=>{class e extends aQ{constructor(e,t,n){super(e,n),this.remainingPieces=t}static getInitialState(){const t=W1.EMPTY;return new e([[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t]],[4,4,4,4],0)}static fromRepresentation(t,n){const r=t.reverse(),i=[4,4,4,4];for(let s=0;s<e.HEIGHT;s++)for(let t=0;t<e.WIDTH;t++){const n=r[s][t];r[s][t]!==W1.EMPTY&&i[e.pieceIndex(n)]--}return MG(i.every(e=>e>=0),"Invalid DiamState representation uses too many pieces"),new e(r,i,n)}static pieceIndex(e){switch(e){case W1.ZERO_FIRST:return 0;case W1.ZERO_SECOND:return 1;case W1.ONE_FIRST:return 2;default:return fw.expectToBe(e,W1.ONE_SECOND),3}}getRemainingPiecesOf(t){return this.remainingPieces[e.pieceIndex(t)]}getStackHeight(t){let n=0;for(let r=0;r<e.HEIGHT&&this.getPieceAtXY(t,r)!==W1.EMPTY;r++)n++;return n}}return e.WIDTH=8,e.HEIGHT=4,e})();class Q1 extends vQ{constructor(){super(J1)}static get(){return Q1.singleton.isAbsent()&&(Q1.singleton=vw.of(new Q1)),Q1.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}applyLegalDrop(e,t){const n=LG.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;const r=LG.copyImmutableArray(t.remainingPieces);return r[J1.pieceIndex(e.piece)]-=1,new J1(n,r,t.turn+1)}applyLegalShift(e,t){const n=LG.copyBiArray(t.board),r=e.getTarget();let i=t.getStackHeight(r),s=e.start.y;for(;s<J1.HEIGHT&&t.getPieceAtXY(e.start.x,s)!==W1.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,s),n[s][e.start.x]=W1.EMPTY,i++,s++;return new J1(n,t.remainingPieces,t.turn+1)}isLegal(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}isDropLegal(e,t){return e.piece.owner!==t.getCurrentPlayer()?OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?OG.failure(K1.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}dropHeightValidity(e,t){return t.getStackHeight(e.target)===J1.HEIGHT?OG.failure(K1.SPACE_IS_FULL()):OG.success(void 0)}isShiftLegal(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}shiftHeightValidity(e,t){const n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>J1.HEIGHT?OG.failure(K1.TARGET_STACK_TOO_HIGH()):OG.success(void 0)}getGameStatus(e){const t=this.findHighestAlignment(e.gameState);if(t.isPresent()){const n=e.gameState.getPieceAt(t.get());return yQ.getVictory(n.owner)}return yQ.ONGOING}findHighestAlignment(e){for(let t=0;t<J1.WIDTH/2;t++)for(let n=J1.HEIGHT-1;n>0;n--){const r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+J1.WIDTH/2,n);if(r!==W1.EMPTY&&r===i)return vw.of(new GJ(t,n))}return vw.empty()}pieceCanMove(e,t){return!!this.isShiftLegal(new Z1(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new Z1(t,"counterclockwise"),e).isSuccess()}}Q1.singleton=vw.empty();class X1 extends nQ{getListMoves(e){const t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}getListShifts(e){const t=[],n=this.getShiftSources(e);for(const r of n)for(const n of[new Z1(r,"clockwise"),new Z1(r,"counterclockwise")])Q1.get().shiftHeightValidity(n,e).isSuccess()&&t.push(n);return t}getListDrops(e){const t=this.getRemainingPiecesForCurrentPlayer(e),n=[];for(let r=0;r<J1.WIDTH;r++)for(const i of t){const t=new j1(r,i);Q1.get().dropHeightValidity(t,e).isSuccess()&&n.push(t)}return n}getRemainingPiecesForCurrentPlayer(e){const t=[];for(const n of W1.PLAYER_PIECES)this.currentPlayerCanDropPiece(e,n)&&t.push(n);return t}currentPlayerCanDropPiece(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}getShiftSources(e){const t=[],n=e.getCurrentPlayer();for(let r=0;r<J1.HEIGHT;r++)for(let i=0;i<J1.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new GJ(i,r));return t}getBoardValue(e){const t=Q1.get().getGameStatus(e);return new rQ(t.isEndGame?t.toBoardValue():0)}}const e0=W1.EMPTY,t0=W1.ZERO_FIRST,n0=W1.ZERO_SECOND,r0=W1.ONE_FIRST,i0=W1.ONE_SECOND;class s0{constructor(){this.tutorial=[wQ.informational($localize`Initial board and player pieces`,$localize`Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right.`,J1.getInitialState()),wQ.fromMove($localize`Goal of the game`,$localize`At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!`,J1.fromRepresentation([[e0,e0,e0,e0,e0,e0,e0,e0],[e0,e0,e0,e0,e0,e0,e0,e0],[e0,e0,e0,e0,r0,e0,e0,e0],[t0,e0,e0,e0,t0,e0,e0,e0]],3),[new j1(0,W1.ONE_FIRST)],$localize`Congratulations, you won!`,$localize`Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board.`),wQ.fromMove($localize`Types of move`,$localize`You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board.`,J1.fromRepresentation([[e0,e0,e0,e0,e0,e0,e0,e0],[e0,e0,e0,e0,i0,e0,e0,e0],[e0,e0,e0,e0,t0,e0,e0,e0],[r0,e0,e0,e0,n0,e0,e0,e0]],4),[Z1.fromRepresentation(new GJ(4,3),"counterclockwise"),Z1.fromRepresentation(new GJ(4,3),"clockwise"),Z1.fromRepresentation(new GJ(4,2),"counterclockwise"),Z1.fromRepresentation(new GJ(4,2),"clockwise")],$localize`Congratulations!`,$localize`Failed, try to move one of your piece that is already on the board.`),wQ.fromMove($localize`Special case`,$localize`It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!`,J1.fromRepresentation([[e0,e0,e0,e0,t0,e0,e0,e0],[e0,e0,e0,e0,i0,e0,e0,t0],[e0,e0,e0,e0,t0,e0,e0,i0],[e0,r0,e0,e0,n0,e0,e0,r0]],8),[Z1.fromRepresentation(new GJ(4,2),"counterclockwise")],$localize`Congratulations!`,$localize`Failed, try to shift a stack of pieces to the left.`)]}}function o0(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"path",6),Ca("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),da(2,"path",7),Ca("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Pa("id","click_",e,""),ua("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.BOARD_PATHS[e]),Ts(1),ua("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.DECORATION_PATHS[e])}}function a0(e,t){if(1&e){const e=ya();Cn(),da(0,"g",9),Ca("click",function(){const t=Gt(e).$implicit,n=ba().$implicit;return ba().onPieceInGameClick(n,t.y)}),pa(1,"use",10),pa(2,"use",11),fa()}if(2&e){const e=t.$implicit;Oa("id","click_",ba().$implicit,"_",e.y,""),ua("ngClass",e.foregroundClasses),Ts(1),ua("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}function c0(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,a0,3,8,"g",8),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",n.viewInfo.boardInfo[e].pieces)}}function l0(e,t){if(1&e){const e=ya();Cn(),da(0,"g",12),Ca("click",function(){const t=Gt(e).$implicit;return ba().onRemainingPieceClick(t.actualPiece)}),pa(1,"use",10),pa(2,"use",11),fa()}if(2&e){const e=t.$implicit;Oa("id","piece_",e.actualPiece.owner.value,"_",e.actualPiece.otherPieceType?1:0,""),ua("ngClass",e.foregroundClasses),Ts(1),ua("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}const u0=function(){return[0,1,2,3,4,5,6,7]},h0=function(){return[2,1,3,0,4,7,5,6]};class d0 extends jJ{constructor(e){super(e),this.BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],this.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],this.selected=vw.empty(),this.viewInfo={boardInfo:[],remainingPieces:[]},this.rules=Q1.get(),this.availableMinimaxes=[new X1(this.rules,"DiamDummyMinimax")],this.encoder=Y1,this.tutorial=(new s0).tutorial}ngOnInit(){this.updateBoard()}onSpaceClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#click_"+e);return n.isFailure()?t.cancelMove(n.getReason()):t.onSpaceClickAfterCheck(e)})()}onSpaceClickAfterCheck(e){var t=this;return dw(function*(){if(t.selected.isPresent()){const n=t.selected.get();let r;if("pieceFromReserve"===n.type)r=new j1(e,n.piece);else if((n.position.x+1)%J1.WIDTH===e)r=new Z1(n.position,"clockwise");else{if((n.position.x+(J1.WIDTH-1))%J1.WIDTH!==e)return t.cancelMove(K1.MUST_SHIFT_TO_NEIGHBOR());r=new Z1(n.position,"counterclockwise")}return t.chooseMove(r,t.getState())}return t.cancelMove(K1.MUST_SELECT_PIECE_FIRST())})()}onPieceInGameClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=vw.of({type:"pieceFromBoard",position:new GJ(e,t)}),n.updateViewInfo(),kG.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE())})()}onRemainingPieceClick(e){var t=this;return dw(function*(){const n=t.canUserPlay(t.getPieceId(e));return n.isFailure()?t.cancelMove(n.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=vw.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),kG.SUCCESS):t.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE())})()}getPieceId(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}getLastMovedFromDrop(e,t){const n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),s=this.getDrawPositionOnBoard(r,i),o=new GJ(r,i);return[{start:vw.empty(),end:o,startDrawPosition:n,endDrawPosition:s}]}getLastMovedFromShift(e,t){const n=e.start.x,r=e.getTarget();let i=t.getStackHeight(r);const s=[];for(let o=e.start.y;o<J1.HEIGHT&&t.getPieceAtXY(n,o)!==W1.EMPTY;o++,i++)s.push({start:vw.of(new GJ(n,o)),end:new GJ(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return s}updateViewInfo(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}updateBoardInfo(){for(let e=0;e<J1.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}showLastMove(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}showLastMoveOnSpaces(){const e=this.rules.node.move;MG(e.isPresent(),"showLastMoveOnSpaces called without a last move");const t=e.get();for(let n=0;n<J1.WIDTH;n++){const e=[];t.isDrop()?t.getTarget()===n&&e.push("moved"):(t.getTarget()===n||t.start.x===n)&&e.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=e}}showLastMoveOnPieces(){const e=this.rules.node.move;MG(e.isPresent(),"showLastMoveOnPieces called without a last move");const t=e.get(),n=this.getPreviousState();let r=[];r=t.isDrop()?this.getLastMovedFromDrop(t,n):this.getLastMovedFromShift(t,n);for(const i of r)this.viewInfo.boardInfo[i.end.x].pieces[i.end.y].foregroundClasses.push("last-move")}updateRemainingPiecesInfo(){const e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];const t=this.isPlayerTurn();for(const n of W1.PLAYER_PIECES){const r=this.getState().getRemainingPiecesOf(n);for(let i=0;i<r;i++){const s=[];this.isTopPieceOfReserveAndSelected(i,r,n)&&s.push("selected"),t&&i===r-1&&n.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+n.owner.value+(n.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionRemainingPiece(n,i),actualPiece:n})}}}isTopPieceOfReserveAndSelected(e,t,n){if(this.selected.isPresent()){const r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}getDrawPositionRemainingPiece(e,t){let n,r;return n=e.owner===VY.ZERO?-100:600,r=e.otherPieceType?100:450,new GJ(n,r).getNext(new VJ(0,-t*d0.PIECE_HEIGHT))}getPieces(e){const t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[];for(let i=0;i<J1.HEIGHT;i++){const s=this.getState().getPieceAtXY(e,i),o=new GJ(e,i);if(s!==W1.EMPTY){const a=[];this.pieceFromBoardIsSelected(e,i)&&a.push("selected"),this.isVictory(e,i,t)&&a.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&a.push("clickable-hover"),r.push({backgroundClasses:["player"+s.owner.value+(s.otherPieceType?"-alternate":"")],foregroundClasses:a,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:s})}}return r}pieceFromBoardIsSelected(e,t){if(this.selected.isPresent()){const n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}isVictory(e,t,n){if(n.isPresent()){const r=n.get();return r.x%4==e%4&&r.y===t}return!1}getDrawPositionOnBoard(e,t){return d0.CENTER[e].getNext(new VJ(0,-t*d0.PIECE_HEIGHT))}cancelMoveAttempt(){this.selected=vw.empty(),this.updateBoard()}}d0.CENTER=[new GJ(40,160),new GJ(100,50),new GJ(255,2),new GJ(400,50),new GJ(460,160),new GJ(400,270),new GJ(255,320),new GJ(100,270)],d0.PIECE_HEIGHT=36,d0.\u0275fac=function(e){return new(e||d0)(la(WJ))},d0.\u0275cmp=Xe({type:d0,selectors:[["app-diam"]],features:[Ho],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"defs"),da(2,"g",1),pa(3,"path",2),pa(4,"ellipse",3),fa(),fa(),aa(5,o0,3,5,"g",4),aa(6,c0,2,1,"g",4),aa(7,l0,3,8,"g",5),fa()),2&e&&(Ts(5),ua("ngForOf",ou(3,u0)),Ts(1),ua("ngForOf",ou(4,h0)),Ts(1),ua("ngForOf",t.viewInfo.remainingPieces))},directives:[Ud,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class f0{constructor(e,t){this.offset=e,this.constant=t}static fromTwoCoords(e,t){const n=e.x,r=t.x,i=e.y,s=t.y,o=n+i,a=r+s;return n===r&&i!==s&&o!==a?vw.of(f0.constantQ(n)):n!==r&&i===s&&o!==a?vw.of(f0.constantR(i)):n!==r&&i!==s&&o===a?vw.of(f0.constantS(o)):vw.empty()}static constantQ(e){return new f0(e,"q")}static constantR(e){return new f0(e,"r")}static constantS(e){return new f0(e,"s")}static areOnSameLine(e){if(e.length<2)return!0;const t=f0.fromTwoCoords(e[0],e[1]);if(t.isAbsent())return!1;const n=t.get();for(const r of e.slice(2))if(!1===n.contains(r))return!1;return!0}toString(){return`Line(${this.constant}, ${this.offset})`}equals(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}contains(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}getDirection(){switch(this.constant){case"q":return KJ.DOWN;case"r":return KJ.RIGHT;case"s":return KJ.DOWN_LEFT}}}class p0 extends aQ{constructor(e,t,n,r,i,s){super(t,e),this.board=t,this.width=n,this.height=r,this.excludedCases=i,this.empty=s,MG(this.excludedCases.length<this.height/2+1,"Invalid excluded cases specification for HexagonalGameState.")}static neighbors(e,t){return[new GJ(e.x+t,e.y-t),new GJ(e.x+t,e.y),new GJ(e.x-t,e.y+t),new GJ(e.x-t,e.y),new GJ(e.x,e.y+t),new GJ(e.x,e.y-t)]}setAt(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}equalsT(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(let n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;for(const n of this.allCoords())if(!1===t(this.getPieceAt(n),e.getPieceAt(n)))return!1;return!0}allCoords(){const e=[];return this.forEachCoord(t=>{e.push(t)}),e}allLines(){const e=[];for(let t=0;t<this.width;t++)e.push(f0.constantQ(t));for(let t=0;t<this.height;t++)e.push(f0.constantR(t));for(let t=this.excludedCases.length;t<this.height+this.excludedCases.length;t++)e.push(f0.constantS(t));return e}getEntranceOnLine(e){let t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new GJ(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new GJ(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new GJ(e.offset,0):new GJ(this.width-1,e.offset-this.width+1))}}findEntranceFrom(e,t){const n=e.getDirection();let r=t;for(let s=0;s<Math.max(this.width,this.height);s++){if(this.isOnBoard(r))return r;r=r.getNext(n)}const i=NG.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(i.getReason())}}class g0{constructor(e,t,n){this.owner=e,this.size=t,this.source=n}static append(e,t){return new g0(e.owner,e.size+t.size,e.source||t.source)}getValue(){return g0.encoder.encodeNumber(this)}getOwner(){return this.owner}belongsTo(e){return this.owner===e}containsSource(){return this.source}isEmpty(){return 0===this.size}getSize(){return this.size}toString(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}g0.sizeEncoder=BY.numberEncoder(49),g0.encoder=BY.tuple([BY.booleanEncoder,VY.numberEncoder,g0.sizeEncoder],e=>[e.source,e.owner,e.size],e=>new g0(e[1],e[2],e[0])),g0.MAX_SIZE=49,g0.EMPTY=new g0(VY.NONE,0,!1),g0.NONE=new g0(VY.NONE,-1,!1),g0.PLAYER_ZERO=new g0(VY.ZERO,1,!1),g0.PLAYER_ONE=new g0(VY.ONE,1,!1),g0.SOURCE=new g0(VY.NONE,1,!0);let m0=(()=>{class e extends p0{constructor(t,n,r){super(n,t,e.WIDTH,e.HEIGHT,e.EXCLUDED_CASES,g0.EMPTY),this.alreadyPassed=r}static balancedBoard(){const e=g0.NONE,t=g0.PLAYER_ZERO,n=g0.PLAYER_ONE,r=g0.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}static isOnBoard(t){return!t.isNotInRange(e.WIDTH,e.HEIGHT)&&e.balancedBoard()[t.y][t.x]!==g0.NONE}static getInitialState(){return new e(e.balancedBoard(),0,!1)}getAllPieces(){const t=[];for(let n=0;n<e.HEIGHT;n++)for(let r=0;r<e.WIDTH;r++){const e=new GJ(r,n);this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()&&t.push(e)}return t}numberOfNeighbors(e){return p0.neighbors(e,1).filter(e=>this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()).length}setAtUnsafe(t,n){const r=LG.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.turn,this.alreadyPassed)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==g0.NONE}}return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e})();class y0 extends fX{constructor(e,t){super(e,t)}static of(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return y0.PASS;if(!m0.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!m0.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new y0(e,t);if(e.x===t.x)return new y0(e,t);if(e.x+e.y===t.x+t.y)return new y0(e,t);throw new Error("Invalid move")}toString(){return this===y0.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}length(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}y0.PASS=new y0(new GJ(-1,-1),new GJ(-2,-2)),y0.encoder=new class extends BY{maxValue(){return 42148}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return y0.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new y0(new GJ((e=e/16|0)%16,r),new GJ(n,t))}};let v0=(()=>{class e{}return e.NOT_PLAYER_PIECE=()=>$localize`You must select a piece or a stack of your color.`,e.EMPTY_STACK=()=>$localize`You must select a stack.`,e.TOO_MANY_NEIGHBORS=()=>$localize`This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors.`,e.CANT_REACH_TARGET=()=>$localize`This stack cannot move because it could never land on another piece.`,e.INVALID_MOVE_LENGTH=()=>$localize`A stack must always be moved by as many spaces as there are pieces in the stack.`,e.EMPTY_TARGET_STACK=()=>$localize`The stack must land on an occupied space.`,e})();class _0 extends vQ{static getGameStatus(e){const t=e.gameState,n=_0.getScores(t);return 0===_0.getMovablePieces(t).length?n[0]>n[1]?yQ.ZERO_WON:n[0]<n[1]?yQ.ONE_WON:yQ.DRAW:yQ.ONGOING}static getMovablePieces(e){return _0.getFreePieces(e).filter(t=>_0.pieceHasTarget(e,t))}static getFreePieces(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6)}static pieceHasTarget(e,t){const n=e.getPieceAt(t).getSize();return void 0!==p0.neighbors(t,n).find(t=>e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty())}static pieceTargets(e,t){const n=e.getPieceAt(t).getSize();return p0.neighbors(t,n).filter(t=>e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty())}static getScores(e){let t=0,n=0;return e.getAllPieces().map(r=>{const i=e.getPieceAt(r);i.belongsTo(VY.ZERO)?t+=i.getSize():i.belongsTo(VY.ONE)&&(n+=i.getSize())}),[t,n]}isMovablePiece(e,t){MG(e.isOnBoard(t),"piece is not on the board");const n=e.getPieceAt(t);return n.getSize()<1?kG.failure(v0.EMPTY_STACK()):n.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?kG.failure(v0.TOO_MANY_NEIGHBORS()):_0.pieceHasTarget(e,t)?kG.SUCCESS:kG.failure(v0.CANT_REACH_TARGET()):kG.failure(v0.NOT_PLAYER_PIECE())}canOnlyPass(e){return 0===_0.getMovablePieces(e).length}sourceCoords(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).containsSource())}markPiecesConnectedTo(e,t,n){p0.neighbors(t,1).forEach(t=>{e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,this.markPiecesConnectedTo(e,t,n))})}removeDisconnectedPieces(e){const t=LG.createTable(m0.WIDTH,m0.HEIGHT,!1);this.sourceCoords(e).forEach(n=>{t[n.y][n.x]=!0,this.markPiecesConnectedTo(e,n,t)});let n=e;return n.getAllPieces().forEach(e=>{t[e.y][e.x]||(n=n.setAt(e,g0.EMPTY))}),n}applyLegalMove(e,t,n){if(e===y0.PASS)return new m0(t.board,t.turn+1,!0);{const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end),i=t.setAt(e.coord,g0.EMPTY).setAt(e.end,g0.append(n,r));return this.removeDisconnectedPieces(new m0(i.board,t.turn+1,!1))}}isLegal(e,t){if(0===_0.getMovablePieces(t).length)return e!==y0.PASS||t.alreadyPassed?OG.failure(tQ.MUST_PASS()):OG.success(void 0);if(e===y0.PASS)return OG.failure(tQ.CANNOT_PASS());const n=this.isMovablePiece(t,e.coord);if(n.isFailure())return n.toFailedFallible();const r=t.getPieceAt(e.coord);return e.length()!==r.getSize()?OG.failure(v0.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?OG.failure(v0.EMPTY_TARGET_STACK()):OG.success(void 0)}getGameStatus(e){return _0.getGameStatus(e)}}class C0 extends nQ{getListMoves(e){const t=e.move,n=e.gameState,r=[];return _0.getMovablePieces(n).forEach(e=>_0.pieceTargets(n,e).forEach(t=>{const n=y0.of(e,t);r.push(n)})),0===r.length&&!1===t.equalsValue(y0.PASS)&&r.push(y0.PASS),r}getBoardValue(e){const t=e.gameState,n=_0.getScores(t);return 0===_0.getMovablePieces(t).length?new rQ(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new rQ(n[0]-n[1])}}class E0 extends C0{getListMoves(e){const t=e.gameState,n=super.getListMoves(e),r=t.getCurrentPlayer().getOpponent();return LG.sortByDescending(n,e=>{MG(e!==y0.PASS,"Cannot sort with DvonnMove.PASS");const n=t.getPieceAt(e.end);return n.belongsTo(r)?n.getSize():0}),n}getBoardValue(e){const t=_0.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState,r=_0.getScores(n),i=n.getAllPieces(),s=i.length,o=i.filter(e=>n.getPieceAt(e).belongsTo(VY.ZERO)).length,a=i.filter(e=>n.getPieceAt(e).belongsTo(VY.ONE)).length;return new rQ((a*r[1]-o*r[0])/s)}}const w0=g0.EMPTY,b0=g0.NONE,S0=g0.SOURCE,P0=g0.PLAYER_ZERO,O0=g0.PLAYER_ONE,T0=new g0(VY.ZERO,2,!1),I0=new g0(VY.ONE,2,!1),k0=new g0(VY.ZERO,4,!1),A0=new g0(VY.ONE,4,!1);class N0{constructor(){this.tutorial=[wQ.anyMove($localize`Moving`,$localize`At Dvonn, each hexagonal space contains a stack of pieces.
        If no number is indicated on a stack, it means that it only contains one piece.
        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.
        The owner of a stack is the one that has a piece at the top of the stack.
        Only the owner of a stack can move it.
        A stack cannot be moved if it is surrounded by 6 other stacks.
        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.
        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.
        Therefore, there are six possible directions.
        The player with dark pieces starts.<br/><br/>
        You're playing Dark, click on a stack and move it by one space.`,m0.getInitialState(),y0.of(new GJ(2,0),new GJ(3,0)),$localize`Congratulations!`),wQ.fromPredicate($localize`Disconnection`,$localize`Pieces with a lightning strike are called "sources".
        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>
        You're playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!`,new m0([[b0,b0,O0,S0,w0,w0,w0,w0,w0,w0,w0],[b0,w0,P0,w0,w0,w0,w0,w0,w0,w0,w0],[w0,w0,A0,w0,w0,w0,w0,O0,S0,w0,w0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,w0,b0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,b0,b0]],0,!1),y0.of(new GJ(2,1),new GJ(2,0)),(e,t)=>e.end.equals(new GJ(3,0))?kG.failure($localize`You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it.`):(MG(e.end.equals(new GJ(2,0)),"player made an impossible move"),kG.SUCCESS),$localize`Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!
        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.
        Disconnected stacks will not be visible at the next turn.`),wQ.fromPredicate($localize`Moving on a source`,$localize`You are allowed to move your stacks on any other stack.
        This means that you can take control of a source by moving one of your stack on top of it.
        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>
        You're playing Dark and you can take control of a source, do it!`,new m0([[b0,b0,S0,O0,w0,w0,w0,w0,w0,w0,w0],[b0,P0,P0,w0,w0,w0,w0,w0,w0,w0,w0],[w0,O0,P0,O0,w0,w0,P0,I0,S0,w0,w0],[w0,w0,O0,w0,w0,w0,w0,w0,w0,w0,b0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,b0,b0]],0,!1),y0.of(new GJ(2,1),new GJ(2,0)),(e,t)=>e.end.equals(new GJ(2,0))?kG.SUCCESS:kG.failure($localize`You have not taken possession of a source, try again.`),$localize`Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!`),wQ.informational($localize`Passing`,$localize`It can happen that you have no possible move to make.
        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>
        This is a situation that occurs here for Dark.`,new m0([[b0,b0,S0,w0,w0,w0,w0,w0,w0,w0,w0],[b0,w0,T0,w0,w0,w0,w0,w0,w0,w0,w0],[w0,w0,I0,w0,w0,w0,w0,I0,S0,k0,w0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,w0,b0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,b0,b0]],0,!1)),wQ.fromMove($localize`End of the game`,$localize`When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>
        Make your last move.`,new m0([[b0,b0,S0,w0,w0,w0,w0,w0,w0,w0,w0],[b0,w0,P0,w0,w0,w0,w0,w0,w0,w0,w0],[w0,w0,w0,w0,w0,w0,w0,w0,S0,k0,w0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,w0,b0],[w0,w0,w0,w0,w0,w0,w0,w0,w0,b0,b0]],0,!1),[y0.of(new GJ(2,1),new GJ(2,0))],$localize`Congratulations, you won 6 - 0!`,$localize`Bad idea, by moving on the source you would have won a point.`)]}}function M0(e,t){if(1&e&&(Cn(),pa(0,"circle",10)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ua("ngClass",n.getPieceClasses(e)),ra("cx",n.getCenterAt(t).x)("cy",n.getCenterAt(t).y)("r",n.SPACE_SIZE)}}function x0(e,t){if(1&e&&(Cn(),pa(0,"polygon",11)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("transform",1===e.getSize()?"translate("+(n.getCenterAt(t).x-18)+" "+(n.getCenterAt(t).y-16)+") scale(0.10)":"translate("+(n.getCenterAt(t).x-3)+" "+(n.getCenterAt(t).y-12)+") scale(0.07)")}}function R0(e,t){if(1&e){const e=ya();Cn(),da(0,"text",12),Ca("click",function(){Gt(e);const t=ba(2).$implicit;return ba().onClick(t.x,t.y)}),Da(1),fa()}if(2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("x",e.containsSource()?n.getCenterAt(t).x-7:n.getCenterAt(t).x)("y",n.getCenterAt(t).y),Ts(1),La(e.getSize())}}function D0(e,t){if(1&e){const e=ya();Cn(),da(0,"g",5),Ca("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t.x,t.y)}),pa(1,"polyline",6),aa(2,M0,1,4,"circle",7),aa(3,x0,1,1,"polygon",8),aa(4,R0,2,3,"text",9),fa()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Oa("id","click_",n.x,"_",n.y,""),Ts(1),ra("points",r.getHexaCoordsAt(n)),Ts(1),ua("ngIf",e.getSize()>0),Ts(1),ua("ngIf",e.containsSource()),Ts(1),ua("ngIf",e.getSize()>1)}}const L0=function(e){return[e]};function F0(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,D0,5,6,"g",4),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",au(1,L0,n.state.getPieceAt(e)))}}function B0(e,t){if(1&e&&(Cn(),da(0,"text",16),Da(1),fa()),2&e){const e=ba().$implicit,t=ba();ra("x",t.getCenterAt(e.coord).x)("y",t.getCenterAt(e.coord).y),Ts(1),La(e.caseContent.getSize())}}function V0(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"polyline",13),pa(2,"circle",14),aa(3,B0,2,3,"text",15),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ra("points",n.getHexaCoordsAt(e.coord)),Ts(1),Oa("id","captured_",e.coord.x,"_",e.coord.y,""),ua("ngClass",n.getPieceClasses(e.caseContent)),ra("cx",n.getCenterAt(e.coord).x)("cy",n.getCenterAt(e.coord).y)("r",n.SPACE_SIZE),Ts(1),ua("ngIf",e.caseContent.getSize()>1)}}function U0(e,t){if(1&e&&(Cn(),ga(0),pa(1,"polyline",17),pa(2,"polyline",17),ma()),2&e){const e=ba();Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().coord)),Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().end))}}function $0(e,t){if(1&e&&(Cn(),pa(0,"polyline",18)),2&e){const e=ba();ra("points",e.getHexaCoordsAt(e.chosen.get()))}}let z0=(()=>{class e extends ZJ{constructor(e){super(e),this.lastMove=vw.empty(),this.chosen=vw.empty(),this.disconnecteds=[],this.rules=new _0(m0),this.availableMinimaxes=[new C0(this.rules,"DvonnMinimax"),new E0(this.rules,"DvonnMinimaxMaximizeStacks")],this.encoder=y0.encoder,this.tutorial=(new N0).tutorial,this.SPACE_SIZE=30,this.canPass=!1,this.scores=vw.of(_0.getScores(this.rules.node.gameState)),this.hexaLayout=new JJ(1.5*this.SPACE_SIZE,new GJ(-this.SPACE_SIZE,2*this.SPACE_SIZE),XJ.INSTANCE),this.state=this.rules.node.gameState,this.hexaBoard=this.rules.node.gameState.board}hideLastMove(){this.lastMove=vw.empty()}updateBoard(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=vw.of(_0.getScores(this.state))}calculateDisconnecteds(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState;for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[n].length;r++){const i=new GJ(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){const s=t.getPieceAt(i),o=e.getPieceAt(i);if(s.isEmpty()&&!o.isEmpty()){const e={coord:new GJ(r,n),caseContent:o};this.disconnecteds.push(e)}}}}cancelMoveAttempt(){this.chosen=vw.empty()}pass(){var e=this;return dw(function*(){return MG(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),yield e.chooseMove(y0.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosen.isAbsent()?n.choosePiece(e,t):n.chosen.equalsValue(new GJ(e,t))?(n.cancelMoveAttempt(),kG.SUCCESS):yield n.chooseDestination(e,t)})()}choosePiece(e,t){const n=new GJ(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=vw.of(n),kG.SUCCESS):this.cancelMove(r.getReason())}chooseDestination(e,t){var n=this;return dw(function*(){const r=n.chosen.get(),i=new GJ(e,t),s=y0.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];const t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-dvonn"]],features:[Ho],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,F0,2,3,"g",1),aa(2,V0,4,8,"g",1),aa(3,U0,3,2,"ng-container",2),aa(4,$0,1,1,"polyline",3),fa()),2&e&&(Ts(1),ua("ngForOf",t.state.allCoords()),Ts(1),ua("ngForOf",t.disconnecteds),Ts(1),ua("ngIf",t.lastMove.isPresent()),Ts(1),ua("ngIf",t.chosen.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();var H0=(()=>(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(H0||(H0={})),H0))();class G0{constructor(e){this.value=e}static of(e){switch(e){case 0:return this.SMALL_BLACK;case 1:return this.SMALL_WHITE;case 2:return this.MEDIUM_BLACK;case 3:return this.MEDIUM_WHITE;case 4:return this.BIG_BLACK;case 5:return this.BIG_WHITE;case 6:return this.NONE;default:throw new Error("Invalid value "+e+" for EncapsulePiece")}}static ofSizeAndPlayer(e,t){return t===VY.ZERO&&e===H0.BIG?G0.BIG_BLACK:t===VY.ZERO&&e===H0.MEDIUM?G0.MEDIUM_BLACK:t===VY.ZERO&&e===H0.SMALL?G0.SMALL_BLACK:t===VY.ONE&&e===H0.BIG?G0.BIG_WHITE:t===VY.ONE&&e===H0.MEDIUM?G0.MEDIUM_WHITE:t===VY.ONE&&e===H0.SMALL?G0.SMALL_WHITE:G0.NONE}getPlayer(){switch(this){case G0.SMALL_BLACK:case G0.MEDIUM_BLACK:case G0.BIG_BLACK:return VY.ZERO;case G0.SMALL_WHITE:case G0.MEDIUM_WHITE:case G0.BIG_WHITE:return VY.ONE;default:return VY.NONE}}getSize(){switch(this){case G0.BIG_BLACK:case G0.BIG_WHITE:return H0.BIG;case G0.MEDIUM_BLACK:case G0.MEDIUM_WHITE:return H0.MEDIUM;case G0.SMALL_BLACK:case G0.SMALL_WHITE:return H0.SMALL;default:return fw.expectToBe(this,G0.NONE),H0.NONE}}belongsTo(e){return this.getPlayer()===e}equals(e){return this===e}toString(){switch(this){case G0.BIG_BLACK:return"BIG_BLACK";case G0.BIG_WHITE:return"BIG_WHITE";case G0.MEDIUM_BLACK:return"MEDIUM_BLACK";case G0.MEDIUM_WHITE:return"MEDIUM_WHITE";case G0.SMALL_BLACK:return"SMALL_BLACK";case G0.SMALL_WHITE:return"SMALL_WHITE";default:return fw.expectToBe(this,G0.NONE),"NONE"}}}G0.SMALL_BLACK=new G0(0),G0.SMALL_WHITE=new G0(1),G0.MEDIUM_BLACK=new G0(2),G0.MEDIUM_WHITE=new G0(3),G0.BIG_BLACK=new G0(4),G0.BIG_WHITE=new G0(5),G0.NONE=new G0(6);class q0 extends aQ{constructor(e,t,n){super(e,t),this.remainingPieces=n}static getInitialState(){const e=new W0(VY.NONE,VY.NONE,VY.NONE).encode(),t=LG.createTable(3,3,e),n=LG.mapBiArray(t,e=>W0.decode(e));return new q0(n,0,[G0.BIG_BLACK,G0.BIG_BLACK,G0.BIG_WHITE,G0.BIG_WHITE,G0.MEDIUM_BLACK,G0.MEDIUM_BLACK,G0.MEDIUM_WHITE,G0.MEDIUM_WHITE,G0.SMALL_BLACK,G0.SMALL_BLACK,G0.SMALL_WHITE,G0.SMALL_WHITE])}getRemainingPieces(){return LG.copyImmutableArray(this.remainingPieces)}getRemainingPiecesOfPlayer(e){return this.getRemainingPieces().filter(t=>t.getPlayer()===e)}pieceBelongsToCurrentPlayer(e){return e.belongsTo(this.getCurrentPlayer())}isDroppable(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}isInRemainingPieces(e){return this.remainingPieces.some(t=>t===e)}getPlayerRemainingPieces(){return this.remainingPieces.filter(e=>this.pieceBelongsToCurrentPlayer(e))}}class W0{constructor(e,t,n){this.small=e,this.medium=t,this.big=n}static decode(e){MG(e%1==0,"EncapsuleCase must be encoded as integer: "+e),MG(e>=0,"To small representation for EncapsuleCase: "+e),MG(e<=26,"To big representation for EncapsuleCase: "+e);const t=VY.of(e%3);e-=t.value;const n=VY.of((e/=3)%3);e-=n.value;const r=VY.of(e/=3);return new W0(t,n,r)}isEmpty(){return this.small===VY.NONE&&this.medium===VY.NONE&&this.big===VY.NONE}toList(){const e=[];return this.small!==VY.NONE&&e.push(G0.ofSizeAndPlayer(H0.SMALL,this.small)),this.medium!==VY.NONE&&e.push(G0.ofSizeAndPlayer(H0.MEDIUM,this.medium)),this.big!==VY.NONE&&e.push(G0.ofSizeAndPlayer(H0.BIG,this.big)),e}toOrderedPieceNames(){const e=G0.ofSizeAndPlayer(H0.SMALL,this.small),t=G0.ofSizeAndPlayer(H0.MEDIUM,this.medium),n=G0.ofSizeAndPlayer(H0.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}getBiggest(){return this.big===VY.ZERO?G0.BIG_BLACK:this.big===VY.ONE?G0.BIG_WHITE:this.medium===VY.ZERO?G0.MEDIUM_BLACK:this.medium===VY.ONE?G0.MEDIUM_WHITE:this.small===VY.ZERO?G0.SMALL_BLACK:this.small===VY.ONE?G0.SMALL_WHITE:G0.NONE}tryToSuperposePiece(e){const t=this.getBiggest().getSize();if(e===G0.NONE)throw new Error("Cannot move NONE on a space");return e.getSize()>t?vw.of(this.put(e)):vw.empty()}removeBiggest(){const e=this.getBiggest();if(e===G0.NONE)throw new Error("Cannot removed piece from empty space");let t;const n=e.getSize();switch(n){case H0.BIG:t=new W0(this.small,this.medium,VY.NONE);break;case H0.MEDIUM:t=new W0(this.small,VY.NONE,VY.NONE);break;default:fw.expectToBe(n,H0.SMALL),t=new W0(VY.NONE,VY.NONE,VY.NONE)}return{removedCase:t,removedPiece:e}}put(e){if(e===G0.NONE)throw new Error("Cannot put NONE on space");const t=e.getPlayer(),n=e.getSize();switch(n){case H0.BIG:return new W0(this.small,this.medium,t);case H0.MEDIUM:return MG(this.big===VY.NONE,"Cannot put a piece on top of a bigger one"),new W0(this.small,t,this.big);default:return fw.expectToBe(n,H0.SMALL),MG(this.big===VY.NONE,"Cannot put a piece on top of a bigger one"),MG(this.medium===VY.NONE,"Cannot put a piece on top of a bigger one"),new W0(t,this.medium,this.big)}}encode(){return this.small.value+3*this.medium.value+9*this.big.value}belongsTo(e){return this.getBiggest().getPlayer()===e}toString(){const e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}W0.EMPTY=new W0(VY.NONE,VY.NONE,VY.NONE);let j0=(()=>{class e{}return e.PIECE_OUT_OF_STOCK=()=>$localize`You do not have pieces of this type anymore.`,e.INVALID_PLACEMENT=()=>$localize`You must put your piece on an empty square or on a smaller piece.`,e.NOT_DROPPABLE=()=>$localize`You must pick your piece among the remaining ones.`,e.INVALID_PIECE_SELECTED=()=>$localize`You must pick one of your remaining pieces or one piece on the board that is the biggest of its square.`,e.SAME_DEST_AS_ORIGIN=()=>$localize`You must select a different landing square than the square where the move originates from.`,e.END_YOUR_MOVE=()=>$localize`You are performing a move, you must select a landing square.`,e})();class Z0 extends vQ{static isVictory(e){const t=e.getCopiedBoard();let n,r=vw.empty(),i=0;for(;r.isAbsent()&&i<8;)n=Z0.LINES[i++],r=Z0.isVictoriousLine([t[n[0].y][n[0].x],t[n[1].y][n[1].x],t[n[2].y][n[2].x]]);return r}static isVictoriousLine(e){const t=e.map(e=>e.getBiggest()).map(e=>e.getPlayer());return t[0]===VY.NONE?vw.empty():t[0]===t[1]&&t[1]===t[2]?vw.of(t[0]):vw.empty()}static isLegal(e,t){let n;if(pw(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return OG.failure(j0.PIECE_OUT_OF_STOCK())}else{const r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE())}const r=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return r.isPresent()?OG.success(r.get()):OG.failure(j0.INVALID_PLACEMENT())}isLegal(e,t){return Z0.isLegal(e,t)}applyLegalMove(e,t,n){const r=t.getCopiedBoard();let i=t.getRemainingPieces();const s=t.turn+1;let o;if(r[e.landingCoord.y][e.landingCoord.x]=W0.decode(n.encode()),e.isDropping()){o=e.piece.get();const t=i.indexOf(o);i=i.slice(0,t).concat(i.slice(t+1))}else{const t=e.startingCoord.get(),n=r[t.y][t.x].encode(),i=W0.decode(n).removeBiggest();r[t.y][t.x]=W0.decode(i.removedCase.encode()),o=i.removedPiece}return new q0(r,s,i)}static getGameStatus(e){const t=Z0.isVictory(e.gameState);return t.isPresent()?yQ.getVictory(t.get()):yQ.ONGOING}getGameStatus(e){return Z0.getGameStatus(e)}}Z0.LINES=[[new GJ(0,0),new GJ(0,1),new GJ(0,2)],[new GJ(1,0),new GJ(1,1),new GJ(1,2)],[new GJ(2,0),new GJ(2,1),new GJ(2,2)],[new GJ(0,0),new GJ(1,0),new GJ(2,0)],[new GJ(0,1),new GJ(1,1),new GJ(2,1)],[new GJ(0,2),new GJ(1,2),new GJ(2,2)],[new GJ(0,0),new GJ(1,1),new GJ(2,2)],[new GJ(0,2),new GJ(1,1),new GJ(2,0)]];class Y0 extends lQ{constructor(e,t,n){super(),this.startingCoord=e,this.landingCoord=t,this.piece=n}static fromMove(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new Y0(vw.of(e),t,vw.empty())}static fromDrop(e,t){return new Y0(vw.empty(),t,vw.of(e))}isDropping(){return this.startingCoord.isAbsent()}equals(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}toString(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}Y0.encoder=new class extends BY{maxValue(){return 161}encodeNumber(e){const t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){const r=0;return 18*e.piece.get().value+6*t+2*n+r}{const r=1,i=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*i+6*t+2*n+r}}decodeNumber(e){const t=e%2;e-=t;const n=(e/=2)%3;e-=n;const r=(e/=3)%3;e-=r,e/=3;const i=new GJ(r,n);if(0===t){const t=G0.of(e);return Y0.fromDrop(t,i)}{const t=e%3;e-=t;const n=new GJ((e/=3)%3,t);return Y0.fromMove(n,i)}}};class K0 extends nQ{getBoardValue(e){const t=Z0.getGameStatus(e);return new rQ(t.toBoardValue())}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),s=iQ.toComparableObjectSet(n.getPlayerRemainingPieces());for(let o=0;o<3;o++)for(let e=0;e<3;e++){const a=new GJ(e,o);for(const e of s){const r=Y0.fromDrop(e,a);Z0.isLegal(r,n).isSuccess()&&t.push(r)}if(r[o][e].belongsTo(i))for(let e=0;e<3;e++)for(let r=0;r<3;r++){const i=new GJ(r,e);if(!i.equals(a)){const e=Y0.fromMove(a,i);Z0.isLegal(e,n).isSuccess()&&t.push(e)}}}return t}}const J0=new W0(VY.NONE,VY.NONE,VY.NONE),Q0=new W0(VY.ZERO,VY.NONE,VY.NONE),X0=new W0(VY.NONE,VY.ZERO,VY.NONE),e2=new W0(VY.NONE,VY.NONE,VY.ZERO),t2=new W0(VY.ONE,VY.NONE,VY.NONE),n2=new W0(VY.NONE,VY.NONE,VY.ONE),r2=new W0(VY.ONE,VY.ZERO,VY.NONE),i2=new W0(VY.ZERO,VY.ZERO,VY.NONE);class s2{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`The goal of Encapsule is to align three of your pieces.
        Here, we have a victory of the dark player.`,new q0([[Q0,t2,n2],[J0,X0,J0],[J0,J0,e2]],0,[G0.SMALL_BLACK,G0.MEDIUM_BLACK,G0.BIG_BLACK,G0.SMALL_WHITE,G0.MEDIUM_WHITE,G0.MEDIUM_WHITE,G0.BIG_WHITE])),wQ.anyMove($localize`Putting a piece`,$localize`This is the initial board. You're playing Dark.<br/><br/>
        Pick one of your piece on the side of the board and put it on the board.`,q0.getInitialState(),Y0.fromDrop(G0.SMALL_BLACK,new GJ(1,1)),$localize`Congratulations!`),wQ.fromMove($localize`Moving`,$localize`Another possible action is to move one of your pieces that is already on the board.<br/><br/>
        Click on your dark piece and then on any empty square of the board.`,new q0([[Q0,n2,J0],[J0,J0,J0],[J0,J0,J0]],0,[]),[Y0.fromMove(new GJ(0,0),new GJ(2,0)),Y0.fromMove(new GJ(0,0),new GJ(0,1)),Y0.fromMove(new GJ(0,0),new GJ(1,1)),Y0.fromMove(new GJ(0,0),new GJ(2,1)),Y0.fromMove(new GJ(0,0),new GJ(0,2)),Y0.fromMove(new GJ(0,0),new GJ(1,2)),Y0.fromMove(new GJ(0,0),new GJ(2,2))],$localize`Congratulations!`,$localize`Failed. Try again.`),wQ.fromPredicate($localize`Particularity`,$localize`At Encapsule, pieces encapsulate each other.
        It is therefore possible to have up to three pieces per square!
        However, only the biggest piece of each square counts:
        you cannot win with a piece that is "hidden" by a bigger piece.
        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.
        Finally, you cannot encapsulate a piece with a smaller piece.
        You're playing Dark and you can win now in various ways.<br/><br/>
        Try to win by making a move, and not by putting a new piece on the board.`,new q0([[r2,J0,t2],[i2,n2,n2],[J0,J0,J0]],0,[G0.MEDIUM_BLACK,G0.BIG_BLACK,G0.MEDIUM_WHITE,G0.MEDIUM_WHITE]),Y0.fromMove(new GJ(0,1),new GJ(0,2)),(e,t)=>{if(e.landingCoord.equals(new GJ(0,2))){if(e.isDropping())return kG.failure($localize`You won, but the exercise is to win while moving a piece!`);if(e.startingCoord.equalsValue(new GJ(0,1)))return kG.SUCCESS}return kG.failure($localize`Failed. Try again.`)},$localize`Congratulations!`)]}}function o2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",5),Ca("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(0,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Pa("id","piece_0_",e.toString(),""),ua("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(0,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}function a2(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",8),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onBoardClick(t,n)}),fa()}if(2&e){const e=t.$implicit,n=ba().index,r=ba().index,i=ba();ua("ngClass",i.getPieceClasses(e)),ra("r",i.getPieceRadius(e))("cx",i.SPACE_SIZE*n+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function c2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",6),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),aa(2,a2,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","click_",n,"_",r,""),ua("ngClass",i.getRectClasses(n,r)),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngForOf",i.getListPieces(e))}}function l2(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,c2,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function u2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",9),Ca("click",function(){const t=Gt(e).$implicit;return ba().onBoardClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function h2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",5),Ca("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(1,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Pa("id","piece_1_",e.toString(),""),ua("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(1,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}let d2=(()=>{class e extends rX{constructor(e){super(e),this.INTER_PIECE_SPACE=20,this.lastLandingCoord=vw.empty(),this.lastStartingCoord=vw.empty(),this.chosenCoord=vw.empty(),this.chosenPiece=vw.empty(),this.remainingPieceLeftX=[],this.rules=new Z0(q0),this.availableMinimaxes=[new K0(this.rules,"EncapsuleMinimax")],this.encoder=Y0.encoder,this.tutorial=(new s2).tutorial,this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard();const e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=vw.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=vw.empty(),this.lastStartingCoord=vw.empty())}getListPieces(e){return e.toList()}getRemainingPieces(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(VY.of(e))}onBoardClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new GJ(e,t),s=n.rules.node.gameState;if(n.chosenCoord.isAbsent()){if(n.chosenCoord=vw.of(i),n.chosenPiece.isPresent()){const e=Y0.fromDrop(n.chosenPiece.get(),i);return n.chooseMove(e,n.rules.node.gameState)}return!1===s.getPieceAt(i).belongsTo(s.getCurrentPlayer())?n.cancelMove(j0.INVALID_PIECE_SELECTED()):kG.SUCCESS}if(n.chosenCoord.equalsValue(i))return n.cancelMove(j0.SAME_DEST_AS_ORIGIN());{const e=Y0.fromMove(n.chosenCoord.get(),i);return n.chooseMove(e,n.rules.node.gameState)}})()}cancelMoveAttempt(){this.chosenCoord=vw.empty(),this.chosenPiece=vw.empty(),this.chosenPieceIndex=-1}onPieceClick(e,t,n){var r=this;return dw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t.toString());return i.isFailure()?r.cancelMove(i.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(j0.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=vw.of(t),r.chosenPieceIndex=n,kG.SUCCESS):r.cancelMove(j0.END_YOUR_MOVE())})()}getRectClasses(e,t){return this.isSelected(e,t)?"moved":""}isSelected(e,t){const n=new GJ(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}getPieceClasses(e){return[this.getPieceStrokeClass(e)]}getPieceStrokeClass(e){return"player"+e.getPlayer().value+"-stroke"}getPieceRadius(e){switch(e.getSize()){case H0.BIG:return 40;case H0.MEDIUM:return 30;default:return fw.expectToBe(e.getSize(),H0.SMALL),20}}getHighlightedCases(){const e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}getSidePieceClasses(e,t){const n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}isSelectedPiece(e){return this.chosenPiece.equalsValue(e)}calculateLeftX(){this.remainingPieceLeftX=[];for(let e=0;e<=1;e++){this.remainingPieceLeftX.push([]);const t=this.getRemainingPieces(e);for(let n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{const r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}getPieceLeftX(e,t){return this.remainingPieceLeftX[e][t]}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-encapsule"]],features:[Ho],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"g",null,1),aa(3,o2,2,5,"g",2),fa(),da(4,"g",null,3),aa(6,l2,2,1,"g",2),aa(7,u2,2,4,"g",2),fa(),da(8,"g",null,4),aa(10,h2,2,5,"g",2),fa(),fa()),2&e&&(Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", 0)"),Ts(2),ua("ngForOf",t.getRemainingPieces(0)),Ts(1),ra("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),Ts(2),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.getHighlightedCases()),Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),Ts(2),ua("ngForOf",t.getRemainingPieces(1)))},directives:[Ud,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class f2 extends uQ{constructor(e,t,n,r,i){if(super(e,t),this.movedPieces=n,this.stepSize=r,this.direction=i,this.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+this.coord.toString()+".");if(n<1)throw new Error("Must select minimum one piece (got "+n+").");if(r<1)throw new Error("Step size must be minimum one (got "+r+").");if(r>n)throw new Error("Cannot move a phalanx further than its size (got step size "+r+" for "+n+" pieces).")}toString(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}equals(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}f2.encoder=new class extends BY{maxValue(){return 122303}encodeNumber(e){const t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%8;e-=t;const n=(e/=8)%7;e-=n;const r=(e/=7)%13;e-=r;const i=(e/=13)%12;e-=i;const s=e/=12,o=zJ.factory.fromInt(t);return new f2(s,i,r+1,n+1,o.get())}};class p2 extends aQ{static getInitialState(){const e=VY.NONE,t=VY.ONE,n=VY.ZERO;return new p2([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[n,n,n,n,n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n,n,n,n,n]],0)}count(e,t){let n=0;for(let r=0;r<14;r++)this.board[t][r]===e&&n++;return n}doesOwnPiece(e){for(let t=0;t<12;t++)for(let n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}let g2=(()=>{class e{}return e.PHALANX_IS_LEAVING_BOARD=()=>$localize`The move distance of your phalanx puts it out of the board.`,e.SOMETHING_IN_PHALANX_WAY=()=>$localize`There is something in the way of your phalanx.`,e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=()=>$localize`Your phalanx must be bigger than the one you are capturing.`,e.CASE_NOT_ALIGNED_WITH_SELECTED=()=>$localize`This square is not aligned with the selected piece.`,e.SINGLE_PIECE_MUST_MOVE_BY_ONE=()=>$localize`A single piece can only move by one square.`,e.SINGLE_PIECE_CANNOT_CAPTURE=()=>$localize`A single piece cannot make a capture.`,e.CASE_NOT_ALIGNED_WITH_PHALANX=()=>$localize`This square is not aligned with the direction of the phalanx.`,e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=()=>$localize`A phalanx can't contain pieces outside of the board.`,e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=()=>$localize`A phalanx cannot contain an empty square.`,e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=()=>$localize`A phalanx cannot contain a piece of the opponent.`,e})();class m2 extends vQ{static isLegal(e,t){const n=this.getPhalanxValidity(t,e);if(n.isFailure())return OG.failure(n.getReason());const r=this.getLandingStatus(t,e);if(r.isFailure())return r;const i=LG.copyBiArray(r.get()),s=t.getCurrentOpponent(),o=m2.getCaptureValidity(t,i,e,s);return o.isFailure()?o:OG.success(o.get())}static getPhalanxValidity(e,t){let n,r=t.coord,i=0;const s=e.getCurrentOpponent();for(;i<t.movedPieces;){if(r.isNotInRange(14,12))return kG.failure(g2.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());if(n=e.getPieceAt(r),n===VY.NONE)return kG.failure(g2.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(n===s)return kG.failure(g2.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());r=r.getNext(t.direction,1),i++}return kG.SUCCESS}static getLandingStatus(e,t){const n=e.getCopiedBoard(),r=e.getCurrentPlayer();let i=t.coord,s=t.coord.getNext(t.direction,t.movedPieces),o=0;for(;o+1<t.stepSize;){if(n[i.y][i.x]=VY.NONE,n[s.y][s.x]=r,s.isNotInRange(14,12))return OG.failure(g2.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(s)!==VY.NONE)return OG.failure(g2.SOMETHING_IN_PHALANX_WAY());o++,s=s.getNext(t.direction,1),i=i.getNext(t.direction,1)}return s.isNotInRange(14,12)?OG.failure(g2.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(s)===r?OG.failure(tQ.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=VY.NONE,n[s.y][s.x]=r,OG.success(n))}static getCaptureValidity(e,t,n,r){let i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1);const s=VY.NONE;let o=0;for(;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(o>0&&(t[i.y][i.x]=s),o++,o>=n.movedPieces)return OG.failure(g2.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return OG.success(t)}isLegal(e,t){return m2.isLegal(e,t)}applyLegalMove(e,t,n){return new p2(n,t.turn+1)}getGameStatus(e){const t=e.gameState,n=t.count(VY.ZERO,0),r=t.count(VY.ONE,11);if(t.turn%2==0){if(n>r)return yQ.ZERO_WON}else if(r>n)return yQ.ONE_WON;return!1===t.doesOwnPiece(VY.ZERO)?yQ.ONE_WON:!1===t.doesOwnPiece(VY.ONE)?yQ.ZERO_WON:yQ.ONGOING}}class y2 extends nQ{static getListMoves(e){const t=e.gameState.getCurrentPlayer(),n=e.gameState.getCurrentOpponent(),r=VY.NONE;let i=[];const s=e.gameState;let o;for(let a=0;a<12;a++)for(let e=0;e<14;e++){const c=new GJ(e,a);if(s.getPieceAt(c)===t)for(const l of zJ.DIRECTIONS){let u=1,h=c.getNext(l,1);for(;h.isInRange(14,12)&&s.getPieceAt(h)===t;)u+=1,h=h.getNext(l,1);let d=1;for(;h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===r;)o=new f2(e,a,u,d,l),i=this.addMove(i,o,s),d++,h=h.getNext(l,1);h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===n&&(o=new f2(e,a,u,d,l),i=this.addMove(i,o,s))}}return i}static addMove(e,t,n){return m2.isLegal(t,n).isSuccess()&&e.push(t),e}getListMoves(e){const t=y2.getListMoves(e);return LG.sortByDescending(t,e=>e.stepSize),t}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new rQ(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}getPieceCountPlusRowDomination(e){let t=0;for(let n=0;n<12;n++){let r=0;const i=[0,0];for(let s=0;s<14;s++){const o=new GJ(s,n),a=e.getPieceAt(o);if(a!==VY.NONE){const n=a.getScoreModifier();t+=2002*n,i[a.value]=n,r+=n;for(const r of[zJ.UP_LEFT,zJ.UP,zJ.UP_RIGHT]){let i=o.getNext(r,1);for(;i.isInRange(14,12)&&e.getPieceAt(i)===a;)t+=1*n,i=i.getNext(r,1)}}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce((e,t)=>e+t)}return t}}class v2 extends nQ{getListMoves(e){const t=y2.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}orderMovesByPhalanxSizeAndFilter(e,t){return LG.sortByDescending(e,e=>e.movedPieces),e.length>40?e.filter(e=>!!this.moveIsCapture(e,t)||e.movedPieces*Math.random()>1):e}moveIsCapture(e,t){const n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new rQ(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}getPieceCountThenSupportThenAdvancement(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=new GJ(r,n),s=e.getPieceAt(i);if(s!==VY.NONE){let r,o;s===VY.ZERO?(r=12-n,o=[zJ.UP_LEFT,zJ.UP,zJ.UP_RIGHT]):(r=n+1,o=[zJ.DOWN_LEFT,zJ.DOWN,zJ.DOWN_RIGHT]);const a=s.getScoreModifier();t+=r*a,t+=149629*a;for(const n of o){let r=i.getNext(n,1);for(;r.isInRange(14,12)&&e.getPieceAt(r)===s;)t+=337*a,r=r.getNext(n,1)}}}return t}}class _2 extends y2{constructor(){super(...arguments),this.DOMINANCE_FACTOR=20,this.DEFENSE_FACTOR=5,this.TERRITORY_FACTOR=2,this.OFFENSE_FACTOR=10,this.CENTER_FACTOR=5,this.MOBILITY_FACTOR=.12}getDominance(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new GJ(r,n));i!==VY.NONE&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}getDefense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new GJ(n,11))===VY.ZERO&&(t+=VY.ZERO.getScoreModifier()),e.getPieceAt(new GJ(n,0))===VY.ONE&&(t+=VY.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}getTerritory(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new GJ(r,n));if(i!==VY.NONE){for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const a=new GJ(r+s,n+o);if(a.isInRange(14,12)){const n=e.getPieceAt(a);(n===i||n===VY.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}getOffense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new GJ(n,0))===VY.ZERO&&(t+=VY.ZERO.getScoreModifier()),e.getPieceAt(new GJ(n,11))===VY.ONE&&(t+=VY.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}getCenter(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new GJ(r,n));i!==VY.NONE&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}getMobility(e){let t=0,n=0,r=0;for(let i=0;i<12;i++)for(let s=0;s<14;s++){const o=new GJ(s,i),a=e.getPieceAt(o);if(a!==VY.NONE)for(const i of zJ.DIRECTIONS){let s=1,c=o.getNext(i,1);for(;c.isInRange(14,12)&&e.getPieceAt(c)===a;)s+=1,c=c.getNext(i,1);let l=1;for(;c.isInRange(14,12)&&l<=s&&e.getPieceAt(c)===VY.NONE;)l++,c=c.getNext(i,1);t+=l*l*a.getScoreModifier(),a===VY.ZERO?n=Math.max(n,l):a===VY.ONE&&(r=Math.max(r,l))}}return(t+n*VY.ZERO.getScoreModifier()+r*VY.ONE.getScoreModifier())*this.MOBILITY_FACTOR}getBoardValue(e){const t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new rQ(n.toBoardValue());const r=this.getDominance(t),i=this.getDefense(t),s=this.getTerritory(t),o=this.getCenter(t),a=this.getOffense(t),c=this.getMobility(t);return new rQ(r+i+s+o+a+c)}}const C2=VY.NONE,E2=VY.ZERO,w2=VY.ONE;class b2{constructor(){this.tutorial=[wQ.informational($localize`Initial board`,$localize`This is the initial board of Epaminondas.
        The top line is the starting line of Light.
        The bottom line is the starting line of Dark.`,p2.getInitialState()),wQ.informational($localize`Goal of the game (1/2)`,$localize`After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line
        than the number of pieces the opponent has on the player's starting line, the player wins.
        Here, it's Dark's turn to play: Dark has therefore won.`,new p2([[C2,C2,C2,C2,C2,E2,C2,C2,w2,w2,w2,w2,w2,w2],[C2,C2,C2,C2,C2,E2,C2,C2,C2,C2,C2,C2,w2,w2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,w2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,E2,E2,E2,E2,C2,C2,C2]],0)),wQ.informational($localize`Goal of the game (2/2)`,$localize`Here, it is Light's turn.
        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line.`,new p2([[C2,C2,C2,C2,C2,E2,C2,C2,C2,C2,w2,w2,w2,w2],[C2,C2,C2,C2,C2,E2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,w2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,w2,w2,C2,C2,C2,E2,E2,C2,E2,E2,E2,E2]],1)),wQ.fromPredicate($localize`Moving a piece`,$localize`Here is the starting board. Dark plays first.
        Let's start with moving a single piece:
        <ol>
            <li>Click on a piece.</li>
            <li>Click on a empty neighboring square.</li>
        </ol>`,p2.getInitialState(),new f2(0,10,1,1,zJ.UP),(e,t)=>1===e.movedPieces?kG.SUCCESS:kG.failure($localize`Congratulations, you are in advance. But this is not the exercise here, try again.`),$localize`This is how you move a single piece.`),wQ.fromPredicate($localize`Moving a phalanx`,$localize`Let us now see how to move multiple pieces along a line, which is called a phalanx:
        <ol>
            <li>Click on the first piece of the phalanx.</li>
            <li>Click on the last piece of the phalanx.</li>
            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>
        </ol><br/>
        Move a phalanx!`,p2.getInitialState(),new f2(0,11,2,1,zJ.UP),(e,t)=>e.movedPieces>1?kG.SUCCESS:kG.failure($localize`Failed! You moved only one piece.`),$localize`Congratulations!
        The moved pieces can be horizontally, vertically, or diagonally aligned.
        The move should be made along this axis, forward or backwards.
        There can be no opponent nor holes in the phalanx.`),wQ.fromMove($localize`Capture`,$localize`In order to capture pieces of the opponent:
        <ol>
            <li>It must be aligned with the phalanx you are moving.</li>
            <li>It must be strictly shorter than your phalanx.</li>
            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>
        </ol><br/>
        Capture a phalanx.`,new p2([[C2,C2,C2,C2,C2,C2,C2,C2,w2,w2,w2,w2,w2,w2],[C2,C2,C2,C2,C2,C2,w2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,w2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,w2,C2,w2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,w2,w2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,w2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,E2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,E2,C2,C2,C2,C2,w2,C2,C2,C2,C2,C2,C2],[C2,C2,E2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,E2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2,C2],[C2,C2,C2,C2,C2,C2,C2,E2,E2,E2,E2,E2,E2,E2]],0),[new f2(2,10,4,2,zJ.UP)],$localize`Congratulations, you made it!
        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment.`,$localize`Failed, you have not captured the phalanx.`)]}}function S2(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",4),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();ua("ngClass",n.getPieceClasses(e,t)),ra("r",.5*(n.SPACE_SIZE-2*n.STROKE_WIDTH))("cx",n.SPACE_SIZE*e+n.STROKE_WIDTH+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.STROKE_WIDTH+n.SPACE_SIZE/2)}}function P2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",2),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,S2,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Oa("id","click_",e,"_",n,""),ua("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e+r.STROKE_WIDTH)("y",r.SPACE_SIZE*n+r.STROKE_WIDTH)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ua("ngIf",r.board[n][e]!==r.NONE)}}function O2(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,P2,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function T2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",5),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let I2=(()=>{class e extends rX{constructor(e){super(e),this.NONE=VY.NONE,this.firstPiece=vw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=vw.empty(),this.phalanxDirection=vw.empty(),this.phalanxMiddles=[],this.moveds=[],this.captureds=[],this.rules=new m2(p2),this.availableMinimaxes=[new y2(this.rules,"Normal"),new v2(this.rules,"Positional"),new _2(this.rules,"Attack")],this.encoder=f2.encoder,this.tutorial=(new b2).tutorial,this.updateBoard()}updateBoard(){this.firstPiece=vw.empty(),this.lastPiece=vw.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}showPreviousMove(){const e=this.rules.node.move.get();let t=e.coord;this.moveds=[t];for(let i=1;i<e.stepSize+e.movedPieces;i++)t=t.getNext(e.direction,1),this.moveds.push(t);const n=this.rules.node.mother.get(),r=n.gameState.getCurrentOpponent();for(;t.isInRange(14,12)&&n.gameState.getPieceAt(t)===r;)this.captureds.push(t),t=t.getNext(e.direction,1)}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t)})()}firstClick(e,t){var n=this;return dw(function*(){const r=n.rules.node.gameState.getCurrentOpponent(),i=n.rules.node.gameState.getCurrentPlayer();switch(n.board[t][e]){case i:return n.firstPiece=vw.of(new GJ(e,t)),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),kG.SUCCESS;case r:return n.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE());default:return fw.expectToBe(n.board[t][e],VY.NONE),n.cancelMove(tQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())}})()}hidePreviousMove(){this.captureds=[],this.moveds=[]}getValidExtensions(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}getFirstPieceExtensions(e){const t=[];for(const n of zJ.DIRECTIONS){let r=this.firstPiece.get().getNext(n,1);for(;r.isInRange(14,12)&&this.board[r.y][r.x]===e;)t.push(r),r=r.getNext(n,1)}return t}getPhalanxValidExtensions(e){let t=zJ.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get();const n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();const i=this.firstPiece.get().getNext(t,1),s=this.getExtensionsToward(i,t,e);return r.concat(s)}getExtensionsToward(e,t,n){const r=[];for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}getPhalanxValidLandings(){if(this.lastPiece.isPresent()){const e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1;let s=zJ.factory.fromMove(e,t).get();const o=t.getNext(s,1),a=this.getLandingsToward(o,s,i);s=s.getOpposite();const c=e.getNext(s,1);return this.getLandingsToward(c,s,i).concat(a)}return this.getNeighbooringEmptyCases()}getNeighbooringEmptyCases(){const e=[];for(const t of zJ.DIRECTIONS){const n=this.firstPiece.get().getNext(t,1);n.isInRange(14,12)&&this.board[n.y][n.x]===VY.NONE&&e.push(n)}return e}getLandingsToward(e,t,n){const r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),s=[];for(;e.isInRange(14,12)&&s.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&s.push(e),s;s.push(e),e=e.getNext(t,1)}return s}getPhalanxLength(e,t,n){let r=0;for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}cancelMoveAttempt(){this.firstPiece=vw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=vw.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}secondClick(e,t){var n=this;return dw(function*(){const r=new GJ(e,t),i=n.firstPiece.get();if(r.equals(i))return n.cancelMoveAttempt(),kG.SUCCESS;const s=n.rules.node.gameState.getCurrentOpponent(),o=n.rules.node.gameState.getCurrentPlayer();if(!r.isAlignedWith(i))return n.cancelMove(g2.CASE_NOT_ALIGNED_WITH_SELECTED());const a=r.getDistance(i),c=i.getDirectionToward(r).get();switch(n.board[t][e]){case VY.NONE:return 1===a?n.tryMove(new f2(i.x,i.y,1,1,c)):n.cancelMove(g2.SINGLE_PIECE_MUST_MOVE_BY_ONE());case s:return n.cancelMove(g2.SINGLE_PIECE_CANNOT_CAPTURE());default:fw.expectToBe(n.board[t][e],o);const l=new f2(i.x,i.y,a,1,c),u=m2.getPhalanxValidity(n.rules.node.gameState,l);return u.isFailure()?n.cancelMove(u.getReason()):(n.lastPiece=vw.of(r),n.validExtensions=n.getValidExtensions(o),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=i.getCoordsToward(r),n.phalanxDirection=vw.of(c),kG.SUCCESS)}})()}thirdClick(e,t){var n=this;return dw(function*(){const r=n.rules.node.gameState.getCurrentPlayer(),i=new GJ(e,t);if(n.firstPiece.equalsValue(i))return n.moveFirstPiece(r);if(n.lastPiece.equalsValue(i))return n.moveLastPiece(r);const s=n.firstPiece.get(),o=n.lastPiece.get();if(!i.isAlignedWith(s))return n.cancelMove(g2.CASE_NOT_ALIGNED_WITH_PHALANX());let a=zJ.factory.fromMove(s,o).get();const c=zJ.factory.fromMove(s,i).get();if(a===c.getOpposite()&&(n.firstPiece=vw.of(o),n.lastPiece=vw.of(s),a=c),a!==c)return n.cancelMove(g2.CASE_NOT_ALIGNED_WITH_PHALANX());if(n.board[t][e]===r){n.lastPiece=vw.of(i);const e=n.firstPiece.get().getDistance(i)+1,t=new f2(n.firstPiece.get().x,n.firstPiece.get().y,e,1,a),s=m2.getPhalanxValidity(n.rules.node.gameState,t);return s.isFailure()?n.cancelMove(s.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(r),n.phalanxValidLandings=n.getPhalanxValidLandings(),kG.SUCCESS)}{const e=n.firstPiece.get().getDistance(n.lastPiece.get())+1,t=n.lastPiece.get().getDistance(i),r=new f2(n.firstPiece.get().x,n.firstPiece.get().y,e,t,a);return n.tryMove(r)}})()}moveFirstPiece(e){var t=this;return dw(function*(){return t.firstPiece=vw.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?yield t.moveOnlyPiece(e):(t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e)),t.phalanxValidLandings=t.getPhalanxValidLandings(),kG.SUCCESS})()}moveLastPiece(e){var t=this;return dw(function*(){return t.lastPiece=vw.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),kG.SUCCESS)})()}moveOnlyPiece(e){var t=this;return dw(function*(){return t.lastPiece=vw.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=vw.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),kG.SUCCESS})()}tryMove(e){const t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}getPieceClasses(e,t){const n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}getPieceStrokeClasses(e,t){const n=new GJ(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(e=>e.equals(n))?["highlighted"]:[]}getRectClasses(e,t){const n=new GJ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:this.moveds.some(e=>e.equals(n))?["moved"]:[]}getHighlightedCoords(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}getCurrentPlayerPieces(){const e=[],t=this.rules.node.gameState.getCurrentPlayer();for(let n=0;n<this.board.length;n++)for(let r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new GJ(r,n));return e}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-epaminondas"]],features:[Ho],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,O2,2,1,"g",1),aa(2,T2,2,4,"g",1),fa()),2&e&&(Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.getHighlightedCoords()))},directives:[Ud,Bd,zd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();function k2(e){return new class extends LY{encode(t){return t.isPresent()?e.encode(t.get()):null}decode(t){return null===t?vw.empty():vw.of(e.decode(t))}}}class A2{constructor(e){if(e.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===f0.areOnSameLine(e))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=LG.copyImmutableArray(e).sort((e,t)=>{if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});let t=vw.empty();for(const n of this.capturedSpaces){if(t.isPresent()&&1!==t.get().getDistance(n))throw new Error("Cannot create a GipfCapture with non-consecutive cases");t=vw.of(n)}}toString(){let e="";for(const t of this.capturedSpaces)""!==e&&(e+=","),e+=t.toString();return e}size(){return this.capturedSpaces.length}forEach(e){this.capturedSpaces.forEach(e)}contains(e){for(let t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}intersectsWith(e){return this.capturedSpaces.some(t=>e.contains(t))}getLine(){return f0.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}equals(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(let t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}A2.encoder=new class extends LY{encode(e){return e.capturedSpaces.map(e=>GJ.encoder.encode(e))}decode(e){return new A2(e.map(e=>GJ.encoder.decode(e)))}};class N2{constructor(e,t){this.coord=e,this.direction=t}toString(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}equals(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}N2.encoder=new class extends LY{constructor(){super(...arguments),this.optionalDirectionEncoder=k2(KJ.encoder)}encode(e){return{coord:GJ.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}decode(e){const t=e;return MG(null!=t.coord,"Invalid encoded GipfPlacement"),new N2(GJ.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}};class M2 extends lQ{constructor(e,t,n){super(),this.placement=e,this.initialCaptures=t,this.finalCaptures=n}toString(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}equals(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===LG.compareArray(this.initialCaptures,e.initialCaptures)||!1===LG.compareArray(this.finalCaptures,e.finalCaptures))}encode(){return M2.encoder.encode(this)}decode(e){return M2.encoder.decode(e)}}M2.encoder=new class extends FY{encodeMove(e){const t={placement:N2.encoder.encode(e.placement)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=A2.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=A2.encoder.encode(e)}),t}decodeMove(e){const t=e;return MG(null!=t.placement,"Invalid encoded GipfMove"),new M2(N2.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",A2.encoder.decode),this.decodeArray(t,"finalCapture",A2.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class x2 extends p0{constructor(e,t,n,r){super(t,e,7,7,[3,2,1],YJ.EMPTY),this.sidePieces=n,this.capturedPieces=r}static getInitialState(){const e=YJ.EMPTY,t=YJ.NONE,n=YJ.ZERO,r=YJ.ONE;return new x2([[t,t,t,r,e,e,n],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[n,e,e,e,e,e,r],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[r,e,e,n,t,t,t]],0,[12,12],[0,0])}equals(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&LG.compareTable(this.board,e.board)}getNumberOfPiecesToPlace(e){return this.sidePieces[e.value]}getNumberOfPiecesCaptured(e){return this.capturedPieces[e.value]}setAtUnsafe(e,t){const n=LG.copyBiArray(this.board);return n[e.y][e.x]=t,new x2(n,this.turn,this.sidePieces,this.capturedPieces)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==YJ.NONE}}let R2=(()=>{class e{}return e.CAPTURE_MUST_BE_ALIGNED=()=>$localize`You can only capture when 4 or more of your pieces are aligned, and it is not the case.`,e.INVALID_CAPTURED_PIECES=()=>$localize`You must select a valid capture that contains 4 pieces or more.`,e.MISSING_CAPTURES=()=>$localize`There are still possible captures to be done.`,e.PLACEMENT_NOT_ON_BORDER=()=>$localize`Pieces must be inserted in spaces on the edge of the board.`,e.INVALID_PLACEMENT_DIRECTION=()=>$localize`You must select a valid placement direction.`,e.PLACEMENT_WITHOUT_DIRECTION=()=>$localize`You must select a placement with a direction alongside the insertion space.`,e.PLACEMENT_ON_COMPLETE_LINE=()=>$localize`You cannot place a piece on a complete line.`,e.AMBIGUOUS_CAPTURE_COORD=()=>$localize`This piece belongs to two captures. Please select another piece in the capture you'd like to make.`,e.CLICK_FURTHER_THAN_ONE_COORD=()=>$localize`You must click on an arrow to select your destination.`,e.NO_DIRECTIONS_AVAILABLE=()=>$localize`You cannot insert a piece here, as all lines are full. Select another space.`,e})();class D2 extends vQ{applyLegalMove(e,t,n){return new x2(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}static applyCaptures(e,t){let n=e;return t.forEach(e=>{n=D2.applyCapture(n,e)}),n}static applyCapture(e,t){const n=e.getCurrentPlayer();let r=e;const i=[e.sidePieces[0],e.sidePieces[1]],s=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(t=>{const o=e.getPieceAt(t);r=r.setAt(t,YJ.EMPTY),o.is(n)?i[n.value]+=1:s[n.value]+=1}),new x2(r.board,e.turn,i,s)}static getPlacements(e){const t=[];return eQ.INSTANCE.getAllBorders(e).forEach(n=>{e.getPieceAt(n)===YJ.EMPTY?t.push(new N2(n,vw.empty())):D2.getAllDirectionsForEntrance(e,n).forEach(r=>{!1===D2.isLineComplete(e,n,r)&&t.push(new N2(n,vw.of(r)))})}),t}static isLineComplete(e,t,n){return D2.nextGapInLine(e,t,n).isAbsent()}static nextGapInLine(e,t,n){for(let r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===YJ.EMPTY)return vw.of(r);return vw.empty()}static applyPlacement(e,t){const n=e.getCurrentPlayer();let r=e,i=YJ.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){const n=t.coord;if(e.getPieceAt(n)!==YJ.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(n,i)}else for(let o=t.coord;r.isOnBoard(o)&&i!==YJ.EMPTY;o=o.getNext(t.direction.get())){const t=e.getPieceAt(o);r=r.setAt(o,i),i=t}const s=[e.sidePieces[0],e.sidePieces[1]];return s[n.value]-=1,new x2(r.board,e.turn,s,e.capturedPieces)}getPiecesMoved(e,t,n){const r=D2.applyCaptures(e,t);if(n.direction.isAbsent())return[n.coord];{const e=n.direction.get(),t=[];t.push(n.coord);let i=n.coord.getNext(e);for(;r.isOnBoard(i)&&r.getPieceAt(i)!==YJ.EMPTY;)t.push(i),i=i.getNext(e);return MG(r.isOnBoard(i)&&r.getPieceAt(i)===YJ.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),t.push(i),t}}static getAllDirectionsForEntrance(e,t){if(eQ.INSTANCE.isTopLeftCorner(e,t))return[KJ.RIGHT,KJ.DOWN,KJ.UP_RIGHT];if(eQ.INSTANCE.isTopCorner(e,t))return[KJ.DOWN,KJ.DOWN_LEFT,KJ.RIGHT];if(eQ.INSTANCE.isTopRightCorner(e,t))return[KJ.DOWN_LEFT,KJ.DOWN,KJ.LEFT];if(eQ.INSTANCE.isBottomLeftCorner(e,t))return[KJ.UP_RIGHT,KJ.UP,KJ.RIGHT];if(eQ.INSTANCE.isBottomCorner(e,t))return[KJ.UP,KJ.LEFT,KJ.UP_RIGHT];if(eQ.INSTANCE.isBottomRightCorner(e,t))return[KJ.LEFT,KJ.UP,KJ.DOWN_LEFT];if(eQ.INSTANCE.isOnTopLeftBorder(e,t))return[KJ.RIGHT,KJ.DOWN];if(eQ.INSTANCE.isOnLeftBorder(e,t))return[KJ.UP_RIGHT,KJ.RIGHT];if(eQ.INSTANCE.isOnBottomLeftBorder(e,t))return[KJ.UP,KJ.UP_RIGHT];if(eQ.INSTANCE.isOnBottomRightBorder(e,t))return[KJ.LEFT,KJ.UP];if(eQ.INSTANCE.isOnRightBorder(e,t))return[KJ.LEFT,KJ.DOWN_LEFT];if(eQ.INSTANCE.isOnTopRightBorder(e,t))return[KJ.DOWN_LEFT,KJ.DOWN];throw new Error("not a border")}isLegal(e,t){const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=D2.applyCaptures(t,e.initialCaptures),i=this.noMoreCapturesValidity(r);if(i.isFailure())return i.toFailedFallible();const s=this.placementValidity(r,e.placement);if(s.isFailure())return s.toFailedFallible();const o=D2.applyPlacement(r,e.placement),a=this.capturesValidity(o,e.finalCaptures);if(a.isFailure())return a.toFailedFallible();const c=D2.applyCaptures(o,e.finalCaptures),l=this.noMoreCapturesValidity(c);return l.isFailure()?l.toFailedFallible():OG.success(c)}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=D2.applyCapture(n,r)}return kG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer(),r=D2.getLinePortionWithFourPiecesOfPlayer(e,n,t.getLine());if(r.isAbsent())return kG.failure(R2.CAPTURE_MUST_BE_ALIGNED());const i=r.get();return D2.getCapturable(e,i).equals(t)?kG.SUCCESS:kG.failure(R2.INVALID_CAPTURED_PIECES())}static getLinePortionsWithFourPiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=D2.getLinePortionWithFourPiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}static getLinePortionWithFourPiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o=i;for(let a=i;e.isOnBoard(a);a=a.getNext(s))if(e.getPieceAt(a).is(t)?(0===r&&(o=a),r+=1):r=0,4===r)return vw.of({0:o,1:a,2:s});return vw.empty()}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===D2.getLinePortionsWithFourPiecesOfPlayer(e,t).length?kG.SUCCESS:kG.failure(R2.MISSING_CAPTURES())}placementValidity(e,t){const n=this.placementCoordValidity(e,t.coord);if(n.isFailure())return n;if(e.getPieceAt(t.coord)!==YJ.EMPTY){if(t.direction.isAbsent())return kG.failure(R2.PLACEMENT_WITHOUT_DIRECTION());if(D2.isLineComplete(e,t.coord,t.direction.get()))return kG.failure(R2.PLACEMENT_ON_COMPLETE_LINE());for(const n of D2.getAllDirectionsForEntrance(e,t.coord))if(n===t.direction.get())return kG.SUCCESS;return kG.failure(R2.INVALID_PLACEMENT_DIRECTION())}return kG.SUCCESS}placementCoordValidity(e,t){return eQ.INSTANCE.isOnBorder(e,t)?kG.SUCCESS:kG.failure(R2.PLACEMENT_NOT_ON_BORDER())}static getCapturable(e,t){const n=[],r=t[0],i=t[1],s=t[2],o=s.getOpposite();let a=r.getNext(o);for(;e.isOnBoard(a)&&e.getPieceAt(a)!==YJ.EMPTY;)n.push(a),a=a.getNext(o);for(let c=r;!c.equals(i);c=c.getNext(s))n.push(c);for(let c=i;e.isOnBoard(c)&&e.getPieceAt(c)!==YJ.EMPTY;c=c.getNext(s))n.push(c);return new A2(n)}static getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return D2.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(t=>{n.push(D2.getCapturable(e,t))}),n}static getPlayerScore(e,t){const n=e.getNumberOfPiecesToPlace(t);if(0===n&&0===D2.getPossibleCaptures(e).length)return vw.empty();const r=e.getNumberOfPiecesCaptured(t);return vw.of(n+3*r)}static isGameOver(e){const t=D2.getPlayerScore(e,VY.ZERO),n=D2.getPlayerScore(e,VY.ONE);return t.isAbsent()||n.isAbsent()}getGameStatus(e){const t=e.gameState,n=D2.getPlayerScore(t,VY.ZERO),r=D2.getPlayerScore(t,VY.ONE);return n.isAbsent()?yQ.ONE_WON:r.isAbsent()?yQ.ZERO_WON:yQ.ONGOING}}class L2 extends nQ{static getPossibleCaptureCombinationsFromPossibleCaptures(e){const t=L2.computeIntersections(e);let n=[[]];return e.forEach((e,r)=>{if(0===t[r].length)n.forEach(e=>{e.push(r)});else{const e=[],i=t[r].some(e=>e>r);for(const s of n)!0===s.some(e=>t[r].some(t=>e===t))?e.push(LG.copyImmutableArray(s)):i?(e.push(LG.copyImmutableArray(s)),s.push(r),e.push(LG.copyImmutableArray(s))):(s.push(r),e.push(LG.copyImmutableArray(s)));n=e}}),n.map(t=>t.map(t=>e[t]))}static computeIntersections(e){const t=[];return e.forEach((n,r)=>{t.push([]),e.forEach((e,i)=>{r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}getBoardValue(e){const t=e.gameState,n=D2.getPlayerScore(t,VY.ZERO),r=D2.getPlayerScore(t,VY.ONE);return n.isAbsent()?new rQ(VY.ONE.getVictoryValue()):r.isAbsent()?new rQ(VY.ZERO.getVictoryValue()):new rQ(n.get()-r.get())}getListMoves(e){return this.getListMoveFromState(e.gameState)}getListMoveFromState(e){const t=[];return D2.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(n=>{const r=D2.applyCaptures(e,n);D2.getPlacements(r).forEach(e=>{const i=D2.applyPlacement(r,e);this.getPossibleCaptureCombinations(i).forEach(r=>{const i=new M2(e,n,r);t.push(i)})})}),t}getPossibleCaptureCombinations(e){const t=D2.getPossibleCaptures(e);return L2.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}class F2{constructor(e,t,n,r,i,s){this.source=e,this.destination=t,this.x1=n,this.y1=r,this.x2=i,this.y2=s}}const B2=YJ.NONE,V2=YJ.EMPTY,U2=YJ.ZERO,$2=YJ.ONE;class z2{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.
        This is the initial board.
        Each player has 12 pieces on the side and 3 pieces on the board.
        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.
        The first player plays with the dark pieces, the second player plays with the light pieces.`,x2.getInitialState()),wQ.anyMove($localize`Pushing`,$localize`Pieces can only enter the board through the edges. To insert a new piece:
        <ol>
            <li>Click on a space on the edge of the board.</li>
            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>
        </ol>
        You cannot push when a line is full.<br/><br/>
        You're playing Dark, insert a piece.`,x2.getInitialState(),new M2(new N2(new GJ(3,0),vw.of(KJ.DOWN)),[],[]),$localize`Congratulations!`),wQ.fromMove($localize`Capture (1/3)`,$localize`To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.
        There are multiple important aspects of a capture:
        <ol>
            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>
            <li>As soon as there is an empty space on the line, the capture stops.</li>
            <li>Your own pieces that are captured go back to your stock.
                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>
            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.
                This means that a turn happens in three phases:
                <ol type="A">
                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>
                    <li>Make your insertion.</li>
                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>
                </ol>
            </li>
        </ol><br/>
        You're playing Dark, you can make a capture, do it.`,new x2([[B2,B2,B2,U2,$2,V2,V2],[B2,B2,V2,V2,V2,V2,V2],[B2,V2,V2,V2,V2,V2,V2],[U2,U2,U2,V2,V2,V2,V2],[$2,V2,V2,V2,V2,V2,B2],[V2,V2,V2,$2,V2,B2,B2],[V2,V2,V2,$2,B2,B2,B2]],42,[8,8],[0,0]),[new M2(new N2(new GJ(0,3),vw.of(KJ.RIGHT)),[],[new A2([new GJ(0,3),new GJ(1,3),new GJ(2,3),new GJ(3,3)])])],$localize`Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.
        Let's now see how captures can really be useful.`,$localize`Failed!`),wQ.fromMove($localize`Capture (2/3)`,$localize`Here, there are three different ways of capturing.
        <ol>
          <li>One way does not capture any of your opponent's pieces.</li>
          <li>Another way captures one of your opponent's pieces.</li>
          <li>The last way captures two of your opponent's pieces.</li>
        </ol>
        <br/><br/>
        Pick the last one.`,new x2([[B2,B2,B2,V2,V2,V2,V2],[B2,B2,V2,$2,V2,V2,V2],[B2,V2,V2,U2,V2,V2,V2],[U2,U2,U2,$2,V2,V2,V2],[V2,V2,V2,U2,V2,V2,B2],[V2,V2,V2,U2,V2,B2,B2],[V2,V2,V2,$2,B2,B2,B2]],42,[8,4],[2,3]),[new M2(new N2(new GJ(0,3),vw.of(KJ.RIGHT)),[],[new A2([new GJ(3,1),new GJ(3,2),new GJ(3,3),new GJ(3,4),new GJ(3,5),new GJ(3,6)])])],$localize`Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.
        The most you can get is 3 per capture.`,$localize`Failed, the best capture was taking 2 of your opponent's pieces`),wQ.fromMove($localize`Capture (3/3)`,$localize`Here, you must capture at the beginning of your turn.
        This is due to a move of your opponent at the previous turn
        (even though this is a fictitious board for pedagogical purpose).
        After your capture, by performing the right move you can even capture two more of your opponent's pieces!
        Keep it mind that the most useful in a capture is to take your opponent's pieces.`,new x2([[B2,B2,B2,U2,V2,V2,U2],[B2,B2,V2,U2,V2,V2,U2],[B2,U2,U2,V2,U2,$2,U2],[V2,V2,V2,U2,V2,V2,U2],[V2,V2,V2,U2,V2,V2,B2],[U2,U2,U2,$2,$2,B2,B2],[V2,V2,V2,U2,B2,B2,B2]],42,[8,4],[2,3]),[new M2(new N2(new GJ(3,6),vw.of(KJ.UP)),[new A2([new GJ(6,0),new GJ(6,1),new GJ(6,2),new GJ(6,3)])],[new A2([new GJ(0,5),new GJ(1,5),new GJ(2,5),new GJ(3,5),new GJ(4,5)]),new A2([new GJ(1,2),new GJ(2,2),new GJ(3,2),new GJ(4,2),new GJ(5,2)])]),new M2(new N2(new GJ(4,6),vw.of(KJ.UP)),[new A2([new GJ(6,0),new GJ(6,1),new GJ(6,2),new GJ(6,3)])],[new A2([new GJ(0,5),new GJ(1,5),new GJ(2,5),new GJ(3,5),new GJ(4,5)]),new A2([new GJ(3,0),new GJ(3,1),new GJ(3,2),new GJ(3,3),new GJ(3,4)])]),new M2(new N2(new GJ(3,6),vw.of(KJ.UP)),[new A2([new GJ(6,0),new GJ(6,1),new GJ(6,2),new GJ(6,3)])],[new A2([new GJ(1,2),new GJ(2,2),new GJ(3,2),new GJ(4,2),new GJ(5,2)]),new A2([new GJ(0,5),new GJ(1,5),new GJ(2,5),new GJ(3,5),new GJ(4,5)])])],$localize`Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces.`,$localize`Failed, the best capture takes 2 of your opponent's pieces.`)]}}function H2(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba().$implicit,t=ba();ua("ngClass",t.getPieceClass(e)),ra("cx",t.getCenterAt(e).x)("cy",t.getCenterAt(e).y)("r",t.SPACE_SIZE)}}function G2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"g",8),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),pa(2,"polyline",9),aa(3,H2,1,4,"circle",10),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Oa("id","click_",e.x,"_",e.y,""),Ts(1),Oa("id","case_",e.x,"_",e.y,""),ua("ngClass",n.getSpaceClass(e)),ra("points",n.getHexaCoordsAt(e)),Ts(1),ua("ngIf",n.isPiece(e))}}function q2(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",14),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t)}),fa()}if(2&e){const e=t.$implicit;ra("points",ba(2).getHexaCoordsAt(e))}}function W2(e,t){if(1&e&&(Cn(),da(0,"g",12),aa(1,q2,1,1,"polyline",13),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e.capturedSpaces)}}function j2(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"line",15),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.destination)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),ra("x1",e.x1)("y1",e.y1)("x2",e.x2)("y2",e.y2)}}function Z2(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"circle",16),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Oa("id","piece_",n,"_",e,""),ua("ngClass",r.getSidePieceClass(n)),ra("cx",10+e*r.SPACE_SIZE*.5)("cy",10+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function Y2(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,Z2,2,6,"g",5),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",n.getPlayerSidePieces(e))}}function K2(e,t){if(1&e&&(Cn(),pa(0,"line",17)),2&e){const e=ba();ra("x1",e.inserted.get().x1)("y1",e.inserted.get().y1)("x2",e.inserted.get().x2)("y2",e.inserted.get().y2)}}const J2=function(){return[0,1]};let Q2=(()=>{class e extends ZJ{constructor(t){super(t),this.inserted=vw.empty(),this.arrows=[],this.captured=[],this.moved=[],this.movePhase=e.PHASE_PLACEMENT_COORD,this.possibleCaptures=[],this.initialCaptures=[],this.placement=vw.empty(),this.placementEntrance=vw.empty(),this.finalCaptures=[],this.scores=vw.of([0,0]),this.rules=new D2(x2),this.availableMinimaxes=[new L2(this.rules,"GipfMinimax")],this.encoder=M2.encoder,this.tutorial=(new z2).tutorial,this.SPACE_SIZE=40,this.constructedState=this.rules.node.gameState,this.hexaLayout=new JJ(1.5*this.SPACE_SIZE,new GJ(2*this.SPACE_SIZE,0),eQ.INSTANCE)}updateBoard(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}showLastMove(){this.inserted=vw.empty();const e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){const t=e.get().placement;this.inserted=vw.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}arrowTowards(e,t){const n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new F2(n,e,i.x,i.y,r.x,r.y)}markCapture(e){e.forEach(e=>{this.captured.push(e)})}getAllCoords(){return this.constructedState.allCoords()}getPlayerSidePieces(e){const t=this.constructedState.getNumberOfPiecesToPlace(VY.of(e)),n=[];for(let r=0;r<t;r+=1)n.push(r);return n}isPiece(e){return this.getPiece(e)!==YJ.EMPTY}getPiece(e){return this.constructedState.getPieceAt(e)}onClick(t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+t.x+"_"+t.y);if(r.isFailure())return n.cancelMove(r.getReason());switch(n.movePhase){case e.PHASE_INITIAL_CAPTURE:case e.PHASE_FINAL_CAPTURE:return n.selectCapture(t);case e.PHASE_PLACEMENT_COORD:return n.selectPlacementCoord(t);default:fw.expectToBe(n.movePhase,e.PHASE_PLACEMENT_DIRECTION);const r=n.placementEntrance.get();if(!1===r.isAlignedWith(t))return n.cancelMove(R2.INVALID_PLACEMENT_DIRECTION());if(1!==r.getDistance(t))return n.cancelMove(R2.CLICK_FURTHER_THAN_ONE_COORD());const i=KJ.factory.fromMove(r,t);return n.selectPlacementDirection(i.toOptional())}})()}selectCapture(t){var n=this;return dw(function*(){const r=[];if(n.possibleCaptures.forEach(e=>{e.contains(t)&&r.push(e)}),r.length>1)return n.cancelMove(R2.AMBIGUOUS_CAPTURE_COORD());if(0===r.length)return n.cancelMove(R2.MISSING_CAPTURES());const i=r[0];switch(n.constructedState=D2.applyCapture(n.constructedState,i),n.markCapture(i),n.possibleCaptures=D2.getPossibleCaptures(n.constructedState),n.movePhase){case e.PHASE_INITIAL_CAPTURE:return n.initialCaptures.push(i),0===n.possibleCaptures.length?n.moveToPlacementPhase():kG.SUCCESS;default:return fw.expectToBe(n.movePhase,e.PHASE_FINAL_CAPTURE),n.finalCaptures.push(i),0===n.possibleCaptures.length?n.tryMove(n.initialCaptures,n.placement.get(),n.finalCaptures):kG.SUCCESS}})()}moveToPlacementPhase(){return this.movePhase=e.PHASE_PLACEMENT_COORD,kG.SUCCESS}moveToInitialCaptureOrPlacementPhase(){return this.possibleCaptures=D2.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?e.PHASE_PLACEMENT_COORD:e.PHASE_INITIAL_CAPTURE,kG.SUCCESS}moveToFinalCapturePhaseOrTryMove(){var t=this;return dw(function*(){return t.possibleCaptures=D2.getPossibleCaptures(t.constructedState),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):(t.movePhase=e.PHASE_FINAL_CAPTURE,kG.SUCCESS)})()}computeArrows(e){this.arrows=[];for(const t of D2.getAllDirectionsForEntrance(this.constructedState,e))if(!1===D2.isLineComplete(this.constructedState,e,t)){const n=e.getNext(t),r=this.getCenterAt(e),i=this.getCenterAt(n);this.arrows.push(new F2(e,n,r.x,r.y,i.x,i.y))}}selectPlacementCoord(t){var n=this;return dw(function*(){const r=n.rules.placementCoordValidity(n.constructedState,t);return r.isFailure()?n.cancelMove(r.getReason()):(n.placementEntrance=vw.of(t),n.constructedState.getPieceAt(t)===YJ.EMPTY?n.selectPlacementDirection(vw.empty()):(n.movePhase=e.PHASE_PLACEMENT_DIRECTION,n.computeArrows(t),0===n.arrows.length&&n.cancelMove(R2.NO_DIRECTIONS_AVAILABLE()),kG.SUCCESS))})()}selectPlacementDirection(e){var t=this;return dw(function*(){t.placement=vw.of(new N2(t.placementEntrance.get(),e));const n=t.rules.placementValidity(t.constructedState,t.placement.get());return n.isFailure()?t.cancelMove(n.getReason()):(t.arrows=[],t.constructedState=D2.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove())})()}tryMove(e,t,n){var r=this;return dw(function*(){const i=new M2(t,e,n);return yield r.chooseMove(i,r.rules.node.gameState,r.scores.get())})()}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];const e=this.rules.node.move;if(e.isPresent()){const t=e.get(),n=this.rules.node.mother.get().gameState;t.initialCaptures.forEach(e=>this.markCapture(e)),t.finalCaptures.forEach(e=>this.markCapture(e)),this.moved=this.rules.getPiecesMoved(n,t.initialCaptures,t.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=vw.empty(),this.placement=vw.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}getSpaceClass(e){return this.captured.some(t=>t.equals(e))?"captured":this.moved.some(t=>t.equals(e))?"moved":""}getPieceClass(e){const t=this.getPiece(e);return this.getPlayerClass(VY.of(t.value))}getSidePieceClass(e){return this.getPlayerClass(VY.of(e))}}return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-gipf"]],features:[Ho],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"defs"),da(2,"marker",1),pa(3,"polygon",2),fa(),da(4,"marker",3),pa(5,"polygon",4),fa(),fa(),aa(6,G2,4,7,"g",5),aa(7,W2,2,1,"g",6),aa(8,j2,2,4,"g",5),aa(9,Y2,2,1,"g",5),aa(10,K2,1,4,"line",7),fa()),2&e&&(Ts(6),ua("ngForOf",t.getAllCoords()),Ts(1),ua("ngForOf",t.possibleCaptures),Ts(1),ua("ngForOf",t.arrows),Ts(1),ua("ngForOf",ou(5,J2)),Ts(1),ua("ngIf",t.inserted.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class X2 extends uQ{equals(e){return this===e||this.coord.equals(e.coord)}toString(){return this===X2.PASS?"GoMove.PASS":this===X2.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}X2.PASS=new X2(-1,0),X2.ACCEPT=new X2(-2,0),X2.PASS_NUMBER=-1,X2.ACCEPT_NUMBER=-2,X2.encoder=new class extends BY{maxValue(){return 360}encodeNumber(e){return 19*e.coord.y+e.coord.x}decodeNumber(e){if(e===X2.PASS_NUMBER)return X2.PASS;const t=e%19;return new X2(t,(e-t)/19)}};class e3{constructor(e,t){this.player=e,this.type=t}equals(e){return e===this}toString(){switch(this){case e3.BLACK:return"GoPiece.BLACK";case e3.WHITE:return"GoPiece.WHITE";case e3.EMPTY:return"GoPiece.EMPTY";case e3.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case e3.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case e3.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return MG(this===e3.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}static pieceBelongTo(e,t){return MG(t!==VY.NONE,"Owner must be Player.ZERO or Player.ONE, got Player.NONE."),t===e.player&&"territory"!==e.type}static ofPlayer(e){if(e===VY.ZERO)return e3.BLACK;if(e===VY.ONE)return e3.WHITE;throw new Error("GoPiece.ofPlayer should only be called with Player.ZERO and Player.ONE.")}isOccupied(){return[e3.BLACK,e3.WHITE,e3.DEAD_BLACK,e3.DEAD_WHITE].includes(this)}isEmpty(){return[e3.BLACK_TERRITORY,e3.WHITE_TERRITORY,e3.EMPTY].includes(this)}isDead(){return[e3.DEAD_BLACK,e3.DEAD_WHITE].includes(this)}isTerritory(){return[e3.BLACK_TERRITORY,e3.WHITE_TERRITORY].includes(this)}getOwner(){return this.player}nonTerritory(){return MG(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),e3.EMPTY}}e3.BLACK=new e3(VY.ZERO,"alive"),e3.WHITE=new e3(VY.ONE,"alive"),e3.EMPTY=new e3(VY.NONE,"empty"),e3.DEAD_BLACK=new e3(VY.ZERO,"dead"),e3.DEAD_WHITE=new e3(VY.ONE,"dead"),e3.BLACK_TERRITORY=new e3(VY.NONE,"territory"),e3.WHITE_TERRITORY=new e3(VY.NONE,"territory");var t3=(()=>(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(t3||(t3={})),t3))();let n3=(()=>{class e extends aQ{constructor(e,t,n,r,i){super(e,n),this.captured=t,this.koCoord=r,this.phase=i}static getInitialState(){const t=e.getStartingBoard();return new e(t,[0,0],0,vw.empty(),t3.PLAYING)}getCapturedCopy(){return[this.captured[0],this.captured[1]]}static getStartingBoard(){return LG.createTable(e.WIDTH,e.HEIGHT,e3.EMPTY)}copy(){return new e(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}isDead(e){return this.getPieceAt(e).isDead()}isTerritory(e){return this.getPieceAt(e).isTerritory()}}return e.WIDTH=13,e.HEIGHT=13,e})(),r3=(()=>{class e{constructor(e){this.color=e}selfContains(e){return this.getCoords().some(t=>t.equals(e))}static insertAsEntryPoint(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}return e.VERBOSE=!1,e})();class i3 extends r3{constructor(e,t,n,r,i,s){super(e),this.emptyCoords=t,this.blackCoords=n,this.whiteCoords=r,this.deadBlackCoords=i,this.deadWhiteCoords=s}getCoords(){return this.color===e3.BLACK?this.blackCoords:this.color===e3.WHITE?this.whiteCoords:this.color===e3.DEAD_BLACK?this.deadBlackCoords:this.color===e3.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}contains(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(t=>t.equals(e))}addPawn(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case e3.BLACK:this.blackCoords=r3.insertAsEntryPoint(this.blackCoords,e);break;case e3.WHITE:this.whiteCoords=r3.insertAsEntryPoint(this.whiteCoords,e);break;case e3.DEAD_BLACK:this.deadBlackCoords=r3.insertAsEntryPoint(this.deadBlackCoords,e);break;case e3.DEAD_WHITE:this.deadWhiteCoords=r3.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:fw.expectToBeMultiple(t,[e3.EMPTY,e3.BLACK_TERRITORY,e3.WHITE_TERRITORY]),this.emptyCoords=r3.insertAsEntryPoint(this.emptyCoords,e)}}isMonoWrapped(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}getWrapper(){const e=new fQ;e.set(e3.EMPTY,this.emptyCoords.length),e.set(e3.BLACK,this.blackCoords.length+this.deadWhiteCoords.length),e.set(e3.WHITE,this.whiteCoords.length+this.deadBlackCoords.length),e.put(this.color.nonTerritory(),0);const t=e.filter((e,t)=>t>0);if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}getNeighboorsEntryPoint(){const e=[];return this.color!==e3.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==e3.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==e3.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==e3.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==e3.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}class s3 extends class{getGroupDatas(e,t){pw(r3.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");const n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}_getGroupDatas(e,t,n){pw(r3.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});const r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color)for(const i of this.getDirections()){const r=e.getNext(i);r.isInRange(t[0].length,t.length)&&(n.contains(r)||(n=this._getGroupDatas(r,t,n)))}return n}}{getNewInstance(e){return new i3(e,[],[],[],[],[])}getDirections(){return HJ.ORTHOGONALS}}let o3=(()=>{class e{}return e.ILLEGAL_KO=()=>$localize`This move is a ko, you must play somewhere else before you can play in this intersection again.`,e.CANNOT_PASS_AFTER_PASSED_PHASE=()=>$localize`We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn.`,e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=()=>$localize`You cannot accept before the counting phase.`,e.OCCUPIED_INTERSECTION=()=>$localize`This intersection is already occupied.`,e.CANNOT_COMMIT_SUICIDE=()=>$localize`You cannot commit suicide.`,e})(),a3=(()=>{class e extends vQ{static isLegal(t,n){const r=!1;if(pw(e.VERBOSE||r,{isLegal:{move:t,state:n}}),e.isPass(t)){const t=n.phase===t3.PLAYING,i=n.phase===t3.PASSED;return pw(e.VERBOSE||r,"GoRules.isLegal at "+n.phase+(t||i?" forbid":" allowed")+" passing on "+n.getCopiedBoard()),t||i?OG.success([]):OG.failure(o3.CANNOT_PASS_AFTER_PASSED_PHASE())}if(e.isAccept(t)){const e=n.phase===t3.ACCEPT;return n.phase===t3.COUNTING||e?OG.success([]):OG.failure(o3.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return e.isOccupied(t.coord,n.getCopiedBoard())?(pw(e.VERBOSE||r,"GoRules.isLegal: move is marking"),e.isLegalDeadMarking(t,n)?OG.success([]):OG.failure(o3.OCCUPIED_INTERSECTION())):(pw(e.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+t.toString()),e.isLegalNormalMove(t,n))}static getNewKo(e,t,n){if(1===n.length){const r=n[0],i=e.coord,s=t[i.y][i.x],o=(new s3).getGroupDatas(i,t),a=o.emptyCoords,c=e3.pieceBelongTo(s,VY.ZERO)?o.blackCoords:o.whiteCoords;if(1===a.length&&a[0].equals(r)&&1===c.length)return vw.of(r)}return vw.empty()}static markTerritoryAndCount(t){pw(e.VERBOSE,{markTerritoryAndCount:{state:t}});const n=t.getCopiedBoard(),r=e.getTerritoryLikeGroup(t),i=t.getCapturedCopy();for(const e of r){const t=e.getWrapper();if(t===e3.WHITE){i[1]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=e3.WHITE_TERRITORY}else{MG(t===e3.BLACK,"territory should be wrapped by black or white, not by "+t.toString()),i[0]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=e3.BLACK_TERRITORY}}return new n3(n,i,t.turn,t.koCoord,t.phase)}static removeAndSubstractTerritory(e){const t=e.getCopiedBoard(),n=e.getCapturedCopy();let r;for(let i=0;i<e.board.length;i++)for(let s=0;s<e.board[0].length;s++)r=t[i][s],r===e3.BLACK_TERRITORY?(t[i][s]=e3.EMPTY,n[0]=n[0]-1):r===e3.WHITE_TERRITORY&&(t[i][s]=e3.EMPTY,n[1]=n[1]-1);return new n3(t,n,e.turn,e.koCoord,e.phase)}static getEmptyZones(t){return e.getGroupsDatasWhere(t.getCopiedBoard(),e=>e.isEmpty())}static getGroupsDatasWhere(e,t){const n=[];let r,i,s;const o=new s3;for(let a=0;a<e.length;a++)for(let c=0;c<e[0].length;c++)r=new GJ(c,a),s=e[a][c],t(s)&&(n.some(e=>e.selfContains(r))||(i=o.getGroupDatas(r,e),n.push(i)));return n}static addDeadToScore(e){const t=e.getCapturedCopy();let n,r=t[1],i=t[0];for(let s=0;s<e.board.length;s++)for(let t=0;t<e.board[0].length;t++)n=e.getPieceAtXY(t,s),n===e3.DEAD_BLACK?r++:n===e3.DEAD_WHITE&&i++;return[i,r]}static switchAliveness(e,t){const n=t.getCopiedBoard();MG(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");const r=(new s3).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case e3.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;for(const e of r.deadBlackCoords)n[e.y][e.x]=e3.BLACK;break;case e3.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;for(const e of r.deadWhiteCoords)n[e.y][e.x]=e3.WHITE;break;case e3.WHITE:i[0]+=2*r.whiteCoords.length;for(const e of r.whiteCoords)n[e.y][e.x]=e3.DEAD_WHITE;break;default:fw.expectToBe(r.color,e3.BLACK),i[1]+=2*r.blackCoords.length;for(const e of r.blackCoords)n[e.y][e.x]=e3.DEAD_BLACK}return new n3(n,i,t.turn,t.koCoord,t.phase)}static getGameStatus(e){const t=e.gameState;return t.phase===t3.FINISHED?t.captured[0]>t.captured[1]?yQ.ZERO_WON:t.captured[1]>t.captured[0]?yQ.ONE_WON:yQ.DRAW:yQ.ONGOING}static isPass(e){return e.equals(X2.PASS)}static isAccept(e){return e.equals(X2.ACCEPT)}static isLegalDeadMarking(t,n){return e.isOccupied(t.coord,n.getCopiedBoard())&&(n.phase===t3.COUNTING||n.phase===t3.ACCEPT)}static isLegalNormalMove(t,n){const r=n.getCopiedBoard();if(e.isKo(t,n))return OG.failure(o3.ILLEGAL_KO());[t3.COUNTING,t3.ACCEPT].includes(n.phase)&&(n=e.resurrectStones(n));const i=e.getCaptureState(t,n);if(c3.isCapturing(i))return OG.success(i.capturedCoords);{r[t.coord.y][t.coord.x]=n.turn%2==0?e3.BLACK:e3.WHITE;const e=0===(new s3).getGroupDatas(t.coord,r).emptyCoords.length;return r[t.coord.y][t.coord.x]=e3.EMPTY,e?OG.failure(o3.CANNOT_COMMIT_SUICIDE()):OG.success([])}}static isOccupied(e,t){return t[e.y][e.x].isOccupied()}static isKo(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}static getCaptureState(t,n){pw(e.VERBOSE||!1,{getCaptureState:{move:t,state:n}});const r=new c3;let i;for(const s of HJ.ORTHOGONALS)i=e.getCapturedInDirection(t.coord,s,n),i.length>0&&r.capturedCoords.every(e=>!i[0].equals(e))&&(r.capturedCoords=r.capturedCoords.concat(i));return r}static getCapturedInDirection(t,n,r){const i=r.getCopiedBoard(),s=t.getNext(n);if(s.isInRange(r.board[0].length,r.board.length)&&i[s.y][s.x]===(r.turn%2==0?e3.WHITE:e3.BLACK)){pw(e.VERBOSE||!1,"a group could be captured");const t=(new s3).getGroupDatas(s,i);if(e.isCapturableGroup(t,r.koCoord))return pw(e.VERBOSE||!1,{neightbooringGroupCoord:t.getCoords(),message:"is capturable"}),t.getCoords()}return[]}static isCapturableGroup(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}static getTerritoryLikeGroup(t){return e.getEmptyZones(t).filter(e=>e.isMonoWrapped())}static applyPass(t){const n=t.getCopiedBoard(),r=t.getCapturedCopy(),i=t.turn;let s,o;return t.phase===t3.PASSED?(s=t3.COUNTING,o=new n3(n,r,i+1,vw.empty(),s),o=e.markTerritoryAndCount(o)):(MG(t.phase===t3.PLAYING,"Cannot pass in counting phase!"),s=t3.PASSED,o=new n3(n,r,i+1,vw.empty(),s)),o}static applyLegalAccept(e){const t=e.getCopiedBoard();let n;return n=e.phase===t3.COUNTING?t3.ACCEPT:t3.FINISHED,new n3(t,e.getCapturedCopy(),e.turn+1,vw.empty(),n)}static applyNormalLegalMove(t,n,r){let i;pw(e.VERBOSE,{applyNormalLegal:{currentState:t,legalMove:n,status}}),i=[t3.COUNTING,t3.ACCEPT].includes(t.phase)?e.resurrectStones(t):t.copy();const s=n.coord.x,o=n.coord.y,a=i.getCopiedBoard(),c=i.turn,l=e3.ofPlayer(i.getCurrentPlayer()),u=c+1;a[o][s]=l;for(const e of r)a[e.y][e.x]=e3.EMPTY;const h=e.getNewKo(n,a,r),d=i.getCapturedCopy();return d[l.player.value]+=r.length,new n3(a,d,u,h,t3.PLAYING)}static resurrectStones(t){for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[0].length;r++)t.getPieceAtXY(r,n).isDead()&&(t=e.switchAliveness(new GJ(r,n),t));return e.removeAndSubstractTerritory(t)}static applyDeadMarkingMove(t,n){pw(e.VERBOSE,{applyDeadMarkingMove:{legalMove:t,state:n}});const r=e.removeAndSubstractTerritory(n),i=e.switchAliveness(t.coord,r),s=new n3(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,vw.empty(),t3.COUNTING);return e.markTerritoryAndCount(s)}isLegal(t,n){return e.isLegal(t,n)}applyLegalMove(t,n,r){return pw(e.VERBOSE,{applyLegalMove:{legalMove:t,state:n,status:r}}),e.isPass(t)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isPass"),e.applyPass(n)):e.isAccept(t)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isAccept"),e.applyLegalAccept(n)):e.isLegalDeadMarking(t,n)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),e.applyDeadMarkingMove(t,n)):(pw(e.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),e.applyNormalLegalMove(n,t,r))}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class c3{constructor(){this.capturedCoords=[]}static isCapturing(e){return e.capturedCoords.length>0}}class l3 extends nQ{getListMoves(e){pw(a3.VERBOSE||!1,"GoRules.getListMoves");const t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===t3.PLAYING||t.phase===t3.PASSED)return n.push(X2.PASS),n;{pw(a3.VERBOSE||!1,"GoRules.getListMoves in counting phase");const e=this.getCountingMovesList(t);return 0===e.length?[X2.ACCEPT]:e}}getPlayingMovesList(e){const t=[];let n;for(let r=0;r<e.board.length;r++)for(let i=0;i<e.board[0].length;i++)n=new X2(i,r),e.getPieceAt(n.coord)===e3.EMPTY&&a3.isLegal(n,e).isSuccess()&&t.push(n);return t}getCountingMovesList(e){const t=[],n=this.getCorrectBoard(e).getCopiedBoard(),r=a3.getGroupsDatasWhere(n,e=>e!==e3.EMPTY);for(const i of r){const r=i.getCoords()[0],s=n[r.y][r.x];if(e.getPieceAt(r)!==s){const e=new X2(r.x,r.y);return t.push(e),t}}return t}getCorrectBoard(e){const t=this.mapBoard(e.getCopiedBoard(),e=>e===e3.BLACK?e3.DEAD_BLACK:e===e3.WHITE?e3.DEAD_WHITE:e.isTerritory()?e3.EMPTY:e),n=new n3(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=a3.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}mapBoard(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}setAliveUniqueWrapper(e,t){let n,r=e.copy();for(const i of t){n=i.deadBlackCoords.concat(i.deadWhiteCoords);for(const e of n)r.isDead(e)&&(r=a3.switchAliveness(e,r))}return r}getBoardValue(e){const t=e.gameState,n=a3.getGameStatus(e);if(n.isEndGame)return new rQ(n.toBoardValue());pw(a3.VERBOSE||!1,"GoRules.getBoardValue");const r=a3.markTerritoryAndCount(t),i=r.getCapturedCopy(),s=this.getDeadStones(r);return new rQ(i[1]+2*s[0]-(i[0]+2*s[1]))}getDeadStones(e){const t=[0,0];for(let n=0;n<e.board.length;n++)for(let r=0;r<e.board[0].length;r++){const i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}const u3=e3.WHITE,h3=e3.BLACK,d3=e3.DEAD_WHITE,f3=e3.WHITE_TERRITORY,p3=e3.BLACK_TERRITORY,g3=e3.EMPTY;class m3{constructor(){this.tutorial=[wQ.informational($localize`Preliminary information`,$localize`The game of Go is played on a board called a Goban, and the stones are placed on the intersections.
        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.
        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).
        For this tutorial, we will use a smaller board for pedagogical purposes.`,n3.getInitialState()),wQ.informational($localize`Goal of the game`,$localize`The goal of the game is to have the most points at the end of the game.
        We call "territories" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.
        Here, Dark has 9 territories on the left, and Light has 8 on the right.
        The top part belongs to no one.
        Each player's score at the end of the game is the sum of that player's territories and captures.`,new n3([[g3,h3,g3,g3,u3,u3],[g3,h3,g3,g3,u3,g3],[g3,h3,h3,u3,u3,g3],[g3,g3,h3,u3,g3,g3],[g3,g3,h3,u3,g3,g3],[g3,g3,h3,u3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING)),wQ.fromMove($localize`Simple capture`,$localize`An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).
        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.
        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>
        The light piece only has one liberty left, play there.`,new n3([[g3,g3,g3,g3,g3],[g3,g3,h3,g3,g3],[g3,h3,u3,g3,g3],[g3,g3,h3,g3,g3],[g3,g3,g3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING),[new X2(3,2)],$localize`Congratulations, you have earned one point.`,$localize`Failed, try again by playing on one of the intersections directly next to the light stone.`),wQ.fromMove($localize`Capturing multiple stones`,$localize`Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>
        The light group here only has one liberty left, capture it.`,new n3([[g3,h3,g3,g3,g3],[h3,u3,g3,g3,g3],[h3,u3,u3,h3,g3],[g3,h3,h3,g3,g3],[g3,g3,g3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING),[new X2(2,1)],$localize`Congratulations, you have earned three points and formed a territory.`,$localize`Failed, you have not captured the group. Play on the last liberty of that group.`),wQ.informational($localize`Suicide`,$localize`In Go, suicide is forbidden.
        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.
        Here, the top left intersection is a suicide for Light.
        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player.`,new n3([[g3,h3,g3,g3,g3],[h3,g3,g3,g3,g3],[h3,g3,g3,g3,u3],[u3,h3,g3,u3,g3],[g3,u3,g3,u3,h3]],[0,0],0,vw.empty(),t3.PLAYING)),wQ.informational($localize`Life and death (death)`,$localize`From the capture rule follows the life and death notion:
        dead stones are stones that are definitely capturable (without losing anything else).
        Alive stones are stones that can never be captured.
        From the capture rule, Dark can play inside Light's territory and make a capture.
        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).
        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories.`,new n3([[g3,g3,g3,g3,g3],[h3,h3,h3,g3,g3],[u3,u3,h3,g3,g3],[g3,u3,h3,g3,g3],[u3,u3,h3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING)),wQ.informational($localize`Life and death (eyes)`,$localize`Here, Light cannot play on the top left, nor on the bottom left.
        Light will never be able to capture Dark.
        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive.`,new n3([[g3,h3,u3,g3,g3],[u3,h3,u3,g3,g3],[h3,h3,u3,g3,g3],[u3,h3,u3,g3,g3],[g3,h3,u3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING)),wQ.informational($localize`Seki`,$localize`If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.
        Similarly, if Light plays on the middle line, Dark will capture Light.
        In other words, there is no point in playing on the middle line.
        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral.`,new n3([[g3,u3,h3,g3,u3,h3,g3],[g3,u3,h3,h3,u3,h3,g3],[g3,u3,h3,h3,u3,h3,g3],[g3,u3,h3,h3,u3,h3,g3],[g3,u3,h3,u3,u3,h3,g3],[g3,u3,h3,u3,u3,h3,g3],[g3,u3,h3,g3,u3,h3,g3]],[0,0],0,vw.empty(),t3.PLAYING)),wQ.fromMove($localize`Ko`,$localize`A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>
        Capture the light stone.`,new n3([[g3,g3,g3,g3,g3,g3,g3],[g3,g3,g3,g3,g3,g3,g3],[g3,g3,g3,h3,u3,g3,g3],[g3,g3,h3,u3,g3,u3,g3],[g3,g3,g3,h3,u3,g3,g3],[g3,g3,g3,g3,g3,g3,g3],[g3,g3,g3,g3,g3,g3,g3]],[0,0],0,vw.empty(),t3.PLAYING),[new X2(4,3)],$localize`Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.
        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.
        This rule is called the Ko.
        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after.`,$localize`Failed!`),wQ.fromMove($localize`End of the game`,$localize`When a player feels that there is no advantage to putting a new stone, that player can pass a turn.
        The game phase stops when both players pass consecutively, and we move on to the counting phase.
        The dead groups are then marked by clicking on them.
        Every intersection in a player's territory earns that player a point.
        The winner is the one with most points.<br/><br/>
        A last stone is dead, mark it.`,new n3([[u3,h3,h3,h3,h3,h3,p3,p3,p3],[u3,u3,u3,u3,h3,h3,h3,p3,p3],[u3,f3,u3,u3,h3,d3,d3,h3,p3],[h3,u3,u3,u3,u3,h3,p3,p3,p3],[g3,u3,f3,u3,h3,h3,d3,h3,p3],[u3,f3,u3,u3,h3,h3,h3,h3,h3],[u3,u3,h3,h3,h3,u3,u3,h3,u3],[h3,h3,h3,u3,u3,u3,f3,u3,u3],[p3,p3,h3,h3,h3,u3,u3,f3,f3]],[0,0],0,vw.empty(),t3.COUNTING),[new X2(0,3)],$localize`Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.
        The intersections where the prisoners are count as Dark's territory
        Light has 8 territories and 1 prisoner.
        The end result is therefore 18 - 9 for Dark.`,$localize`Failed, try again.`)]}}function y3(e,t){if(1&e&&(Cn(),pa(0,"circle",10)),2&e){const e=ba(2).index,t=ba().index;ra("cx",25+50*e)("cy",25+50*t)("r",22)}}function v3(e,t){if(1&e){const e=ya();Cn(),da(0,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index;ra("x1",50*e)("y1",50*t)("x2",50+50*e)("y2",50+50*t)}}function _3(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",7),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,y3,1,3,"circle",8),aa(3,v3,1,4,"line",9),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ua("ngClass",n.getSpaceClass(e,t)),ra("cx",25+50*e)("cy",25+50*t)("r",22),Ts(1),ua("ngIf",n.isLastCase(e,t)),Ts(1),ua("ngIf",n.isDead(e,t))}}function C3(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",15),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",25+50*t)("cy",25+50*r)("r",10)("class",n===i.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function E3(e,t){if(1&e){const e=ya();Cn(),da(0,"rect",12),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),da(1,"line",13),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"line",13),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(3,C3,1,4,"circle",14)}if(2&e){const e=ba().index,t=ba().index,n=ba();Oa("id","click_",e,"_",t,""),ra("x",50*e)("y",50*t),Ts(1),ra("x1",50*e)("y1",25+50*t)("x2",50+50*e)("y2",25+50*t),Ts(1),ra("x1",25+50*e)("y1",50*t)("x2",25+50*e)("y2",50+50*t),Ts(1),ua("ngIf",n.isTerritory(e,t))}}function w3(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,_3,4,6,"g",5),aa(2,E3,4,13,"ng-template",null,6,Du),fa()),2&e){const e=t.index,n=ca(3),r=ba().index,i=ba();Ts(1),ua("ngIf",i.caseIsFull(e,r))("ngIfElse",n)}}function b3(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,w3,4,2,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function S3(e,t){if(1&e&&(Cn(),pa(0,"rect",16)),2&e){const e=ba();ra("x",12.5+50*e.ko.get().x)("y",12.5+50*e.ko.get().y)}}function P3(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",17),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit;ra("cx",25+50*e.x)("cy",25+50*e.y)("r",7)}}let O3=(()=>{class e extends rX{constructor(e){super(e),this.ko=vw.empty(),this.last=vw.empty(),this.captures=[],this.GoPiece=e3,this.scores=vw.of([0,0]),this.rules=new a3(n3),this.availableMinimaxes=[new l3(this.rules,"GoMinimax")],this.encoder=X2.encoder,this.tutorial=(new m3).tutorial,this.canPass=!0,this.updateBoard()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.last=vw.empty();const i=new X2(e,t);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){pw(e.VERBOSE,"updateBoard");const t=this.rules.node.gameState,n=this.rules.node.move,r=t.phase;this.board=t.getCopiedBoard(),this.scores=vw.of(t.getCapturedCopy()),this.ko=t.koCoord,n.isPresent()?this.showCaptures():this.captures=[],this.last=n.map(e=>e.coord),this.canPass=r!==t3.FINISHED}showCaptures(){const e=this.rules.node.mother.get().gameState;this.captures=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[0].length;n++){const r=new GJ(n,t),i=!1===e.getPieceAt(r).isEmpty(),s=this.board[t][n]===e3.EMPTY,o=!1===this.ko.equalsValue(r);i&&s&&o&&this.captures.push(r)}}pass(){var e=this;return dw(function*(){const t=e.rules.node.gameState.phase;return t===t3.PLAYING||t===t3.PASSED?e.onClick(X2.PASS.coord.x,X2.PASS.coord.y):(MG(t===t3.COUNTING||t===t3.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(X2.ACCEPT.coord.x,X2.ACCEPT.coord.y))})()}getSpaceClass(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}caseIsFull(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==e3.EMPTY&&!this.isTerritory(e,t)}isLastCase(e,t){if(this.last.isPresent()){const n=this.last.get();return e===n.x&&t===n.y}return!1}isDead(e,t){return this.rules.node.gameState.isDead(new GJ(e,t))}isTerritory(e,t){return this.rules.node.gameState.isTerritory(new GJ(e,t))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-go"]],features:[Ho],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),pa(1,"rect",1),aa(2,b3,2,1,"g",2),aa(3,S3,1,2,"rect",3),aa(4,P3,1,3,"circle",4),fa()),2&e&&(ra("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),Ts(1),ra("width",50*t.board.length)("height",50*t.board.length),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.ko.isPresent()),Ts(1),ua("ngForOf",t.captures))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class T3{constructor(e,t,n){this.value=e,this.name=t,this.rgb=n}static of(e){switch(e){case 0:return T3.ANY;case 1:return T3.ORANGE;case 2:return T3.BLUE;case 3:return T3.PURPLE;case 4:return T3.PINK;case 5:return T3.YELLOW;case 6:return T3.RED;case 7:return T3.GREEN;default:return fw.expectToBe(e,8,"Invalid value "+e+" for KamisadoColor"),T3.BROWN}}}T3.ANY=new T3(0,"any","#000"),T3.ORANGE=new T3(1,"orange","#d67421"),T3.BLUE=new T3(2,"blue","#006bac"),T3.PURPLE=new T3(3,"purple","#6f3787"),T3.PINK=new T3(4,"pink","#d2719e"),T3.YELLOW=new T3(5,"yellow","#e2c200"),T3.RED=new T3(6,"red","#d23339"),T3.GREEN=new T3(7,"green","#009157"),T3.BROWN=new T3(8,"brown","#562500");class I3{constructor(e,t){this.player=e,this.color=t}static of(e,t){return new I3(e,T3.of(t))}static createPlayerColors(e){return{ORANGE:new I3(e,T3.ORANGE),BLUE:new I3(e,T3.BLUE),PURPLE:new I3(e,T3.PURPLE),PINK:new I3(e,T3.PINK),YELLOW:new I3(e,T3.YELLOW),RED:new I3(e,T3.RED),GREEN:new I3(e,T3.GREEN),BROWN:new I3(e,T3.BROWN)}}equals(e){return e.player===this.player&&e.color===this.color}isEmpty(){return this.player.equals(VY.NONE)}belongsTo(e){return this.player===e}}I3.NONE=new I3(VY.NONE,T3.ANY),I3.ZERO=I3.createPlayerColors(VY.ZERO),I3.ONE=I3.createPlayerColors(VY.ONE);class k3{static getColorAt(e,t){return k3.COLORS[t][e]}static getInitialBoard(){const e=I3.NONE;return[[1,2,3,4,5,6,7,8].map(e=>I3.of(VY.ONE,e)),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(e=>I3.of(VY.ZERO,e))]}static isEmptyAt(e,t){return e[t.y][t.x].equals(I3.NONE)}static allPieceCoords(e){const t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++){const i=new GJ(r,n);k3.isEmptyAt(e,i)||t.push(i)}return t}}k3.INITIAL=k3.getInitialBoard(),k3.SIZE=8,k3.COLORS=LG.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],T3.of);class A3 extends fX{constructor(e,t){super(e,t)}static of(e,t){if(e.isNotInRange(k3.SIZE,k3.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(k3.SIZE,k3.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new A3(e,t)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return this===A3.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}A3.PASS=new A3(new GJ(-2,-2),new GJ(-3,-3)),A3.encoder=new class extends BY{maxValue(){return 34952}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return A3.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new A3(new GJ((e=e/16|0)%16,r),new GJ(n,t))}};class N3 extends aQ{constructor(e,t,n,r,i){super(LG.copyBiArray(i),e),this.colorToPlay=t,this.coordToPlay=n,this.alreadyPassed=r}static getInitialState(){return new N3(0,T3.ANY,vw.empty(),!1,k3.INITIAL)}}let M3=(()=>{class e{}return e.NOT_RIGHT_COLOR=()=>$localize`This piece is not of the color you have to play.`,e.DIRECTION_NOT_ALLOWED=()=>$localize`You can only move forward, orthogonally or diagonally.`,e.MOVE_BLOCKED=()=>$localize`This move is blocked by another piece.`,e.PLAY_WITH_SELECTED_PIECE=()=>$localize`You must play with the selected piece.`,e})();class x3 extends vQ{static getColorMatchingPiece(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new GJ(0,7),new GJ(1,7),new GJ(2,7),new GJ(3,7),new GJ(4,7),new GJ(5,7),new GJ(6,7),new GJ(7,7)]}static getMovablePieces(e){return x3.getColorMatchingPiece(e).filter(t=>{for(const n of this.playerDirections(e.getCurrentPlayer())){const r=t.getNext(n);if(e.isOnBoard(r)&&k3.isEmptyAt(e.board,r))return!0}return!1})}static playerDirections(e){if(e===VY.ONE)return[zJ.DOWN,zJ.DOWN_LEFT,zJ.DOWN_RIGHT];if(e===VY.ZERO)return[zJ.UP,zJ.UP_LEFT,zJ.UP_RIGHT];throw new Error("Invalid player")}static directionAllowedForPlayer(e,t){if(t===VY.ZERO)return e.y<0;if(t===VY.ONE)return e.y>0;throw new Error("Invalid player")}static getListMovesFromState(e){const t=x3.getMovablePieces(e);return 0===t.length?(MG(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[A3.PASS]):x3.getListMovesFromNonBlockedState(e,t)}static getListMovesFromNonBlockedState(e,t){const n=[],r=e.getCurrentPlayer();for(const i of t)for(const t of x3.playerDirections(r))for(let r=1;r<k3.SIZE;r++){const s=i.getNext(t,r);if(!e.isOnBoard(s)||!k3.isEmptyAt(e.board,s))break;{const e=A3.of(i,s);n.push(e)}}return n}static mustPass(e){return 0===this.getMovablePieces(e).length}static getFurthestPiecePositions(e){let t=7,n=0;return k3.allPieceCoords(e.board).forEach(r=>{const i=e.getPieceAt(r);MG(i!==I3.NONE,"allPieceCoords failed to filter KamisadoPiece.NONE"),i.player===VY.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}static isLegal(e,t){const n=e.coord,r=e.end,i=t.colorToPlay;if(e===A3.PASS)return this.isLegalPass(t);if(x3.isVictory(t))return OG.failure("You should never see this message");const s=t.getPieceAt(n);if(!s.belongsTo(t.getCurrentPlayer()))return OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE());if(i!==T3.ANY&&s.color!==i)return OG.failure(M3.NOT_RIGHT_COLOR());if(!t.getPieceAt(r).isEmpty())return OG.failure(tQ.MUST_CLICK_ON_EMPTY_SPACE());const o=zJ.factory.fromMove(n,r);if(o.isFailure())return OG.failure(M3.DIRECTION_NOT_ALLOWED());const a=o.get();if(!x3.directionAllowedForPlayer(a,t.getCurrentPlayer()))return OG.failure(M3.DIRECTION_NOT_ALLOWED());let c=n;for(;!c.equals(r);)if(c=c.getNext(a),!t.getPieceAt(c).isEmpty())return OG.failure(M3.MOVE_BLOCKED());return OG.success(void 0)}static isLegalPass(e){return this.mustPass(e)&&!e.alreadyPassed?OG.success(void 0):OG.failure(tQ.CANNOT_PASS())}static isVictory(e){const[t,n]=this.getFurthestPiecePositions(e);return 0===t||7===n}nextCoordToPlay(e,t){return vw.ofNullable(k3.allPieceCoords(e.board).find(n=>{const r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}applyLegalMove(e,t,n){if(e===A3.PASS){const e=this.nextCoordToPlay(t,t.colorToPlay);return new N3(t.turn+1,t.colorToPlay,e,!0,t.board)}const r=e.coord,i=e.end,s=t.getCopiedBoard();s[i.y][i.x]=s[r.y][r.x],s[r.y][r.x]=I3.NONE;const o=k3.getColorAt(i.x,i.y),a=this.nextCoordToPlay(t,o);return new N3(t.turn+1,o,a,!1,s)}isLegal(e,t){return x3.isLegal(e,t)}getGameStatus(e){const t=e.gameState,n=t.getCurrentPlayer();if(x3.mustPass(t)&&t.alreadyPassed)return yQ.getDefeat(n);const[r,i]=x3.getFurthestPiecePositions(t);return 7===i?yQ.ONE_WON:0===r?yQ.ZERO_WON:yQ.ONGOING}}class R3 extends nQ{getListMoves(e){const t=x3.getListMovesFromState(e.gameState);return LG.sortByDescending(t,e=>e.length()),t}getBoardValue(e){const t=e.gameState,n=t.getCurrentPlayer();if(x3.mustPass(t)&&t.alreadyPassed)return new rQ(n.getDefeatValue());const[r,i]=x3.getFurthestPiecePositions(t);return new rQ(7===i?VY.ONE.getVictoryValue():0===r?VY.ZERO.getVictoryValue():i-(7-r))}}const D3=I3.NONE,L3=I3.ZERO.ORANGE,F3=I3.ONE.ORANGE,B3=I3.ZERO.BLUE,V3=I3.ONE.BLUE,U3=I3.ZERO.PURPLE,$3=I3.ONE.PURPLE,z3=I3.ZERO.PINK,H3=I3.ONE.PINK,G3=I3.ZERO.YELLOW,q3=I3.ONE.YELLOW,W3=I3.ZERO.RED,j3=I3.ONE.RED,Z3=I3.ZERO.GREEN,Y3=I3.ONE.GREEN,K3=I3.ZERO.BROWN,J3=I3.ONE.BROWN;class Q3{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`At Kamisado, there are two ways to win the game:
        either by moving one of your pieces on the opponent's starting line,
        or by forcing the opponent to make a move that blocks the entire game.
        Here, Dark wins because its brown piece is on Light's starting line, on the top left.`,new N3(5,T3.ORANGE,vw.empty(),!1,[[K3,V3,$3,H3,q3,j3,Y3,J3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,F3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,Z3,W3,G3,z3,U3,B3,L3]])).withPreviousMove(A3.of(new GJ(0,7),new GJ(0,0))),wQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
        At Kamisado, pieces can only move forward, vertically or diagonally.
        You're playing first, with dark pieces, you can make your first move.<br/><br/>
        Click on the piece of your choice and click on the landing square.`,N3.getInitialState(),A3.of(new GJ(7,7),new GJ(3,3)),$localize`Perfect! Note that each of your piece has a different color.`),wQ.fromMove($localize`Moving`,$localize`Let us now consider the move of Light, after the blue piece has been moved by Dark.
        All moves after the initial move must be made from the piece that corresponds to the color
        of the square upon which the last move ended.
        Here, the last move ended on the pink square, hence the pink piece must move.
        It is already selected, you do not have to click on it.<br/><br/>
        Move it on a blue square.`,new N3(1,T3.PINK,vw.of(new GJ(3,0)),!1,[[F3,V3,$3,H3,q3,j3,Y3,J3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,B3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[K3,Z3,W3,G3,z3,U3,D3,L3]]),[A3.of(new GJ(3,0),new GJ(3,6)),A3.of(new GJ(3,0),new GJ(4,1))],$localize`Congratulations!`,$localize`You have not moved your pink piece on a blue square!`).withPreviousMove(A3.of(new GJ(6,7),new GJ(6,5))),wQ.informational($localize`Stuck situation`,$localize`Dark moved to another pink square, hence you have to move your pink piece again.
        However, your pink piece is stuck! In this case, you must pass your turn.
        Dark will now have to play by moving its pink piece.`,new N3(1,T3.PINK,vw.of(new GJ(3,6)),!1,[[F3,V3,$3,D3,q3,j3,Y3,J3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,D3,B3],[D3,D3,D3,D3,D3,D3,D3,D3],[D3,D3,D3,H3,D3,D3,D3,D3],[K3,Z3,W3,G3,z3,U3,D3,L3]])).withPreviousMove(A3.of(new GJ(6,5),new GJ(7,4))),wQ.fromMove($localize`Victory by blocking`,$localize`At any time, if a player blocks the entire game, that player loses.
        In other words, if a player forces its opponent to move a piece that the opponent cannot move,
        and the player cannot move its own piece of the same color, then that player loses.
        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>
        Try to make this move.`,new N3(2,T3.RED,vw.of(new GJ(2,4)),!1,[[D3,V3,$3,D3,D3,j3,D3,D3],[D3,D3,D3,q3,D3,D3,D3,D3],[D3,D3,D3,H3,D3,$3,D3,D3],[D3,D3,D3,G3,D3,D3,D3,D3],[D3,D3,W3,D3,D3,D3,D3,D3],[D3,D3,D3,D3,D3,D3,Y3,D3],[F3,D3,D3,D3,D3,z3,D3,J3],[K3,Z3,D3,D3,D3,D3,B3,L3]]),[A3.of(new GJ(2,4),new GJ(0,2))],$localize`Perfect!
         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.
         Your orange piece will be stuck and you will have to pass your turn.
         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.
         In this case, the last player to have moved a piece loses.
         Here, your opponent will have moved its green piece last, you therefore win!`,$localize`Failed!`).withPreviousMove(A3.of(new GJ(4,0),new GJ(3,1)))]}}function X3(e,t){if(1&e&&(Cn(),pa(0,"circle",8)),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",i.SPACE_SIZE/2+t*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("fill",i.pieceColor(n))("r",i.SPACE_SIZE/3)}}function e4(e,t){if(1&e&&(Cn(),pa(0,"rect",9)),2&e){const e=ba(),t=e.$implicit,n=e.index,r=ba().index,i=ba();ua("ngClass",i.piecePlayerClass(t)),ra("x",i.SPACE_SIZE/2+n*i.SPACE_SIZE-i.SPACE_SIZE/8)("y",i.SPACE_SIZE/2+r*i.SPACE_SIZE-i.SPACE_SIZE/8)("rx",i.isPlayerZero(t)?i.SPACE_SIZE:0)("ry",i.isPlayerZero(t)?i.SPACE_SIZE:0)("width",i.SPACE_SIZE/4)("height",i.SPACE_SIZE/4)}}function t4(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"g",4),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),pa(2,"rect",5),aa(3,X3,1,4,"circle",6),aa(4,e4,1,7,"rect",7),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","click_",n,"_",r,""),Ts(1),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)("fill",i.backgroundColor(n,r)),Ts(1),ua("ngIf",e!==i.UNOCCUPIED),Ts(1),ua("ngIf",e!==i.UNOCCUPIED)}}function n4(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,t4,5,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function r4(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"rect",10),pa(2,"rect",10),fa()),2&e){const e=ba();Ts(1),ra("x",e.lastMove.get().coord.x*e.SPACE_SIZE)("y",e.lastMove.get().coord.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE),Ts(1),ra("x",e.lastMove.get().end.x*e.SPACE_SIZE)("y",e.lastMove.get().end.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function i4(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba();ra("cx",e.SPACE_SIZE/2+e.chosen.get().x*e.SPACE_SIZE)("cy",e.SPACE_SIZE/2+e.chosen.get().y*e.SPACE_SIZE)}}let s4=(()=>{class e extends rX{constructor(e){super(e),this.UNOCCUPIED=I3.NONE,this.lastMove=vw.empty(),this.chosen=vw.empty(),this.chosenAutomatically=!1,this.rules=new x3(N3),this.availableMinimaxes=[new R3(this.rules,"KamisadoMinimax")],this.encoder=A3.encoder,this.tutorial=(new Q3).tutorial,this.canPass=!1,this.updateBoard()}backgroundColor(e,t){return k3.getColorAt(e,t).rgb}isPlayerZero(e){return e.player===VY.ZERO}pieceColor(e){return e.color.rgb}piecePlayerClass(e){return this.getPlayerClass(e.player)}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=x3.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=vw.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}pass(){var e=this;return dw(function*(){return MG(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(A3.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new GJ(e,t);if(n.canPass)return n.cancelMove(tQ.MUST_PASS());if(n.chosen.isAbsent())return n.choosePiece(e,t);if(!1===n.chosenAutomatically&&n.chosen.equalsValue(i))return n.cancelMoveAttempt(),kG.SUCCESS;{const r=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer();return r.belongsTo(s)?n.chosenAutomatically?n.cancelMove(M3.PLAY_WITH_SELECTED_PIECE()):(n.chosen=vw.of(i),kG.SUCCESS):yield n.chooseDestination(e,t)}})()}choosePiece(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=vw.of(new GJ(e,t)),kG.SUCCESS)}chooseDestination(e,t){var n=this;return dw(function*(){const r=n.chosen.get(),i=new GJ(e,t),s=A3.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}cancelMoveAttempt(){this.chosenAutomatically||(this.chosen=vw.empty())}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-kamisado"]],features:[Ho],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,n4,2,1,"g",1),aa(2,r4,3,8,"g",2),aa(3,i4,1,2,"circle",3),fa()),2&e&&(ra("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.lastMove.isPresent()),Ts(1),ua("ngIf",t.chosen.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),o4=(()=>{class e extends aQ{static getInitialState(){const t=VY.NONE,n=VY.ZERO,r=VY.ONE;return new e([[t,n,n,n,n,n,n,t],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[t,n,n,n,n,n,n,t]],0)}static isOnBoard(t){return t.isInRange(e.SIZE,e.SIZE)}}return e.SIZE=8,e})();class a4 extends fX{constructor(e,t,n){super(e,t),this.direction=n,this.direction=zJ.factory.fromMove(e,t).get()}static of(e,t){const n=zJ.factory.fromMove(e,t);return n.isFailure()?OG.failure(n.getReason()):e.isNotInRange(o4.SIZE,o4.SIZE)?OG.failure("start coord is not in range"):t.isNotInRange(o4.SIZE,o4.SIZE)?OG.failure("end coord is not in range"):OG.success(new a4(e,t,n.get()))}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}encode(){return a4.encoder.encode(this)}decode(e){return a4.encoder.decode(e)}}a4.encoder=fX.getEncoder(o4.SIZE,o4.SIZE,(e,t)=>a4.of(e,t).get());let c4=(()=>{class e{}return e.INVALID_MOVE_LENGTH=()=>$localize`Your move should have a length equal to the number of pieces that exist on the same line.`,e.CANNOT_JUMP_OVER_OPPONENT=()=>$localize`You cannot jump over the opponent's pieces.`,e.PIECE_CANNOT_MOVE=()=>$localize`This piece has no possible move, select another one.`,e.INVALID_DIRECTION=()=>$localize`A move must be orthogonal or diagonal`,e})();class l4 extends vQ{static getListMovesFromState(e){const t=[];if(l4.getVictory(e).isPresent())return t;for(let n=0;n<o4.SIZE;n++)for(let r=0;r<o4.SIZE;r++){const i=new GJ(r,n);if(e.getPieceAt(i)!==VY.NONE)for(const n of l4.possibleTargets(e,i)){const e=a4.of(i,n).get();t.push(e)}}return t}static getNumberOfGroups(e){const t=LG.createTable(o4.SIZE,o4.SIZE,-1),n=[0,0];let r=0;for(let i=0;i<o4.SIZE;i++)for(let s=0;s<o4.SIZE;s++)if(-1===t[i][s]){const o=e.getPieceAt(new GJ(s,i));o!==VY.NONE&&(r+=1,l4.markGroupStartingAt(e,t,new GJ(s,i),r),n[o.value]+=1)}return n}static markGroupStartingAt(e,t,n,r){const i=[n],s=e.getPieceAt(n);for(;i.length>0;){const n=fw.getNonNullable(i.pop());if(-1===t[n.y][n.x]){const o=e.getPieceAt(n);if(o===s){t[n.y][n.x]=r;for(const t of zJ.DIRECTIONS){const r=n.getNext(t);e.isOnBoard(r)&&i.push(r)}}else o===VY.NONE&&(t[n.y][n.x]=0)}}}applyLegalMove(e,t,n){const r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=VY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new o4(r,t.turn+1)}static isLegal(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?OG.failure(c4.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(e=>t.getPieceAt(e)===t.getCurrentOpponent())?OG.failure(c4.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?OG.failure(tQ.CANNOT_SELF_CAPTURE()):OG.success(void 0)}isLegal(e,t){return l4.isLegal(e,t)}static numberOfPiecesOnLine(e,t,n){let r=0;for(const i of l4.getLineCoords(t,n))e.getPieceAt(i)!==VY.NONE&&(r+=1);return r}static getLineCoords(e,t){const n=l4.getEntranceAndForwardDirection(e,t);let r=n[0];const i=n[1],s=[];for(;o4.isOnBoard(r);)s.push(r),r=r.getNext(i);return s}static getEntranceAndForwardDirection(e,t){switch(t){case zJ.UP:case zJ.DOWN:return[new GJ(e.x,0),zJ.DOWN];case zJ.LEFT:case zJ.RIGHT:return[new GJ(0,e.y),zJ.RIGHT];case zJ.UP_RIGHT:case zJ.DOWN_LEFT:return[new GJ(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),zJ.UP_RIGHT];default:return fw.expectToBeMultiple(t,[zJ.UP_LEFT,zJ.DOWN_RIGHT]),[new GJ(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),zJ.DOWN_RIGHT]}}static getVictory(e){const[t,n]=l4.getNumberOfGroups(e);return 1===t&&1===n?vw.of(VY.NONE):1===t?vw.of(VY.ZERO):1===n?vw.of(VY.ONE):vw.empty()}static possibleTargets(e,t){const n=[];for(const r of zJ.DIRECTIONS){const i=l4.numberOfPiecesOnLine(e,t,r),s=t.getNext(r,i);if(e.isOnBoard(s)){const r=a4.of(t,s).get();l4.isLegal(r,e).isSuccess()&&n.push(s)}}return n}getGameStatus(e){const t=e.gameState,[n,r]=l4.getNumberOfGroups(t);return 1===n&&r>1?yQ.ZERO_WON:n>1&&1===r?yQ.ONE_WON:yQ.ONGOING}}class u4 extends nQ{getListMoves(e){return l4.getListMovesFromState(e.gameState)}getBoardValue(e){const t=e.gameState,[n,r]=l4.getNumberOfGroups(t);return new rQ(1===n&&r>1?VY.ZERO.getVictoryValue():n>1&&1===r?VY.ONE.getVictoryValue():100/n*VY.ZERO.getScoreModifier()+100/r*VY.ONE.getScoreModifier())}}const h4=VY.ZERO,d4=VY.ONE,f4=VY.NONE;class p4{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.
        Here, Dark wins the game:
        Dark's pieces are forming a single group, while Light's pieces form three groups.`,new o4([[f4,f4,f4,f4,f4,f4,f4,f4],[d4,f4,f4,f4,h4,f4,f4,d4],[f4,f4,h4,h4,d4,f4,f4,f4],[f4,f4,f4,h4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4]],0)),wQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
         Moves can be made orthogonally or diagonally.
         The length of a move is equal to the number of pieces that are on the line of the move.
         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>
         You're playing Dark, make the first move!`,o4.getInitialState(),a4.of(new GJ(1,7),new GJ(1,5)).get(),$localize`Congratulations!`),wQ.fromMove($localize`Jumping`,$localize`During a move, it is possible to jump above your own pieces.
        But it is forbidden to jump over the opponent's pieces.<br/><br/>
        You're playing Dark, make a jump over one of your pieces on the following board.`,new o4([[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,d4,h4,h4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,f4,f4,h4]],0),[a4.of(new GJ(3,1),new GJ(6,1)).get()],$localize`Congratulations!`,$localize`Failed. You did not jump over one of your pieces.`),wQ.fromMove($localize`Moving`,$localize`Here is a different board. Pick the dark piece in the middle (line 4, column 4)
        and observe its possible moves.
        Horizontally, this piece can move only of one square because it is the only piece on this line.
        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.
        But it can only go up, as below it the landing square is occupied by one of your pieces.
        Diagonally, only one move is possible: on the diagonal that contains three pieces,
        only in the direction where it does not jump over one of the opponent's pieces.
        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>
        Make one of these moves.`,new o4([[f4,f4,f4,f4,f4,f4,d4,f4],[f4,f4,f4,f4,f4,h4,f4,f4],[f4,f4,f4,f4,d4,f4,f4,f4],[f4,f4,f4,h4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,d4,f4,d4],[f4,f4,f4,h4,f4,f4,d4,d4],[f4,f4,f4,h4,f4,f4,f4,f4]],0),[a4.of(new GJ(3,3),new GJ(3,0)).get(),a4.of(new GJ(3,3),new GJ(0,0)).get(),a4.of(new GJ(3,3),new GJ(2,3)).get(),a4.of(new GJ(3,3),new GJ(4,3)).get()],$localize`Congratulations!`,$localize`Failed. This was not one of the expected moves.`),wQ.fromMove($localize`Capturing`,$localize`If a move ends on an opponent's pieces, this one is captured and removed from the board.
        However, a move cannot end on one of the player's pieces.
        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!
        If a player has only one piece, that player wins the game.<br/><br/>
        On the following board, try to capture one piece with Dark.`,new o4([[f4,h4,f4,h4,h4,h4,h4,f4],[d4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,h4,f4,d4,f4,f4,f4],[d4,f4,f4,f4,f4,f4,f4,d4],[d4,f4,f4,f4,f4,f4,f4,d4],[d4,f4,f4,f4,f4,f4,f4,d4],[d4,f4,f4,f4,f4,f4,f4,d4],[f4,h4,h4,h4,h4,h4,h4,f4]],0),[a4.of(new GJ(2,2),new GJ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`),wQ.fromMove($localize`Tie`,$localize`In the special case where a move ends up connecting all pieces of both player, simultaneously,
        then the game ends up with a tie.<br/><br/>
        You're playing Dark, force the tie in one move.`,new o4([[f4,f4,f4,f4,f4,f4,f4,f4],[f4,f4,f4,f4,f4,f4,f4,f4],[h4,f4,f4,h4,d4,h4,f4,f4],[f4,f4,f4,h4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,f4,f4,d4],[f4,f4,f4,f4,f4,f4,f4,f4]],0),[a4.of(new GJ(0,2),new GJ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`)]}}function g4(e,t){if(1&e&&(Cn(),pa(0,"circle",5)),2&e){const e=ba().index,t=ba().index,n=ba();ua("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE/2+e*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+t*n.SPACE_SIZE)}}function m4(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"g",2),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),pa(2,"rect",3),aa(3,g4,1,3,"circle",4),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","click_",n,"_",r,""),Ts(1),ua("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngIf",e!==i.EMPTY)}}function y4(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,m4,4,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function v4(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",6),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}let _4=(()=>{class e extends rX{constructor(e){super(e),this.INDICATOR_SIZE=20,this.EMPTY=VY.NONE,this.targets=[],this.selected=vw.empty(),this.lastMove=vw.empty(),this.captured=vw.empty(),this.rules=new l4(o4),this.availableMinimaxes=[new u4(this.rules,"LinesOfActionMinimax")],this.encoder=a4.encoder,this.tutorial=(new p4).tutorial,this.updateBoard()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new GJ(e,t);if(n.selected.isPresent()){if(n.getState().getPieceAt(i)===n.getState().getCurrentPlayer())return n.select(i);{const r=a4.of(n.selected.get(),new GJ(e,t));return r.isSuccess()?n.chooseMove(r.get(),n.rules.node.gameState):n.cancelMove(c4.INVALID_DIRECTION())}}return n.select(i)})()}select(e){var t=this;return dw(function*(){return t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=vw.of(e),t.targets=l4.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(c4.PIECE_CANNOT_MOVE()):kG.SUCCESS)})()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}updateBoard(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end)!==VY.NONE?vw.of(e.end):vw.empty()}}cancelMoveAttempt(){this.selected=vw.empty(),this.targets=[]}getSquareClasses(e,t){const n=new GJ(e,t);if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(e)||n.equals(t))return["moved"]}return[]}getPieceClasses(e,t){const n=this.board[t][e],r=new GJ(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-linesofaction"]],features:[Ho],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["r","40","class","base",3,"ngClass",4,"ngIf"],["r","40",1,"base",3,"ngClass"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,y4,2,1,"g",1),aa(2,v4,2,4,"g",1),fa()),2&e&&(Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.targets))},directives:[Ud,Bd,zd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();const C4=Number.MAX_SAFE_INTEGER,E4=Number.MIN_SAFE_INTEGER;class w4 extends aQ{constructor(e,t){super(LG.copyBiArray(w4.initialBoard),e),this.turn=e,this.location=t}static getInitialState(){return new w4(0,new GJ(0,0))}}w4.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],w4.BOARD_1=[[0,+C4,-1,-1],[1,2,+C4,-1],[+E4,3,4,-1],[-1,+E4,+E4,-1]],w4.BOARD_2=[[0,+C4,-1,-1],[+C4,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],w4.BOARD_3=[[0,1,+E4,-1],[1,+E4,-1,-1],[+E4,-1,-1,-1],[-1,-1,-1,-1]],w4.BOARD_4=[[0,1,+E4,-1],[1,+E4,-1,-1],[+E4,-1,-1,-1],[-1,-1,-1,1]],w4.initialBoard=w4.BOARD_0;class b4 extends vQ{static getGameStatus(e){const t=e.gameState,n=t.getPieceAt(t.location);return n===VY.ZERO.getVictoryValue()?yQ.ZERO_WON:n===VY.ONE.getVictoryValue()?yQ.ONE_WON:t.location.equals(new GJ(3,3))?0===n?yQ.DRAW:n>0?yQ.ONE_WON:yQ.ZERO_WON:yQ.ONGOING}applyLegalMove(e,t,n){const r=new GJ(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new w4(t.turn+1,r)}isLegal(e,t){const n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?OG.failure("incorrect move"):OG.success(void 0)}getGameStatus(e){return b4.getGameStatus(e)}}class S4 extends lQ{constructor(e){super(),this.right=e}equals(e){return this===e||this.right===e.right}toString(){return this.right?"Move RIGHT":"Move DOWN"}}S4.RIGHT=new S4(!0),S4.DOWN=new S4(!1),S4.encoder=new class extends BY{maxValue(){return 1}decodeNumber(e){return 0===e?S4.RIGHT:S4.DOWN}encodeNumber(e){return e.right?0:1}};class P4 extends nQ{getBoardValue(e){const t=b4.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());const n=e.gameState;return new rQ(n.getPieceAt(n.location))}getListMoves(e){const t=[],n=e.gameState;return n.location.x<3&&t.push(S4.RIGHT),n.location.y<3&&t.push(S4.DOWN),t}}function O4(e,t){1&e&&(ga(0),Da(1,"("),ma())}function T4(e,t){1&e&&(ga(0),Da(1,")"),ma())}function I4(e,t){if(1&e&&(da(0,"td"),aa(1,O4,2,0,"ng-container",3),Da(2),aa(3,T4,2,0,"ng-container",3),fa()),2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),ua("ngIf",i.coord.x===n&&i.coord.y===r),Ts(1),Fa(" ",e," "),Ts(1),ua("ngIf",i.coord.x===n&&i.coord.y===r)}}function k4(e,t){if(1&e&&(da(0,"tr"),aa(1,I4,4,3,"td",0),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let A4=(()=>{class e extends rX{constructor(e){super(e),this.coord=new GJ(-1,-1),this.rules=new b4(w4),this.availableMinimaxes=[new P4(this.rules,"MinimaxTestingMinimax")],this.encoder=S4.encoder}chooseRight(){var e=this;return dw(function*(){const t=e.canUserPlay("#click_right");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(S4.RIGHT,e.rules.node.gameState)})()}chooseDown(){var e=this;return dw(function*(){const t=e.canUserPlay("#click_down");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(S4.DOWN,e.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-minimax-testing"]],features:[Ho],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(da(0,"table"),aa(1,k4,2,1,"tr",0),da(2,"div",1),Ca("click",function(){return t.chooseRight()}),Da(3," goRight "),fa(),da(4,"div",2),Ca("click",function(){return t.chooseDown()}),Da(5," goDown "),fa(),da(6,"div"),Da(7),fa(),fa()),2&e&&(Ts(1),ua("ngForOf",t.board),Ts(6),Fa(" ",t.coord," "))},directives:[Ud,zd],encapsulation:2}),e})();class N4 extends aQ{static getInitialState(){const e=LG.createTable(7,6,VY.NONE);return new N4(e,0)}}class M4 extends lQ{constructor(e){super(),this.x=e}static of(e){switch(e){case 0:return M4.ZERO;case 1:return M4.ONE;case 2:return M4.TWO;case 3:return M4.THREE;case 4:return M4.FOUR;case 5:return M4.FIVE;case 6:return M4.SIX;default:throw new Error("Invalid P4Move")}}equals(e){return this===e}toString(){return"P4Move("+this.x+")"}}M4.ZERO=new M4(0),M4.ONE=new M4(1),M4.TWO=new M4(2),M4.THREE=new M4(3),M4.FOUR=new M4(4),M4.FIVE=new M4(5),M4.SIX=new M4(6),M4.encoder=new class extends BY{maxValue(){return 6}encodeNumber(e){return e.x}decodeNumber(e){return M4.of(e)}};let x4=(()=>{class e{}return e.COLUMN_IS_FULL=()=>$localize`Please put your piece in an incomplete column.`,e})(),R4=(()=>{class e extends vQ{static getVictoriousCoords(t){const n=[];for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r]!==VY.NONE;i--){const s=e.getSquareScore(t.board,new GJ(r,i));(s===VY.ZERO.getVictoryValue()||s===VY.ONE.getVictoryValue())&&n.push(new GJ(r,i))}return n}static getBoardValueFromScratch(t){pw(e.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:t}});let n=0;for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r]!==VY.NONE;i--){const s=e.getSquareScore(t.board,new GJ(r,i));if(mQ.getScoreStatus(s)!==dQ.DEFAULT)return pw(e.VERBOSE,{preVictoryOrVictory:{state:t,tmpScore:s,coord:{x:r,y:i}}}),new rQ(s);n+=s}return new rQ(n)}static getLowestUnoccupiedCase(e,t){let n=0;for(;n<6&&e[n][t]===VY.NONE;)n++;return n-1}static getNumberOfFreeSpacesAndAllies(e,t,n,r,i){let s=0,o=0,a=!0,c=new GJ(t.x+n.x,t.y+n.y);for(;c.isInRange(7,6)&&3!==s;){const t=e[c.y][c.x];if(t===r)return[s,o];t===i&&a?o++:a=!1,t!==r&&t!==i&&s++,c=c.getNext(n)}return[s,o]}static getOpponent(e,t){const n=e[t.y][t.x];return MG(n!==VY.NONE,"getOpponent should not be called with Player.NONE"),n===VY.ONE?VY.ZERO:VY.ONE}static getSquareScore(t,n){pw(e.VERBOSE,"getSquareScore(board, "+n.x+", "+n.y+") called"),pw(e.VERBOSE,t),MG(t[n.y][n.x]!==VY.NONE,"getSquareScore should not be called on an empty space");let r=0;const i=e.getOpponent(t,n),s=t[n.y][n.x],o=new fQ,a=new fQ;for(const c of zJ.DIRECTIONS){const r=e.getNumberOfFreeSpacesAndAllies(t,n,c,i,s);o.set(c,r[0]),a.set(c,r[1])}for(const c of[zJ.UP,zJ.UP_RIGHT,zJ.RIGHT,zJ.DOWN_RIGHT]){const i=a.get(c).get()+a.get(c.getOpposite()).get();if(i>2)return pw(e.VERBOSE,{text:"there is some kind of victory here ("+n.x+", "+n.y+")\nline allies : "+i+"\n",board:t}),s.getVictoryValue();const l=o.get(c).get()+o.get(c.getOpposite()).get();3===l?r+=2:l>3&&(r+=l-2)}return r*s.getScoreModifier()}static getListMoves(t){pw(e.VERBOSE,{context:"P4Rules.getListMoves",node:t});const n=t.gameState,r=[];for(let e=0;e<7;e++)if(n.getPieceAtXY(e,0)===VY.NONE){const t=M4.of(e);r.push(t)}return r}static getBoardValue(t){return pw(e.VERBOSE,{text:"P4Rules.getBoardValue called",board:t.getCopiedBoard()}),e.getBoardValueFromScratch(t)}applyLegalMove(t,n,r){const i=t.x,s=n.getCopiedBoard(),o=e.getLowestUnoccupiedCase(s,i),a=n.turn;return s[o][i]=n.getCurrentPlayer(),new N4(s,a+1)}isLegal(t,n){return pw(e.VERBOSE,{context:"P4Rules.isLegal",move:t.toString(),state:n}),n.getPieceAtXY(t.x,0)!==VY.NONE?OG.failure(x4.COLUMN_IS_FULL()):OG.success(void 0)}getGameStatus(t){const n=t.gameState;for(let r=0;r<7;r++)for(let t=5;-1!==t&&n.board[t][r]!==VY.NONE;t--){const i=e.getSquareScore(n.board,new GJ(r,t));if(mQ.getScoreStatus(i)===dQ.VICTORY)return yQ.getVictory(n.getCurrentOpponent())}return 42===n.turn?yQ.DRAW:yQ.ONGOING}}return e.VERBOSE=!1,e})();class D4 extends nQ{getListMoves(e){return R4.getListMoves(e)}getBoardValue(e){const t=e.gameState;return pw(R4.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),R4.getBoardValue(t)}}const L4=VY.ZERO,F4=VY.ONE,B4=VY.NONE;class V4{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.
        The first player plays Dark, the second plays Light.
        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally).`,N4.getInitialState()),wQ.anyMove($localize`Dropping a piece`,$localize`Click on any space in any column.`,N4.getInitialState(),M4.THREE,$localize`As you can see, the piece falls at the bottom of the column.`),wQ.fromMove($localize`Victory`,$localize`You're playing Dark.
        Place your piece so that you create a horizontal alignment of 4 of your pieces.`,new N4([[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,F4,B4,B4,B4],[B4,B4,B4,F4,B4,B4,B4],[B4,B4,L4,L4,L4,F4,B4]],0),[M4.of(1)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`),wQ.fromMove($localize`Other victory`,$localize`You can also align 4 pieces diagonally or vertically.`,new N4([[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,L4,F4,B4,B4],[B4,B4,L4,L4,F4,B4,B4],[B4,L4,F4,L4,L4,B4,B4]],0),[M4.of(3),M4.of(4)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`)]}}function U4(e,t){if(1&e&&(Cn(),pa(0,"circle",6)),2&e){const e=ba().index,t=ba().index,n=ba();ua("ngClass",n.getSquareFillClass(e,t)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function $4(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",4),Ca("click",function(){const t=Gt(e).index;return ba(2).onClick(t)}),fa(),aa(2,U4,1,4,"circle",5),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Pa("id","click_",n,""),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngIf",e!=i.EMPTY_CASE)}}function z4(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,$4,3,6,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function H4(e,t){if(1&e&&(Cn(),pa(0,"rect",7)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.last.get().x)("y",e.SPACE_SIZE*e.last.get().y)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function G4(e,t){if(1&e&&(Cn(),pa(0,"rect",8)),2&e){const e=t.$implicit,n=ba();Oa("id","victory_coord_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let q4=(()=>{class e extends rX{constructor(e){super(e),this.EMPTY_CASE=VY.NONE,this.victoryCoords=[],this.rules=new R4(N4),this.availableMinimaxes=[new D4(this.rules,"P4Minimax")],this.encoder=M4.encoder,this.tutorial=(new V4).tutorial,this.updateBoard()}onClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#click_"+e);if(n.isFailure())return t.cancelMove(n.getReason());const r=M4.of(e);return yield t.chooseMove(r,t.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=R4.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}showLastMove(){const e=this.rules.node.move,t=R4.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=vw.of(new GJ(e.get().x,t))}hideLastMove(){this.last=vw.empty()}getSquareFillClass(e,t){return[this.getPlayerClass(this.board[t][e])]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-p4"]],features:[Ho],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[1,"base",3,"id","click"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,z4,2,1,"g",1),aa(2,H4,1,4,"rect",2),aa(3,G4,1,6,"rect",3),fa()),2&e&&(Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.last.isPresent()),Ts(1),ua("ngForOf",t.victoryCoords))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class W4 extends uQ{constructor(e,t,n,r=!1){if(super(e,t),this.blockTurned=n,this.turnedClockwise=r,this.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+this.coord.toString())}static withRotation(e,t,n,r){if(n<0||3<n)throw new Error("This block do not exist: "+n);return new W4(e,t,vw.of(n),r)}static rotationless(e,t){return new W4(e,t,vw.empty())}toString(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}W4.encoder=new class extends FY{encodeMove(e){const t={coord:GJ.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}decodeMove(e){const t=e,n=GJ.encoder.decode(t.coord),r=vw.ofNullable(t.blockTurned);if(r.isPresent()){const e=t.turnedClockwise;return W4.withRotation(n.x,n.y,r.get(),e)}return W4.rotationless(n.x,n.y)}};let j4=(()=>{class e{}return e.CANNOT_ROTATE_NEUTRAL_BLOCK=()=>$localize`If the quadrant to turn is neutral, please just use move without rotation.`,e.MUST_CHOOSE_BLOCK_TO_ROTATE=()=>$localize`No quadrant is neutral, you must pick a quadrant to rotate.`,e})();class Z4 extends aQ{constructor(e,t){super(e,t),this.neutralBlocks=this.getBlocksNeutralities()}static getInitialState(){const e=LG.createTable(6,6,VY.NONE);return new Z4(e,0)}getBlocksNeutralities(){const e=[];for(let t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}getBlockNeutrality(e){const t=Z4.getBlockCenter(e),n=this.getPieceAt(t.getNext(zJ.UP,1)),r=this.getPieceAt(t.getNext(zJ.UP_LEFT,1));return this.getPieceAt(t.getNext(zJ.RIGHT,1))===n&&this.getPieceAt(t.getNext(zJ.DOWN,1))===n&&this.getPieceAt(t.getNext(zJ.LEFT,1))===n&&this.getPieceAt(t.getNext(zJ.UP_RIGHT,1))===r&&this.getPieceAt(t.getNext(zJ.DOWN_RIGHT,1))===r&&this.getPieceAt(t.getNext(zJ.DOWN_LEFT,1))===r}static getBlockCenter(e){return new GJ(1+(e%2==0?0:3),1+(e<2?0:3))}applyLegalDrop(e){const t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new Z4(t,this.turn)}applyLegalMove(e){const t=this.applyLegalDrop(e),n=t.getCopiedBoard();if(e.blockTurned.isPresent()){const r=Z4.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise)for(const e of Z4.ROTATION_MAP){const i=e[0].getNext(r),s=e[1].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}else for(const e of Z4.ROTATION_MAP){const i=e[1].getNext(r),s=e[0].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}}return new Z4(n,this.turn+1)}blockIsNeutral(e){return this.neutralBlocks.includes(e)}}Z4.ROTATION_MAP=[[new GJ(-1,-1),new GJ(1,-1)],[new GJ(0,-1),new GJ(1,0)],[new GJ(1,-1),new GJ(1,1)],[new GJ(1,0),new GJ(0,1)],[new GJ(1,1),new GJ(-1,1)],[new GJ(0,1),new GJ(-1,0)],[new GJ(-1,1),new GJ(-1,-1)],[new GJ(-1,0),new GJ(0,-1)]];class Y4 extends vQ{static get(){return null==Y4.singleton&&(Y4.singleton=new Y4(Z4)),mQ.ruler=this.singleton,this.singleton}applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){if(t.getPieceAt(e.coord)!==VY.NONE)return OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return OG.failure(j4.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){const t=e.blockTurned.get();if(n.neutralBlocks.includes(t))return OG.failure(j4.CANNOT_ROTATE_NEUTRAL_BLOCK())}return OG.success(void 0)}getVictoryCoords(e){let t=[];for(const n of Y4.VICTORY_SOURCE){const r=e.getPieceAt(n[0]),i=[n[0]];if(r!==VY.NONE){let s=n[0].getNext(n[1]),o=!0;for(let t=0;t<3&&o;t++)e.getPieceAt(s)!==r?o=!1:(i.push(s),s=s.getNext(n[1]));if(o&&(e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i)),n[2])){const s=n[0].getPrevious(n[1],1);e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i))}}}return t}getGameStatus(e){const t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1];for(let i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?yQ.DRAW:yQ.ZERO_WON:!0===r[1]?yQ.ONE_WON:36===t.turn?yQ.DRAW:yQ.ONGOING}}Y4.VICTORY_SOURCE=[[new GJ(1,0),new VJ(1,1),!1],[new GJ(0,1),new VJ(1,1),!1],[new GJ(4,0),new VJ(-1,1),!1],[new GJ(5,1),new VJ(-1,1),!1],[new GJ(1,1),new VJ(1,1),!0],[new GJ(4,1),new VJ(-1,1),!0],[new GJ(0,1),new VJ(0,1),!0],[new GJ(1,1),new VJ(0,1),!0],[new GJ(2,1),new VJ(0,1),!0],[new GJ(3,1),new VJ(0,1),!0],[new GJ(4,1),new VJ(0,1),!0],[new GJ(5,1),new VJ(0,1),!0],[new GJ(1,0),new VJ(1,0),!0],[new GJ(1,1),new VJ(1,0),!0],[new GJ(1,2),new VJ(1,0),!0],[new GJ(1,3),new VJ(1,0),!0],[new GJ(1,4),new VJ(1,0),!0],[new GJ(1,5),new VJ(1,0),!0]];class K4 extends nQ{getListMoves(e){const t=[],n=e.gameState.neutralBlocks;if(0===e.gameState.turn)return K4.FIRST_TURN_MOVES;const r=this.getLegalDrops(e.gameState);for(const i of r){const r=W4.rotationless(i.x,i.y),s=e.gameState.applyLegalDrop(r),o=this.getLegalRotations(s,n);for(const e of o)t.push(W4.withRotation(i.x,i.y,e[0],e[1]));0===s.neutralBlocks.length==0&&t.push(r)}return t}getLegalDrops(e){const t=[];for(let n=0;n<6;n++)for(let r=0;r<6;r++){const i=new GJ(r,n);e.getPieceAt(i)===VY.NONE&&t.push(i)}return t}getLegalRotations(e,t){const n=0===e.neutralBlocks.length,r=[];for(let i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}getBoardValue(e){return new rQ(Y4.get().getGameStatus(e).toBoardValue())}}K4.FIRST_TURN_MOVES=[W4.rotationless(0,0),W4.rotationless(1,0),W4.rotationless(2,0),W4.rotationless(0,1),W4.rotationless(1,1),W4.rotationless(0,2)];const J4=VY.NONE,Q4=VY.ONE,X4=VY.ZERO;class e5{constructor(){this.tutorial=[wQ.informational($localize`Initial board`,$localize`The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate.`,Z4.getInitialState()),wQ.informational($localize`Goal of the game`,$localize`The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins.`,new Z4([[X4,J4,J4,X4,Q4,J4],[X4,Q4,J4,J4,J4,J4],[X4,J4,Q4,J4,J4,J4],[X4,J4,J4,J4,J4,Q4],[X4,J4,J4,J4,Q4,J4],[J4,J4,J4,J4,J4,J4]],10)).withPreviousMove(W4.withRotation(0,0,0,!1)),wQ.fromPredicate($localize`Simple move`,$localize`At their turn, players put a piece on the board and possibly rotate one quadrant.
        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.
        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>
        Do it.`,new Z4([[J4,J4,J4,J4,J4,J4],[J4,X4,J4,J4,Q4,J4],[J4,J4,J4,J4,J4,J4],[J4,J4,J4,J4,J4,J4],[J4,Q4,J4,J4,X4,J4],[J4,J4,J4,J4,J4,J4]],10),W4.rotationless(2,2),(e,t)=>e.blockTurned.isPresent()?kG.failure($localize`You have made a move with a rotation. This tutorial step is about moves without rotations!`):kG.SUCCESS,$localize`Congratulations!`),wQ.fromPredicate($localize`Move with rotation`,$localize`After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>
        Click on one of them and see the rotation!`,new Z4([[J4,J4,J4,J4,J4,J4],[J4,X4,J4,J4,Q4,J4],[J4,J4,J4,J4,J4,J4],[J4,J4,J4,J4,J4,J4],[J4,Q4,J4,J4,X4,J4],[J4,J4,J4,J4,J4,J4]],10),W4.withRotation(0,0,0,!0),(e,t)=>e.blockTurned.isPresent()?kG.SUCCESS:kG.failure($localize`You made a move without rotation, try again!`),$localize`Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation.`)]}}function t5(e,t){if(1&e){const e=ya();Cn(),ga(0),da(1,"circle",9),Ca("click",function(){const t=Gt(e).$implicit,n=ba().$implicit,r=ba().index,i=ba().index;return ba().onClick(3*r+t,3*i+n)}),fa(),ma()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba(),i=r.index,s=r.$implicit,o=ba(),a=o.index,c=o.$implicit,l=ba();Ts(1),Oa("id","click_",3*i+e,"_",3*a+n,""),ua("ngClass",l.getSquareClasses(3*i+e,3*a+n)),ra("cx",s+2*l.STROKE_WIDTH+(e+.5)*l.SPACE_SIZE)("cy",c+2*l.STROKE_WIDTH+(n+.5)*l.SPACE_SIZE)("r",(l.SPACE_SIZE-l.STROKE_WIDTH)/2)}}const n5=function(){return[0,1,2]};function r5(e,t){1&e&&(Cn(),ga(0),aa(1,t5,2,6,"ng-container",3),ma()),2&e&&(Ts(1),ua("ngForOf",ou(1,n5)))}function i5(e,t){if(1&e&&(Cn(),ga(0),pa(1,"rect",8),aa(2,r5,2,2,"ng-container",3),ma()),2&e){const e=t.$implicit,n=t.index,r=ba(),i=r.index,s=r.$implicit,o=ba();Ts(1),ua("ngClass",o.getBlockClasses(n,i)),ra("x",o.STROKE_WIDTH+e)("y",o.STROKE_WIDTH+s)("rx",3*o.STROKE_WIDTH)("ry",3*o.STROKE_WIDTH)("width",o.BLOCK_WIDTH)("height",o.BLOCK_WIDTH),Ts(1),ua("ngForOf",ou(8,n5))}}const s5=function(e){return[0,e]};function o5(e,t){if(1&e&&(Cn(),ga(0),aa(1,i5,3,9,"ng-container",3),ma()),2&e){const e=ba();Ts(1),ua("ngForOf",au(1,s5,e.BLOCK_SEPARATION))}}function a5(e,t){if(1&e&&(Cn(),pa(0,"circle",10)),2&e){const e=ba();Oa("id","currentDrop_",e.currentDrop.get().x,"_",e.currentDrop.get().y,""),ua("ngClass",e.getPlayerClass(e.rules.node.gameState.getCurrentPlayer())),ra("cx",e.getCenter(e.currentDrop.get().x))("cy",e.getCenter(e.currentDrop.get().y))("r",(e.SPACE_SIZE-e.STROKE_WIDTH)/2)}}function c5(e,t){if(1&e){const e=ya();Cn(),da(0,"path",11),Ca("click",function(){const t=Gt(e).$implicit;return ba().rotate(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Oa("id","rotate_",e[1],"_",e[2]?"clockwise":"counterclockwise",""),ra("d",e[0])("stroke-width",2*n.STROKE_WIDTH)}}function l5(e,t){if(1&e&&(Cn(),pa(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Oa("id","victoryCoord_",e.x,"_",e.y,""),ua("ngClass",n.getSquareClasses(e.x,e.y)),ra("cx",n.getCenter(e.x))("cy",n.getCenter(e.y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)("stroke-width",n.STROKE_WIDTH)}}function u5(e,t){if(1&e){const e=ya();Cn(),da(0,"g",13),Ca("click",function(){return Gt(e),ba().skipRotation()}),pa(1,"circle",14),pa(2,"line",15),fa()}if(2&e){const e=ba();Ts(1),ra("cx",e.BLOCK_SEPARATION)("cy",e.BLOCK_SEPARATION)("r",.75*e.SPACE_SIZE)("stroke-width",2*e.STROKE_WIDTH),Ts(1),ra("x1",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("y1",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("x2",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("y2",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("stroke-width",2*e.STROKE_WIDTH)}}let h5=(()=>{class e extends rX{constructor(e){super(e),this.arrows=[],this.victoryCoords=[],this.rules=new Y4(Z4),this.availableMinimaxes=[new K4(this.rules,"PentagoMinimax")],this.encoder=W4.encoder,this.tutorial=(new e5).tutorial,this.BLOCK_WIDTH=3*this.SPACE_SIZE+2*this.STROKE_WIDTH,this.BLOCK_SEPARATION=this.BLOCK_WIDTH+2*this.STROKE_WIDTH,this.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*this.SPACE_SIZE,this.ARROWS=this.generateArrowsCoord(),this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}showLastMove(){const e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{const t=e.get();this.movedBlock=t.blockTurned;const n=new GJ(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new GJ(0,0))&&this.coordBelongToBlock(t)){let e;e=t.turnedClockwise?fw.getNonNullable(Z4.ROTATION_MAP.find(e=>e[0].equals(n)))[1]:fw.getNonNullable(Z4.ROTATION_MAP.find(e=>e[1].equals(n)))[0];const r=t.blockTurned.get();e=e.getNext(new VJ(r%2==0?1:4,r<2?1:4),1),this.lastDrop=vw.of(e)}else this.lastDrop=vw.of(t.coord)}}coordBelongToBlock(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}hidePreviousMove(){this.lastDrop=vw.empty(),this.movedBlock=vw.empty(),this.victoryCoords=[]}generateArrowsCoord(){const e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}cancelMoveAttempt(){this.arrows=[],this.currentDrop=vw.empty(),this.canSkipRotation=!1}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.board[t][e]!==VY.NONE)return n.cancelMove(tQ.MUST_LAND_ON_EMPTY_SPACE());const i=W4.rotationless(e,t),s=n.rules.node.gameState,o=s.applyLegalDrop(i);if(4===o.neutralBlocks.length)return n.chooseMove(i,s);const a=n.rules.getGameStatus(n.rules.node);return n.canSkipRotation=o.neutralBlocks.length>0&&!1===a.isEndGame,n.currentDrop=vw.of(new GJ(e,t)),n.displayArrows(o.neutralBlocks),kG.SUCCESS})()}getCenter(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}displayArrows(e){this.arrows=[];for(let t=0;t<4;t++)if(!1===e.includes(t)){const e=this.ARROWS.filter(e=>e[1]===t);this.arrows=this.arrows.concat(e)}}getBlockClasses(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}getSquareClasses(e,t){const n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new GJ(e,t))&&n.push("last-move"),n}rotate(e){var t=this;return dw(function*(){const n=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"));if(n.isFailure())return t.cancelMove(n.getReason());const r=t.currentDrop.get(),i=W4.withRotation(r.x,r.y,e[1],e[2]);return t.chooseMove(i,t.rules.node.gameState)})()}skipRotation(){var e=this;return dw(function*(){const t=e.canUserPlay("#skipRotation");if(t.isFailure())return e.cancelMove(t.getReason());const n=e.currentDrop.get(),r=W4.rotationless(n.x,n.y);return e.chooseMove(r,e.rules.node.gameState)})()}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-pentago"]],features:[Ho],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"defs"),da(2,"marker",1),pa(3,"polygon",2),fa(),fa(),aa(4,o5,2,3,"ng-container",3),aa(5,a5,1,6,"circle",4),aa(6,c5,1,4,"path",5),aa(7,l5,1,7,"circle",6),aa(8,u5,3,9,"g",7),fa()),2&e&&(Ts(4),ua("ngForOf",au(5,s5,t.BLOCK_SEPARATION)),Ts(1),ua("ngIf",t.currentDrop.isPresent()),Ts(1),ua("ngForOf",t.arrows),Ts(1),ua("ngForOf",t.victoryCoords),Ts(1),ua("ngIf",t.canSkipRotation))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class d5 extends GJ{constructor(e,t,n){if(super(e,t),this.z=n,e<0||e>3)throw new Error(`PylosCoord: Invalid X: ${e}.`);if(t<0||t>3)throw new Error(`PylosCoord: Invalid Y: ${t}.`);if(n<0||n>3)throw new Error(`PylosCoord: Invalid Z: ${n}.`);const r=4-n;if(this.isNotInRange(r,r))throw new Error(this.toString()+" is not in range.")}static encodeOptional(e){let t;return t=e.isPresent()?d5.encode(e.get())+1:0,t}static encode(e){return 16*e.x+4*e.y+e.z}static decodeToOptional(e){return 0===e?vw.empty():vw.of(d5.decode(e-1))}static decode(e){const t=e%4;e-=t;const n=(e/=4)%4;return e-=n,new d5(e/=4,n,t)}toString(){return"PylosCoord"+this.toShortString()}toShortString(){return"("+this.x+", "+this.y+", "+this.z+")"}equals(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}isUpperThan(e){return this.z>e.z}getLowerPieces(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");const e=this.z-1;return[new d5(this.x,this.y,e),new d5(this.x+1,this.y,e),new d5(this.x,this.y+1,e),new d5(this.x+1,this.y+1,e)]}getHigherPieces(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");const e=this.z+1,t=new GJ(this.x-1,this.y-1),n=new GJ(this.x,this.y-1),r=new GJ(this.x-1,this.y),i=new GJ(this.x,this.y),s=4-e;return[t,n,r,i].filter(e=>e.isInRange(s,s)).map(t=>new d5(t.x,t.y,e))}getNextValid(e){const t=new GJ(this.x,this.y).getNext(e),n=4-this.z;return t.isNotInRange(n,n)?vw.empty():vw.of(new d5(t.x,t.y,this.z))}}class f5 extends lQ{constructor(e,t,n,r){super(),this.startingCoord=e,this.landingCoord=t,this.firstCapture=n,this.secondCapture=r}static fromClimb(e,t,n){const r=vw.of(e),i=f5.checkCaptures(n),s=new f5(r,t,i.firstCapture,i.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return s}static checkCaptures(e){let t=vw.empty(),n=vw.empty();if(e.length>0&&(t=vw.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=vw.of(e[1]),e[1].isUpperThan(e[0])&&(t=vw.of(e[1]),n=vw.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}static fromDrop(e,t){const n=vw.empty(),r=f5.checkCaptures(t);return new f5(n,e,r.firstCapture,r.secondCapture)}static changeCapture(e,t){const n=f5.checkCaptures(t);return new f5(e.startingCoord,e.landingCoord,n.firstCapture,n.secondCapture)}isClimb(){return this.startingCoord.isPresent()}toString(){const e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}equals(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}f5.encoder=new class extends BY{maxValue(){return 17575999}encodeNumber(e){const t=d5.encode(e.landingCoord),n=d5.encodeOptional(e.startingCoord),r=d5.encodeOptional(e.firstCapture);return 270400*d5.encodeOptional(e.secondCapture)+4160*r+64*n+t}decodeNumber(e){const t=d5.decode(e%64);e-=e%64;const n=d5.decodeToOptional((e/=64)%65);e-=e%65;const r=d5.decodeToOptional((e/=65)%65);e-=e%65;const i=d5.decodeToOptional(e/=65);return new f5(n,t,r,i)}};class p5 extends oQ{constructor(e,t){super(t),this.boards=e}static getInitialState(){const e=LG.createTable(4,4,VY.NONE),t=LG.createTable(3,3,VY.NONE),n=LG.createTable(2,2,VY.NONE);return new p5([e,t,n,[[VY.NONE]]],0)}getPieceAt(e){return this.boards[e.z][e.y][e.x]}applyLegalMove(e){const t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:VY.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:VY.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:VY.NONE}),this.setBoardAts(t,this.turn+1)}setBoardAts(e,t){const n=[LG.copyBiArray(this.boards[0]),LG.copyBiArray(this.boards[1]),LG.copyBiArray(this.boards[2]),LG.copyBiArray(this.boards[3])];for(const r of e){const e=r.coord;n[e.z][e.y][e.x]=r.value}return new p5(n,t)}isLandable(e){if(this.getPieceAt(e)!==VY.NONE)return!1;if(0===e.z)return!0;const t=e.getLowerPieces();for(const n of t)if(this.getPieceAt(n)===VY.NONE)return!1;return!0}isSupporting(e){if(3===e.z)return!1;const t=e.getHigherPieces();for(const n of t)if(this.getPieceAt(n)!==VY.NONE)return!0;return!1}getPiecesRepartition(){const e={};e[VY.NONE.value]=0,e[VY.ZERO.value]=0,e[VY.ONE.value]=0;for(let t=0;t<3;t++)for(let n=0;n<4-t;n++)for(let r=0;r<4-t;r++){const i=new d5(r,n,t),s=this.getPieceAt(i);e[s.value]=1+e[s.value]}return e}}let g5=(()=>{class e{}return e.MUST_MOVE_UPWARD=()=>$localize`You must move your pieces upward.`,e.SHOULD_HAVE_SUPPORTING_PIECES=()=>$localize`Your piece must land on the board or on 4 other pieces.`,e.CANNOT_LAND=()=>$localize`You cannot land on this space.`,e.CANNOT_CAPTURE=()=>$localize`You cannot capture.`,e.INVALID_FIRST_CAPTURE=()=>$localize`Your first capture is invalid.`,e.INVALID_SECOND_CAPTURE=()=>$localize`Your second capture is invalid.`,e})();class m5 extends vQ{static getStateInfo(e){const t=[],n=[];for(let r=0;r<3;r++)for(let i=0;i<4-r;i++)for(let s=0;s<4-r;s++){const o=new d5(s,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}static getClimbingMoves(e){const t=[];for(const n of e.freeToMove)for(const r of e.landable)if(r.isUpperThan(n)&&!1===r.getLowerPieces().some(e=>n.equals(e))){const e=f5.fromClimb(n,r,[]);t.push(e)}return t}static getDropMoves(e){const t=[];for(const n of e.landable){const e=f5.fromDrop(n,[]);t.push(e)}return t}static canCapture(e,t){const n=e.getCurrentPlayer();for(const r of[HJ.UP,HJ.DOWN]){const i=t.getNextValid(r);if(i.isPresent()&&e.getPieceAt(i.get())===n)for(const t of[HJ.LEFT,HJ.RIGHT]){const s=i.get().getNextValid(t);if(s.isPresent()&&e.getPieceAt(s.get())===n){const t=r.getOpposite(),i=s.get().getNextValid(t).get();if(e.getPieceAt(i)===n)return!0}}}return!1}static getPossibleCaptures(e,t,n){const r=[],i=(e=e.filter(e=>!1===t.equalsValue(e))).concat(n);for(let s=0;s<i.length;s++){const e=i[s];r.push([e]);for(let t=s+1;t<i.length;t++)r.push([i[t],e])}return r}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}static isValidCapture(e,t,n){const r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(n=>e.getPieceAt(n)!==VY.NONE&&!1===n.equals(t.firstCapture.get())).length>0)}static getGameStatus(e){const t=e.gameState.getPiecesRepartition();return 15===t[VY.ZERO.value]?yQ.ONE_WON:15===t[VY.ONE.value]?yQ.ZERO_WON:yQ.ONGOING}applyLegalMove(e,t,n){return m5.applyLegalMove(e,t,n)}isLegal(e,t){if(t.getPieceAt(e.landingCoord)!==VY.NONE)return OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.getCurrentOpponent();if(e.startingCoord.isPresent()){const r=e.startingCoord.get(),i=t.getPieceAt(r);if(i===n)return OG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(i===VY.NONE)return OG.failure(tQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(r.getHigherPieces().filter(n=>t.getPieceAt(n)!==VY.NONE||n.equals(e.landingCoord)).length>0)return OG.failure(g5.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return OG.failure(g5.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===m5.canCapture(t,e.landingCoord))return OG.failure(g5.CANNOT_CAPTURE());if(!m5.isValidCapture(t,e,e.firstCapture.get()))return OG.failure(g5.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!m5.isValidCapture(t,e,e.secondCapture.get()))return OG.failure(g5.INVALID_SECOND_CAPTURE())}return OG.success(void 0)}getGameStatus(e){return m5.getGameStatus(e)}}class y5 extends nQ{static getListMoves(e){const t=e.gameState,n=[],r=m5.getStateInfo(t),i=m5.getClimbingMoves(r),s=m5.getDropMoves(r),o=i.concat(s);for(const a of o){let e=[[]];m5.canCapture(t,a.landingCoord)&&(e=m5.getPossibleCaptures(r.freeToMove,a.startingCoord,a.landingCoord));for(const t of e){const e=f5.changeCapture(a,t);n.push(e)}}return n}getListMoves(e){return y5.getListMoves(e)}getBoardValue(e){const t=m5.getGameStatus(e);if(t.isEndGame)return new rQ(t.toBoardValue());{const t=e.gameState.getPiecesRepartition();return new rQ(t[VY.ZERO.value]-t[VY.ONE.value])}}}class v5 extends y5{static countStoneUsed(e){let t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}static sumMoveEmplacementByValue(e){let t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}getListMoves(e){const t=y5.getListMoves(e);return this.orderMoves(t)}orderMoves(e){return e.sort((e,t)=>{const n=12*v5.countStoneUsed(e),r=12*v5.countStoneUsed(t);return n+v5.sumMoveEmplacementByValue(e)-(r+v5.sumMoveEmplacementByValue(t))})}}const _5=VY.NONE,C5=VY.ZERO,E5=VY.ONE;class w5{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`At Pylos, the goal is to be the last to play.
        To do this, you have to save up your pieces.
        As soon as a player puts its last piece, that player loses the game immediately.
        Here is what the initial board looks like, it is a board of 4 x 4 squares.
        This board will become a pyramid, little by little.
        It will be filled by the pieces of your stock. Each player has 15 pieces.`,p5.getInitialState()),wQ.anyMove($localize`Dropping a piece`,$localize`When it is your turn, you can always drop one of your piece on an empty square.
        The gray squares are where you can drop your pieces.<br/><br/>
        Click on one of the squares to drop a piece there.`,p5.getInitialState(),f5.fromDrop(new d5(1,1,0),[]),$localize`There you go, as simple as that.`),wQ.fromMove($localize`Climbing`,$localize`When 4 pieces form a square, it is possible to put a fifth piece on top.
        However, when that happens, you can save a piece by climbing instead of dropping a piece.
        To climb:
        <ol>
            <li>Click on one of your free pieces, which should be lower than the landing square.</li>
            <li>Click on an empty landing square, higher than your selected piece.</li>
        </ol><br/>
        Go ahead, climb!`,new p5([[[C5,E5,_5,_5],[E5,C5,_5,_5],[_5,_5,_5,_5],[_5,_5,_5,C5]],[[_5,_5,_5],[_5,_5,_5],[_5,_5,_5]],[[_5,_5],[_5,_5]],[[_5]]],0),[f5.fromClimb(new d5(3,3,0),new d5(0,0,1),[])],$localize`Congratulations!<br/>
        Some important notes:
        <ol>
            <li>You cannot move a piece that is directly below another one.</li>
            <li>Of course, you cannot move the opponent's pieces.</li>
            <li>You can only climb when the landing square is higher than the starting square.</li>
        </ol>`,$localize`Failed!`),wQ.fromMove($localize`Square (1/2)`,$localize`When the piece you just moved or dropped is the fourth one of a square of your color,
        you can choose anywhere on the board one or two of your pieces.
        These pieces will be removed from the board, allowing you to save up one or two pieces.
        A chosen piece must not be directly below another piece.
        A chosen piece can be the piece you just placed.
        You're playing Dark.<br/><br/>
        Form a square, then click twice on one of the four pieces to remove only that one.`,new p5([[[C5,C5,_5,_5],[_5,C5,_5,_5],[_5,_5,_5,_5],[_5,_5,_5,_5]],[[_5,_5,_5],[_5,_5,_5],[_5,_5,_5]],[[_5,_5],[_5,_5]],[[_5]]],0),[f5.fromDrop(new d5(0,1,0),[new d5(0,0,0)]),f5.fromDrop(new d5(0,1,0),[new d5(0,1,0)]),f5.fromDrop(new d5(0,1,0),[new d5(1,0,0)]),f5.fromDrop(new d5(0,1,0),[new d5(1,1,0)])],$localize`Congratulations, you have saved up one piece.`,$localize`Failed!`),wQ.fromPredicate($localize`Square (2/2)`,$localize`You're playing Dark.<br/><br/>
        Do like in the previous step, but this time click on two different pieces.`,new p5([[[C5,C5,_5,_5],[_5,C5,_5,_5],[_5,_5,_5,_5],[_5,_5,_5,_5]],[[_5,_5,_5],[_5,_5,_5],[_5,_5,_5]],[[_5,_5],[_5,_5]],[[_5]]],0),f5.fromDrop(new d5(0,1,0),[new d5(0,0,0),new d5(1,0,0)]),(e,t)=>e.secondCapture.isPresent()?kG.SUCCESS:e.firstCapture.isPresent()?kG.failure($localize`Failed, you only captured one piece.`):kG.failure($localize`Failed, you did not capture any piece.`),$localize`Congratulations, you have saved up two pieces.`)]}}function b5(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"circle",4),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Oa("id","piece_",n,"_",e,""),ua("ngClass",r.getPlayerPieceClass(n)),ra("cx",.5*r.SPACE_SIZE+(800-r.SPACE_SIZE)/14*e)("cy",860+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function S5(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,b5,2,6,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",n.getPlayerSidePieces(e))}}function P5(e,t){if(1&e){const e=ya();Cn(),da(0,"circle",8),Ca("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onPieceClick(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();Ta("id","piece_",e,"_",t,"_",n,""),ua("ngClass",r.getPieceClasses(e,t,n)),ra("r",r.getPieceRadius(n)-r.STROKE_WIDTH)("cx",r.getPieceCx(e,t,n))("cy",r.getPieceCy(e,t,n))}}function O5(e,t){if(1&e){const e=ya();Cn(),da(0,"rect",8),Ca("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onDrop(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();Ta("id","drop_",e,"_",t,"_",n,""),ua("ngClass",r.getSquareClasses(e,t,n)),ra("width",2*r.getPieceRadius(n))("height",2*r.getPieceRadius(n))("x",r.getPieceCx(e,t,n)-r.getPieceRadius(n))("y",r.getPieceCy(e,t,n)-r.getPieceRadius(n))}}function T5(e,t){if(1&e&&(Cn(),ga(0),aa(1,P5,1,7,"circle",6),aa(2,O5,1,8,"ng-template",null,7,Du),ma()),2&e){const e=ca(3),t=ba().$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ua("ngIf",i.isOccupied(t,n,r))("ngIfElse",e)}}function I5(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,T5,4,2,"ng-container",5),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ua("ngIf",i.isDrawable(e,n,r))}}function k5(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,I5,2,1,"g",1),fa()),2&e){const e=ba().$implicit,t=ba();Ts(1),ua("ngForOf",t.getLevelRange(e))}}function A5(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,k5,2,1,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",n.getLevelRange(e))}}function N5(e,t){if(1&e&&(Cn(),pa(0,"rect",9)),2&e){const e=ba();Ta("id","highCapture_",e.highCapture.get().x,"_",e.highCapture.get().y,"_",e.highCapture.get().z,""),ra("width",2*e.getPieceRadius(e.highCapture.get().z))("height",2*e.getPieceRadius(e.highCapture.get().z))("x",e.getPieceCx(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))("y",e.getPieceCy(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))}}const M5=function(){return[0,1]},x5=function(){return[0,1,2]};let R5=(()=>{class e extends jJ{constructor(e){super(e),this.lastLandingCoord=vw.empty(),this.lastStartingCoord=vw.empty(),this.lastFirstCapture=vw.empty(),this.lastSecondCapture=vw.empty(),this.highCapture=vw.empty(),this.chosenStartingCoord=vw.empty(),this.chosenLandingCoord=vw.empty(),this.chosenFirstCapture=vw.empty(),this.lastMove=vw.empty(),this.remainingPieces={0:15,1:15},this.rules=new m5(p5),this.availableMinimaxes=[new y5(this.rules,"PylosMinimax"),new v5(this.rules,"PylosOrderedMinimax")],this.encoder=f5.encoder,this.tutorial=(new w5).tutorial,this.SPACE_SIZE=this.getPieceRadius(0),this.updateBoard()}getLevelRange(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return fw.expectToBe(e,2),[0,1]}}isDrawable(e,t,n){const r=new d5(e,t,n);return this.state.getPieceAt(r)!==VY.NONE||this.state.isLandable(r)}onPieceClick(e,t,n){var r=this;return dw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new d5(e,t,n);return r.state.getPieceAt(s)===r.state.getCurrentOpponent()?r.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=vw.of(s),kG.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=vw.of(s),kG.SUCCESS):r.chosenFirstCapture.equalsValue(s)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),s])})()}concludeMoveWithCapture(e){var t=this;return dw(function*(){let n;return n=t.chosenStartingCoord.isAbsent()?f5.fromDrop(t.chosenLandingCoord.get(),e):f5.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(n,t.state)})()}tryMove(e,t){var n=this;return dw(function*(){return n.cancelMove(),n.chooseMove(e,t)})()}cancelMoveAttempt(){this.chosenStartingCoord=vw.empty(),this.chosenLandingCoord=vw.empty(),this.chosenFirstCapture=vw.empty()}onDrop(e,t,n){var r=this;return dw(function*(){const i=r.canUserPlay("#drop_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new d5(e,t,n);return m5.canCapture(r.state,s)?(r.chosenLandingCoord=vw.of(s),kG.SUCCESS):r.isCapturelessMoveFinished(s)?(r.chosenLandingCoord=vw.of(s),r.concludeMoveWithCapture([])):r.cancelMove(g5.MUST_MOVE_UPWARD())})()}isCapturelessMoveFinished(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}getSquareClasses(e,t,n){const r=new d5(e,t,n);if(this.lastMove.isPresent()){const e=this.lastMove.get();if(e.firstCapture.equalsValue(r)||e.secondCapture.equalsValue(r))return["captured"];if(r.equals(e.landingCoord)||e.startingCoord.equalsValue(r))return["moved"]}return[]}getPieceRadius(e){return 90+5*e}getPieceCx(e,t,n){return 100+100*n+200*e}getPieceCy(e,t,n){return 100+100*n+200*t}isOccupied(e,t,n){const r=new d5(e,t,n),i=this.rules.node.gameState.getPieceAt(r)!==VY.NONE,s=this.chosenLandingCoord.equalsValue(r);return i||s}getPieceClasses(e,t,n){const r=new d5(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}getPieceFillClass(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}getPlayerPieceClass(e){return this.getPlayerClass(VY.of(e))}getPlayerSidePieces(e){const t=this.remainingPieces[e],n=[];for(let r=0;r<t;r++)n.push(r);return n}updateBoard(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;const e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=vw.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=vw.empty(),this.lastStartingCoord=vw.empty(),this.lastFirstCapture=vw.empty(),this.lastSecondCapture=vw.empty(),this.chosenFirstCapture=vw.empty(),this.chosenStartingCoord=vw.empty(),this.chosenLandingCoord=vw.empty())}showLastMove(){const e=this.lastMove.get();this.lastLandingCoord=vw.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}isDrawableCoord(e){return this.isDrawable(e.x,e.y,e.z)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-pylos"]],features:[Ho],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,S5,2,1,"g",1),pa(2,"rect",2),aa(3,A5,2,1,"g",1),aa(4,N5,1,7,"rect",3),fa()),2&e&&(Ts(1),ua("ngForOf",ou(3,M5)),Ts(2),ua("ngForOf",ou(4,x5)),Ts(1),ua("ngIf",t.highCapture.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class D5{constructor(e){this.value=e}static fromInt(e){if(0<=e&&e<=15)return D5.pieces[e];if(16===e)return D5.NONE;throw new Error("Invalid piece ("+e+")")}equals(e){return this===e}toString(){return"QuartoPiece("+this.value+")"}isRectangle(){return this.value%4<2}}D5.AAAA=new D5(0),D5.AAAB=new D5(1),D5.AABA=new D5(2),D5.AABB=new D5(3),D5.ABAA=new D5(4),D5.ABAB=new D5(5),D5.ABBA=new D5(6),D5.ABBB=new D5(7),D5.BAAA=new D5(8),D5.BAAB=new D5(9),D5.BABA=new D5(10),D5.BABB=new D5(11),D5.BBAA=new D5(12),D5.BBAB=new D5(13),D5.BBBA=new D5(14),D5.BBBB=new D5(15),D5.NONE=new D5(16),D5.pieces=[D5.AAAA,D5.AAAB,D5.AABA,D5.AABB,D5.ABAA,D5.ABAB,D5.ABBA,D5.ABBB,D5.BAAA,D5.BAAB,D5.BABA,D5.BABB,D5.BBAA,D5.BBAB,D5.BBBA,D5.BBBB];class L5 extends uQ{constructor(e,t,n){super(e,t),this.piece=n}toString(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}equals(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}L5.encoder=new class extends BY{maxValue(){return 496}encodeNumber(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}decodeNumber(e){const t=e%32;e-=t;const n=(e/=32)%4;return e-=n,new L5(e/=4,n,D5.fromInt(t))}};class F5 extends aQ{constructor(e,t,n){super(e,t),this.pieceInHand=n}static getInitialState(){const e=LG.createTable(4,4,D5.NONE);return new F5(e,0,D5.AAAA)}static isGivable(e,t,n){return e!==n&&!1===F5.isAlreadyOnBoard(e,t)}static isAlreadyOnBoard(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}getRemainingPieces(){const e=D5.pieces,t=[];for(const n of e)F5.isGivable(n,this.board,this.pieceInHand)&&t.push(n);return t}}let B5=(()=>{class e{}return e.MUST_GIVE_A_PIECE=()=>$localize`You must give a piece.`,e.PIECE_ALREADY_ON_BOARD=()=>$localize`That piece is already on the board.`,e.CANNOT_GIVE_PIECE_IN_HAND=()=>$localize`You cannot give the piece that was in your hands.`,e})();class V5{constructor(e){this.subCriterion=[vw.empty(),vw.empty(),vw.empty(),vw.empty()],this.subCriterion[0]=vw.of(8==(8&e.value)),this.subCriterion[1]=vw.of(4==(4&e.value)),this.subCriterion[2]=vw.of(2==(2&e.value)),this.subCriterion[3]=vw.of(1==(1&e.value))}mergeWith(e){let t=4;for(let n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=vw.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}mergeWithQuartoPiece(e){const t=new V5(e);return this.mergeWith(t)}areAllAbsent(){for(let e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}match(e){for(let t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}matchPiece(e){return this.match(new V5(e))}toString(){return"Criterion{"+this.subCriterion.map(e=>e.isPresent()?e.get()?"1":"0":"x").join(" ")+"}"}}class U5{constructor(e,t){this.initialCoord=e,this.direction=t}allCoords(){const e=[];for(let t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}class $5 extends vQ{static isOccupied(e){return e!==D5.NONE}static isLegal(e,t){const n=e.coord.x,r=e.coord.y,i=e.piece,s=t.getCopiedBoard(),o=t.pieceInHand;return $5.isOccupied(s[r][n])?kG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE()):i===D5.NONE?15===t.turn?kG.SUCCESS:kG.failure(B5.MUST_GIVE_A_PIECE()):F5.isAlreadyOnBoard(i,s)?kG.failure(B5.PIECE_ALREADY_ON_BOARD()):o===i?kG.failure(B5.CANNOT_GIVE_PIECE_IN_HAND()):kG.SUCCESS}isLegal(e,t){return $5.isLegal(e,t).toFallible(void 0)}applyLegalMove(e,t){const n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new F5(n,t.turn+1,e.piece)}static updateBoardStatus(e,t,n){return n.score===dQ.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:dQ.VICTORY,sensitiveSquares:new kX}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}static isThereAVictoriousLine(e,t){let n=e.initialCoord,r=t.getPieceAt(n);const i=new V5(r);for(let s=0;s<3&&!1!==$5.isOccupied(r)&&!i.areAllAbsent();s++)n=n.getNext(e.direction,1),r=t.getPieceAt(n),i.mergeWithQuartoPiece(r);return!(!$5.isOccupied(r)||i.areAllAbsent())}static searchForVictoryOrPreVictoryInLine(e,t,n){const r=$5.getLineInfos(e,t,n);if(r.boardStatus.isPresent())return r.boardStatus.get();const i=r.commonCriterion,s=r.sensitiveCoord;if(i.isPresent()&&!1===i.get().areAllAbsent()){if(s.isAbsent())return{score:dQ.VICTORY,sensitiveSquares:new kX};{i.get().matchPiece(t.pieceInHand)&&(n.score=dQ.PRE_VICTORY);const e=s.get();n.sensitiveSquares.add(e)}}return n}static getLineInfos(e,t,n){let r=vw.empty(),i=vw.empty(),s=e.initialCoord;for(let o=0;o<4;o++){const o=t.getPieceAt(s);if(o===D5.NONE){if(!r.isAbsent())return{sensitiveCoord:vw.of(s),commonCriterion:i,boardStatus:vw.of(n)};r=vw.of(s)}else i.isAbsent()?(i=vw.of(new V5(o)),pw($5.VERBOSE,"set commonCrit to "+i.toString())):(i.get().mergeWithQuartoPiece(o),pw($5.VERBOSE,"update commonCrit: "+i.toString()));s=s.getNext(e.direction,1)}return{commonCriterion:i,sensitiveCoord:r,boardStatus:vw.empty()}}static scoreToGameStatus(e,t){const n=VY.of(t%2);return e===dQ.VICTORY?yQ.getDefeat(n):16===t?yQ.DRAW:yQ.ONGOING}getGameStatus(e){const t=e.gameState;let n={score:dQ.DEFAULT,sensitiveSquares:new kX};for(const r of $5.lines)if(n=$5.updateBoardStatus(r,t,n),n.score===dQ.VICTORY)return $5.scoreToGameStatus(n.score,t.turn);return $5.scoreToGameStatus(n.score,t.turn)}getVictoriousCoords(e){for(const t of $5.lines)if($5.isThereAVictoriousLine(t,e))return t.allCoords();return[]}}$5.VERBOSE=!1,$5.lines=[new U5(new GJ(0,0),zJ.DOWN),new U5(new GJ(1,0),zJ.DOWN),new U5(new GJ(2,0),zJ.DOWN),new U5(new GJ(3,0),zJ.DOWN),new U5(new GJ(0,0),zJ.RIGHT),new U5(new GJ(0,1),zJ.RIGHT),new U5(new GJ(0,2),zJ.RIGHT),new U5(new GJ(0,3),zJ.RIGHT),new U5(new GJ(0,0),zJ.DOWN_RIGHT),new U5(new GJ(0,3),zJ.UP_RIGHT)];class z5 extends nQ{static scoreToBoardValue(e,t){if(e===dQ.DEFAULT)return new rQ(0);{const n=VY.of(t%2);return new rQ(e===dQ.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),s=n.pieceInHand;let o;for(let a=0;a<4;a++)for(let e=0;e<4;e++)if(r[a][e]===D5.NONE){if(o=n.getCopiedBoard(),o[a][e]=s,15===n.turn){const n=new L5(e,a,D5.NONE);return t.push(n),t}for(const n of i){const r=new L5(e,a,n);t.push(r)}}return t}getBoardValue(e){const t=e.gameState;let n={score:dQ.DEFAULT,sensitiveSquares:new kX};for(const r of $5.lines)if(n=$5.updateBoardStatus(r,t,n),n.score===dQ.VICTORY)break;return z5.scoreToBoardValue(n.score,t.turn)}}const H5=D5.AABA,G5=D5.AABB,q5=D5.ABAA,W5=D5.ABAB,j5=D5.ABBA,Z5=D5.BAAA,Y5=D5.BAAB,K5=D5.BABB,J5=D5.BBAA,Q5=D5.BBAB,X5=D5.BBBA,e6=D5.BBBB,t6=D5.NONE;class n6{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`Quarto is an alignment game.
        The goal is to align four pieces that have at least one common aspect:
        <ul>
          <li>their color (light or dark),</li>
          <li>their size (big or small),</li>
          <li>their pattern (empty or dotted),</li>
          <li>their shape (round or square).</li>
        </ul>
        Here, we have a board with a victory by an alignment of dark pieces.`,new F5([[X5,J5,q5,H5],[t6,t6,t6,t6],[t6,t6,t6,t6],[t6,t6,t6,t6]],7,D5.ABAB)),wQ.anyMove($localize`Placement`,$localize`Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,
        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.
        If you prefer, the order of these two steps can be reversed.
        Keep in mind that the second click confirms the move.<br/><br/>
        Make a move.`,new F5([[X5,G5,j5,t6],[t6,t6,t6,t6],[t6,Z5,t6,t6],[t6,t6,t6,t6]],7,D5.ABAA),new L5(2,2,D5.BAAB),$localize`Perfect!`),wQ.fromMove($localize`Situation`,$localize`We have here a tricky situation.<br/><br/>
        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move.`,new F5([[e6,X5,Q5,t6],[q5,K5,J5,t6],[W5,Z5,Y5,t6],[t6,t6,t6,t6]],7,D5.AABA),[new L5(3,3,D5.AABB)],$localize`Well done!`,$localize`Failed!`)]}}function r6(e,t){if(1&e&&(Cn(),pa(0,"rect",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ua("ngClass",i.getPieceClasses(t.value)),ra("x",i.SPACE_SIZE*n+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("y",i.SPACE_SIZE*r+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("width",2*i.getPieceSize(t.value))("height",2*i.getPieceSize(t.value))}}function i6(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ua("ngClass",i.getPieceClasses(t.value)),ra("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(t.value))}}function s6(e,t){if(1&e&&(Cn(),pa(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function o6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,r6,1,5,"rect",9),aa(2,i6,1,4,"ng-template",null,10,Du),aa(4,s6,1,3,"circle",3),fa()),2&e){const e=ca(3),t=ba().$implicit,n=ba(2);Ts(1),ua("ngIf",t.isRectangle())("ngIfElse",e),Ts(3),ua("ngIf",n.pieceHasDot(t.value))}}function a6(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",8),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().chooseCoord(t,n)}),fa(),aa(2,o6,5,3,"g",3),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","chooseCoord_",n,"_",r,""),ua("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngIf",e!==i.EMPTY)}}function c6(e,t){if(1&e&&(Cn(),da(0,"g",null,7),aa(2,a6,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(2),ua("ngForOf",e)}}function l6(e,t){if(1&e&&(Cn(),pa(0,"rect",15)),2&e){const e=ba(2);ua("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("y",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function u6(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba(2);ua("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",e.getPieceSize(e.pieceInHand.value))}}function h6(e,t){if(1&e&&(Cn(),pa(0,"circle")),2&e){const e=ba(2);ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",10)}}function d6(e,t){if(1&e&&(Cn(),da(0,"g",null,12),pa(2,"rect",13),aa(3,l6,1,5,"rect",14),aa(4,u6,1,4,"ng-template",null,10,Du),aa(6,h6,1,3,"circle",3),fa()),2&e){const e=ca(5),t=ba();ra("transform","translate("+t.chosen.get().x*t.SPACE_SIZE+" "+t.chosen.get().y*t.SPACE_SIZE+")"),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ua("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ua("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function f6(e,t){if(1&e&&(Cn(),da(0,"g",null,16),pa(2,"rect",17),fa()),2&e){const e=t.$implicit,n=ba();Ts(2),ra("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)("transform","translate("+e.x*n.SPACE_SIZE+" "+e.y*n.SPACE_SIZE+")")}}function p6(e,t){if(1&e&&(Cn(),pa(0,"rect",11)),2&e){const e=ba(2);ua("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",0)("y",.75*e.SPACE_SIZE)("transform","translate("+-e.getPieceSize(e.pieceInHand.value)+", "+-e.getPieceSize(e.pieceInHand.value)+")")("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function g6(e,t){if(1&e&&(Cn(),pa(0,"circle",19)),2&e){const e=ba(2);ua("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cy",.75*e.SPACE_SIZE)("r",e.getPieceSize(e.pieceInHand.value))}}function m6(e,t){1&e&&(Cn(),pa(0,"circle",20)),2&e&&ra("cy",.75*ba(2).SPACE_SIZE)("r",10)}function y6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,p6,1,6,"rect",9),aa(2,g6,1,3,"ng-template",null,10,Du),aa(4,m6,1,2,"circle",18),fa()),2&e){const e=ca(3),t=ba();Ts(1),ua("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ua("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function v6(e,t){if(1&e&&(Cn(),pa(0,"rect",27)),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("x",n.SPACE_SIZE*e)("y",n.SPACE_SIZE*t)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function _6(e,t){if(1&e&&(Cn(),pa(0,"rect",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ua("ngClass",n.getPieceClasses(4*t+e)),ra("x",n.SPACE_SIZE*e+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("y",n.SPACE_SIZE*t+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("width",2*n.getPieceSize(4*t+e))("height",2*n.getPieceSize(4*t+e))}}function C6(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ua("ngClass",n.getPieceClasses(4*t+e)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.getPieceSize(4*t+e))}}function E6(e,t){if(1&e&&(Cn(),pa(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function w6(e,t){if(1&e){const e=ya();Cn(),da(0,"g",25),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().choosePiece(4*n+t)}),aa(1,v6,1,4,"rect",26),aa(2,_6,1,5,"rect",9),aa(3,C6,1,4,"ng-template",null,10,Du),aa(5,E6,1,3,"circle",3),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Pa("id","choosePiece_",4*n+t,""),Ts(1),ua("ngIf",r.pieceToGive.value===4*n+t),Ts(1),ua("ngIf",(4*n+t)%4<2)("ngIfElse",e),Ts(3),ua("ngIf",r.pieceHasDot(4*n+t))}}function b6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,w6,6,5,"g",24),fa()),2&e){const e=t.index,n=ba().index,r=ba();Ts(1),ua("ngIf",r.isRemaining(4*n+e))}}function S6(e,t){if(1&e&&(Cn(),da(0,"g",null,21),pa(2,"rect",22,23),aa(4,b6,2,1,"g",2),fa()),2&e){const e=t.$implicit,n=ba();ra("transform","translate(0 "+6.5*n.SPACE_SIZE+")"),Ts(2),ra("x",-.125*n.SPACE_SIZE)("y",-.125*n.SPACE_SIZE)("width",4.25*n.SPACE_SIZE)("height",4.25*n.SPACE_SIZE),Ts(2),ua("ngForOf",e)}}let P6=(()=>{class e extends rX{constructor(e){super(e),this.EMPTY=D5.NONE,this.chosen=vw.empty(),this.lastMove=vw.empty(),this.pieceInHand=D5.NONE,this.pieceToGive=D5.NONE,this.victoriousCoords=[],this.rules=new $5(F5),this.availableMinimaxes=[new z5(this.rules,"QuartoMinimax")],this.encoder=L5.encoder,this.tutorial=(new n6).tutorial,this.pieceInHand=this.rules.node.gameState.pieceInHand,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=vw.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(e=>e.coord)}chooseCoord(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#chooseCoord_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.hideLastMove(),n.board[t][e]===D5.NONE){if(n.showPieceInHandOnBoard(e,t),15===n.rules.node.gameState.turn){const r=new L5(e,t,D5.NONE);return n.chooseMove(r,n.rules.node.gameState)}if(n.pieceToGive===D5.NONE)return kG.SUCCESS;{const r=new L5(e,t,n.pieceToGive);return n.chooseMove(r,n.rules.node.gameState)}}return n.cancelMove(tQ.MUST_CLICK_ON_EMPTY_SPACE())})()}choosePiece(e){var t=this;return dw(function*(){const n=t.canUserPlay("#choosePiece_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.hideLastMove(),t.pieceToGive=D5.fromInt(e),t.chosen.isAbsent())return kG.SUCCESS;{const e=t.chosen.get(),n=new L5(e.x,e.y,t.pieceToGive);return t.chooseMove(n,t.rules.node.gameState)}})()}hideLastMove(){this.lastMove=vw.empty()}cancelMoveAttempt(){this.hideLastMove(),this.pieceToGive=D5.NONE}showPieceInHandOnBoard(e,t){this.chosen=vw.of(new GJ(e,t))}isRemaining(e){return F5.isGivable(D5.fromInt(e),this.board,this.pieceInHand)}getSquareClasses(e,t){const n=new GJ(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}getPieceClasses(e){const t=[];return t.push(e%2==0?"player0":"player1"),t}getPieceSize(e){return e<8?40:25}pieceHasDot(e){return e!==D5.NONE.value&&e%8<4}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-quarto"]],features:[Ho],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"g",1),aa(2,c6,3,1,"g",2),aa(3,d6,7,6,"g",3),aa(4,f6,3,3,"g",2),da(5,"g",null,4),pa(7,"rect",5,6),aa(9,y6,5,3,"g",3),fa(),aa(10,S6,5,6,"g",2),fa(),fa()),2&e&&(ra("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),Ts(2),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.chosen.isPresent()),Ts(1),ua("ngForOf",t.victoriousCoords),Ts(1),ra("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),Ts(2),ra("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),Ts(2),ua("ngIf",t.chosen.isAbsent()),Ts(1),ua("ngForOf",t.board))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),O6=(()=>{class e{}return e.NO_INSIDE_CLICK=()=>$localize`You must pick a space from the edge of the board.`,e})();class T6 extends uQ{constructor(e,t,n){super(e,t),this.direction=n;const r=T6.isValidCoord(this.coord);if(r.isFailure())throw new Error(r.getReason());if(0===e&&n===HJ.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&n===HJ.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===t&&n===HJ.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===t&&n===HJ.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.")}static isValidCoord(e){return e.isNotInRange(5,5)?kG.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?kG.failure(O6.NO_INSIDE_CLICK()):kG.SUCCESS}toString(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}T6.encoder=new class extends BY{maxValue(){return 128}encodeNumber(e){const t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}decodeNumber(e){const t=HJ.factory.fromInt(e%4).get();e-=e%4;const n=(e/=4)%5;return e-=e%5,new T6(e/=5,n,t)}};class I6 extends aQ{static getInitialState(){const e=LG.createTable(5,5,VY.NONE);return new I6(e,0)}applyLegalMove(e){const t=this.getCopiedBoard(),n=this.turn+1;let r=e.coord,i=e.coord.getNext(e.direction);for(;i.isInRange(5,5);)t[r.y][r.x]=t[i.y][i.x],r=r.getNext(e.direction),i=i.getNext(e.direction);return t[r.y][r.x]=this.getCurrentPlayer(),new I6(t,n)}}class k6 extends vQ{static getVerticalCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new GJ(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new GJ(4,r));return n}static getHorizontalCenterCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new GJ(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new GJ(r,4));return n}static getPossibleDirections(e){const t=[];return 0!==e.x&&t.push(HJ.LEFT),0!==e.y&&t.push(HJ.UP),4!==e.x&&t.push(HJ.RIGHT),4!==e.y&&t.push(HJ.DOWN),t}static getLinesSums(e){const t={};t[VY.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[VY.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(let n=0;n<5;n++)for(let r=0;r<5;r++){const i=e.getPieceAtXY(r,n).value;i!==VY.NONE.value&&(t[i].columns[r]=t[i].columns[r]+1,t[i].rows[n]=t[i].rows[n]+1,r===n&&(t[i].diagonals[0]=t[i].diagonals[0]+1),r+n===4&&(t[i].diagonals[1]=t[i].diagonals[1]+1))}return t}static getVictoriousCoords(e){const t=k6.getLinesSums(e),n=[];for(let r=0;r<2;r++){for(let e=0;e<5;e++){if(5===t[r].columns[e])for(let t=0;t<5;t++)n.push(new GJ(e,t));if(5===t[r].rows[e])for(let t=0;t<5;t++)n.push(new GJ(t,e))}if(5===t[r].diagonals[0])for(let e=0;e<5;e++)n.push(new GJ(e,e));if(5===t[r].diagonals[1])for(let e=0;e<5;e++)n.push(new GJ(e,4-e))}return n}static getFullestLine(e){const t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max(...t)}applyLegalMove(e,t,n){return k6.applyLegalMove(e,t,n)}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?OG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):OG.success(void 0)}getGameStatus(e){const t=e.gameState,n=k6.getLinesSums(t),r=k6.getFullestLine(n[VY.ZERO.value]),i=k6.getFullestLine(n[VY.ONE.value]),s=t.getCurrentPlayer();return 5===r&&(s===VY.ZERO||i<5)?yQ.ZERO_WON:5===i?yQ.ONE_WON:yQ.ONGOING}}class A6 extends nQ{getListMoves(e){const t=[],n=k6.getVerticalCoords(e),r=k6.getHorizontalCenterCoords(e).concat(n);for(const i of r){const e=k6.getPossibleDirections(i);for(const n of e){const e=new T6(i.x,i.y,n);t.push(e)}}return t}getBoardValue(e){const t=e.gameState,n=k6.getLinesSums(t),r=k6.getFullestLine(n[VY.ZERO.value]),i=k6.getFullestLine(n[VY.ONE.value]),s=t.getCurrentPlayer();return new rQ(5===r&&(s===VY.ZERO||i<5)?VY.ZERO.getVictoryValue():5===i?VY.ONE.getVictoryValue():i-r)}}class N6{static getArrowTransform(e,t,n){let r,i,s;switch(n){case HJ.UP:r=0,i=-1,s=-90;break;case HJ.DOWN:r=0,i=1,s=90;break;case HJ.LEFT:r=-1,i=0,s=180;break;default:fw.expectToBe(n,HJ.RIGHT),r=1,i=0,s=0}return[`translate(${t.x*e+e/2+r*e/4} ${t.y*e+e/2+i*e/4})`,"scale(2.5)",`rotate(${s})`].join(" ")}}const M6=VY.NONE,x6=VY.ZERO,R6=VY.ONE;class D6{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game.`,$localize`At Quixo, the goal is to align 5 of your pieces.
        The first player plays with dark pieces, the second with light pieces.
        The board is made of 25 spaces spread over a 5x5 square.
        Every piece has a neutral side, a light side, and a dark side.`,I6.getInitialState()),wQ.fromMove($localize`What a move looks like (without animation)`,$localize`When it is your turn:
        <ol>
            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.
                You can only choose a piece from the edge of the board.</li>
            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>
        </ol>
        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.
        Once on the other side, all pieces will move by one space in the opposing direction.
        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>
        For example, take the bottom right neutral piece, and move it to the left (you're playing Light).`,new I6([[M6,M6,M6,M6,M6],[M6,M6,M6,M6,M6],[M6,M6,M6,M6,M6],[M6,M6,M6,M6,M6],[x6,x6,x6,x6,M6]],1),[new T6(4,4,HJ.LEFT)],$localize`See how the four dark pieces have been moved one space to the right.
        The neutral piece has been move 4 pieces to the left and has become light.`,$localize`Failed!`),wQ.fromMove($localize`Victory`,$localize`You already know everything you need in order to play, but there is one last particularity.
        If you create a line of 5 of your pieces, you win.
        If you create a line of 5 of your opponent's pieces, you lose.
        If you create both, you lose too!<br/><br/>
        You can win with this board, try it.
        You're playing Light.`,new I6([[M6,R6,M6,R6,R6],[M6,x6,x6,M6,x6],[R6,R6,R6,x6,R6],[x6,M6,x6,R6,R6],[R6,x6,M6,R6,x6]],31),[new T6(3,0,HJ.DOWN)],$localize`Congratulations, you won!`,$localize`Failed!`)]}}function L6(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",4),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Oa("id","click_",e,"_",n,""),ua("ngClass",r.getPieceClasses(e,n)),ra("cx",50+100*e)("cy",50+100*n)}}function F6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,L6,2,5,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function B6(e,t){if(1&e){const e=ya();Cn(),da(0,"use",6),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2);Pa("id","chooseDirection_",e,""),ra("transform",n.getArrowTransform(n.chosenCoord.get(),e))}}function V6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,B6,1,2,"use",5),fa()),2&e){const e=ba();Ts(1),ua("ngForOf",e.getPossiblesDirections())}}let U6=(()=>{class e extends rX{constructor(e){super(e),this.lastMoveCoord=vw.empty(),this.chosenCoord=vw.empty(),this.victoriousCoords=[],this.rules=new k6(I6),this.availableMinimaxes=[new A6(this.rules,"QuixoMinimax")],this.encoder=T6.encoder,this.tutorial=(new D6).tutorial,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(e=>e.coord),this.victoriousCoords=k6.getVictoriousCoords(this.state)}cancelMoveAttempt(){this.chosenCoord=vw.empty()}getPieceClasses(e,t){const n=new GJ(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(e=>e.equals(n))&&r.push("victory-stroke"),r}onBoardClick(e,t){const n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=new GJ(e,t),i=T6.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=vw.of(r),kG.SUCCESS)}getPossiblesDirections(){const e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}chooseDirection(e){var t=this;return dw(function*(){const n=t.canUserPlay("#chooseDirection_"+e);return n.isFailure()?t.cancelMove(n.getReason()):(t.chosenDirection=HJ.factory.fromString(e).get(),yield t.tryMove())})()}tryMove(){var e=this;return dw(function*(){const t=e.chosenCoord.get(),n=new T6(t.x,t.y,e.chosenDirection);return e.cancelMove(),e.chooseMove(n,e.rules.node.gameState)})()}getArrowTransform(e,t){return N6.getArrowTransform(this.SPACE_SIZE,e,HJ.factory.fromString(t).get())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-quixo"]],features:[Ho],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"defs"),pa(2,"polygon",1),fa(),aa(3,F6,2,1,"g",2),aa(4,V6,2,1,"g",3),fa()),2&e&&(Ts(3),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.chosenCoord.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),$6=(()=>{class e extends aQ{static getInitialState(){const t=LG.createTable(e.BOARD_WIDTH,e.BOARD_HEIGHT,VY.NONE);return t[3][3]=VY.ZERO,t[4][4]=VY.ZERO,t[3][4]=VY.ONE,t[4][3]=VY.ONE,new e(t,0)}static getNeighbooringPawnLike(e,t,n,r){let i;const s=[];for(let o=-1;o<2;o++)for(let a=-1;a<2;a++)i=new GJ(n+a,r+o),i.isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&s.push(i);return s}countScore(){const t=[0,0];for(let n=0;n<e.BOARD_HEIGHT;n++)for(let r=0;r<e.BOARD_WIDTH;r++){const e=this.board[n][r];e!==VY.NONE&&(t[e.value]+=1)}return t}}return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e})();class z6 extends uQ{equals(e){return e===this||e.coord.equals(this.coord)}toString(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}z6.encoder=new class extends BY{maxValue(){return($6.BOARD_HEIGHT-1)*$6.BOARD_WIDTH+($6.BOARD_WIDTH-1)}encodeNumber(e){return e.coord.y*$6.BOARD_WIDTH+e.coord.x}decodeNumber(e){const t=e%$6.BOARD_WIDTH;return new z6(t,(e-t)/$6.BOARD_WIDTH)}},z6.PASS=new z6(-1,-1),z6.PASS_NUMBER=z6.encoder.encodeNumber(z6.PASS);let H6=(()=>{class e{}return e.NO_ELEMENT_SWITCHED=()=>$localize`Your move should switch at least one piece.`,e})();class G6{constructor(e,t){this.move=e,this.switched=t}}let q6=(()=>{class e extends vQ{static getGameStatus(t){const n=t.gameState;if(!1===e.isGameEnded(n))return yQ.ONGOING;const r=n.countScore(),i=r[1]-r[0];return i<0?yQ.ZERO_WON:i>0?yQ.ONE_WON:yQ.DRAW}applyLegalMove(e,t,n){const r=t.turn,i=t.getCurrentPlayer(),s=t.getCopiedBoard();if(e.equals(z6.PASS))return new $6(s,r+1);for(const o of n)s[o.y][o.x]=i;return s[e.coord.y][e.coord.x]=i,new $6(s,r+1)}static getAllSwitcheds(t,n,r){const i=[],s=n.getOpponent();for(const o of zJ.DIRECTIONS){const a=t.coord.getNext(o);if(a.isInRange($6.BOARD_WIDTH,$6.BOARD_HEIGHT)&&r[a.y][a.x]===s){const t=e.getSandwicheds(n,o,a,r);for(const e of t)i.push(e)}}return i}static getSandwicheds(e,t,n,r){const i=[n];let s=n.getNext(t);for(;s.isInRange($6.BOARD_WIDTH,$6.BOARD_HEIGHT);){const n=r[s.y][s.x];if(n===e)return i;if(n===VY.NONE)return[];i.push(s),s=s.getNext(t)}return[]}static isGameEnded(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}getGameStatus(t){return e.getGameStatus(t)}static playerCanOnlyPass(e){const t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(z6.PASS)}static nextPlayerCantOnlyPass(e){const t=e.getCopiedBoard(),n=new $6(t,e.turn+1);return this.playerCanOnlyPass(n)}static getListMoves(t){const n=[];let r;const i=t.getCurrentPlayer(),s=t.getCurrentOpponent();for(let o=0;o<8;o++)for(let a=0;a<8;a++)if(t.getPieceAtXY(a,o)===VY.NONE&&(r=t.getCopiedBoard(),$6.getNeighbooringPawnLike(r,s,a,o).length>0)){const s=new z6(a,o),c=e.getAllSwitcheds(s,i,r);if(c.length>0){for(const e of c)MG(i!==t.getPieceAt(e),e+"was already switched!"),r[e.y][e.x]=i;r[o][a]=i,n.push(new G6(s,c.length))}}return 0===n.length&&n.push(new G6(z6.PASS,0)),n}isLegal(t,n){const r=n.getCopiedBoard();if(t.equals(z6.PASS))return e.playerCanOnlyPass(n)?OG.success([]):OG.failure(tQ.MUST_PASS());if(r[t.coord.y][t.coord.x]!==VY.NONE)return pw(e.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),OG.failure(tQ.MUST_CLICK_ON_EMPTY_SPACE());const i=e.getAllSwitcheds(t,n.getCurrentPlayer(),r);return pw(e.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?OG.failure(H6.NO_ELEMENT_SWITCHED()):OG.success(i)}}return e.VERBOSE=!1,e})();class W6 extends nQ{getBoardValue(e){const t=q6.getGameStatus(e);if(t.isEndGame)return rQ.fromWinner(t.winner);const n=e.gameState.getCopiedBoard();let r=0,i=0;for(let s=0;s<$6.BOARD_HEIGHT;s++)for(let e=0;e<$6.BOARD_WIDTH;e++){const t=(0===e||e===$6.BOARD_WIDTH-1?4:1)*(0===s||s===$6.BOARD_HEIGHT-1?4:1);n[s][e]===VY.ZERO&&(r+=t),n[s][e]===VY.ONE&&(i+=t)}return r*=VY.ZERO.getScoreModifier(),i*=VY.ONE.getScoreModifier(),new rQ(i+r)}getListMoves(e){const t=q6.getListMoves(e.gameState);return LG.sortByDescending(t,e=>W6.bestCoords.some(t=>e.move.coord.equals(t))?100:e.switched),t.map(e=>e.move)}}W6.bestCoords=[new GJ(0,0),new GJ(0,$6.BOARD_HEIGHT-1),new GJ($6.BOARD_WIDTH-1,0),new GJ($6.BOARD_WIDTH-1,$6.BOARD_HEIGHT-1)];const j6=VY.NONE,Z6=VY.ZERO,Y6=VY.ONE;class K6{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.
        When one piece is flipped, its owner changes.
        The player owning the most pieces at the end of the game wins.
        Here, Dark has 28 points and Light has 36, hence Light wins.`,new $6([[Z6,Z6,Z6,Z6,Z6,Z6,Z6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Z6,Z6,Z6,Z6,Z6,Z6,Z6]],60)),wQ.anyMove($localize`Capture (1/2)`,$localize`At the beginning of the game, pieces are placed as shown here.
        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>
        Do any move by clicking to put your piece
        Dark plays first.`,$6.getInitialState(),new z6(2,4),$localize`Congratulations!`),wQ.fromMove($localize`Capture (2/2)`,$localize`A move can also capture a bigger line, and more than one lines at a time
        You're playing light here.<br/><br/>
        Play on the bottom left to see an example.`,new $6([[j6,j6,j6,j6,j6,j6,j6,j6],[j6,j6,j6,j6,j6,j6,j6,j6],[j6,j6,j6,j6,j6,j6,j6,j6],[j6,j6,j6,j6,Y6,j6,j6,j6],[j6,j6,j6,Z6,j6,j6,j6,j6],[j6,j6,Z6,j6,j6,j6,j6,j6],[Z6,Z6,j6,j6,j6,j6,j6,j6],[j6,Z6,Y6,Z6,Y6,Z6,j6,j6]],1),[new z6(0,7)],$localize`Congratulations!`,$localize`Lower and more to the left, please.`),wQ.informational($localize`Passing a turn`,$localize`If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass
        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way.`,new $6([[Y6,Z6,Z6,Z6,Z6,Z6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Z6,Y6,Y6,Y6,Y6,Y6,Y6,Z6],[Y6,Y6,Y6,Y6,Y6,Y6,j6,j6],[Z6,Z6,Z6,Z6,Z6,Z6,j6,j6]],60))]}}function J6(e,t){if(1&e&&(Cn(),pa(0,"circle",4)),2&e){const e=ba().index,t=ba().index,n=ba();ua("ngClass",n.getPieceClass(e,t)),ra("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)}}function Q6(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",2),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,J6,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Oa("id","click_",e,"_",n,""),ua("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ua("ngIf",r.board[n][e]!==r.NONE)}}function X6(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,Q6,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let e8=(()=>{class e extends rX{constructor(e){super(e),this.NONE=VY.NONE,this.lastMove=new GJ(-2,-2),this.captureds=[],this.scores=vw.of([2,2]),this.rules=new q6($6),this.availableMinimaxes=[new W6(this.rules,"ReversiMinimax")],this.encoder=z6.encoder,this.tutorial=(new K6).tutorial,this.canPass=!1,this.updateBoard()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new z6(e,t);return yield n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new GJ(-2,-2),this.scores=vw.of(e.countScore()),this.canPass=q6.playerCanOnlyPass(e)}showPreviousMove(){this.lastMove=this.rules.node.move.get().coord;const e=this.rules.node.gameState.getCurrentPlayer(),t=this.rules.node.gameState.getCurrentOpponent();for(const n of zJ.DIRECTIONS){let r=this.lastMove.getNext(n,1);for(;r.isInRange($6.BOARD_WIDTH,$6.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(r)===t&&this.rules.node.mother.get().gameState.getPieceAt(r)===e;)this.captureds.push(r),r=r.getNext(n,1)}}getRectClasses(e,t){const n=new GJ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:n.equals(this.lastMove)?["moved"]:[]}getPieceClass(e,t){return this.getPlayerClass(this.board[t][e])}pass(){var e=this;return dw(function*(){return MG(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(z6.PASS.coord.x,z6.PASS.coord.y)})()}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-reversi"]],features:[Ho],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,X6,2,1,"g",1),fa()),2&e&&(ra("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),Ts(1),ua("ngForOf",t.board))},directives:[Ud,Bd,zd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),t8=(()=>{class e extends t1{static getInitialState(){const t=YJ.NONE,n=YJ.ZERO,r=YJ.ONE,i=YJ.EMPTY;return new e([[t,t,n,r,i,i,i,n,r,t,t],[t,i,i,i,i,i,i,i,i,i,t],[r,i,i,i,i,i,i,i,i,i,n],[n,i,i,i,i,i,i,i,i,i,r],[t,i,i,i,i,i,i,i,i,i,t],[t,t,r,n,i,i,i,r,n,t,t]],0)}}return e.HEIGHT=6,e.WIDTH=11,e})(),n8=(()=>{class e{}return e.CAN_ONLY_REBOUND_ON_BLACK=()=>$localize`You can only rebound on dark spaces.`,e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=()=>$localize`You can only rebound on empty spaces.`,e.MUST_CHOOSE_PYRAMID_FIRST=()=>$localize`You must pick one of your pyramids first.`,e.MUST_CHOOSE_OWN_PYRAMID=()=>$localize`You must pick one of your pyramids.`,e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=()=>$localize`Those two spaces are not neighbors.`,e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=()=>$localize`Those two spaces have no intermediary neighbor.`,e})();class r8 extends fX{constructor(e,t){super(e,t)}static checkDistanceAndLocation(e,t){const n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return kG.failure(tQ.MOVE_CANNOT_BE_STATIC());if(1===n){const n=e1.getFakeNeighbors(e);if(t.equals(n))return kG.failure(n8.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return kG.failure($localize`You can move one or two spaces, not ${n}.`);if((e.x+e.y)%2==0)return kG.failure(n8.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return kG.failure(n8.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return kG.SUCCESS}static from(e,t){if(!e.isInRange(t8.WIDTH,t8.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(t8.WIDTH,t8.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");const n=r8.checkDistanceAndLocation(e,t);return n.isFailure()?n.toFailedFallible():OG.success(new r8(e,t))}isSimpleStep(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"SaharaMove("+this.coord+"->"+this.end+")"}}r8.encoder=new class extends BY{maxValue(){return 396*t8.WIDTH+66*t8.HEIGHT+6*t8.WIDTH+t8.HEIGHT}encodeNumber(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}decodeNumber(e){const t=e%6;e-=t;const n=(e/=6)%11;e-=n;const r=(e/=11)%6;return e-=r,r8.from(new GJ(e/=6,r),new GJ(n,t)).get()}};let i8=(()=>{class e extends vQ{static getStartingCoords(e,t){const n=[];for(let r=0;r<t8.HEIGHT;r++)for(let i=0;i<t8.WIDTH;i++)e[r][i].is(t)&&n.push(new GJ(i,r));return n}static getBoardValuesFor(t,n){const r=e.getStartingCoords(t,n),i=[];for(const e of r){const n=t1.getEmptyNeighbors(t,e,YJ.EMPTY).length;if(0===n)return[0];i.push(n)}return i.sort((e,t)=>e-t)}applyLegalMove(t,n,r){pw(e.VERBOSE,"Legal move "+t.toString()+" applied");const i=n.getCopiedBoard();return i[t.end.y][t.end.x]=i[t.coord.y][t.coord.x],i[t.coord.y][t.coord.x]=YJ.EMPTY,new t8(i,n.turn+1)}isLegal(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return OG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==YJ.EMPTY)return OG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE());const n=e1.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===YJ.EMPTY?OG.success(void 0):OG.failure(n8.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):OG.success(void 0)}getGameStatus(t){const n=t.gameState.getCopiedBoard(),r=e.getBoardValuesFor(n,VY.ZERO),i=e.getBoardValuesFor(n,VY.ONE);return e.getGameStatusFromFreedoms(r,i)}static getGameStatusFromFreedoms(e,t){return 0===e[0]?yQ.ONE_WON:0===t[0]?yQ.ZERO_WON:yQ.ONGOING}}return e.VERBOSE=!1,e})();class s8 extends nQ{getListMoves(e){const t=[],n=e.gameState.getCopiedBoard(),r=e.gameState.getCurrentPlayer(),i=i8.getStartingCoords(n,r);for(const s of i){const e=t1.getEmptyNeighbors(n,s,YJ.EMPTY);for(const r of e){const e=r8.from(s,r).get();if(n[r.y][r.x]=n[s.y][s.x],n[s.y][s.x]=YJ.EMPTY,t.push(e),(r.y+r.x)%2==0){const e=t1.getEmptyNeighbors(n,r,YJ.EMPTY);for(const i of e)if(!i.equals(s)){const e=r8.from(s,i).get();n[i.y][i.x]=n[r.y][r.x],n[r.y][r.x]=YJ.EMPTY,t.push(e),n[r.y][r.x]=n[i.y][i.x],n[i.y][i.x]=YJ.EMPTY}}n[s.y][s.x]=n[r.y][r.x],n[r.y][r.x]=YJ.EMPTY}}return t}getBoardValue(e){const t=e.gameState.getCopiedBoard(),n=i8.getBoardValuesFor(t,VY.ZERO),r=i8.getBoardValuesFor(t,VY.ONE),i=i8.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return rQ.fromWinner(i.winner);let s=0;for(;s<6&&n[s]===r[s];)s++;return new rQ(r[s%6]-n[s%6])}}const o8=YJ.NONE,a8=YJ.ZERO,c8=YJ.ONE,l8=YJ.EMPTY;class u8{constructor(){this.tutorial=[wQ.informational($localize`Initial board`,$localize`Sâhârâ is played on a board where each space is a triangle.
        Each player has six pyramids.`,t8.getInitialState()),wQ.informational($localize`Goal of the game`,$localize`At Sâhârâ, the goal of the game is to immobilize one of the opponent's pyramids.
        To do so, you have to occupy all neighboring space of that pyramid.
        Here, Light has lost because its leftmost pyramid is immobilized.`,new t8([[o8,o8,l8,l8,c8,l8,l8,a8,c8,o8,o8],[o8,l8,l8,l8,l8,l8,l8,l8,l8,l8,o8],[c8,a8,l8,l8,l8,l8,l8,l8,l8,l8,a8],[a8,l8,l8,l8,l8,l8,l8,l8,l8,l8,c8],[o8,l8,l8,l8,l8,l8,l8,l8,l8,l8,o8],[o8,o8,c8,a8,l8,l8,l8,c8,a8,o8,o8]],3)),wQ.fromPredicate($localize`Simple step`,$localize`To immobilize your opponent, you have to move your pyramids.
        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).
        You're the first player, playing with the dark pyramids.
        <ol>
            <li>Click on one of your pyramids.</li>
            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>
        </ol><br/>
        Do any simple step.`,t8.getInitialState(),r8.from(new GJ(2,0),new GJ(2,1)).get(),(e,t)=>e.isSimpleStep()?kG.SUCCESS:kG.failure($localize`You have made a double step, which is good but it is the next exercise!`),$localize`Congratulations!`),wQ.fromPredicate($localize`Double step`,$localize`When a pyramid shares its vertices with dark spaces, it can move one or two steps.
        To do so:
        <ol>
            <li>Click on the pyramid to move.</li>
            <li>Click on one of the 6 destinations that you can reach in two steps:
                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.
        </ol>`,t8.getInitialState(),r8.from(new GJ(7,0),new GJ(5,0)).get(),(e,t)=>e.isSimpleStep()?kG.failure($localize`Failed! You have made a single step.`):kG.SUCCESS,$localize`Congratulations!`)]}}function h8(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"polyline",6),fa()),2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ua("ngClass",n.getPlayerClassFor(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function d8(e,t){if(1&e&&(Cn(),pa(0,"polyline",9)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function f8(e,t){if(1&e&&(Cn(),pa(0,"polyline",10)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function p8(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,d8,1,1,"polyline",7),aa(2,f8,1,1,"polyline",8),fa()),2&e){const e=ba().index,t=ba().index;Ts(1),ua("ngIf",(e+t)%2==1),Ts(1),ua("ngIf",(e+t)%2==0)}}function g8(e,t){if(1&e){const e=ya();Cn(),da(0,"g",5),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),aa(1,h8,2,2,"g",2),aa(2,p8,3,2,"g",2),fa()}if(2&e){const e=t.$implicit;Oa("id","click_",t.index,"_",ba().index,""),Ts(1),ua("ngIf",e.isPlayer()),Ts(1),ua("ngIf",2===e.value)}}function m8(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,g8,3,4,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function y8(e,t){if(1&e&&(Cn(),ga(0),pa(1,"polyline",11),pa(2,"polyline",11),ma()),2&e){const e=ba();Ts(1),ra("points",e.getTriangleCoordinate(e.lastCoord.get().x,e.lastCoord.get().y)),Ts(1),ra("points",e.getTriangleCoordinate(e.lastMoved.get().x,e.lastMoved.get().y))}}function v8(e,t){if(1&e&&(Cn(),pa(0,"polyline",12)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}let _8=(()=>{class e extends KX{constructor(e){super(e),this.lastCoord=vw.empty(),this.lastMoved=vw.empty(),this.chosenCoord=vw.empty(),this.rules=new i8(t8),this.availableMinimaxes=[new s8(this.rules,"SaharaMinimax")],this.encoder=r8.encoder,this.tutorial=(new u8).tutorial,this.updateBoard()}cancelMoveAttempt(){this.chosenCoord=vw.empty()}onClick(e,t){var n=this;return dw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t)})()}choosePiece(e,t){return this.board[t][e]===YJ.EMPTY?this.cancelMove(n8.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=vw.of(new GJ(e,t)),kG.SUCCESS):this.cancelMove(n8.MUST_CHOOSE_OWN_PYRAMID())}chooseLandingCoord(e,t){var n=this;return dw(function*(){const r=new GJ(e,t),i=n.rules.node.gameState.getCurrentPlayer(),s=YJ.ofPlayer(i);if(n.board[t][e]===s)return n.chosenCoord=vw.of(new GJ(e,t)),kG.SUCCESS;const o=r8.from(n.chosenCoord.get(),r);return o.isFailure()?n.cancelMove(o.getReason()):yield n.chooseMove(o.get(),n.rules.node.gameState)})()}updateBoard(){this.chosenCoord=vw.empty();const e=this.rules.node.move;this.lastCoord=e.map(e=>e.coord),this.lastMoved=e.map(e=>e.end),this.board=this.rules.node.gameState.board}getPlayerClassFor(e,t){return this.getPlayerClass(VY.of(this.board[t][e].value))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-sahara"]],features:[Ho],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,m8,2,1,"g",1),aa(2,y8,3,2,"ng-container",2),aa(3,v8,1,1,"polyline",3),fa()),2&e&&(Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngIf",t.lastMoved.isPresent()),Ts(1),ua("ngIf",t.chosenCoord.isPresent()))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class C8 extends uQ{constructor(e,t,n,r){super(e,t),this.x=e,this.y=t,this.moveDirection=n,this.landingOrientation=r,this.checkValidity()}checkValidity(){const e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}isRotation(){return this.moveDirection.isAbsent()}equals(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}toString(){const e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}isInsertion(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}C8.encoder=new class extends BY{maxValue(){return 2408}encodeNumber(e){const t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}decodeNumber(e){const t=e%7;e-=t;const n=(e/=7)%7;e-=n;const r=(e/=7)%5,i=4===r?vw.empty():HJ.factory.fromInt(r).toOptional();e-=r;const s=HJ.factory.fromInt(e/=5).get();return new C8(n-1,t-1,i,s)}};class E8{constructor(e){this.value=e}static decode(e){switch(e){case 0:return E8.EMPTY;case 1:return E8.WHITE_UP;case 2:return E8.WHITE_RIGHT;case 3:return E8.WHITE_DOWN;case 4:return E8.WHITE_LEFT;case 5:return E8.BLACK_UP;case 6:return E8.BLACK_RIGHT;case 7:return E8.BLACK_DOWN;case 8:return E8.BLACK_LEFT;case 9:return E8.MOUNTAIN}}belongTo(e){return e===VY.ZERO?1<=this.value&&this.value<=4:e===VY.ONE&&5<=this.value&&this.value<=8}isEmptyOrMountain(){return 0===this.value||9===this.value}isPiece(){return!this.isEmptyOrMountain()}getOwner(){return 1<=this.value&&this.value<=4?VY.ZERO:5<=this.value&&this.value<=8?VY.ONE:VY.NONE}getOptionalDirection(){switch(this.value){case 0:return vw.empty();case 1:case 5:return vw.of(HJ.UP);case 2:case 6:return vw.of(HJ.RIGHT);case 3:case 7:return vw.of(HJ.DOWN);case 4:case 8:return vw.of(HJ.LEFT);default:return fw.expectToBe(this.value,9),vw.empty()}}static of(e,t){if(t===VY.NONE)throw new Error("Player None does not have any pieces.");return t===VY.ZERO?e===HJ.UP?E8.WHITE_UP:e===HJ.RIGHT?E8.WHITE_RIGHT:e===HJ.DOWN?E8.WHITE_DOWN:E8.WHITE_LEFT:e===HJ.UP?E8.BLACK_UP:e===HJ.RIGHT?E8.BLACK_RIGHT:e===HJ.DOWN?E8.BLACK_DOWN:E8.BLACK_LEFT}getDirection(){return this.getOptionalDirection().get()}toString(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return fw.expectToBe(this.value,9),"MOUNTAIN"}}}E8.EMPTY=new E8(0),E8.WHITE_UP=new E8(1),E8.WHITE_RIGHT=new E8(2),E8.WHITE_DOWN=new E8(3),E8.WHITE_LEFT=new E8(4),E8.BLACK_UP=new E8(5),E8.BLACK_RIGHT=new E8(6),E8.BLACK_DOWN=new E8(7),E8.BLACK_LEFT=new E8(8),E8.MOUNTAIN=new E8(9);class w8 extends aQ{static getInitialState(){const e=LG.createTable(5,5,E8.EMPTY);return e[2][1]=E8.MOUNTAIN,e[2][2]=E8.MOUNTAIN,e[2][3]=E8.MOUNTAIN,new w8(e,0)}countPlayerPawn(){let e=0;for(let t=0;t<5;t++)for(let n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}let b8=(()=>{class e{}return e.CANNOT_INSERT_WHEN_SELECTED=()=>$localize`You cannot insert a piece when you have already selected a piece.`,e.NO_REMAINING_PIECE_TO_INSERT=()=>$localize`You cannot insert a piece, all your pieces are already on the board.`,e.NOT_ENOUGH_FORCE_TO_PUSH=()=>$localize`You do not have enough strength to push.`,e.ILLEGAL_ROTATION=()=>$localize`You cannot push and turn at the same time.`,e.ILLEGAL_PUSH=()=>$localize`Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board.`,e})();class S8{constructor(e,t){this.resultingBoard=e,this.moved=t}}let P8=(()=>{class e extends vQ{isLegal(t,n){if(pw(e.VERBOSE,{SiamRules_isLegal:{move:t,state:n}}),!t.isInsertion()&&!n.getPieceAt(t.coord).belongTo(n.getCurrentPlayer()))return OG.failure(tQ.MUST_CHOOSE_PLAYER_PIECE());if(t.isRotation())return pw(e.VERBOSE,"Move is rotation"),this.isLegalRotation(t,n);{let r;if(t.isInsertion()){pw(e.VERBOSE,"Move is insertion");const i=this.isLegalInsertion(t.coord,n);if(i.legal.isFailure())return OG.failure(i.legal.getReason());r=i.insertedPiece}else pw(e.VERBOSE,"Move is forward"),r=n.getPieceAt(t.coord);return e.isLegalForwarding(t,n,r)}}isLegalInsertion(t,n){const r=n.countPlayerPawn(),i=n.getCurrentPlayer(),s=r<5?kG.SUCCESS:kG.failure(b8.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:e.getInsertedPiece(t,i),legal:s}}static getInsertedPiece(e,t){return E8.of(-1===e.x?HJ.RIGHT:-1===e.y?HJ.DOWN:5===e.x?HJ.LEFT:HJ.UP,t)}static isLegalForwarding(t,n,r){pw(e.VERBOSE,{isLegalForwarding:{move:t.toString(),state:n,firstPiece:r}});const i=[];let s=E8.of(t.landingOrientation,n.getCurrentPlayer());const o=t.moveDirection.get();let a=t.coord.getNext(o);if(a.isInRange(5,5)&&n.getPieceAt(a)!==E8.EMPTY&&!1===e.isStraight(r,t))return pw(e.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),OG.failure(b8.ILLEGAL_PUSH());let c=vw.of(o);const l=o.getOpposite();let u=0;const h=n.getCopiedBoard();t.coord.isInRange(5,5)&&(h[t.coord.y][t.coord.x]=E8.EMPTY,i.push(t.coord));let d=a.isInRange(5,5)&&s!==E8.EMPTY;for(;d;){c.equalsValue(o)?u++:c.equalsValue(l)&&u--,pw(e.VERBOSE,{totalForce:u,movingPiece:s,landingCoord:a});const t=h[a.y][a.x];t===E8.MOUNTAIN&&(u-=.9),h[a.y][a.x]=s,i.push(a),s=t,a=a.getNext(o),c=s.getOptionalDirection(),d=a.isInRange(5,5)&&s!==E8.EMPTY&&u>0}return a.isNotInRange(5,5)&&(pw(e.VERBOSE,"This movement would push "+s+" outside the board"),c.equalsValue(o)?u++:c.equalsValue(l)&&u--),u<=0?(pw(e.VERBOSE,"This move is an illegal push: "+h),OG.failure(b8.NOT_ENOUGH_FORCE_TO_PUSH())):(pw(e.VERBOSE,"This move is a legal push: "+h),OG.success(new S8(h,i)))}static isStraight(e,t){const n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}isLegalRotation(t,n){pw(e.VERBOSE,{isLegalRotation:{rotation:t,state:n}});const r=t.coord,i=n.getPieceAt(r),s=n.getCurrentPlayer();if(i.getDirection()===t.landingOrientation)return OG.failure(b8.ILLEGAL_ROTATION());const o=n.getCopiedBoard();return o[r.y][r.x]=E8.of(t.landingOrientation,s),OG.success(new S8(o,[r]))}applyLegalMove(e,t,n){const r=LG.copyBiArray(n.resultingBoard);return new w8(r,t.turn+1)}static getBoardValueInfo(t,n){const r=e.getMountainsRowsAndColumns(n),i=r.rows,s=r.columns,o=e.getWinner(n,t,r.nbMountain);if(o===VY.NONE){const t=e.getPushers(n,s,i);let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const a=n.getCurrentPlayer();for(const e of t)e.coord.isInRange(5,5)?n.getPieceAt(e.coord).belongTo(VY.ZERO)?r=Math.min(r,e.distance):o=Math.min(o,e.distance):a===VY.ZERO?r=Math.min(r,e.distance):o=Math.min(o,e.distance);return{shortestZero:r,shortestOne:o,boardValue:e.getScoreFromShortestDistances(r,o,a)}}return o===VY.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER}}static getScoreFromShortestDistances(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);const r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}static getMountainsRowsAndColumns(e){const t=[],n=[];let r=0;for(let i=0;i<5;i++)for(let s=0;s<5;s++)e.getPieceAtXY(s,i)===E8.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(s)||n.push(s),r++);return{rows:t,columns:n,nbMountain:r}}static getWinner(t,n,r){return 2===r?e.getPusher(t,n.get()):VY.NONE}static getPusher(t,n){const r=n.coord;let i;i=r.isInRange(5,5)?t.getPieceAt(r.getNext(n.landingOrientation)):e.getInsertedPiece(r,t.getCurrentOpponent());const s=i.getDirection(),o=e.getPusherCoord(t,s,r),a=t.getPieceAt(o).getOwner();return pw(e.VERBOSE,r.toString()+" belong to "+t.getCurrentOpponent().value+", "+o.toString()+" belong to "+a.value+", "+a.value+" win"),a}static getPusherCoord(e,t,n){let r=n.getNext(t),i=n;for(;r.isInRange(5,5);){n=r,r=r.getNext(t);const s=e.getPieceAt(n);s!==E8.MOUNTAIN&&s.getDirection()===t&&(i=n)}return i}static getPushers(t,n,r){pw(e.VERBOSE,{getPushers:{state:t,mountainsColumn:n,mountainsRow:r}});let i=[];const s=[];for(const e of n){let t=HJ.DOWN,n=new GJ(e,4);s.push({direction:t,fallingCoord:n}),t=HJ.UP,n=new GJ(e,0),s.push({direction:t,fallingCoord:n})}for(const e of r){let t=HJ.LEFT,n=new GJ(0,e);s.push({direction:t,fallingCoord:n}),t=HJ.RIGHT,n=new GJ(4,e),s.push({direction:t,fallingCoord:n})}for(const o of s)i=e.addPotentialDirectionPusher(t,o.fallingCoord,o.direction,i);return i}static addPotentialDirectionPusher(t,n,r,i){const s=e.getLineClosestPusher(t,n,r);if(s.isAbsent())return i;const o=s.get(),a=o.distance;return pw(e.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:a}),i}static getLineClosestPusher(t,n,r){pw(e.VERBOSE,{getDirectionClosestPusher:{state:t,fallingCoord:n,direction:r.toString()}});const i=r.getOpposite();let s=1,o=t.getPieceAt(n),a=n,c=vw.empty(),l=!1,u=!1,h=0;for(;a.isInRange(5,5)&&!1===l;){const e=t.getPieceAt(a);if(e.isEmptyOrMountain())e===E8.MOUNTAIN?(h+=.9,u=!0):s++;else{const t=e.getDirection();t===r?u&&(h-=1,h<=0&&(l=!0,a=a.getNext(r))):t===i?(h+=1,u||s++):u?(c=vw.of(a),o!==E8.EMPTY&&s++):s++}o=e,a=a.getPrevious(r)}if(!1===l&&c.isPresent())for(s++,h-=1;!1===a.equals(c.get());)a=a.getNext(r),s--;return a.isNotInRange(5,5)&&(h-=1,5===t.countPlayerPawn())||h>0?vw.empty():vw.of({distance:s,coord:a})}static getPushingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[];for(let s=0;s<5;s++)r.push(new C8(-1,s,vw.of(HJ.RIGHT),HJ.RIGHT)),i.push(E8.of(HJ.RIGHT,n)),r.push(new C8(5,s,vw.of(HJ.LEFT),HJ.LEFT)),i.push(E8.of(HJ.LEFT,n)),r.push(new C8(s,-1,vw.of(HJ.DOWN),HJ.DOWN)),i.push(E8.of(HJ.DOWN,n)),r.push(new C8(s,5,vw.of(HJ.UP),HJ.UP)),i.push(E8.of(HJ.UP,n));for(let s=0;s<r.length;s++)this.isLegalForwarding(r[s],e.gameState,i[s]).isSuccess()&&t.push(r[s]);return t}static getDerapingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer();let r,i,s;for(let o=1;o<=3;o++)r=new C8(-1,o,vw.of(HJ.RIGHT),HJ.UP),i=E8.of(HJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new C8(-1,o,vw.of(HJ.RIGHT),HJ.DOWN),i=E8.of(HJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new C8(5,o,vw.of(HJ.LEFT),HJ.UP),i=E8.of(HJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new C8(5,o,vw.of(HJ.LEFT),HJ.DOWN),i=E8.of(HJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));for(let o=1;o<=3;o++)r=new C8(o,-1,vw.of(HJ.DOWN),HJ.LEFT),i=E8.of(HJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new C8(o,-1,vw.of(HJ.DOWN),HJ.RIGHT),i=E8.of(HJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new C8(o,5,vw.of(HJ.UP),HJ.LEFT),i=E8.of(HJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new C8(o,5,vw.of(HJ.UP),HJ.RIGHT),i=E8.of(HJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));return t}static getCoordDirection(e,t,n){const r=new GJ(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}getGameStatus(t){const n=e.getMountainsRowsAndColumns(t.gameState),r=e.getWinner(t.gameState,t.move,n.nbMountain);return r===VY.NONE?yQ.ONGOING:yQ.getVictory(r)}}return e.VERBOSE=!1,e})();class O8 extends nQ{getBoardValue(e){return new rQ(P8.getBoardValueInfo(e.move,e.gameState).boardValue)}getListMoves(e){let t=[];const n=e.gameState.getCurrentPlayer();let r;for(let i=0;i<5;i++)for(let s=0;s<5;s++)if(r=e.gameState.getPieceAtXY(s,i),r.belongTo(n)){const o=r.getDirection();for(const a of HJ.ORTHOGONALS){if(a!==o){const r=e.gameState.getCopiedBoard(),o=new C8(s,i,vw.empty(),a);r[i][s]=E8.of(a,n),t.push(o)}let c;c=new GJ(s+a.x,i+a.y).isInRange(5,5)?HJ.ORTHOGONALS:[a];for(const n of c){const o=new C8(s,i,vw.of(a),n);P8.isLegalForwarding(o,e.gameState,r).isSuccess()&&t.push(o)}}}return e.gameState.countPlayerPawn()<5&&(t=t.concat(P8.getPushingInsertions(e)),t=t.concat(P8.getDerapingInsertions(e))),pw(P8.VERBOSE,{getListMovesResult:t}),t}}const T8=E8.EMPTY,I8=E8.MOUNTAIN,k8=E8.WHITE_UP,A8=E8.WHITE_LEFT,N8=E8.WHITE_RIGHT,M8=E8.WHITE_DOWN,x8=E8.BLACK_UP,R8=E8.BLACK_LEFT,D8=E8.BLACK_RIGHT,L8=E8.BLACK_DOWN;class F8{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`The goal at Siam is to be the first to push a mountain out of the board.
        The initial board contains three mountains, and no pieces are initially on the board.
        During its turn, a player can do one of the following three actions:
        <ol>
            <li>Put a new piece on the board.</li>
            <li>Change the orientation of one of its piece, and optionally move it.</li>
            <li>Take one of its pieces out of the board.</li>
        </ol>`,w8.getInitialState()),wQ.anyMove($localize`Inserting a piece`,$localize`Each player has 5 pieces in total.
        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:
        <ol>
            <li>Click on one of the big arrows alongside the board.</li>
            <li>Click on one of the small arrows that appeared on the landing square of your piece.
                This is the direction in which your piece will be oriented.</li>
        </ol><br/>
        Insert a piece on the board.`,w8.getInitialState(),new C8(2,-1,vw.of(HJ.DOWN),HJ.DOWN),$localize`Congratulations!`),wQ.fromMove($localize`Moving a piece`,$localize`We will distinguish here "moving" and "pushing".
        A move is made from a piece's square to an empty neighboring square, horizontally or vertically.
        During that move, you can also move the piece out of the board.
        To move a piece:
        <ol>
            <li>Click on it.</li>
            <li>Click on one of the 4 arrows to pick the direction in which it will move.
                You can also click on the middle dot to change the piece's orientation without moving it.</li>
            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>
        </ol><br/>
        Try to move the piece that is on the board one square upwards and to orient it downwards.`,new w8([[T8,T8,T8,T8,T8],[T8,T8,T8,T8,T8],[T8,I8,I8,I8,T8],[T8,T8,T8,T8,T8],[T8,T8,k8,T8,T8]],0),[new C8(2,4,vw.of(HJ.UP),HJ.DOWN)],$localize`Congratulations, you made a side-slip!`,$localize`Failed!`),wQ.fromMove($localize`Moving a piece out of the board`,$localize`To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>
        Get that piece out of the board!`,new w8([[T8,T8,T8,T8,T8],[T8,T8,T8,T8,T8],[T8,I8,I8,I8,T8],[T8,T8,T8,T8,T8],[T8,T8,k8,T8,T8]],0),[new C8(2,4,vw.of(HJ.DOWN),HJ.DOWN)],$localize`Congratulations, even if in this context it was not a useful move.`,$localize`Failed, the piece is still on the board.`),wQ.fromMove($localize`Pushing`,$localize`When the landing square of your move is occupied, we use the term "push".
        In order to push, multiple conditions must hold:
        <ol>
            <li>Your piece must already be oriented in the direction of the push.</li>
            <li>The number of the pieces (opponent's or not) that are facing yours (called the resistants)
                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>
            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>
        </ol>
        Your piece on the top right cannot push because there is one mountain too much.
        Your piece on the bottom right can push.<br/><br/>
        Do it.`,new w8([[N8,I8,I8,R8,A8],[T8,T8,T8,T8,T8],[T8,T8,T8,I8,T8],[T8,T8,T8,T8,T8],[T8,T8,D8,R8,A8]],0),[new C8(4,4,vw.of(HJ.LEFT),HJ.LEFT)],$localize`Congratulations!`,$localize`Failed!`),wQ.fromMove($localize`Victory`,$localize`The game ends when a mountain is pushed out of the board.
        If you pushed it and nobody is in front of you, you're the winner.
        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.
        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>
        You have two ways of ending the game here: you can either win, or lose. Choose correctly!`,new w8([[T8,T8,T8,T8,T8],[T8,T8,T8,T8,T8],[I8,x8,A8,T8,M8],[T8,T8,T8,T8,L8],[T8,T8,T8,T8,I8]],0),[new C8(2,2,vw.of(HJ.LEFT),HJ.LEFT)],$localize`Congratulations, you won!`,$localize`Failed, you lost.`)]}}function B8(e,t){if(1&e){const e=ya();Cn(),da(0,"use",7),Ca("click",function(){const t=Gt(e).$implicit;return ba(3).insertAt(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit,n=ba(3);Oa("id","insertAt_",e.x,"_",e.y,""),ra("transform",n.getInsertionArrowTransform(e.x+1,e.y+1,e.dir))}}const V8=function(e,t){return{dir:"DOWN",x:e,y:t}},U8=function(e){return{dir:"UP",x:e,y:5}},$8=function(e,t){return{dir:"RIGHT",x:e,y:t}},z8=function(e){return{dir:"LEFT",x:5,y:e}},H8=function(e,t,n,r){return[e,t,n,r]};function G8(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,B8,1,3,"use",6),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",lu(11,H8,cu(1,V8,e,-1),au(4,U8,e),cu(6,$8,-1,e),au(9,z8,e)))}}const q8=function(){return[0,1,2,3,4]};function W8(e,t){1&e&&(Cn(),ga(0),aa(1,G8,2,16,"g",5),ma()),2&e&&(Ts(1),ua("ngForOf",ou(1,q8)))}function j8(e,t){if(1&e){const e=ya();Cn(),da(0,"use",13),Ca("click",function(){const t=Gt(e).$implicit;return ba(5).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(3).index,r=ba().index,i=ba();Pa("id","chooseDirection_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}const Z8=function(){return["RIGHT","DOWN","LEFT","UP"]};function Y8(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",11),Ca("click",function(){return Gt(e),ba(4).chooseDirection("")}),fa(),aa(2,j8,1,2,"use",12),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("cx",(e+1)*n.SPACE_SIZE+n.SPACE_SIZE/2)("cy",(t+1)*n.SPACE_SIZE+n.SPACE_SIZE/2),Ts(1),ua("ngForOf",ou(3,Z8))}}function K8(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"use",10),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().clickPiece(t,n)}),fa(),aa(2,Y8,3,4,"g",4),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Oa("id","clickPiece_",t,"_",r,""),ua("ngClass",i.getPieceClasses(n)),ra("transform",i.getPieceTransform(t,r)),Ts(1),ua("ngIf",i.choosingDirection(t,r))}}function J8(e,t){if(1&e&&(Cn(),pa(0,"use",14)),2&e){const e=ba().index,t=ba().index,n=ba();ra("transform","translate("+(e+1)*n.SPACE_SIZE+" "+(t+1)*n.SPACE_SIZE+")")}}function Q8(e,t){if(1&e){const e=ya();Cn(),da(0,"use",13),Ca("click",function(){const t=Gt(e).$implicit;return ba(4).chooseOrientation(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2).index,r=ba().index,i=ba();Pa("id","chooseOrientation_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}function X8(e,t){1&e&&(Cn(),da(0,"g"),aa(1,Q8,1,2,"use",12),fa()),2&e&&(Ts(1),ua("ngForOf",ou(1,Z8)))}function e7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",8),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().insertAt(t,n)}),fa(),aa(2,K8,3,5,"g",4),aa(3,J8,1,1,"use",9),aa(4,X8,2,2,"g",4),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Oa("id","insertAt_",n,"_",r,""),ua("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*(n+1))("y",i.SPACE_SIZE*(r+1))("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ua("ngIf",e.isPiece()),Ts(1),ua("ngIf",i.isMountain(e)),Ts(1),ua("ngIf",i.choosingOrientation(n,r))}}function t7(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,e7,5,10,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let n7=(()=>{class e extends rX{constructor(e){super(e),this.lastMove=vw.empty(),this.chosenCoord=vw.empty(),this.landingCoord=vw.empty(),this.chosenDirection=vw.empty(),this.chosenOrientation=vw.empty(),this.movedPieces=[],this.rules=new P8(w8),this.availableMinimaxes=[new O8(this.rules,"SiamMinimax")],this.encoder=C8.encoder,this.tutorial=(new F8).tutorial,this.updateBoard()}updateBoard(){if(pw(e.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}cancelMoveAttempt(){this.chosenCoord=vw.empty(),this.chosenDirection=vw.empty(),this.landingCoord=vw.empty(),this.chosenOrientation=vw.empty()}clickPiece(e,t){const n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(tQ.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=vw.of(new GJ(e,t)),kG.SUCCESS)}chooseDirection(t){var n=this;return dw(function*(){pw(e.VERBOSE,"SiamComponent.chooseDirection("+t+")");const r=n.canUserPlay("#chooseDirection_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(""===t)n.chosenDirection=vw.empty(),n.landingCoord=n.chosenCoord;else{const r=HJ.factory.fromString(t).get();if(n.chosenDirection=vw.of(r),n.landingCoord=vw.of(n.chosenCoord.get().getNext(r)),n.landingCoord.get().isNotInRange(5,5))return pw(e.VERBOSE,"orientation and direction should be the same: "+r),n.chosenOrientation=vw.of(r),yield n.tryMove()}return kG.SUCCESS})()}chooseOrientation(t){var n=this;return dw(function*(){pw(e.VERBOSE,"SiamComponent.chooseOrientation("+t+")");const r=n.canUserPlay("#chooseOrientation_"+t);return r.isFailure()?n.cancelMove(r.getReason()):(n.chosenOrientation=vw.of(HJ.factory.fromString(t).get()),yield n.tryMove())})()}insertAt(t,n){var r=this;return dw(function*(){pw(e.VERBOSE,"SiamComponent.insertAt("+t+", "+n+")");const i=r.canUserPlay("#insertAt_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());if(r.chosenCoord.isPresent())return r.cancelMove(b8.CANNOT_INSERT_WHEN_SELECTED());{r.chosenCoord=vw.of(new GJ(t,n));const e=P8.getCoordDirection(t,n,r.rules.node.gameState);return r.chosenDirection=vw.of(e),r.landingCoord=vw.of(r.chosenCoord.get().getNext(e)),kG.SUCCESS}})()}tryMove(){var e=this;return dw(function*(){const t=e.chosenCoord.get(),n=new C8(t.x,t.y,e.chosenDirection,e.chosenOrientation.get());return e.cancelMove(),yield e.chooseMove(n,e.rules.node.gameState)})()}isMountain(e){return e===E8.MOUNTAIN}choosingOrientation(t,n){const r=new GJ(t,n);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(pw(e.VERBOSE,"choosing orientation now"),!0)}choosingDirection(t,n){const r=new GJ(t,n);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(pw(e.VERBOSE,"choosing direction now"),!0)}getInsertionArrowTransform(e,t,n){const r=`rotate(${90*(HJ.factory.fromString(n).get().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}getPieceTransform(e,t){const n=`rotate(${90*(this.board[t][e].getDirection().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}getArrowTransform(e,t,n){return N6.getArrowTransform(this.SPACE_SIZE,new GJ(e,t),HJ.factory.fromString(n).get())}getPieceClasses(e){return[this.getPlayerClass(e.getOwner())]}getSquareClasses(e,t){const n=new GJ(e,t);return this.movedPieces.some(e=>e.equals(n))?["moved"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-siam"]],features:[Ho],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],[0,"xlink","href","#triangle","class","arrow selected-fill no-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),da(1,"defs"),pa(2,"polygon",1),pa(3,"polygon",2),pa(4,"polygon",3),fa(),aa(5,W8,2,2,"ng-container",4),aa(6,t7,2,1,"g",5),fa()),2&e&&(Ts(5),ua("ngIf",t.isPlayerTurn()),Ts(1),ua("ngForOf",t.board))},directives:[zd,Ud,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),r7=(()=>{class e{}return e.NO_MOVEMENT_BEFORE_TURN_40=()=>$localize`You cannot move yet. Pick a space where you will put a new piece.`,e.MUST_CUT=()=>$localize`Several groups are of the same size, you must pick the one to keep.`,e.CANNOT_CHOOSE_TO_KEEP=()=>$localize`You cannot choose which part to keep when one is smaller than the other.`,e.CAN_NO_LONGER_DROP=()=>$localize`You cannot put new pieces anymore. Pick a piece to move.`,e.MUST_CAPTURE_BIGGEST_GROUPS=()=>$localize`You must choose one of the biggest groups to keep it.`,e.CANNOT_KEEP_EMPTY_COORD=()=>$localize`You cannot pick an empty space. Pick one of the biggest groups.`,e.MUST_DROP_NEXT_TO_OTHER_PIECE=()=>$localize`You must put this piece next to another piece.`,e})();class i7 extends oQ{constructor(e,t,n){super(t),this.pieces=e;const r=this.getCalculatedScale();this.pieces=r.pieces,this.width=r.width,this.height=r.height,this.offset=n||r.offset,this.pieces.makeImmutable()}static getInitialState(){return i7.fromRepresentation([[VY.ZERO.value],[VY.ONE.value]],0)}static fromRepresentation(e,t,n){const r=new pQ;for(let i=0;i<e.length;i++)for(let t=0;t<e[0].length;t++)e[i][t]!==VY.NONE.value&&r.set(new GJ(t,i),VY.of(e[i][t]));return new i7(r,t,n)}static deplacePiece(e,t){const n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}static getGroups(e,t){let n=new pQ,r=0;for(const o of KJ.factory.all){const i=t.getNext(o,1);n=i7.putCoordInGroup(e,i,n,""+r),r++}const i=n.reverse(),s=new sQ;for(let o=0;o<i.size();o++)s.add(i.getByIndex(o).value);return s}static putCoordInGroup(e,t,n,r){if(e.get(t).isPresent()&&n.get(t).isAbsent()){n.set(t,r);for(const i of KJ.factory.all){const s=t.getNext(i,1);n=i7.putCoordInGroup(e,s,n,r)}}return n}getCalculatedScale(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const o of this.pieces.listKeys())e=Math.min(o.x,e),t=Math.max(o.x,t),n=Math.min(o.y,n),r=Math.max(o.y,r);let i=new pQ;const s=new VJ(-e,-n);if(0!==e||0!==n)for(const o of this.pieces.listKeys()){const e=this.pieces.delete(o),t=o.getNext(s);i.set(t,e)}else i=this.pieces;return{width:t+1-e,height:r+1-n,pieces:i,offset:s}}toRepresentation(){const e=LG.createTable(this.width,this.height,VY.NONE.value);for(const t of this.pieces.listKeys()){const n=this.getPieceAt(t).value;e[t.y][t.x]=n}return e}isIllegalLandingZone(e,t){return this.pieces.containsKey(e)?kG.failure(tQ.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?kG.SUCCESS:kG.failure(r7.MUST_DROP_NEXT_TO_OTHER_PIECE())}isCoordConnected(e,t){for(const n of KJ.factory.all){const r=e.getNext(n,1);if(this.pieces.containsKey(r)&&!1===t.equalsValue(r))return!0}return!1}isOnBoard(e){return this.pieces.containsKey(e)}getPieceAt(e){return this.isOnBoard(e)?this.pieces.get(e).get():VY.NONE}applyLegalDrop(e){const t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new i7(t,this.turn+1)}applyLegalDeplacement(e,t){const n=i7.deplacePiece(this,e);let r=new pQ;if(t.size()>0){r=new pQ;for(const e of t)r.set(e,n.get(e).get())}else r=n.getCopy();return new i7(r,this.turn+1)}countPieces(){const e=this.pieces.reverse(),t=e.get(VY.ZERO).getOrElse(new kX),n=e.get(VY.ONE).getOrElse(new kX);return[t.size(),n.size()]}switchPiece(e){const t=this.pieces.getCopy(),n=this.getPieceAt(e);return t.replace(e,n.getOpponent()),new i7(t,this.turn,this.offset)}equals(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}class s7 extends lQ{constructor(e,t,n){if(super(),this.start=e,this.landing=t,this.keep=n,e.equalsValue(t))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(n))throw new Error("Cannot keep starting coord, since it will always be empty after move!")}static fromDrop(e){return new s7(vw.empty(),e,vw.empty())}static fromMovement(e,t){return new s7(vw.of(e),t,vw.empty())}static fromCut(e,t,n){return new s7(vw.of(e),t,vw.of(n))}isDrop(){return this.start.isAbsent()}isCut(){return this.keep.isPresent()}toString(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}equals(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}s7.encoder=new class extends FY{encodeMove(e){return{start:e.start.isPresent()?GJ.encoder.encode(e.start.get()):null,landing:GJ.encoder.encode(e.landing),keep:e.keep.isPresent()?GJ.encoder.encode(e.keep.get()):null}}decodeMove(e){const t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");const n=GJ.encoder.decode(t.landing);if(null==t.start)return s7.fromDrop(n);const r=GJ.encoder.decode(t.start);if(null==t.keep)return s7.fromMovement(r,n);{const e=GJ.encoder.decode(t.keep);return s7.fromCut(r,n,e)}}};class o7 extends vQ{constructor(){super(...arguments),this.VERBOSE=!1}applyLegalMove(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}isLegal(e,t){pw(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});const n=t.isIllegalLandingZone(e.landing,e.start);return n.isFailure()?n.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):o7.isLegalPhaseTwoMove(e,t)}static getLegalLandings(e){const t=new kX;for(const n of e.pieces.listKeys())for(const r of KJ.factory.all){const i=n.getNext(r,1);e.getPieceAt(i)===VY.NONE&&t.add(i)}return t.toList()}isLegalDrop(e,t){return!1===e.isDrop()?OG.failure(r7.NO_MOVEMENT_BEFORE_TURN_40()):OG.success(t.pieces.getKeySet())}static isLegalPhaseTwoMove(e,t){if(e.isDrop())return OG.failure(r7.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case VY.NONE:return OG.failure(tQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return OG.failure(tQ.CANNOT_CHOOSE_OPPONENT_PIECE())}const n=i7.deplacePiece(t,e),r=i7.getGroups(n,e.start.get());if(o7.isSplit(r)){const t=this.getBiggerGroups(r);return 1===t.size()?e.keep.isPresent()?OG.failure(r7.CANNOT_CHOOSE_TO_KEEP()):OG.success(t.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,t,n)}return OG.success(new kX)}static isSplit(e){return e.size()>1}static getBiggerGroups(e){let t=0,n=new sQ;for(const r of e){const e=r.size();e>t?(t=e,n=new sQ([r])):e===t&&n.add(r)}return n}static moveKeepBiggerGroup(e,t,n){if(e.isAbsent())return OG.failure(r7.MUST_CUT());if(n.get(e.get()).isAbsent())return OG.failure(r7.CANNOT_KEEP_EMPTY_COORD());const r=e.get();for(const i of t)if(i.contains(r))return OG.success(i);return OG.failure(r7.MUST_CAPTURE_BIGGEST_GROUPS())}getGameStatus(e){const t=e.gameState,n=t.getCurrentOpponent();let r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return yQ.getVictory(n);if(t.turn>39){const e=t.countPieces(),n=e[0],r=e[1];return n<6&&r<6?n<r?yQ.ONE_WON:r<n?yQ.ZERO_WON:yQ.DRAW:n<6?yQ.getDefeat(VY.ZERO):r<6?yQ.getDefeat(VY.ONE):yQ.ONGOING}return yQ.ONGOING}startSearchingVictorySources(){pw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}getShapeVictory(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();const n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(pw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(KJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return[];const t=(e+i.length)%6;i.push(s),s=s.getNext(KJ.factory.all[t],1)}return i}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=KJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return[];a=!0,i=i.getOpposite(),s=s.getNext(i,o.length)}s=s.getNext(i,1)}return o}searchVictoryOnlyForTriangleCorner(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=KJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.length%2==0&&(i=KJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return s}searchVictoryOnlyForTriangleEdge(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=KJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.push(o),s.length%2==0&&(i=KJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return s}}class a7 extends nQ{calculateBoardValue(e,t){this.startSearchingVictorySources();let n={status:dQ.DEFAULT,victory:vw.empty(),preVictory:vw.empty(),sum:0};for(;this.hasNextVictorySource();){const r=this.getNextVictorySource();let i;if(i=n.status===dQ.PRE_VICTORY?this.searchVictoryOnly(r,e,t):this.getBoardInfo(r,e,t,n),i.status===dQ.VICTORY)return i;n={status:i.status,victory:vw.empty(),preVictory:i.preVictory,sum:n.sum+i.sum}}return n}}class c7 extends rQ{constructor(e,t){super(e),this.value=e,this.preVictory=t}}class l7 extends a7{constructor(){super(...arguments),this.VERBOSE=!1}static get(){if(null==l7.INSTANCE){const e=new o7(i7);l7.INSTANCE=new l7(e,"SixMinimax")}return l7.INSTANCE}getListMoves(e){const t=l7.get(),n=e.getOwnValue(t);if(n.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(n):this.createForcedDeplacement(e,n);const r=o7.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(r):this.getListDeplacement(e.gameState,r)}createForcedDrop(e){pw(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});const t=[],n=s7.fromDrop(e.preVictory.get());return t.push(n),t}createForcedDeplacement(e,t){pw(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});const n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}getDeplacementFrom(e,t,n){const r=[];for(const i of t)for(const t of n){const n=s7.fromMovement(i,t);if(e.isCoordConnected(t,vw.of(i))){const s=i7.deplacePiece(e,n),o=i7.getGroups(s,n.start.get());if(o7.isSplit(o))for(const e of o){const n=e.getAnyElement().get(),s=s7.fromCut(i,t,n);r.push(s)}else r.push(n)}}return r}getSafelyMovablePieceOrFirstOne(e){const t=e.gameState,n=t.pieces.reverse(),r=t.getCurrentPlayer(),i=n.get(r).get(),s=i.getAnyElement().get(),o=[];for(const a of i)!1===this.isPieceBlockingAVictory(t,a)&&o.push(a);return new kX(0===o.length?[s]:o)}isPieceBlockingAVictory(e,t){const n=e.switchPiece(t),r=s7.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===dQ.VICTORY)return!0;return!1}getListDrop(e){const t=[];for(const n of e){const e=s7.fromDrop(n);t.push(e)}return t}getListDeplacement(e,t){const n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}getBoardValue(e){const t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue();let s={status:dQ.DEFAULT,victory:vw.empty(),preVictory:vw.empty(),sum:0};t.isPresent()&&(s=this.calculateBoardValue(t.get(),n));let o=vw.empty();if(s.status===dQ.DEFAULT&&s.preVictory.isPresent()&&(o=vw.of(s.preVictory.get())),s.status===dQ.VICTORY)return new c7(i,vw.empty());if(n.turn>39){const e=n.countPieces(),t=e[0],r=e[1];return t<6&&r<6?new c7(t<r?VY.ONE.getVictoryValue():r<t?VY.ZERO.getVictoryValue():0,vw.empty()):t<6?new c7(VY.ZERO.getDefeatValue(),vw.empty()):r<6?new c7(VY.ONE.getDefeatValue(),vw.empty()):new c7(t-r,o)}return new c7(s.status===dQ.PRE_VICTORY?r.getPreVictory():s.sum*r.getScoreModifier(),o)}startSearchingVictorySources(){pw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(pw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(KJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return{status:dQ.PRE_VICTORY,victory:vw.empty(),preVictory:vw.empty(),sum:0};const t=(e+i.length)%6;i.push(s),s=s.getNext(KJ.factory.all[t],1)}return{status:dQ.VICTORY,victory:vw.of(i),preVictory:vw.empty(),sum:0}}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=KJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return{status:dQ.PRE_VICTORY,victory:vw.empty(),preVictory:vw.empty(),sum:0};a=!0,i=i.getOpposite(),s=s.getNext(i,o.length-1)}s=s.getNext(i,1)}return{status:dQ.VICTORY,victory:vw.of(o),preVictory:vw.empty(),sum:0}}searchVictoryOnlyForTriangleCorner(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=KJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:dQ.PRE_VICTORY,victory:vw.empty(),preVictory:vw.empty(),sum:0};s.length%2==0&&(i=KJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return{status:dQ.VICTORY,victory:vw.of(s),preVictory:vw.empty(),sum:0}}searchVictoryOnlyForTriangleEdge(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=KJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:dQ.PRE_VICTORY,victory:vw.empty(),preVictory:vw.empty(),sum:0};s.push(o),s.length%2==0&&(i=KJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return{status:dQ.VICTORY,victory:vw.of(s),preVictory:vw.empty(),sum:0}}getBoardInfo(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});const i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}getBoardInfoForCircle(e,t,n,r){pw(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer(),s=[t];let o=t.getNext(KJ.factory.all[e],1),a=0,c=vw.empty();for(;s.length<6;){const t=n.getPieceAt(o);if(t===i)return r;const l=(e+s.length)%6;s.push(o);const u=KJ.factory.all[l];t===VY.NONE?(a+=.16,c=vw.of(o)):a++,o=o.getNext(u,1)}return this.getBoardInfoResult(a,c,s,r)}getBoardInfoResult(e,t,n,r){let i=r.preVictory;if(4.16===e){if(pw(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:dQ.PRE_VICTORY,victory:vw.empty(),preVictory:vw.empty(),sum:0};i=t}else if(5===e)return{status:dQ.VICTORY,victory:vw.of(n),preVictory:vw.empty(),sum:0};return{status:r.status,victory:vw.empty(),preVictory:i,sum:r.sum+e}}getBoardInfoForLine(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});const i=KJ.factory.all[e];let s=t.getPrevious(i,5),o=[],a=[],c=vw.empty();for(let p=0;p<6;p++){const e=this.updateEncounterAndReturnLastEmpty(n,s,a);e.isPresent()&&(c=e),o.push(s),s=s.getNext(i,1)}let l=r.status,u=r.preVictory,h=0,d=0;for(;h<6;){const e=a.reduce((e,t)=>e+t);if(6===e)return{status:dQ.VICTORY,victory:vw.of(o),preVictory:vw.empty(),sum:0};5.16===e&&l===dQ.DEFAULT&&(u.isPresent()?(MG(!1===u.equals(c),"Impossible to have point aligned with differents line to a same point"),l=dQ.PRE_VICTORY):u=c),d=Math.max(d,e),o=o.slice(1,6),o.push(s),a=a.slice(1,6);const t=this.updateEncounterAndReturnLastEmpty(n,s,a);t.isPresent()&&(c=t),h++,s=s.getNext(i,1)}const f={status:l,victory:vw.of(o),preVictory:u,sum:d};return this.getBoardInfoResult(d,c,o,f)}updateEncounterAndReturnLastEmpty(e,t,n){const r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),vw.empty();case VY.NONE:return n.push(.16),vw.of(t);default:return n.push(1),vw.empty()}}getBoardInfoForTriangleCorner(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=KJ.factory.all[e];const o=[t];let a=t.getNext(s,1),c=0,l=vw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===VY.NONE?(c+=.16,l=vw.of(a)):c++,o.length%2==0&&(s=KJ.factory.all[(e+o.length)%6]),o.push(a),a=a.getNext(s,1)}return this.getBoardInfoResult(c,l,o,r)}getBoardInfoForTriangleEdge(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=KJ.factory.all[e];const o=[t];let a=t.getNext(s,1),c=0,l=vw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===VY.NONE?(c+=.16,l=vw.of(a)):c++,o.push(a),o.length%2==0&&(s=KJ.factory.all[(e+o.length)%6]),a=a.getNext(s,1)}return this.getBoardInfoResult(c,l,o,r)}}const u7=VY.NONE.value,h7=VY.ZERO.value,d7=VY.ONE.value;let f7=(()=>{class e{}return e.MOVEMENT_NOT_DISCONNECTING=()=>$localize`This move does not disconnect your opponent's pieces. Try again with another piece.`,e.MOVEMENT_SELF_DISCONNECTING=()=>$localize`You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!`,e})();class p7{constructor(){this.tutorial=[wQ.informational($localize`Six`,$localize`Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.
        Each player has 21 pieces, with one for each player already on the board.
        The goal of the game is to form one of the three winning shapes with your pieces.`,i7.getInitialState()),wQ.fromMove($localize`Victory (line)`,$localize`On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>
        Find the victory. You're playing Dark.`,i7.fromRepresentation([[h7,d7,d7,d7,d7,h7],[u7,h7,d7,u7,h7,u7],[d7,d7,h7,u7,u7,u7],[u7,u7,h7,u7,u7,u7],[u7,h7,u7,u7,u7,u7],[h7,u7,u7,u7,u7,u7]],0),[s7.fromDrop(new GJ(3,2))],$localize`Congratulations!`,$localize`Failed!`),wQ.fromMove($localize`Victory (circle)`,$localize`On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,i7.fromRepresentation([[u7,u7,u7,d7,u7,u7],[u7,u7,d7,d7,h7,h7],[u7,d7,u7,h7,d7,u7],[d7,h7,h7,h7,h7,d7]],0),[s7.fromDrop(new GJ(5,2))],$localize`Congratulations! Note that if a piece is inside the circle, it does not change anything.`,$localize`Failed!`),wQ.fromMove($localize`Victory (triangle)`,$localize`On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,i7.fromRepresentation([[u7,u7,u7,d7,u7,u7],[u7,h7,d7,h7,h7,h7],[u7,h7,u7,h7,h7,u7],[d7,d7,d7,u7,d7,u7]],0),[s7.fromDrop(new GJ(3,3))],$localize`Congratulations!`,$localize`Failed!`),wQ.fromPredicate($localize`Second phase`,$localize`After 40 turns, your pieces have all been placed and we move on to the second phase of the game.
        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.
        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>
        You're playing Dark. Make a move that disconnects one of your opponent's pieces.`,i7.fromRepresentation([[u7,u7,u7,u7,u7,u7,u7,d7,u7],[u7,u7,u7,u7,u7,u7,h7,u7,u7],[u7,u7,u7,u7,h7,h7,h7,u7,u7],[u7,u7,u7,u7,d7,d7,u7,d7,h7],[u7,h7,d7,d7,h7,h7,d7,u7,u7],[h7,h7,h7,h7,d7,d7,d7,h7,u7],[d7,d7,h7,u7,d7,d7,h7,u7,u7],[u7,h7,u7,h7,h7,u7,u7,u7,u7],[d7,d7,d7,d7,u7,u7,u7,u7,u7],[u7,h7,u7,d7,u7,u7,u7,u7,u7]],40),s7.fromMovement(new GJ(6,1),new GJ(5,1)),(e,t)=>{const n=t.countPieces();return 19===n[0]?18===n[1]?kG.SUCCESS:kG.failure(f7.MOVEMENT_NOT_DISCONNECTING()):kG.failure(f7.MOVEMENT_SELF_DISCONNECTING())},$localize`Congratulations, your opponent now has one piece less and you're closer to victory!`),wQ.fromPredicate($localize`Victory by disconnection`,$localize`During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.
        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.
        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>
        Here, you're playing Dark and you can win. Do it!`,i7.fromRepresentation([[u7,u7,u7,u7,u7,d7],[u7,u7,u7,u7,h7,d7],[u7,u7,u7,d7,h7,h7],[u7,u7,h7,u7,d7,h7],[d7,d7,u7,u7,u7,h7],[h7,d7,u7,u7,u7,u7],[h7,u7,u7,u7,u7,u7]],40),s7.fromMovement(new GJ(2,3),new GJ(3,3)),(e,t)=>e.start.equalsValue(new GJ(2,3))?kG.SUCCESS:kG.failure(f7.MOVEMENT_NOT_DISCONNECTING()),$localize`Congratulations, you won!`),wQ.fromPredicate($localize`Special disconnection`,$localize`During a disconnection, two or more groups could have the same size,
        in which case you will have to click on the group you wish to keep.<br/><br/>
        You're playing Dark, play such a move!`,i7.fromRepresentation([[u7,u7,u7,u7,u7,d7],[u7,u7,u7,u7,h7,d7],[u7,u7,u7,d7,h7,h7],[h7,u7,h7,u7,u7,d7],[d7,d7,u7,u7,u7,u7],[h7,h7,u7,u7,u7,u7],[h7,u7,u7,u7,u7,u7]],40),s7.fromCut(new GJ(2,3),new GJ(2,5),new GJ(2,5)),(e,t)=>e.keep.isAbsent()?kG.failure($localize`This move has not cut the board in two equal halves.`):t.getPieceAt(e.landing.getNext(t.offset))===VY.NONE?kG.failure($localize`Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again.`):kG.SUCCESS,$localize`Congratulations, you won!`)]}}function g7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",10),Ca("click",function(){const t=Gt(e).$implicit;return ba().onPieceClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Oa("id","piece_",e.x,"_",e.y,""),ua("ngClass",n.getPieceClass(e)),ra("points",n.getHexaCoordsAt(e))}}function m7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",11),Ca("click",function(){const t=Gt(e).$implicit;return ba().onNeighborClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Oa("id","neighbor_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function y7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",10),Ca("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.chosenLanding.get())}),fa()}if(2&e){const e=ba();Oa("id","chosenLanding_",e.chosenLanding.get().x,"_",e.chosenLanding.get().y,""),ua("ngClass",e.getPlayerClass(e.state.getCurrentPlayer())),ra("points",e.getHexaCoordsAt(e.chosenLanding.get()))}}function v7(e,t){if(1&e&&(Cn(),pa(0,"polyline",12)),2&e){const e=t.$implicit,n=ba();Oa("id","disconnected_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function _7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",13),Ca("click",function(){Gt(e);const t=ba();return t.onNeighborClick(t.leftCoord.get())}),fa()}if(2&e){const e=ba();Oa("id","leftCoord_",e.leftCoord.get().x,"_",e.leftCoord.get().y,""),ra("points",e.getHexaCoordsAt(e.leftCoord.get()))}}function C7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",14),Ca("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.lastDrop.get())}),fa()}if(2&e){const e=ba();Oa("id","lastDrop_",e.lastDrop.get().x,"_",e.lastDrop.get().y,""),ra("points",e.getHexaCoordsAt(e.lastDrop.get()))}}function E7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",15),Ca("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.selectedPiece.get())}),fa()}if(2&e){const e=ba();Oa("id","selectedPiece_",e.selectedPiece.get().x,"_",e.selectedPiece.get().y,""),ua("ngClass",e.getSelectedPieceClass()),ra("points",e.getHexaCoordsAt(e.selectedPiece.get()))}}function w7(e,t){if(1&e&&(Cn(),pa(0,"polyline",16)),2&e){const e=t.$implicit,n=ba();Oa("id","victoryCoord_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function b7(e,t){if(1&e){const e=ya();Cn(),da(0,"g",19),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).onPieceClick(t)}),pa(1,"polyline",20),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(1),Oa("id","cuttable_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function S7(e,t){if(1&e&&(Cn(),da(0,"g",17),aa(1,b7,2,3,"g",18),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let P7=(()=>{class e extends ZJ{constructor(e){super(e),this.disconnecteds=[],this.cuttableGroups=[],this.leftCoord=vw.empty(),this.lastDrop=vw.empty(),this.selectedPiece=vw.empty(),this.chosenLanding=vw.empty(),this.nextClickShouldSelectGroup=!1,this.rules=new o7(i7),this.availableMinimaxes=[new l7(this.rules,"SixMinimax")],this.encoder=s7.encoder,this.tutorial=(new p7).tutorial,this.SPACE_SIZE=30,this.hexaLayout=new JJ(1.5*this.SPACE_SIZE,new GJ(2*this.SPACE_SIZE,0),eQ.INSTANCE),this.updateBoard()}cancelMoveAttempt(){this.selectedPiece=vw.empty(),this.chosenLanding=vw.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=vw.empty(),this.lastDrop=vw.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}getViewBox(){const e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}mapAbstractCoordToCornerCoords(){const e=this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(e=>this.hexaLayout.getHexaCoordsAt(e));let t=[];for(const n of e)t=t.concat(n);return t}getLimits(e){let t=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;for(const s of e)s.x<r&&(r=s.x),s.y<i&&(i=s.y),t=Math.max(t,s.x),n=Math.max(n,s.y);return{minX:r,minY:i,maxX:t,maxY:n}}showLastMove(){const e=this.rules.node.move.get();this.lastDrop=vw.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?vw.of(e.start.get().getNext(this.state.offset,1)):vw.empty();const t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}getDisconnected(){const e=this.rules.node.mother.get().gameState.pieces.listKeys(),t=this.rules.node.gameState.pieces.listKeys(),n=[];for(const i of e)!1===this.rules.node.move.get().start.equalsValue(i)&&!1===t.some(e=>e.equals(i.getNext(this.state.offset,1)))&&n.push(i.getNext(this.state.offset,1));const r=this.lastDrop.get();return!1===this.pieces.some(e=>e.equals(r))&&!1===t.some(e=>e.equals(r))&&n.push(r),n}getEmptyNeighbors(){let e=o7.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){const t=this.chosenLanding.get();e=e.filter(e=>!1===e.equals(t))}return e}getPieceClass(e){const t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}onPieceClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#piece_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.state.turn<40)return t.cancelMove(r7.NO_MOVEMENT_BEFORE_TURN_40());if(t.chosenLanding.isAbsent())return t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(tQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=vw.of(e),kG.SUCCESS);{const n=s7.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e);return t.chooseMove(n,t.state)}})()}onNeighborClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#neighbor_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.nextClickShouldSelectGroup)return t.cancelMove(r7.MUST_CUT());if(t.state.turn<40)return t.chooseMove(s7.fromDrop(e),t.state);if(t.selectedPiece.isAbsent())return t.cancelMove(r7.CAN_NO_LONGER_DROP());{const n=s7.fromMovement(t.selectedPiece.get(),e),r=o7.isLegalPhaseTwoMove(n,t.state);return t.neededCutting(r)?(t.chosenLanding=vw.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,kG.SUCCESS):t.chooseMove(n,t.state)}})()}neededCutting(e){return e.isFailure()&&e.getReason()===r7.MUST_CUT()}moveVirtuallyPiece(){const e=this.selectedPiece.get();this.pieces=this.pieces.filter(t=>!1===t.equals(e)),this.neighbors=this.getEmptyNeighbors()}showCuttable(){const e=s7.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=i7.deplacePiece(this.state,e),n=i7.getGroups(t,e.start.get()),r=o7.getBiggerGroups(n);this.cuttableGroups=[];for(const i of r)this.cuttableGroups.push(i.toList())}getSelectedPieceClass(){return this.chosenLanding.isPresent()?"moved":"selected"}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-six"]],features:[Ho],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,g7,1,4,"polyline",1),aa(2,m7,1,3,"polyline",2),aa(3,y7,1,4,"polyline",3),aa(4,v7,1,3,"polyline",4),aa(5,_7,1,3,"polyline",5),aa(6,C7,1,3,"polyline",6),aa(7,E7,1,4,"polyline",7),aa(8,w7,1,3,"polyline",8),aa(9,S7,2,1,"g",9),fa()),2&e&&(ra("viewBox",t.viewBox),Ts(1),ua("ngForOf",t.pieces),Ts(1),ua("ngForOf",t.neighbors),Ts(1),ua("ngIf",t.chosenLanding.isPresent()),Ts(1),ua("ngForOf",t.disconnecteds),Ts(1),ua("ngIf",t.leftCoord.isPresent()),Ts(1),ua("ngIf",t.lastDrop.isPresent()),Ts(1),ua("ngIf",t.selectedPiece.isPresent()),Ts(1),ua("ngForOf",t.victoryCoords),Ts(1),ua("ngForOf",t.cuttableGroups))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class O7 extends gX{static of(e,t){return new O7(e,t)}static from(e,t){try{const n=new O7(e,t);return OG.success(n)}catch(n){return OG.failure(n.message)}}getMaximalDistance(){return 9}}O7.encoder=fX.getEncoder(9,9,O7.of);const T7={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:VY.ZERO};class I7 extends CX{static getInitialState(){const e=vX.UNOCCUPIED,t=vX.INVADERS,n=vX.DEFENDERS;return new I7([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,n,e,e,e,e],[t,e,e,e,n,e,e,e,t],[t,t,n,n,vX.PLAYER_ONE_KING,n,n,t,t],[t,e,e,e,n,e,e,e,t],[e,e,e,e,n,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}from(e,t){return new I7(e,t)}}class k7 extends wX{constructor(){super(I7,T7,O7.of)}static get(){return null==k7.singleton&&(k7.singleton=new k7),mQ.ruler=this.singleton,k7.singleton}}const A7=vX.UNOCCUPIED,N7=vX.INVADERS,M7=vX.DEFENDERS,x7=vX.PLAYER_ONE_KING;class R7{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`Tablut is a strategy game that was played by the Vikings.
        The goal of the game is different for each player.
        The attacker plays first. Its pieces (dark) are close to the edges.
        Its goal is to capture the king, which is in the center of the board.
        The defender plays second. Its pieces (light) are in the middle.
        Its goal is to move the king on one of the 4 thrones in the corners.
        Note that the square in which the king starts, in the center of the board, is also a throne.`,I7.getInitialState()),wQ.anyMove($localize`Moving`,$localize`All pieces move the same way.
        Similarly to a rook in chess, a piece can move:
        <ol>
            <li>By as many squares as you want.</li>
            <li>Without going over another piece or stopping on another piece.</li>
            <li>Horizontally or vertically.</li>
            <li>Only the king can land on a throne.</li>
        </ol>
        To move a piece, click on it and then on its landing square.<br/><br/>
        You're playing Dark, do the first move.`,I7.getInitialState(),O7.of(new GJ(4,1),new GJ(1,1)),$localize`Congratulations!`),wQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new I7([[A7,A7,A7,N7,N7,N7,A7,A7,A7],[A7,A7,A7,A7,N7,A7,A7,A7,A7],[A7,A7,A7,A7,M7,A7,A7,A7,A7],[A7,A7,A7,N7,M7,A7,A7,A7,N7],[N7,N7,M7,M7,x7,M7,M7,N7,N7],[A7,A7,A7,A7,M7,A7,A7,A7,N7],[A7,A7,A7,A7,M7,A7,A7,A7,A7],[A7,A7,A7,A7,N7,A7,A7,A7,A7],[A7,A7,A7,N7,N7,N7,A7,A7,A7]],1),[O7.of(new GJ(2,4),new GJ(2,3)),O7.of(new GJ(4,2),new GJ(3,2))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),wQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new I7([[A7,A7,A7,N7,N7,N7,A7,A7,A7],[A7,A7,A7,A7,N7,A7,A7,A7,A7],[A7,A7,A7,A7,M7,A7,A7,A7,A7],[A7,A7,M7,A7,x7,A7,M7,A7,N7],[N7,N7,A7,M7,A7,M7,M7,N7,N7],[A7,A7,A7,A7,M7,A7,A7,A7,N7],[A7,A7,A7,A7,M7,A7,A7,A7,A7],[A7,A7,A7,A7,N7,A7,A7,A7,A7],[A7,A7,A7,N7,N7,N7,A7,A7,A7]],12),[O7.of(new GJ(1,4),new GJ(2,4))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),wQ.fromMove($localize`Capturing the king (1/2)`,$localize`To capture the king, two soldiers are not enough.
        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.
        This also works if the king is on the throne.<br/><br/>
        Capture the king.`,new I7([[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,N7,A7,A7,A7,A7,A7,A7,A7],[N7,x7,A7,N7,A7,A7,A7,A7,A7],[A7,N7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7]],72),[O7.of(new GJ(3,4),new GJ(2,4))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),wQ.fromMove($localize`Capturing the king (2/2)`,$localize`Another way to capture the king is to immobilize it against an edge of the board.
        Note that the king cannot be captured next to a throne.<br/><br/>
        Capture the king.`,new I7([[A7,A7,N7,x7,N7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,N7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7],[A7,A7,A7,A7,A7,A7,A7,A7,A7]],72),[O7.of(new GJ(3,3),new GJ(3,1))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function D7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",6),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function L7(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",7),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function F7(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,D7,1,1,"polyline",4),aa(2,L7,1,1,"ng-template",null,5,Du),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ua("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function B7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(3,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(4,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(5,"line",11),Ca("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function V7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"polyline",13),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();Ts(1),ra("points",n.getKingPolyline(e,t))}}function U7(e,t){if(1&e){const e=ya();Cn(),da(0,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(1,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(2,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),da(3,"line",11),Ca("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function $7(e,t){if(1&e&&(Cn(),aa(0,V7,2,1,"g",9),aa(1,U7,4,16,"ng-template",null,12,Du)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ua("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function z7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"circle",8),Ca("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,B7,6,20,"g",9),aa(3,$7,3,2,"ng-template",null,10,Du),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ua("ngClass",r.getPieceClasses(t,n)),ra("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),ua("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function H7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",2),Ca("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),aa(2,F7,4,2,"g",3),aa(3,z7,5,6,"g",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Oa("id","click_",e,"_",n,""),ua("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ua("ngIf",r.board[n][e]===r.NONE&&r.isThrone(e,n)),Ts(1),ua("ngIf",r.board[n][e]!==r.NONE)}}function G7(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,H7,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function q7(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",14),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Oa("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let W7=(()=>{class e extends SX{constructor(e){super(e,!1,O7.from),this.rules=k7.get(),this.availableMinimaxes=[new PX(this.rules,"DummyBot"),new AX(this.rules,"Piece > Influence"),new NX(this.rules,"Piece > Control"),new MX(this.rules,"Escape > Piece > Control")],this.encoder=O7.encoder,this.tutorial=(new R7).tutorial,this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-tablut"]],features:[Ho],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,G7,2,1,"g",1),aa(2,q7,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ua("ngForOf",t.board),Ts(1),ua("ngForOf",t.getClickables()))},directives:[Ud,Bd,zd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class j7{}j7.PLACEMENT_AFTER_INITIAL_PHASE=()=>$localize`You cannot put a new ring after the tenth turn.`,j7.NO_MARKERS_IN_INITIAL_PHASE=()=>$localize`You cannot put a marker in a ring before placing all of your rings.`,j7.MISSING_CAPTURES=R2.MISSING_CAPTURES,j7.MOVE_DIRECTION_INVALID=()=>$localize`The direction of your move is invalid: a move is made along a straight line.`,j7.CAN_ONLY_CAPTURE_YOUR_MARKERS=()=>$localize`You can only capture your own markers.`,j7.SHOULD_SELECT_PLAYER_RING=()=>$localize`You must pick one of your own rings to move.`,j7.SHOULD_END_MOVE_ON_EMPTY_SPACE=()=>$localize`Your ring must land on an empty space.`,j7.MOVE_SHOULD_NOT_PASS_ABOVE_RING=()=>$localize`A ring can only jump over markers or empty spaces, not over another ring.`,j7.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=()=>$localize`Your ring must land on the first empty space after a group of markers.`,j7.AMBIGUOUS_CAPTURE_COORD=R2.AMBIGUOUS_CAPTURE_COORD,j7.CAPTURE_SHOULD_TAKE_RING=()=>$localize`When you capture markers, you must take one of your ring as well by clicking on it.`;class Z7{constructor(e,t){this.player=e,this.isRing=t}static of(e,t){return e===VY.NONE?Z7.EMPTY:t?Z7.RINGS[e.value]:Z7.MARKERS[e.value]}equals(e){return this===e}flip(){return MG(!1===this.isRing,"cannot flip a ring (it should never happen)"),MG(this.player!==VY.NONE,"cannot flip a non-piece (it should never happen)"),Z7.of(this.player.getOpponent(),this.isRing)}toString(){switch(this){case Z7.NONE:return"NONE";case Z7.EMPTY:return"EMPTY";case Z7.MARKER_ZERO:return"MARKER_ZERO";case Z7.MARKER_ONE:return"MARKER_ONE";case Z7.RING_ZERO:return"RING_ZERO";default:return fw.expectToBe(this,Z7.RING_ONE),"RING_ONE"}}}Z7.encoder=BY.tuple([VY.numberEncoder,BY.booleanEncoder],e=>[e.player,e.isRing],e=>Z7.of(e[0],e[1])),Z7.NONE=new Z7(VY.NONE,!1),Z7.EMPTY=new Z7(VY.NONE,!1),Z7.MARKER_ZERO=new Z7(VY.ZERO,!1),Z7.MARKER_ONE=new Z7(VY.ONE,!1),Z7.MARKERS=[Z7.MARKER_ZERO,Z7.MARKER_ONE],Z7.RING_ZERO=new Z7(VY.ZERO,!0),Z7.RING_ONE=new Z7(VY.ONE,!0),Z7.RINGS=[Z7.RING_ZERO,Z7.RING_ONE];let Y7=(()=>{class e extends p0{constructor(t,n,r){super(r,t,e.SIZE,e.SIZE,[6,4,3,2,1],Z7.EMPTY),this.sideRings=n}static getInitialState(){const t=Z7.EMPTY,n=Z7.NONE;return new e([[n,n,n,n,n,n,t,t,t,t,n],[n,n,n,n,t,t,t,t,t,t,t],[n,n,n,t,t,t,t,t,t,t,t],[n,n,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,n,n],[t,t,t,t,t,t,t,t,n,n,n],[t,t,t,t,t,t,t,n,n,n,n],[n,t,t,t,t,n,n,n,n,n,n]],[5,5],0)}isInitialPlacementPhase(){return this.turn<10}countScores(){return this.turn<10?[0,0]:this.sideRings}equals(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&LG.compareTable(this.board,e.board)}getRingCoords(e){const t=[];return this.forEachCoord((n,r)=>{r.isRing&&r.player===e&&t.push(n)}),t}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==Z7.NONE}setAtUnsafe(t,n){const r=LG.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.sideRings,this.turn)}}return e.SIZE=11,e})();class K7 extends A2{constructor(e,t){if(super(e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");this.ringTaken=vw.ofNullable(t)}static of(e,t,n){const r=[],i=KJ.factory.fromMove(e,t).get();for(let s=e;!1===s.equals(t);s=s.getNext(i))r.push(s);return r.push(t),new K7(r,n)}setRingTaken(e){return new K7(this.capturedSpaces,e)}equals(e){return!(!1===super.equals(e)||!1===this.ringTaken.equals(e.ringTaken))}}K7.encoder=new class extends LY{encode(e){return{captured:e.capturedSpaces.map(e=>GJ.encoder.encode(e)),ringTaken:GJ.encoder.encode(e.ringTaken.get())}}decode(e){const t=e;return MG(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new K7(t.captured.map(e=>GJ.encoder.decode(e)),GJ.encoder.decode(t.ringTaken))}};class J7 extends lQ{constructor(e,t,n,r){super(),this.initialCaptures=e,this.start=t,this.end=n,this.finalCaptures=r}isInitialPlacement(){return this.end.isAbsent()}equals(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===LG.compareArray(this.initialCaptures,e.initialCaptures)||!1===LG.compareArray(this.finalCaptures,e.finalCaptures))}toString(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}}J7.coordOptionalEncoder=k2(GJ.encoder),J7.encoder=new class extends FY{encodeMove(e){const t={moveStart:GJ.encoder.encode(e.start),moveEnd:J7.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=K7.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=K7.encoder.encode(e)}),t}decodeMove(e){const t=e;return MG(null!=t.moveStart,"Invalid encoded YinshMove"),new J7(this.decodeArray(t,"initialCapture",K7.encoder.decode),GJ.encoder.decode(t.moveStart),J7.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",K7.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class Q7 extends nQ{getBoardValue(e){const t=this.ruler.getGameStatus(e);return t.isEndGame?rQ.fromWinner(t.winner):new rQ(e.gameState.sideRings[0]*VY.ZERO.getScoreModifier()+e.gameState.sideRings[1]*VY.ONE.getScoreModifier())}getListMoves(e){const t=[],n=e.gameState;if(n.isInitialPlacementPhase())for(const[r,i]of n.getCoordsAndContents())i===Z7.EMPTY&&t.push(new J7([],r,vw.empty(),[]));else{const e=this.ruler;this.getPossibleCaptureCombinations(n).forEach(r=>{const i=e.applyCaptures(n,r);this.getRingMoves(i).forEach(n=>{const s=e.applyRingMoveAndFlip(i,n.start,n.end);this.getPossibleCaptureCombinations(s).forEach(e=>{const i=new J7(r,n.start,vw.of(n.end),e);t.push(i)})})})}return t}getPossibleCaptureCombinations(e){const t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return L2.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(e=>class{static getCombinations(e,t){return MG(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(e=>this.getPermutations(e)).reduce((e,t)=>e.concat(t))}static getPermutations(e){const t=e.length,n=[e.slice()],r=new Array(t).fill(0);let i=1;for(;i<t;)if(r[i]<i){const t=i%2&&r[i],s=e[i];e[i]=e[t],e[t]=s,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}static getSubsetsOfSize(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];{const i=[];for(;r<=e.length-n;){const s=e[r];for(const e of t(n-1,r+1))e.push(s),i.push(e);++r}return i}}(t,0)}}.getCombinations(n,e.length).map(t=>e.map((e,n)=>new K7(e.capturedSpaces,t[n])))).reduce((e,t)=>e.concat(t),[])}getRingMoves(e){const t=this.ruler,n=[];for(const r of this.getRingCoords(e))for(const i of t.getRingTargets(e,r))n.push({start:r,end:i});return n}getRingCoords(e){const t=e.getCurrentPlayer().value,n=[];return e.forEachCoord((e,r)=>{r===Z7.RINGS[t]&&n.push(e)}),n}}class X7 extends vQ{applyLegalMove(e,t,n){return new Y7(n.board,n.sideRings,n.turn+1)}applyCaptures(e,t){let n=e;return t.forEach(e=>{n=this.applyCapture(n,e)}),n}applyCapture(e,t){const n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new Y7(n,e.sideRings,e.turn),t.ringTaken.get())}takeRing(e,t){const n=e.getCurrentPlayer().value,r=e.setAt(t,Z7.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new Y7(r,i,e.turn)}applyCaptureWithoutTakingRing(e,t){return t.forEach(t=>{e=e.setAt(t,Z7.EMPTY)}),e.board}ringSelectionValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)===Z7.RINGS[n]?kG.SUCCESS:kG.failure(j7.CAPTURE_SHOULD_TAKE_RING())}applyRingMoveAndFlip(e,t,n){const r=e.getCurrentPlayer().value;let i=e.setAt(t,Z7.MARKERS[r]);i=i.setAt(n,Z7.RINGS[r]);const s=KJ.factory.fromMove(t,n).get();for(let o=t.getNext(s);!1===o.equals(n);o=o.getNext(s)){const e=i.getPieceAt(o);e!==Z7.EMPTY&&(i=i.setAt(o,e.flip()))}return i}isLegal(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return OG.failure(j7.NO_MARKERS_IN_INITIAL_PHASE());const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();const s=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(s,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();const a=this.applyCaptures(s,e.finalCaptures),c=this.noMoreCapturesValidity(a);return c.isFailure()?c.toFailedFallible():OG.success(a)}initialPlacementValidity(e,t){if(!0!==e.isInitialPlacementPhase())return OG.failure(j7.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==Z7.EMPTY)return OG.failure(tQ.MUST_CLICK_ON_EMPTY_SPACE());const n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;const i=e.setAt(t,Z7.of(n,!0)).board,s=new Y7(i,r,e.turn);return OG.success(s)}moveStartValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==Z7.RINGS[n]?kG.failure(j7.SHOULD_SELECT_PLAYER_RING()):kG.SUCCESS}moveValidity(e,t,n){const r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==Z7.EMPTY)return kG.failure(j7.SHOULD_END_MOVE_ON_EMPTY_SPACE());const i=KJ.factory.fromMove(t,n);if(i.isFailure())return kG.failure(j7.MOVE_DIRECTION_INVALID());const s=i.get();let o=!1;for(let a=t.getNext(s);!1===a.equals(n);a=a.getNext(s)){const t=e.getPieceAt(a);if(t===Z7.EMPTY){if(o)return kG.failure(j7.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(t.isRing)return kG.failure(j7.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return kG.SUCCESS}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=this.applyCapture(n,r)}return kG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer().value;for(const r of t.capturedSpaces)if(e.getPieceAt(r)!==Z7.MARKERS[n])return kG.failure(j7.CAN_ONLY_CAPTURE_YOUR_MARKERS());return e.getPieceAt(t.ringTaken.get())!==Z7.RINGS[n]?kG.failure(j7.CAPTURE_SHOULD_TAKE_RING()):kG.SUCCESS}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?kG.SUCCESS:kG.failure(j7.MISSING_CAPTURES())}getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=this.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o,a=i;for(o=i;e.isOnBoard(o);o=o.getNext(s)){const n=e.getPieceAt(o);if(n.player===t&&!1===n.isRing)0===r&&(a=o),r+=1;else{if(r>=5)break;r=0}}return r>=5?vw.of({start:a,end:o,dir:s}):vw.empty()}getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(e=>{for(let t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(K7.of(t,t.getNext(e.dir,4)))}),n}getRingTargets(e,t){const n=[];for(const r of KJ.factory.all){let i=!1;for(let s=t.getNext(r);e.isOnBoard(s);s=s.getNext(r)){const t=e.getPieceAt(s);if(t===Z7.EMPTY){if(n.push(s),i)break}else{if(t.isRing)break;i=!0}}}return n}getGameStatus(e){return e.gameState.isInitialPlacementPhase()?yQ.ONGOING:e.gameState.sideRings[0]>=3?yQ.ZERO_WON:e.gameState.sideRings[1]>=3?yQ.ONE_WON:yQ.ONGOING}}const e9=Z7.EMPTY,t9=Z7.NONE,n9=Z7.MARKER_ZERO,r9=Z7.RING_ZERO,i9=Z7.MARKER_ONE,s9=Z7.RING_ONE;let o9=(()=>{class e{}return e.MUST_ALIGN_FIVE=()=>$localize`Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time.`,e.MUST_CAPTURE_TWO=()=>$localize`Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again.`,e})();class a9{constructor(){this.tutorial=[wQ.informational($localize`Goal of the game`,$localize`The goal at Yinsh is to capture three rings in total.
        The rings taken are shown on the top left for the dark player,
        and on the bottom right for the light player. Here, Dark won the game.
        Note that on the board you have two types of pieces for each player:
        rings (empty circles) and markers (full circles).`,new Y7([[t9,t9,t9,t9,t9,t9,e9,e9,e9,e9,t9],[t9,t9,t9,t9,e9,e9,e9,e9,e9,e9,e9],[t9,t9,t9,n9,s9,e9,e9,e9,e9,e9,e9],[t9,t9,e9,n9,e9,s9,e9,i9,e9,e9,e9],[t9,e9,r9,i9,e9,e9,s9,n9,e9,e9,e9],[t9,e9,e9,n9,i9,e9,e9,e9,e9,e9,t9],[e9,e9,e9,n9,e9,e9,e9,s9,e9,e9,t9],[e9,e9,e9,i9,n9,r9,e9,e9,e9,t9,t9],[e9,e9,e9,e9,e9,e9,e9,e9,t9,t9,t9],[e9,e9,e9,e9,e9,e9,e9,t9,t9,t9,t9],[t9,e9,e9,e9,e9,t9,t9,t9,t9,t9,t9]],[3,1],20)),wQ.anyMove($localize`Initial board and placement phase`,$localize`The initial board is empty.
        At the beginning of the game, each player puts one of its ring on the board at their turn.
        This phase stops when all rings have been placed on the board.
        Put one of your ring on the board by clicking the space where you want to place it.`,new Y7(Y7.getInitialState().board,[5,5],0),new J7([],new GJ(5,5),vw.empty(),[]),$localize`Congratulations!`),wQ.anyMove($localize`Putting a marker`,$localize`Once the initial phase is done and all rings are on the board, you need to place markers on the board.
        To do so, put a marker in a ring by clicking on that ring.
        Then, the ring must be moved in a straight line, in any direction.
        A ring cannot pass through other rings during its move.
        If it goes over a group of markers, your move must stop at the first empty space after that group.
        All markers in the group are then flipped and their color change.<br/><br/>
        You're playing Dark, do a move.`,new Y7([[t9,t9,t9,t9,t9,t9,e9,e9,e9,e9,t9],[t9,t9,t9,t9,e9,e9,e9,e9,e9,e9,e9],[t9,t9,t9,s9,e9,e9,e9,e9,e9,e9,e9],[t9,t9,s9,e9,e9,s9,e9,e9,e9,e9,e9],[t9,e9,r9,i9,e9,e9,s9,e9,e9,e9,e9],[t9,e9,e9,i9,e9,e9,e9,e9,e9,e9,t9],[e9,e9,e9,e9,r9,e9,e9,s9,e9,e9,t9],[e9,e9,e9,e9,e9,r9,e9,e9,e9,t9,t9],[e9,e9,e9,r9,e9,e9,e9,t9,t9,t9,t9],[e9,e9,e9,e9,e9,e9,e9,t9,t9,t9,t9],[t9,e9,e9,e9,e9,t9,t9,t9,t9,t9,t9]],[0,0],20),new J7([],new GJ(2,4),vw.of(new GJ(4,4)),[]),$localize`Congratulations!`),wQ.fromPredicate($localize`Getting a ring by aligning 5 markers`,$localize`Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.
        To do so, you need to align 5 markers of your color.
        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.
        You will then have one more point.
        You must capture when you can.<br/><br/>
        You're playing Dark, perform a capture!`,new Y7([[t9,t9,t9,t9,t9,t9,e9,e9,e9,e9,t9],[t9,t9,t9,t9,e9,e9,e9,e9,e9,e9,e9],[t9,t9,t9,s9,e9,e9,e9,e9,e9,e9,e9],[t9,t9,s9,e9,e9,s9,e9,e9,e9,e9,e9],[t9,e9,n9,n9,r9,i9,i9,e9,e9,e9,e9],[t9,e9,e9,s9,e9,e9,e9,e9,e9,e9,t9],[e9,e9,e9,e9,r9,e9,e9,s9,e9,e9,t9],[e9,e9,e9,e9,e9,r9,e9,e9,e9,t9,t9],[e9,e9,e9,r9,e9,e9,e9,r9,t9,t9,t9],[e9,e9,e9,e9,e9,e9,e9,t9,t9,t9,t9],[t9,e9,e9,e9,e9,t9,t9,t9,t9,t9,t9]],[0,0],20),new J7([],new GJ(4,4),vw.of(new GJ(7,4)),[K7.of(new GJ(2,4),new GJ(6,4),new GJ(7,4))]),(e,t)=>1===t.sideRings[VY.ZERO.value]?kG.SUCCESS:kG.failure(o9.MUST_ALIGN_FIVE()),$localize`Congratulations!`),wQ.fromPredicate($localize`Compound captures`,$localize`During a turn, you could have to choose between multiple captures,
        or you could even capture multiple times!
        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>
        Here, you can capture two rings, do it!`,new Y7([[t9,t9,t9,t9,t9,t9,e9,e9,e9,e9,t9],[t9,t9,t9,t9,r9,e9,e9,s9,s9,r9,e9],[t9,t9,t9,r9,e9,e9,i9,s9,e9,r9,e9],[t9,t9,e9,r9,e9,e9,e9,e9,e9,s9,e9],[t9,e9,e9,e9,e9,n9,e9,e9,s9,e9,e9],[t9,e9,e9,e9,n9,n9,e9,i9,e9,e9,t9],[e9,e9,e9,n9,e9,n9,e9,e9,e9,e9,t9],[e9,e9,n9,e9,e9,n9,e9,e9,e9,t9,t9],[e9,n9,e9,e9,e9,n9,e9,e9,t9,t9,t9],[e9,e9,e9,e9,e9,n9,e9,t9,t9,t9,t9],[t9,e9,e9,e9,e9,t9,t9,t9,t9,t9,t9]],[0,0],10),new J7([K7.of(new GJ(5,4),new GJ(1,8),new GJ(3,2)),K7.of(new GJ(5,9),new GJ(5,5),new GJ(3,3))],new GJ(4,1),vw.of(new GJ(4,2)),[]),(e,t)=>2===t.sideRings[VY.ZERO.value]?kG.SUCCESS:kG.failure(o9.MUST_CAPTURE_TWO()),$localize`Congratulations!`)]}}function c9(e,t){if(1&e&&(Cn(),pa(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringOuterSize)}}function l9(e,t){if(1&e&&(Cn(),pa(0,"circle",10)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Oa("id","ring_",t,"_",r,""),ua("ngClass",n.ringClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.ringMidSize)}}function u9(e,t){if(1&e&&(Cn(),pa(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringInnerSize)}}function h9(e,t){if(1&e&&(Cn(),pa(0,"circle",11)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Oa("id","marker_",t,"_",r,""),ua("ngClass",n.markerClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.markerSize)}}function d9(e,t){if(1&e){const e=ya();Cn(),da(0,"g",3),Ca("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),pa(1,"polyline",4),da(2,"g",5),aa(3,c9,1,3,"circle",6),aa(4,l9,1,6,"circle",7),aa(5,u9,1,3,"circle",6),aa(6,h9,1,6,"circle",8),fa(),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index;Oa("id","click_",t,"_",r,""),Ts(1),Oa("id","space_",t,"_",r,""),ua("ngClass",n.spaceClasses),ra("points",n.coordinates),Ts(1),Oa("id","pieceGroup_",t,"_",r,""),ua("ngClass",n.removedClass),Ts(1),ua("ngIf",n.isRing),Ts(1),ua("ngIf",n.isRing),Ts(1),ua("ngIf",n.isRing),Ts(1),ua("ngIf",n.isMarker)}}function f9(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,d9,7,13,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngIf",null!=e)}}function p9(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,f9,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}function g9(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"polyline",12),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Oa("id","selected_",e.x,"_",e.y,""),ra("points",n.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function m9(e,t){if(1&e){const e=ya();Cn(),da(0,"polyline",14),Ca("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t)}),fa()}if(2&e){const e=ba().$implicit,t=ba();Oa("id","selectable_",e.x,"_",e.y,""),ra("points",t.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function y9(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,m9,1,3,"polyline",13),fa()),2&e){const e=ba();Ts(1),ua("ngIf",e.isPlayerTurn())}}function v9(e,t){if(1&e){const e=ya();Cn(),da(0,"g"),da(1,"rect",15),Ca("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.viewInfo.spaceInfo[e.y][e.x].center.x-n.viewInfo.indicatorSize/2)("y",n.viewInfo.spaceInfo[e.y][e.x].center.y-n.viewInfo.indicatorSize/2)("width",n.viewInfo.indicatorSize)("height",n.viewInfo.indicatorSize)}}function _9(e,t){if(1&e&&(Cn(),da(0,"g"),pa(1,"circle",16),pa(2,"circle",9),pa(3,"circle",17),fa()),2&e){const e=t.index,n=ba().$implicit,r=ba();Ts(1),Oa("id","player_",n,"_sideRing_",e+1,""),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringOuterSize),Ts(1),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringInnerSize),Ts(1),ua("ngClass",r.viewInfo.sideRingClass[n]),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringMidSize)}}const C9=function(){return[]};function E9(e,t){if(1&e&&(Cn(),da(0,"g"),aa(1,_9,4,12,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ua("ngForOf",ou(1,C9).constructor(n.viewInfo.sideRings[e]))}}const w9=function(){return[0,1]};class b9 extends ZJ{constructor(e){super(e),this.movePhase="MOVE_START",this.moveStart=vw.empty(),this.moveEnd=vw.empty(),this.currentlyMoved=[],this.currentCapture=vw.empty(),this.initialCaptures=[],this.finalCaptures=[],this.possibleCaptures=[],this.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:b9.MARKER_SIZE,ringOuterSize:b9.RING_OUTER_SIZE,ringMidSize:b9.RING_MID_SIZE,ringInnerSize:b9.RING_INNER_SIZE,indicatorSize:b9.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},this.scores=vw.of([0,0]),this.rules=new X7(Y7),this.availableMinimaxes=[new Q7(this.rules,"YinshMinimax")],this.encoder=J7.encoder,this.tutorial=(new a9).tutorial,this.hexaLayout=new JJ(1.5*b9.RING_OUTER_SIZE,new GJ(2*b9.RING_OUTER_SIZE,0),eQ.INSTANCE),this.constructedState=this.rules.node.gameState,this.constructedState.allCoords().forEach(e=>{null==this.viewInfo.spaceInfo[e.y]&&(this.viewInfo.spaceInfo[e.y]=[]),this.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:this.getHexaCoordsAt(e),center:this.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}})}updateBoard(){this.cancelMoveAttempt(),this.scores=vw.of(this.rules.node.gameState.countScores())}updateViewInfo(){this.constructedState.allCoords().forEach(e=>{this.viewInfo.spaceInfo[e.y][e.x].spaceClasses=this.getSpaceClasses(e);const t=this.constructedState.getPieceAt(e);this.viewInfo.spaceInfo[e.y][e.x].removedClass="",this.setRingInfo(e,t),this.setMarkerInfo(e,t)});for(const e of[VY.ZERO,VY.ONE])this.viewInfo.sideRings[e.value]=this.constructedState.sideRings[e.value];switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];for(const e of this.possibleCaptures)for(const t of e.capturedSpaces)this.viewInfo.selectableCoords.push(t);break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}showCurrentMoveCaptures(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());for(const e of this.initialCaptures)this.markCurrentCapture(e);for(const e of this.finalCaptures)this.markCurrentCapture(e)}getSpaceClasses(e){return this.currentlyMoved.some(t=>t.equals(e))?["moved"]:[]}setRingInfo(e,t){if(t.isRing){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}setMarkerInfo(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==Z7.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=vw.empty(),this.moveStart=vw.empty(),this.moveEnd=vw.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}showLastMove(){const e=this.rules.node.move;if(e.isPresent()){const t=e.get();if(t.isInitialPlacement())this.viewInfo.spaceInfo[t.start.y][t.start.x].spaceClasses=["moved"];else{for(const n of this.coordsBetween(t.start,t.end.get()))this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["moved"];const e=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();t.initialCaptures.forEach(t=>this.showLastMoveCapture(t,e)),t.finalCaptures.forEach(t=>this.showLastMoveCapture(t,e))}}}coordsBetween(e,t){const n=[],r=KJ.factory.fromMove(e,t).get();for(let i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==Z7.EMPTY&&n.push(i),n.push(t);return n}showLastMoveCapture(e,t){for(const n of e.capturedSpaces)this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["captured"],t&&this.markRemovedMarker(n,this.rules.node.gameState.getCurrentPlayer().getOpponent());this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}moveToInitialCaptureOrMovePhase(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),kG.SUCCESS}onClick(e){var t=this;return dw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());switch(t.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_FIRST":return t.selectCaptureFirstCoord(e);case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_LAST":return t.selectCaptureLastCoord(e);case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":return t.selectRing(e);case"MOVE_START":return t.selectMoveStart(e);case"MOVE_END":return t.selectMoveEnd(e)}})()}selectCaptureFirstCoord(e){var t=this;return dw(function*(){const n=[];if(t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1)t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(n);else{if(0===n.length)return t.cancelMove(j7.MISSING_CAPTURES());t.selectCapture(n[0])}return kG.SUCCESS})()}moveToCaptureSelectLast(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;for(const t of e)for(const e of t.capturedSpaces)this.viewInfo.selectableCoords.push(e);switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}selectCaptureLastCoord(e){var t=this;return dw(function*(){const n=[];return t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1?t.cancelMove(j7.AMBIGUOUS_CAPTURE_COORD()):0===n.length?t.cancelMove(j7.MISSING_CAPTURES()):t.selectCapture(n[0])})()}selectCapture(e){switch(this.currentCapture=vw.of(e),this.constructedState=new Y7(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),kG.SUCCESS}markCurrentCapture(e){for(const t of e.capturedSpaces)this.viewInfo.selectedCoords.push(t),this.markRemovedMarker(t,this.rules.node.gameState.getCurrentPlayer());e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}markRemovedMarker(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setMarkerInfo(e,Z7.MARKERS[t.value])}markRemovedRing(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setRingInfo(e,Z7.RINGS[t.value])}selectRing(e){var t=this;return dw(function*(){const n=t.rules.ringSelectionValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.constructedState=t.rules.takeRing(t.constructedState,e);const r=t.currentCapture.get().setRingTaken(e);switch(t.currentCapture=vw.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase){case"INITIAL_CAPTURE_SELECT_RING":return t.initialCaptures.push(r),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),kG.SUCCESS);default:return fw.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(r),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),kG.SUCCESS)}})()}moveToMovePhase(){return this.movePhase="MOVE_START",this.updateViewInfo(),kG.SUCCESS}tryMove(){var e=this;return dw(function*(){const t=new J7(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures);return yield e.chooseMove(t,e.rules.node.gameState,e.scores.get())})()}selectMoveStart(e){var t=this;return dw(function*(){if(t.constructedState.isInitialPlacementPhase()){const n=t.rules.initialPlacementValidity(t.constructedState,e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveStart=vw.of(e),t.tryMove())}{const n=t.rules.moveStartValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.moveStart=vw.of(e),t.movePhase="MOVE_END",t.updateViewInfo()}return kG.SUCCESS})()}selectMoveEnd(e){var t=this;return dw(function*(){const n=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveEnd=vw.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove())})()}moveToFinalCapturePhaseOrTryMove(){var e=this;return dw(function*(){return e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),kG.SUCCESS)})()}}function S9(e,t){if(1&e&&(da(0,"option",5),Da(1),fa()),2&e){const e=t.$implicit;ua("value",e),Ts(1),La(e)}}b9.RING_OUTER_SIZE=40,b9.RING_MID_SIZE=34,b9.RING_INNER_SIZE=28,b9.MARKER_SIZE=b9.RING_INNER_SIZE,b9.INDICATOR_SIZE=10,b9.\u0275fac=function(e){return new(e||b9)(la(WJ))},b9.\u0275cmp=Xe({type:b9,selectors:[["app-yinsh"]],features:[Ho],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),da(0,"svg",0),aa(1,p9,2,1,"g",1),aa(2,g9,2,3,"g",1),aa(3,y9,2,1,"g",1),aa(4,v9,2,4,"g",1),aa(5,E9,2,2,"g",1),fa()),2&e&&(Ts(1),ua("ngForOf",t.viewInfo.spaceInfo),Ts(1),ua("ngForOf",t.viewInfo.selectedCoords),Ts(1),ua("ngForOf",t.viewInfo.selectableCoords),Ts(1),ua("ngForOf",t.viewInfo.targets),Ts(1),ua("ngForOf",ou(5,w9)))},directives:[Ud,zd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let P9=(()=>{class e{}return e.ABALONE=()=>$localize`Use simple mechanics to push 6 of the opponent's pieces out of the board!`,e.APAGOS=()=>$localize`Very simple game, but, will you be able to win everytime?`,e.AWALE=()=>$localize`The international version of the famous African strategy game!`,e.BRANDHUB=()=>$localize`The Irish version of the Tafl game family!`,e.COERCEO=()=>$localize`Get rid of all of your opponent's pieces on a board that shrinks little by little!`,e.CONSPIRATEURS=()=>$localize`Hide all of your pieces before your opponent does, or risk to be discovered!`,e.DIAM=()=>$localize`Drop your pieces and move them around to align two pieces of the same color across the board to win!`,e.DVONN=()=>$localize`Stack your pieces and control as many stacks as you can to win!`,e.ENCAPSULE=()=>$localize`An enhanced tic-tac-toe where piece can encapsule other and prevent them to win.`,e.EPAMINONDAS=()=>$localize`An antiquity-war inspired game. Be the first to pierce your opponent's lines!`,e.GIPF=()=>$localize`A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!`,e.GO=()=>$localize`The oldest strategy game still practiced widely. A territory control game.`,e.KAMISADO=()=>$localize`Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!`,e.LINES_OF_ACTION=()=>$localize`Regroup your pieces to win. But your possible moves will often change!`,e.P4=()=>$localize`The classical 4 in a row game!`,e.PENTAGO=()=>$localize`Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!`,e.PYLOS=()=>$localize`Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!`,e.QUARTO=()=>$localize`Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!`,e.QUIXO=()=>$localize`Align 5 of your pieces on a board where pieces slide!`,e.REVERSI=()=>$localize`Sandwich your opponent's pieces to dominate the board!`,e.SAHARA=()=>$localize`Immobilize one of your opponent's pyramids before your opponent does!`,e.SIAM=()=>$localize`Be the first to push a mountain out of the board!`,e.SIX=()=>$localize`Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!`,e.TABLUT=()=>$localize`The Viking board game! Invaders must capture the king, defender must make him escape!`,e.YINSH=()=>$localize`Align your pieces to score points, but beware, pieces can flip!`,e})(),O9=(()=>{class e{constructor(e,t,n,r,i,s=!0){this.name=e,this.urlName=t,this.component=n,this.creationDate=r,this.description=i,this.display=s}}return e.ALL_GAMES=()=>[new e("MinimaxTesting","MinimaxTesting",A4,new Date("1970-01-01"),"",!1),new e($localize`Four in a Row`,"P4",q4,new Date("2018-08-28"),P9.P4()),new e($localize`Awalé`,"Awale",dX,new Date("2018-11-29"),P9.AWALE()),new e($localize`Quarto`,"Quarto",P6,new Date("2018-12-09"),P9.QUARTO()),new e($localize`Tablut`,"Tablut",W7,new Date("2018-12-27"),P9.TABLUT()),new e($localize`Reversi`,"Reversi",e8,new Date("2019-01-16"),P9.REVERSI()),new e($localize`Go`,"Go",O3,new Date("2019-12-21"),P9.GO()),new e($localize`Encapsule`,"Encapsule",d2,new Date("2019-12-30"),P9.ENCAPSULE()),new e($localize`Siam`,"Siam",n7,new Date("2020-01-11"),P9.SIAM()),new e($localize`Sahara`,"Sahara",_8,new Date("2020-02-29"),P9.SAHARA()),new e($localize`Pylos`,"Pylos",R5,new Date("2020-10-02"),P9.PYLOS()),new e($localize`Kamisado`,"Kamisado",s4,new Date("2020-10-03"),P9.KAMISADO()),new e($localize`Quixo`,"Quixo",U6,new Date("2020-10-15"),P9.QUIXO()),new e($localize`Dvonn`,"Dvonn",z0,new Date("2020-10-21"),P9.DVONN()),new e($localize`Epaminondas`,"Epaminondas",I2,new Date("2021-01-16"),P9.EPAMINONDAS()),new e($localize`Gipf`,"Gipf",Q2,new Date("2021-02-22"),P9.GIPF()),new e($localize`Coerceo`,"Coerceo",S1,new Date("2021-03-21"),P9.COERCEO()),new e($localize`Six`,"Six",P7,new Date("2021-04-08"),P9.SIX()),new e($localize`Lines of Action`,"LinesOfAction",_4,new Date("2021-04-28"),P9.LINES_OF_ACTION()),new e($localize`Pentago`,"Pentago",h5,new Date("2021-05-23"),P9.PENTAGO()),new e($localize`Abalone`,"Abalone",$Q,new Date("2021-07-13"),P9.ABALONE()),new e($localize`Yinsh`,"Yinsh",b9,new Date("2021-07-31"),P9.YINSH()),new e($localize`Apagos`,"Apagos",nX,new Date("2021-11-04"),P9.APAGOS()),new e($localize`Diam`,"Diam",d0,new Date("2021-11-30"),P9.DIAM()),new e($localize`Brandhub`,"Brandhub",YX,new Date("2021-12-07"),P9.BRANDHUB()),new e($localize`Conspirateurs`,"Conspirateurs",q1,new Date("2021-12-30"),P9.CONSPIRATEURS())].sort((e,t)=>e.name.localeCompare(t.name)),e})(),T9=(()=>{class e{constructor(){this.gameNameList=O9.ALL_GAMES().filter(e=>!0===e.display).map(e=>e.urlName),this.pickGame=new _u}onChange(e){this.pickGame.emit(e.target.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){let e;return e=$localize`Pick a game`,[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],e,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"select",1),Ca("change",function(e){return t.onChange(e)}),da(2,"option",2),Hc(3,3),fa(),aa(4,S9,2,2,"option",4),fa(),fa()),2&e&&(Ts(4),ua("ngForOf",t.gameNameList))},directives:[dg,mg,Ud],encapsulation:2}),e})();function I9(e,t){if(1&e){const e=ya();da(0,"div",26),da(1,"div",27),Ca("click",function(){return Gt(e),ba().closeInfo()}),fa(),da(2,"div",28),da(3,"header",29),da(4,"p",30),Da(5),fa(),da(6,"button",31),Ca("click",function(){return Gt(e),ba().closeInfo()}),fa(),fa(),da(7,"section",32),da(8,"div",6),da(9,"div",33),da(10,"p",34),pa(11,"img",35),fa(),fa(),da(12,"div",7),da(13,"div",13),Da(14),fa(),fa(),fa(),da(15,"div",6),da(16,"div",33),da(17,"a",36),Ca("click",function(){Gt(e);const t=ba();return t.createGame(t.gameInfoDetails.get().urlName)}),pa(18,"fa-icon",37),Da(19,"\xa0"),da(20,"span"),Hc(21,38),fa(),fa(),fa(),da(22,"div",33),da(23,"a",36),Ca("click",function(){Gt(e);const t=ba();return t.createLocalGame(t.gameInfoDetails.get().urlName)}),pa(24,"fa-icon",37),Da(25,"\xa0"),da(26,"span"),Hc(27,39),fa(),fa(),fa(),da(28,"div",33),da(29,"a",36),Ca("click",function(){Gt(e);const t=ba();return t.createTutorial(t.gameInfoDetails.get().urlName)}),pa(30,"fa-icon",37),Da(31,"\xa0"),da(32,"span"),Hc(33,40),fa(),fa(),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba();Ts(5),La(e.gameInfoDetails.get().name),Ts(6),Oa("src","assets/images/",e.theme,"/",e.gameInfoDetails.get().urlName,".png",_i),Ts(3),Fa(" ",e.gameInfoDetails.get().description," "),Ts(4),ua("icon",e.iconOnlineGame),Ts(6),ua("icon",e.iconLocalGame),Ts(6),ua("icon",e.iconTutorial)}}function k9(e,t){if(1&e){const e=ya();da(0,"div",8),da(1,"div",9),da(2,"p",10),Da(3),fa(),fa(),da(4,"div",42),da(5,"figure",34),da(6,"img",43),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),fa(),da(7,"figcaption",44),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),da(8,"div",45),Da(9,"?"),fa(),fa(),da(10,"figcaption",46),da(11,"a",47),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).createGame(t.urlName)}),pa(12,"fa-icon",37),fa(),da(13,"a",48),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).createLocalGame(t.urlName)}),pa(14,"fa-icon",37),fa(),da(15,"a",49),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).createTutorial(t.urlName)}),pa(16,"fa-icon",37),fa(),fa(),fa(),fa(),da(17,"div",50),Da(18),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(3),La(e.name),Ts(3),Pa("id","image_",e.urlName,""),Oa("src","assets/images/",n.theme,"/",e.urlName,".png",_i),Ts(5),Pa("id","playOnline_",e.urlName,""),Ts(1),ua("icon",n.iconOnlineGame),Ts(1),Pa("id","playLocally_",e.urlName,""),Ts(1),ua("icon",n.iconLocalGame),Ts(1),Pa("id","startTutorial_",e.urlName,""),Ts(1),ua("icon",n.iconTutorial),Ts(2),Fa(" ",e.description," ")}}function A9(e,t){if(1&e&&(da(0,"div",7),aa(1,k9,19,11,"div",41),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngForOf",e)}}let N9=(()=>{class e{constructor(e,t){this.router=e,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=XY,this.iconLocalGame=JY,this.iconTutorial=YY,this.gameInfoDetails=vw.empty(),this.theme=t.getTheme();const n=O9.ALL_GAMES().filter(e=>!0===e.display);let r=0;for(let i=0;i<n.length;i++)i<this.numberOfColumns&&this.games.push([]),this.games[r].push(n[i]),r=(r+1)%this.numberOfColumns}createGame(e){var t=this;return dw(function*(){return t.router.navigate(["/play",e])})()}createLocalGame(e){var t=this;return dw(function*(){return t.router.navigate(["/local",e])})()}createTutorial(e){return this.router.navigate(["/tutorial",e])}openInfo(e){this.gameInfoDetails=vw.of(e)}closeInfo(){this.gameInfoDetails=vw.empty()}}return e.\u0275fac=function(t){return new(t||e)(la(t_),la(ZY))},e.\u0275cmp=Xe({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`EveryBoard`,t=$localize`EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.${"\ufffd#6\ufffd\ufffd/#6\ufffd"}:LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn.`,n=$localize`Play online`,r=$localize`Create an online game`,i=$localize`See the game list`,s=$localize`Play offline`,o=$localize`Play`,a=$localize`Learn`,c=$localize`Play online`,l=$localize`Play offline`,u=$localize`Learn the rules`,h=$localize`Play online`,d=$localize`Play offline`,f=$localize`Learn the rules`,[[1,"hero"],[1,"hero-body"],[1,"title"],e,[1,"subtitle"],t,[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],n,[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],r,["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],i,s,[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],o,["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],a,["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],c,l,u,["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",h,1,"button",3,"id","click"],["data-tooltip",d,1,"button",3,"id","click"],["data-tooltip",f,1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(da(0,"section",0),da(1,"div",1),da(2,"p",2),Hc(3,3),fa(),da(4,"p",4),$c(5,5),pa(6,"br"),zc(),fa(),fa(),da(7,"div",6),da(8,"div",7),da(9,"div",8),da(10,"header",9),da(11,"p",10),Hc(12,11),fa(),fa(),da(13,"div",12),da(14,"div",13),da(15,"button",14),Hc(16,15),fa(),da(17,"button",16),Hc(18,17),fa(),fa(),fa(),fa(),fa(),da(19,"div",7),da(20,"div",8),da(21,"header",9),da(22,"p",10),Hc(23,18),fa(),fa(),da(24,"div",12),da(25,"div",19),da(26,"button",20),Hc(27,21),fa(),da(28,"button",22),Hc(29,23),fa(),fa(),fa(),fa(),fa(),fa(),aa(30,I9,34,7,"div",24),da(31,"div",6),aa(32,A9,2,1,"div",25),fa(),fa()),2&e&&(Ts(30),ua("ngIf",t.gameInfoDetails.isPresent()),Ts(2),ua("ngForOf",t.games))},directives:[r_,zd,Ud,PJ],encapsulation:2}),e})(),M9=(()=>{class e{constructor(e){this.element=e}ngAfterViewInit(){this.element.nativeElement.focus()}}return e.\u0275fac=function(t){return new(t||e)(la(al))},e.\u0275dir=st({type:e,selectors:[["","autofocus",""]]}),e})(),x9=(()=>{class e{constructor(e){this.shown=!1,this.input=e.nativeElement.parentNode.previousSibling,e.nativeElement.addEventListener("click",e=>{this.toggle()})}toggle(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}return e.\u0275fac=function(t){return new(t||e)(la(al))},e.\u0275dir=st({type:e,selectors:[["","toggleVisibility",""]]}),e})();function R9(e,t){if(1&e&&(da(0,"div",29),da(1,"div",30),Hc(2,31),fa(),da(3,"div",32),Da(4),fa(),fa()),2&e){const e=ba();Ts(4),La(e.errorMessage)}}const D9=function(){return["/register"]},L9=function(){return["/reset-password"]};let F9=(()=>{class e{constructor(e,t){this.router=e,this.authenticationService=t,this.faEye=QY,this.loginForm=new Wp({email:new qp,password:new qp})}ngOnInit(){var e=this;this.authenticationService.getUserObs().subscribe(function(){var t=dw(function*(t){t!==NY.NOT_CONNECTED&&(yield e.redirect())});return function(e){return t.apply(this,arguments)}}())}loginWithEmail(e){var t=this;return dw(function*(){const n=yield t.authenticationService.doEmailLogin(e.email,e.password);n.isFailure()&&(t.errorMessage=n.getReason())})()}loginWithGoogle(){var e=this;return dw(function*(){const t=yield e.authenticationService.doGoogleLogin();t.isFailure()&&(e.errorMessage=t.getReason())})()}redirect(){var e=this;return dw(function*(){return e.router.navigate(["/lobby"])})()}canLogin(){return!(""===(this.loginForm.value.email||"")||""===(this.loginForm.value.password||""))}}return e.\u0275fac=function(t){return new(t||e)(la(t_),la(MY))},e.\u0275cmp=Xe({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h;return e=$localize`Log in`,t=$localize`Email`,n=$localize`Email`,r=$localize`Password`,i=$localize`Password`,s=$localize`Log in`,o=$localize`Log in with Google`,a=$localize`No account?`,c=$localize`Register`,l=$localize`Forgot your password?`,u=$localize`Reset your password`,h=$localize`Connection error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",n,"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],r,[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",i,"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],s,["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],o,["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],a,[3,"routerLink"],c,l,u,["role","alert",1,"message","is-danger"],[1,"message-header"],h,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"p",1),Hc(2,2),fa(),da(3,"form",3),da(4,"div",4),da(5,"div",5),da(6,"label",6),Hc(7,7),fa(),fa(),da(8,"div",8),da(9,"div",9),da(10,"div",10),pa(11,"input",11),fa(),fa(),fa(),fa(),da(12,"div",4),da(13,"div",5),da(14,"label",12),Hc(15,13),fa(),fa(),da(16,"div",8),da(17,"div",9),da(18,"div",14),pa(19,"input",15),da(20,"span",16),pa(21,"fa-icon",17),fa(),fa(),fa(),fa(),fa(),da(22,"div",4),pa(23,"div",5),da(24,"div",8),da(25,"div",9),da(26,"div",10),da(27,"button",18),Ca("click",function(){return t.loginWithEmail(t.loginForm.value)}),Hc(28,19),fa(),fa(),fa(),fa(),fa(),da(29,"div",4),pa(30,"div",5),da(31,"div",8),da(32,"div",9),da(33,"div",10),da(34,"button",20),Ca("click",function(){return t.loginWithGoogle()}),Hc(35,21),fa(),fa(),fa(),fa(),fa(),aa(36,R9,5,1,"div",22),da(37,"p",23),ga(38),Hc(39,24),ma(),Da(40,"\xa0 "),da(41,"a",25),Hc(42,26),fa(),fa(),da(43,"p",23),ga(44),Hc(45,27),ma(),Da(46,"\xa0 "),da(47,"a",25),Hc(48,28),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ua("formGroup",t.loginForm),Ts(18),ua("icon",t.faEye),Ts(6),ua("disabled",!t.canLogin()),Ts(9),ua("ngIf",t.errorMessage),Ts(5),ua("routerLink",ou(6,D9)),Ts(6),ua("routerLink",ou(7,L9)))},directives:[eg,wp,og,qf,Ep,cg,M9,vg,PJ,x9,zd,i_],encapsulation:2}),e})(),B9=(()=>{class e{constructor(e){this.partDAO=e,this.unsubscribe=vw.empty(),this.activePartsBS=new cm([]),this.activePartsObs=this.activePartsBS.asObservable()}getActivePartsObs(){return this.activePartsObs}startObserving(){MG(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");const e=new UG(e=>{const t=this.activePartsBS.value.concat(...e);this.activePartsBS.next(t)},e=>{const t=this.activePartsBS.value;for(const n of e)t.forEach(e=>{e.id===n.id&&(e.data=n.data)});this.activePartsBS.next(t)},e=>{const t=[];for(const n of this.activePartsBS.value)e.some(e=>e.id===n.id)||t.push(n);this.activePartsBS.next(t)});this.unsubscribe=vw.of(this.partDAO.observeActiveParts(e))}stopObserving(){MG(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=vw.empty()}}return e.\u0275fac=function(t){return new(t||e)(Or(DG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),V9=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}navigateToOnlineGameCreation(){var e=this;return dw(function*(){yield e.router.navigate(["/play",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(la(t_))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Create an online game`,[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(da(0,"app-pick-game",0),Ca("pickGame",function(e){return t.pickGame(e)}),fa(),da(1,"button",1),Ca("click",function(){return t.navigateToOnlineGameCreation()}),Hc(2,2),fa()),2&e&&(Ts(1),ua("disabled",!t.selectedGame))},directives:[T9],encapsulation:2}),e})();const U9=["chatDiv"];function $9(e,t){1&e&&(ga(0),Hc(1,8),ma())}function z9(e,t){1&e&&Hc(0,9),2&e&&(Gc(ba(2).unreadMessagesText),qc(0))}function H9(e,t){if(1&e){const e=ya();da(0,"button",14),Ca("click",function(){return Gt(e),ba(3).scrollToBottom()}),Da(1),fa()}if(2&e){const e=ba(3);Ts(1),Fa("",e.unreadMessagesText," \u2193")}}function G9(e,t){if(1&e&&(da(0,"p"),Da(1),fu(2,"date"),da(3,"b"),Da(4),fa(),Da(5),fa()),2&e){const e=t.$implicit;Ts(1),Fa(" [",gu(2,3,e.postedTime,"HH:mm:ss","+0100"),"] "),Ts(3),Fa("",e.sender," :"),Ts(1),Fa(" ",e.content," ")}}function q9(e,t){if(1&e){const e=ya();da(0,"div"),aa(1,H9,2,1,"button",10),da(2,"div",11,12),Ca("scroll",function(){return Gt(e),ba(2).updateCurrentScrollPosition()}),aa(4,G9,6,7,"p",13),fa(),fa()}if(2&e){const e=ba(2);Ts(1),ua("ngIf",e.showUnreadMessagesButton),Ts(3),ua("ngForOf",e.chat)}}const W9=function(){return{standalone:!0}};function j9(e,t){if(1&e){const e=ya();da(0,"form",15),Ca("onSubmit",function(){return Gt(e),ba(2).sendMessage()}),da(1,"div",16),da(2,"div",17),da(3,"input",18,19),Ca("ngModelChange",function(t){return Gt(e),ba(2).userMessage=t}),fa(),da(5,"p",20),Da(6),fa(),fa(),da(7,"div",21),da(8,"button",22),Ca("click",function(){return Gt(e),ba(2).sendMessage()}),pa(9,"fa-icon",23),fa(),fa(),fa(),da(10,"div",24),da(11,"p"),da(12,"strong"),Hc(13,25),fa(),fa(),fa(),fa()}if(2&e){const e=ca(4),t=ba(2);Ts(3),ua("ngModel",t.userMessage)("ngModelOptions",ou(4,W9)),Ts(3),Fa("",e.value.length,"/128"),Ts(3),ua("icon",t.faReply)}}function Z9(e,t){if(1&e){const e=ya();da(0,"div",2),da(1,"button",3),Ca("click",function(){return Gt(e),ba().switchChatVisibility()}),aa(2,$9,2,0,"ng-container",4),aa(3,z9,1,1,"ng-template",null,5,Du),fa(),aa(5,q9,5,2,"div",6),aa(6,j9,14,5,"form",7),fa()}if(2&e){const e=ca(4),t=ba();Ts(2),ua("ngIf",t.visible)("ngIfElse",e),Ts(3),ua("ngIf",t.visible),Ts(1),ua("ngIf",t.visible)}}function Y9(e,t){1&e&&(da(0,"div",26),da(1,"div",27),da(2,"p"),Hc(3,28),fa(),fa(),fa())}let K9=(()=>{class e{constructor(t,n){this.chatService=t,this.authenticationService=n,this.userMessage="",this.username=vw.empty(),this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=eK,this.isNearBottom=!0,this.notYetScrolled=!0,pw(e.VERBOSE,"ChatComponent constructor")}ngOnInit(){pw(e.VERBOSE,`ChatComponent.ngOnInit for chat ${this.chatId}`),MG(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.authSubscription=this.authenticationService.getUserObs().subscribe(t=>{this.isConnectedUser(t)?(pw(e.VERBOSE,JSON.stringify(t)+" just connected"),this.username=t.username,this.connected=!0,this.loadChatContent()):(pw(e.VERBOSE,"No User Logged"),this.username=vw.empty(),this.connected=!1)})}ngAfterViewChecked(){this.scrollToBottomIfNeeded()}isConnectedUser(e){return e.username.isPresent()&&""!==e.username.get()}loadChatContent(){pw(e.VERBOSE,`User '${this.username}' logged, loading chat content`),this.chatService.startObserving(this.chatId,e=>{MG(e.isPresent(),"ChatComponent observed a chat being deleted, this should not happen"),this.updateMessages(e.get())})}updateMessages(e){this.chat=e.messages;const t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}updateUnreadMessagesText(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize`no new message`,this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize`1 new message`:$localize`${e} new messages`}scrollToBottomIfNeeded(){this.connected&&this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}updateCurrentScrollPosition(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}scrollToBottom(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}scrollTo(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}sendMessage(){var e=this;return dw(function*(){MG(e.username.isPresent(),"disconnected user is not able to send a message");const t=e.userMessage;e.userMessage="",yield e.chatService.sendMessage(e.username.get(),t,e.turn)})()}ngOnDestroy(){this.authSubscription.unsubscribe(),this.chatService.isObserving()&&this.chatService.stopObserving()}switchChatVisibility(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(VG),la(MY))},e.\u0275cmp=Xe({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&Mu(U9,5),2&e){let e;Nu(e=xu())&&(t.chatDiv=e.first)}},inputs:{chatId:"chatId",turn:"turn"},decls:3,vars:2,consts:function(){let e,t,n,r,i;return e=$localize`Hide chat`,t=$localize`Show chat (${"\ufffd0\ufffd"}:INTERPOLATION:)`,n=$localize`Type your message here`,r=$localize`Be polite`,i=$localize`Only connected users can see the chat.`,[["class","block",4,"ngIf"],["id","disconnected-chat","class","message is-primary is-light",4,"ngIf"],[1,"block"],["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],e,t,["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",n,"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],["toggleVisibility","",1,"clickable-icon",3,"icon"],[1,"content","is-small"],r,["id","disconnected-chat",1,"message","is-primary","is-light"],[1,"message-body"],i]},template:function(e,t){1&e&&(da(0,"div"),aa(1,Z9,7,4,"div",0),aa(2,Y9,4,0,"div",1),fa()),2&e&&(Ts(1),ua("ngIf",t.connected),Ts(1),ua("ngIf",!1===t.connected))},directives:[zd,Ud,eg,wp,Kp,qf,Cg,Ep,Xp,PJ,x9],pipes:[Wd],encapsulation:2}),e})();function J9(e,t){if(1&e&&(ga(0),Da(1),ma()),2&e){const e=ba().$implicit;Ts(1),La(e.data.playerOne)}}function Q9(e,t){1&e&&Hc(0,26)}function X9(e,t){if(1&e){const e=ya();da(0,"tr",22),Ca("click",function(){const t=Gt(e).$implicit;return ba(2).joinGame(t.id,t.data.typeGame)}),da(1,"td",23),Da(2),fa(),da(3,"td",23),Da(4),fa(),da(5,"td",23),aa(6,J9,2,1,"ng-container",24),aa(7,Q9,1,0,"ng-template",null,25,Du),fa(),da(9,"td",23),Da(10),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(8);Pa("id","part_",n,""),Ts(2),La(e.data.typeGame),Ts(2),La(e.data.playerZero),Ts(2),ua("ngIf",e.data.playerOne)("ngIfElse",r),Ts(4),La(e.data.turn)}}function eee(e,t){if(1&e&&(da(0,"div",13),da(1,"div",14),da(2,"table",15),da(3,"thead"),da(4,"tr"),da(5,"th",16),Hc(6,17),fa(),da(7,"th",16),Hc(8,18),fa(),da(9,"th",16),Hc(10,19),fa(),da(11,"th",16),Hc(12,20),fa(),fa(),fa(),da(13,"tbody"),aa(14,X9,11,6,"tr",21),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(14),ua("ngForOf",e.activeParts)}}function tee(e,t){1&e&&(da(0,"div",27),pa(1,"app-online-game-selection",28),fa())}function nee(e,t){if(1&e&&(ga(0),Da(1),fu(2,"date"),ma()),2&e){const e=ba().$implicit;Ts(1),Ba(" ",e.data.username,": ",gu(2,2,1e3*e.data.last_changed.seconds,"HH:mm:ss","+0100")," ")}}function ree(e,t){if(1&e&&(da(0,"li"),aa(1,nee,3,6,"ng-container",37),fa()),2&e){const e=t.$implicit;Ts(1),ua("ngIf",e.data.last_changed)}}function iee(e,t){if(1&e&&(da(0,"div",29),da(1,"div",30),da(2,"div",31),pa(3,"app-chat",32),fa(),fa(),da(4,"div",33),da(5,"div",34),da(6,"p"),Hc(7,35),fa(),da(8,"ul"),aa(9,ree,2,1,"li",36),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(3),ua("turn",-1),Ts(6),ua("ngForOf",e.activeUsers)}}let see=(()=>{class e{constructor(e,t,n){this.router=e,this.userService=t,this.activePartsService=n,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}ngOnInit(){pw(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(e=>{this.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(e=>{this.activeParts=e})}ngOnDestroy(){pw(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}joinGame(e,t){var n=this;return dw(function*(){yield n.router.navigate(["/play",t,e])})()}selectTab(e){this.currentTab=e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(t_),la(HG),la(B9))},e.\u0275cmp=Xe({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c;return e=$localize`Games`,t=$localize`Create`,n=$localize`Chat`,r=$localize`Game`,i=$localize`First player`,s=$localize`Second player`,o=$localize`Turn`,a=$localize`Waiting for opponent`,c=$localize`Connected users:`,[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],e,["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],t,["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],n,["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],r,i,s,o,[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],a,["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-9"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3"],["id","onlineUser",1,"box"],c,[4,"ngFor","ngForOf"],[4,"ngIf"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"ul"),da(2,"li",1),da(3,"a",2),Ca("click",function(){return t.selectTab("games")}),Hc(4,3),fa(),fa(),da(5,"li",4),da(6,"a",5),Ca("click",function(){return t.selectTab("create")}),Hc(7,6),fa(),fa(),da(8,"li",7),da(9,"a",8),Ca("click",function(){return t.selectTab("chat")}),Hc(10,9),fa(),fa(),fa(),fa(),aa(11,eee,15,1,"div",10),aa(12,tee,2,0,"div",11),aa(13,iee,10,2,"div",12)),2&e&&(Ts(11),ua("ngIf","games"===t.currentTab),Ts(1),ua("ngIf","create"===t.currentTab),Ts(1),ua("ngIf","chat"===t.currentTab))},directives:[Bd,zd,Ud,V9,K9],pipes:[Wd],encapsulation:2}),e})(),oee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-not-found"]],decls:5,vars:0,consts:function(){let e,t;return e=$localize`Game does not exist`,t=$localize`The game you tried to join does not exist anymore.`,[[1,"message","is-danger"],[1,"message-header"],e,[1,"message-body"],t]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"div",1),Hc(2,2),fa(),da(3,"div",3),Hc(4,4),fa(),fa())},encapsulation:2}),e})();function aee(e,t){}let cee=(()=>{class e{constructor(t){this.viewContainerRef=t,pw(e.VERBOSE,"GameIncluderComponent constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(ql))},e.\u0275cmp=Xe({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&aa(0,aee,0,0,"ng-template")},encapsulation:2}),e})(),lee=(()=>{class e{}return e.NOT_YOUR_TURN=()=>$localize`It is not your turn!`,e.NO_CLONING_FEATURE=()=>$localize`You cannot clone a game. This feature might be implemented later.`,e})(),uee=(()=>{class e{constructor(t,n,r){this.componentFactoryResolver=t,this.actRoute=n,this.authenticationService=r,this.players=[vw.empty(),vw.empty()],this.endGame=!1,pw(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}getMatchingComponent(t){pw(e.VERBOSE,"GameWrapper.getMatchingComponent");const n=vw.ofNullable(O9.ALL_GAMES().find(e=>e.urlName===t));return MG(n.isPresent(),"Unknown Games are unwrappable"),n.get().component}afterGameIncluderViewInit(){pw(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit"),this.createGameComponent(),this.gameComponent.rules.setInitialBoard()}createGameComponent(){pw(e.VERBOSE,"GameWrapper.createGameComponent"),MG(null!=this.gameIncluder,"GameIncluder should be present");const t=fw.getNonNullable(this.actRoute.snapshot.paramMap.get("compo")),n=this.getMatchingComponent(t),r=this.componentFactoryResolver.resolveComponentFactory(n),i=this.gameIncluder.viewContainerRef.createComponent(r);this.gameComponent=i.instance,this.gameComponent.chooseMove=(e,t,n)=>this.receiveValidMove(e,t,n),this.gameComponent.canUserPlay=e=>this.onUserClick(e),this.gameComponent.isPlayerTurn=()=>this.isPlayerTurn(),this.gameComponent.cancelMoveOnWrapper=e=>{this.onCancelMove(e)},this.gameComponent.observerRole=this.observerRole,this.canPass=this.gameComponent.canPass}receiveValidMove(t,n,r){var i=this;return dw(function*(){if(pw(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),!i.isPlayerTurn())return kG.failure(lee.NOT_YOUR_TURN());if(i.endGame)return kG.failure($localize`The game has ended.`);const s=i.gameComponent.rules.isLegal(t,n);return s.isFailure()?(i.gameComponent.cancelMove(s.getReason()),kG.ofFallible(s)):(i.gameComponent.cancelMoveAttempt(),yield i.onLegalUserMove(t,r),pw(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),kG.SUCCESS)})()}onUserClick(e){if(this.observerRole===VY.NONE.value){const e=lee.NO_CLONING_FEATURE();return kG.failure(e)}return this.isPlayerTurn()?kG.SUCCESS:kG.failure(lee.NOT_YOUR_TURN())}onCancelMove(e){}isPlayerTurn(){if(this.observerRole===VY.NONE.value||null==this.gameComponent)return!1;const t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return pw(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}getBoardHighlight(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(rl),la(xy),la(MY))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&Mu(cee,5),2&e){let e;Nu(e=xu())&&(t.gameIncluder=e.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class hee{constructor(e,t,n){this.added=e,this.modified=t,this.removed=n}static from(e,t){const n=new hee({},{},{});if(null==e)return n.added={...t},n;if(null==t)return n.removed={...e},n;const r=Object.keys(e),i=Object.keys(t),s=r.filter(e=>!1===i.includes(e)),o=r.filter(e=>i.includes(e)),a=i.filter(e=>!1===r.includes(e));return n.addNewKeys(a,t),n.addCommonKey(o,t,e),n.addRemovedKeys(s,e),n}addNewKeys(e,t){for(const n of e)null!=t[n]&&(this.added[n]=t[n])}addCommonKey(e,t,n){for(const r of e)if(null==t[r])null!=n[r]&&(this.removed[r]=n[r]);else if(null==n[r])null!=t[r]&&(this.added[r]=t[r]);else{if(["function","symbol","bigint"].includes(typeof n[r]))throw new Error("Not implemented yet");if(void 0===n[r])throw new Error("YOU RE NOT A REAL VALUE "+r);if(["string","boolean","number"].includes(typeof n[r]))n[r]!==t[r]&&(this.modified[r]=t[r]);else if("number"==typeof n[r].length){if("number"!=typeof t[r].length)throw new Error("Thing should not change type");if(n[r].length===t[r].length){let e=!0;for(let i=0;e&&i<n[r].length;i++)hee.from(n[r][i],t[r][i]).countChanges()>0&&(e=!1,this.modified[r]=t[r])}else this.modified[r]=t[r]}else{const e=hee.from(n[r],t[r]);e.countChanges()>0&&(this.modified[r]=e)}}}countChanges(){const e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}addRemovedKeys(e,t){for(const n of e)this.removed[n]=t[n]}isPresent(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}let dee=(()=>{class e{transform(e){const t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize`${r} hours`):1===r&&i.push($localize`1 hour`),n>1?i.push($localize`${n} minutes`):1===n&&i.push($localize`1 minute`),t>1?i.push($localize`${t} seconds`):1===t&&i.push($localize`1 second`),0===i.length)return $localize`0 seconds`;if(1===i.length)return i[0];{const e=i.slice(0,-1).join(", "),t=i.slice(-1)[0];return $localize`${e} and ${t}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"humanDuration",type:e,pure:!0}),e})();function fee(e){return 1e3*e.seconds+e.nanoseconds/1e6}function pee(e){return x((t,n)=>{Y(e).subscribe(new R(n,()=>n.complete(),p)),!n.closed&&t.subscribe(n)})}function gee(e,t){if(1&e&&(ga(0),Da(1),ma()),2&e){const e=ba(3);Ts(1),La(e.viewInfo.chosenOpponent)}}function mee(e,t){1&e&&Hc(0,44)}function yee(e,t){if(1&e&&(da(0,"div",45),da(1,"div",8),da(2,"label",46),ga(3),Hc(4,47),ma(),da(5,"output"),Da(6),fu(7,"humanDuration"),fa(),fa(),da(8,"div",37),pa(9,"input",48),fa(),fa(),da(10,"div",8),da(11,"label",49),$c(12,50),pa(13,"output"),fu(14,"humanDuration"),zc(),fa(),da(15,"div",37),pa(16,"input",51),fa(),fa(),fa()),2&e){const e=ba(3);Ts(6),La(pu(7,2,e.viewInfo.maximalMoveDuration||0)),Ts(8),Gc(pu(14,4,e.viewInfo.totalPartDuration||0)),qc(12)}}function vee(e,t){1&e&&(da(0,"div"),$c(1,52),pa(2,"br"),zc(),fa())}function _ee(e,t){1&e&&(da(0,"button",64),Hc(1,65),fa())}function Cee(e,t){if(1&e){const e=ya();da(0,"tr",60),Ca("click",function(){const t=Gt(e).$implicit;return ba(4).selectOpponent(t)}),da(1,"td",61),Da(2),fa(),da(3,"td",62),aa(4,_ee,2,0,"button",63),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(4);Pa("id","presenceOf_",e,""),ua("ngClass",n.viewInfo.candidateClasses[e]),Ts(1),ua("id",n.viewInfo.chosenOpponent===e&&"selected_"+e||"candidate_"+e),Ts(1),La(e),Ts(2),ua("ngIf",n.viewInfo.chosenOpponent!==e)}}function Eee(e,t){if(1&e&&(ga(0),Hc(1,53),ma(),da(2,"div",54),da(3,"table",55),da(4,"thead"),da(5,"tr"),da(6,"th",56),Hc(7,57),fa(),da(8,"th",56),Hc(9,58),fa(),fa(),fa(),da(10,"tbody"),aa(11,Cee,5,5,"tr",59),fa(),fa(),fa()),2&e){const e=ba(3);Ts(11),ua("ngForOf",e.viewInfo.candidates)}}function wee(e,t){if(1&e){const e=ya();da(0,"button",66),Ca("click",function(){return Gt(e),ba(3).changeConfig()}),Hc(1,67),fa()}}function bee(e,t){if(1&e){const e=ya();da(0,"div"),da(1,"h1",4),Hc(2,5),fa(),da(3,"form",6),da(4,"fieldset",7),da(5,"div",8),da(6,"label",9),Hc(7,10),fa(),da(8,"div",11),da(9,"button",12),Ca("click",function(){return Gt(e),ba(2).selectFirstPlayer("RANDOM")}),Hc(10,13),fa(),da(11,"button",14),Ca("click",function(){return Gt(e),ba(2).selectFirstPlayer("CREATOR")}),Hc(12,15),fa(),da(13,"button",16),Ca("click",function(){return Gt(e),ba(2).selectFirstPlayer("CHOSEN_PLAYER")}),aa(14,gee,2,1,"ng-container",17),aa(15,mee,1,0,"ng-template",null,18,Du),fa(),fa(),fa(),da(17,"div",8),da(18,"label",9),Hc(19,19),fa(),da(20,"div",11),da(21,"div",20),Ca("click",function(){return Gt(e),ba(2).selectPartType("STANDARD")}),da(22,"div",21),da(23,"span"),Hc(24,22),fa(),fa(),da(25,"div",23),da(26,"div",24),da(27,"div",25),da(28,"p"),ga(29),Hc(30,26),ma(),da(31,"strong"),Da(32),fu(33,"humanDuration"),fa(),pa(34,"br"),ga(35),$c(36,27),pa(37,"strong"),fu(38,"humanDuration"),zc(),ma(),fa(),fa(),fa(),fa(),fa(),da(39,"div",28),Ca("click",function(){return Gt(e),ba(2).selectPartType("BLITZ")}),da(40,"div",21),da(41,"span"),Hc(42,29),fa(),fa(),da(43,"div",23),da(44,"div",24),da(45,"div",25),da(46,"p"),ga(47),Hc(48,30),ma(),da(49,"strong"),Da(50),fu(51,"humanDuration"),fa(),pa(52,"br"),ga(53),$c(54,31),pa(55,"strong"),fu(56,"humanDuration"),zc(),ma(),fa(),fa(),fa(),fa(),fa(),da(57,"button",32),Ca("click",function(){return Gt(e),ba(2).selectPartType("CUSTOM")}),Hc(58,33),fa(),fa(),fa(),aa(59,yee,17,6,"div",34),da(60,"div",8),da(61,"label",35),Hc(62,36),fa(),da(63,"div",37),aa(64,vee,3,0,"div",17),aa(65,Eee,12,1,"ng-template",null,38,Du),fa(),fa(),fa(),da(67,"div",8),da(68,"div",11),da(69,"button",39),Ca("click",function(){return Gt(e),ba(2).proposeConfig()}),Hc(70,40),fa(),aa(71,wee,2,0,"button",41),da(72,"button",42),Ca("click",function(){return Gt(e),ba(2).cancelGameCreation()}),Hc(73,43),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ca(16),t=ca(66),n=ba(2);Ts(3),ua("formGroup",n.configFormGroup),Ts(1),ua("disabled",!n.viewInfo.canEditConfig),Ts(5),ua("ngClass",n.viewInfo.firstPlayerClasses.RANDOM),Ts(2),ua("ngClass",n.viewInfo.firstPlayerClasses.CREATOR),Ts(2),ua("ngClass",n.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),Ts(1),ua("ngIf",n.viewInfo.chosenOpponent)("ngIfElse",e),Ts(7),ua("ngClass",n.viewInfo.partTypeClasses.STANDARD),Ts(11),La(pu(33,19,n.partType.NORMAL_MOVE_DURATION)),Ts(6),Gc(pu(38,21,n.partType.NORMAL_PART_DURATION)),qc(36),Ts(1),ua("ngClass",n.viewInfo.partTypeClasses.BLITZ),Ts(11),La(pu(51,23,n.partType.BLITZ_MOVE_DURATION)),Ts(6),Gc(pu(56,25,n.partType.BLITZ_PART_DURATION)),qc(54),Ts(1),ua("ngClass",n.viewInfo.partTypeClasses.CUSTOM),Ts(2),ua("ngIf",n.viewInfo.showCustomTime),Ts(5),ua("ngIf",0===n.viewInfo.candidates.length)("ngIfElse",t),Ts(5),ua("disabled",!n.viewInfo.canProposeConfig),Ts(2),ua("ngIf",n.viewInfo.canReviewConfig)}}function See(e,t){if(1&e&&(da(0,"div",74),da(1,"p"),$c(2,75),pa(3,"br"),zc(),fa(),fa()),2&e){const e=ba(3);Ts(3),Gc(e.viewInfo.creator),qc(2)}}function Pee(e,t){if(1&e&&(da(0,"span"),Hc(1,81),fa()),2&e){const e=ba(4);Ts(1),Gc(e.viewInfo.creator),qc(1)}}function Oee(e,t){1&e&&(da(0,"span"),Hc(1,82),fa())}function Tee(e,t){1&e&&(da(0,"span"),Hc(1,83),fa())}function Iee(e,t){if(1&e){const e=ya();da(0,"div",74),da(1,"p"),Hc(2,76),fa(),da(3,"ul"),da(4,"li"),aa(5,Pee,2,1,"span",2),aa(6,Oee,2,0,"span",2),aa(7,Tee,2,0,"span",2),fa(),da(8,"li"),$c(9,77),pa(10,"strong"),fu(11,"humanDuration"),zc(),fa(),da(12,"li"),$c(13,78),pa(14,"strong"),fu(15,"humanDuration"),zc(),fa(),fa(),da(16,"button",79),Ca("click",function(){return Gt(e),ba(3).acceptConfig()}),Hc(17,80),fa(),fa()}if(2&e){const e=ba(3);Ts(2),Gc(e.viewInfo.creator)(e.viewInfo.partTypeName),qc(2),Ts(3),ua("ngIf","CREATOR"===e.viewInfo.firstPlayer),Ts(1),ua("ngIf","CHOSEN_PLAYER"===e.viewInfo.firstPlayer),Ts(1),ua("ngIf","RANDOM"===e.viewInfo.firstPlayer),Ts(4),Gc(pu(11,7,e.viewInfo.maximalMoveDuration||0)),qc(9),Ts(4),Gc(pu(15,9,e.viewInfo.totalPartDuration||0)),qc(13)}}function kee(e,t){if(1&e&&(da(0,"div"),da(1,"div",68),da(2,"div",69),da(3,"p"),Hc(4,70),fa(),fa(),da(5,"div",71),aa(6,See,4,1,"div",72),aa(7,Iee,18,11,"ng-template",null,73,Du),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ua("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function Aee(e,t){if(1&e&&(ga(0),Hc(1,86),ma()),2&e){const e=ba(3);Ts(1),Gc(e.viewInfo.creator),qc(1)}}function Nee(e,t){if(1&e&&Hc(0,87),2&e){const e=ba(3);Gc(e.viewInfo.creator)(e.viewInfo.chosenOpponent),qc(0)}}function Mee(e,t){if(1&e&&(da(0,"div",68),da(1,"div",69),da(2,"p"),Hc(3,84),fa(),fa(),da(4,"div",71),da(5,"p"),aa(6,Aee,2,1,"ng-container",17),aa(7,Nee,1,2,"ng-template",null,85,Du),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ua("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function xee(e,t){if(1&e&&(da(0,"div",1),aa(1,bee,74,27,"div",2),aa(2,kee,9,2,"div",2),aa(3,Mee,9,2,"div",3),fa()),2&e){const e=ba();Ts(1),ua("ngIf",e.viewInfo.userIsCreator),Ts(1),ua("ngIf",e.viewInfo.userIsChosenOpponent),Ts(1),ua("ngIf",e.viewInfo.userIsObserver)}}let Ree=(()=>{class e{constructor(t,n,r,i,s,o,a){this.router=t,this.gameService=n,this.joinerService=r,this.chatService=i,this.userService=s,this.formBuilder=o,this.messageDisplayer=a,this.partType=RY,this.gameStartNotification=new _u,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.candidateSubscription=new fQ,this.creatorSubscription=null,this.ngUnsubscribe=new A,this.allDocDeleted=!1,pw(e.VERBOSE,"PartCreationComponent constructed for "+this.userName)}ngOnInit(){var t=this;return dw(function*(){pw(e.VERBOSE,"PartCreationComponent.ngOnInit for "+t.userName),t.checkInputs(),t.createForms(),!(yield t.joinerService.joinGame(t.partId,t.userName)).isFailure()&&(t.gameExists=!0,t.subscribeToJoinerDoc(),t.subscribeToFormElements(),pw(e.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds"))})()}checkInputs(){MG(null!=this.userName&&""!==this.userName,"PartCreationComponent should not be created with an empty userName"),MG(null!=this.partId&&""!==this.partId,"PartCreationComponent should not be created with an empty partId")}createForms(){this.configFormGroup=this.formBuilder.group({firstPlayer:[xY.RANDOM.value,Jf.required],maximalMoveDuration:[RY.NORMAL_MOVE_DURATION,Jf.required],partType:["STANDARD",Jf.required],totalPartDuration:[RY.NORMAL_PART_DURATION,Jf.required],chosenOpponent:["",Jf.required]})}subscribeToJoinerDoc(){var e=this;this.joinerService.subscribeToChanges(this.partId,function(){var t=dw(function*(t){yield e.onCurrentJoinerUpdate(t)});return function(e){return t.apply(this,arguments)}}())}getForm(e){return fw.getNonNullable(this.configFormGroup.get(e))}subscribeToFormElements(){this.getForm("chosenOpponent").valueChanges.pipe(pee(this.ngUnsubscribe)).subscribe(e=>{void 0!==this.viewInfo.chosenOpponent&&(this.viewInfo.candidateClasses[this.viewInfo.chosenOpponent]=[]),this.viewInfo.candidateClasses[e]=["is-selected"],this.viewInfo.chosenOpponent=e,this.viewInfo.canProposeConfig=fw.getNonNullable(this.currentJoiner).partStatus!==DY.CONFIG_PROPOSED.value&&""!==e}),this.getForm("partType").valueChanges.pipe(pee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.partTypeClasses[this.viewInfo.partType]=[],this.viewInfo.partTypeClasses[e]=["is-primary","is-selected"],this.viewInfo.partType=e,this.viewInfo.showCustomTime="CUSTOM"===e}),this.getForm("maximalMoveDuration").valueChanges.pipe(pee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.maximalMoveDuration=e}),this.getForm("totalPartDuration").valueChanges.pipe(pee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.totalPartDuration=e}),this.getForm("firstPlayer").valueChanges.pipe(pee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.firstPlayerClasses[this.viewInfo.firstPlayer]=[],this.viewInfo.firstPlayerClasses[e]=["is-primary","is-selected"],this.viewInfo.firstPlayer=e})}updateViewInfo(){const e=fw.getNonNullable(this.currentJoiner);switch(this.viewInfo.canReviewConfig=e.partStatus===DY.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=e.partStatus!==DY.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=this.userName===e.creator,this.viewInfo.userIsChosenOpponent=this.userName===e.chosenPlayer,this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=e.partStatus!==DY.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=e.creator,this.viewInfo.candidates=e.candidates,this.userName===e.creator?this.setDataForCreator(e):(this.viewInfo.maximalMoveDuration=e.maximalMoveDuration,this.viewInfo.totalPartDuration=e.totalPartDuration,this.viewInfo.partType=e.partType,this.viewInfo.chosenOpponent=e.chosenPlayer||void 0,this.viewInfo.firstPlayer=e.firstPlayer),e.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize`custom`;break;case"BLITZ":this.viewInfo.partTypeName=$localize`blitz`;break;case"STANDARD":this.viewInfo.partTypeName=$localize`standard`}}setDataForCreator(e){this.viewInfo.maximalMoveDuration=this.viewInfo.maximalMoveDuration||e.maximalMoveDuration,this.viewInfo.totalPartDuration=this.viewInfo.totalPartDuration||e.totalPartDuration;let t=this.viewInfo.chosenOpponent;t?-1===e.candidates.indexOf(t)&&(t=""):t=e.chosenPlayer||"",this.getForm("chosenOpponent").setValue(t)}selectFirstPlayer(e){this.getForm("firstPlayer").setValue(e)}selectPartType(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue(RY.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue(RY.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue(RY.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue(RY.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}selectOpponent(t){var n=this;return dw(function*(){return pw(e.VERBOSE,"PartCreationComponent.setChosenPlayer("+t+")"),n.joinerService.setChosenPlayer(t)})()}changeConfig(){var e=this;return dw(function*(){return e.joinerService.reviewConfig()})()}proposeConfig(){var e=this;return dw(function*(){const t=e.getForm("chosenOpponent").value,n=e.getForm("partType").value,r=e.getForm("maximalMoveDuration").value,i=e.getForm("firstPlayer").value,s=e.getForm("totalPartDuration").value;return e.joinerService.proposeConfig(t,RY.of(n),r,xY.of(i),s)})()}cancelGameCreation(){var t=this;return dw(function*(){t.allDocDeleted=!0,pw(e.VERBOSE,"PartCreationComponent.cancelGameCreation"),yield t.gameService.deletePart(t.partId),pw(e.VERBOSE,"PartCreationComponent.cancelGameCreation: game deleted"),yield t.joinerService.deleteJoiner(),pw(e.VERBOSE,"PartCreationComponent.cancelGameCreation: game and joiner deleted"),yield t.chatService.deleteChat(t.partId),pw(e.VERBOSE,"PartCreationComponent.cancelGameCreation: game and joiner and chat deleted")})()}onCurrentJoinerUpdate(t){if(pw(e.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(this.currentJoiner),then:JSON.stringify(t)}}),t.isAbsent())return pw(e.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),this.onGameCancelled();this.currentJoiner=t.get(),this.observeNeededPlayers(),this.updateViewInfo(),this.isGameStarted()&&(pw(e.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),this.onGameStarted())}onGameCancelled(){var t=this;return dw(function*(){pw(e.VERBOSE,"PartCreationComponent.onGameCancelled"),t.messageDisplayer.infoMessage($localize`The game has been canceled!`),yield t.router.navigate(["/lobby"])})()}isGameStarted(){const e=fw.getNonNullable(this.currentJoiner);return null!=e&&e.partStatus===DY.PART_STARTED.value}onGameStarted(){const t=fw.getNonNullable(this.currentJoiner);pw(e.VERBOSE,{partCreationComponent_onGameStarted:{joiner:t}}),this.gameStartNotification.emit(t),this.gameStarted=!0,pw(e.VERBOSE,"PartCreationComponent.onGameStarted finished")}observeNeededPlayers(){const t=fw.getNonNullable(this.currentJoiner);pw(e.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:t}}),this.userName===t.creator?this.observeCandidates():this.observeCreator()}observeCreator(){var e=this;const t=fw.getNonNullable(this.currentJoiner);if(null!=this.creatorSubscription)return;const n=function(){var t=dw(function*(t){yield e.destroyDocIfCreatorOffline(t)});return function(e){return t.apply(this,arguments)}}(),r=new UG(n,n,n);this.creatorSubscription=this.userService.observeUserByUsername(t.creator,r)}destroyDocIfCreatorOffline(e){var t=this;return dw(function*(){const n=fw.getNonNullable(t.currentJoiner);for(const r of e)MG(r.data.username===n.creator,"found non creator while observing creator!"),"offline"===r.data.state&&!1===t.allDocDeleted&&n.partStatus!==DY.PART_STARTED.value&&(yield t.cancelGameCreation())})()}observeCandidates(){var t=this;const n=fw.getNonNullable(this.currentJoiner);pw(e.VERBOSE,{PartCreation_observeCandidates:n});const r=new UG(function(){var e=dw(function*(e){for(const n of e)"offline"===n.data.state&&(yield t.removeUserFromLobby(fw.getNonNullable(n.data.username)),yield NG.logError("PartCreationComponent","user is already offline",{username:n.data.username,userId:n.id}))});return function(t){return e.apply(this,arguments)}}(),function(){var e=dw(function*(e){for(const n of e)"offline"===n.data.state&&(yield t.removeUserFromLobby(fw.getNonNullable(n.data.username)))});return function(t){return e.apply(this,arguments)}}(),function(){var e=dw(function*(e){for(const n of e)yield t.removeUserFromLobby(fw.getNonNullable(n.data.username)),yield NG.logError("PartCreationComponent","user was deleted",{username:n.data.username,userId:n.id})});return function(t){return e.apply(this,arguments)}}());for(const e of n.candidates)if(this.candidateSubscription.get(e).isAbsent()){const t=this.userService.observeUserByUsername(e,r);this.candidateSubscription.set(e,t)}for(const e of this.candidateSubscription.listKeys())e!==n.chosenPlayer&&!1===n.candidates.includes(e)&&this.unsubscribeFrom(e)}removeUserFromLobby(e){const t=fw.getNonNullable(this.currentJoiner),n=t.candidates.indexOf(e);MG(-1!==n,"PartCreationComponent: attempting to remove a user not in the lobby");const r=t.candidates.slice(0,n),i=t.candidates.slice(n+1),s=r.concat(i);return e===t.chosenPlayer?(this.messageDisplayer.infoMessage($localize`${e} left the game, please pick another opponent.`),this.joinerService.reviewConfigRemoveChosenPlayerAndUpdateCandidates(s)):this.joinerService.updateCandidates(s)}unsubscribeFrom(e){this.candidateSubscription.delete(e)()}acceptConfig(){return pw(e.VERBOSE,"PartCreationComponent.acceptConfig"),this.gameService.acceptConfig(this.partId,fw.getNonNullable(this.currentJoiner))}ngOnDestroy(){var t=this;return dw(function*(){pw(e.VERBOSE,"PartCreationComponent.ngOnDestroy"),t.ngUnsubscribe.next(),t.ngUnsubscribe.complete(),t.gameExists&&t.joinerService.unsubscribe();for(const e of t.candidateSubscription.listKeys())t.unsubscribeFrom(e);if(!1===t.gameStarted){if(null===t.currentJoiner)return void pw(e.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here");t.userName===t.currentJoiner.creator?(pw(e.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),yield t.cancelGameCreation()):!1===t.allDocDeleted&&(pw(e.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),yield t.joinerService.cancelJoining(t.userName))}})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(t_),la(qY),la(GY),la(VG),la(HG),la(Sg),la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-part-creation"]],inputs:{partId:"partId",userName:"userName"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,v,_,C,E,w,b,S,P,O,T,I,k,A,N,M,x,R,D;return e=$localize`Game creation`,t=$localize`First player`,n=$localize`Random`,r=$localize`You`,i=$localize`Game type`,s=$localize`Standard`,o=$localize`Maximal turn duration: `,a=$localize`Maximal game duration: ${"\ufffd#37\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#37\ufffd"}:CLOSE_TAG_STRONG:`,c=$localize`Blitz`,l=$localize`Maximal turn duration: `,u=$localize`Maximal game duration: ${"\ufffd#55\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#55\ufffd"}:CLOSE_TAG_STRONG:`,h=$localize`Custom`,d=$localize`Opponents`,f=$localize`Propose configuration`,p=$localize`Cancel game`,g=$localize`The opponent`,m=$localize`Maximal turn duration: `,y=$localize`Maximal game duration: ${"\ufffd#13\ufffd"}:START_TAG_OUTPUT:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#13\ufffd"}:CLOSE_TAG_OUTPUT:`,v=$localize`Potential opponents that join the game will appear here.${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:LINE_BREAK:Wait for an opponent to join, so that you can pick one.`,_=$localize`Click on the opponent against which you would like to play.`,C=$localize`Name`,E=$localize`Actions`,w=$localize`Pick`,b=$localize`Change configuration`,S=$localize`Configuration proposal`,P=$localize`You have been selected as the opponent.${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:LINE_BREAK: ${"\ufffd0\ufffd"}:INTERPOLATION: is modifying the configuration.`,O=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: proposes to play a ${"\ufffd1\ufffd"}:INTERPOLATION_1: game`,T=$localize`a turn lasts at most ${"\ufffd#10\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#10\ufffd"}:CLOSE_TAG_STRONG:`,I=$localize`the game lasts at most ${"\ufffd#14\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#14\ufffd"}:CLOSE_TAG_STRONG:`,k=$localize`Accept and start`,A=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: plays first`,N=$localize`you play first`,M=$localize`the first player is selected randomly`,x=$localize`One moment...`,R=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: is configuring the game.`,D=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has proposed a configuration to ${"\ufffd1\ufffd"}:INTERPOLATION_1:.`,[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],e,[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],t,[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],n,["id","firstPlayerCreator",1,"button",3,"ngClass","click"],r,["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],i,["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],s,["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],o,a,["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],c,l,u,["id","partTypeCustom",1,"button",3,"ngClass","click"],h,["id","customTime",4,"ngIf"],[1,"label"],d,[1,"control"],["chooseCandidate",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],f,["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],p,g,["id","customTime"],["for","maximalMoveDuration",1,"label"],m,["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],y,["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],v,_,["id","chooseCandidate",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],C,E,[3,"ngClass","id","click",4,"ngFor","ngForOf"],[3,"ngClass","id","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],w,["id","reviewConfig",1,"button",3,"click"],b,[1,"message","is-primary"],[1,"message-header"],S,[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],P,O,T,I,["id","acceptConfig",1,"button","is-primary",3,"click"],k,A,N,M,x,["proposalSent",""],R,D]},template:function(e,t){1&e&&aa(0,xee,4,3,"div",0),2&e&&ua("ngIf",t.viewInfo)},directives:[zd,eg,wp,og,Bd,qf,rg,Ep,cg,Ud],pipes:[dee],encapsulation:2}),e})();function Dee(e,t){if(1&e){const e=ya();da(0,"button",3),Ca("click",function(){return Gt(e),ba().addTime()}),Hc(1,4),fa()}if(2&e){const e=ba();Ts(1),Gc(e.timeToAdd),qc(1)}}let Lee=(()=>{class e{constructor(){this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new _u,this.addTimeToOpponent=new _u,this.cssClasses=e.SAFE_TIME}ngOnInit(){pw(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}setDuration(t){if(pw(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}changeDuration(e){let t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}displayDuration(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}start(){if(pw(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}resume(){if(pw(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();const t=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(()=>{this.onEndReached()},t),this.countSeconds()}onEndReached(){pw(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}countSeconds(){this.timeoutHandleSec=window.setTimeout(()=>{this.updateShownTime()},1e3)}isIdle(){return!1===this.started||this.isPaused}pause(){if(pw(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}stop(){if(pw(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}isStarted(){return this.started}getTimeClass(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}updateShownTime(){const e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}clearTimeouts(){pw(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}addTime(){this.addTimeToOpponent.emit()}ngOnDestroy(){this.clearTimeouts()}}return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){let e;return e=$localize`Add ${"\ufffd0\ufffd"}:INTERPOLATION:`,[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],e]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"p",1),Da(2),fu(3,"number"),fa(),aa(4,Dee,2,1,"button",2),fa()),2&e&&(ua("ngClass",t.getTimeClass()),Ts(2),Ba("",t.displayedMinute,":",function(e,t,n,r){const i=e+20,s=zt(),o=xt(s,i);return yu(s,mu(s,i)?du(s,Xt(),t,o.transform,n,r,o):o.transform(n,r))}(3,4,t.displayedSec,"2.0-0"),""),Ts(2),ua("ngIf",t.canAddTime))},directives:[Bd,zd],pipes:[jd],encapsulation:2}),e})();const Fee=["partCreation"],Bee=["chatComponent"],Vee=["chronoZeroGlobal"],Uee=["chronoOneGlobal"],$ee=["chronoZeroTurn"],zee=["chronoOneTurn"];function Hee(e,t){if(1&e){const e=ya();da(0,"app-part-creation",5,6),Ca("gameStartNotification",function(t){return Gt(e),ba().startGame(t)}),fa()}if(2&e){const e=ba();ua("partId",e.currentPartId)("userName",e.getPlayerName())}}function Gee(e,t){1&e&&(ga(0),Hc(1,40),ma())}function qee(e,t){1&e&&Hc(0,41),2&e&&(Gc(ba(4).currentPlayer),qc(0))}function Wee(e,t){if(1&e&&(da(0,"p",37),aa(1,Gee,2,0,"ng-container",38),aa(2,qee,1,1,"ng-template",null,39,Du),fa()),2&e){const e=ca(3),t=ba(3);Ts(1),ua("ngIf",t.currentPlayer===t.getPlayerName())("ngIfElse",e)}}function jee(e,t){if(1&e&&(da(0,"div",33),da(1,"p",34),Hc(2,35),fa(),aa(3,Wee,4,2,"p",36),fa()),2&e){const e=ba(2);Ts(2),Gc(e.currentPart.getTurn()+1),qc(2),Ts(1),ua("ngIf",!1===e.endGame)}}function Zee(e,t){if(1&e&&(da(0,"p",42),Da(1),fa()),2&e){const e=ba(2);ua("ngClass",e.getPlayerNameClass(0)),Ts(1),La(e.players[0].get())}}function Yee(e,t){if(1&e&&(da(0,"p",43),Hc(1,44),fa()),2&e){const e=ba(2);Ts(1),Gc(e.gameComponent.scores.get()[0]),qc(1)}}function Kee(e,t){if(1&e&&(da(0,"p",45),Da(1),fa()),2&e){const e=ba(2);ua("ngClass",e.getPlayerNameClass(1)),Ts(1),La(e.players[1].get())}}function Jee(e,t){if(1&e&&(da(0,"p",46),Hc(1,47),fa()),2&e){const e=ba(2);Ts(1),Gc(e.gameComponent.scores.get()[1]),qc(1)}}function Qee(e,t){if(1&e){const e=ya();da(0,"button",56),Ca("click",function(){return Gt(e),ba(3).resign()}),Hc(1,57),fa()}}function Xee(e,t){if(1&e){const e=ya();da(0,"button",58),Ca("click",function(){return Gt(e),ba(3).proposeDraw()}),Hc(1,59),fa()}}function ete(e,t){if(1&e){const e=ya();da(0,"button",60),Ca("click",function(){return Gt(e),ba(3).acceptDraw()}),Hc(1,61),fa()}}function tte(e,t){if(1&e){const e=ya();da(0,"button",62),Ca("click",function(){return Gt(e),ba(3).refuseDraw()}),Hc(1,63),fa()}}function nte(e,t){if(1&e){const e=ya();da(0,"button",64),Ca("click",function(){return Gt(e),ba(3).gameComponent.pass()}),Hc(1,65),fa()}}function rte(e,t){if(1&e){const e=ya();da(0,"button",66),Ca("click",function(){return Gt(e),ba(3).acceptTakeBack()}),Hc(1,67),fa()}}function ite(e,t){if(1&e){const e=ya();da(0,"button",68),Ca("click",function(){return Gt(e),ba(3).refuseTakeBack()}),Hc(1,69),fa()}}function ste(e,t){if(1&e){const e=ya();da(0,"button",70),Ca("click",function(){return Gt(e),ba(3).askTakeBack()}),Hc(1,71),fa()}}function ote(e,t){if(1&e&&(ga(0),aa(1,Qee,2,0,"button",48),aa(2,Xee,2,0,"button",49),aa(3,ete,2,0,"button",50),aa(4,tte,2,0,"button",51),aa(5,nte,2,0,"button",52),aa(6,rte,2,0,"button",53),aa(7,ite,2,0,"button",54),aa(8,ste,2,0,"button",55),ma()),2&e){const e=ba(2);Ts(1),ua("ngIf",e.canResign()),Ts(1),ua("ngIf",e.canProposeDraw()),Ts(1),ua("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ua("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ua("ngIf",!1===e.endGame&&e.isPlaying()&&e.gameComponent.canPass&&e.currentPlayer===e.getPlayerName()),Ts(1),ua("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ua("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ua("ngIf",!1===e.endGame&&!1===e.isOpponentWaitingForTakeBackResponse()&&e.canAskTakeBack())}}function ate(e,t){1&e&&(da(0,"div"),da(1,"p",73),Hc(2,74),fa(),fa())}function cte(e,t){1&e&&(da(0,"p",78),Hc(1,79),fa())}function lte(e,t){1&e&&(da(0,"p",80),Hc(1,81),fa())}function ute(e,t){1&e&&(da(0,"p",82),Hc(1,83),fa())}function hte(e,t){if(1&e&&(da(0,"div"),aa(1,cte,2,0,"p",75),aa(2,lte,2,0,"p",76),aa(3,ute,2,0,"p",77),fa()),2&e){const e=ba(3);Ts(1),ua("ngIf",e.currentPart.getDrawAccepter()===e.getPlayerName()),Ts(1),ua("ngIf",e.currentPart.getDrawAccepter()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ua("ngIf",!1===e.isPlaying())}}function dte(e,t){1&e&&(da(0,"p",86),Hc(1,87),fa())}function fte(e,t){1&e&&(da(0,"p",88),Hc(1,89),fa())}function pte(e,t){if(1&e&&(da(0,"p",88),Hc(1,90),fa()),2&e){const e=ba(4);Ts(1),Gc(e.currentPart.getWinner().get()),qc(1)}}function gte(e,t){if(1&e&&(da(0,"div"),aa(1,dte,2,0,"p",84),aa(2,fte,2,0,"p",85),aa(3,pte,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ua("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ua("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ua("ngIf",!1===e.isPlaying())}}function mte(e,t){if(1&e&&(da(0,"p",86),Hc(1,91),fa()),2&e){const e=ba(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function yte(e,t){1&e&&(da(0,"p",88),Hc(1,92),fa())}function vte(e,t){if(1&e&&(da(0,"p",88),Hc(1,93),fa()),2&e){const e=ba(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function _te(e,t){if(1&e&&(da(0,"div"),aa(1,mte,2,1,"p",84),aa(2,yte,2,0,"p",85),aa(3,vte,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ua("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ua("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ua("ngIf",!1===e.isPlaying())}}function Cte(e,t){1&e&&(da(0,"p",95),Hc(1,96),fa())}function Ete(e,t){if(1&e&&(da(0,"p",95),Hc(1,97),fa()),2&e){const e=ba(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function wte(e,t){if(1&e&&(da(0,"div"),aa(1,Cte,2,0,"p",94),aa(2,Ete,2,1,"p",94),fa()),2&e){const e=ba(3);Ts(1),ua("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ua("ngIf",!1===e.isPlaying()||e.currentPart.getWinner().get()===e.getPlayerName())}}function bte(e,t){if(1&e&&(da(0,"div",72),pa(1,"hr"),aa(2,ate,3,0,"div",26),aa(3,hte,4,3,"div",26),aa(4,gte,4,3,"div",26),aa(5,_te,4,3,"div",26),aa(6,wte,3,2,"div",26),fa()),2&e){const e=ba(2);Ts(2),ua("ngIf",e.currentPart.isHardDraw()),Ts(1),ua("ngIf",e.currentPart.isAgreedDraw()),Ts(1),ua("ngIf",e.currentPart.isWin()),Ts(1),ua("ngIf",e.currentPart.isTimeout()),Ts(1),ua("ngIf",e.currentPart.isResign())}}function Ste(e,t){1&e&&(da(0,"button",98),Hc(1,99),fa())}function Pte(e,t){if(1&e){const e=ya();da(0,"button",100),Ca("click",function(){return Gt(e),ba(2).proposeRematch()}),Hc(1,101),fa()}}function Ote(e,t){if(1&e){const e=ya();da(0,"button",102),Ca("click",function(){return Gt(e),ba(2).acceptRematch()}),Hc(1,103),fa()}}function Tte(e,t){if(1&e){const e=ya();da(0,"div",7),da(1,"div",8),da(2,"div",9),aa(3,jee,4,2,"div",10),da(4,"div",11),aa(5,Zee,2,2,"p",12),aa(6,Yee,2,1,"p",13),da(7,"app-count-down",14,15),Ca("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),da(9,"app-count-down",16,17),Ca("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),da(11,"p",18),Hc(12,19),fa(),da(13,"div",11),aa(14,Kee,2,2,"p",20),aa(15,Jee,2,1,"p",21),da(16,"app-count-down",22,23),Ca("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),da(18,"app-count-down",24,25),Ca("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),pa(20,"hr"),aa(21,ote,9,8,"ng-container",26),aa(22,bte,7,5,"div",27),aa(23,Ste,2,0,"button",28),aa(24,Pte,2,0,"button",29),aa(25,Ote,2,0,"button",30),fa(),fa(),da(26,"div",31),da(27,"div",32),pa(28,"app-game-includer"),fa(),fa(),fa()}if(2&e){const e=ba();Ts(3),ua("ngIf",e.currentPart),Ts(2),ua("ngIf",e.players[0].isPresent()),Ts(1),ua("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ua("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ua("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(5),ua("ngIf",e.players[1].isPresent()),Ts(1),ua("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ua("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ua("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(3),ua("ngIf",e.isPlaying()),Ts(1),ua("ngIf",e.endGame),Ts(1),ua("ngIf",e.endGame),Ts(1),ua("ngIf",e.endGame&&e.isPlaying()&&!1===e.rematchProposed),Ts(1),ua("ngIf",e.endGame&&e.isPlaying()&&e.rematchProposed&&e.opponentProposedRematch),Ts(1),ua("ngClass",e.getBoardHighlight())}}class Ite{constructor(e){this.value=e}}Ite.PRE_START_DOC=new Ite("PRE_START_DOC"),Ite.STARTING_DOC=new Ite("STARTING_DOC"),Ite.DUPLICATE=new Ite("DUPLICATE"),Ite.MOVE_WITHOUT_TIME=new Ite("MOVE_WITHOUT_TIME"),Ite.MOVE=new Ite("MOVE"),Ite.REQUEST=new Ite("REQUEST"),Ite.END_GAME=new Ite("END_GAME"),Ite.END_GAME_WITHOUT_TIME=new Ite("END_GAME_WITHOUT_TIME"),Ite.ACCEPT_TAKE_BACK_WITHOUT_TIME=new Ite("ACCEPT_TAKE_BACK_WITHOUT_TIME");let kte=(()=>{class e extends uee{constructor(t,n,r,i,s,o){super(t,n,s),this.router=r,this.userService=i,this.gameService=o,this.gameStarted=!1,this.opponent=null,this.playerName=null,this.rematchProposed=!1,this.opponentProposedRematch=!1,this.hasUserPlayed=[!1,!1],this.msToSubstract=[0,0],this.opponentSubscription=vw.empty(),this.OFFLINE_FONT_COLOR={color:"lightgrey"},this.globalTimeMessage=$localize`5 minutes`,this.turnTimeMessage=$localize`30 seconds`,pw(e.VERBOSE,"OnlineGameWrapperComponent constructed")}extractPartIdFromURL(){return fw.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}extractGameTypeFromURL(){return fw.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}isPlaying(){return this.observerRole===VY.ZERO.value||this.observerRole===VY.ONE.value}getPlayer(){return VY.of(this.observerRole)}getPlayerName(){return fw.getNonNullable(this.playerName)}isPlayer(e){return this.observerRole===e.value}isOpponent(e){return this.observerRole!==e.value}redirectIfPartIsInvalid(){var e=this;return dw(function*(){const t=e.extractGameTypeFromURL();if((yield e.gameService.getPartValidity(e.currentPartId,t)).isFailure()){const t="/notFound";e.routerEventsSub.unsubscribe(),yield e.router.navigate([t])}})()}setCurrentPartIdOrRedirect(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartIsInvalid()}ngOnInit(){var t=this;return dw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),t.routerEventsSub=t.router.events.subscribe(function(){var e=dw(function*(e){e instanceof Tm&&(yield t.setCurrentPartIdOrRedirect())});return function(t){return e.apply(this,arguments)}}()),t.userSub=t.authenticationService.getUserObs().subscribe(e=>{t.playerName=e.username.get()}),yield t.setCurrentPartIdOrRedirect()})()}startGame(t){var n=this;return dw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.startGame"),MG(!1===n.gameStarted,"Should not start already started game"),n.joiner=t,n.gameStarted=!0,setTimeout(()=>{n.afterGameIncluderViewInit(),n.startPart()},1)})()}startPart(){var t=this;pw(e.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,function(){var e=dw(function*(e){MG(e.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),yield t.onCurrentPartUpdate(e.get())});return function(t){return e.apply(this,arguments)}}())}onCurrentPartUpdate(t){var n=this;return dw(function*(){const r=new RG(n.currentPartId,t);pw(e.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:n.currentPart,then:t.data,before_part_turn:r.data.turn,before_state_turn:n.gameComponent.rules.node.gameState.turn,nbPlayedMoves:r.data.listMoves.length}});const i=n.getUpdateType(r),s=t.turn;pw(e.VERBOSE,i===Ite.REQUEST?"UpdateType: Request("+fw.getNonNullable(r.data.request).code+") ("+s+")":"UpdateType: "+i.value+"("+s+")");const o=n.currentPart;switch(n.currentPart=r,i){case Ite.REQUEST:return yield n.onRequest(fw.getNonNullable(r.data.request),o);case Ite.ACCEPT_TAKE_BACK_WITHOUT_TIME:return void(n.currentPart=o);case Ite.DUPLICATE:return;case Ite.END_GAME_WITHOUT_TIME:return void(n.currentPart=o);case Ite.END_GAME:return n.applyEndGame();case Ite.MOVE_WITHOUT_TIME:return void(n.currentPart=o);case Ite.MOVE:return n.msToSubstract=n.getLastUpdateTime(o,r,i),n.doNewMoves(r);case Ite.PRE_START_DOC:const e=null==n.currentPart||null!=n.currentPart.data.beginning;return void MG(null==o||null==o.data.beginning||e,"old part had no beginning time or new part has, we did not expect this!");default:return MG(i===Ite.STARTING_DOC,"Unexpected update type "+i),n.setChronos(),n.setPlayersDatas(r),n.startCountDownFor(VY.ZERO)}})()}getUpdateType(t){const n=hee.from(null!=this.currentPart?this.currentPart.data:null,t.data);pw(e.VERBOSE,{diff:n});const r=n.countChanges();if(0===r)return Ite.DUPLICATE;if(t.data.request){const e=null!=n.removed.lastUpdateTime;return"TakeBackAccepted"===t.data.request.code&&e?Ite.ACCEPT_TAKE_BACK_WITHOUT_TIME:Ite.REQUEST}if(this.isMove(n,r))return 1===t.data.turn?null==t.data.lastUpdateTime?Ite.MOVE_WITHOUT_TIME:Ite.MOVE:null==n.modified.lastUpdateTime?Ite.MOVE_WITHOUT_TIME:Ite.MOVE;if(null==t.data.beginning)return Ite.PRE_START_DOC;if(t.data.result!==xG.UNACHIEVED.value){const e=null==n.modified.lastUpdateTime;return null!=n.modified.turn&&e?Ite.END_GAME_WITHOUT_TIME:Ite.END_GAME}return MG(null!=t.data.beginning&&0===t.data.listMoves.length,"Unexpected update: "+JSON.stringify(n)),Ite.STARTING_DOC}isMove(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){const n=3;return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+n}return!1}getLastUpdateTime(e,t,n){const r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);MG(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),MG(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");const s=VY.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(fw.getNonNullable(r),fw.getNonNullable(i),n,s)}getMoreRecentTime(e){return e.data.lastUpdateTime??e.data.beginning}getTimeUsedForLastTurn(e,t,n,r){const i=function(e,t){return fee(t)-fee(e)}(e,t),s=[0,0];return s[r.value]=i,s}setChronos(){pw(e.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}didUserPlay(e){return this.hasUserPlayed[e.value]}doNewMoves(e){this.switchPlayer();const t=LG.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;for(;n.node.gameState.turn<t.length;){const e=n.node.gameState.turn,r=this.gameComponent.encoder.decode(t[e]),i=n.isLegal(r,n.node.gameState),s="We received an incorrect db move: "+r.toString()+" in "+t+" at turn "+e+'because "'+i.getReasonOr("")+'"';MG(i.isSuccess(),s),n.choose(r)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}switchPlayer(){pw(e.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");const t=VY.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();const n=t.getOpponent();this.didUserPlay(n)&&this.pauseCountDownsFor(n),this.didUserPlay(t)?(pw(e.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(t)):this.startCountDownFor(t)}resetChronoFor(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}applyEndGame(){const t=this.currentPart,n=VY.fromTurn(t.data.turn);this.endGame=!0,[xG.VICTORY,xG.HARD_DRAW].some(e=>e.value===t.data.result)?this.doNewMoves(this.currentPart):(MG(!0===[xG.RESIGN,xG.TIMEOUT,xG.HARD_DRAW,xG.AGREED_DRAW_BY_ZERO,xG.AGREED_DRAW_BY_ONE].some(e=>e.value===t.data.result),"Unknown type of end game ("+t.data.result+")"),pw(e.VERBOSE,"endGame est true et winner est "+t.getWinner())),this.stopCountdownsFor(n)}notifyDraw(e,t){this.endGame=!0;const n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}notifyTimeoutVictory(e,t,n,r){var i=this;return dw(function*(){i.endGame=!0;const s=i.currentPart.setWinnerAndLoser(e,r);i.currentPart=s,yield i.gameService.notifyTimeout(i.currentPartId,t,n,e,r)})()}notifyVictory(t,n){pw(e.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");const r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===yQ.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(MG(r===yQ.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;const i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,t,[0,0],n,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}canAskTakeBack(){return MG(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===VY.NONE}isOpponentWaitingForTakeBackResponse(){const e=this.getTakeBackRequester();return e!==VY.NONE&&this.isOpponent(e)}getTakeBackRequester(){if(null==this.currentPart)return VY.NONE;const e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?UY.getPlayer(e):VY.NONE}canProposeDraw(){return MG(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&UY.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===VY.NONE}isOpponentWaitingForDrawResponse(){const e=this.getDrawRequester();return e!==VY.NONE&&this.isOpponent(e)}getDrawRequester(){if(null==this.currentPart)return VY.NONE;const e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?UY.getPlayer(e):VY.NONE}onRequest(t,n){var r=this;return dw(function*(){switch(pw(e.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:t,oldPart:n}),t.code){case"TakeBackAsked":case"TakeBackRefused":break;case"TakeBackAccepted":r.takeBackTo(r.currentPart.data.turn);break;case"RematchProposed":r.rematchProposed=!0;const n=UY.getPlayer(t).getOpponent();r.isPlayer(n)&&(pw(e.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0);break;case"RematchAccepted":yield r.router.navigate(["/nextGameLoading"]),yield r.router.navigate(["/play",UY.getTypeGame(t),UY.getPartId(t)]);break;case"DrawProposed":case"DrawRefused":break;case"AddTurnTime":const i=3e4,s=VY.of(t.data.player);r.addTurnTimeTo(s,i);break;case"AddGlobalTime":const o=3e5,a=VY.of(t.data.player);r.addGlobalTimeTo(a,o);break;default:fw.expectToBe(t.code,"DrawAccepted","Unknown RequestType : "+t.code+" for "+JSON.stringify(t)),yield r.acceptDraw()}})()}takeBackTo(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();const t=VY.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}setPlayersDatas(t){pw(e.VERBOSE,{OnlineGameWrapper_setPlayersDatas:t}),this.players=[vw.of(t.data.playerZero),vw.ofNullable(t.data.playerOne)],MG(null!=t.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[t.data.turn%2].get();let n=vw.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=VY.ZERO.value,n=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=VY.ONE.value,n=this.players[0]):this.observerRole=VY.NONE.value,n.isPresent()){const e=new UG(e=>{this.opponent=e[0].data},e=>{this.opponent=e[0].data},e=>{throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))});this.opponentSubscription=vw.of(this.userService.observeUserByUsername(n.get(),e))}}onLegalUserMove(t,n){var r=this;return dw(function*(){if(pw(e.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),!r.isOpponentWaitingForTakeBackResponse())return r.updateDBBoard(t,r.msToSubstract,n);r.gameComponent.message("You must answer to take back request")})()}updateDBBoard(t,n,r){var i=this;return dw(function*(){const s=i.gameComponent.encoder.encodeMove(t);pw(e.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+t.toString()+", "+r+")"),i.gameComponent.rules.choose(t);const o=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node);if(o.isEndGame)return o===yQ.DRAW?i.notifyDraw(s,r):i.notifyVictory(s,r);{const e=i.getPlayer();return i.gameService.updateDBBoard(i.currentPartId,e,s,n,r)}})()}resign(){var e=this;return dw(function*(){const t=e.getLastIndex(),n=e.getPlayer(),r=e.players[e.observerRole%2].get(),i=e.players[(e.observerRole+1)%2].get();yield e.gameService.resign(e.currentPartId,t,n,i,r)})()}getLastIndex(){return this.currentPart.data.lastUpdate.index}reachedOutOfTime(t){var n=this;return dw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+t+")");const r=n.getLastIndex(),i=n.getPlayer();n.stopCountdownsFor(VY.of(t));const s=fw.getNonNullable(n.opponent);if(t===n.observerRole){const e=fw.getNonNullable(s.username);yield n.notifyTimeoutVictory(e,i,r,n.getPlayerName())}else if(n.endGame)pw(!0,"time might be better handled in the future");else if(n.opponentIsOffline()){const e=fw.getNonNullable(s.username);yield n.notifyTimeoutVictory(n.getPlayerName(),i,t,e),n.endGame=!0}})()}acceptRematch(){var e=this;return dw(function*(){MG(e.isPlaying(),"Non playing should not call acceptRematch");const t=new RG(e.currentPartId,e.currentPart.data);return yield e.gameService.acceptRematch(t,e.getLastIndex(),e.getPlayer()),!0})()}proposeRematch(){var e=this;return dw(function*(){return MG(e.isPlaying(),"Non playing should not call proposeRematch"),yield e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer()),!0})()}proposeDraw(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptDraw(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}refuseDraw(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}askTakeBack(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptTakeBack(){var e=this;return dw(function*(){const t=e.getPlayer();yield e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,t,e.msToSubstract),e.msToSubstract=[0,0]})()}refuseTakeBack(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}startCountDownFor(t){pw(e.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[t.value]=!0,t===VY.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}resumeCountDownFor(t,n=!0){let r;pw(e.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===VY.ZERO?(this.chronoZeroGlobal.changeDuration(fw.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),r=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(fw.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),r=this.chronoOneTurn),n?(r.setDuration(1e3*this.joiner.maximalMoveDuration),r.start()):r.resume()}pauseCountDownsFor(t,n=!0){let r;pw(e.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+t.value+") (turn "+this.currentPart.data.turn+")"),t===VY.ZERO?(this.chronoZeroGlobal.pause(),r=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),r=this.chronoOneTurn),n?r.stop():r.pause()}stopCountdownsFor(t){pw(e.VERBOSE,"cdc::stopCountDownsFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===VY.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}getPlayerNameClass(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}opponentIsOffline(){return null!=this.opponent&&"offline"===this.opponent.state}canResign(){return MG(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}addGlobalTime(){const e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}addTurnTime(){const e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}addTurnTimeTo(e,t){const n=VY.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===VY.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}addGlobalTimeTo(e,t){e===VY.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}ngOnDestroy(){null!=this.routerEventsSub&&null!=this.routerEventsSub.unsubscribe&&this.routerEventsSub.unsubscribe(),null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(rl),la(xy),la(t_),la(HG),la(MY),la(qY))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){if(1&e&&(Mu(Fee,5),Mu(Bee,5),Mu(Vee,5),Mu(Uee,5),Mu($ee,5),Mu(zee,5)),2&e){let e;Nu(e=xu())&&(t.partCreation=e.first),Nu(e=xu())&&(t.chatComponent=e.first),Nu(e=xu())&&(t.chronoZeroGlobal=e.first),Nu(e=xu())&&(t.chronoOneGlobal=e.first),Nu(e=xu())&&(t.chronoZeroTurn=e.first),Nu(e=xu())&&(t.chronoOneTurn=e.first)}},features:[Ho],decls:5,vars:4,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,v,_,C,E,w,b,S,P,O,T,I;return e=$localize`vs.`,t=$localize`Turn n°${"\ufffd0\ufffd"}:INTERPOLATION:`,n=$localize`It is your turn.`,r=$localize`It is ${"\ufffd0\ufffd"}:INTERPOLATION:'s turn.`,i=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Resign`,a=$localize`Propose a draw`,c=$localize`Accept draw`,l=$localize`Reject draw`,u=$localize`Pass a turn`,h=$localize`Accept take back`,d=$localize`Reject take back`,f=$localize`Ask to take back one move`,p=$localize`Draw`,g=$localize`You agreed to draw.`,m=$localize`Your draw proposal has been accepted.`,y=$localize`Players agreed to draw.`,v=$localize`You won.`,_=$localize`You lost.`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won.`,E=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit. You won.`,w=$localize`You reached your time limit.`,b=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit.`,S=$localize`You resigned.`,P=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has resigned.`,O=$localize`Go back to the game list`,T=$localize`Propose to play again`,I=$localize`Accept to play again`,[["id","partCreation",3,"partId","userName","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","userName","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],e,["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],t,["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],n,r,["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],i,["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],s,["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],o,["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],a,["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],c,["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],l,["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],u,["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],h,["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],d,["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],f,["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],p,["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],g,["id","yourOpponentAgreedToDrawIndicator",1,"title"],m,["id","playersAgreedToDraw",1,"title"],y,["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],v,[1,"title"],_,C,E,w,b,["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],S,P,["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],O,["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],T,["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],I]},template:function(e,t){1&e&&(aa(0,Hee,2,2,"app-part-creation",0),aa(1,Tte,29,27,"div",1),da(2,"div",2),da(3,"div",3),pa(4,"app-chat",4),fa(),fa()),2&e&&(ua("ngIf",!1===t.gameStarted),Ts(1),ua("ngIf",t.gameStarted),Ts(3),ua("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[zd,K9,Ree,Lee,Bd,cee,r_],encapsulation:2}),e})();function Ate(e,t){if(1&e&&(da(0,"option",25),Da(1),fa()),2&e){const e=t.$implicit;ua("value",e.name),Ts(1),La(e.name)}}function Nte(e,t){if(1&e&&(da(0,"option",25),Hc(1,29),fa()),2&e){const e=t.$implicit;ua("value",e),Ts(1),Gc(e),qc(1)}}const Mte=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function xte(e,t){if(1&e){const e=ya();da(0,"select",26),Ca("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[0]=t})("change",function(){return Gt(e),ba(2).updatePlayer(0)}),da(1,"option",27),Hc(2,28),fa(),aa(3,Nte,2,2,"option",16),fa()}2&e&&(ua("ngModel",ba(2).aiDepths[0]),Ts(3),ua("ngForOf",ou(2,Mte)))}function Rte(e,t){if(1&e&&(da(0,"p",30),Hc(1,31),fa()),2&e){const e=ba(2);Ts(1),Gc(e.gameComponent.scores.get()[0]),qc(1)}}function Dte(e,t){if(1&e&&(da(0,"option",25),Da(1),fa()),2&e){const e=t.$implicit;ua("value",e.name),Ts(1),La(e.name)}}function Lte(e,t){if(1&e&&(da(0,"option",25),Hc(1,34),fa()),2&e){const e=t.$implicit;ua("value",e),Ts(1),Gc(e),qc(1)}}function Fte(e,t){if(1&e){const e=ya();da(0,"select",32),Ca("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[1]=t})("change",function(){return Gt(e),ba(2).updatePlayer(1)}),da(1,"option",27),Hc(2,33),fa(),aa(3,Lte,2,2,"option",16),fa()}2&e&&(ua("ngModel",ba(2).aiDepths[1]),Ts(3),ua("ngForOf",ou(2,Mte)))}function Bte(e,t){if(1&e&&(da(0,"p",35),Hc(1,36),fa()),2&e){const e=ba(2);Ts(1),Gc(e.gameComponent.scores.get()[1]),qc(1)}}function Vte(e,t){if(1&e&&(da(0,"h4"),Hc(1,40),fa()),2&e){const e=ba(3);Ts(1),Gc(e.winner.get()),qc(1)}}function Ute(e,t){1&e&&(da(0,"h4",41),Hc(1,42),fa())}function $te(e,t){if(1&e&&(da(0,"div",37),aa(1,Vte,2,1,"h4",38),aa(2,Ute,2,0,"h4",39),fa()),2&e){const e=ba(2);Ts(1),ua("ngIf",e.winner.isPresent()),Ts(1),ua("ngIf",e.winner.isAbsent())}}function zte(e,t){if(1&e){const e=ya();da(0,"div",6),da(1,"div",7),da(2,"p",8),Hc(3,9),fa(),fa(),da(4,"div",10),da(5,"div",11),da(6,"div",12),da(7,"select",13),Ca("change",function(){return Gt(e),ba().updatePlayer(0)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[0]=t}),da(8,"option",14),Hc(9,15),fa(),aa(10,Ate,2,2,"option",16),fa(),fa(),da(11,"div",12),aa(12,xte,4,3,"select",17),fa(),aa(13,Rte,2,1,"p",18),fa(),da(14,"div",19),da(15,"div",12),da(16,"select",20),Ca("change",function(){return Gt(e),ba().updatePlayer(1)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[1]=t}),da(17,"option",14),Hc(18,21),fa(),aa(19,Dte,2,2,"option",16),fa(),fa(),da(20,"div",12),aa(21,Fte,4,3,"select",22),fa(),aa(22,Bte,2,1,"p",23),fa(),fa(),aa(23,$te,3,2,"div",24),fa()}if(2&e){const e=ba();Ts(3),Gc(e.gameComponent.rules.node.gameState.turn+1),qc(3),Ts(4),ua("ngModel",e.playerSelection[0]),Ts(3),ua("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ua("ngIf",!1===e.players[0].equalsValue("human")),Ts(1),ua("ngIf",e.gameComponent.scores.isPresent()),Ts(3),ua("ngModel",e.playerSelection[1]),Ts(3),ua("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ua("ngIf",!1===e.players[1].equalsValue("human")),Ts(1),ua("ngIf",e.gameComponent.scores.isPresent()),Ts(1),ua("ngIf",e.endGame)}}function Hte(e,t){if(1&e&&(ga(0),Da(1),pa(2,"br"),ma()),2&e){const e=t.$implicit,n=ba(3);Ts(1),Fa(" ",e.name+": "+e.getBoardValue(n.gameComponent.rules.node)," ")}}function Gte(e,t){if(1&e&&(ga(0),aa(1,Hte,3,1,"ng-container",48),Da(2),pa(3,"br"),Da(4),pa(5,"br"),ma()),2&e){const e=ba(2);Ts(1),ua("ngForOf",e.gameComponent.availableMinimaxes),Ts(1),Fa(" Created ",e.getCreatedNodes()," nodes."),Ts(2),Fa(" Minimax time: ",e.getMinimaxTime(),"ms.")}}function qte(e,t){if(1&e){const e=ya();da(0,"button",49),Ca("click",function(){return Gt(e),ba(2).gameComponent.pass()}),Hc(1,50),fa()}}function Wte(e,t){if(1&e){const e=ya();da(0,"button",51),Ca("click",function(){return Gt(e),ba(2).takeBack()}),Hc(1,52),fa()}}function jte(e,t){if(1&e){const e=ya();da(0,"div",43),aa(1,Gte,6,3,"ng-container",38),aa(2,qte,2,0,"button",44),aa(3,Wte,2,0,"button",45),da(4,"button",46),Ca("click",function(){return Gt(e),ba().restartGame()}),Hc(5,47),fa(),fa()}if(2&e){const e=ba();Ts(1),ua("ngIf",e.gameComponent.rules.node.move),Ts(1),ua("ngIf",!1===e.endGame&&e.gameComponent.canPass),Ts(1),ua("ngIf",e.canTakeBack())}}let Zte=(()=>{class e extends uee{constructor(t,n,r,i,s){super(t,n,r),this.cdr=i,this.messageDisplayer=s,this.aiDepths=["0","0"],this.playerSelection=["human","human"],this.winner=vw.empty(),this.botTimeOut=1e3,this.players=[vw.of(this.playerSelection[0]),vw.of(this.playerSelection[1])],pw(e.VERBOSE,"LocalGameWrapper.constructor")}getCreatedNodes(){return gQ.createdNodes}getMinimaxTime(){return gQ.minimaxTime}ngAfterViewInit(){setTimeout(()=>{this.afterGameIncluderViewInit(),this.restartGame(),this.cdr.detectChanges()},1)}updatePlayer(e){this.players[e]=vw.of(this.playerSelection[e]),this.proposeAIToPlay()}onLegalUserMove(t){var n=this;return dw(function*(){pw(e.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),n.gameComponent.rules.choose(t),n.updateBoard(),n.proposeAIToPlay()})()}updateBoard(){this.gameComponent.updateBoard();const e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner!==VY.NONE&&(this.winner=vw.of($localize`Player ${e.winner.value+1}`)))}proposeAIToPlay(){var e=this;const t=this.getPlayingAI();t.isPresent()&&setTimeout(dw(function*(){yield e.doAIMove(t.get())}),this.botTimeOut)}getPlayingAI(){if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return vw.empty();const e=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[e]?vw.empty():vw.ofNullable(this.gameComponent.availableMinimaxes.find(t=>this.players[e].equalsValue(t.name)))}doAIMove(e){var t=this;return dw(function*(){const n=t.gameComponent.rules;MG(n.getGameStatus(n.node)===yQ.ONGOING,"IA should not try to play when game is over!");const r=Number.parseInt(t.aiDepths[n.node.gameState.turn%2%2]),i=n.node.findBestMove(r,e,!0);return n.choose(i)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),kG.SUCCESS):(t.messageDisplayer.criticalMessage($localize`The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!`),NG.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:i.toString()}))})()}canTakeBack(){return this.gameComponent.rules.node.gameState.turn>0}takeBack(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}isAITurn(){return this.getPlayingAI().isPresent()}restartGame(){const e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new mQ(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=vw.empty(),this.proposeAIToPlay()}getPlayerName(){return"human"}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(rl),la(xy),la(MY),la(xl),la(WJ))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-wrapper"]],features:[Ho],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`Turn n°${"\ufffd0\ufffd"}:INTERPOLATION:`,t=$localize`Human`,n=$localize`Human`,r=$localize`Pick the level`,i=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Pick the level`,a=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,c=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,l=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won`,u=$localize`Draw`,h=$localize`Start a new game`,d=$localize`Pass a turn`,f=$localize`Take back move`,[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],e,["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],t,[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],n,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],r,i,["id","scoreOne",1,"block"],s,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],o,a,["id","scoreZero",1,"block"],c,["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],l,["id","draw"],u,[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],h,[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],d,["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],f]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"div",1),aa(2,zte,24,10,"div",2),aa(3,jte,6,3,"div",3),fa(),da(4,"div",4),da(5,"div",5),pa(6,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(2),ua("ngIf",t.gameComponent),Ts(1),ua("ngIf",t.gameComponent),Ts(1),ua("ngClass",t.getBoardHighlight()))},directives:[zd,Bd,cee,hg,Ep,Xp,dg,mg,Ud],encapsulation:2,changeDetection:0}),e})(),Yte=(()=>{class e{}return e.STEP_FINISHED=()=>$localize`Step finished!`,e.INFORMATIONAL_STEP=()=>$localize`This step is not expecting any move from your part.`,e})();function Kte(e,t){if(1&e&&(da(0,"div",20),da(1,"div",21),Hc(2,22),fa(),da(3,"div",23),Da(4),fa(),fa()),2&e){const e=ba();Ts(4),La(e.currentReason.get())}}function Jte(e,t){if(1&e){const e=ya();da(0,"button",24),Ca("click",function(){return Gt(e),ba().retry()}),Hc(1,25),fa()}}function Qte(e,t){1&e&&(ga(0),Hc(1,30),ma())}function Xte(e,t){1&e&&(ga(0),Hc(1,31),ma())}function ene(e,t){if(1&e&&aa(0,Xte,2,0,"ng-container",27),2&e){ba();const e=ca(5),t=ba();ua("ngIf",t.stepFinished&&t.stepFinished[t.stepIndex])("ngIfElse",e)}}function tne(e,t){1&e&&(ga(0),Hc(1,32),ma())}function nne(e,t){if(1&e){const e=ya();da(0,"button",26),Ca("click",function(){return Gt(e),ba().next()}),aa(1,Qte,2,0,"ng-container",27),aa(2,ene,1,2,"ng-template",null,28,Du),aa(4,tne,2,0,"ng-template",null,29,Du),fa()}if(2&e){const e=ca(3),t=ba();Ts(1),ua("ngIf",t.steps[t.stepIndex]&&t.steps[t.stepIndex].isInformation())("ngIfElse",e)}}function rne(e,t){if(1&e){const e=ya();da(0,"button",33),Ca("click",function(){return Gt(e),ba().start()}),Hc(1,34),fa()}}function ine(e,t){if(1&e){const e=ya();da(0,"button",35),Ca("click",function(){return Gt(e),ba().playLocally()}),Hc(1,36),fa()}}function sne(e,t){if(1&e){const e=ya();da(0,"button",37),Ca("click",function(){return Gt(e),ba().createGame()}),Hc(1,38),fa()}}function one(e,t){if(1&e){const e=ya();da(0,"button",39),Ca("click",function(){return Gt(e),ba().showSolution()}),Hc(1,40),fa()}}function ane(e,t){if(1&e&&(ga(0),da(1,"option",42),Da(2),fa(),ma()),2&e){const e=ba(),t=e.index,n=e.$implicit;Ts(1),Pa("id","step_",t,""),ua("value",t),Ts(1),La(n.title)}}function cne(e,t){1&e&&(ga(0),Da(1,"v "),ma())}function lne(e,t){1&e&&Da(0,"x ")}function une(e,t){if(1&e&&(da(0,"option",43),aa(1,cne,2,0,"ng-container",27),aa(2,lne,1,0,"ng-template",null,44,Du),da(4,"span",45),Da(5),fa(),fa()),2&e){const e=ca(3),t=ba(),n=t.index,r=t.$implicit,i=ba();ua("value",n),Ts(1),ua("ngIf",i.stepFinished[n])("ngIfElse",e),Ts(3),Pa("id","step_",n,""),Ts(1),La(r.title)}}function hne(e,t){if(1&e&&(ga(0),aa(1,ane,3,3,"ng-container",27),aa(2,une,6,5,"ng-template",null,41,Du),ma()),2&e){const e=t.index,n=ca(3),r=ba();Ts(1),ua("ngIf",e===r.stepIndex)("ngIfElse",n)}}let dne=(()=>{class e extends uee{constructor(t,n,r,i,s){super(t,n,i),this.router=r,this.cdr=s,this.COMPLETED_TUTORIAL_MESSAGE=$localize`Congratulations, you completed the tutorial.`,this.steps=[],this.successfulSteps=0,this.stepIndex=-1,this.currentMessage="",this.currentReason=vw.empty(),this.moveAttemptMade=!1,this.stepFinished=[],this.tutorialOver=!1,pw(e.VERBOSE,"TutorialGameWrapperComponent.constructor")}getNumberOfSteps(){return this.steps.length}getCurrentStepTitle(){return this.steps.length>0?this.steps[this.stepIndex].title:""}ngAfterViewInit(){pw(e.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),this.afterGameIncluderViewInit(),this.start()}start(){this.startTutorial(this.gameComponent.tutorial)}startTutorial(t){pw(e.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:t}}),this.steps=t,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}getCompletionArray(){return this.steps.map(()=>!1)}changeStep(e){this.showStep(Number.parseInt(e.target.value,10))}showStep(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.showStep("+t+")"),this.moveAttemptMade=!1,this.stepFinished[t]=!1,this.updateSuccessCount(),this.stepIndex=t;const n=this.steps[this.stepIndex];this.currentMessage=n.instruction,this.currentReason=vw.empty(),this.gameComponent.rules.node=new mQ(n.state,vw.empty(),n.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}onLegalUserMove(t){var n=this;return dw(function*(){pw(e.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:t}});const r=n.steps[n.stepIndex];if(MG(n.gameComponent.rules.choose(t),"It should be impossible to call onLegalUserMove with an illegal move"),pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),n.gameComponent.updateBoard(),n.moveAttemptMade=!0,r.isPredicate()){const e=n.gameComponent.rules.node.gameState,i=fw.getNonNullable(r.predicate)(t,e);i.isSuccess()?n.showStepSuccess(r.getSuccessMessage()):n.currentReason=vw.of(i.getReason())}else if(r.isAnyMove())pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(r.getSuccessMessage());else{MG(r.isMove(),"cannot reach here with a click step");const i=r;i.acceptedMoves.some(e=>e.equals(t))?(pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(i.getSuccessMessage())):(pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),n.currentReason=vw.of(i.getFailureMessage()))}n.cdr.detectChanges()})()}retry(){pw(e.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}onUserClick(t){if(pw(e.VERBOSE,"tutorialGameWrapper.onUserClick("+t+")"),this.currentReason=vw.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return kG.failure(Yte.STEP_FINISHED());const n=this.steps[this.stepIndex];return n.isClick()?(this.gameComponent.updateBoard(),fw.getNonNullable(n.acceptedClicks).some(e=>e===t)?this.showStepSuccess(n.getSuccessMessage()):this.currentMessage=n.getFailureMessage(),kG.SUCCESS):n.isMove()||n.isPredicate()||n.isAnyMove()?(setTimeout(()=>{this.cdr.detectChanges()},10),kG.SUCCESS):kG.failure(Yte.INFORMATIONAL_STEP())}onCancelMove(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+t+")"),void 0!==t&&(this.currentReason=vw.of(t)),this.cdr.detectChanges()}showStepSuccess(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=t,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}updateSuccessCount(){let e=0;for(const t of this.stepFinished)t&&e++;this.successfulSteps=e}next(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{let e=(this.stepIndex+1)%this.steps.length;for(;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}showSolution(){var t=this;return dw(function*(){pw(e.VERBOSE,"tutorialGameWrapper.showSolution()");const n=t.steps[t.stepIndex];MG(n.hasSolution(),"showSolution called on a step with no solution, this should not be reachable");const r=n,i=r.getSolution();t.showStep(t.stepIndex),t.gameComponent.rules.choose(i),t.gameComponent.updateBoard(),t.moveAttemptMade=!0,t.currentMessage=r.getSuccessMessage(),t.cdr.detectChanges()})()}playLocally(){var e=this;return dw(function*(){const t=fw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/local",t])})()}createGame(){var e=this;return dw(function*(){const t=fw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/play",t])})()}getPlayerName(){return""}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(la(rl),la(xy),la(t_),la(MY),la(xl))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[Ho],decls:22,vars:15,consts:function(){let e,t,n,r,i,s,o,a,c;return e=$localize`Failure`,t=$localize`Try again`,n=$localize`Ok`,r=$localize`Continue`,i=$localize`Skip`,s=$localize`Try again`,o=$localize`Play locally`,a=$localize`Create an online game`,c=$localize`See solution`,[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],e,["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],t,["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],n,r,i,["id","restartButton",1,"button",3,"click"],s,["id","playLocallyButton",1,"button",3,"click"],o,["id","playOnlineButton",1,"button",3,"click"],a,["id","showSolutionButton",1,"button",3,"click"],c,["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"div",1),da(2,"div",2),pa(3,"progress",3),da(4,"div",4),da(5,"p",5),Da(6),fa(),pa(7,"p",6),fa(),aa(8,Kte,5,1,"div",7),da(9,"div",8),aa(10,Jte,2,0,"button",9),aa(11,nne,6,2,"button",10),aa(12,rne,2,0,"button",11),aa(13,ine,2,0,"button",12),aa(14,sne,2,0,"button",13),aa(15,one,2,0,"button",14),da(16,"div",15),da(17,"select",16),Ca("change",function(e){return t.changeStep(e)}),aa(18,hne,4,2,"ng-container",17),fa(),fa(),fa(),fa(),fa(),da(19,"div",18),da(20,"div",19),pa(21,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(3),ra("value",t.successfulSteps)("max",t.getNumberOfSteps()),Ts(3),Va("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),Ts(1),ua("innerHTML",t.currentMessage,vi),Ts(1),ua("ngIf",t.currentReason.isPresent()),Ts(2),ua("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),Ts(1),ua("ngIf",!1===t.tutorialOver),Ts(1),ua("ngIf",t.tutorialOver),Ts(1),ua("ngIf",t.tutorialOver),Ts(1),ua("ngIf",t.tutorialOver),Ts(1),ua("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),Ts(3),ua("ngForOf",t.steps),Ts(1),ua("ngClass",t.getBoardHighlight()))},directives:[zd,Ud,Bd,cee,dg,mg],encapsulation:2,changeDetection:0}),e})();function fne(e,t){if(1&e&&(da(0,"div",35),da(1,"div",36),Hc(2,37),fa(),da(3,"div",38),Da(4),fa(),fa()),2&e){const e=ba();Ts(4),La(e.errorMessage)}}const pne=function(){return["/login"]};let gne=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.faEye=QY,this.registrationForm=new Wp({email:new qp,username:new qp,password:new qp})}registerWithEmail(){var e=this;return dw(function*(){const t=e.registrationForm.value.username,n=e.registrationForm.value.email,r=e.registrationForm.value.password;if(null==t||null==n||null==r)e.errorMessage=$localize`There are missing fields in the registration form, please check that you filled in all fields.`;else{const i=yield e.authService.doRegister(t,n,r);if(i.isSuccess()){const t=yield e.authService.sendEmailVerification();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()}else e.errorMessage=i.getReason()}})()}registerWithGoogle(){var e=this;return dw(function*(){const t=yield e.authService.doGoogleLogin();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()})()}getPasswordHelpClass(){const e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}canRegister(){const e=this.registrationForm.value.password||"";return!(""===(this.registrationForm.value.email||"")||""===(this.registrationForm.value.username||"")||""===e||e.length<6)}}return e.\u0275fac=function(t){return new(t||e)(la(MY),la(t_))},e.\u0275cmp=Xe({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`Registering`,t=$localize`Email`,n=$localize`Email`,r=$localize`A confirmation email will be sent to validate your account.`,i=$localize`Username`,s=$localize`Username`,o=$localize`Password`,a=$localize`Password`,c=$localize`The password should be at least 6 characters long`,l=$localize`Register`,u=$localize`Register with Google`,h=$localize`Have an account?`,d=$localize`Log in`,f=$localize`Registration error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",n,"type","email","autofocus","","required","",1,"input"],[1,"help"],r,["for","username",1,"label"],i,["id","username","formControlName","username","name","username","placeholder",s,"type","text","required","",1,"input"],["for","password",1,"label"],o,[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",a,"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],c,["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],l,[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],u,[1,"help","level-right"],h,[3,"routerLink"],d,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],f,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"p",1),Hc(2,2),fa(),da(3,"form",3),da(4,"div",4),da(5,"div",5),da(6,"label",6),Hc(7,7),fa(),fa(),da(8,"div",8),da(9,"div",9),da(10,"div",10),pa(11,"input",11),da(12,"p",12),Hc(13,13),fa(),fa(),fa(),fa(),fa(),da(14,"div",4),da(15,"div",5),da(16,"label",14),Hc(17,15),fa(),fa(),da(18,"div",8),da(19,"div",9),da(20,"div",10),pa(21,"input",16),fa(),fa(),fa(),fa(),da(22,"div",4),da(23,"div",5),da(24,"label",17),Hc(25,18),fa(),fa(),da(26,"div",8),da(27,"div",9),da(28,"div",19),pa(29,"input",20),da(30,"span",21),pa(31,"fa-icon",22),fa(),da(32,"p",23),Hc(33,24),fa(),fa(),fa(),fa(),fa(),da(34,"div",4),pa(35,"div",5),da(36,"div",8),da(37,"div",9),da(38,"div",10),da(39,"button",25),Ca("click",function(){return t.registerWithEmail()}),Hc(40,26),fa(),fa(),fa(),fa(),fa(),da(41,"div",4),pa(42,"div",5),da(43,"div",27),aa(44,fne,5,1,"div",28),fa(),fa(),da(45,"div",4),pa(46,"div",5),da(47,"div",8),da(48,"button",29),Ca("click",function(){return t.registerWithGoogle()}),Hc(49,30),fa(),fa(),fa(),da(50,"p",31),ga(51),Hc(52,32),ma(),Da(53,"\xa0 "),da(54,"a",33),Hc(55,34),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ua("formGroup",t.registrationForm),Ts(28),ua("icon",t.faEye),Ts(1),ua("ngClass",t.getPasswordHelpClass()),Ts(7),ua("disabled",!t.canRegister()),Ts(5),ua("ngIf",t.errorMessage),Ts(10),ua("routerLink",ou(6,pne)))},directives:[eg,wp,og,qf,Ep,cg,M9,vg,PJ,x9,Bd,zd,i_],encapsulation:2}),e})(),mne=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}playLocally(){var e=this;return dw(function*(){yield e.router.navigate(["local/"+e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(la(t_))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Play offline`,[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(da(0,"app-pick-game",0),Ca("pickGame",function(e){return t.pickGame(e)}),fa(),da(1,"button",1),Ca("click",function(){return t.playLocally()}),Hc(2,2),fa()),2&e&&(Ts(1),ua("disabled",!t.selectedGame))},directives:[T9],encapsulation:2}),e})(),yne=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}launchTutorial(){var e=this;return dw(function*(){yield e.router.navigate(["/tutorial/",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(la(t_))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Learn the rules`,[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(da(0,"app-pick-game",0),Ca("pickGame",function(e){return t.pickGame(e)}),fa(),da(1,"button",1),Ca("click",function(){return t.launchTutorial()}),Hc(2,2),fa()),2&e&&(Ts(1),ua("disabled",!t.selectedGame))},directives:[T9],encapsulation:2}),e})(),vne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){let e;return e=$localize`The replay game is loading, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(da(0,"p"),Hc(1,0),fa())},encapsulation:2}),e})();const _ne={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1};let Cne=(()=>{class e{constructor(e){this.authService=e}canActivate(){var e=this;return dw(function*(){return new Promise(t=>{e.userSub=e.authService.getUserObs().subscribe(function(){var n=dw(function*(n){yield e.evaluateUserPermission(n).then(t)});return function(e){return n.apply(this,arguments)}}())})})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(MY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ene=(()=>{class e extends Cne{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return dw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MY),Or(t_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function wne(e,t){1&e&&(da(0,"p",20),Hc(1,21),fa())}function bne(e,t){if(1&e){const e=ya();da(0,"div",7),da(1,"p",8),Hc(2,9),fa(),da(3,"div",10),da(4,"p",11),Hc(5,12),fa(),da(6,"button",13),Ca("click",function(){return Gt(e),ba().finalizeEmailVerification()}),Hc(7,14),fa(),fa(),da(8,"div",15),da(9,"p",11),Hc(10,16),fa(),da(11,"button",17),Ca("click",function(){return Gt(e),ba().sendEmailVerification()}),Hc(12,18),fa(),fa(),aa(13,wne,2,0,"p",19),fa()}if(2&e){const e=ba();Ts(2),Gc(e.emailAddress),qc(2),Ts(11),ua("ngIf",e.success)}}function Sne(e,t){if(1&e){const e=ya();da(0,"div",24),da(1,"div",8),Hc(2,25),fa(),da(3,"form",26),da(4,"div",27),da(5,"div",28),pa(6,"input",29),fa(),da(7,"div",28),da(8,"button",30),Ca("click",function(){Gt(e);const t=ba(2);return t.pickUsername(t.usernameForm.value)}),Hc(9,31),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba(2);Ts(3),ua("formGroup",e.usernameForm)}}const Pne=function(){return["/lobby"]};function One(e,t){1&e&&(da(0,"div",32),$c(1,33),pa(2,"a",34),zc(),fa()),2&e&&(Ts(2),ua("routerLink",ou(1,Pne)))}function Tne(e,t){if(1&e&&(ga(0),aa(1,Sne,10,1,"div",22),aa(2,One,3,2,"div",23),ma()),2&e){const e=ba();Ts(1),ua("ngIf",!e.success),Ts(1),ua("ngIf",e.success)}}function Ine(e,t){if(1&e&&(da(0,"div",35),da(1,"div",36),Da(2),fa(),fa()),2&e){const e=ba();Ts(2),La(e.errorMessage)}}let kne=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new Wp({username:new qp})}ngOnInit(){var e=this;return dw(function*(){e.userSub=e.authService.getUserObs().subscribe(function(){var t=dw(function*(t){e.emailAddress=t.email.get(),t.username.isAbsent()?e.verificationType="enter-username":(e.verificationType="send-email",!0===e.triedToFinalize&&!1===t.verified&&(e.errorMessage=$localize`You have not verified your email! Click on the link in the verification email.`),!0===t.verified&&(yield e.router.navigate(["/lobby"])))});return function(e){return t.apply(this,arguments)}}())})()}pickUsername(e){var t=this;return dw(function*(){const n=yield t.authService.setUsername(e.username);n.isSuccess()?t.success=!0:t.errorMessage=n.getReason()})()}sendEmailVerification(){var e=this;return dw(function*(){const t=yield e.authService.sendEmailVerification();t.isSuccess()?e.success=!0:e.errorMessage=t.getReason()})()}finalizeEmailVerification(){var e=this;return dw(function*(){e.triedToFinalize=!0,yield e.authService.reloadUser()})()}ngOnDestroy(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(la(MY),la(t_))},e.\u0275cmp=Xe({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c,l,u;return e=$localize`Account verification`,t=$localize`In order to finalize your account, you must click on the link that you should have received on your email address (${"\ufffd0\ufffd"}:INTERPOLATION:). The email could be in your spam folder.`,n=$localize`Once you have verified your email, click on the following button:`,r=$localize`Finalize email verification`,i=$localize`If you have not received the verification email, click on the following button:`,s=$localize`Send verification email again`,o=$localize`The email has been sent`,a=$localize`In order to finalize your account, you must choose a username.`,c=$localize`Username`,l=$localize`Pick username`,u=$localize`Your account has now been finalized, you can go back to the ${"\ufffd#2\ufffd"}:START_LINK:list of games${"\ufffd/#2\ufffd"}:CLOSE_LINK:.`,[[1,"box"],[1,"message","is-info"],[1,"message-header"],e,["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],t,[1,"block","level-left"],[1,"level-item"],n,["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],r,[1,"level-left"],i,["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],s,["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],o,["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],a,[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",c,"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],l,["id","success",1,"message-body"],u,[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"div",1),da(2,"div",2),Hc(3,3),fa(),aa(4,bne,14,2,"div",4),aa(5,Tne,3,2,"ng-container",5),fa(),aa(6,Ine,3,1,"div",6),fa()),2&e&&(Ts(4),ua("ngIf","send-email"===t.verificationType),Ts(1),ua("ngIf","enter-username"===t.verificationType),Ts(1),ua("ngIf",t.errorMessage))},directives:[zd,eg,wp,og,qf,vg,Ep,cg,i_],encapsulation:2}),e})(),Ane=(()=>{class e extends Cne{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return dw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MY),Or(t_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Nne=(()=>{class e extends Cne{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return dw(function*(){return!1===e.isConnected()||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MY),Or(t_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Mne(e,t){1&e&&(da(0,"p",12),Hc(1,13),fa())}function xne(e,t){if(1&e&&(da(0,"div",14),da(1,"div",15),Hc(2,16),fa(),da(3,"div",17),Da(4),fa(),fa()),2&e){const e=ba();Ts(4),La(e.errorMessage.get())}}const Rne=function(){return{standalone:!0}};let Dne=(()=>{class e{constructor(e){this.authService=e,this.success=!1,this.errorMessage=vw.empty(),this.email=""}resetPassword(){var e=this;return dw(function*(){MG(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=vw.empty(),e.success=!1;const t=yield e.authService.sendPasswordResetEmail(e.email);t.isSuccess()?e.success=!0:e.errorMessage=vw.of(t.getReason())})()}}return e.\u0275fac=function(t){return new(t||e)(la(MY))},e.\u0275cmp=Xe({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){let e,t,n,r,i,s;return e=$localize`Password reset`,t=$localize`Email`,n=$localize`An email will be sent with instruction to reset your password.`,r=$localize`Reset password`,i=$localize`The email has been sent, please follow the instructions from that email.`,s=$localize`Error`,[[1,"box"],[1,"title"],e,[1,"field"],[1,"control"],["id","email","name","email","placeholder",t,"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],n,["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],r,["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],i,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],s,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"p",1),Hc(2,2),fa(),da(3,"div",3),da(4,"div",4),da(5,"input",5),Ca("ngModelChange",function(e){return t.email=e}),fa(),da(6,"p",6),Hc(7,7),fa(),aa(8,Mne,2,0,"p",8),fa(),fa(),da(9,"button",9),Ca("click",function(){return t.resetPassword()}),Hc(10,10),fa(),aa(11,xne,5,1,"div",11),fa()),2&e&&(Ts(5),ua("ngModel",t.email)("ngModelOptions",ou(5,Rne)),Ts(3),ua("ngIf",t.success),Ts(1),ua("disabled",""===t.email),Ts(2),ua("ngIf",t.errorMessage.isPresent()))},directives:[qf,M9,vg,Ep,Xp,zd],encapsulation:2}),e})();function Lne(e,t){if(1&e&&(da(0,"option",13),Da(1),fa()),2&e){const e=t.$implicit,n=ba();ua("value",e.value)("selected",e.value===n.currentTheme),Ts(1),Fa(" ",e.name," ")}}function Fne(e,t){if(1&e&&(da(0,"option",13),Da(1),fa()),2&e){const e=t.$implicit,n=ba();ua("value",e.value)("selected",e.value===n.currentLanguage),Ts(1),Fa(" ",e.name," ")}}let Bne=(()=>{class e{constructor(e,t){this.userSettingsService=e,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize`Light`},{value:"dark",name:$localize`Dark`}],this.currentTheme=t.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}changeLanguage(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}changeTheme(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}reload(){window.open(window.location.href,"_self")}}return e.\u0275fac=function(t){return new(t||e)(la(jY),la(ZY))},e.\u0275cmp=Xe({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){let e,t,n;return e=$localize`User settings`,t=$localize`Theme`,n=$localize`Language`,[[1,"box"],[1,"title"],e,[1,"field"],["for","theme",1,"label"],t,[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],n,["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(da(0,"div",0),da(1,"p",1),Hc(2,2),fa(),da(3,"div",3),da(4,"label",4),Hc(5,5),fa(),da(6,"div",6),da(7,"div",7),da(8,"select",8),Ca("change",function(e){return t.changeTheme(e)}),aa(9,Lne,2,3,"option",9),fa(),fa(),fa(),fa(),da(10,"div",3),da(11,"label",10),Hc(12,11),fa(),da(13,"div",6),da(14,"div",7),da(15,"select",12),Ca("change",function(e){return t.changeLanguage(e)}),aa(16,Fne,2,3,"option",9),fa(),fa(),fa(),fa(),fa()),2&e&&(Ts(9),ua("ngForOf",t.availableThemes),Ts(7),ua("ngForOf",t.availableLanguages))},directives:[Ud,dg,mg],encapsulation:2}),e})(),Vne=(()=>{class e{}return e.ALREADY_INGAME=()=>$localize`You are already in a game. Finish it or cancel it first.`,e})(),Une=(()=>{class e{constructor(e,t,n,r,i,s){this.route=e,this.router=t,this.authenticationService=n,this.messageDisplayer=r,this.partDAO=i,this.gameService=s}ngOnInit(){var e=this;return dw(function*(){yield e.createGameAndRedirectOrShowError(e.extractGameFromURL())})()}extractGameFromURL(){return fw.getNonNullable(this.route.snapshot.paramMap.get("compo"))}createGameAndRedirectOrShowError(e){var t=this;return dw(function*(){const n=t.authenticationService.user.get();MG(n.isConnected(),"User must be connected and have a username to reach this page");const r=n.username.get();if(yield t.canCreateOnlineGame(r)){const n=yield t.gameService.createPartJoinerAndChat(r,e);return yield t.router.navigate(["/play",e,n]),!0}return t.messageDisplayer.infoMessage(Vne.ALREADY_INGAME()),yield t.router.navigate(["/lobby"]),!1})()}canCreateOnlineGame(e){var t=this;return dw(function*(){return!1===(yield t.partDAO.userHasActivePart(e))})()}}return e.\u0275fac=function(t){return new(t||e)(la(xy),la(t_),la(MY),la(WJ),la(DG),la(qY))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){let e;return e=$localize`Creating online game, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(da(0,"p"),Hc(1,0),fa())},encapsulation:2}),e})();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[ja.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),Ha[t]=e,n&&(Ha[t][ja.ExtraData]=n)}(e,void 0,void 0)}(uw());const $ne=[{path:"login",component:F9},{path:"lobby",component:see,canActivate:[Ene]},{path:"settings",component:Bne},{path:"register",component:gne,canActivate:[Nne]},{path:"reset-password",component:Dne,canActivate:[Nne]},{path:"notFound",component:oee},{path:"nextGameLoading",component:vne,canActivate:[Ene]},{path:"verify-account",component:kne,canActivate:[Ane]},{path:"play",component:V9,canActivate:[Ene]},{path:"play/:compo",component:Une,canActivate:[Ene]},{path:"play/:compo/:id",component:kte,canActivate:[Ene]},{path:"local",component:mne},{path:"local/:compo",component:Zte},{path:"tutorial",component:yne},{path:"tutorial/:compo",component:dne},{path:"",component:N9},{path:"**",component:N9}];class zne{static app(){return function(e,...t){return{ngModule:AT,providers:[{provide:OT,useFactory:kT(e),multi:!0,deps:[rh,$o,yT,...t]}]}}(()=>(_ne.useEmulators&&(_ne.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),NT(_ne.firebaseConfig)))}static firestore(){return function(e,...t){return{ngModule:hG,providers:[{provide:aG,useFactory:cG(e),multi:!0,deps:[rh,$o,yT,PT,[new Mr,xN],[new Mr,uI],...t]}]}}(()=>{const e=_G(),t=e.toJSON().settings.host;return _ne.useEmulators&&"localhost:8080"!==t&&pG(e,"localhost",8080),e})}static database(){return function(e,...t){return{ngModule:bY,providers:[{provide:_Y,useFactory:CY(e),multi:!0,deps:[rh,$o,yT,PT,[new Mr,xN],[new Mr,uI],...t]}]}}(()=>{const e=PY();return _ne.useEmulators&&!1===e._instanceStarted&&SY(e,"localhost",9e3),e})}static auth(){return function(e,...t){return{ngModule:BN,providers:[{provide:RN,useFactory:DN(e),multi:!0,deps:[rh,$o,yT,PT,[new Mr,uI],...t]}]}}(()=>{const e=$N();return _ne.useEmulators&&null==e.config.emulator&&VN(e,"http://localhost:9099",{disableWarnings:!0}),e})}}let Hne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e,bootstrap:[BJ]}),e.\u0275inj=Se({providers:[MY,qY,GY,HG,VG,DG,ZY,{provide:qu,useValue:WY.getLocale()}],imports:[[zne.app(),zne.firestore(),zne.auth(),zne.database(),Nf,am,m_.forRoot($ne,{useHash:!1}),bg,wg,cw,OJ]]}),e})();"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self;"undefined"!=typeof global&&global;class Gne{constructor(e){this.digits=e}static zero(){return new Gne([0])}static one(){return new Gne([1])}clone(){return new Gne(this.digits.slice())}add(e){const t=this.clone();return t.addToSelf(e),t}addToSelf(e){const t=Math.max(this.digits.length,e.digits.length);let n=0;for(let r=0;r<t;r++){let t=n;r<this.digits.length&&(t+=this.digits[r]),r<e.digits.length&&(t+=e.digits[r]),t>=10?(this.digits[r]=t-10,n=1):(this.digits[r]=t,n=0)}n>0&&(this.digits[t]=1)}toString(){let e="";for(let t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}class qne{constructor(e){this.powerOfTwos=[e]}getValue(){return this.powerOfTwos[0]}multiplyBy(e){const t=Gne.zero();return this.multiplyByAndAddTo(e,t),t}multiplyByAndAddTo(e,t){for(let n=0;0!==e;e>>>=1,n++)if(1&e){const e=this.getMultipliedByPowerOfTwo(n);t.addToSelf(e)}}getMultipliedByPowerOfTwo(e){for(let t=this.powerOfTwos.length;t<=e;t++){const e=this.powerOfTwos[t-1];this.powerOfTwos[t]=e.add(e)}return this.powerOfTwos[e]}}class Wne{constructor(e){this.base=e,this.exponents=[new qne(Gne.one())]}toThePowerOf(e){for(let t=this.exponents.length;t<=e;t++){const e=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new qne(e)}return this.exponents[e]}}function jne(e){const t=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){const t=e.charCodeAt(n+1);t>=56320&&t<=57343&&(n++,r=(r-55296<<10)+t-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e);let n=Zne(t,0),r=Zne(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function Zne(e,t){let n,r=2654435769,i=2654435769;const s=e.length;for(n=0;n+12<=s;n+=12){r=Jne(r,tre(e,n,Kne.Little)),i=Jne(i,tre(e,n+4,Kne.Little));const s=Yne(r,i,t=Jne(t,tre(e,n+8,Kne.Little)));r=s[0],i=s[1],t=s[2]}return r=Jne(r,tre(e,n,Kne.Little)),i=Jne(i,tre(e,n+4,Kne.Little)),t=Jne(t,s),Yne(r,i,t=Jne(t,tre(e,n+8,Kne.Little)<<8))[2]}function Yne(e,t,n){return e=Xne(e,t),e=Xne(e,n),e^=n>>>13,t=Xne(t,n),t=Xne(t,e),t^=e<<8,n=Xne(n,e),n=Xne(n,t),n^=t>>>13,e=Xne(e,t),e=Xne(e,n),e^=n>>>12,t=Xne(t,n),t=Xne(t,e),t^=e<<16,n=Xne(n,e),n=Xne(n,t),n^=t>>>5,e=Xne(e,t),e=Xne(e,n),e^=n>>>3,t=Xne(t,n),t=Xne(t,e),t^=e<<10,n=Xne(n,e),n=Xne(n,t),[e,t,n^=t>>>15]}var Kne=(()=>((Kne=Kne||{})[Kne.Little=0]="Little",Kne[Kne.Big=1]="Big",Kne))();function Jne(e,t){return Qne(e,t)[1]}function Qne(e,t){const n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function Xne(e,t){const n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function ere(e,t){return t>=e.length?0:e[t]}function tre(e,t,n){let r=0;if(n===Kne.Big)for(let i=0;i<4;i++)r+=ere(e,t+i)<<24-8*i;else for(let i=0;i<4;i++)r+=ere(e,t+i)<<8*i;return r}const nre=new Wne(256);function rre(e,t,n,r,i=[]){const s={},o={},a=function(e,t){const{text:n,block:r}=ire(e,t);if(void 0===r)return{text:n};{const[e,...t]=r.split("\u241f"),[i,s]=e.split("@@",2);let[o,a]=i.split("|",2);return void 0===a&&(a=o,o=void 0),""===a&&(a=void 0),{text:n,meaning:o,description:a,customId:s,legacyIds:t}}}(e[0],e.raw[0]),c=[a.text],l=[];let u=a.text;for(let f=1;f<e.length;f++){const{text:n,block:r=sre(f)}=ire(e[f],e.raw[f]);u+=`{$${r}}${n}`,void 0!==t&&(s[r]=t[f-1],o[r]=i[f-1]),l.push(r),c.push(n)}const h=a.customId||function(e,t=""){let n=jne(e);if(t){const e=jne(t);n=function(e,t){const n=e[0],r=t[0],i=Qne(e[1],t[1]),s=i[0],o=i[1];return[Jne(Jne(n,r),s),o]}(function(e,t){const n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),e)}return function(e,t){const n=nre.toThePowerOf(0).multiplyBy(t);return nre.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(u,a.meaning||""),d=a.legacyIds?a.legacyIds.filter(e=>e!==h):[];return{id:h,legacyIds:d,substitutions:s,substitutionLocations:o,text:u,customId:a.customId,meaning:a.meaning||"",description:a.description||"",messageParts:c,messagePartLocations:r,placeholderNames:l,location:n}}function ire(e,t){if(":"!==t.charAt(0))return{text:e};{const n=function(e,t){for(let n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}}function sre(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});class ore extends Error{constructor(e){super(`No translation found for ${cre(e)}.`),this.parsedMessage=e,this.type="MissingTranslationError"}}function are(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function cre(e){const t=e.meaning&&` - "${e.meaning}"`,n=e.legacyIds&&e.legacyIds.length>0?` [${e.legacyIds.map(e=>`"${e}"`).join(", ")}]`:"";return`"${e.id}"${n} ("${e.text}"${t})`}function lre(e,t){try{return function(e,t,n){const r=rre(t,n);let i=e[r.id];if(void 0!==r.legacyIds)for(let s=0;s<r.legacyIds.length&&void 0===i;s++)i=e[r.legacyIds[s]];if(void 0===i)throw new ore(r);return[i.messageParts,i.placeholderNames.map(e=>{if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error(`There is a placeholder name mismatch with the translation provided for the message ${cre(r)}.\nThe translation contains a placeholder with name ${e}, which does not exist in the message.`)})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function ure(){_ne.production&&function(){if(gh)throw new Error("Cannot enable prod mode after platform setup.");ph=!1}(),kf().bootstrapModule(Hne).catch(e=>console.error(e))}const hre=WY.getLocale();"en"!==hre?fetch(_ne.root+"assets/"+hre+".json").then(e=>e.ok?e.json():{locale:"en",translations:{}}).then(e=>{(function(e){$localize.translate||($localize.translate=lre),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(t=>{$localize.TRANSLATIONS[t]=function(e){const t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[];for(let s=1;s<t.length-1;s+=2)r.push(t[s]),n.push(`${t[s+1]}`);const i=n.map(e=>":"===e.charAt(0)?"\\"+e:e);return{text:e,messageParts:are(n,i),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,ure()}).catch(function(e){console.log(e)}):ure()}},function(e){e(e.s=2912)}]);