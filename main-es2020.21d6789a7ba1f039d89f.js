(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},9575:function(e,t,n){var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(0,t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0!==(s="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=s)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},5378:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++)n=arguments[r]??{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))});return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){var e;return null!==(e=h)&&void 0!==e?e:document}var c={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},l=n({},c),u={},h=null,d=function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0},f=function(){function e(t){var n=this;r(this,e),this.element=a().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),s=["notification",this.extraClasses];if(this.type&&s.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),c=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";s.push("animate__animated ".concat(o," ").concat(c)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=s.join(" "),this.dismissible){var l=a().createElement("button");l.className="delete",l.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",l)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var u=new p(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){u.pause()}),this.element.addEventListener("mouseout",function(){u.resume()}))}return s(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete u.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete u.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),p=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return s(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){l=n({},c)},e.setDefaults=function(e){l=n(n({},c),e)},e.setDoc=function(e){for(var t in u)u[t].remove();u={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},l),e),r=new f(t),i=function(e,t,n,r,i,s){if(u.position)return u.position;var o=a().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+d(t,n,r,i,s)),e.appendChild(o),u.position=o,o}(t.appendTo||a().body,t.position||l.position,t.offsetTop||l.offsetTop,t.offsetBottom||l.offsetBottom,t.offsetLeft||l.offsetLeft,t.offsetRight||l.offsetRight);if(t.single)for(var s=i.lastElementChild;s;)i.removeChild(s),s=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},6676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function r(e,t,r){var i,s=new Promise(function(s,o){n(i=e[t].apply(e,r)).then(s,o)});return s.request=i,s}function i(e,t,n){var i=r(e,t,n);return i.then(function(e){if(e)return new u(e,i.request)})}function s(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,t,n,i){i.forEach(function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})})}function a(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function c(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})})}function l(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function h(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function p(e){this._db=e}s(l,"_index",["name","keyPath","multiEntry","unique"]),o(l,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(l,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(u,"_cursor",["direction","key","primaryKey","value"]),o(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),h.prototype.createIndex=function(){return new l(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new l(this._store.index.apply(this._store,arguments))},s(h,"_store",["name","keyPath","indexNames","autoIncrement"]),o(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(h,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[h,l].forEach(function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,s=i[e].apply(i,n.slice(0,-1));s.onsuccess=function(){r(s.result)}})})}),[l,h].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(i){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)})})})}),e.openDb=function(e,t,n){var i=r(indexedDB,"open",[e,t]),s=i.request;return s&&(s.onupgradeneeded=function(e){n&&n(new f(s.result,e.oldVersion,s.transaction))}),i.then(function(e){return new p(e)})},e.deleteDb=function(e){return r(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})}(t)},4928:function(e,t,n){"use strict";function r(e){return"function"==typeof e}function i(e){const t=e(e=>{Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const s=i(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function o(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class a{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const e of i)e.remove(this);else i.remove(this);const{initialTeardown:o}=this;if(r(o))try{o()}catch(t){e=t instanceof s?t.errors:[t]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const t of a)try{u(t)}catch(n){e=e??[],n instanceof s?e=[...e,...n.errors]:e.push(n)}}if(e)throw new s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)u(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&o(t,e)}remove(e){const{_teardowns:t}=this;t&&o(t,e),e instanceof a&&e._removeParent(this)}}a.EMPTY=(()=>{const e=new a;return e.closed=!0,e})();const c=a.EMPTY;function l(e){return e instanceof a||e&&"closed"in e&&r(e.remove)&&r(e.add)&&r(e.unsubscribe)}function u(e){r(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function f(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function p(){}const g=m("C",void 0,void 0);function m(e,t,n){return{kind:e,value:t,error:n}}let y=null;function v(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!y;if(t&&(y={errorThrown:!1,error:null}),e(),t){const{errorThrown:e,error:t}=y;if(y=null,e)throw t}}else e()}class _ extends a{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,l(e)&&e.add(this)):this.destination=S}static create(e,t,n){return new C(e,t,n)}next(e){this.isStopped?b(m("N",e,void 0),this):this._next(e)}error(e){this.isStopped?b(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?b(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class C extends _{constructor(e,t,n){let i;if(super(),r(e))i=e;else if(e){let r;({next:i,error:t,complete:n}=e),this&&h.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe()):r=e,i=null==i?void 0:i.bind(r),t=null==t?void 0:t.bind(r),n=null==n?void 0:n.bind(r)}this.destination={next:i?E(i):p,error:E(t??w),complete:n?E(n):p}}}function E(e,t){return(...t)=>{try{e(...t)}catch(n){h.useDeprecatedSynchronousErrorHandling?function(e){h.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):f(n)}}}function w(e){throw e}function b(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const S={closed:!0,next:p,error:w,complete:p},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(e){return e}let T=(()=>{class e{constructor(e){e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const i=function(e){return e&&e instanceof _||function(e){return e&&r(e.next)&&r(e.error)&&r(e.complete)}(e)&&l(e)}(e)?e:new C(e,t,n);return v(()=>{const{operator:e,source:t}=this;i.add(e?e.call(i,t):t?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return new(t=I(t))((t,n)=>{const r=new C({next:t=>{try{e(t)}catch(i){n(i),r.unsubscribe()}},error:n,complete:t});this.subscribe(r)})}_subscribe(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}[P](){return this}pipe(...e){return function(e){return 0===e.length?O:1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}}(e)(this)}toPromise(e){return new(e=I(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function I(e){var t;return null!==(t=e??h.Promise)&&void 0!==t?t:Promise}const k=i(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let A=(()=>{class e extends T{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const t=new N(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new k}next(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){const t=this.observers.slice();for(const n of t)n.next(e)}})}error(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:t,isStopped:n,observers:r}=this;return t||n?c:(r.push(e),new a(()=>o(r,e)))}_checkFinalizedStatuses(e){const{hasError:t,thrownError:n,isStopped:r}=this;t?e.error(n):r&&e.complete()}asObservable(){const e=new T;return e.source=this,e}}return e.create=(e,t)=>new N(e,t),e})();class N extends A{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:c}}function M(e){return r(null==e?void 0:e.lift)}function x(e){return t=>{if(M(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class R extends _{constructor(e,t,n,r,i){super(e),this.onFinalize=i,this._next=t?function(n){try{t(n)}catch(r){e.error(r)}}:super._next,this._error=r?function(t){try{r(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function D(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>{r.next(e.call(t,n,i++))}))})}function L(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function B(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(c,l):u(s[0][2],e)}(i[e](t))}catch(n){u(s[0][3],n)}}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function U(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}const V=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $(e){return r(null==e?void 0:e.then)}function z(e){return r(e[P])}function H(e){return Symbol.asyncIterator&&r(null==e?void 0:e[Symbol.asyncIterator])}function G(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const q="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function W(e){return r(null==e?void 0:e[q])}function j(e){return B(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:e,done:n}=yield F(t.read());if(n)return yield F(void 0);yield yield F(e)}}finally{t.releaseLock()}})}function Z(e){return r(null==e?void 0:e.getReader)}function Y(e){if(e instanceof T)return e;if(null!=e){if(z(e))return function(e){return new T(t=>{const n=e[P]();if(r(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(V(e))return function(e){return new T(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($(e))return function(e){return new T(t=>{e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,f)})}(e);if(H(e))return K(e);if(W(e))return function(e){return new T(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Z(e))return function(e){return K(j(e))}(e)}throw G(e)}function K(e){return new T(t=>{(function(e,t){var n,r,i,s;return function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,a)}c((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=U(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(e=>t.error(e))})}function J(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Q(e,t,n=1/0){return r(t)?Q((n,r)=>D((e,i)=>t(n,e,r,i))(Y(e(n,r))),n):("number"==typeof t&&(n=t),x((t,r)=>function(e,t,n,r,i,s,o,a){const c=[];let l=0,u=0,h=!1;const d=()=>{h&&!c.length&&!l&&t.complete()},f=e=>l<r?p(e):c.push(e),p=e=>{l++;let i=!1;Y(n(e,u++)).subscribe(new R(t,e=>{t.next(e)},()=>{i=!0},void 0,()=>{if(i)try{for(l--;c.length&&l<r;){const e=c.shift();p(e)}d()}catch(e){t.error(e)}}))};return e.subscribe(new R(t,f,()=>{h=!0,d()})),()=>{}}(t,r,e,n)))}function X(e=1/0){return Q(O,e)}const ee=new T(e=>e.complete());function te(e){return e[e.length-1]}function ne(e){return r(te(e))?e.pop():void 0}function re(e){return function(e){return e&&r(e.schedule)}(te(e))?e.pop():void 0}function ie(e,t=0){return x((n,r)=>{n.subscribe(new R(r,n=>J(r,e,()=>r.next(n),t),()=>J(r,e,()=>r.complete(),t),n=>J(r,e,()=>r.error(n),t)))})}function se(e,t=0){return x((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(n=>{J(n,t,()=>{const r=e[Symbol.asyncIterator]();J(n,t,()=>{r.next().then(e=>{e.done?n.complete():n.next(e.value)})},0,!0)})})}function ae(e,t){return t?function(e,t){if(null!=e){if(z(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(V(e))return function(e,t){return new T(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if($(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(H(e))return oe(e,t);if(W(e))return function(e,t){return new T(n=>{let i;return J(n,t,()=>{i=e[q](),J(n,t,()=>{let e,t;try{({value:e,done:t}=i.next())}catch(r){return void n.error(r)}t?n.complete():n.next(e)},0,!0)}),()=>r(null==i?void 0:i.return)&&i.return()})}(e,t);if(Z(e))return function(e,t){return oe(j(e),t)}(e,t)}throw G(e)}(e,t):Y(e)}function ce(e){return e<=0?()=>ee:x((t,n)=>{let r=0;t.subscribe(new R(n,t=>{++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function le(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(ce(1)).subscribe(()=>e())}function ue(e){for(let t in e)if(e[t]===ue)return t;throw Error("Could not find renamed property on target object.")}function he(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function de(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(de).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function fe(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const pe=ue({__forward_ref__:ue});function ge(e){return e.__forward_ref__=ge,e.toString=function(){return de(this())},e}function me(e){return ye(e)?e():e}function ye(e){return"function"==typeof e&&e.hasOwnProperty(pe)&&e.__forward_ref__===ge}class ve extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function _e(e){return"string"==typeof e?e:null==e?"":String(e)}function Ce(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_e(e)}function Ee(e,t){const n=t?` in ${t}`:"";throw new ve("201",`No provider for ${Ce(e)} found${n}`)}function we(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}function be(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Se(e){return{providers:e.providers||[],imports:e.imports||[]}}function Pe(e){return Oe(e,Ie)||Oe(e,Ae)}function Oe(e,t){return e.hasOwnProperty(t)?e[t]:null}function Te(e){return e&&(e.hasOwnProperty(ke)||e.hasOwnProperty(Ne))?e[ke]:null}const Ie=ue({"\u0275prov":ue}),ke=ue({"\u0275inj":ue}),Ae=ue({ngInjectableDef:ue}),Ne=ue({ngInjectorDef:ue});var Me=(()=>((Me=Me||{})[Me.Default=0]="Default",Me[Me.Host=1]="Host",Me[Me.Self=2]="Self",Me[Me.SkipSelf=4]="SkipSelf",Me[Me.Optional=8]="Optional",Me))();let xe;function Re(e){const t=xe;return xe=e,t}function De(e,t,n){const r=Pe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Me.Optional?null:void 0!==t?t:void Ee(de(e),"Injector")}function Le(e){return{toString:e}.toString()}var Fe=(()=>((Fe=Fe||{})[Fe.OnPush=0]="OnPush",Fe[Fe.Default=1]="Default",Fe))(),Be=(()=>((Be=Be||{})[Be.Emulated=0]="Emulated",Be[Be.None=2]="None",Be[Be.ShadowDom=3]="ShadowDom",Be))();const Ue="undefined"!=typeof globalThis&&globalThis,Ve="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ze=Ue||"undefined"!=typeof global&&global||Ve||$e,He={},Ge=[],qe=ue({"\u0275cmp":ue}),We=ue({"\u0275dir":ue}),je=ue({"\u0275pipe":ue}),Ze=ue({"\u0275mod":ue}),Ye=ue({"\u0275loc":ue}),Ke=ue({"\u0275fac":ue}),Je=ue({__NG_ELEMENT_ID__:ue});let Qe=0;function Xe(e){return Le(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Fe.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Ge,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Be.Emulated,id:"c",styles:e.styles||Ge,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Qe++,n.inputs=it(e.inputs,t),n.outputs=it(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(et):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(tt):null,n})}function et(e){return at(e)||function(e){return e[We]||null}(e)}function tt(e){return function(e){return e[je]||null}(e)}const nt={};function rt(e){return Le(()=>{const t={type:e.type,bootstrap:e.bootstrap||Ge,declarations:e.declarations||Ge,imports:e.imports||Ge,exports:e.exports||Ge,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nt[e.id]=e.type),t})}function it(e,t){if(null==e)return He;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const st=Xe;function ot(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function at(e){return e[qe]||null}function ct(e,t){const n=e[Ze]||null;if(!n&&!0===t)throw new Error(`Type ${de(e)} does not have '\u0275mod' property.`);return n}function lt(e){return Array.isArray(e)&&"object"==typeof e[1]}function ut(e){return Array.isArray(e)&&!0===e[1]}function ht(e){return 0!=(8&e.flags)}function dt(e){return 2==(2&e.flags)}function ft(e){return 1==(1&e.flags)}function pt(e){return null!==e.template}function gt(e){return 0!=(512&e[2])}function mt(e,t){return e.hasOwnProperty(Ke)?e[Ke]:null}class yt{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function vt(){return _t}function _t(e){return e.type.prototype.ngOnChanges&&(e.setInput=Et),Ct}function Ct(){const e=bt(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===He)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Et(e,t,n,r){const i=bt(e)||function(e,t){return e[wt]=t}(e,{previous:He,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],c=o[a];s[a]=new yt(c&&c.currentValue,t,o===He),e[r]=t}vt.ngInherit=!0;const wt="__ngSimpleChanges__";function bt(e){return e[wt]||null}const St="http://www.w3.org/2000/svg";let Pt;function Ot(){return void 0!==Pt?Pt:"undefined"!=typeof document?document:void 0}function Tt(e){return!!e.listen}const It={createRenderer:(e,t)=>Ot()};function kt(e){for(;Array.isArray(e);)e=e[0];return e}function At(e,t){return kt(t[e])}function Nt(e,t){return kt(t[e.index])}function Mt(e,t){return e.data[t]}function xt(e,t){return e[t]}function Rt(e,t){const n=t[e];return lt(n)?n:n[0]}function Dt(e){return 4==(4&e[2])}function Lt(e){return 128==(128&e[2])}function Ft(e,t){return null==t?null:e[t]}function Bt(e){e[18]=0}function Ut(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Vt={lFrame:fn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function $t(){return Vt.bindingsEnabled}function zt(){return Vt.lFrame.lView}function Ht(){return Vt.lFrame.tView}function Gt(e){return Vt.lFrame.contextLView=e,e[8]}function qt(){let e=Wt();for(;null!==e&&64===e.type;)e=e.parent;return e}function Wt(){return Vt.lFrame.currentTNode}function jt(){const e=Vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Zt(e,t){const n=Vt.lFrame;n.currentTNode=e,n.isParent=t}function Yt(){return Vt.lFrame.isParent}function Kt(){Vt.lFrame.isParent=!1}function Jt(){return Vt.isInCheckNoChangesMode}function Qt(e){Vt.isInCheckNoChangesMode=e}function Xt(){const e=Vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function en(){return Vt.lFrame.bindingIndex}function tn(){return Vt.lFrame.bindingIndex++}function nn(e){const t=Vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function rn(e){Vt.lFrame.inI18n=e}function sn(e,t){const n=Vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,on(t)}function on(e){Vt.lFrame.currentDirectiveIndex=e}function an(){return Vt.lFrame.currentQueryIndex}function cn(e){Vt.lFrame.currentQueryIndex=e}function ln(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function un(e,t,n){if(n&Me.SkipSelf){let r=t,i=e;for(;!(r=r.parent,null!==r||n&Me.Host||(r=ln(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}const r=Vt.lFrame=dn();return r.currentTNode=t,r.lView=e,!0}function hn(e){const t=dn(),n=e[1];Vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function dn(){const e=Vt.lFrame,t=null===e?null:e.child;return null===t?fn(e):t}function fn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function pn(){const e=Vt.lFrame;return Vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gn=pn;function mn(){const e=pn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function yn(){return Vt.lFrame.selectedIndex}function vn(e){Vt.lFrame.selectedIndex=e}function _n(){const e=Vt.lFrame;return Mt(e.tView,e.selectedIndex)}function Cn(){Vt.lFrame.currentNamespace=St}function En(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function wn(e,t,n){Pn(e,t,3,n)}function bn(e,t,n,r){(3&e[2])===n&&Pn(e,t,n,r)}function Sn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Pn(e,t,n,r){const i=r??-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(On(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function On(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}class Tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function In(e,t,n){const r=Tt(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],c=n[i++];r?e.setAttribute(t,a,c,o):t.setAttributeNS(o,a,c)}else{const o=s,a=n[++i];An(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function kn(e){return 3===e||4===e||6===e}function An(e){return 64===e.charCodeAt(0)}function Nn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Mn(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Mn(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function xn(e){return-1!==e}function Rn(e){return 32767&e}function Dn(e,t){let n=function(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ln=!0;function Fn(e){const t=Ln;return Ln=e,t}let Bn=0;function Un(e,t){const n=$n(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Vn(r.data,e),Vn(t,null),Vn(r.blueprint,null));const i=zn(e,t),s=e.injectorIndex;if(xn(i)){const e=Rn(i),n=Dn(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function Vn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $n(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function zn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hn(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Je)&&(r=n[Je]),null==r&&(r=n[Je]=Bn++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Gn(e,t,n){if(n&Me.Optional)return e;Ee(t,"NodeInjector")}function qn(e,t,n,r){if(n&Me.Optional&&void 0===r&&(r=null),0==(n&(Me.Self|Me.Host))){const i=e[9],s=Re(void 0);try{return i?i.get(t,r,n&Me.Optional):De(t,r,n&Me.Optional)}finally{Re(s)}}return Gn(r,t,n)}function Wn(e,t,n,r=Me.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Je)?e[Je]:void 0;return"number"==typeof t?t>=0?255&t:Zn:t}(n);if("function"==typeof s){if(!un(t,e,r))return r&Me.Host?Gn(i,n,r):qn(t,n,r,i);try{const e=s(r);if(null!=e||r&Me.Optional)return e;Ee(n)}finally{gn()}}else if("number"==typeof s){let i=null,o=$n(e,t),a=-1,c=r&Me.Host?t[16][6]:null;for((-1===o||r&Me.SkipSelf)&&(a=-1===o?zn(e,t):t[o+8],-1!==a&&Xn(r,!1)?(i=t[1],o=Rn(a),t=Dn(a,t)):o=-1);-1!==o;){const e=t[1];if(Qn(s,o,e.data)){const e=Yn(o,t,n,i,r,c);if(e!==jn)return e}a=t[o+8],-1!==a&&Xn(r,t[1].data[o+8]===c)&&Qn(s,o,t)?(i=e,o=Rn(a),t=Dn(a,t)):o=-1}}}return qn(t,n,r,i)}const jn={};function Zn(){return new er(qt(),zt())}function Yn(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],c=Kn(a,o,n,null==r?dt(a)&&Ln:r!=o&&0!=(3&a.type),i&Me.Host&&s===a);return null!==c?Jn(t,o,c,a):jn}function Kn(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,c=e.directiveStart,l=s>>20,u=i?a+l:e.directiveEnd;for(let h=r?a:a+l;h<u;h++){const e=o[h];if(h<c&&n===e||h>=c&&e.type===n)return h}if(i){const e=o[c];if(e&&pt(e)&&e.type===n)return c}return null}function Jn(e,t,n,r){let i=e[n];const s=t.data;if(function(e){return e instanceof Tn}(i)){const o=i;o.resolving&&function(e,t){throw new ve("200",`Circular dependency in DI detected for ${e}`)}(Ce(s[n]));const a=Fn(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?Re(o.injectImpl):null;un(e,r,Me.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=_t(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==c&&Re(c),Fn(a),o.resolving=!1,gn()}}return i}function Qn(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Xn(e,t){return!(e&Me.Self||e&Me.Host&&t)}class er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Wn(this._tNode,this._lView,e,n,t)}}function tr(e){return Le(()=>{const t=e.prototype.constructor,n=t[Ke]||nr(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Ke]||nr(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function nr(e){return ye(e)?()=>{const t=nr(me(e));return t&&t()}:mt(e)}function rr(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(kn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(qt(),e)}const ir="__parameters__";function sr(e,t,n){return Le(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(ir)?e[ir]:Object.defineProperty(e,ir,{value:[]})[ir];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class or{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=be({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ar=new or("AnalyzeForEntryComponents"),cr=Function;function lr(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),lr(r,t)):t!==e&&t.push(r)}return t}function ur(e,t){e.forEach(e=>Array.isArray(e)?ur(e,t):t(e))}function hr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function fr(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function pr(e,t,n){let r=mr(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function gr(e,t){const n=mr(e,t);if(n>=0)return e[1|n]}function mr(e,t){return function(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const s=r+(i-r>>1),o=e[s<<n];if(t===o)return s<<n;o>t?i=s:r=s+1}return~(i<<n)}(e,t,1)}const yr={},vr="__NG_DI_FLAG__",_r="ngTempTokenPath",Cr=/\n/gm,Er="__source",wr=ue({provide:String,useValue:ue});let br;function Sr(e){const t=br;return br=e,t}function Pr(e,t=Me.Default){if(void 0===br)throw new Error("inject() must be called from an injection context");return null===br?De(e,void 0,t):br.get(e,t&Me.Optional?null:void 0,t)}function Or(e,t=Me.Default){return(xe||Pr)(me(e),t)}function Tr(e){const t=[];for(let n=0;n<e.length;n++){const r=me(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=Me.Default;for(let t=0;t<r.length;t++){const i=r[t],s=kr(i);"number"==typeof s?-1===s?e=i.token:n|=s:e=i}t.push(Or(e,n))}else t.push(Or(r))}return t}function Ir(e,t){return e[vr]=t,e.prototype[vr]=t,e}function kr(e){return e[vr]}function Ar(e,t,n,r){const i=e[_r];throw t[Er]&&i.unshift(t[Er]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=de(t);if(Array.isArray(t))i=t.map(de).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):de(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Cr,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[_r]=null,e}const Nr=Ir(sr("Inject",e=>({token:e})),-1),Mr=Ir(sr("Optional"),8),xr=Ir(sr("SkipSelf"),4);let Rr,Dr;function Lr(e){var t;return(null===(t=function(){if(void 0===Rr&&(Rr=null,ze.trustedTypes))try{Rr=ze.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Rr}())||void 0===t?void 0:t.createHTML(e))||e}function Fr(e){var t;return(null===(t=function(){if(void 0===Dr&&(Dr=null,ze.trustedTypes))try{Dr=ze.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dr}())||void 0===t?void 0:t.createHTML(e))||e}class Br{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Ur extends Br{getTypeName(){return"HTML"}}class Vr extends Br{getTypeName(){return"Style"}}class $r extends Br{getTypeName(){return"Script"}}class zr extends Br{getTypeName(){return"URL"}}class Hr extends Br{getTypeName(){return"ResourceURL"}}function Gr(e){return e instanceof Br?e.changingThisBreaksApplicationSecurity:e}function qr(e,t){const n=Wr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Wr(e){return e instanceof Br&&e.getTypeName()||null}function jr(e){const t=new Yr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Lr(""),"text/html")}catch{return!1}}()?new Zr(t):t}class Zr{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Lr(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class Yr{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Lr(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=Lr(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kr=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Jr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qr(e){return(e=String(e)).match(Kr)||e.match(Jr)?e:"unsafe:"+e}function Xr(e){return(e=String(e)).split(",").map(e=>Qr(e.trim())).join(", ")}function ei(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function ti(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const ni=ei("area,br,col,hr,img,wbr"),ri=ei("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ii=ei("rp,rt"),si=ti(ni,ti(ri,ei("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ti(ii,ei("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ti(ii,ri)),oi=ei("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ai=ei("srcset"),ci=ti(oi,ai,ei("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ei("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),li=ei("script,style,template");class ui{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!si.hasOwnProperty(t))return this.sanitizedSomething=!0,!li.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let r=0;r<n.length;r++){const e=n.item(r),t=e.name,i=t.toLowerCase();if(!ci.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let s=e.value;oi[i]&&(s=Qr(s)),ai[i]&&(s=Xr(s)),this.buf.push(" ",t,'="',fi(s),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();si.hasOwnProperty(t)&&!ni.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(fi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const hi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,di=/([^\#-~ |!])/g;function fi(e){return e.replace(/&/g,"&amp;").replace(hi,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(di,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let pi;function gi(e,t){let n=null;try{pi=pi||jr(e);let r=t?String(t):"";n=pi.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=pi.getInertBodyElement(r)}while(r!==s);return Lr((new ui).sanitizeChildren(mi(n)||n))}finally{if(n){const e=mi(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function mi(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var yi=(()=>((yi=yi||{})[yi.NONE=0]="NONE",yi[yi.HTML=1]="HTML",yi[yi.STYLE=2]="STYLE",yi[yi.SCRIPT=3]="SCRIPT",yi[yi.URL=4]="URL",yi[yi.RESOURCE_URL=5]="RESOURCE_URL",yi))();function vi(e){const t=Ci();return t?Fr(t.sanitize(yi.HTML,e)||""):qr(e,"HTML")?Fr(Gr(e)):gi(Ot(),_e(e))}function _i(e){const t=Ci();return t?t.sanitize(yi.URL,e)||"":qr(e,"URL")?Gr(e):Qr(_e(e))}function Ci(){const e=zt();return e&&e[12]}const Ei="__ngContext__";function wi(e,t){e[Ei]=t}function bi(e){const t=function(e){return e[Ei]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Si(e){return e.ngOriginalError}function Pi(e,...t){e.error(...t)}class Oi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=(i=e)&&i.ngErrorLogger||Pi;var i;r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(Si(e)):null}_findOriginalError(e){let t=e&&Si(e);for(;t&&Si(t);)t=Si(t);return t||null}}const Ti=/^>|^->|<!--|-->|--!>|<!-$/g,Ii=/(<|>)/;const ki=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ze))();function Ai(e){return e instanceof Function?e():e}var Ni=(()=>((Ni=Ni||{})[Ni.Important=1]="Important",Ni[Ni.DashCase=2]="DashCase",Ni))();let Mi;function xi(e,t){return Mi(e,t)}function Ri(e){const t=e[3];return ut(t)?t[3]:t}function Di(e){return Fi(e[13])}function Li(e){return Fi(e[4])}function Fi(e){for(;null!==e&&!ut(e);)e=e[4];return e}function Bi(e,t,n,r,i){if(null!=r){let s,o=!1;ut(r)?s=r:lt(r)&&(o=!0,r=r[0]);const a=kt(r);0===e&&null!==n?null==i?Ki(t,n,a):Yi(t,n,a,i||null,!0):1===e&&null!==n?Yi(t,n,a,i||null,!0):2===e?cs(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==kt(n)&&Bi(t,e,r,s,i);for(let o=10;o<n.length;o++){const i=n[o];us(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function Ui(e,t){return Tt(e)?e.createText(t):e.createTextNode(t)}function Vi(e,t,n){Tt(e)?e.setValue(t,n):t.textContent=n}function $i(e,t){return e.createComment(function(e){return e.replace(Ti,e=>e.replace(Ii,"\u200b$1\u200b"))}(t))}function zi(e,t,n){return Tt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Hi(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Ut(i,-1)),n.splice(r,1)}function Gi(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Hi(i,r),t>0&&(e[n-1][4]=r[4]);const s=dr(e,10+t);!function(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function qi(e,t){if(!(256&t[2])){const n=t[11];Tt(n)&&n.destroyNode&&us(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Wi(e[1],e);for(;t;){let n=null;if(lt(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)lt(t)&&Wi(t[1],t),t=t[3];null===t&&(t=e),lt(t)&&Wi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Wi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):kt(t[e]),a=r[i=n[s+2]],c=n[s+3];"boolean"==typeof c?o.removeEventListener(n[s],a,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)r[e]();t[7]=null}}(e,t),1===t[1].type&&Tt(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ut(t[3])){n!==t[3]&&Hi(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function ji(e,t,n){return Zi(e,t.parent,n)}function Zi(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Be.None||t===Be.Emulated)return null}return Nt(r,n)}function Yi(e,t,n,r,i){Tt(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Ki(e,t,n){Tt(e)?e.appendChild(t,n):t.appendChild(n)}function Ji(e,t,n,r,i){null!==r?Yi(e,t,n,r,i):Ki(e,t,n)}function Qi(e,t){return Tt(e)?e.parentNode(t):t.parentNode}function Xi(e,t,n){return ns(e,t,n)}function es(e,t,n){return 40&e.type?Nt(e,n):null}let ts,ns=es;function rs(e,t){ns=e,ts=t}function is(e,t,n,r){const i=ji(e,r,t),s=t[11],o=Xi(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)Ji(s,i,n[a],o,!1);else Ji(s,i,n,o,!1);void 0!==ts&&ts(s,r,t,n,i)}function ss(e,t){if(null!==t){const n=t.type;if(3&n)return Nt(t,e);if(4&n)return as(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return ss(e,n);{const n=e[t.index];return ut(n)?as(-1,n):kt(n)}}if(32&n)return xi(t,e)()||kt(e[t.index]);{const n=os(e,t);return null!==n?Array.isArray(n)?n[0]:ss(Ri(e[16]),n):ss(e,t.next)}}return null}function os(e,t){return null!==t?e[16][6].projection[t.projection]:null}function as(e,t){const n=10+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return ss(e,r)}return t[7]}function cs(e,t,n){const r=Qi(e,t);r&&function(e,t,n,r){Tt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function ls(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],c=n.type;if(o&&0===t&&(a&&wi(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&c)ls(e,t,n.child,r,i,s,!1),Bi(t,e,i,a,s);else if(32&c){const o=xi(n,r);let c;for(;c=o();)Bi(t,e,i,c,s);Bi(t,e,i,a,s)}else 16&c?hs(e,t,r,n,i,s):Bi(t,e,i,a,s);n=o?n.projectionNext:n.next}}function us(e,t,n,r,i,s){ls(n,r,e.firstChild,t,i,s,!1)}function hs(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let c=0;c<a.length;c++)Bi(t,e,i,a[c],s);else ls(e,t,a,o[3],i,s,!0)}function ds(e,t,n){Tt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function fs(e,t,n){Tt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function ps(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const gs="ng-template";function ms(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==ps(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ys(e){return 4===e.type&&e.value!==gs}function vs(e,t,n){return t===(4!==e.type||n?e.value:gs)}function _s(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(kn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const c=t[a];if("number"!=typeof c){if(!o)if(4&r){if(r=2|1&r,""!==c&&!vs(e,c,n)||""===c&&1===t.length){if(Cs(r))return!1;o=!0}}else{const l=8&r?c:t[++a];if(8&r&&null!==e.attrs){if(!ms(e.attrs,l,n)){if(Cs(r))return!1;o=!0}continue}const u=Es(8&r?"class":c,i,ys(e),n);if(-1===u){if(Cs(r))return!1;o=!0;continue}if(""!==l){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==ps(t,l,0)||2&r&&l!==e){if(Cs(r))return!1;o=!0}}}}else{if(!o&&!Cs(r)&&!Cs(c))return!1;if(o&&Cs(c))continue;o=!1,r=c|1&r}}return Cs(r)||o}function Cs(e){return 0==(1&e)}function Es(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ws(e,t,n=!1){for(let r=0;r<t.length;r++)if(_s(e,t[r],n))return!0;return!1}function bs(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function Ss(e,t){return e?":not("+t.trim()+")":t}function Ps(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Cs(o)&&(t+=Ss(s,i),i=""),r=o,s=s||!Cs(r);n++}return""!==i&&(t+=Ss(s,i)),t}const Os={};function Ts(e){Is(Ht(),zt(),yn()+e,Jt())}function Is(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&wn(t,r,n)}else{const r=e.preOrderHooks;null!==r&&bn(t,r,0,n)}vn(n)}function ks(e,t){return e<<17|t<<2}function As(e){return e>>17&32767}function Ns(e){return 2|e}function Ms(e){return(131068&e)>>2}function xs(e,t){return-131069&e|t<<2}function Rs(e){return 1|e}function Ds(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];cn(i),n.contentQueries(2,t[s],s)}}}function Ls(e,t,n,r,i,s,o,a,c,l){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,Bt(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=c||e&&e[12]||null,u[9]=l||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function Fs(e,t,n,r,i){let s=e.data[t];if(null===s)s=Bs(e,t,n,r,i),Vt.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=jt();s.injectorIndex=null===e?-1:e.injectorIndex}return Zt(s,!0),s}function Bs(e,t,n,r,i){const s=Wt(),o=Yt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}function Us(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Vs(e,t,n){hn(t);try{const r=e.viewQuery;null!==r&&vo(1,r,n);const i=e.template;null!==i&&Hs(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ds(e,t),e.staticViewQueries&&vo(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)fo(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,mn()}}function $s(e,t,n,r){const i=t[2];if(256==(256&i))return;hn(t);const s=Jt();try{Bt(t),function(e){Vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Hs(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&wn(t,n,null)}else{const n=e.preOrderHooks;null!==n&&bn(t,n,0,null),Sn(t,0)}if(function(e){for(let t=Di(e);null!==t;t=Li(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Ut(r,1),n[2]|=1024}}}(t),function(e){for(let t=Di(e);null!==t;t=Li(t))for(let e=10;e<t.length;e++){const n=t[e],r=n[1];Lt(n)&&$s(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Ds(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&wn(t,n)}else{const n=e.contentHooks;null!==n&&bn(t,n,1),Sn(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)vn(~r);else{const i=r,s=n[++e],o=n[++e];sn(s,i),o(2,t[i])}}}finally{vn(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)uo(e,t[n])}(t,a);const c=e.viewQuery;if(null!==c&&vo(2,c,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&wn(t,n)}else{const n=e.viewHooks;null!==n&&bn(t,n,2),Sn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Ut(t[3],-1))}finally{mn()}}function zs(e,t,n,r){const i=t[10],s=!Jt(),o=Dt(t);try{s&&!o&&i.begin&&i.begin(),o&&Vs(e,t,r),$s(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function Hs(e,t,n,r,i){const s=yn(),o=2&r;try{vn(-1),o&&t.length>20&&Is(e,t,20,Jt()),n(r,i)}finally{vn(s)}}function Gs(e,t,n){if(ht(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function qs(e,t,n){!$t()||(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Un(n,t),wi(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=pt(r);s&&so(t,n,r);const c=Jn(t,e,a,n);wi(c,t),null!==o&&ao(0,a-i,c,r,0,o),s&&(Rt(n.index,t)[8]=c)}}(e,t,n,Nt(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Vt.lFrame.currentDirectiveIndex;try{vn(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];on(n),(null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs)&&eo(r,i)}}finally{vn(-1),on(o)}}(e,t,n))}function Ws(e,t,n=Nt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function js(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zs(e,t,n,r,i,s,o,a,c,l){const u=20+r,h=u+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Os);return n}(u,h),f="function"==typeof l?l():l;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:f,incompleteFirstPass:!1}}function Ys(e,t,n,r){const i=Co(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&Eo(e).push(r,i.length-1))}function Ks(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Js(e,t,n,r,i,s,o,a){const c=Nt(t,n);let l,u=t.inputs;!a&&null!=u&&(l=u[r])?(bo(e,n,l,r,i),dt(t)&&function(e,t){const n=Rt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,Tt(s)?s.setProperty(c,r,i):An(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function Qs(e,t,n,r){let i=!1;if($t()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];ws(n,o.selectors,!1)&&(i||(i=[]),Hn(Un(n,t),e,o.type),pt(o)?(to(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,ro(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,c=Us(e,t,s.length,null);for(let i=0;i<s.length;i++){const l=s[i];n.mergedAttrs=Nn(n.mergedAttrs,l.hostAttrs),io(e,n,t,c,l),no(c,l,o),null!==l.contentQueries&&(n.flags|=8),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(n.flags|=128);const u=l.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),c++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let c=t.directiveStart;c<n;c++){const e=r[c],n=e.inputs,l=null===i||ys(t)?null:co(n,i);s.push(l),o=Ks(n,c,o),a=Ks(e.outputs,c,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new ve("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Nn(n.mergedAttrs,n.attrs),i}function Xs(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function eo(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function to(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function no(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;pt(t)&&(n[""]=e)}}function ro(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function io(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=mt(i.type)),o=new Tn(s,pt(i),null);e.blueprint[r]=o,n[r]=o,Xs(e,t,0,r,Us(e,n,i.hostVars,Os),i)}function so(e,t,n){const r=Nt(t,e),i=js(n),s=e[10],o=po(e,Ls(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function oo(e,t,n,r,i,s,o){if(null==s)Tt(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==o?_e(s):o(s,r||"",i);Tt(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}function ao(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function co(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function lo(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function uo(e,t){const n=Rt(t,e);if(Lt(n)){const e=n[1];80&n[2]?$s(e,n,e.template,n[8]):n[5]>0&&ho(n)}}function ho(e){for(let n=Di(e);null!==n;n=Li(n))for(let e=10;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];$s(e,t,e.template,t[8])}else t[5]>0&&ho(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=Rt(t[n],e);Lt(r)&&r[5]>0&&ho(r)}}function fo(e,t){const n=Rt(t,e),r=n[1];(function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Vs(r,n,n[8])}function po(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function go(e){for(;e;){e[2]|=64;const t=Ri(e);if(gt(e)&&!t)return e;e=t}return null}function mo(e,t,n){const r=t[10];r.begin&&r.begin();try{$s(e,t,e.template,n)}catch(i){throw wo(t,i),i}finally{r.end&&r.end()}}function yo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=bi(n),i=r[1];zs(i,r,i.template,n)}}(e[8])}function vo(e,t,n){cn(0),t(e,n)}const _o=(()=>Promise.resolve(null))();function Co(e){return e[7]||(e[7]=[])}function Eo(e){return e.cleanup||(e.cleanup=[])}function wo(e,t){const n=e[9],r=n?n.get(Oi,null):null;r&&r.handleError(t)}function bo(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],c=t[o],l=e.data[o];null!==l.setInput?l.setInput(c,i,r,a):c[a]=i}}function So(e,t,n){const r=At(t,e);Vi(e[11],r,n)}function Po(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=fe(i,e):2==s&&(r=fe(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const Oo=new or("INJECTOR",-1);class To{get(e,t=yr){if(t===yr){const t=new Error(`NullInjectorError: No provider for ${de(e)}!`);throw t.name="NullInjectorError",t}return t}}const Io=new or("Set Injector scope."),ko={},Ao={};let No;function Mo(){return void 0===No&&(No=new To),No}function xo(e,t=null,n=null,r){return new Ro(e,n,t||Mo(),r)}class Ro{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&ur(t,n=>this.processProvider(n,e,t)),ur([e],e=>this.processInjectorType(e,[],i)),this.records.set(Oo,Fo(void 0,this));const s=this.records.get(Io);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:de(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=yr,n=Me.Default){this.assertNotDestroyed();const r=Sr(this),i=Re(void 0);try{if(!(n&Me.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(s=e)||"object"==typeof s&&s instanceof or)&&Pe(e);t=n&&this.injectableDefInScope(n)?Fo(Do(e),ko):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&Me.Self?Mo():this.parent).get(e,t=n&Me.Optional&&t===yr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_r]=o[_r]||[]).unshift(de(e)),r)throw o;return Ar(o,e,"R3InjectorError",this.source)}throw o}finally{Re(i),Sr(r)}var s}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(de(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=me(e)))return!1;let r=Te(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=Te(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{ur(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];ur(r,e=>this.processProvider(e,n,r||Ge))}}this.injectorDefTypes.add(s);const a=mt(s)||(()=>new s);this.records.set(s,Fo(a,ko));const c=r.providers;if(null!=c&&!o){const t=e;ur(c,e=>this.processProvider(e,t,c))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=Uo(e=me(e))?e:me(e&&e.provide);const i=function(e,t,n){return Bo(e)?Fo(void 0,e.useValue):Fo(Lo(e),ko)}(e);if(Uo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Fo(void 0,ko,!0),t.factory=()=>Tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){return t.value===ko&&(t.value=Ao,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}injectableDefInScope(e){if(!e.providedIn)return!1;const t=me(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Do(e){const t=Pe(e),n=null!==t?t.factory:mt(e);if(null!==n)return n;if(e instanceof or)throw new Error(`Token ${de(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=fr(t,"?");throw new Error(`Can't resolve all parameters for ${de(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[Ie]||e[Ae]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Lo(e,t,n){let r;if(Uo(e)){const t=me(e);return mt(t)||Do(t)}if(Bo(e))r=()=>me(e.useValue);else if(function(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Or(me(e.useExisting));else{const t=me(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return mt(t)||Do(t);r=()=>new t(...Tr(e.deps))}return r}function Fo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Bo(e){return null!==e&&"object"==typeof e&&wr in e}function Uo(e){return"function"==typeof e}const Vo=function(e,t,n){return function(e,t=null,n=null,r){const i=xo(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let $o=(()=>{class e{static create(e,t){return Array.isArray(e)?Vo(e,t,""):Vo(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=yr,e.NULL=new To,e.\u0275prov=be({token:e,providedIn:"any",factory:()=>Or(Oo)}),e.__NG_ELEMENT_ID__=-1,e})();function zo(e,t){En(bi(e)[1],qt())}function Ho(e){let t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let i;if(pt(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=Go(e.inputs),t.declaredInputs=Go(e.declaredInputs),t.outputs=Go(e.outputs);const n=i.hostBindings;n&&jo(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&qo(e,s),o&&Wo(e,o),he(e.inputs,i.inputs),he(e.declaredInputs,i.declaredInputs),he(e.outputs,i.outputs),pt(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Ho&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Nn(i.hostAttrs,n=Nn(n,i.hostAttrs))}}(r)}function Go(e){return e===He?{}:e===Ge?[]:e}function qo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function Wo(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function jo(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Zo=null;function Yo(){if(!Zo){const e=ze.Symbol;if(e&&e.iterator)Zo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Zo=n)}}}return Zo}class Ko{constructor(e){this.wrapped=e}static wrap(e){return new Ko(e)}static unwrap(e){return Ko.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Ko}}function Jo(e){return!!Qo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Yo()in e)}function Qo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Xo(e,t,n){return e[t]=n}function ea(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function ta(e,t,n,r){const i=ea(e,t,n);return ea(e,t+1,r)||i}function na(e,t,n,r){const i=zt();return ea(i,tn(),t)&&(Ht(),function(e,t,n,r,i,s){const o=Nt(e,t);oo(t[11],o,s,e.value,n,r,i)}(_n(),i,e,t,n,r)),na}function ra(e,t,n,r){return ea(e,tn(),n)?t+_e(n)+r:Os}function ia(e,t,n,r,i,s){const o=ta(e,en(),n,i);return nn(2),o?t+_e(n)+r+_e(i)+s:Os}function sa(e,t,n,r,i,s,o,a){const c=function(e,t,n,r,i){const s=ta(e,t,n,r);return ea(e,t+2,i)||s}(e,en(),n,i,o);return nn(3),c?t+_e(n)+r+_e(i)+s+_e(o)+a:Os}function oa(e,t,n,r,i,s,o,a){const c=zt(),l=Ht(),u=e+20,h=l.firstCreatePass?function(e,t,n,r,i,s,o,a,c){const l=t.consts,u=Fs(t,e,4,o||null,Ft(l,a));Qs(t,n,u,Ft(l,c)),En(t,u);const h=u.tViews=Zs(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,l);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,l,c,t,n,r,i,s,o):l.data[u];Zt(h,!1);const d=c[11].createComment("");is(l,c,d,h),wi(d,c),po(c,c[u]=lo(d,c,d,h)),ft(h)&&qs(l,c,h),null!=o&&Ws(c,h,a)}function aa(e){return xt(Vt.lFrame.contextLView,20+e)}function ca(e,t=Me.Default){const n=zt();return null===n?Or(e,t):Wn(qt(),n,me(e),t)}function la(e,t,n){const r=zt();return ea(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!1),la}function ua(e,t,n,r,i){const s=i?"class":"style";bo(e,n,t.inputs[s],s,r)}function ha(e,t,n,r){const i=zt(),s=Ht(),o=20+e,a=i[11],c=i[o]=zi(a,t,Vt.lFrame.currentNamespace),l=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,c=Fs(t,e,2,i,Ft(a,s));return Qs(t,n,c,Ft(a,o)),null!==c.attrs&&Po(c,c.attrs,!1),null!==c.mergedAttrs&&Po(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(o,s,i,0,t,n,r):s.data[o];Zt(l,!0);const u=l.mergedAttrs;null!==u&&In(a,c,u);const h=l.classes;null!==h&&fs(a,c,h);const d=l.styles;null!==d&&ds(a,c,d),64!=(64&l.flags)&&is(s,i,c,l),0===Vt.lFrame.elementDepthCount&&wi(c,i),Vt.lFrame.elementDepthCount++,ft(l)&&(qs(s,i,l),Gs(s,l,i)),null!==r&&Ws(i,l)}function da(){let e=qt();Yt()?Kt():(e=e.parent,Zt(e,!1));const t=e;Vt.lFrame.elementDepthCount--;const n=Ht();n.firstCreatePass&&(En(n,e),ht(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&ua(n,t,zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&ua(n,t,zt(),t.stylesWithoutHost,!1)}function fa(e,t,n,r){ha(e,t,n,r),da()}function pa(e,t,n){const r=zt(),i=Ht(),s=e+20,o=i.firstCreatePass?function(e,t,n,r,i){const s=t.consts,o=Ft(s,r),a=Fs(t,e,8,"ng-container",o);return null!==o&&Po(a,o,!0),Qs(t,n,a,Ft(s,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(s,i,r,t,n):i.data[s];Zt(o,!0);const a=r[s]=r[11].createComment("");is(i,r,a,o),wi(a,r),ft(o)&&(qs(i,r,o),Gs(i,o,r)),null!=n&&Ws(r,o)}function ga(){let e=qt();const t=Ht();Yt()?Kt():(e=e.parent,Zt(e,!1)),t.firstCreatePass&&(En(t,e),ht(e)&&t.queries.elementEnd(e))}function ma(){return zt()}function ya(e){return!!e&&"function"==typeof e.then}const va=function(e){return!!e&&"function"==typeof e.subscribe};function _a(e,t,n,r){const i=zt(),s=Ht(),o=qt();return function(e,t,n,r,i,s,o,a){const c=ft(r),l=e.firstCreatePass&&Eo(e),u=t[8],h=Co(t);let d=!0;if(3&r.type||a){const f=Nt(r,t),p=a?a(f):f,g=h.length,m=a?e=>a(kt(e[r.index])):r.index;if(Tt(n)){let o=null;if(!a&&c&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=Ea(r,t,u,s,!1);const e=n.listen(p,i,s);h.push(s,e),l&&l.push(i,m,g,g+1)}}else s=Ea(r,t,u,s,!0),p.addEventListener(i,s,o),h.push(s),l&&l.push(i,m,g,o)}else s=Ea(r,t,u,s,!1);const f=r.outputs;let p;if(d&&null!==f&&(p=f[i])){const e=p.length;if(e)for(let n=0;n<e;n+=2){const e=t[p[n]][p[n+1]].subscribe(s),o=h.length;h.push(s,e),l&&l.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,!!n,r),_a}function Ca(e,t,n,r){try{return!1!==n(r)}catch(i){return wo(e,i),!1}}function Ea(e,t,n,r,i){return function n(s){if(s===Function)return r;const o=2&e.flags?Rt(e.index,t):t;0==(32&t[2])&&go(o);let a=Ca(t,0,r,s),c=n.__ngNextListenerFn__;for(;c;)a=Ca(t,0,c,s)&&a,c=c.__ngNextListenerFn__;return i&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function wa(e=1){return function(e){return(Vt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Vt.lFrame.contextLView))[8]}(e)}function ba(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const s=t[i];if("*"!==s){if(null===r?ws(e,s,!0):bs(r,s))return i}else n=i}return n}function Sa(e,t,n){return Pa(e,"",t,"",n),Sa}function Pa(e,t,n,r,i){const s=zt(),o=ra(s,t,n,r);return o!==Os&&Js(Ht(),_n(),s,e,o,s[11],i,!1),Pa}function Oa(e,t,n,r,i,s,o){const a=zt(),c=ia(a,t,n,r,i,s);return c!==Os&&Js(Ht(),_n(),a,e,c,a[11],o,!1),Oa}function Ta(e,t,n,r,i,s,o,a,c){const l=zt(),u=sa(l,t,n,r,i,s,o,a);return u!==Os&&Js(Ht(),_n(),l,e,u,l[11],c,!1),Ta}function Ia(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?As(s):Ms(s),c=!1;for(;0!==a&&(!1===c||o);){const n=e[a+1];ka(e[a],t)&&(c=!0,e[a+1]=r?Rs(n):Ns(n)),a=r?As(n):Ms(n)}c&&(e[n+1]=r?Ns(s):Rs(s))}function ka(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&mr(e,t)>=0}function Aa(e,t){return function(e,t,n,r){const i=zt(),s=Ht(),o=nn(2);s.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[yn()],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(e.flags&(t?16:32))})(s,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Vt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=Ma(n=Na(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Na(i,e,t,n,r),null===s){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Ms(r))return e[As(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=Na(null,e,t,n[1],r),n=Ma(n,t.attrs,r),function(e,t,n,r){e[As(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else s=function(e,t,n){let r;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=Ma(r,e[s].hostAttrs,n);return Ma(r,t.attrs,n)}(e,t,r)}return void 0!==s&&(r?t.residualClasses=s:t.residualStyles=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=s?t.classBindings:t.styleBindings,a=As(o),c=Ms(o);e[r]=n;let l,u=!1;if(Array.isArray(n)){const e=n;l=e[1],(null===l||mr(e,l)>0)&&(u=!0)}else l=n;if(i)if(0!==c){const t=As(e[a+1]);e[r+1]=ks(t,a),0!==t&&(e[t+1]=xs(e[t+1],r)),e[a+1]=function(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=ks(a,0),0!==a&&(e[a+1]=xs(e[a+1],r)),a=r;else e[r+1]=ks(c,0),0===a?a=r:e[c+1]=xs(e[c+1],r),c=r;u&&(e[r+1]=Ns(e[r+1])),Ia(e,l,r,!0),Ia(e,l,r,!1),function(e,t,n,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&mr(s,t)>=0&&(n[r+1]=Rs(n[r+1]))}(t,l,e,r,s),o=ks(a,c),s?t.classBindings=o:t.styleBindings=o}(i,s,t,n,o,r)}}(s,e,o,r),t!==Os&&ea(i,o,t)&&function(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const c=e.data,l=c[a+1];Ra(function(e){return 1==(1&e)}(l)?xa(c,t,n,i,Ms(l),o):void 0)||(Ra(s)||function(e){return 2==(2&e)}(l)&&(s=xa(c,null,n,i,a,o)),function(e,t,n,r,i){const s=Tt(e);if(t)i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Ni.DashCase;if(null==i)s?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const o="string"==typeof i&&i.endsWith("!important");o&&(i=i.slice(0,-10),t|=Ni.Important),s?e.setStyle(n,r,i,t):n.style.setProperty(r,i,o?"important":"")}}}(r,o,At(yn(),n),i,s))}(s,s.data[yn()],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=de(Gr(e)))),e}(t,n),r,o)}(e,t,null,!0),Aa}function Na(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=Ma(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function Ma(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),pr(e,o,!!n||t[++s]))}return void 0===e?null:e}function xa(e,t,n,r,i,s){const o=null===t;let a;for(;i>0;){const t=e[i],s=Array.isArray(t),c=s?t[1]:t,l=null===c;let u=n[i+1];u===Os&&(u=l?Ge:void 0);let h=l?gr(u,r):c===r?u:void 0;if(s&&!Ra(h)&&(h=gr(t,r)),Ra(h)&&(a=h,o))return a;const d=e[i+1];i=o?As(d):Ms(d)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=gr(e,r))}return a}function Ra(e){return void 0!==e}function Da(e,t=""){const n=zt(),r=Ht(),i=e+20,s=r.firstCreatePass?Fs(r,i,1,t,null):r.data[i],o=n[i]=Ui(n[11],t);is(r,n,o,s),Zt(s,!1)}function La(e){return Fa("",e,""),La}function Fa(e,t,n){const r=zt(),i=ra(r,e,t,n);return i!==Os&&So(r,yn(),i),Fa}function Ba(e,t,n,r,i){const s=zt(),o=ia(s,e,t,n,r,i);return o!==Os&&So(s,yn(),o),Ba}function Ua(e,t,n,r,i,s,o){const a=zt(),c=sa(a,e,t,n,r,i,s,o);return c!==Os&&So(a,yn(),c),Ua}function Va(e,t,n){const r=zt();return ea(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!0),Va}const $a=void 0;var za=["en",[["a","p"],["AM","PM"],$a],[["AM","PM"],$a,$a],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],$a,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],$a,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",$a,"{1} 'at' {0}",$a],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){const t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let Ha={};function Ga(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Wa(t);if(n)return n;const r=t.split("-")[0];if(n=Wa(r),n)return n;if("en"===r)return za;throw new Error(`Missing locale data for the locale "${e}".`)}function qa(e){return Ga(e)[ja.PluralCase]}function Wa(e){return e in Ha||(Ha[e]=ze.ng&&ze.ng.common&&ze.ng.common.locales&&ze.ng.common.locales[e]),Ha[e]}var ja=(()=>((ja=ja||{})[ja.LocaleId=0]="LocaleId",ja[ja.DayPeriodsFormat=1]="DayPeriodsFormat",ja[ja.DayPeriodsStandalone=2]="DayPeriodsStandalone",ja[ja.DaysFormat=3]="DaysFormat",ja[ja.DaysStandalone=4]="DaysStandalone",ja[ja.MonthsFormat=5]="MonthsFormat",ja[ja.MonthsStandalone=6]="MonthsStandalone",ja[ja.Eras=7]="Eras",ja[ja.FirstDayOfWeek=8]="FirstDayOfWeek",ja[ja.WeekendRange=9]="WeekendRange",ja[ja.DateFormat=10]="DateFormat",ja[ja.TimeFormat=11]="TimeFormat",ja[ja.DateTimeFormat=12]="DateTimeFormat",ja[ja.NumberSymbols=13]="NumberSymbols",ja[ja.NumberFormats=14]="NumberFormats",ja[ja.CurrencyCode=15]="CurrencyCode",ja[ja.CurrencySymbol=16]="CurrencySymbol",ja[ja.CurrencyName=17]="CurrencyName",ja[ja.Currencies=18]="Currencies",ja[ja.Directionality=19]="Directionality",ja[ja.PluralCase=20]="PluralCase",ja[ja.ExtraData=21]="ExtraData",ja))();const Za=["zero","one","two","few","many"],Ya="en-US",Ka={marker:"element"},Ja={marker:"ICU"};var Qa=(()=>((Qa=Qa||{})[Qa.SHIFT=2]="SHIFT",Qa[Qa.APPEND_EAGERLY=1]="APPEND_EAGERLY",Qa[Qa.COMMENT=2]="COMMENT",Qa))();let Xa=Ya;function ec(e){(function(e,t){null==e&&we(t,e,null,"!=")})(e,"Expected localeId to be defined"),"string"==typeof e&&(Xa=e.toLowerCase().replace(/_/g,"-"))}function tc(e,t,n){const r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?es(e,0,n):kt(n[i])}function nc(e,t,n,r,i){const s=t.insertBeforeIndex;if(Array.isArray(s)){let o=r,a=null;if(3&t.type||(a=o,o=i),null!==o&&0==(2&t.flags))for(let t=1;t<s.length;t++)Yi(e,o,n[s[t]],a,!1)}}function rc(e,t){if(e.push(t),e.length>1)for(let n=e.length-2;n>=0;n--){const r=e[n];ic(r)||sc(r,t)&&null===oc(r)&&ac(r,t.index)}}function ic(e){return!(64&e.type)}function sc(e,t){return ic(t)||e.index>t.index}function oc(e){const t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function ac(e,t){const n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(rs(tc,nc),e.insertBeforeIndex=t)}function cc(e,t){const n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function lc(e,t,n){const r=Bs(e,n,64,null,null);return rc(t,r),r}function uc(e,t){const n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function hc(e){return e>>>17}function dc(e){return(131070&e)>>>1}let fc=0,pc=0;function gc(e,t,n,r){const i=n[11];let s,o=null;for(let a=0;a<t.length;a++){const c=t[a];if("string"==typeof c){const e=t[++a];null===n[e]&&(n[e]=Ui(i,c))}else if("number"==typeof c)switch(1&c){case 0:const l=hc(c);let u,h;if(null===o&&(o=l,s=Qi(i,r)),l===o?(u=r,h=s):(u=null,h=kt(n[l])),null!==h){const t=dc(c);Yi(i,h,n[t],u,!1);const r=cc(e,t);if(null!==r&&"object"==typeof r){const t=uc(r,n);null!==t&&gc(e,r.create[t],n,n[r.anchorIdx])}}break;case 1:const d=t[++a],f=t[++a];oo(i,At(c>>>1,n),null,null,d,f,null);break;default:throw new Error(`Unable to determine the type of mutate operation for "${c}"`)}else switch(c){case Ja:const e=t[++a],r=t[++a];null===n[r]&&wi(n[r]=$i(i,e),n);break;case Ka:const s=t[++a],o=t[++a];null===n[o]&&wi(n[o]=zi(i,s,null),n)}}}function mc(e,t,n,r,i){for(let s=0;s<n.length;s++){const o=n[s],a=n[++s];if(o&i){let i="";for(let o=s+1;o<=s+a;o++){const s=n[o];if("string"==typeof s)i+=s;else if("number"==typeof s)if(s<0)i+=_e(t[r-s]);else{const a=s>>>2;switch(3&s){case 1:const s=n[++o],c=n[++o],l=e.data[a];"string"==typeof l?oo(t[11],t[a],null,l,s,i,c):Js(e,l,t,s,i,t[11],c,!1);break;case 0:const u=t[a];null!==u&&Vi(t[11],u,i);break;case 2:vc(e,cc(e,a),t,i);break;case 3:yc(e,cc(e,a),r,t)}}}}else{const i=n[s+1];if(i>0&&3==(3&i)){const n=cc(e,i>>>2);t[n.currentCaseLViewIndex]<0&&yc(e,n,r,t)}}s+=a}}function yc(e,t,n,r){let i=r[t.currentCaseLViewIndex];if(null!==i){let s=fc;i<0&&(i=r[t.currentCaseLViewIndex]=~i,s=-1),mc(e,r,t.update[i],n,s)}}function vc(e,t,n,r){const i=function(e,t){let n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:{const r=function(e,t){const n=qa(t)(parseInt(e,10)),r=Za[n];return void 0!==r?r:"other"}(t,Xa);n=e.cases.indexOf(r),-1===n&&"other"!==r&&(n=e.cases.indexOf("other"));break}case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(uc(t,n)!==i&&(_c(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){const r=n[t.anchorIdx];r&&gc(e,t.create[i],n,r)}}function _c(e,t,n){let r=uc(t,n);if(null!==r){const i=t.remove[r];for(let t=0;t<i.length;t++){const r=i[t];if(r>0){const e=At(r,n);null!==e&&cs(n[11],e)}else _c(e,cc(e,~r),n)}}}function Cc(){const e=[];let t,n,r=-1;function i(e,t){r=0;const i=uc(e,t);n=null!==i?e.remove[i]:Ge}function s(){if(r<n.length){const o=n[r++];return o>0?t[o]:(e.push(r,n),i(t[1].data[~o],t),s())}return 0===e.length?null:(n=e.pop(),r=e.pop(),s())}return function(n,r){for(t=r;e.length;)e.pop();return i(n.value,r),s}}const Ec=/\ufffd(\d+):?\d*\ufffd/gi,wc=/\ufffd(\d+)\ufffd/,bc=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,Sc=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,Pc=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,Oc=/\uE500/g;function Tc(e,t,n,r,i,s,o){const a=Us(e,r,1,null);let c=a<<Qa.SHIFT,l=jt();t===l&&(l=null),null===l&&(c|=Qa.APPEND_EAGERLY),o&&(c|=Qa.COMMENT,function(e){void 0===Mi&&(Mi=e())}(Cc)),i.push(c,null===s?"":s);const u=Bs(e,a,o?32:1,null===s?"":s,null);rc(n,u);const h=u.index;return Zt(u,!1),null!==l&&t!==l&&function(e,t){let n=e.insertBeforeIndex;null===n?(rs(tc,nc),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){e!=t&&we(n,e,t,"==")}(Array.isArray(n),!0,"Expecting array here"),n.push(t))}(l,h),u}function Ic(e,t,n,r,i,s,o){const a=o.match(Ec),c=Tc(e,t,n,s,r,a?null:o,!1);a&&kc(i,o,c.index,null,0,null)}function kc(e,t,n,r,i,s){const o=e.length,a=o+1;e.push(null,null);const c=o+2,l=t.split(Ec);let u=0;for(let h=0;h<l.length;h++){const t=l[h];if(1&h){const n=i+parseInt(t,10);e.push(-1-n),u|=Ac(n)}else""!==t&&e.push(t)}return e.push(n<<2|(r?1:0)),r&&e.push(r,s),e[o]=u,e[a]=e.length-c,u}function Ac(e){return 1<<Math.min(e,31)}function Nc(e){let t,n,r="",i=0,s=!1;for(;null!==(t=Sc.exec(e));)s?t[0]===`\ufffd/*${n}\ufffd`&&(i=t.index,s=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],s=!0);return r+=e.substr(i),r}function Mc(e,t,n,r,i,s){let o=0;const a={type:i.type,currentCaseLViewIndex:Us(e,t,1,null),anchorIdx:s,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(Ac(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,s),function(e,t,n){const r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,s,a);const c=i.values;for(let l=0;l<c.length;l++){const s=c[l],u=[];for(let e=0;e<s.length;e++){const t=s[e];if("string"!=typeof t){const n=u.push(t)-1;s[e]=`\x3c!--\ufffd${n}\ufffd--\x3e`}}o=Dc(e,a,t,n,r,i.cases[l],s.join(""),u)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,s)}function xc(e){const t=[],n=[];let r=1,i=0;const s=Rc(e=e.replace(bc,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""}));for(let o=0;o<s.length;){let e=s[o++].trim();1===r&&(e=e.replace(/\s*(?:=)?(\w+)\s*/,"$1")),e.length&&t.push(e);const i=Rc(s[o++]);t.length>n.length&&n.push(i)}return{type:r,mainBinding:i,cases:t,values:n}}function Rc(e){if(!e)return[];let t=0;const n=[],r=[],i=/[{}]/g;let s;for(i.lastIndex=0;s=i.exec(e);){const i=s.index;if("}"==s[0]){if(n.pop(),0==n.length){const n=e.substring(t,i);bc.test(n)?r.push(xc(n)):r.push(n),t=i+1}}else{if(0==n.length){const n=e.substring(t,i);r.push(n),t=i+1}n.push("{")}}const o=e.substring(t);return r.push(o),r}function Dc(e,t,n,r,i,s,o,a){const c=[],l=[],u=[];t.cases.push(s),t.create.push(c),t.remove.push(l),t.update.push(u);const h=jr(Ot()).getInertBodyElement(o),d=mi(h)||h;return d?Lc(e,t,n,r,c,l,u,d,i,a,0):0}function Lc(e,t,n,r,i,s,o,a,c,l,u){let h=0,d=a.firstChild;for(;d;){const a=Us(e,n,1,null);switch(d.nodeType){case Node.ELEMENT_NODE:const f=d,p=f.tagName.toLowerCase();if(si.hasOwnProperty(p)){Uc(i,Ka,p,c,a),e.data[a]=p;const g=f.attributes;for(let e=0;e<g.length;e++){const t=g.item(e),n=t.name.toLowerCase();t.value.match(Ec)?ci.hasOwnProperty(n)&&kc(o,t.value,a,t.name,0,oi[n]?Qr:ai[n]?Xr:null):Vc(i,a,t)}h=Lc(e,t,n,r,i,s,o,d,a,l,u+1)|h,Fc(s,a,u)}break;case Node.TEXT_NODE:const g=d.textContent||"",m=g.match(Ec);Uc(i,null,m?"":g,c,a),Fc(s,a,u),m&&(h=kc(o,g,a,null,0,null)|h);break;case Node.COMMENT_NODE:const y=wc.exec(d.textContent||"");if(y){const t=l[parseInt(y[1],10)];Uc(i,Ja,"",c,a),Mc(e,n,r,c,t,a),Bc(s,a,u)}}d=d.nextSibling}return h}function Fc(e,t,n){0===n&&e.push(t)}function Bc(e,t,n){0===n&&(e.push(~t),e.push(t))}function Uc(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function Vc(e,t,n){e.push(t<<1|1,n.name,n.value)}function $c(e,t,n=-1){const r=Ht(),i=zt(),s=20+e,o=Ft(r.consts,t),a=jt();r.firstCreatePass&&function(e,t,n,r,i,s){const o=jt(),a=[],c=[],l=[[]],u=function(e){return e.replace(Oc," ")}(i=function(e,t){if(function(e){return-1===e}(t))return Nc(e);{const n=e.indexOf(`:${t}\ufffd`)+2+t.toString().length,r=e.search(new RegExp(`\ufffd\\/\\*\\d+:${t}\ufffd`));return Nc(e.substring(n,r))}}(i,s)).split(Pc);for(let h=0;h<u.length;h++){let r=u[h];if(0==(1&h)){const s=Rc(r);for(let r=0;r<s.length;r++){let u=s[r];if(0==(1&r)){const t=u;""!==t&&Ic(e,o,l[0],a,c,n,t)}else{const r=u;if("object"!=typeof r)throw new Error(`Unable to parse ICU expression in "${i}" message.`);Mc(e,n,c,t,r,Tc(e,o,l[0],n,a,"",!0).index)}}}else{const t=47===r.charCodeAt(0),n=(r.charCodeAt(t?1:0),20+Number.parseInt(r.substring(t?2:1)));if(t)l.shift(),Zt(jt(),!1);else{const t=lc(e,l[0],n);l.unshift([]),Zt(t,!0)}}}e.data[r]={create:a,update:c}}(r,null===a?0:a.index,i,s,o,n);const c=r.data[s],l=Zi(r,a===i[6]?null:a,i);(function(e,t,n,r){const i=e[11];for(let s=0;s<t.length;s++){const o=t[s++],a=t[s],c=(o&Qa.COMMENT)===Qa.COMMENT,l=(o&Qa.APPEND_EAGERLY)===Qa.APPEND_EAGERLY,u=o>>>Qa.SHIFT;let h=e[u];null===h&&(h=e[u]=c?i.createComment(a):Ui(i,a)),l&&null!==n&&Yi(i,n,h,r,!1)}})(i,c.create,l,a&&8&a.type?i[a.index]:null),rn(!0)}function zc(){rn(!1)}function Hc(e,t,n){$c(e,t,n),zc()}function Gc(e){return function(e){e&&(fc|=1<<Math.min(pc,31)),pc++}(ea(zt(),tn(),e)),Gc}function qc(e){!function(e,t,n){if(pc>0){const r=e.data[n];mc(e,t,Array.isArray(r)?r:r.update,en()-pc-1,fc)}fc=0,pc=0}(Ht(),zt(),e+20)}function Wc(e,t,n,r,i){if(e=me(e),Array.isArray(e))for(let s=0;s<e.length;s++)Wc(e[s],t,n,r,i);else{const s=Ht(),o=zt();let a=Uo(e)?e:me(e.provide),c=Lo(e);const l=qt(),u=1048575&l.providerIndexes,h=l.directiveStart,d=l.providerIndexes>>20;if(Uo(e)||!e.multi){const r=new Tn(c,i,ca),f=Yc(a,t,i?u:u+d,h);-1===f?(Hn(Un(l,o),s,a),jc(s,e,t.length),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(r),o.push(r)):(n[f]=r,o[f]=r)}else{const f=Yc(a,t,u+d,h),p=Yc(a,t,u,u+d),g=f>=0&&n[f],m=p>=0&&n[p];if(i&&!m||!i&&!g){Hn(Un(l,o),s,a);const u=function(e,t,n,r,i){const s=new Tn(e,n,ca);return s.multi=[],s.index=t,s.componentProviders=0,Zc(s,i,r&&!n),s}(i?Jc:Kc,n.length,i,r,c);!i&&m&&(n[p].providerFactory=u),jc(s,e,t.length,0),t.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(u),o.push(u)}else jc(s,e,f>-1?f:p,Zc(n[i?p:f],c,!i&&r));!i&&r&&m&&n[p].componentProviders++}}}function jc(e,t,n,r){const i=Uo(t);if(i||function(e){return!!e.useClass}(t)){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function Zc(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function Yc(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function Kc(e,t,n,r){return Qc(this.multi,[])}function Jc(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Jn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),Qc(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],Qc(i,s);return s}function Qc(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Xc(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ht();if(r.firstCreatePass){const i=pt(e);Wc(n,r.data,r.blueprint,i,!0),Wc(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class el{}const tl="ngComponent";class nl{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${de(e)}. Did you add it to @NgModule.entryComponents?`);return t[tl]=e,t}(e)}}let rl=(()=>{class e{}return e.NULL=new nl,e})();function il(...e){}function sl(e,t){return new al(Nt(e,t))}const ol=function(){return sl(qt(),zt())};let al=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=ol,e})();function cl(e){return e instanceof al?e.nativeElement:e}class ll{}let ul=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>hl(),e})();const hl=function(){const e=zt(),t=Rt(qt().index,e);return function(e){return e[11]}(lt(t)?t:e)};let dl=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>null}),e})();class fl{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const pl=new fl("12.2.16");class gl{constructor(){}supports(e){return Jo(e)}create(e){return new yl(e)}}const ml=(e,t)=>t;class yl{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||ml}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<El(n,r,i)?t:n,o=El(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Jo(e))throw new Error(`Error trying to diff '${de(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Yo()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new vl(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Cl),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Cl),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class vl{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class _l{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class Cl{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new _l,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function El(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class wl{constructor(){}supports(e){return e instanceof Map||Qo(e)}create(){return new bl}}class bl{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Qo(e)))throw new Error(`Error trying to diff '${de(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Sl(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Sl{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Pl(){return new Ol([new gl])}let Ol=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Pl()),deps:[[e,new xr,new Mr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:Pl}),e})();function Tl(){return new Il([new wl])}let Il=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Tl()),deps:[[e,new xr,new Mr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:Tl}),e})();function kl(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(kt(s)),ut(s))for(let e=10;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&kl(t[1],t,n,r)}const o=n.type;if(8&o)kl(e,t,n.child,r);else if(32&o){const e=xi(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=os(t,n);if(Array.isArray(e))r.push(...e);else{const n=Ri(t[16]);kl(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class Al{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return kl(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ut(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Gi(e,n),dr(t,n))}this._attachedToViewContainer=!1}qi(this._lView[1],this._lView)}onDestroy(e){Ys(this._lView[1],this._lView,null,e)}markForCheck(){go(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){mo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Qt(!0);try{mo(e,t,n)}finally{Qt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,us(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Nl extends Al{constructor(e){super(e),this._view=e}detectChanges(){yo(this._view)}checkNoChanges(){!function(e){Qt(!0);try{yo(e)}finally{Qt(!1)}}(this._view)}get context(){return null}}const Ml=function(e){return function(e,t,n){if(dt(e)&&!n){const n=Rt(e.index,t);return new Al(n,n)}return 47&e.type?new Al(t[16],t):null}(qt(),zt(),16==(16&e))};let xl=(()=>{class e{}return e.__NG_ELEMENT_ID__=Ml,e})();const Rl=[new wl],Dl=new Ol([new gl]),Ll=new Il(Rl),Fl=function(){return $l(qt(),zt())};let Bl=(()=>{class e{}return e.__NG_ELEMENT_ID__=Fl,e})();const Ul=Bl,Vl=class extends Ul{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ls(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vs(t,n,e),new Al(n)}};function $l(e,t){return 4&e.type?new Vl(t,e,sl(e,t)):null}class zl{}class Hl{}const Gl=function(){return Kl(qt(),zt())};let ql=(()=>{class e{}return e.__NG_ELEMENT_ID__=Gl,e})();const Wl=ql,jl=class extends Wl{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return sl(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const e=zn(this._hostTNode,this._hostLView);if(xn(e)){const t=Dn(e,this._hostLView),n=Rn(e);return new er(t[1].data[n+8],t)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Zl(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(zl,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(ut(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new jl(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-10?(t[4]=n[i],hr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=as(i,s),a=n[11],c=Qi(a,s[7]);return null!==c&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,us(e,r,n,1,i,s)}(r,s[6],a,n,c,o),e.attachToViewContainerRef(),hr(Yl(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Zl(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);n&&(dr(Yl(this._lContainer),t),qi(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);return n&&null!=dr(Yl(this._lContainer),t)?new Al(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function Zl(e){return e[8]}function Yl(e){return e[8]||(e[8]=[])}function Kl(e,t){let n;const r=t[e.index];if(ut(r))n=r;else{let i;if(8&e.type)i=kt(r);else{const n=t[11];i=n.createComment("");const r=Nt(e,t);Yi(n,Qi(n,r),i,function(e,t){return Tt(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=lo(r,t,i,e),po(t,n)}return new jl(n,e,t)}const Jl={};class Ql extends rl{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=at(e);return new tu(t,this.ngModule)}}function Xl(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const eu=new or("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ki});class tu extends el{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ps).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Xl(this.componentDef.inputs)}get outputs(){return Xl(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,Jl,i);return s!==Jl||r===Jl?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(ll,It),o=i.get(dl,null),a=s.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",l=n?function(e,t,n){if(Tt(e))return e.selectRootElement(t,n===Be.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):zi(s.createRenderer(null,this.componentDef),c,function(e){const t=e.toLowerCase();return"svg"===t?St:"math"===t?"http://www.w3.org/1998/MathML/":null}(c)),u=this.componentDef.onPush?576:528,h=function(e,t){return{components:[],scheduler:e||ki,clean:_o,playerHandler:t||null,flags:0}}(),d=Zs(0,null,null,1,0,null,null,null,null,null),f=Ls(null,d,h,u,null,null,s,a,o,i);let p,g;hn(f);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=Fs(o,20,2,"#host",null),c=a.mergedAttrs=t.hostAttrs;null!==c&&(Po(a,c,!0),null!==e&&(In(i,e,c),null!==a.classes&&fs(i,e,a.classes),null!==a.styles&&ds(i,e,a.styles)));const l=r.createRenderer(e,t),u=Ls(n,js(t),null,t.onPush?64:16,n[20],a,r,l,s||null,null);return o.firstCreatePass&&(Hn(Un(a,n),o,t.type),to(o,a),ro(a,n.length,1)),po(n,u),n[20]=u}(l,this.componentDef,f,s,a);if(l)if(n)In(a,l,["ng-version",pl.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Cs(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&In(a,l,e),t&&t.length>0&&fs(a,l,t.join(" "))}if(g=Mt(d,20),void 0!==t){const e=g.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}p=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=qt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),io(e,r,t,Us(e,t,1,null),n));const i=Jn(t,e,r.directiveStart,r);wi(i,t);const s=Nt(r,t);return s&&wi(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=qt();t.contentQueries(1,o,e.directiveStart)}const a=qt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(vn(a.index),Xs(n[1],a,0,a.directiveStart,a.directiveEnd,t),eo(t,o)),o}(e,this.componentDef,f,h,[zo]),Vs(d,f,null)}finally{mn()}return new nu(this.componentType,p,sl(g,f),f,g)}}class nu extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new Nl(r),this.componentType=e}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const ru=new Map;class iu extends zl{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Ql(this);const n=ct(e),r=e[Ye]||null;r&&ec(r),this._bootstrapComponents=Ai(n.bootstrap),this._r3Injector=xo(e,t,[{provide:zl,useValue:this},{provide:rl,useValue:this.componentFactoryResolver}],de(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=$o.THROW_IF_NOT_FOUND,n=Me.Default){return e===$o||e===zl||e===Oo?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class su extends Hl{constructor(e){super(),this.moduleType=e,null!==ct(e)&&function(e){const t=new Set;!function e(n){const r=ct(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${de(t)} vs ${de(t.name)}`)}(i,ru.get(i),n),ru.set(i,n));const s=Ai(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new iu(this.moduleType,e)}}function ou(e,t,n){const r=Xt()+e,i=zt();return i[r]===Os?Xo(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function au(e,t,n,r){return hu(zt(),Xt(),e,t,n,r)}function cu(e,t,n,r,i){return du(zt(),Xt(),e,t,n,r,i)}function lu(e,t,n,r,i,s,o){return function(e,t,n,r,i,s,o,a,c){const l=t+n;return function(e,t,n,r,i,s){const o=ta(e,t,n,r);return ta(e,t+2,i,s)||o}(e,l,i,s,o,a)?Xo(e,l+4,c?r.call(c,i,s,o,a):r(i,s,o,a)):uu(e,l+4)}(zt(),Xt(),e,t,n,r,i,s,o)}function uu(e,t){const n=e[t];return n===Os?void 0:n}function hu(e,t,n,r,i,s){const o=t+n;return ea(e,o,i)?Xo(e,o+1,s?r.call(s,i):r(i)):uu(e,o+1)}function du(e,t,n,r,i,s,o){const a=t+n;return ta(e,a,i,s)?Xo(e,a+2,o?r.call(o,i,s):r(i,s)):uu(e,a+2)}function fu(e,t){const n=Ht();let r;const i=e+20;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new ve("302",`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=mt(r.type)),o=Re(ca);try{const e=Fn(!1),t=s();return Fn(e),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,zt(),i,t),t}finally{Re(o)}}function pu(e,t,n){const r=e+20,i=zt(),s=xt(i,r);return mu(i,gu(i,r)?hu(i,Xt(),t,s.transform,n,s):s.transform(n))}function gu(e,t){return e[1].data[t].pure}function mu(e,t){return Ko.isWrapped(t)&&(t=Ko.unwrap(t),e[en()]=Os),t}function yu(e){return t=>{setTimeout(e,void 0,t)}}const vu=class extends A{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,i,s;let o=e,c=t||(()=>null),l=n;if(e&&"object"==typeof e){const t=e;o=null===(r=t.next)||void 0===r?void 0:r.bind(t),c=null===(i=t.error)||void 0===i?void 0:i.bind(t),l=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(c=yu(c),o&&(o=yu(o)),l&&(l=yu(l)));const u=super.subscribe({next:o,error:c,complete:l});return e instanceof a&&e.add(u),u}};function _u(){return this._results[Yo()]()}class Cu{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Yo(),n=Cu.prototype;n[t]||(n[t]=_u)}get changes(){return this._changes||(this._changes=new vu)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=lr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Eu{constructor(e){this.queryList=e,this.matches=null}clone(){return new Eu(this.queryList)}setDirty(){this.queryList.setDirty()}}class wu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new wu(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==xu(e,t).matches&&this.queries[t].setDirty()}}class bu{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Su{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new Su(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Pu{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Pu(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,Ou(t,i)),this.matchTNodeWithReadOption(e,t,Kn(t,e,i,!1,!1))}else n===Bl?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kn(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===al||r===ql||r===Bl&&4&t.type)this.addMatch(t.index,-2);else{const n=Kn(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function Ou(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function Tu(e,t,n,r){return-1===n?function(e,t){return 11&e.type?sl(e,t):4&e.type?$l(e,t):null}(t,e):-2===n?function(e,t,n){return n===al?sl(t,e):n===Bl?$l(t,e):n===ql?Kl(t,e):void 0}(e,t,r):Jn(e,e[1],n,t)}function Iu(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,s=n.matches,o=[];for(let e=0;e<s.length;e+=2){const i=s[e];o.push(i<0?null:Tu(t,r[i],s[e+1],n.metadata.read))}i.matches=o}return i.matches}function ku(e,t,n,r){const i=e.queries.getByIndex(n),s=i.matches;if(null!==s){const o=Iu(e,t,i,n);for(let e=0;e<s.length;e+=2){const n=s[e];if(n>0)r.push(o[e/2]);else{const i=s[e+1],o=t[-n];for(let e=10;e<o.length;e++){const t=o[e];t[17]===t[3]&&ku(t[1],t,i,r)}if(null!==o[9]){const e=o[9];for(let t=0;t<e.length;t++){const n=e[t];ku(n[1],n,i,r)}}}}}return r}function Au(e){const t=zt(),n=Ht(),r=an();cn(r+1);const i=xu(n,r);if(e.dirty&&Dt(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?ku(n,t,r,[]):Iu(n,t,i,r);e.reset(s,cl),e.notifyOnChanges()}return!0}return!1}function Nu(e,t,n){const r=Ht();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Su),e.queries.track(new Pu(t,n))}(r,new bu(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){const r=new Cu(4==(4&n));Ys(e,t,r,r.destroy),null===t[19]&&(t[19]=new wu),t[19].queries.push(new Eu(r))}(r,zt(),t)}function Mu(){return e=zt(),t=an(),e[19].queries[t].queryList;var e,t}function xu(e,t){return e.queries.getByIndex(t)}function Ru(e,t){return $l(e,t)}const Du=new or("Application Initializer");let Lu=(()=>{class e{constructor(e){this.appInits=e,this.resolve=il,this.reject=il,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(ya(t))e.push(t);else if(va(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(Du,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Fu=new or("AppId"),Bu={provide:Fu,useFactory:function(){return`${Uu()}${Uu()}${Uu()}`},deps:[]};function Uu(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Vu=new or("Platform Initializer"),$u=new or("Platform ID"),zu=new or("appBootstrapListener");let Hu=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Gu=new or("LocaleId"),qu=new or("DefaultCurrencyCode");class Wu{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const ju=function(e){return new su(e)},Zu=ju,Yu=function(e){return Promise.resolve(ju(e))},Ku=function(e){const t=ju(e),n=Ai(ct(e).declarations).reduce((e,t)=>{const n=at(t);return n&&e.push(new tu(n)),e},[]);return new Wu(t,n)},Ju=Ku,Qu=function(e){return Promise.resolve(Ku(e))};let Xu=(()=>{class e{constructor(){this.compileModuleSync=Zu,this.compileModuleAsync=Yu,this.compileModuleAndAllComponentsSync=Ju,this.compileModuleAndAllComponentsAsync=Qu}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const eh=(()=>Promise.resolve(0))();function th(e){"undefined"==typeof Zone?eh.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class nh{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new vu(!1),this.onMicrotaskEmpty=new vu(!1),this.onStable=new vu(!1),this.onError=new vu(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ze,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,sh(e),e.isCheckStableRunning=!0,ih(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),sh(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return oh(e),n.invokeTask(i,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),ah(e)}},onInvoke:(n,r,i,s,o,a,c)=>{try{return oh(e),n.invoke(i,s,o,a,c)}finally{e.shouldCoalesceRunChangeDetection&&t(),ah(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,sh(e),ih(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!nh.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(nh.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,rh,il,il);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const rh={};function ih(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function sh(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function oh(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ah(e){e._nesting--,ih(e)}class ch{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vu,this.onMicrotaskEmpty=new vu,this.onStable=new vu,this.onError=new vu}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let lh=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{nh.assertNotInAngularZone(),th(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())th(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Or(nh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),uh=(()=>{class e{constructor(){this._applications=new Map,dh.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return dh.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class hh{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let dh=new hh,fh=!0,ph=!1;let gh;const mh=new or("AllowMultipleToken");class yh{constructor(e,t){this.name=e,this.token=t}}function vh(e,t,n=[]){const r=`Platform: ${t}`,i=new or(r);return(t=[])=>{let s=_h();if(!s||s.injector.get(mh,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:Io,useValue:"platform"});!function(e){if(gh&&!gh.destroyed&&!gh.injector.get(mh,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");gh=e.get(Ch);const t=e.get(Vu,null);t&&t.forEach(e=>e())}($o.create({providers:e,name:r}))}return function(e){const t=_h();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function _h(){return gh&&!gh.destroyed?gh:null}let Ch=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new ch:("zone.js"===e?void 0:e)||new nh({enableLongStackTrace:(ph=!0,fh),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:nh,useValue:n}];return n.run(()=>{const i=$o.create({providers:r,parent:this.injector,name:e.moduleType.name}),s=e.create(i),o=s.injector.get(Oi,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});s.onDestroy(()=>{bh(this._modules,s),e.unsubscribe()})}),function(e,n,r){try{const t=r();return ya(t)?t.catch(t=>{throw n.runOutsideAngular(()=>e.handleError(t)),t}):t}catch(t){throw n.runOutsideAngular(()=>e.handleError(t)),t}}(o,n,()=>{const e=s.injector.get(Lu);return e.runInitializers(),e.donePromise.then(()=>(ec(s.injector.get(Gu,Ya)||Ya),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const n=Eh({},t);return function(e,t,n){const r=new su(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(wh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${de(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Eh(e,t){return Array.isArray(t)?t.reduce(Eh,e):Object.assign(Object.assign({},e),t)}let wh=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new T(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),o=new T(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{nh.assertNotInAngularZone(),th(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{nh.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){const t=re(e),n=function(e,t){return"number"==typeof te(e)?e.pop():1/0}(e),r=e;return r.length?1===r.length?Y(r[0]):X(n)(ae(r,t)):ee}(s,o.pipe(function(e={}){const{connector:t=(()=>new A),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return e=>{let s=null,o=null,a=null,c=0,l=!1,u=!1;const h=()=>{null==o||o.unsubscribe(),o=null},d=()=>{h(),s=a=null,l=u=!1},f=()=>{const e=s;d(),null==e||e.unsubscribe()};return x((e,p)=>{c++,!u&&!l&&h();const g=a=a??t();p.add(()=>{c--,0===c&&!u&&!l&&(o=le(f,i))}),g.subscribe(p),s||(s=new C({next:e=>g.next(e),error:e=>{u=!0,h(),o=le(d,n,e),g.error(e)},complete:()=>{l=!0,h(),o=le(d,r),g.complete()}}),ae(e).subscribe(s))})(e)}}()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof el?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(zl),i=n.create($o.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(lh,null),a=o&&i.injector.get(uh);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),bh(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;bh(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(zu,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Or(nh),Or($o),Or(Oi),Or(rl),Or(Lu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function bh(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Sh{}class Ph{}const Oh={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Th=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||Oh}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>Ih(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>Ih(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Or(Xu),Or(Ph,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Ih(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const kh=vh(null,"core",[{provide:$u,useValue:"unknown"},{provide:Ch,deps:[$o]},{provide:uh,deps:[]},{provide:Hu,deps:[]}]),Ah=[{provide:wh,useClass:wh,deps:[nh,$o,Oi,rl,Lu]},{provide:eu,deps:[nh],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Lu,useClass:Lu,deps:[[new Mr,Du]]},{provide:Xu,useClass:Xu,deps:[]},Bu,{provide:Ol,useFactory:function(){return Dl},deps:[]},{provide:Il,useFactory:function(){return Ll},deps:[]},{provide:Gu,useFactory:function(e){return ec(e=e||"undefined"!=typeof $localize&&$localize.locale||Ya),e},deps:[[new Nr(Gu),new Mr,new xr]]},{provide:qu,useValue:"USD"}];let Nh=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Or(wh))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:Ah}),e})(),Mh=null;function xh(){return Mh}const Rh=new or("DocumentToken");let Dh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:Lh,token:e,providedIn:"platform"}),e})();function Lh(){return Or(Bh)}const Fh=new or("Location Initialized");let Bh=(()=>{class e extends Dh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return xh().getBaseHref(this._doc)}onPopState(e){const t=xh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=xh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){Uh()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){Uh()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh))},e.\u0275prov=be({factory:Vh,token:e,providedIn:"platform"}),e})();function Uh(){return!!window.history.pushState}function Vh(){return new Bh(Or(Rh))}function $h(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function zh(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Hh(e){return e&&"?"!==e[0]?"?"+e:e}let Gh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:qh,token:e,providedIn:"root"}),e})();function qh(e){const t=Or(Rh).location;return new jh(Or(Dh),t&&t.origin||"")}const Wh=new or("appBaseHref");let jh=(()=>{class e extends Gh{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return $h(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+Hh(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+Hh(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+Hh(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh),Or(Wh,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Zh=(()=>{class e extends Gh{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=$h(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+Hh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+Hh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Dh),Or(Wh,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Yh=(()=>{class e{constructor(e,t){this._subject=new vu,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=zh(Jh(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+Hh(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Jh(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Hh(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Hh(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Or(Gh),Or(Dh))},e.normalizeQueryParams=Hh,e.joinWithSlash=$h,e.stripTrailingSlash=zh,e.\u0275prov=be({factory:Kh,token:e,providedIn:"root"}),e})();function Kh(){return new Yh(Or(Gh),Or(Dh))}function Jh(e){return e.replace(/\/index.html$/,"")}var Qh=(()=>((Qh=Qh||{})[Qh.Decimal=0]="Decimal",Qh[Qh.Percent=1]="Percent",Qh[Qh.Currency=2]="Currency",Qh[Qh.Scientific=3]="Scientific",Qh))(),Xh=(()=>((Xh=Xh||{})[Xh.Zero=0]="Zero",Xh[Xh.One=1]="One",Xh[Xh.Two=2]="Two",Xh[Xh.Few=3]="Few",Xh[Xh.Many=4]="Many",Xh[Xh.Other=5]="Other",Xh))(),ed=(()=>((ed=ed||{})[ed.Format=0]="Format",ed[ed.Standalone=1]="Standalone",ed))(),td=(()=>((td=td||{})[td.Narrow=0]="Narrow",td[td.Abbreviated=1]="Abbreviated",td[td.Wide=2]="Wide",td[td.Short=3]="Short",td))(),nd=(()=>((nd=nd||{})[nd.Short=0]="Short",nd[nd.Medium=1]="Medium",nd[nd.Long=2]="Long",nd[nd.Full=3]="Full",nd))(),rd=(()=>((rd=rd||{})[rd.Decimal=0]="Decimal",rd[rd.Group=1]="Group",rd[rd.List=2]="List",rd[rd.PercentSign=3]="PercentSign",rd[rd.PlusSign=4]="PlusSign",rd[rd.MinusSign=5]="MinusSign",rd[rd.Exponential=6]="Exponential",rd[rd.SuperscriptingExponent=7]="SuperscriptingExponent",rd[rd.PerMille=8]="PerMille",rd[rd.Infinity=9]="Infinity",rd[rd.NaN=10]="NaN",rd[rd.TimeSeparator=11]="TimeSeparator",rd[rd.CurrencyDecimal=12]="CurrencyDecimal",rd[rd.CurrencyGroup=13]="CurrencyGroup",rd))();function id(e,t){return ud(Ga(e)[ja.DateFormat],t)}function sd(e,t){return ud(Ga(e)[ja.TimeFormat],t)}function od(e,t){return ud(Ga(e)[ja.DateTimeFormat],t)}function ad(e,t){const n=Ga(e),r=n[ja.NumberSymbols][t];if(void 0===r){if(t===rd.CurrencyDecimal)return n[ja.NumberSymbols][rd.Decimal];if(t===rd.CurrencyGroup)return n[ja.NumberSymbols][rd.Group]}return r}const cd=qa;function ld(e){if(!e[ja.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[ja.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function ud(e,t){for(let n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function hd(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const dd=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,fd={},pd=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var gd=(()=>((gd=gd||{})[gd.Short=0]="Short",gd[gd.ShortGMT=1]="ShortGMT",gd[gd.Long=2]="Long",gd[gd.Extended=3]="Extended",gd))(),md=(()=>((md=md||{})[md.FullYear=0]="FullYear",md[md.Month=1]="Month",md[md.Date=2]="Date",md[md.Hours=3]="Hours",md[md.Minutes=4]="Minutes",md[md.Seconds=5]="Seconds",md[md.FractionalSeconds=6]="FractionalSeconds",md[md.Day=7]="Day",md))(),yd=(()=>((yd=yd||{})[yd.DayPeriods=0]="DayPeriods",yd[yd.Days=1]="Days",yd[yd.Months=2]="Months",yd[yd.Eras=3]="Eras",yd))();function vd(e,t,n,r){let i=function(e){if(Nd(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[t,n=1,r=1]=e.split("-").map(e=>+e);return _d(t,n-1,r)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let n;if(n=e.match(dd))return function(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,s=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const o=Number(e[4]||0)-n,a=Number(e[5]||0)-r,c=Number(e[6]||0),l=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return s.call(t,o,a,c,l),t}(n)}const t=new Date(e);if(!Nd(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=Cd(n,t)||t;let s,o=[];for(;t;){if(s=pd.exec(t),!s){o.push(t);break}{o=o.concat(s.slice(1));const e=o.pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();r&&(a=Ad(r,a),i=function(e,t,n){const r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(Ad(t,r)-r))}(i,r));let c="";return o.forEach(e=>{const t=function(e){if(kd[e])return kd[e];let t;switch(e){case"G":case"GG":case"GGG":t=Sd(yd.Eras,td.Abbreviated);break;case"GGGG":t=Sd(yd.Eras,td.Wide);break;case"GGGGG":t=Sd(yd.Eras,td.Narrow);break;case"y":t=bd(md.FullYear,1,0,!1,!0);break;case"yy":t=bd(md.FullYear,2,0,!0,!0);break;case"yyy":t=bd(md.FullYear,3,0,!1,!0);break;case"yyyy":t=bd(md.FullYear,4,0,!1,!0);break;case"Y":t=Id(1);break;case"YY":t=Id(2,!0);break;case"YYY":t=Id(3);break;case"YYYY":t=Id(4);break;case"M":case"L":t=bd(md.Month,1,1);break;case"MM":case"LL":t=bd(md.Month,2,1);break;case"MMM":t=Sd(yd.Months,td.Abbreviated);break;case"MMMM":t=Sd(yd.Months,td.Wide);break;case"MMMMM":t=Sd(yd.Months,td.Narrow);break;case"LLL":t=Sd(yd.Months,td.Abbreviated,ed.Standalone);break;case"LLLL":t=Sd(yd.Months,td.Wide,ed.Standalone);break;case"LLLLL":t=Sd(yd.Months,td.Narrow,ed.Standalone);break;case"w":t=Td(1);break;case"ww":t=Td(2);break;case"W":t=Td(1,!0);break;case"d":t=bd(md.Date,1);break;case"dd":t=bd(md.Date,2);break;case"c":case"cc":t=bd(md.Day,1);break;case"ccc":t=Sd(yd.Days,td.Abbreviated,ed.Standalone);break;case"cccc":t=Sd(yd.Days,td.Wide,ed.Standalone);break;case"ccccc":t=Sd(yd.Days,td.Narrow,ed.Standalone);break;case"cccccc":t=Sd(yd.Days,td.Short,ed.Standalone);break;case"E":case"EE":case"EEE":t=Sd(yd.Days,td.Abbreviated);break;case"EEEE":t=Sd(yd.Days,td.Wide);break;case"EEEEE":t=Sd(yd.Days,td.Narrow);break;case"EEEEEE":t=Sd(yd.Days,td.Short);break;case"a":case"aa":case"aaa":t=Sd(yd.DayPeriods,td.Abbreviated);break;case"aaaa":t=Sd(yd.DayPeriods,td.Wide);break;case"aaaaa":t=Sd(yd.DayPeriods,td.Narrow);break;case"b":case"bb":case"bbb":t=Sd(yd.DayPeriods,td.Abbreviated,ed.Standalone,!0);break;case"bbbb":t=Sd(yd.DayPeriods,td.Wide,ed.Standalone,!0);break;case"bbbbb":t=Sd(yd.DayPeriods,td.Narrow,ed.Standalone,!0);break;case"B":case"BB":case"BBB":t=Sd(yd.DayPeriods,td.Abbreviated,ed.Format,!0);break;case"BBBB":t=Sd(yd.DayPeriods,td.Wide,ed.Format,!0);break;case"BBBBB":t=Sd(yd.DayPeriods,td.Narrow,ed.Format,!0);break;case"h":t=bd(md.Hours,1,-12);break;case"hh":t=bd(md.Hours,2,-12);break;case"H":t=bd(md.Hours,1);break;case"HH":t=bd(md.Hours,2);break;case"m":t=bd(md.Minutes,1);break;case"mm":t=bd(md.Minutes,2);break;case"s":t=bd(md.Seconds,1);break;case"ss":t=bd(md.Seconds,2);break;case"S":t=bd(md.FractionalSeconds,1);break;case"SS":t=bd(md.FractionalSeconds,2);break;case"SSS":t=bd(md.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Pd(gd.Short);break;case"ZZZZZ":t=Pd(gd.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Pd(gd.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Pd(gd.Long);break;default:return null}return kd[e]=t,t}(e);c+=t?t(i,n,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function _d(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function Cd(e,t){const n=function(e){return Ga(e)[ja.LocaleId]}(e);if(fd[n]=fd[n]||{},fd[n][t])return fd[n][t];let r="";switch(t){case"shortDate":r=id(e,nd.Short);break;case"mediumDate":r=id(e,nd.Medium);break;case"longDate":r=id(e,nd.Long);break;case"fullDate":r=id(e,nd.Full);break;case"shortTime":r=sd(e,nd.Short);break;case"mediumTime":r=sd(e,nd.Medium);break;case"longTime":r=sd(e,nd.Long);break;case"fullTime":r=sd(e,nd.Full);break;case"short":const t=Cd(e,"shortTime"),n=Cd(e,"shortDate");r=Ed(od(e,nd.Short),[t,n]);break;case"medium":const i=Cd(e,"mediumTime"),s=Cd(e,"mediumDate");r=Ed(od(e,nd.Medium),[i,s]);break;case"long":const o=Cd(e,"longTime"),a=Cd(e,"longDate");r=Ed(od(e,nd.Long),[o,a]);break;case"full":const c=Cd(e,"fullTime"),l=Cd(e,"fullDate");r=Ed(od(e,nd.Full),[c,l])}return r&&(fd[n][t]=r),r}function Ed(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function wd(e,t,n="-",r,i){let s="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,s=n));let o=String(e);for(;o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),s+o}function bd(e,t,n=0,r=!1,i=!1){return function(s,o){let a=function(e,t){switch(e){case md.FullYear:return t.getFullYear();case md.Month:return t.getMonth();case md.Date:return t.getDate();case md.Hours:return t.getHours();case md.Minutes:return t.getMinutes();case md.Seconds:return t.getSeconds();case md.FractionalSeconds:return t.getMilliseconds();case md.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,s);if((n>0||a>-n)&&(a+=n),e===md.Hours)0===a&&-12===n&&(a=12);else if(e===md.FractionalSeconds)return function(e,t){return wd(e,3).substr(0,t)}(a,t);const c=ad(o,rd.MinusSign);return wd(a,t,c,r,i)}}function Sd(e,t,n=ed.Format,r=!1){return function(i,s){return function(e,t,n,r,i,s){switch(n){case yd.Months:return function(e,t,n){const r=Ga(e),i=ud([r[ja.MonthsFormat],r[ja.MonthsStandalone]],t);return ud(i,n)}(t,i,r)[e.getMonth()];case yd.Days:return function(e,t,n){const r=Ga(e),i=ud([r[ja.DaysFormat],r[ja.DaysStandalone]],t);return ud(i,n)}(t,i,r)[e.getDay()];case yd.DayPeriods:const o=e.getHours(),a=e.getMinutes();if(s){const e=function(e){const t=Ga(e);return ld(t),(t[ja.ExtraData][2]||[]).map(e=>"string"==typeof e?hd(e):[hd(e[0]),hd(e[1])])}(t),n=function(e,t,n){const r=Ga(e);ld(r);const i=ud([r[ja.ExtraData][0],r[ja.ExtraData][1]],t)||[];return ud(i,n)||[]}(t,i,r),s=e.findIndex(e=>{if(Array.isArray(e)){const[t,n]=e,r=o>=t.hours&&a>=t.minutes,i=o<n.hours||o===n.hours&&a<n.minutes;if(t.hours<n.hours){if(r&&i)return!0}else if(r||i)return!0}else if(e.hours===o&&e.minutes===a)return!0;return!1});if(-1!==s)return n[s]}return function(e,t,n){const r=Ga(e),i=ud([r[ja.DayPeriodsFormat],r[ja.DayPeriodsStandalone]],t);return ud(i,n)}(t,i,r)[o<12?0:1];case yd.Eras:return function(e,t){return ud(Ga(e)[ja.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,s,e,t,n,r)}}function Pd(e){return function(t,n,r){const i=-1*r,s=ad(n,rd.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case gd.Short:return(i>=0?"+":"")+wd(o,2,s)+wd(Math.abs(i%60),2,s);case gd.ShortGMT:return"GMT"+(i>=0?"+":"")+wd(o,1,s);case gd.Long:return"GMT"+(i>=0?"+":"")+wd(o,2,s)+":"+wd(Math.abs(i%60),2,s);case gd.Extended:return 0===r?"Z":(i>=0?"+":"")+wd(o,2,s)+":"+wd(Math.abs(i%60),2,s);default:throw new Error(`Unknown zone width "${e}"`)}}}function Od(e){return _d(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function Td(e,t=!1){return function(n,r){let i;if(t){const e=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,t=n.getDate();i=1+Math.floor((t+e)/7)}else{const e=Od(n),t=function(e){const t=_d(e,0,1).getDay();return _d(e,0,1+(t<=4?4:11)-t)}(e.getFullYear()),r=e.getTime()-t.getTime();i=1+Math.round(r/6048e5)}return wd(i,e,ad(r,rd.MinusSign))}}function Id(e,t=!1){return function(n,r){return wd(Od(n).getFullYear(),e,ad(r,rd.MinusSign),t)}}const kd={};function Ad(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function Nd(e){return e instanceof Date&&!isNaN(e.valueOf())}const Md=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function xd(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class Rd{}let Dd=(()=>{class e extends Rd{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(cd(t||this.locale)(e)){case Xh.Zero:return"zero";case Xh.One:return"one";case Xh.Two:return"two";case Xh.Few:return"few";case Xh.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Or(Gu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Ld(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let Fd=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Jo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${de(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(ca(Ol),ca(Il),ca(al),ca(ul))},e.\u0275dir=st({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class Bd{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ud=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch{throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new Bd(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new Vd(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new Vd(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ca(ql),ca(Bl),ca(Ol))},e.\u0275dir=st({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class Vd{constructor(e,t){this.record=e,this.view=t}}let $d=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new zd,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Hd("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Hd("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ca(ql),ca(Bl))},e.\u0275dir=st({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class zd{constructor(){this.$implicit=null,this.ngIf=null}}function Hd(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${de(t)}'.`)}let Gd=(()=>{class e{constructor(e){this._locale=e}transform(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,s,o=!1){let a="",c=!1;if(isFinite(e)){let l=function(e){let t,n,r,i,s,o=Math.abs(e)+"",a=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(s=o.length))t=[0],n=1;else{for(s--;"0"===o.charAt(s);)s--;for(n-=r,t=[],i=0;r<=s;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),a=n-1,n=1),{digits:t,exponent:a,integerLen:n}}(e);o&&(l=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(l));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(s){const e=s.match(Md);if(null===e)throw new Error(`${s} is not a valid digit info`);const t=e[1],n=e[3],r=e[5];null!=t&&(u=xd(t)),null!=n&&(h=xd(n)),null!=r?d=xd(r):null!=n&&h>d&&(d=h)}!function(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let o=s+e.integerLen,a=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(let e=o;e<r.length;e++)r[e]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let e=1;e<o;e++)r[e]=0}if(a>=5)if(o-1<0){for(let t=0;t>o;t--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let c=0!==s;const l=t+e.integerLen,u=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,c&&(0===r[n]&&n>=l?r.pop():c=!1),t>=10?1:0},0);u&&(r.unshift(u),e.integerLen++)}(l,h,d);let f=l.digits,p=l.integerLen;const g=l.exponent;let m=[];for(c=f.every(e=>!e);p<u;p++)f.unshift(0);for(;p<0;p++)f.unshift(0);p>0?m=f.splice(p,f.length):(m=f,f=[0]);const y=[];for(f.length>=t.lgSize&&y.unshift(f.splice(-t.lgSize,f.length).join(""));f.length>t.gSize;)y.unshift(f.splice(-t.gSize,f.length).join(""));f.length&&y.unshift(f.join("")),a=y.join(ad(n,r)),m.length&&(a+=ad(n,i)+m.join("")),g&&(a+=ad(n,rd.Exponential)+"+"+g)}else a=ad(n,rd.Infinity);return a=e<0&&!c?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf,a}(e,function(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=o[0],c=o[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<c.length;u++){const e=c.charAt(u);"0"===e?n.minFrac=n.maxFrac=u+1:"#"===e?n.maxFrac=u+1:n.posSuf+=e}const l=a.split(",");if(n.gSize=l[1]?l[1].length:0,n.lgSize=l[2]||l[1]?(l[2]||l[1]).length:0,s){const e=i.length-n.posPre.length-n.posSuf.length,t=s.indexOf("#");n.negPre=s.substr(0,t).replace(/'/g,""),n.negSuf=s.substr(t+e).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return Ga(e)[ja.NumberFormats][t]}(t,Qh.Decimal),ad(t,rd.MinusSign)),t,rd.Group,rd.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),r,n)}catch(i){throw function(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${de(e)}'`)}(e,i.message)}}}return e.\u0275fac=function(t){return new(t||e)(ca(Gu,16))},e.\u0275pipe=ot({name:"number",type:e,pure:!0}),e})();let qd=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[{provide:Rd,useClass:Dd}]}),e})();let Wd=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>new jd(Or(Rh),window)}),e})();class jd{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Zd(this.window.history)||Zd(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Zd(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Yd{}class Kd extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new Kd,Mh||(Mh=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(Qd=Qd||document.querySelector("base"),Qd?Qd.getAttribute("href"):null);return null==t?null:function(e){Jd=Jd||document.createElement("a"),Jd.setAttribute("href",e);const t=Jd.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){Qd=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Ld(document.cookie,e)}}let Jd,Qd=null;const Xd=new or("TRANSITION_ID"),ef=[{provide:Du,useFactory:function(e,t,n){return()=>{n.get(Lu).donePromise.then(()=>{const n=xh(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let e=0;e<r.length;e++)n.remove(r[e])})}},deps:[Xd,Rh,$o],multi:!0}];class tf{static init(){var e;e=new tf,dh=e}addToWindow(e){ze.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),ze.getAllAngularRootElements=()=>e.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(e=>{const t=ze.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){return null==t?null:e.getTestability(t)??(n?xh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}let nf=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const rf=new or("EventManagerPlugins");let sf=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Or(rf),Or(nh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class of{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=xh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let af=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),cf=(()=>{class e extends af{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(lf),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(lf))}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function lf(e){xh().remove(e)}const uf={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},hf=/%COMP%/g;function df(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?df(e,i,n):(i=i.replace(hf,e),n.push(i))}return n}function ff(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let pf=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new gf(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Be.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new mf(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Be.ShadowDom:return new yf(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=df(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Or(sf),Or(cf),Or(Fu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class gf{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(uf[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=uf[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=uf[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(Ni.DashCase|Ni.Important)?e.style.setProperty(t,n,r&Ni.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Ni.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,ff(n)):this.eventManager.addEventListener(e,t,ff(n))}}class mf extends gf{constructor(e,t,n,r){super(e),this.component=n;const i=df(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(hf,r+"-"+n.id),this.hostAttr=function(e){return"_nghost-%COMP%".replace(hf,e)}(r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class yf extends gf{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=df(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let vf=(()=>{class e extends of{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const _f=["alt","control","meta","shift"],Cf={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ef={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},wf={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let bf=(()=>{class e extends of{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xh().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(_f.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Ef.hasOwnProperty(t)&&(t=Ef[t]))}return Cf[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),_f.forEach(r=>{r!=n&&wf[r](e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Sf=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return Or(Pf)},token:e,providedIn:"root"}),e})(),Pf=(()=>{class e extends Sf{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case yi.NONE:return t;case yi.HTML:return qr(t,"HTML")?Gr(t):gi(this._doc,String(t)).toString();case yi.STYLE:return qr(t,"Style")?Gr(t):t;case yi.SCRIPT:if(qr(t,"Script"))return Gr(t);throw new Error("unsafe value used in a script context");case yi.URL:return Wr(t),qr(t,"URL")?Gr(t):Qr(String(t));case yi.RESOURCE_URL:if(qr(t,"ResourceURL"))return Gr(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(e){return new Ur(e)}(e)}bypassSecurityTrustStyle(e){return function(e){return new Vr(e)}(e)}bypassSecurityTrustScript(e){return function(e){return new $r(e)}(e)}bypassSecurityTrustUrl(e){return function(e){return new zr(e)}(e)}bypassSecurityTrustResourceUrl(e){return function(e){return new Hr(e)}(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh))},e.\u0275prov=be({factory:function(){return function(e){return new Pf(e.get(Rh))}(Or(Oo))},token:e,providedIn:"root"}),e})();const Of=vh(kh,"browser",[{provide:$u,useValue:"browser"},{provide:Vu,useValue:function(){Kd.makeCurrent(),tf.init()},multi:!0},{provide:Rh,useFactory:function(){return e=document,Pt=e,document;var e},deps:[]}]),Tf=[[],{provide:Io,useValue:"root"},{provide:Oi,useFactory:function(){return new Oi},deps:[]},{provide:rf,useClass:vf,multi:!0,deps:[Rh,nh,$u]},{provide:rf,useClass:bf,multi:!0,deps:[Rh]},[],{provide:pf,useClass:pf,deps:[sf,cf,Fu]},{provide:ll,useExisting:pf},{provide:af,useExisting:cf},{provide:cf,useClass:cf,deps:[Rh]},{provide:lh,useClass:lh,deps:[nh]},{provide:sf,useClass:sf,deps:[rf,nh]},{provide:Yd,useClass:nf,deps:[]},[]];let If=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:Fu,useValue:t.appId},{provide:Xd,useExisting:Fu},ef]}}}return e.\u0275fac=function(t){return new(t||e)(Or(e,12))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:Tf,imports:[qd,Nh]}),e})();"undefined"!=typeof window&&window;const{isArray:kf}=Array,{getPrototypeOf:Af,prototype:Nf,keys:Mf}=Object;function xf(e){if(1===e.length){const t=e[0];if(kf(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&Af(e)===Nf}(t)){const e=Mf(t);return{args:e.map(e=>t[e]),keys:e}}}return{args:e,keys:null}}const{isArray:Rf}=Array;function Df(e){return D(t=>function(e,t){return Rf(t)?e(...t):e(t)}(e,t))}function Lf(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}let Ff=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(ca(ul),ca(al))},e.\u0275dir=st({type:e}),e})(),Bf=(()=>{class e extends Ff{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Ho]}),e})();const Uf=new or("NgValueAccessor"),Vf={provide:Uf,useExisting:ge(()=>zf),multi:!0},$f=new or("CompositionEventMode");let zf=(()=>{class e extends Ff{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=xh()?xh().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(ca(ul),ca(al),ca($f,8))},e.\u0275dir=st({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&_a("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[Xc([Vf]),Ho]}),e})();function Hf(e){return null==e||0===e.length}function Gf(e){return null!=e&&"number"==typeof e.length}const qf=new or("NgValidators"),Wf=new or("NgAsyncValidators"),jf=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Zf{static min(e){return function(e){return t=>{if(Hf(t.value)||Hf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(e)}static max(e){return function(e){return t=>{if(Hf(t.value)||Hf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(e)}static required(e){return Yf(e)}static requiredTrue(e){return function(e){return!0===e.value?null:{required:!0}}(e)}static email(e){return function(e){return Hf(e.value)||jf.test(e.value)?null:{email:!0}}(e)}static minLength(e){return function(e){return t=>Hf(t.value)||!Gf(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(e)}static maxLength(e){return Kf(e)}static pattern(e){return function(e){if(!e)return Jf;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(Hf(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return rp(e)}static composeAsync(e){return sp(e)}}function Yf(e){return Hf(e.value)?{required:!0}:null}function Kf(e){return t=>Gf(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function Jf(e){return null}function Qf(e){return null!=e}function Xf(e){const t=ya(e)?ae(e):e;return va(t),t}function ep(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function tp(e,t){return t.map(t=>t(e))}function np(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function rp(e){if(!e)return null;const t=e.filter(Qf);return 0==t.length?null:function(e){return ep(tp(e,t))}}function ip(e){return null!=e?rp(np(e)):null}function sp(e){if(!e)return null;const t=e.filter(Qf);return 0==t.length?null:function(e){return function(...e){const t=ne(e),{args:n,keys:r}=xf(e),i=new T(e=>{const{length:t}=n;if(!t)return void e.complete();const i=new Array(t);let s=t,o=t;for(let a=0;a<t;a++){let t=!1;Y(n[a]).subscribe(new R(e,e=>{t||(t=!0,o--),i[a]=e},()=>s--,void 0,()=>{(!s||!t)&&(o||e.next(r?Lf(r,i):i),e.complete())}))}});return t?i.pipe(Df(t)):i}(tp(e,t).map(Xf)).pipe(D(ep))}}function op(e){return null!=e?sp(np(e)):null}function ap(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function cp(e){return e._rawValidators}function lp(e){return e._rawAsyncValidators}function up(e){return e?Array.isArray(e)?e:[e]:[]}function hp(e,t){return Array.isArray(e)?e.includes(t):e===t}function dp(e,t){const n=up(t);return up(e).forEach(e=>{hp(n,e)||n.push(e)}),n}function fp(e,t){return up(t).filter(t=>!hp(e,t))}let pp=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=ip(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=op(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e}),e})(),gp=(()=>{class e extends pp{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Ho]}),e})();class mp extends pp{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class yp{constructor(e){this._cd=e}is(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}let vp=(()=>{class e extends yp{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ca(mp,2))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Aa("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[Ho]}),e})(),_p=(()=>{class e extends yp{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ca(gp,10))},e.\u0275dir=st({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&Aa("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[Ho]}),e})();function Cp(e,t){return[...t.path,e]}function Ep(e,t){Sp(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Op(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Op(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function wp(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),Pp(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function bp(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Sp(e,t){const n=cp(e);null!==t.validator?e.setValidators(ap(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=lp(e);null!==t.asyncValidator?e.setAsyncValidators(ap(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();bp(t._rawValidators,i),bp(t._rawAsyncValidators,i)}function Pp(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=cp(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=lp(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return bp(t._rawValidators,r),bp(t._rawAsyncValidators,r),n}function Op(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Tp(e,t){Sp(e,t)}function Ip(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function kp(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function Ap(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===zf?n=e:function(e){return Object.getPrototypeOf(e.constructor)===Bf}(e)?r=e:i=e}),i||r||n||null}function Np(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Mp="VALID",xp="INVALID",Rp="PENDING",Dp="DISABLED";function Lp(e){return(Vp(e)?e.validators:e)||null}function Fp(e){return Array.isArray(e)?ip(e):e||null}function Bp(e,t){return(Vp(t)?t.asyncValidators:e)||null}function Up(e){return Array.isArray(e)?op(e):e||null}function Vp(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class $p{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Fp(this._rawValidators),this._composedAsyncValidatorFn=Up(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Mp}get invalid(){return this.status===xp}get pending(){return this.status==Rp}get disabled(){return this.status===Dp}get enabled(){return this.status!==Dp}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Fp(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=Up(e)}addValidators(e){this.setValidators(dp(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(dp(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(fp(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(fp(e,this._rawAsyncValidators))}hasValidator(e){return hp(this._rawValidators,e)}hasAsyncValidator(e){return hp(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Rp,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Dp,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Mp,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Mp||this.status===Rp)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Dp:Mp}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Rp,this._hasOwnPendingAsyncValidator=!0;const t=Xf(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;let r=e;return t.forEach(e=>{r=r instanceof Hp?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof Gp&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new vu,this.statusChanges=new vu}_calculateStatus(){return this._allControlsDisabled()?Dp:this.errors?xp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Rp)?Rp:this._anyControlsHaveStatus(xp)?xp:Mp}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Vp(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class zp extends $p{constructor(e=null,t,n){super(Lp(t),Bp(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Np(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Np(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Hp extends $p{constructor(e,t,n){super(Lp(t),Bp(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof zp?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class Gp extends $p{constructor(e,t,n){super(Lp(t),Bp(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof zp?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const qp={provide:gp,useExisting:ge(()=>jp)},Wp=(()=>Promise.resolve(null))();let jp=(()=>{class e extends gp{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new vu,this.form=new Hp({},ip(e),op(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Wp.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Ep(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Wp.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),Np(this._directives,e)})}addFormGroup(e){Wp.then(()=>{const t=this._findContainer(e.path),n=new Hp({});Tp(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Wp.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){Wp.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,kp(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(ca(qf,10),ca(Wf,10))},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&_a("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Xc([qp]),Ho]}),e})();const Zp={provide:mp,useExisting:ge(()=>Kp)},Yp=(()=>Promise.resolve(null))();let Kp=(()=>{class e extends mp{constructor(e,t,n,r){super(),this.control=new zp,this._registered=!1,this.update=new vu,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Ap(0,r)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),Ip(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?Cp(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ep(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){Yp.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,n=""===t||t&&"false"!==t;Yp.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(ca(gp,9),ca(qf,10),ca(Wf,10),ca(Uf,10))},e.\u0275dir=st({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Xc([Zp]),Ho,vt]}),e})(),Jp=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),Qp=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();const Xp={provide:Uf,useExisting:ge(()=>eg),multi:!0};let eg=(()=>{class e extends Bf{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=t=>{e(""==t?null:parseFloat(t))}}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&_a("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[Xc([Xp]),Ho]}),e})();const tg=new or("NgModelWithFormControlWarning"),ng={provide:gp,useExisting:ge(()=>rg)};let rg=(()=>{class e extends gp{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new vu,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Pp(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Ep(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){wp(e.control||null,e,!1),Np(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,kp(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(wp(t||null,e),n instanceof zp&&(Ep(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);Tp(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return Pp(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Sp(this.form,this),this._oldForm&&Pp(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(ca(qf,10),ca(Wf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&_a("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Xc([ng]),Ho,vt]}),e})();const ig={provide:mp,useExisting:ge(()=>sg)};let sg=(()=>{class e extends mp{constructor(e,t,n,r,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new vu,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Ap(0,r)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),Ip(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Cp(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(ca(gp,13),ca(qf,10),ca(Wf,10),ca(Uf,10),ca(tg,8))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Xc([ig]),Ho,vt]}),e._ngModelWarningSentOnce=!1,e})();const og={provide:Uf,useExisting:ge(()=>cg),multi:!0};function ag(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let cg=(()=>{class e extends Bf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const n=ag(t,e);this.setProperty("value",n)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&_a("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Xc([og]),Ho]}),e})(),lg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(ag(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ca(al),ca(ul),ca(cg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const ug={provide:Uf,useExisting:ge(()=>dg),multi:!0};function hg(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let dg=(()=>{class e extends Bf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const n=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(n.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const n=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const r=e.item(t),i=this._getOptionValue(r.value);n.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const r=e.item(t);if(r.selected){const e=this._getOptionValue(r.value);n.push(e)}}}this.value=n,e(n)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&_a("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Xc([ug]),Ho]}),e})(),fg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(hg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(hg(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ca(al),ca(ul),ca(dg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const pg={provide:qf,useExisting:ge(()=>gg),multi:!0};let gg=(()=>{class e{constructor(){this._required=!1}get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!=`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?Yf(e):null}registerOnValidatorChange(e){this._onChange=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&na("required",t.required?"":null)},inputs:{required:"required"},features:[Xc([pg])]}),e})();const mg={provide:qf,useExisting:ge(()=>yg),multi:!0};let yg=(()=>{class e{constructor(){this._validator=Jf}ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this.enabled()?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=this.enabled()?Kf(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):Jf}enabled(){return null!=this.maxlength}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&na("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Xc([mg]),vt]}),e})(),vg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[[Qp]]}),e})(),_g=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[vg]}),e})(),Cg=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:tg,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[vg]}),e})(),Eg=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,s=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,s=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,s=null!=t.asyncValidator?t.asyncValidator:null)),new Hp(n,{asyncValidators:s,updateOn:r,validators:i})}control(e,t,n){return new zp(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new Gp(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof zp||e instanceof Hp||e instanceof Gp?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return new e},token:e,providedIn:Cg}),e})();function wg(...e){return ae(e,re(e))}function bg(e,t){return r(t)?Q(e,t,1):Q(e,1)}function Sg(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>e.call(t,n,i++)&&r.next(n)))})}class Pg{}class Og{}class Tg{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Tg?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Tg;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Tg?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Ig{encodeKey(e){return Ng(e)}encodeValue(e){return Ng(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const kg=/%(\d[a-f0-9])/gi,Ag={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Ng(e){return encodeURIComponent(e).replace(kg,(e,t)=>{var n;return null!==(n=Ag[t])&&void 0!==n?n:e})}function Mg(e){return`${e}`}class xg{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Ig,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new xg({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Mg(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(Mg(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Rg{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Dg(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Lg(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Fg(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Bg{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Tg),this.context||(this.context=new Rg),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new xg,this.urlWithParams=t}serializeBody(){return null===this.body?null:Dg(this.body)||Lg(this.body)||Fg(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof xg?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Fg(this.body)?null:Lg(this.body)?this.body.type||null:Dg(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof xg?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let c=e.headers||this.headers,l=e.params||this.params;const u=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(c=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),c)),e.setParams&&(l=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),l)),new Bg(n,r,s,{params:l,headers:c,context:u,reportProgress:a,responseType:i,withCredentials:o})}}var Ug=(()=>((Ug=Ug||{})[Ug.Sent=0]="Sent",Ug[Ug.UploadProgress=1]="UploadProgress",Ug[Ug.ResponseHeader=2]="ResponseHeader",Ug[Ug.DownloadProgress=3]="DownloadProgress",Ug[Ug.Response=4]="Response",Ug[Ug.User=5]="User",Ug))();class Vg{constructor(e,t=200,n="OK"){this.headers=e.headers||new Tg,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class $g extends Vg{constructor(e={}){super(e),this.type=Ug.ResponseHeader}clone(e={}){return new $g({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class zg extends Vg{constructor(e={}){super(e),this.type=Ug.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new zg({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Hg extends Vg{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Gg(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let qg=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof Bg)r=e;else{let i,s;i=n.headers instanceof Tg?n.headers:new Tg(n.headers),n.params&&(s=n.params instanceof xg?n.params:new xg({fromObject:n.params})),r=new Bg(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=wg(r).pipe(bg(e=>this.handler.handle(e)));if(e instanceof Bg||"events"===n.observe)return i;const s=i.pipe(Sg(e=>e instanceof zg));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(D(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(D(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new xg).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,Gg(n,t))}post(e,t,n={}){return this.request("POST",e,Gg(n,t))}put(e,t,n={}){return this.request("PUT",e,Gg(n,t))}}return e.\u0275fac=function(t){return new(t||e)(Or(Pg))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class Wg{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const jg=new or("HTTP_INTERCEPTORS");let Zg=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Yg=/^\)\]\}',?\n/;let Kg=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new T(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new Tg(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new $g({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),c=null;204!==i&&(c=void 0===n.response?n.responseText:n.response),0===i&&(i=c?200:0);let l=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof c){const e=c;c=c.replace(Yg,"");try{c=""!==c?JSON.parse(c):null}catch(u){c=e,l&&(l=!1,c={error:u,text:c})}}l?(t.next(new zg({body:c,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new Hg({error:c,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new Hg({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let c=!1;const l=r=>{c||(t.next(s()),c=!0);let i={type:Ug.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&!!n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:Ug.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",l),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:Ug.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",o),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",l),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Or(Yd))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Jg=new or("XSRF_COOKIE_NAME"),Qg=new or("XSRF_HEADER_NAME");class Xg{}let em=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ld(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh),Or($u),Or(Jg))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),tm=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Xg),Or(Qg))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),nm=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(jg,[]);this.chain=e.reduceRight((e,t)=>new Wg(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Og),Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),rm=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:tm,useClass:Zg}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:Jg,useValue:t.cookieName}:[],t.headerName?{provide:Qg,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[tm,{provide:jg,useExisting:tm,multi:!0},{provide:Xg,useClass:em},{provide:Jg,useValue:"XSRF-TOKEN"},{provide:Qg,useValue:"X-XSRF-TOKEN"}]}),e})(),im=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[qg,{provide:Pg,useClass:nm},Kg,{provide:Og,useExisting:Kg}],imports:[[rm.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class sm extends A{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function om(e,t,n){e?J(n,e,t):t()}const am=i(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function cm(...e){return X(1)(ae(e,re(e)))}function lm(e){return new T(t=>{Y(e()).subscribe(t)})}function um(){return x((e,t)=>{let n=null;e._refCount++;const r=new R(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class hm extends T{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,M(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new a;const t=this.getSubject();e.add(this.source.subscribe(new R(t,void 0,()=>{this._teardown(),t.complete()},e=>{this._teardown(),t.error(e)},()=>this._teardown()))),e.closed&&(this._connection=null,e=a.EMPTY)}return e}refCount(){return um()(this)}}function dm(e,t){return x((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(new R(r,n=>{null==i||i.unsubscribe();let o=0;const c=s++;Y(e(n,c)).subscribe(i=new R(r,e=>r.next(t?t(n,e,c,o++):e),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function fm(e,t,n,r,i){return(s,o)=>{let a=n,c=t,l=0;s.subscribe(new R(o,t=>{const n=l++;c=a?e(c,t,n):(a=!0,t),r&&o.next(c)},i&&(()=>{a&&o.next(c),o.complete()})))}}function pm(e,t){return x(fm(e,t,arguments.length>=2,!0))}function gm(e){return x((t,n)=>{let r,i=null,s=!1;i=t.subscribe(new R(n,void 0,void 0,o=>{r=Y(e(o,gm(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}function mm(e){return e<=0?()=>ee:x((t,n)=>{let r=[];t.subscribe(new R(n,t=>{r.push(t),e<r.length&&r.shift()},()=>{for(const e of r)n.next(e);n.complete()},void 0,()=>{r=null}))})}function ym(e=vm){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>r?n.complete():n.error(e())))})}function vm(){return new am}function _m(e){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>{r||n.next(e),n.complete()}))})}function Cm(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Sg((t,n)=>e(t,n,r)):O,ce(1),n?_m(t):ym(()=>new am))}function Em(e,t,n){const i=r(e)||t||n?{next:e,error:t,complete:n}:e;return i?x((e,t)=>{var n;null===(n=i.subscribe)||void 0===n||n.call(i);let r=!0;e.subscribe(new R(t,e=>{var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},()=>{var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},e=>{var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},()=>{var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):O}class wm{constructor(e,t){this.id=e,this.url=t}}class bm extends wm{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Sm extends wm{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Pm extends wm{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Om extends wm{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Tm extends wm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Im extends wm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class km extends wm{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Am extends wm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Nm extends wm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mm{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class xm{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Rm{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Dm{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Lm{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fm{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bm{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Um="primary";class Vm{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function $m(e){return new Vm(e)}const zm="ngNavigationCancelingError";function Hm(e){const t=Error("NavigationCancelingError: "+e);return t[zm]=!0,t}function Gm(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function qm(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!Wm(e[i],t[i]))return!1;return!0}function Wm(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function jm(e){return Array.prototype.concat.apply([],e)}function Zm(e){return e.length>0?e[e.length-1]:null}function Ym(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Km(e){return va(e)?e:ya(e)?ae(Promise.resolve(e)):wg(e)}const Jm={exact:function e(t,n,r){if(!oy(t.segments,n.segments)||!ny(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:ey},Qm={exact:function(e,t){return qm(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Wm(e[n],t[n]))},ignored:()=>!0};function Xm(e,t,n){return Jm[n.paths](e.root,t.root,n.matrixParams)&&Qm[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ey(e,t,n){return ty(e,t,t.segments,n)}function ty(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!oy(i,n)||t.hasChildren()||!ny(i,n,r))}if(e.segments.length===n.length){if(!oy(e.segments,n)||!ny(e.segments,n,r))return!1;for(const n in t.children)if(!e.children[n]||!ey(e.children[n],t.children[n],r))return!1;return!0}{const i=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(oy(e.segments,i)&&ny(e.segments,i,r)&&e.children[Um])&&ty(e.children[Um],t,s,r)}}function ny(e,t,n){return t.every((t,r)=>Qm[n](e[r].parameters,t.parameters))}class ry{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$m(this.queryParams)),this._queryParamMap}toString(){return ly.serialize(this)}}class iy{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Ym(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return uy(this)}}class sy{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=$m(this.parameters)),this._parameterMap}toString(){return yy(this)}}function oy(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class ay{}class cy{parse(e){const t=new wy(e);return new ry(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`${`/${hy(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${fy(t)}=${fy(e)}`).join("&"):`${fy(t)}=${fy(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const ly=new cy;function uy(e){return e.segments.map(e=>yy(e)).join("/")}function hy(e,t){if(!e.hasChildren())return uy(e);if(t){const t=e.children[Um]?hy(e.children[Um],!1):"",n=[];return Ym(e.children,(e,t)=>{t!==Um&&n.push(`${t}:${hy(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return Ym(e.children,(e,r)=>{r===Um&&(n=n.concat(t(e,r)))}),Ym(e.children,(e,r)=>{r!==Um&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===Um?[hy(e.children[Um],!1)]:[`${n}:${hy(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Um]?`${uy(e)}/${t[0]}`:`${uy(e)}/(${t.join("//")})`}}function dy(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function fy(e){return dy(e).replace(/%3B/gi,";")}function py(e){return dy(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function gy(e){return decodeURIComponent(e)}function my(e){return gy(e.replace(/\+/g,"%20"))}function yy(e){return`${py(e.path)}${function(e){return Object.keys(e).map(t=>`;${py(t)}=${py(e[t])}`).join("")}(e.parameters)}`}const vy=/^[^\/()?;=#]+/;function _y(e){const t=e.match(vy);return t?t[0]:""}const Cy=/^[^=?&#]+/,Ey=/^[^?&#]+/;class wy{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new iy([],{}):new iy([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[Um]=new iy(e,t)),n}parseSegment(){const e=_y(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new sy(gy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=_y(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=_y(this.remaining);e&&(n=e,this.capture(n))}e[gy(t)]=gy(n)}parseQueryParam(e){const t=function(e){const t=e.match(Cy);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Ey);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=my(t),i=my(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=_y(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=Um);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s[Um]:new iy([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class by{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Sy(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Sy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Py(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return Py(e,this._root).map(e=>e.value)}}function Sy(e,t){if(e===t.value)return t;for(const n of t.children){const t=Sy(e,n);if(t)return t}return null}function Py(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Py(e,n);if(r.length)return r.unshift(t),r}return[]}class Oy{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Ty(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class Iy extends by{constructor(e,t){super(e),this.snapshot=t,Ry(this,e)}toString(){return this.snapshot.toString()}}function ky(e,t){const n=function(e,t){const n=new My([],{},{},"",{},Um,t,null,e.root,-1,{});return new xy("",new Oy(n,[]))}(e,t),r=new sm([new sy("",{})]),i=new sm({}),s=new sm({}),o=new sm({}),a=new sm(""),c=new Ay(r,i,o,a,s,Um,t,n.root);return c.snapshot=n.root,new Iy(new Oy(c,[]),n)}class Ay{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(D(e=>$m(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(D(e=>$m(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ny(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class My{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=c,this._lastPathIndex=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$m(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$m(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class xy extends by{constructor(e,t){super(t),this.url=e,Ry(this,t)}toString(){return Dy(this._root)}}function Ry(e,t){t.value._routerState=e,t.children.forEach(t=>Ry(e,t))}function Dy(e){const t=e.children.length>0?` { ${e.children.map(Dy).join(", ")} } `:"";return`${e.value}${t}`}function Ly(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,qm(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),qm(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!qm(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),qm(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Fy(e,t){return qm(e.params,t.params)&&function(e,t){return oy(e,t)&&e.every((e,n)=>qm(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Fy(e.parent,t.parent))}function By(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return By(e,t,r);return By(e,t)})}(e,t,n);return new Oy(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return Uy(t,e),e}}const n=function(e){return new Ay(new sm(e.url),new sm(e.params),new sm(e.queryParams),new sm(e.fragment),new sm(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(t=>By(e,t));return new Oy(n,r)}}function Uy(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)Uy(e.children[n],t.children[n])}function Vy(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function $y(e){return"object"==typeof e&&null!=e&&e.outlets}function zy(e,t,n,r,i){let s={};return r&&Ym(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new ry(n.root===e?t:Hy(n.root,e,t),s,i)}function Hy(e,t,n){const r={};return Ym(e.children,(e,i)=>{r[i]=e===t?n:Hy(e,t,n)}),new iy(e.segments,r)}class Gy{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Vy(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find($y);if(r&&r!==Zm(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class qy{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Wy(e,t,n){if(e||(e=new iy([],{})),0===e.segments.length&&e.hasChildren())return jy(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if($y(o))break;const a=`${o}`,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&c&&"object"==typeof c&&void 0===c.outlets){if(!Jy(a,c,t))return s;r+=2}else{if(!Jy(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new iy(e.segments.slice(0,r.pathIndex),{});return t.children[Um]=new iy(e.segments.slice(r.pathIndex),e.children),jy(t,0,i)}return r.match&&0===i.length?new iy(e.segments,{}):r.match&&!e.hasChildren()?Zy(e,t,n):r.match?jy(e,0,i):Zy(e,t,n)}function jy(e,t,n){if(0===n.length)return new iy(e.segments,{});{const r=function(e){return $y(e[0])?e[0].outlets:{[Um]:e}}(n),i={};return Ym(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=Wy(e.children[r],t,n))}),Ym(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new iy(e.segments,i)}}function Zy(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if($y(s)){const e=Yy(s.outlets);return new iy(r,e)}if(0===i&&Vy(n[0])){r.push(new sy(e.segments[t].path,Ky(n[0]))),i++;continue}const o=$y(s)?s.outlets[Um]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&Vy(a)?(r.push(new sy(o,Ky(a))),i+=2):(r.push(new sy(o,{})),i++)}return new iy(r,{})}function Yy(e){const t={};return Ym(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=Zy(new iy([],{}),0,e))}),t}function Ky(e){const t={};return Ym(e,(e,n)=>t[n]=`${e}`),t}function Jy(e,t,n){return e==n.path&&qm(t,n.parameters)}class Qy{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Ly(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=Ty(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Ym(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=Ty(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=Ty(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Fm(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Dm(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Ly(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),Xy(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function Xy(e){Ly(e.value),e.children.forEach(Xy)}class ev{constructor(e,t){this.routes=e,this.module=t}}function tv(e){return"function"==typeof e}function nv(e){return e instanceof ry}const rv=Symbol("INITIAL_VALUE");function iv(){return dm(e=>function(...e){const t=re(e),n=ne(e),{args:r,keys:i}=xf(e);if(0===r.length)return ae([],t);const s=new T(function(e,t,n=O){return r=>{om(t,()=>{const{length:i}=e,s=new Array(i);let o=i,a=i;for(let c=0;c<i;c++)om(t,()=>{const i=ae(e[c],t);let l=!1;i.subscribe(new R(r,e=>{s[c]=e,l||(l=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,t,i?e=>Lf(i,e):O));return n?s.pipe(Df(n)):s}(e.map(e=>e.pipe(ce(1),function(...e){const t=re(e);return x((n,r)=>{(t?cm(e,n,t):cm(e,n)).subscribe(r)})}(rv)))).pipe(pm((e,t)=>{let n=!1;return t.reduce((e,r,i)=>e!==rv?e:(r===rv&&(n=!0),n||!1!==r&&i!==t.length-1&&!nv(r)?e:r),e)},rv),Sg(e=>e!==rv),D(e=>nv(e)?e:!0===e),ce(1)))}let sv=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&fa(0,"router-outlet")},directives:function(){return[r_]},encapsulation:2}),e})();function ov(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];av(r,cv(t,r))}}function av(e,t){e.children&&ov(e.children,t)}function cv(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function lv(e){const t=e.children&&e.children.map(lv),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Um&&(n.component=sv),n}function uv(e){return e.outlet||Um}function hv(e,t){const n=e.filter(e=>uv(e)===t);return n.push(...e.filter(e=>uv(e)!==t)),n}const dv={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function fv(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},dv):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||Gm)(n,e,t);if(!i)return Object.assign({},dv);const s={};Ym(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function pv(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>gv(e,t,n)&&uv(n)!==Um)}(e,n,r)){const i=new iy(t,function(e,t,n,r){const i={};i[Um]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&uv(s)!==Um){const n=new iy([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[uv(s)]=n}return i}(e,t,r,new iy(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>gv(e,t,n))}(e,n,r)){const s=new iy(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(gv(e,n,a)&&!i[uv(a)]){const n=new iy([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[uv(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new iy(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function gv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function mv(e,t,n,r){return!!(uv(e)===r||r!==Um&&gv(t,n,e))&&("**"===e.path||fv(t,e,n).matched)}function yv(e,t,n){return 0===t.length&&!e.children[n]}class vv{constructor(e){this.segmentGroup=e||null}}class _v{constructor(e){this.urlTree=e}}function Cv(e){return new T(t=>t.error(new vv(e)))}function Ev(e){return new T(t=>t.error(new _v(e)))}function wv(e){return new T(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class bv{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(zl)}apply(){const e=pv(this.urlTree.root,[],[],this.config).segmentGroup,t=new iy(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,Um).pipe(D(e=>this.createUrlTree(Sv(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(gm(e=>{if(e instanceof _v)return this.allowRedirects=!1,this.match(e.urlTree);throw e instanceof vv?this.noMatchError(e):e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Um).pipe(D(t=>this.createUrlTree(Sv(t),e.queryParams,e.fragment))).pipe(gm(e=>{throw e instanceof vv?this.noMatchError(e):e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new iy([],{[Um]:e}):e;return new ry(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(D(e=>new iy([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return ae(r).pipe(bg(r=>{const i=n.children[r],s=hv(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(D(e=>({segment:e,outlet:r})))}),pm((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Sg((t,n)=>e(t,n,r)):O,mm(1),n?_m(t):ym(()=>new am))}())}expandSegment(e,t,n,r,i,s){return ae(n).pipe(bg(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(gm(e=>{if(e instanceof vv)return wg(null);throw e}))),Cm(e=>!!e),gm((e,n)=>{if(e instanceof am||"EmptyError"===e.name){if(yv(t,r,i))return wg(new iy([],{}));throw new vv(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return mv(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):Cv(t):Cv(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Ev(i):this.lineralizeSegments(n,i).pipe(Q(n=>{const i=new iy(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:c,positionalParamSegments:l}=fv(t,r,i);if(!o)return Cv(t);const u=this.applyRedirectCommands(a,r.redirectTo,l);return r.redirectTo.startsWith("/")?Ev(u):this.lineralizeSegments(r,u).pipe(Q(r=>this.expandSegment(e,t,n,r.concat(i.slice(c)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?wg(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(D(e=>(n._loadedConfig=e,new iy(r,{})))):wg(new iy(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=fv(t,n,r);if(!s)return Cv(t);const c=r.slice(a);return this.getChildConfig(e,n,r).pipe(Q(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:l}=pv(t,o,c,s),u=new iy(a.segments,a.children);if(0===l.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(D(e=>new iy(o,e)));if(0===s.length&&0===l.length)return wg(new iy(o,{}));const h=uv(n)===i;return this.expandSegment(r,u,s,l,h?Um:i,!0).pipe(D(e=>new iy(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?wg(new ev(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?wg(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Q(n=>{return n?this.configLoader.load(e.injector,t).pipe(D(e=>(t._loadedConfig=e,e))):(r=t,new T(e=>e.error(Hm(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))));var r})):wg(new ev([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?wg(r.map(r=>{const i=e.get(r);let s;if((o=i)&&tv(o.canLoad))s=i.canLoad(t,n);else{if(!tv(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}var o;return Km(s)})).pipe(iv(),Em(e=>{if(!nv(e))return;const t=Hm(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),D(e=>!0===e)):wg(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return wg(n);if(r.numberOfChildren>1||!r.children[Um])return wv(e.redirectTo);r=r.children[Um]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new ry(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Ym(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return Ym(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new iy(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Sv(e){const t={};for(const n of Object.keys(e.children)){const r=Sv(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children[Um]){const t=e.children[Um];return new iy(e.segments.concat(t.segments),t.children)}return e}(new iy(e.segments,t))}class Pv{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Ov{constructor(e,t){this.component=e,this.route=t}}function Tv(e,t,n){const r=e._root;return kv(r,t?t._root:null,n,[r.value])}function Iv(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function kv(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ty(t);return e.children.forEach(e=>{(function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!oy(e.url,t.url);case"pathParamsOrQueryParamsChange":return!oy(e.url,t.url)||!qm(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Fy(e,t)||!qm(e.queryParams,t.queryParams);case"paramsChange":default:return!Fy(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Pv(r)):(s.data=o.data,s._resolvedData=o._resolvedData),kv(e,t,s.component?a?a.children:null:n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Ov(a.outlet.component,o))}else o&&Av(t,a,i),i.canActivateChecks.push(new Pv(r)),kv(e,null,s.component?a?a.children:null:n,r,i)})(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),Ym(s,(e,t)=>Av(e,n.getContext(t),i)),i}function Av(e,t,n){const r=Ty(e),i=e.value;Ym(r,(e,r)=>{Av(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new Ov(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class Nv{}function Mv(e){return new T(t=>t.error(e))}class xv{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=pv(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Um);if(null===t)return null;const n=new My([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Um,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Oy(n,t),i=new xy(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=Ny(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=hv(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=Dv(n);return r.sort((e,t)=>e.value.outlet===Um?-1:t.value.outlet===Um?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return yv(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!mv(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?Zm(n).parameters:{};i=new My(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Bv(e),uv(e),e.component,e,Lv(t),Fv(t)+n.length,Uv(e))}else{const r=fv(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new My(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Bv(e),uv(e),e.component,e,Lv(t),Fv(t)+s.length,Uv(e))}const a=(u=e).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:c,slicedSegments:l}=pv(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);var u;if(0===l.length&&c.hasChildren()){const e=this.processChildren(a,c);return null===e?null:[new Oy(i,e)]}if(0===a.length&&0===l.length)return[new Oy(i,[])];const h=uv(e)===r,d=this.processSegment(a,c,l,h?Um:r);return null===d?null:[new Oy(i,d)]}}function Rv(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function Dv(e){const t=[],n=new Set;for(const r of e){if(!Rv(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=Dv(r.children);t.push(new Oy(r.value,e))}return t.filter(e=>!n.has(e))}function Lv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Fv(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Bv(e){return e.data||{}}function Uv(e){return e.resolve||{}}function Vv(e){return dm(t=>{const n=e(t);return n?ae(n).pipe(D(()=>t)):wg(t)})}class $v extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const zv=new or("ROUTES");class Hv{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe(D(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new ev(jm(r.injector.get(zv,void 0,Me.Self|Me.Optional)).map(lv),r)}),gm(e=>{throw t._loader$=void 0,e}));return t._loader$=new hm(n,()=>new A).pipe(um()),t._loader$}loadModuleFactory(e){return"string"==typeof e?ae(this.loader.load(e)):Km(e()).pipe(Q(e=>e instanceof Hl?wg(e):ae(this.compiler.compileModuleAsync(e))))}}class Gv{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new qv,this.attachRef=null}}class qv{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Gv,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Wv{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function jv(e){throw e}function Zv(e,t,n){return t.parse("/")}function Yv(e,t){return wg(null)}const Kv={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Jv={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Qv=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=jv,this.malformedUriErrorHandler=Zv,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Yv,afterPreactivation:Yv},this.urlHandlingStrategy=new Wv,this.routeReuseStrategy=new $v,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(zl),this.console=i.get(Hu);const c=i.get(nh);this.isNgZoneEnabled=c instanceof nh&&nh.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new ry(new iy([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Hv(s,o,e=>this.triggerEvent(new Mm(e)),e=>this.triggerEvent(new xm(e))),this.routerState=ky(this.currentUrlTree,this.rootComponentType),this.transitions=new sm({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const t=this.events;return e.pipe(Sg(e=>0!==e.id),D(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),dm(e=>{let n=!1,r=!1;return wg(e).pipe(Em(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),dm(e=>{const n=this.browserUrlTree.toString(),i=!this.navigated||e.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||i)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return Xv(e.source)&&(this.browserUrlTree=e.extractedUrl),wg(e).pipe(dm(e=>{const n=this.transitions.getValue();return t.next(new bm(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?ee:Promise.resolve(e)}),function(e,t,n,r){return dm(i=>function(e,t,n,r,i){return new bv(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(D(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Em(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,i,s){return Q(o=>function(e,t,n,i,s="emptyOnly",o="legacy"){try{const r=new xv(e,t,n,i,s,o).recognize();return null===r?Mv(new Nv):wg(r)}catch(r){return Mv(r)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),i,s).pipe(D(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Em(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new Tm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(i&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new bm(n,this.serializeUrl(r),i,s);t.next(a);const c=ky(r,this.rootComponentType).snapshot;return wg(Object.assign(Object.assign({},e),{targetSnapshot:c,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ee}),Vv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Em(e=>{const t=new Im(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),D(e=>Object.assign(Object.assign({},e),{guards:Tv(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return Q(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?wg(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ae(e).pipe(Q(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?wg(s.map(s=>{const o=Iv(s,t,i);let a;if(function(e){return e&&tv(e.canDeactivate)}(o))a=Km(o.canDeactivate(e,t,n,r));else{if(!tv(o))throw new Error("Invalid CanDeactivate guard");a=Km(o(e,t,n,r))}return a.pipe(Cm())})).pipe(iv()):wg(!0)}(e.component,e.route,n,t,r)),Cm(e=>!0!==e,!0))}(o,r,i,e).pipe(Q(n=>n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ae(t).pipe(bg(t=>cm(function(e,t){return null!==e&&t&&t(new Rm(e)),wg(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Lm(e)),wg(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>lm(()=>wg(t.guards.map(i=>{const s=Iv(i,t.node,n);let o;if(function(e){return e&&tv(e.canActivateChild)}(s))o=Km(s.canActivateChild(r,e));else{if(!tv(s))throw new Error("Invalid CanActivateChild guard");o=Km(s(r,e))}return o.pipe(Cm())})).pipe(iv())));return wg(i).pipe(iv())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?wg(r.map(r=>lm(()=>{const i=Iv(r,t,n);let s;if(function(e){return e&&tv(e.canActivate)}(i))s=Km(i.canActivate(t,e));else{if(!tv(i))throw new Error("Invalid CanActivate guard");s=Km(i(t,e))}return s.pipe(Cm())}))).pipe(iv()):wg(!0)}(e,t.route,n))),Cm(e=>!0!==e,!0))}(r,s,e,t):wg(n)),D(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Em(e=>{if(nv(e.guardsResult)){const t=Hm(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new km(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Sg(e=>!!e.guardsResult||(this.restoreHistory(e),this.cancelNavigationTransition(e,""),!1)),Vv(e=>{if(e.guards.canActivateChecks.length)return wg(e).pipe(Em(e=>{const t=new Am(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),dm(e=>{let t=!1;return wg(e).pipe(function(e,t){return Q(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return wg(n);let s=0;return ae(i).pipe(bg(n=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return wg({});const s={};return ae(i).pipe(Q(i=>function(e,t,n,r){const i=Iv(e,t,r);return Km(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Em(e=>{s[i]=e}))),mm(1),Q(()=>Object.keys(s).length===i.length?wg(s):ee))}(e._resolve,e,t,r).pipe(D(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),Ny(e,n).resolve),null)))}(n.route,r,e,t)),Em(()=>s++),mm(1),Q(e=>s===i.length?wg(n):ee))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Em({next:()=>t=!0,complete:()=>{t||(this.restoreHistory(e),this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),Em(e=>{const t=new Nm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),Vv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),D(e=>{const t=function(e,t,n){const r=By(e,t._root,n?n._root:void 0);return new Iy(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Em(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),((e,t,n)=>D(r=>(new Qy(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,e=>this.triggerEvent(e)),Em({next(){n=!0},complete(){n=!0}}),function(e){return x((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var t;if(!n&&!r){const t=`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(e),this.cancelNavigationTransition(e,t)):this.cancelNavigationTransition(e,t)}(null===(t=this.currentNavigation)||void 0===t?void 0:t.id)===e.id&&(this.currentNavigation=null)}),gm(n=>{if(r=!0,function(e){return e&&e[zm]}(n)){const r=nv(n.url);r||(this.navigated=!0,this.restoreHistory(e,!0));const i=new Pm(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),r={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Xv(e.source)};this.scheduleNavigation(t,"imperative",null,r,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.restoreHistory(e,!0);const r=new Om(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(i){e.reject(i)}}return ee}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){ov(e),this.config=e.map(lv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,c=o?this.currentUrlTree.fragment:i;let l=null;switch(s){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,i){if(0===n.length)return zy(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Gy(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Ym(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new Gy(n,t,r)}(n);if(s.toRoot())return zy(t.root,new iy([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new qy(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new qy(e,e===t.root,0)}const r=Vy(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new qy(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?jy(o.segmentGroup,o.index,s.commands):Wy(o.segmentGroup,o.index,s.commands);return zy(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,l,c??null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=nv(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},Kv):!1===t?Object.assign({},Jv):t,nv(e))return Xm(this.currentUrlTree,e,n);const r=this.parseUrl(e);return Xm(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Sm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,t,n,r,i){var s,o;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),c=Xv(t)&&a&&!Xv(a.source),l=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(c&&l)return Promise.resolve(!0);let u,h,d;i?(u=i.resolve,h=i.reject,d=i.promise):d=new Promise((e,t)=>{u=e,h=t});const f=++this.navigationId;let p;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),p=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(s=this.browserPageId)&&void 0!==s?s:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):p=0,this.setTransition({id:f,targetPageId:p,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}restoreHistory(e,t=!1){var n,r;if("computed"===this.canceledNavigationResolution){const t=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===t?this.currentUrlTree===(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)&&0===t&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(t)}else"replace"===this.canceledNavigationResolution&&(t&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){const n=new Pm(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(Or(cr),Or(ay),Or(qv),Or(Yh),Or($o),Or(Sh),Or(Xu),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Xv(e){return"imperative"!==e}let e_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.commands=[],this.onChanges=new A,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}onClick(){const e={skipLocationChange:n_(this.skipLocationChange),replaceUrl:n_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:n_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(Ay),rr("tabindex"),ca(ul),ca(al))},e.\u0275dir=st({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&_a("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})(),t_=(()=>{class e{constructor(e,t,n){this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.onChanges=new A,this.subscription=e.events.subscribe(e=>{e instanceof Sm&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;const s={skipLocationChange:n_(this.skipLocationChange),replaceUrl:n_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,s),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:n_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(Ay),ca(Gh))},e.\u0275dir=st({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&_a("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(Va("href",t.href,_i),na("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})();function n_(e){return""===e||!!e}let r_=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new vu,this.deactivateEvents=new vu,this.name=r||Um,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new i_(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(ca(qv),ca(ql),ca(rl),rr("name"),ca(xl))},e.\u0275dir=st({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class i_{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===Ay?this.route:e===qv?this.childContexts:this.parent.get(e,t)}}class s_{}class o_{preload(e,t){return wg(null)}}let a_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new Hv(t,n,t=>e.triggerEvent(new Mm(t)),t=>e.triggerEvent(new xm(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Sg(e=>e instanceof Sm),bg(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(zl);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ae(n).pipe(X(),D(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?wg(t._loadedConfig):this.loader.load(e.injector,t)).pipe(Q(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Or(Qv),Or(Sh),Or(Xu),Or($o),Or(s_))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),c_=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof bm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Sm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Bm&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new Bm(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(Qv),Or(Wd),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const l_=new or("ROUTER_CONFIGURATION"),u_=new or("ROUTER_FORROOT_GUARD"),h_=[Yh,{provide:ay,useClass:cy},{provide:Qv,useFactory:function(e,t,n,r,i,s,o,a={},c,l){const u=new Qv(null,e,t,n,r,i,s,jm(o));return c&&(u.urlHandlingStrategy=c),l&&(u.routeReuseStrategy=l),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[ay,qv,Yh,$o,Sh,Xu,zv,l_,[class{},new Mr],[class{},new Mr]]},qv,{provide:Ay,useFactory:function(e){return e.routerState.root},deps:[Qv]},{provide:Sh,useClass:Th},a_,o_,class{preload(e,t){return t().pipe(gm(()=>wg(null)))}},{provide:l_,useValue:{enableTracing:!1}}];function d_(){return new yh("Router",Qv)}let f_=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[h_,y_(t),{provide:u_,useFactory:m_,deps:[[Qv,new Mr,new xr]]},{provide:l_,useValue:n||{}},{provide:Gh,useFactory:g_,deps:[Dh,[new Nr(Wh),new Mr],l_]},{provide:c_,useFactory:p_,deps:[Qv,Wd,l_]},{provide:s_,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:o_},{provide:yh,multi:!0,useFactory:d_},[v_,{provide:Du,multi:!0,useFactory:__,deps:[v_]},{provide:E_,useFactory:C_,deps:[v_]},{provide:zu,multi:!0,useExisting:E_}]]}}static forChild(t){return{ngModule:e,providers:[y_(t)]}}}return e.\u0275fac=function(t){return new(t||e)(Or(u_,8),Or(Qv,8))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function p_(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new c_(e,t,n)}function g_(e,t,n={}){return n.useHash?new Zh(e,t):new jh(e,t)}function m_(e){return"guarded"}function y_(e){return[{provide:ar,multi:!0,useValue:e},{provide:zv,multi:!0,useValue:e}]}let v_=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(Fh,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let e=null;const t=new Promise(t=>e=t),n=this.injector.get(Qv),r=this.injector.get(l_);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?wg(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(l_),n=this.injector.get(a_),r=this.injector.get(c_),i=this.injector.get(Qv),s=this.injector.get(wh);e===s.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(t){return new(t||e)(Or($o))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function __(e){return e.appInitializer.bind(e)}function C_(e){return e.bootstrapListener.bind(e)}const E_=new or("Router Initializer");class w_{}const b_="*";function S_(e,t=null){return{type:2,steps:e,options:t}}function P_(e){return{type:6,styles:e,offset:null}}function O_(e){Promise.resolve(null).then(e)}class T_{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){O_(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class I_{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?O_(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function k_(){return"undefined"!=typeof window&&void 0!==window.document}function A_(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function N_(e){switch(e.length){case 0:return new T_;case 1:return e[0];default:return new I_(e)}}function M_(e,t,n,r,i={},s={}){const o=[],a=[];let c=-1,l=null;if(r.forEach(e=>{const n=e.offset,r=n==c,u=r&&l||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),a){case"!":a=i[n];break;case b_:a=s[n];break;default:a=t.normalizeStyleValue(n,r,a,o)}u[r]=a}),r||a.push(u),l=u,c=n}),o.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${o.join(e)}`)}return a}function x_(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&R_(n,"start",e)));break;case"done":e.onDone(()=>r(n&&R_(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&R_(n,"destroy",e)))}}function R_(e,t,n){const r=D_(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),i=e._data;return null!=i&&(r._data=i),r}function D_(e,t,n,r,i="",s=0,o){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function L_(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function F_(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let B_=(e,t)=>!1,U_=(e,t)=>!1,V_=(e,t,n)=>[];const $_=A_();($_||"undefined"!=typeof Element)&&(B_=k_()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),U_=(()=>{if($_||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):U_}})(),V_=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let z_=null,H_=!1;function G_(e){z_||(z_=("undefined"!=typeof document?document.body:null)||{},H_=!!z_.style&&"WebkitAppearance"in z_.style);let t=!0;return z_.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in z_.style,!t&&H_&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in z_.style)),t}const q_=U_,W_=B_,j_=V_;function Z_(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let Y_=(()=>{class e{validateStyleProperty(e){return G_(e)}matchesElement(e,t){return q_(e,t)}containsElement(e,t){return W_(e,t)}query(e,t,n){return j_(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,s=[],o){return new T_(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),K_=(()=>{class e{}return e.NOOP=new Y_,e})();const J_="ng-enter",Q_="ng-leave",X_="ng-trigger",eC=".ng-trigger",tC="ng-animating",nC=".ng-animating";function rC(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:iC(parseFloat(t[1]),t[2])}function iC(e,t){switch(t){case"s":return 1e3*e;default:return e}}function sC(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,s="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=iC(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=iC(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=e;if(!n){let n=!1,s=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(s,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:s}}(e,t,n)}function oC(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function aC(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else oC(e,n);return n}function cC(e,t,n){return n?t+":"+n+";":""}function lC(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=cC(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=cC(0,_C(n),e.style[n]));e.setAttribute("style",t)}function uC(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=vC(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),A_()&&lC(e))}function hC(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=vC(t);e.style[n]=""}),A_()&&lC(e))}function dC(e){return Array.isArray(e)?1==e.length?e[0]:S_(e):e}const fC=new RegExp("{{\\s*(.+?)\\s*}}","g");function pC(e){let t=[];if("string"==typeof e){let n;for(;n=fC.exec(e);)t.push(n[1]);fC.lastIndex=0}return t}function gC(e,t,n){const r=e.toString(),i=r.replace(fC,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function mC(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const yC=/-+([a-z0-9])/g;function vC(e){return e.replace(yC,(...e)=>e[1].toUpperCase())}function _C(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function CC(e,t){return 0===e||0===t}function EC(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let s=t[0],o=[];if(r.forEach(e=>{s.hasOwnProperty(e)||o.push(e),s[e]=n[e]}),o.length)for(var i=1;i<t.length;i++){let n=t[i];o.forEach(function(t){n[t]=bC(e,t)})}}return t}function wC(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function bC(e,t){return window.getComputedStyle(e)[t]}function SC(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],s=r[2],o=r[3];t.push(TC(i,o));"<"==s[0]&&!("*"==i&&"*"==o)&&t.push(TC(o,i))}(e,n,t)):n.push(e),n}const PC=new Set(["true","1"]),OC=new Set(["false","0"]);function TC(e,t){const n=PC.has(e)||OC.has(e),r=PC.has(t)||OC.has(t);return(i,s)=>{let o="*"==e||e==i,a="*"==t||t==s;return!o&&n&&"boolean"==typeof i&&(o=i?PC.has(e):OC.has(e)),!a&&r&&"boolean"==typeof s&&(a=s?PC.has(t):OC.has(t)),o&&a}}const IC=new RegExp("s*:selfs*,?","g");function kC(e,t,n){return new AC(e).build(t,n)}class AC{constructor(e){this._driver=e}build(e,t){const n=new NC(t);return this._resetContextStyleTimingState(n),wC(this,dC(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],s=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,s.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(e=>{if(MC(e)){const t=e;Object.keys(t).forEach(e=>{pC(t[e]).forEach(e=>{s.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=mC(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=wC(this,dC(e.animation),t);return{type:1,matchers:SC(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:xC(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>wC(this,e,t)),options:xC(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=wC(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:xC(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return RC(sC(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=RC(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||sC(r,t),RC(n.duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;let r,i=e.styles?e.styles:P_({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,s=!1;if(!i){s=!0;const e={};n.easing&&(e.easing=n.easing),i=P_(e)}t.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,t);o.isEmptyStep=s,r=o}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==b_?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(MC(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=t.collectedStyles[t.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=pC(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const c=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let c=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(MC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(MC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),l=0;return null!=c&&(r++,l=n.offset=c),o=o||l<0||l>1,s=s||l<a,a=l,i.push(l),n});o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&t.errors.push("Please ensure that all keyframe offsets are in order");const l=e.steps.length;let u=0;r>0&&r<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(u=1/(l-1));const h=l-1,d=t.currentTime,f=t.currentAnimateTimings,p=f.duration;return c.forEach((e,r)=>{const s=u>0?r==h?1:u*r:i[r],o=s*p;t.currentTime=d+f.delay+o,f.duration=o,this._validateStyleAst(e,t),e.offset=s,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:wC(this,dC(e.animation),t),options:xC(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:xC(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:xC(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,s]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(IC,"")),[e=e.replace(/@\*/g,eC).replace(/@\w+/g,e=>eC+"-"+e.substr(1)).replace(/:animating/g,nC),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,L_(t.collectedStyles,t.currentQuerySelector,{});const o=wC(this,dC(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:e.selector,options:xC(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:sC(e.timings,t.errors,!0);return{type:12,animation:wC(this,dC(e.animation),t),timings:n,options:null}}}class NC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function MC(e){return!Array.isArray(e)&&"object"==typeof e}function xC(e){return e?(e=oC(e)).params&&(e.params=function(e){return e?oC(e):null}(e.params)):e={},e}function RC(e,t,n){return{duration:e,delay:t,easing:n}}function DC(e,t,n,r,i,s,o=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class LC{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const FC=new RegExp(":enter","g"),BC=new RegExp(":leave","g");function UC(e,t,n,r,i,s={},o={},a,c,l=[]){return(new VC).buildKeyframes(e,t,n,r,i,s,o,a,c,l)}class VC{buildKeyframes(e,t,n,r,i,s,o,a,c,l=[]){c=c||new LC;const u=new zC(e,t,c,r,i,l,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),wC(this,n,u);const h=u.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(o).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([o],null,u.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[DC(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&t.transformIntoNewTimeline(s)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?rC(n.duration):null,s=null!=n.delay?rC(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),wC(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=$C);const e=rC(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>wC(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?rC(e.options.delay):0;e.steps.forEach(s=>{const o=t.createSubContext(e.options);i&&o.delayNextStep(i),wC(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return sC(t.params?gC(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,s=t.createSubContext().currentTimeline;s.easing=n.easing,e.styles.forEach(e=>{s.forwardTime((e.offset||0)*i),s.setStyles(e.styles,e.easing,t.errors,t.options),s.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(s),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?rC(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=$C);let s=n;const o=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{t.currentQueryIndex=r;const o=t.createSubContext(e.options,n);i&&o.delayNextStep(i),n===t.element&&(a=o.currentTimeline),wC(this,e.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(s),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,s=Math.abs(i.duration),o=s*(t.currentQueryTotal-1);let a=s*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const c=t.currentTimeline;a&&c.delayNextStep(a);const l=c.currentTime;wC(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-l+(r.startTime-n.currentTimeline.startTime)}}const $C={};class zC{constructor(e,t,n,r,i,s,o,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=$C,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new HC(this._driver,t,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=rC(n.duration)),null!=n.delay&&(r.delay=rC(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{(!t||!e.hasOwnProperty(n))&&(e[n]=gC(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new zC(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=$C,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},i=new GC(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,s){let o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(FC,"."+this._enterClassName)).replace(BC,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),o.push(...t)}return!i&&0==o.length&&s.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),o}}class HC{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new HC(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||b_,this._currentKeyframe[e]=b_}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},s=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=b_})):aC(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(s).forEach(e=>{const t=gC(s[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:b_),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=aC(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?e.add(n):r==b_&&t.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=e.size?mC(e.values()):[],s=t.size?mC(t.values()):[];if(n){const e=r[0],t=oC(e);e.offset=0,t.offset=1,r=[e,t]}return DC(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class GC extends HC{constructor(e,t,n,r,i,s,o=!1){super(e,t,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],s=n+t,o=t/s,a=aC(e[0],!1);a.offset=0,i.push(a);const c=aC(e[0],!1);c.offset=qC(o),i.push(c);const l=e.length-1;for(let r=1;r<=l;r++){let o=aC(e[r],!1);o.offset=qC((t+o.offset*n)/s),i.push(o)}n=s,t=0,r="",e=i}return DC(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function qC(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class WC{}class jC extends WC{normalizePropertyName(e,t){return vC(e)}normalizeStyleValue(e,t,n,r){let i="";const s=n.toString().trim();if(ZC[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return s+i}}const ZC=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function YC(e,t,n,r,i,s,o,a,c,l,u,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:c,preStyleProps:l,postStyleProps:u,totalTime:h,errors:d}}const KC={};class JC{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],s=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):s}build(e,t,n,r,i,s,o,a,c,l){const u=[],h=this.ast.options&&this.ast.options.params||KC,d=this.buildStyles(n,o&&o.params||KC,u),f=a&&a.params||KC,p=this.buildStyles(r,f,u),g=new Set,m=new Map,y=new Map,v="void"===r,_={params:Object.assign(Object.assign({},h),f)},C=l?[]:UC(e,t,this.ast.animation,i,s,d,p,_,c,u);let E=0;if(C.forEach(e=>{E=Math.max(e.duration+e.delay,E)}),u.length)return YC(t,this._triggerName,n,r,v,d,p,[],[],m,y,E,u);C.forEach(e=>{const n=e.element,r=L_(m,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=L_(y,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&g.add(n)});const w=mC(g.values());return YC(t,this._triggerName,n,r,v,d,p,C,w,m,y,E)}}class QC{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){const n={},r=oC(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let s=i[e];s.length>1&&(s=gC(s,r,t));const o=this.normalizer.normalizePropertyName(e,t);s=this.normalizer.normalizeStyleValue(e,o,s,t),n[o]=s})}}),n}}class XC{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new QC(e.style,e.options&&e.options.params||{},n)}),eE(this.states,"true","1"),eE(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new JC(e,t,this.states))}),this.fallbackTransition=function(e,t,n){return new JC(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},t)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function eE(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const tE=new LC;class nE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=kC(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=M_(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let s;const o=new Map;if(i?(s=UC(this._driver,t,i,J_,Q_,{},{},n,tE,r),s.forEach(e=>{const t=L_(o,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);o.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,b_)})});const a=N_(s.map(e=>{const t=o.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=D_(t,"","","");return x_(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const rE="ng-animate-queued",iE="ng-animate-disabled",sE=".ng-animate-disabled",oE=[],aE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},cE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},lE="__ng_removed";class uE{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=(n?e.value:e)??null,n){const t=oC(e);delete t.value,this.options=t}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const hE="void",dE=new uE(hE);class fE{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,EE(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const s=L_(this._elementListeners,e,[]),o={name:t,phase:n,callback:r};s.push(o);const a=L_(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(EE(e,X_),EE(e,X_+"-"+t),a[t]=dE),()=>{this._engine.afterFlush(()=>{const e=s.indexOf(o);e>=0&&s.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),s=new gE(this.id,t,e);let o=this._engine.statesByElement.get(e);o||(EE(e,X_),EE(e,X_+"-"+t),this._engine.statesByElement.set(e,o={}));let a=o[t];const c=new uE(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&c.absorbOptions(a.options),o[t]=c,a||(a=dE),c.value!==hE&&a.value===c.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,c.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(c.value,c.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{hC(e,n),uC(e,r)})}return}const l=L_(this._engine.playersByElement,e,[]);l.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let u=i.matchTransition(a.value,c.value,e,c.params),h=!1;if(!u){if(!r)return;u=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:u,fromState:a,toState:c,player:s,isFallbackTransition:h}),h||(EE(e,rE),s.onStart(()=>{wE(e,rE)})),s.onDone(()=>{let t=this.players.indexOf(s);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(s);e>=0&&n.splice(e,1)}}),this.players.push(s),l.push(s),s}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,eC,!0);n.forEach(e=>{if(e[lE])return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const s=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,hE,r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&N_(s).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const s=this._triggers[i].fallbackTransition,o=n[i]||dE,a=new uE(hE),c=new gE(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:s,fromState:o,toState:a,player:c,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e[lE];(!r||r===aE)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){EE(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(t=>{if(t.name==n.triggerName){const r=D_(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,x_(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class pE{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new fE(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(mE(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!mE(t))return;const i=t[lE];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),EE(e,iE)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),wE(e,iE))}removeNode(e,t,n,r){if(mE(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t[lE]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return mE(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,eC,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,nC,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return N_(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[lE];if(t&&t.setForRemoval){if(e[lE]=aE,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,sE)&&this.markElementAsDisabled(e,!1),this.driver.query(e,sE,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)EE(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?N_(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new LC,r=[],i=new Map,s=[],o=new Map,a=new Map,c=new Map,l=new Set;this.disabledNodes.forEach(e=>{l.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)l.add(t[n])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=_E(h,this.collectedEnterElements),f=new Map;let p=0;d.forEach((e,t)=>{const n=J_+p++;f.set(t,n),e.forEach(e=>EE(e,n))});const g=[],m=new Set,y=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const e=this.collectedLeaveElements[A],t=e[lE];t&&t.setForRemoval&&(g.push(e),m.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>m.add(e)):y.add(e))}const v=new Map,_=_E(h,Array.from(m));_.forEach((e,t)=>{const n=Q_+p++;v.set(t,n),e.forEach(e=>EE(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=f.get(t);e.forEach(e=>wE(e,n))}),_.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>wE(e,n))}),g.forEach(e=>{this.processLeaveNode(e)})});const C=[],E=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(C.push(t),this.collectedEnterElements.length){const e=i[lE];if(e&&e.setForMove)return void t.destroy()}const l=!u||!this.driver.containsElement(u,i),h=v.get(i),d=f.get(i),p=this._buildInstruction(e,n,d,h,l);if(p.errors&&p.errors.length)E.push(p);else{if(l)return t.onStart(()=>hC(i,p.fromStyles)),t.onDestroy(()=>uC(i,p.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>hC(i,p.fromStyles)),t.onDestroy(()=>uC(i,p.toStyles)),void r.push(t);p.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,p.timelines),s.push({instruction:p,player:t,element:i}),p.queriedElements.forEach(e=>L_(o,e,[]).push(t)),p.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),p.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=c.get(t);r||c.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(E.length){const e=[];E.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),C.forEach(e=>e.destroy()),this.reportError(e)}const w=new Map,b=new Map;s.forEach(e=>{const t=e.element;n.has(t)&&(b.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,w))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{L_(w,t,[]).push(e),e.destroy()})});const S=g.filter(e=>PE(e,a,c)),P=new Map;vE(P,this.driver,y,c,b_).forEach(e=>{PE(e,a,c)&&S.push(e)});const O=new Map;d.forEach((e,t)=>{vE(O,this.driver,new Set(e),a,"!")}),S.forEach(e=>{const t=P.get(e),n=O.get(e);P.set(e,Object.assign(Object.assign({},t),n))});const T=[],I=[],k={};s.forEach(e=>{const{element:t,player:s,instruction:o}=e;if(n.has(t)){if(l.has(t))return s.onDestroy(()=>uC(t,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let e=k;if(b.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=b.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>b.set(t,e))}const n=this._buildAnimation(s.namespaceId,o,w,i,O,P);if(s.setRealPlayer(n),e===k)T.push(s);else{const t=this.playersByElement.get(e);t&&t.length&&(s.parentPlayer=N_(t)),r.push(s)}}else hC(t,o.fromStyles),s.onDestroy(()=>uC(t,o.toStyles)),I.push(s),l.has(t)&&r.push(s)}),I.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=N_(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let A=0;A<g.length;A++){const e=g[A],t=e[lE];if(wE(e,Q_),t&&t.hasAnimation)continue;let n=[];if(o.size){let t=o.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,nC,!0);for(let e=0;e<r.length;e++){let t=o.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?bE(this,e,r):this.processLeaveNode(e)}return g.length=0,T.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),T}elementContainsData(e,t){let n=!1;const r=t[lE];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let s=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(s=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==hE;t.forEach(t=>{t.queued||!e&&t.triggerName!=r||s.push(t)})}}return(n||r)&&(s=s.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),s}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName;for(const o of t.timelines){const e=o.element,a=e!==r,c=L_(n,e,[]);this._getPreviousPlayers(e,a,i,s,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)})}hC(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,s){const o=t.triggerName,a=t.element,c=[],l=new Set,u=new Set,h=t.timelines.map(t=>{const h=t.element;l.add(h);const d=h[lE];if(d&&d.removedBeforeQueried)return new T_(t.duration,t.delay);const f=h!==a,p=function(e){const t=[];return SE(e,t),t}((n.get(h)||oE).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),g=i.get(h),m=s.get(h),y=M_(0,this._normalizer,0,t.keyframes,g,m),v=this._buildPlayer(t,y,p);if(t.subTimeline&&r&&u.add(h),f){const t=new gE(e,o,h);t.setRealPlayer(v),c.push(t)}return v});c.forEach(e=>{L_(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),l.forEach(e=>EE(e,tC));const d=N_(h);return d.onDestroy(()=>{l.forEach(e=>wE(e,tC)),uC(a,t.toStyles)}),u.forEach(e=>{L_(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new T_(e.duration,e.delay)}}class gE{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new T_,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>x_(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){L_(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function mE(e){return e&&1===e.nodeType}function yE(e,t){const n=e.style.display;return e.style.display=t??"none",n}function vE(e,t,n,r,i){const s=[];n.forEach(e=>s.push(yE(e)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(e=>{const n=s[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[lE]=cE,o.push(r))}),e.set(r,s)});let a=0;return n.forEach(e=>yE(e,s[a++])),o}function _E(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function s(e){if(!e)return 1;let t=i.get(e);if(t)return t;const o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:s(o),i.set(e,t),t}return t.forEach(e=>{const t=s(e);1!==t&&n.get(t).push(e)}),n}const CE="$$classes";function EE(e,t){if(e.classList)e.classList.add(t);else{let n=e[CE];n||(n=e[CE]={}),n[t]=!0}}function wE(e,t){if(e.classList)e.classList.remove(t);else{let n=e[CE];n&&delete n[t]}}function bE(e,t,n){N_(n).onDone(()=>e.processLeaveNode(t))}function SE(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof I_?SE(r.players,t):t.push(r)}}function PE(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class OE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new pE(e,t,n),this._timelineEngine=new nE(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const s=e+"-"+r;let o=this._triggerCache[s];if(!o){const e=[],t=kC(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);o=function(e,t,n){return new XC(e,t,n)}(r,t,this._normalizer),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(t,r,o)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=F_(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=F_(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function TE(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=kE(t[0]),t.length>1&&(r=kE(t[t.length-1]))):t&&(n=kE(t)),n||r?new IE(e,n,r):null}let IE=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&uC(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(uC(this._element,this._initialStyles),this._endStyles&&(uC(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(hC(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(hC(this._element,this._endStyles),this._endStyles=null),uC(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function kE(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];AE(i)&&(t=t||{},t[i]=e[i])}return t}function AE(e){return"display"===e||"position"===e}const NE="animation",ME="animationend";class xE{constructor(e,t,n,r,i,s,o){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){(function(e,t){const n=UE(e,"").trim();let r=0;n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++;return n}(n)+1,t=`${n}, ${t}`),BE(e,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),FE(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){RE(this._element,this._name,"paused")}resume(){RE(this._element,this._name,"running")}setPosition(e){const t=DE(this._element,this._name);this._position=e*this._duration,BE(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),FE(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=UE(e,"").split(","),r=LE(n,t);r>=0&&(n.splice(r,1),BE(e,"",n.join(",")))}(this._element,this._name))}}function RE(e,t,n){BE(e,"PlayState",n,DE(e,t))}function DE(e,t){const n=UE(e,"");return n.indexOf(",")>0?LE(n.split(","),t):LE([n],t)}function LE(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function FE(e,t,n){n?e.removeEventListener(ME,t):e.addEventListener(ME,t)}function BE(e,t,n,r){const i=NE+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function UE(e,t){return e.style[NE+t]||""}class VE{constructor(e,t,n,r,i,s,o,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new xE(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:bC(this.element,n))})}this.currentSnapshot=e}}class $E extends T_{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=Z_(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class zE{constructor(){this._count=0}validateStyleProperty(e){return G_(e)}matchesElement(e,t){return q_(e,t)}containsElement(e,t){return W_(e,t)}query(e,t,n){return j_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>Z_(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const s=document.createElement("style");return s.textContent=r,s}animate(e,t,n,r,i,s=[],o){const a=s.filter(e=>e instanceof VE),c={};CC(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const l=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=EC(e,t,c));if(0==n)return new $E(e,l);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,u,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=TE(e,t),f=new VE(e,t,u,n,r,i,l,d);return f.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),f}}class HE{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:bC(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class GE{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(qE().toString()),this._cssKeyframesDriver=new zE}validateStyleProperty(e){return G_(e)}matchesElement(e,t){return q_(e,t)}containsElement(e,t){return W_(e,t)}query(e,t,n){return j_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const c={},l=s.filter(e=>e instanceof HE);CC(n,r)&&l.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const u=TE(e,t=EC(e,t=t.map(e=>aC(e,!1)),c));return new HE(e,t,a,u)}}function qE(){return k_()&&Element.prototype.animate||{}}let WE=(()=>{class e extends w_{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:Be.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?S_(e):e;return YE(this._renderer,null,t,"register",[n]),new jE(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(Or(ll),Or(Rh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class jE extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new ZE(this._id,e,t||{},this._renderer)}}class ZE{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return YE(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function YE(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const KE="@.disabled";let JE=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new QE("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const s=t=>{Array.isArray(t)?t.forEach(s):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(s),new XE(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(Or(ll),Or(OE),Or(nh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class QE{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){"@"==t.charAt(0)&&t==KE?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class XE extends QE{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==KE?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if("@"==t.charAt(0)){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let ew=(()=>{class e extends OE{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh),Or(K_),Or(WC))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const tw=new or("AnimationModuleType"),nw=[{provide:w_,useClass:WE},{provide:WC,useFactory:function(){return new jC}},{provide:OE,useClass:ew},{provide:ll,useFactory:function(e,t,n){return new JE(e,t,n)},deps:[pf,OE,nh]}],rw=[{provide:K_,useFactory:function(){return"function"==typeof qE()?new GE:new zE}},{provide:tw,useValue:"BrowserAnimations"},...nw],iw=[{provide:K_,useClass:Y_},{provide:tw,useValue:"NoopAnimations"},...nw];let sw=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?iw:rw}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:rw,imports:[If]}),e})();var ow=n(9575),aw=n.n(ow);function cw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,i)}function lw(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){cw(s,r,i,o,a,"next",e)}function a(e){cw(s,r,i,o,a,"throw",e)}o(void 0)})}}class uw{static expectToBe(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error(`A default switch case did not observe the correct value, expected ${t}, but got ${e} instead.`)}static expectToBeMultiple(e,t){let n=!1;for(const r of t)if(e===r){n=!0;break}if(!1===n)throw new Error(`A default switch case did not observe the correct value, expected a value among ${t}, but got ${e} instead.`)}static getNonNullable(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}function hw(e,t){e&&console.log(t)}function dw(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);{const n=e,r=t;for(const e of Object.keys(n)){if(!(e in r))return!1;if(!1===dw(n[e],r[e]))return!1}return!0}}return e===t}function fw(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(const t in e)if(null!=e[t]&&!1===fw(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function pw(e,t){if(fw(e)&&fw(t))return dw(e,t);throw new Error(`Comparing non comparable objects: ${e.constructor.name} and ${t.constructor.name}`)}class gw{constructor(e){this.value=e}static of(e){return new gw(e)}static ofNullable(e){return null==e?gw.empty():gw.of(e)}static empty(){return new gw(null)}isPresent(){return null!=this.value}isAbsent(){return null==this.value}get(){if(this.isPresent())return this.value;throw new Error("Value is absent")}getOrElse(e){return this.isPresent()?this.value:e}equals(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&pw(this.value,e.value)}equalsValue(e){return this.equals(gw.of(e))}toString(){return this.isAbsent()?"MGPOptional.empty()":`MGPOptional.of(${this.value})`}map(e){return this.isPresent()?gw.of(e(this.get())):gw.empty()}}const mw=function(e,t){if(!e)throw yw(t)},yw=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},vw=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},_w={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0;let l=(15&o)<<2|c>>6,u=63&c;a||(u=64,s||(l=64)),r.push(n[t>>2],n[(3&t)<<4|o>>4],n[l],n[u])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(vw(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();r.push(t<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Cw=function(e){const t=vw(e);return _w.encodeByteArray(t,!0)},Ew=function(e){return Cw(e).replace(/\./g,"")},ww=function(e){try{return _w.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function bw(e){return Sw(void 0,e)}function Sw(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)!t.hasOwnProperty(n)||!Pw(n)||(e[n]=Sw(e[n],t[n]));return e}function Pw(e){return"__proto__"!==e}class Ow{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Tw(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ew(JSON.stringify({alg:"none",type:"JWT"})),Ew(JSON.stringify(s)),""].join(".")}function Iw(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function kw(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Iw())}function Aw(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function Nw(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Mw(){const e=Iw();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function xw(){return"object"==typeof indexedDB}function Rw(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function Dw(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Lw extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Lw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fw.prototype.create)}}class Fw{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Bw,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error";return new Lw(r,`${this.serviceName}: ${s} (${r}).`,n)}}const Bw=/\{\$([^}]+)}/g;function Uw(e){return JSON.parse(e)}function Vw(e){return JSON.stringify(e)}const $w=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=Uw(ww(s[0])||""),n=Uw(ww(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}};function zw(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Hw(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Gw(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function qw(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Ww(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(jw(n)&&jw(s)){if(!Ww(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function jw(e){return null!==e&&"object"==typeof e}function Zw(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Yw(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Kw(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Jw{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):u<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const e=(s<<5|s>>>27)+r+l+i+n[u]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class Qw{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of["next","error","complete"])if(n in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Xw),void 0===r.error&&(r.error=Xw),void 0===r.complete&&(r.complete=Xw);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Xw(){}function eb(e,t){return`${e} failed: ${t} argument `}const tb=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function nb(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function rb(e){return e&&e._delegate?e._delegate:e}class ib{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const sb="[DEFAULT]";class ob{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ow;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:sb})}catch{}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=sb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return lw(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=sb){return this.instances.has(e)}getOptions(e=sb){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===sb?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=sb){return this.component?this.component.multipleInstances?e:sb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ab{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ob(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const cb=[];var lb=(()=>{return(e=lb||(lb={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",lb;var e})();const ub={debug:lb.DEBUG,verbose:lb.VERBOSE,info:lb.INFO,warn:lb.WARN,error:lb.ERROR,silent:lb.SILENT},hb=lb.INFO,db={[lb.DEBUG]:"log",[lb.VERBOSE]:"log",[lb.INFO]:"info",[lb.WARN]:"warn",[lb.ERROR]:"error"},fb=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=db[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class pb{constructor(e){this.name=e,this._logLevel=hb,this._logHandler=fb,this._userLogHandler=null,cb.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lb))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ub[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lb.DEBUG,...e),this._logHandler(this,lb.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lb.VERBOSE,...e),this._logHandler(this,lb.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lb.INFO,...e),this._logHandler(this,lb.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lb.WARN,...e),this._logHandler(this,lb.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lb.ERROR,...e),this._logHandler(this,lb.ERROR,...e)}}class gb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const mb="@firebase/app",yb=new pb("@firebase/app"),vb="[DEFAULT]",_b={[mb]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Cb=new Map,Eb=new Map;function wb(e,t){try{e.container.addComponent(t)}catch(n){yb.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function bb(e){const t=e.name;if(Eb.has(t))return yb.debug(`There were multiple attempts to register component ${t}.`),!1;Eb.set(t,e);for(const n of Cb.values())wb(n,e);return!0}function Sb(e,t){return e.container.getProvider(t)}const Pb=new Fw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class Ob{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ib("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pb.create("app-deleted",{appName:this._name})}}const Tb="9.6.6";function Ib(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:vb,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw Pb.create("bad-app-name",{appName:String(r)});const i=Cb.get(r);if(i){if(Ww(e,i.options)&&Ww(n,i.config))return i;throw Pb.create("duplicate-app",{appName:r})}const s=new ab(r);for(const a of Eb.values())s.addComponent(a);const o=new Ob(e,n,s);return Cb.set(r,o),o}function kb(e=vb){const t=Cb.get(e);if(!t)throw Pb.create("no-app",{appName:e});return t}function Ab(){return Array.from(Cb.values())}function Nb(e,t,n){var r;let i=null!==(r=_b[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void yb.warn(e.join(" "))}bb(new ib(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}bb(new ib("platform-logger",e=>new gb(e),"PRIVATE")),Nb(mb,"0.7.16",""),Nb(mb,"0.7.16","esm2017"),Nb("fire-js",""),Nb("firebase","9.6.6","app");var Mb=n(6676);const xb="@firebase/installations",Rb="w:0.5.5",Db="FIS_v2",Lb=new Fw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Fb(e){return e instanceof Lw&&e.code.includes("request-failed")}function Bb({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Ub(e){return{token:e.token,requestStatus:2,expiresIn:Wb(e.expiresIn),creationTime:Date.now()}}function Vb(e,t){return $b.apply(this,arguments)}function $b(){return($b=lw(function*(e,t){const n=(yield t.json()).error;return Lb.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})).apply(this,arguments)}function zb({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Hb(e,{refreshToken:t}){const n=zb(e);return n.append("Authorization",function(e){return`${Db} ${e}`}(t)),n}function Gb(e){return qb.apply(this,arguments)}function qb(){return(qb=lw(function*(e){const t=yield e();return t.status>=500&&t.status<600?e():t})).apply(this,arguments)}function Wb(e){return Number(e.replace("s","000"))}function jb(e,t){return Zb.apply(this,arguments)}function Zb(){return(Zb=lw(function*(e,{fid:t}){const n=Bb(e),r={method:"POST",headers:zb(e),body:JSON.stringify({fid:t,authVersion:Db,appId:e.appId,sdkVersion:Rb})},i=yield Gb(()=>fetch(n,r));if(i.ok){const e=yield i.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:Ub(e.authToken)}}throw yield Vb("Create Installation",i)})).apply(this,arguments)}function Yb(e){return new Promise(t=>{setTimeout(t,e)})}const Kb=/^[cdef][\w-]{21}$/;function Jb(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return Kb.test(t)?t:""}catch{return""}}function Qb(e){return`${e.appName}!${e.appId}`}const Xb=new Map;function eS(e,t){const n=Qb(e);tS(n,t),function(e,t){const n=(!nS&&"BroadcastChannel"in self&&(nS=new BroadcastChannel("[Firebase] FID Change"),nS.onmessage=e=>{tS(e.data.key,e.data.fid)}),nS);n&&n.postMessage({key:e,fid:t}),0===Xb.size&&nS&&(nS.close(),nS=null)}(n,t)}function tS(e,t){const n=Xb.get(e);if(n)for(const r of n)r(t)}let nS=null;const rS="firebase-installations-store";let iS=null;function sS(){return iS||(iS=(0,Mb.openDb)("firebase-installations-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(rS)}})),iS}function oS(e,t){return aS.apply(this,arguments)}function aS(){return(aS=lw(function*(e,t){const n=Qb(e),r=(yield sS()).transaction(rS,"readwrite"),i=r.objectStore(rS),s=yield i.get(n);return yield i.put(t,n),yield r.complete,(!s||s.fid!==t.fid)&&eS(e,t.fid),t})).apply(this,arguments)}function cS(e){return lS.apply(this,arguments)}function lS(){return(lS=lw(function*(e){const t=Qb(e),n=(yield sS()).transaction(rS,"readwrite");yield n.objectStore(rS).delete(t),yield n.complete})).apply(this,arguments)}function uS(e,t){return hS.apply(this,arguments)}function hS(){return(hS=lw(function*(e,t){const n=Qb(e),r=(yield sS()).transaction(rS,"readwrite"),i=r.objectStore(rS),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.complete,o&&(!s||s.fid!==o.fid)&&eS(e,o.fid),o})).apply(this,arguments)}function dS(e){return fS.apply(this,arguments)}function fS(){return(fS=lw(function*(e){let t;const n=yield uS(e,n=>{const r=pS(n),i=gS(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})).apply(this,arguments)}function pS(e){return CS(e||{fid:Jb(),registrationStatus:0})}function gS(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Lb.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return mS.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:yS(e)}:{installationEntry:t}}function mS(){return(mS=lw(function*(e,t){try{return oS(e,yield jb(e,t))}catch(n){throw Fb(n)&&409===n.customData.serverCode?yield cS(e):yield oS(e,{fid:t.fid,registrationStatus:0}),n}})).apply(this,arguments)}function yS(e){return vS.apply(this,arguments)}function vS(){return(vS=lw(function*(e){let t=yield _S(e);for(;1===t.registrationStatus;)yield Yb(100),t=yield _S(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield dS(e);return n||t}return t})).apply(this,arguments)}function _S(e){return uS(e,e=>{if(!e)throw Lb.create("installation-not-found");return CS(e)})}function CS(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function ES(e,t){return wS.apply(this,arguments)}function wS(){return(wS=lw(function*({appConfig:e,platformLoggerProvider:t},n){const r=bS(e,n),i=Hb(e,n),s=t.getImmediate({optional:!0});s&&i.append("x-firebase-client",s.getPlatformInfoString());const o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:Rb}})},a=yield Gb(()=>fetch(r,o));if(a.ok)return Ub(yield a.json());throw yield Vb("Generate Auth Token",a)})).apply(this,arguments)}function bS(e,{fid:t}){return`${Bb(e)}/${t}/authTokens:generate`}function SS(e){return PS.apply(this,arguments)}function PS(){return(PS=lw(function*(e,t=!1){let n;const r=yield uS(e.appConfig,r=>{if(!NS(r))throw Lb.create("not-registered");const i=r.authToken;if(!t&&MS(i))return r;if(1===i.requestStatus)return n=OS(e,t),r;{if(!navigator.onLine)throw Lb.create("app-offline");const t=xS(r);return n=kS(e,t),t}});return n?yield n:r.authToken})).apply(this,arguments)}function OS(e,t){return TS.apply(this,arguments)}function TS(){return(TS=lw(function*(e,t){let n=yield IS(e.appConfig);for(;1===n.authToken.requestStatus;)yield Yb(100),n=yield IS(e.appConfig);const r=n.authToken;return 0===r.requestStatus?SS(e,t):r})).apply(this,arguments)}function IS(e){return uS(e,e=>{if(!NS(e))throw Lb.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function kS(e,t){return AS.apply(this,arguments)}function AS(){return(AS=lw(function*(e,t){try{const n=yield ES(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield oS(e.appConfig,r),n}catch(n){if(!Fb(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield oS(e.appConfig,n)}else yield cS(e.appConfig);throw n}})).apply(this,arguments)}function NS(e){return void 0!==e&&2===e.registrationStatus}function MS(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function xS(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function RS(){return(RS=lw(function*(e){const t=e,{installationEntry:n,registrationPromise:r}=yield dS(t.appConfig);return r?r.catch(console.error):SS(t).catch(console.error),n.fid})).apply(this,arguments)}function DS(){return(DS=lw(function*(e,t=!1){const n=e;return yield LS(n.appConfig),(yield SS(n,t)).token})).apply(this,arguments)}function LS(e){return FS.apply(this,arguments)}function FS(){return(FS=lw(function*(e){const{registrationPromise:t}=yield dS(e);t&&(yield t)})).apply(this,arguments)}function BS(e){return Lb.create("missing-app-config-values",{valueName:e})}const US="installations";bb(new ib(US,e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw BS("App Configuration");if(!e.name)throw BS("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw BS(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:Sb(t,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),bb(new ib("installations-internal",e=>{const t=Sb(e.getProvider("app").getImmediate(),US).getImmediate();return{getId:()=>function(e){return RS.apply(this,arguments)}(t),getToken:e=>function(e){return DS.apply(this,arguments)}(t,e)}},"PRIVATE")),Nb(xb,"0.5.5"),Nb(xb,"0.5.5","esm2017");const VS="@firebase/remote-config",$S=new Fw("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class zS{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}fetch(e){var t=this;return lw(function*(){const[n,r]=yield Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);if(r&&t.isCachedDataFresh(e.cacheMaxAgeMillis,n))return r;e.eTag=r&&r.eTag;const i=yield t.client.fetch(e),s=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===i.status&&s.push(t.storage.setLastSuccessfulFetchResponse(i)),yield Promise.all(s),i})()}}function HS(e=navigator){return e.languages&&e.languages[0]||e.language}class GS{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}fetch(e){var t=this;return lw(function*(){const[n,r]=yield Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${t.projectId}/namespaces/${t.namespace}:fetch?key=${t.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},o={sdk_version:t.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:t.appId,language_code:HS()},a={method:"POST",headers:s,body:JSON.stringify(o)},c=fetch(i,a),l=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let u;try{yield Promise.race([c,l]),u=yield c}catch(g){let e="fetch-client-network";throw"AbortError"===g.name&&(e="fetch-timeout"),$S.create(e,{originalErrorMessage:g.message})}let h=u.status;const d=u.headers.get("ETag")||void 0;let f,p;if(200===u.status){let e;try{e=yield u.json()}catch(m){throw $S.create("fetch-client-parse",{originalErrorMessage:m.message})}f=e.entries,p=e.state}if("INSTANCE_STATE_UNSPECIFIED"===p?h=500:"NO_CHANGE"===p?h=304:("NO_TEMPLATE"===p||"EMPTY_CONFIG"===p)&&(f={}),304!==h&&200!==h)throw $S.create("fetch-status",{httpStatus:h});return{status:h,eTag:d,config:f}})()}}class qS{constructor(e,t){this.client=e,this.storage=t}fetch(e){var t=this;return lw(function*(){const n=(yield t.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return t.attemptFetch(e,n)})()}attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r=this;return lw(function*(){yield function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r($S.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,t);try{const t=yield r.client.fetch(e);return yield r.storage.deleteThrottleMetadata(),t}catch(i){if(!function(e){if(!(e instanceof Lw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(i))throw i;const t={throttleEndTimeMillis:Date.now()+nb(n),backoffCount:n+1};return yield r.storage.setThrottleMetadata(t),r.attemptFetch(e,t)}})()}}class WS{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function jS(e,t){const n=e.target.error||void 0;return $S.create(t,{originalErrorMessage:n&&n.message})}const ZS="app_namespace_store";class YS{constructor(e,t,n,r=function(){return new Promise((e,n)=>{try{const t=indexedDB.open("firebase_remote_config",1);t.onerror=e=>{n(jS(e,"storage-open"))},t.onsuccess=t=>{e(t.target.result)},t.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(ZS,{keyPath:"compositeKey"})}}}catch(t){n($S.create("storage-open",{originalErrorMessage:t}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(e){var t=this;return lw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([ZS],"readonly").objectStore(ZS),o=t.createCompositeKey(e);try{const e=s.get(o);e.onerror=e=>{i(jS(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;r(t?t.value:void 0)}}catch(a){i($S.create("storage-get",{originalErrorMessage:a&&a.message}))}})})()}set(e,t){var n=this;return lw(function*(){const r=yield n.openDbPromise;return new Promise((i,s)=>{const o=r.transaction([ZS],"readwrite").objectStore(ZS),a=n.createCompositeKey(e);try{const e=o.put({compositeKey:a,value:t});e.onerror=e=>{s(jS(e,"storage-set"))},e.onsuccess=()=>{i()}}catch(c){s($S.create("storage-set",{originalErrorMessage:c&&c.message}))}})})()}delete(e){var t=this;return lw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([ZS],"readwrite").objectStore(ZS),o=t.createCompositeKey(e);try{const e=s.delete(o);e.onerror=e=>{i(jS(e,"storage-delete"))},e.onsuccess=()=>{r()}}catch(a){i($S.create("storage-delete",{originalErrorMessage:a&&a.message}))}})})()}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class KS{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var e=this;return lw(function*(){const t=e.storage.getLastFetchStatus(),n=e.storage.getLastSuccessfulFetchTimestampMillis(),r=e.storage.getActiveConfig(),i=yield t;i&&(e.lastFetchStatus=i);const s=yield n;s&&(e.lastSuccessfulFetchTimestampMillis=s);const o=yield r;o&&(e.activeConfig=o)})()}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function JS(){return QS.apply(this,arguments)}function QS(){return(QS=lw(function*(){if(!xw())return!1;try{return yield Rw()}catch{return!1}})).apply(this,arguments)}bb(new ib("remote-config",function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw $S.create("registration-window");if(!xw())throw $S.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw $S.create("registration-project-id");if(!s)throw $S.create("registration-api-key");if(!o)throw $S.create("registration-app-id");const a=new YS(o,n.name,t=t||"firebase"),c=new KS(a),l=new pb(VS);l.logLevel=lb.ERROR;const u=new GS(r,Tb,t,i,s,o),h=new qS(u,a),d=new zS(h,a,c,l),f=new WS(n,d,c,a,l);return function(e){const t=rb(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0}))}(f),f},"PUBLIC").setMultipleInstances(!0)),Nb(VS,"0.3.4"),Nb(VS,"0.3.4","esm2017");const XS="/firebase-messaging-sw.js",eP="/firebase-cloud-messaging-push-scope",tP="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",nP="google.c.a.c_id",rP="google.c.a.c_l",iP="google.c.a.ts",sP="google.c.a.e";var oP=(()=>(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(oP||(oP={})),oP))();function aP(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function cP(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}const lP="fcm_token_details_db",uP="fcm_token_object_Store";function hP(e){return dP.apply(this,arguments)}function dP(){return(dP=lw(function*(e){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(lP))return null;let t=null;return(yield(0,Mb.openDb)(lP,5,function(){var n=lw(function*(n){var r;if(n.oldVersion<2||!n.objectStoreNames.contains(uP))return;const i=n.transaction.objectStore(uP),s=yield i.index("fcmSenderId").get(e);if(yield i.clear(),s)if(2===n.oldVersion){const e=s;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:aP(e.vapidKey)}}}else if(3===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:aP(e.auth),p256dh:aP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:aP(e.vapidKey)}}}else if(4===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:aP(e.auth),p256dh:aP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:aP(e.vapidKey)}}}});return function(e){return n.apply(this,arguments)}}())).close(),yield(0,Mb.deleteDb)(lP),yield(0,Mb.deleteDb)("fcm_vapid_details_db"),yield(0,Mb.deleteDb)("undefined"),fP(t)?t:null})).apply(this,arguments)}function fP(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}const pP="firebase-messaging-store";let gP=null;function mP(){return gP||(gP=(0,Mb.openDb)("firebase-messaging-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(pP)}})),gP}function yP(e){return vP.apply(this,arguments)}function vP(){return(vP=lw(function*(e){const t=bP(e),n=yield(yield mP()).transaction(pP).objectStore(pP).get(t);if(n)return n;{const t=yield hP(e.appConfig.senderId);if(t)return yield _P(e,t),t}})).apply(this,arguments)}function _P(e,t){return CP.apply(this,arguments)}function CP(){return(CP=lw(function*(e,t){const n=bP(e),r=(yield mP()).transaction(pP,"readwrite");return yield r.objectStore(pP).put(t,n),yield r.complete,t})).apply(this,arguments)}function EP(e){return wP.apply(this,arguments)}function wP(){return(wP=lw(function*(e){const t=bP(e),n=(yield mP()).transaction(pP,"readwrite");yield n.objectStore(pP).delete(t),yield n.complete})).apply(this,arguments)}function bP({appConfig:e}){return e.appId}const SP=new Fw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function PP(e,t){return OP.apply(this,arguments)}function OP(){return(OP=lw(function*(e,t){const n=yield MP(e),r=RP(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(NP(e.appConfig),i)).json()}catch(o){throw SP.create("token-subscribe-failed",{errorInfo:o})}if(s.error)throw SP.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw SP.create("token-subscribe-no-token");return s.token})).apply(this,arguments)}function TP(e,t){return IP.apply(this,arguments)}function IP(){return(IP=lw(function*(e,t){const n=yield MP(e),r=RP(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(`${NP(e.appConfig)}/${t.token}`,i)).json()}catch(o){throw SP.create("token-update-failed",{errorInfo:o})}if(s.error)throw SP.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw SP.create("token-update-no-token");return s.token})).apply(this,arguments)}function kP(e,t){return AP.apply(this,arguments)}function AP(){return(AP=lw(function*(e,t){const n={method:"DELETE",headers:yield MP(e)};try{const r=yield(yield fetch(`${NP(e.appConfig)}/${t}`,n)).json();if(r.error)throw SP.create("token-unsubscribe-failed",{errorInfo:r.error.message})}catch(r){throw SP.create("token-unsubscribe-failed",{errorInfo:r})}})).apply(this,arguments)}function NP({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function MP(e){return xP.apply(this,arguments)}function xP(){return(xP=lw(function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})).apply(this,arguments)}function RP({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==tP&&(i.web.applicationPubKey=r),i}function DP(e){return LP.apply(this,arguments)}function LP(){return(LP=lw(function*(e){const t=yield HP(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:aP(t.getKey("auth")),p256dh:aP(t.getKey("p256dh"))},r=yield yP(e.firebaseDependencies);if(r){if(qP(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?UP(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{yield kP(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return $P(e.firebaseDependencies,n)}return $P(e.firebaseDependencies,n)})).apply(this,arguments)}function FP(e){return BP.apply(this,arguments)}function BP(){return(BP=lw(function*(e){const t=yield yP(e.firebaseDependencies);t&&(yield kP(e.firebaseDependencies,t.token),yield EP(e.firebaseDependencies));const n=yield e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()})).apply(this,arguments)}function UP(e,t){return VP.apply(this,arguments)}function VP(){return(VP=lw(function*(e,t){try{const n=yield TP(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield _P(e.firebaseDependencies,r),n}catch(n){throw yield FP(e),n}})).apply(this,arguments)}function $P(e,t){return zP.apply(this,arguments)}function zP(){return(zP=lw(function*(e,t){const n={token:yield PP(e,t),createTime:Date.now(),subscriptionOptions:t};return yield _P(e,n),n.token})).apply(this,arguments)}function HP(e,t){return GP.apply(this,arguments)}function GP(){return(GP=lw(function*(e,t){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:cP(t)})})).apply(this,arguments)}function qP(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function WP(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i)}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){if(!t.fcmOptions)return;e.fcmOptions={};const n=t.fcmOptions.link;n&&(e.fcmOptions.link=n);const r=t.fcmOptions.analytics_label;r&&(e.fcmOptions.analyticsLabel=r)}(t,e),t}function jP(e){return"object"==typeof e&&!!e&&nP in e}function ZP(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function YP(e){return SP.create("missing-app-config-values",{valueName:e})}ZP("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),ZP("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class KP{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw YP("App Configuration Object");if(!e.name)throw YP("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw YP(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function JP(e){return QP.apply(this,arguments)}function QP(){return(QP=lw(function*(e){try{e.swRegistration=yield navigator.serviceWorker.register(XS,{scope:eP}),e.swRegistration.update().catch(()=>{})}catch(t){throw SP.create("failed-service-worker-registration",{browserErrorMessage:t.message})}})).apply(this,arguments)}function XP(e,t){return eO.apply(this,arguments)}function eO(){return(eO=lw(function*(e,t){if(!t&&!e.swRegistration&&(yield JP(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw SP.create("invalid-sw-registration");e.swRegistration=t}})).apply(this,arguments)}function tO(e,t){return nO.apply(this,arguments)}function nO(){return(nO=lw(function*(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=tP)})).apply(this,arguments)}function rO(){return(rO=lw(function*(e,t){if(!navigator)throw SP.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw SP.create("permission-blocked");return yield tO(e,null==t?void 0:t.vapidKey),yield XP(e,null==t?void 0:t.serviceWorkerRegistration),DP(e)})).apply(this,arguments)}function iO(e,t,n){return sO.apply(this,arguments)}function sO(){return(sO=lw(function*(e,t,n){const r=oO(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[nP],message_name:n[rP],message_time:n[iP],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function oO(e){switch(e){case oP.NOTIFICATION_CLICKED:return"notification_open";case oP.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function aO(){return(aO=lw(function*(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===oP.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(WP(n)):e.onMessageHandler.next(WP(n)));const r=n.data;jP(r)&&"1"===r[sP]&&(yield iO(e,n.messageType,r))})).apply(this,arguments)}const cO="@firebase/messaging";function lO(){return uO.apply(this,arguments)}function uO(){return(uO=lw(function*(){try{yield Rw()}catch{return!1}return"undefined"!=typeof window&&xw()&&Dw()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}bb(new ib("messaging",e=>{const t=new KP(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>function(e,t){return aO.apply(this,arguments)}(t,e)),t},"PUBLIC")),bb(new ib("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>function(e,t){return rO.apply(this,arguments)}(t,e)}},"PRIVATE")),Nb(cO,"0.9.8"),Nb(cO,"0.9.8","esm2017");const hO="analytics",dO="firebase_id",fO="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pO="https://www.googletagmanager.com/gtag/js",gO=new pb("@firebase/analytics");function mO(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function yO(e,t){const n=document.createElement("script");n.src=`${pO}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function vO(e,t,n,r,i,s){return _O.apply(this,arguments)}function _O(){return(_O=lw(function*(e,t,n,r,i,s){const o=r[i];try{if(o)yield t[o];else{const e=(yield mO(n)).find(e=>e.measurementId===i);e&&(yield t[e.appId])}}catch(a){gO.error(a)}e("config",i,s)})).apply(this,arguments)}function CO(e,t,n,r,i){return EO.apply(this,arguments)}function EO(){return(EO=lw(function*(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=yield mO(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),yield Promise.all(s),e("event",r,i||{})}catch(s){gO.error(s)}})).apply(this,arguments)}function wO(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(pO))return t;return null}const bO=new Fw("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),SO=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function PO(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function OO(e){return TO.apply(this,arguments)}function TO(){return(TO=lw(function*(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:PO(r)},s=fO.replace("{app-id}",n),o=yield fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=yield o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch{}throw bO.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()})).apply(this,arguments)}function IO(e){return kO.apply(this,arguments)}function kO(){return(kO=lw(function*(e,t=SO,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw bO.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw bO.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new RO;return setTimeout(lw(function*(){a.abort()}),void 0!==n?n:6e4),AO({appId:r,apiKey:i,measurementId:s},o,a,t)})).apply(this,arguments)}function AO(e,t,n){return NO.apply(this,arguments)}function NO(){return(NO=lw(function*(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=SO){const{appId:s,measurementId:o}=e;try{yield MO(r,t)}catch(a){if(o)return gO.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}try{const t=yield OO(e);return i.deleteThrottleMetadata(s),t}catch(a){if(!xO(a)){if(i.deleteThrottleMetadata(s),o)return gO.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}const t=503===Number(a.customData.httpStatus)?nb(n,i.intervalMillis,30):nb(n,i.intervalMillis),c={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return i.setThrottleMetadata(s,c),gO.debug(`Calling attemptFetch again in ${t} millis`),AO(e,c,r,i)}})).apply(this,arguments)}function MO(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(bO.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function xO(e){if(!(e instanceof Lw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class RO{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}function DO(){return LO.apply(this,arguments)}function LO(){return(LO=lw(function*(){if(!xw())return gO.warn(bO.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield Rw()}catch(e){return gO.warn(bO.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0})).apply(this,arguments)}function FO(){return(FO=lw(function*(e,t,n,r,i,s,o){var a;const c=IO(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&gO.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>gO.error(e)),t.push(c);const l=DO().then(e=>{if(e)return r.getId()}),[u,h]=yield Promise.all([c,l]);wO()||yO(s,u.measurementId),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d[dO]=h),i("config",u.measurementId,d),u.measurementId})).apply(this,arguments)}class BO{constructor(e){this.app=e}_delete(){return delete UO[this.app.options.appId],Promise.resolve()}}let UO={},VO=[];const $O={};let zO,HO,GO="dataLayer",qO=!1;function WO(e,t,n){!function(){const e=[];if(Aw()&&e.push("This is a browser extension environment."),Dw()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=bO.create("invalid-analytics-context",{errorInfo:t});gO.warn(n.message)}}();const r=e.options.appId;if(!r)throw bO.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw bO.create("no-api-key");gO.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=UO[r])throw bO.create("already-exists",{id:r});if(!qO){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(GO);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){function i(){return(i=lw(function*(i,s,o){try{"event"===i?yield CO(e,t,n,s,o):"config"===i?yield vO(e,t,n,r,s,o):e("set",s)}catch(a){gO.error(a)}})).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(UO,VO,$O,GO,"gtag");HO=e,zO=t,qO=!0}return UO[r]=function(e,t,n,r,i,s,o){return FO.apply(this,arguments)}(e,VO,$O,t,zO,GO,n),new BO(e)}function jO(){return(jO=lw(function*(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=yield t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}})).apply(this,arguments)}function ZO(){return YO.apply(this,arguments)}function YO(){return(YO=lw(function*(){if(Aw()||!Dw()||!xw())return!1;try{return yield Rw()}catch{return!1}})).apply(this,arguments)}const KO="@firebase/analytics";bb(new ib(hO,(e,{options:t})=>WO(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),bb(new ib("analytics-internal",function(e){try{const t=e.getProvider(hO).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=rb(e),function(e,t,n,r,i){return jO.apply(this,arguments)}(HO,UO[e.app.options.appId],t,n,r).catch(e=>gO.error(e))}(t,e,n,r)}}catch(t){throw bO.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),Nb(KO,"0.7.5"),Nb(KO,"0.7.5","esm2017");class JO extends a{constructor(e,t){super()}schedule(e,t=0){return this}}const QO={setInterval(...e){const{delegate:t}=QO;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=QO;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0};class XO extends JO{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return QO.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;QO.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,o(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const eT={now:()=>(eT.delegate||Date).now(),delegate:void 0};class tT{constructor(e,t=tT.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}tT.now=eT.now;class nT extends tT{constructor(e,t=tT.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}const rT=new class extends nT{}(class extends XO{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!=n&&n>0||null==n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}),iT=new nT(XO),sT=new fl("7.2.0"),oT="__angularfire_symbol__analyticsIsSupported",aT="__angularfire_symbol__remoteConfigIsSupported",cT="__angularfire_symbol__messagingIsSupported";function lT(e,t,n){if(t){if(1===t.length)return t[0];const e=t.filter(e=>e.app===n);if(1===e.length)return e[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[oT]||(globalThis[oT]=ZO().then(e=>globalThis.__angularfire_symbol__analyticsIsSupportedValue=e)),globalThis[cT]||(globalThis[cT]=lO().then(e=>globalThis.__angularfire_symbol__messagingIsSupportedValue=e)),globalThis[aT]||(globalThis[aT]=JS().then(e=>globalThis.__angularfire_symbol__remoteConfigIsSupportedValue=e));const uT=(e,t)=>{const n=t?[t]:Ab(),r=[];return n.forEach(t=>{t.container.getProvider(e).instances.forEach(e=>{r.includes(e)||r.push(e)})}),r};function hT(){}class dT{constructor(e,t=rT){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class fT{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",hT,{},hT,hT)),t.pipe(Em({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let pT=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new dT(Zone.current)),this.insideAngular=e.run(()=>new dT(Zone.current,iT)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(Or(nh))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function gT(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function mT(e){return gT().ngZone.runOutsideAngular(()=>e())}function yT(e){return gT().ngZone.run(()=>e())}function vT(e){return gT(),function(e){return function(t){return(t=t.lift(new fT(e.ngZone))).pipe(se(e.outsideAngular),ie(e.insideAngular))}}(gT())(e)}const _T=(e,t)=>{const n=void 0;return function(){return t&&setTimeout(()=>{"scheduled"===t.state&&t.invoke()},10),yT(()=>e.apply(n,arguments))}},CT=(e,t)=>function(){let n;for(let e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&(t&&(n||(n=yT(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",hT,{},hT,hT)))),arguments[e]=_T(arguments[e],n));const r=mT(()=>e.apply(this,arguments));if(!t){if(r instanceof T){const e=gT();return r.pipe(se(e.outsideAngular),ie(e.insideAngular))}return yT(()=>r)}return r instanceof T?r.pipe(vT):r instanceof Promise?yT(()=>new Promise((e,t)=>r.then(t=>yT(()=>e(t)),e=>yT(()=>t(e))))):"function"==typeof r&&n?function(){return setTimeout(()=>{n&&"scheduled"===n.state&&n.invoke()},10),r.apply(this,arguments)}:yT(()=>r)};class ET{constructor(e){return e}}class wT{constructor(){return Ab()}}const bT=new or("angularfire2._apps"),ST={provide:ET,useFactory:function(e){return e&&1===e.length?e[0]:new ET(kb())},deps:[[new Mr,bT]]},PT={provide:wT,deps:[[new Mr,bT]]};function OT(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new ET(r)}}let TT=(()=>{class e{constructor(e){Nb("angularfire",sT.full,"core"),Nb("angularfire",sT.full,"app"),Nb("angular",pl.full,e.toString())}}return e.\u0275fac=function(t){return new(t||e)(Or($u))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[ST,PT]}),e})();const IT=CT(Ib,!0),kT=new Map,AT={activated:!1,tokenObservers:[]},NT={initialized:!1,enabled:!1};function MT(e){return kT.get(e)||AT}function xT(e,t){kT.set(e,t)}function RT(){return NT}class DT{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return lw(function*(){t.stop();try{t.pending=new Ow,yield function(e){return new Promise(t=>{setTimeout(t,e)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new Ow,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(n){t.retryPolicy(n)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const LT=new Fw("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function FT(e){if(!MT(e).activated)throw LT.create("use-before-activation",{appName:e.name})}function BT(e,t){return UT.apply(this,arguments)}function UT(){return(UT=lw(function*({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=yield fetch(e,s)}catch(h){throw LT.create("fetch-network-error",{originalErrorMessage:h.message})}if(200!==o.status)throw LT.create("fetch-status-error",{httpStatus:o.status});try{a=yield o.json()}catch(h){throw LT.create("fetch-parse-error",{originalErrorMessage:h.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw LT.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=1e3*Number(c[1]),u=Date.now();return{token:a.attestationToken,expireTimeMillis:u+l,issuedAtTimeMillis:u}})).apply(this,arguments)}function VT(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}const $T="firebase-app-check-store";let zT=null;function HT(){return zT||(zT=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(LT.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore($T,{keyPath:"compositeKey"})}}}catch(n){t(LT.create("storage-open",{originalErrorMessage:n.message}))}}),zT)}function GT(){return(GT=lw(function*(e,t){const n=(yield HT()).transaction($T,"readwrite"),r=n.objectStore($T).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(LT.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})})).apply(this,arguments)}const qT=new pb("@firebase/app-check");function WT(e,t){return xw()?function(e,t){return function(e,t){return GT.apply(this,arguments)}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{qT.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function jT(){return RT().enabled}function ZT(){return YT.apply(this,arguments)}function YT(){return(YT=lw(function*(){const e=RT();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const KT={error:"UNKNOWN_ERROR"};function JT(e){return _w.encodeString(JSON.stringify(e),!1)}function QT(e){return XT.apply(this,arguments)}function XT(){return(XT=lw(function*(e,t=!1){const n=e.app;FT(n);const r=MT(n);let i,s=r.token;if(!s){const e=yield r.cachedTokenPromise;e&&rI(e)&&(s=e)}if(!t&&s&&rI(s))return{token:s.token};let o,a=!1;if(jT()){r.exchangeTokenPromise||(r.exchangeTokenPromise=BT(VT(n,yield ZT()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=yield r.exchangeTokenPromise;return yield WT(n,t),xT(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=yield r.exchangeTokenPromise}catch(c){"appCheck/throttled"===c.code?qT.warn(c.message):qT.error(c),i=c}return s?(o={token:s.token},xT(n,Object.assign(Object.assign({},r),{token:s})),yield WT(n,s)):o=iI(i),a&&nI(n,o),o})).apply(this,arguments)}function eI(e,t){const n=MT(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),xT(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function tI(e){const{app:t}=e,n=MT(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new DT(lw(function*(){let n;if(n=MT(t).token?yield QT(e,!0):yield QT(e),n.error)throw n.error}),()=>!0,()=>{const e=MT(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),xT(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function nI(e,t){const n=MT(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch{}}function rI(e){return e.expireTimeMillis-Date.now()>0}function iI(e){return{token:JT(KT),error:e}}class sI{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=MT(this.app);for(const t of e)eI(this.app,t.next);return Promise.resolve()}}const oI="app-check-internal";bb(new ib("app-check",e=>function(e,t){return new sI(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("platform-logger")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(oI).initialize()})),bb(new ib(oI,e=>function(e){return{getToken:t=>QT(e,t),addTokenListener:t=>function(e,t,n,r){const{app:i}=e,s=MT(i),o={next:n,error:r,type:t};if(xT(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&rI(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),tI(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>tI(e))}(e,"INTERNAL",t),removeTokenListener:t=>eI(e.app,t)}}(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),Nb("@firebase/app-check","0.5.3");class aI{constructor(){return uT("app-check")}}"undefined"!=typeof window&&window;const cI=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},lI=new Fw("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),uI=new pb("@firebase/auth");function hI(e,...t){uI.logLevel<=lb.ERROR&&uI.error(`Auth (9.6.6): ${e}`,...t)}function dI(e,...t){throw mI(e,...t)}function fI(e,...t){return mI(e,...t)}function pI(e,t,n){const r=Object.assign(Object.assign({},cI()),{[t]:n});return new Fw("auth","Firebase",r).create(t,{appName:e.name})}function gI(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&dI(e,"argument-error"),pI(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function mI(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return lI.create(e,...t)}function yI(e,t,...n){if(!e)throw mI(t,...n)}function vI(e){const t="INTERNAL ASSERTION FAILED: "+e;throw hI(t),new Error(t)}function _I(e,t){e||vI(t)}const CI=new Map;function EI(e){_I(e instanceof Function,"Expected a class definition");let t=CI.get(e);return t?(_I(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,CI.set(e,t),t)}function wI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function bI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class SI{constructor(e,t){this.shortDelay=e,this.longDelay=t,_I(t>e,"Short delay should be less than long delay!"),this.isMobile=kw()||Nw()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===bI()||"https:"===bI()||Aw()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function PI(e,t){_I(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class OI{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void vI("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void vI("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void vI("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const TI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},II=new SI(3e4,6e4);function kI(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function AI(e,t,n,r){return NI.apply(this,arguments)}function NI(){return(NI=lw(function*(e,t,n,r,i={}){return MI(e,i,lw(function*(){let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=Zw(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),OI.fetch()(LI(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))})).apply(this,arguments)}function MI(e,t,n){return xI.apply(this,arguments)}function xI(){return(xI=lw(function*(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},TI),t);try{const t=new FI(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw BI(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw BI(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw BI(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw pI(e,a,o);dI(e,a)}}catch(i){if(i instanceof Lw)throw i;dI(e,"network-request-failed")}})).apply(this,arguments)}function RI(e,t,n,r){return DI.apply(this,arguments)}function DI(){return(DI=lw(function*(e,t,n,r,i={}){const s=yield AI(e,t,n,r,i);return"mfaPendingCredential"in s&&dI(e,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function LI(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?PI(e.config,i):`${e.config.apiScheme}://${i}`}class FI{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(fI(this.auth,"network-request-failed")),II.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function BI(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=fI(e,t,r);return i.customData._tokenResponse=n,i}function UI(){return(UI=lw(function*(e,t){return AI(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function VI(e,t){return $I.apply(this,arguments)}function $I(){return($I=lw(function*(e,t){return AI(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function zI(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function HI(){return(HI=lw(function*(e,t=!1){const n=rb(e),r=yield n.getIdToken(t),i=qI(r);yI(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:zI(GI(i.auth_time)),issuedAtTime:zI(GI(i.iat)),expirationTime:zI(GI(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function GI(e){return 1e3*Number(e)}function qI(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return hI("JWT malformed, contained fewer than 3 sections"),null;try{const e=ww(n);return e?JSON.parse(e):(hI("Failed to decode base64 JWT payload"),null)}catch(i){return hI("Caught error parsing JWT payload as JSON",i),null}}function WI(e,t){return jI.apply(this,arguments)}function jI(){return(jI=lw(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(r){throw r instanceof Lw&&ZI(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})).apply(this,arguments)}function ZI({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class YI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(lw(function*(){yield t.iteration()}),n)}iteration(){var e=this;return lw(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&e.schedule(!0))}e.schedule()})()}}class KI{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zI(this.lastLoginAt),this.creationTime=zI(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function JI(e){return QI.apply(this,arguments)}function QI(){return(QI=lw(function*(e){var t;const n=e.auth,r=yield e.getIdToken(),i=yield WI(e,VI(n,{idToken:r}));yI(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?tk(s.providerUserInfo):[],a=ek(e.providerData,o),c=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new KI(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(e,l)})).apply(this,arguments)}function XI(){return(XI=lw(function*(e){const t=rb(e);yield JI(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function ek(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function tk(e){return e.map(e=>{var{providerId:t}=e,n=L(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function nk(){return(nk=lw(function*(e,t){const n=yield MI(e,{},lw(function*(){const n=Zw({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=LI(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",OI.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class rk{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){yI(e.idToken,"internal-error"),yI(void 0!==e.idToken,"internal-error"),yI(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=qI(e);return yI(t,"internal-error"),yI(void 0!==t.exp,"internal-error"),yI(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return lw(function*(){return yI(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return lw(function*(){const{accessToken:r,refreshToken:i,expiresIn:s}=yield function(e,t){return nk.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(r,i,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new rk;return n&&(yI("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(yI("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(yI("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rk,this.toJSON())}_performRefresh(){return vI("not implemented")}}function ik(e,t){yI("string"==typeof e||void 0===e,"internal-error",{appName:t})}class sk{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=L(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new YI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new KI(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){var t=this;return lw(function*(){const n=yield WI(t,t.stsTokenManager.getToken(t.auth,e));return yI(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return HI.apply(this,arguments)}(this,e)}reload(){return function(e){return XI.apply(this,arguments)}(this)}_assign(e){this!==e&&(yI(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new sk(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){yI(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return lw(function*(){let r=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield JI(n)),yield n.auth._persistUserIfCurrent(n),r&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return lw(function*(){const t=yield e.getIdToken();return yield WI(e,function(e,t){return UI.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:_,isAnonymous:C,providerData:E,stsTokenManager:w}=t;yI(v&&w,e,"internal-error");const b=rk.fromJSON(this.name,w);yI("string"==typeof v,e,"internal-error"),ik(u,e.name),ik(h,e.name),yI("boolean"==typeof _,e,"internal-error"),yI("boolean"==typeof C,e,"internal-error"),ik(d,e.name),ik(f,e.name),ik(p,e.name),ik(g,e.name),ik(m,e.name),ik(y,e.name);const S=new sk({uid:v,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:C,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:b,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(S.providerData=E.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static _fromIdTokenResponse(e,t,n=!1){return lw(function*(){const r=new rk;r.updateFromServerResponse(t);const i=new sk({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield JI(i),i})()}}const ok=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return lw(function*(){return!0})()}_set(e,t){var n=this;return lw(function*(){n.storage[e]=t})()}_get(e){var t=this;return lw(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return lw(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function ak(e,t,n){return`firebase:${e}:${t}:${n}`}class ck{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=ak(this.userKey,r.apiKey,i),this.fullPersistenceKey=ak("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return lw(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?sk._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return lw(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return lw(function*(){if(!t.length)return new ck(EI(ok),e,n);const r=(yield Promise.all(t.map(function(){var e=lw(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let i=r[0]||EI(ok);const s=ak(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){const r=sk._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&(yield i._set(s,o.toJSON())),yield Promise.all(t.map(function(){var e=lw(function*(e){if(e!==i)try{yield e._remove(s)}catch{}});return function(t){return e.apply(this,arguments)}}())),new ck(i,e,n)):new ck(i,e,n)})()}}function lk(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fk(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(uk(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(gk(t))return"Blackberry";if(mk(t))return"Webos";if(hk(t))return"Safari";if((t.includes("chrome/")||dk(t))&&!t.includes("edge/"))return"Chrome";if(pk(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function uk(e=Iw()){return/firefox\//i.test(e)}function hk(e=Iw()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function dk(e=Iw()){return/crios\//i.test(e)}function fk(e=Iw()){return/iemobile/i.test(e)}function pk(e=Iw()){return/android/i.test(e)}function gk(e=Iw()){return/blackberry/i.test(e)}function mk(e=Iw()){return/webos/i.test(e)}function yk(e=Iw()){return/iphone|ipad|ipod/i.test(e)}function vk(e=Iw()){return yk(e)||pk(e)||mk(e)||gk(e)||/windows phone/i.test(e)||fk(e)}function _k(e,t=[]){let n;switch(e){case"Browser":n=lk(Iw());break;case"Worker":n=`${lk(Iw())}-${e}`;break;default:n=e}return`${n}/JsCore/9.6.6/${t.length?t.join(","):"FirebaseCore-web"}`}class Ck{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wk(this),this.idTokenSubscription=new wk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=lI,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=EI(t)),this._initializationPromise=this.queue(lw(function*(){var r,i;if(!n._deleted&&(n.persistenceManager=yield ck.create(n,e),!n._deleted)){if(null===(r=n._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(i=n.currentUser)||void 0===i?void 0:i.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return lw(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t)}})()}initializeCurrentUser(e){var t=this;return lw(function*(){var n;let r=yield t.assertedPersistence.getCurrentUser();if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const i=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null==r?void 0:r._redirectEventId,o=yield t.tryRedirectSignIn(e);(!i||i===s)&&(null==o?void 0:o.user)&&(r=o.user)}return r?r._redirectEventId?(yI(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===r._redirectEventId?t.directlySetCurrentUser(r):t.reloadAndSetCurrentUserOrClear(r)):t.reloadAndSetCurrentUserOrClear(r):t.directlySetCurrentUser(null)})()}tryRedirectSignIn(e){var t=this;return lw(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return lw(function*(){try{yield JI(e)}catch(n){if("auth/network-request-failed"!==n.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return lw(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return lw(function*(){const n=e?rb(e):null;return n&&yI(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e){var t=this;return lw(function*(){if(!t._deleted)return e&&yI(t.tenantId===e.tenantId,t,"tenant-id-mismatch"),t.queue(lw(function*(){yield t.directlySetCurrentUser(e),t.notifyAuthListeners()}))})()}signOut(){var e=this;return lw(function*(){return(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null)})()}setPersistence(e){var t=this;return this.queue(lw(function*(){yield t.assertedPersistence.setPersistence(EI(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Fw("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return lw(function*(){const r=yield n.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return lw(function*(){if(!t.redirectPersistenceManager){const n=e&&EI(e)||t._popupRedirectResolver;yI(n,t,"argument-error"),t.redirectPersistenceManager=yield ck.create(t,[EI(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return lw(function*(){var n,r;return t._isInitialized&&(yield t.queue(lw(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return lw(function*(){if(e===t.currentUser)return t.queue(lw(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return yI(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return lw(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return yI(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_k(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return lw(function*(){const t={"X-Client-Version":e.clientVersion};return e.app.options.appId&&(t["X-Firebase-gmpid"]=e.app.options.appId),t})()}}function Ek(e){return rb(e)}class wk{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Qw(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return yI(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function bk(e,t,n){const r=Ek(e);yI(r._canInitEmulator,r,"emulator-config-failed"),yI(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Sk(t),{host:o,port:a}=function(e){const t=Sk(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Pk(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Pk(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Sk(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Pk(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ok{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return vI("not implemented")}_getIdTokenResponse(e){return vI("not implemented")}_linkToIdToken(e,t){return vI("not implemented")}_getReauthenticationResolver(e){return vI("not implemented")}}function Tk(){return(Tk=lw(function*(e,t){return AI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Ik(){return(Ik=lw(function*(e,t){return RI(e,"POST","/v1/accounts:signInWithPassword",kI(e,t))})).apply(this,arguments)}function kk(e,t){return Ak.apply(this,arguments)}function Ak(){return(Ak=lw(function*(e,t){return AI(e,"POST","/v1/accounts:sendOobCode",kI(e,t))})).apply(this,arguments)}function Nk(e,t){return Mk.apply(this,arguments)}function Mk(){return(Mk=lw(function*(e,t){return kk(e,t)})).apply(this,arguments)}function xk(e,t){return Rk.apply(this,arguments)}function Rk(){return(Rk=lw(function*(e,t){return kk(e,t)})).apply(this,arguments)}function Dk(){return(Dk=lw(function*(e,t){return RI(e,"POST","/v1/accounts:signInWithEmailLink",kI(e,t))})).apply(this,arguments)}function Lk(){return(Lk=lw(function*(e,t){return RI(e,"POST","/v1/accounts:signInWithEmailLink",kI(e,t))})).apply(this,arguments)}class Fk extends Ok{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Fk(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Fk(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return lw(function*(){switch(t.signInMethod){case"password":return function(e,t){return Ik.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return Dk.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:dI(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return lw(function*(){switch(n.signInMethod){case"password":return function(e,t){return Tk.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return Lk.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:dI(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function Bk(e,t){return Uk.apply(this,arguments)}function Uk(){return(Uk=lw(function*(e,t){return RI(e,"POST","/v1/accounts:signInWithIdp",kI(e,t))})).apply(this,arguments)}class Vk extends Ok{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Vk(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):dI("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=L(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Vk(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Bk(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Bk(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Bk(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Zw(t)}return e}}class $k{constructor(e){var t,n,r,i,s,o;const a=Yw(Kw(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);yI(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Yw(Kw(e)).link,n=t?Yw(Kw(t)).deep_link_id:null,r=Yw(Kw(e)).deep_link_id;return(r?Yw(Kw(r)).link:null)||r||n||t||e}(e);try{return new $k(t)}catch{return null}}}let zk=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Fk._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=$k.parseLink(t);return yI(n,"argument-error"),Fk._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class Hk{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Gk extends Hk{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let qk=(()=>{class e extends Gk{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Vk._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})();function Wk(e,t){return jk.apply(this,arguments)}function jk(){return(jk=lw(function*(e,t){return RI(e,"POST","/v1/accounts:signUp",kI(e,t))})).apply(this,arguments)}class Zk{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return lw(function*(){const i=yield sk._fromIdTokenResponse(e,n,r),s=Yk(n);return new Zk({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return lw(function*(){yield e._updateTokensIfNecessary(n,!0);const r=Yk(n);return new Zk({user:e,providerId:r,_tokenResponse:n,operationType:t})})()}}function Yk(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Kk extends Lw{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Kk.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Kk(e,t,n,r)}}function Jk(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw"auth/multi-factor-auth-required"===n.code?Kk._fromErrorAndOperation(e,n,t,r):n})}function Qk(e,t){return Xk.apply(this,arguments)}function Xk(){return(Xk=lw(function*(e,t,n=!1){const r=yield WI(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return Zk._forOperation(e,"link",r)})).apply(this,arguments)}function eA(){return(eA=lw(function*(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=yield WI(e,Jk(r,i,t,e),n);yI(s.idToken,r,"internal-error");const o=qI(s.idToken);yI(o,r,"internal-error");const{sub:a}=o;return yI(e.uid===a,r,"user-mismatch"),Zk._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&dI(r,"user-mismatch"),s}})).apply(this,arguments)}function tA(e,t){return nA.apply(this,arguments)}function nA(){return(nA=lw(function*(e,t,n=!1){const r="signIn",i=yield Jk(e,r,t),s=yield Zk._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function rA(){return(rA=lw(function*(e,t){return tA(Ek(e),t)})).apply(this,arguments)}function iA(e,t,n){var r;yI((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),yI(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(yI(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(yI(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function sA(e,t,n){return oA.apply(this,arguments)}function oA(){return(oA=lw(function*(e,t,n){const r=rb(e),i={requestType:"PASSWORD_RESET",email:t};n&&iA(r,i,n),yield xk(r,i)})).apply(this,arguments)}function aA(e,t,n){return cA.apply(this,arguments)}function cA(){return(cA=lw(function*(e,t,n){const r=Ek(e),i=yield Wk(r,{returnSecureToken:!0,email:t,password:n}),s=yield Zk._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(s.user),s})).apply(this,arguments)}function lA(e,t,n){return function(e,t){return rA.apply(this,arguments)}(rb(e),zk.credential(t,n))}function uA(e,t){return hA.apply(this,arguments)}function hA(){return(hA=lw(function*(e,t){const n=rb(e),r={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&iA(n.auth,r,t);const{email:i}=yield Nk(n.auth,r);i!==e.email&&(yield e.reload())})).apply(this,arguments)}function dA(e,t){return fA.apply(this,arguments)}function fA(){return(fA=lw(function*(e,t){return AI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function pA(e,t){return gA.apply(this,arguments)}function gA(){return(gA=lw(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=rb(e),i={idToken:yield r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield WI(r,dA(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),yield r._updateTokensIfNecessary(s)})).apply(this,arguments)}function mA(e,t,n,r){return rb(e).onAuthStateChanged(t,n,r)}new WeakMap;const yA="__sak";class vA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yA,"1"),this.storage.removeItem(yA),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const _A=(()=>{class e extends vA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Iw();return hk(e)||yk(e)}()&&function(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=vk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Mw()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return lw(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return lw(function*(){const r=yield t().call(n,e);return n.localCache[e]=JSON.stringify(r),r})()}_remove(e){var t=()=>super._remove,n=this;return lw(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),CA=(()=>{class e extends vA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let EA=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return lw(function*(){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=t.handlersMap[i];if(!(null==o?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(function(){var e=lw(function*(e){return e(n.origin,s)});return function(t){return e.apply(this,arguments)}}()),c=yield function(e){return Promise.all(e.map(function(){var e=lw(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function wA(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class bA{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return lw(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const l=wA("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function SA(){return window}function PA(){return void 0!==SA().WorkerGlobalScope&&"function"==typeof SA().importScripts}function OA(){return(OA=lw(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const TA="firebaseLocalStorageDb",IA="firebaseLocalStorage",kA="fbase_key";class AA{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function NA(e,t){return e.transaction([IA],t?"readwrite":"readonly").objectStore(IA)}function MA(){const e=indexedDB.open(TA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(IA,{keyPath:kA})}catch(r){n(r)}}),e.addEventListener("success",lw(function*(){const n=e.result;n.objectStoreNames.contains(IA)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(TA);return new AA(e).toPromise()}(),t(yield MA()))}))})}function xA(e,t,n){return RA.apply(this,arguments)}function RA(){return(RA=lw(function*(e,t,n){const r=NA(e,!0).put({[kA]:t,value:n});return new AA(r).toPromise()})).apply(this,arguments)}function DA(){return(DA=lw(function*(e,t){const n=NA(e,!1).get(t),r=yield new AA(n).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function LA(e,t){const n=NA(e,!0).delete(t);return new AA(n).toPromise()}const FA=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return lw(function*(){return e.db||(e.db=yield MA()),e.db})()}_withRetries(e){var t=this;return lw(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(r){if(n++>3)throw r;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return lw(function*(){return PA()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return lw(function*(){e.receiver=EA._getInstance(PA()?self:null),e.receiver._subscribe("keyChanged",function(){var t=lw(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=lw(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return lw(function*(){var t,n;if(e.activeServiceWorker=yield function(){return OA.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new bA(e.activeServiceWorker);const r=yield e.sender._send("ping",{},800);!r||(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return lw(function*(){if(t.sender&&t.activeServiceWorker&&function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return lw(function*(){try{if(!indexedDB)return!1;const e=yield MA();return yield xA(e,yA,"1"),yield LA(e,yA),!0}catch{}return!1})()}_withPendingWrite(e){var t=this;return lw(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return lw(function*(){return n._withPendingWrite(lw(function*(){return yield n._withRetries(n=>xA(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return lw(function*(){const n=yield t._withRetries(t=>function(e,t){return DA.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return lw(function*(){return t._withPendingWrite(lw(function*(){return yield t._withRetries(t=>LA(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return lw(function*(){const t=yield e._withRetries(e=>{const t=NA(e,!1).getAll();return new AA(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of t)r.add(i),JSON.stringify(e.localCache[i])!==JSON.stringify(s)&&(e.notifyListeners(i,s),n.push(i));for(const i of Object.keys(e.localCache))e.localCache[i]&&!r.has(i)&&(e.notifyListeners(i,null),n.push(i));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval(lw(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function BA(e){return`__${e}${Math.floor(1e6*Math.random())}`}function UA(e,t){return t?EI(t):(yI(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}BA("rcb"),new SI(3e4,6e4);class VA extends Ok{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bk(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Bk(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Bk(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function $A(e){return tA(e.auth,new VA(e),e.bypassAuthState)}function zA(e){const{auth:t,user:n}=e;return yI(n,t,"internal-error"),function(e,t){return eA.apply(this,arguments)}(n,new VA(e),e.bypassAuthState)}function HA(e){return GA.apply(this,arguments)}function GA(){return(GA=lw(function*(e){const{auth:t,user:n}=e;return yI(n,t,"internal-error"),Qk(n,new VA(e),e.bypassAuthState)})).apply(this,arguments)}class qA{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=lw(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(r){e.reject(r)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return lw(function*(){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const c={auth:t.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(c))}catch(l){t.reject(l)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $A;case"linkViaPopup":case"linkViaRedirect":return HA;case"reauthViaPopup":case"reauthViaRedirect":return zA;default:dI(this.auth,"internal-error")}}resolve(e){_I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const WA=new SI(2e3,1e4);function jA(e,t,n){return ZA.apply(this,arguments)}function ZA(){return(ZA=lw(function*(e,t,n){const r=Ek(e);gI(e,t,Hk);const i=UA(r,n);return new YA(r,"signInViaPopup",t,i).executeNotNull()})).apply(this,arguments)}let YA=(()=>{class e extends qA{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return lw(function*(){const t=yield e.execute();return yI(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return lw(function*(){_I(1===e.filter.length,"Popup operations only handle one event");const t=wA();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(fI(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(fI(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(fI(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,WA.get())};e()}}return e.currentPopupAction=null,e})();const KA=new Map;class JA extends qA{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return lw(function*(){let n=KA.get(t.auth._key());if(!n){try{const r=(yield function(e,t){return QA.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(r)}catch(r){n=()=>Promise.reject(r)}KA.set(t.auth._key(),n)}return t.bypassAuthState||KA.set(t.auth._key(),()=>Promise.resolve(null)),n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return lw(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const r=yield n.auth._redirectUserForId(e.eventId);if(r)return n.user=r,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return lw(function*(){})()}cleanUp(){}}function QA(){return(QA=lw(function*(e,t){const n=eN(t),r=XA(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})).apply(this,arguments)}function XA(e){return EI(e._redirectPersistence)}function eN(e){return ak("pendingRedirect",e.config.apiKey,e.name)}function tN(e,t){return nN.apply(this,arguments)}function nN(){return(nN=lw(function*(e,t,n=!1){const r=Ek(e),i=UA(r,t),s=yield new JA(r,i,n).execute();return s&&!n&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})).apply(this,arguments)}class rN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sN(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!sN(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(fI(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(iN(e))}saveEventToCache(e){this.cachedEventUids.add(iN(e)),this.lastProcessedEventTime=Date.now()}}function iN(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function sN({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function oN(e){return aN.apply(this,arguments)}function aN(){return(aN=lw(function*(e,t={}){return AI(e,"GET","/v1/projects",t)})).apply(this,arguments)}const cN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lN=/^https?/;function uN(){return(uN=lw(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield oN(e);for(const n of t)try{if(hN(n))return}catch{}dI(e,"unauthorized-domain")})).apply(this,arguments)}function hN(e){const t=wI(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!lN.test(n))return!1;if(cN.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const dN=new SI(3e4,6e4);function fN(){const e=SA().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let pN=null;function gN(e){return pN=pN||function(e){return new Promise((t,n)=>{var r,i,s;function o(){fN(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{fN(),n(fI(e,"network-request-failed"))},timeout:dN.get()})}if(null===(i=null===(r=SA().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=SA().gapi)||void 0===s?void 0:s.load)){const t=BA("iframefcb");return SA()[t]=()=>{gapi.load?o():n(fI(e,"network-request-failed"))},function(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=fI("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw pN=null,e})}(e),pN}const mN=new SI(5e3,15e3),yN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _N(e){const t=e.config;yI(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?PI(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Tb},i=vN.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Zw(r).slice(1)}`}function CN(){return(CN=lw(function*(e){const t=yield gN(e),n=SA().gapi;return yI(n,e,"internal-error"),t.open({where:document.body,url:_N(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yN,dontclear:!0},t=>new Promise(function(){var n=lw(function*(n,r){yield t.restyle({setHideOnLeave:!1});const i=fI(e,"network-request-failed"),s=SA().setTimeout(()=>{r(i)},mN.get());function o(){SA().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const EN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class wN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function bN(e,t,n,r,i,s){yI(e.config.authDomain,e,"auth-domain-config-required"),yI(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Tb,eventId:i};if(t instanceof Hk){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Gw(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Gk){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const c of Object.keys(a))void 0===a[c]&&delete a[c];return`${function({config:e}){return e.emulator?PI(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Zw(a).slice(1)}`}const SN="webStorageSupport",PN=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=CA,this._completeRedirectFn=tN}_openPopup(e,t,n,r){var i=this;return lw(function*(){var s;_I(null===(s=i.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");const o=bN(e,t,n,wI(),r);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},EN),{width:r.toString(),height:i.toString(),top:s,left:o}),l=Iw().toLowerCase();n&&(a=dk(l)?"_blank":n),uk(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=Iw()){var t;return yk(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new wN(null);const h=window.open(t||"",a,u);yI(h,e,"popup-blocked");try{h.focus()}catch{}return new wN(h)}(e,o,wA())})()}_openRedirect(e,t,n,r){var i=this;return lw(function*(){return yield i._originValidation(e),function(e){SA().location.href=e}(bN(e,t,n,wI(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(_I(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){var t=this;return lw(function*(){const n=yield function(e){return CN.apply(this,arguments)}(e),r=new rN(e);return n.register("authEvent",t=>(yI(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=n,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(SN,{type:SN},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[SN];void 0!==i&&t(!!i),dI(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return uN.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return vk()||hk()||yk()}};var ON="@firebase/auth";class TN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return lw(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){yI(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function IN(e=kb()){const t=Sb(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=Sb(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Ww(n.getOptions(),t??{}))return e;dI(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:PN,persistence:[FA,_A,CA]})}!function(e){bb(new ib("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),{apiKey:i,authDomain:s}=r.options;return(t=>{yI(i&&!i.includes(":"),"invalid-api-key",{appName:t.name}),yI(!(null==s?void 0:s.includes(":")),"argument-error",{appName:t.name});const r={apiKey:i,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_k(e)},o=new Ck(t,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(EI);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,n),o})(r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),bb(new ib("auth-internal",e=>{const t=Ek(e.getProvider("auth").getImmediate());return new TN(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Nb(ON,"0.19.8",void 0),Nb(ON,"0.19.8","esm2017")}("Browser");class kN{constructor(e){return e}}class AN{constructor(){return uT("auth")}}const NN=new or("angularfire2.auth-instances");function MN(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new kN(r)}}const xN={provide:AN,deps:[[new Mr,NN]]},RN={provide:kN,useFactory:function(e,t){const n=lT("auth",e,t);return n&&new kN(n)},deps:[[new Mr,NN],ET]};let DN=(()=>{class e{constructor(){Nb("angularfire",sT.full,"auth")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[RN,xN]}),e})();const LN=CT(bk,!0),FN=CT(aA,!0),BN=CT(IN,!0),UN=CT(mA,!0),VN=CT(uA,!0),$N=CT(sA,!0),zN=CT(lA,!0),HN=CT(jA,!0),GN=CT(pA,!0);var qN,WN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jN={},ZN=ZN||{},YN=WN||self;function KN(){}function JN(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function QN(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var XN="closure_uid_"+(1e9*Math.random()>>>0),eM=0;function tM(e,t,n){return e.call.apply(e.bind,arguments)}function nM(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function rM(e,t,n){return(rM=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?tM:nM).apply(null,arguments)}function iM(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function sM(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function oM(){this.s=this.s,this.o=this.o}var aM={};oM.prototype.s=!1,oM.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,XN)&&e[XN]||(e[XN]=++eM)}(this);delete aM[e]}},oM.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const cM=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},lM=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function uM(e){return Array.prototype.concat.apply([],arguments)}function hM(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function dM(e){return/^[\s\xa0]*$/.test(e)}var fM,pM=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function gM(e,t){return-1!=e.indexOf(t)}function mM(e,t){return e<t?-1:e>t?1:0}e:{var yM=YN.navigator;if(yM){var vM=yM.userAgent;if(vM){fM=vM;break e}}fM=""}function _M(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function CM(e){const t={};for(const n in e)t[n]=e[n];return t}var EM="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wM(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<EM.length;t++)n=EM[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function bM(e){return bM[" "](e),e}bM[" "]=KN;var SM,PM=gM(fM,"Opera"),OM=gM(fM,"Trident")||gM(fM,"MSIE"),TM=gM(fM,"Edge"),IM=TM||OM,kM=gM(fM,"Gecko")&&!(gM(fM.toLowerCase(),"webkit")&&!gM(fM,"Edge"))&&!(gM(fM,"Trident")||gM(fM,"MSIE"))&&!gM(fM,"Edge"),AM=gM(fM.toLowerCase(),"webkit")&&!gM(fM,"Edge");function NM(){var e=YN.document;return e?e.documentMode:void 0}e:{var MM="",xM=function(){var e=fM;return kM?/rv:([^\);]+)(\)|;)/.exec(e):TM?/Edge\/([\d\.]+)/.exec(e):OM?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):AM?/WebKit\/(\S+)/.exec(e):PM?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(xM&&(MM=xM?xM[1]:""),OM){var RM=NM();if(null!=RM&&RM>parseFloat(MM)){SM=String(RM);break e}}SM=MM}var DM={};function LM(){return e=DM,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=pM(String(SM)).split("."),n=pM("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=mM(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||mM(0==i[2].length,0==s[2].length)||mM(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}var FM=YN.document&&OM&&(NM()||parseInt(SM,10))||void 0,BM=function(){if(!YN.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{YN.addEventListener("test",KN,t),YN.removeEventListener("test",KN,t)}catch{}return e}();function UM(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function VM(e,t){if(UM.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(kM){e:{try{bM(t.nodeName);var i=!0;break e}catch{}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&VM.Z.h.call(this)}}UM.prototype.h=function(){this.defaultPrevented=!0},sM(VM,UM);var $M={2:"touch",3:"pen",4:"mouse"};VM.prototype.h=function(){VM.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var zM="closure_listenable_"+(1e6*Math.random()|0),HM=0;function GM(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++HM,this.ca=this.fa=!1}function qM(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function WM(e){this.src=e,this.g={},this.h=0}function jM(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=cM(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(qM(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ZM(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}WM.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ZM(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new GM(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var YM="closure_lm_"+(1e6*Math.random()|0),KM={};function JM(e,t,n,r,i){if(r&&r.once)return XM(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)JM(e,t[s],n,r,i);return null}return n=ox(n),e&&e[zM]?e.N(t,n,QN(r)?!!r.capture:!!r,i):QM(e,t,n,!1,r,i)}function QM(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=QN(i)?!!i.capture:!!i,a=ix(e);if(a||(e[YM]=a=new WM(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=rx;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)BM||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(nx(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function XM(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)XM(e,t[s],n,r,i);return null}return n=ox(n),e&&e[zM]?e.O(t,n,QN(r)?!!r.capture:!!r,i):QM(e,t,n,!0,r,i)}function ex(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ex(e,t[s],n,r,i);else r=QN(r)?!!r.capture:!!r,n=ox(n),e&&e[zM]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=ZM(s=e.g[t],n,r,i))&&(qM(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ix(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ZM(t,n,r,i)),(n=-1<e?t[e]:null)&&tx(n))}function tx(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[zM])jM(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(nx(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ix(t))?(jM(n,e),0==n.h&&(n.src=null,t[YM]=null)):qM(e)}}}function nx(e){return e in KM?KM[e]:KM[e]="on"+e}function rx(e,t){if(e.ca)e=!0;else{t=new VM(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&tx(e),e=n.call(r,t)}return e}function ix(e){return(e=e[YM])instanceof WM?e:null}var sx="__closure_events_fn_"+(1e9*Math.random()>>>0);function ox(e){return"function"==typeof e?e:(e[sx]||(e[sx]=function(t){return e.handleEvent(t)}),e[sx])}function ax(){oM.call(this),this.i=new WM(this),this.P=this,this.I=null}function cx(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new UM(t,e);else if(t instanceof UM)t.target=t.target||e;else{var i=t;wM(t=new UM(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=lx(o,r,!0,t)&&i}if(i=lx(o=t.g=e,r,!0,t)&&i,i=lx(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=lx(o=t.g=n[s],r,!1,t)&&i}function lx(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&jM(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}sM(ax,oM),ax.prototype[zM]=!0,ax.prototype.removeEventListener=function(e,t,n,r){ex(this,e,t,n,r)},ax.prototype.M=function(){if(ax.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)qM(n[r]);delete t.g[e],t.h--}}this.I=null},ax.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ax.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ux=YN.JSON.stringify;function hx(){var e=vx;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var dx,fx=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new px,e=>e.reset());class px{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function gx(e){YN.setTimeout(()=>{throw e},0)}function mx(e,t){dx||function(){var e=YN.Promise.resolve(void 0);dx=function(){e.then(_x)}}(),yx||(dx(),yx=!0),vx.add(e,t)}var yx=!1,vx=new class{constructor(){this.h=this.g=null}add(e,t){const n=fx.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function _x(){for(var e;e=hx();){try{e.h.call(e.g)}catch(n){gx(n)}var t=fx;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}yx=!1}function Cx(e,t){ax.call(this),this.h=e||1,this.g=t||YN,this.j=rM(this.kb,this),this.l=Date.now()}function Ex(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function wx(e,t,n){if("function"==typeof e)n&&(e=rM(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=rM(e.handleEvent,e)}return 2147483647<Number(t)?-1:YN.setTimeout(e,t||0)}function bx(e){e.g=wx(()=>{e.g=null,e.i&&(e.i=!1,bx(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}sM(Cx,ax),(qN=Cx.prototype).da=!1,qN.S=null,qN.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),cx(this,"tick"),this.da&&(Ex(this),this.start()))}},qN.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},qN.M=function(){Cx.Z.M.call(this),Ex(this),delete this.g};class Sx extends oM{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:bx(this)}M(){super.M(),this.g&&(YN.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Px(e){oM.call(this),this.h=e,this.g={}}sM(Px,oM);var Ox=[];function Tx(e,t,n,r){Array.isArray(n)||(n&&(Ox[0]=n.toString()),n=Ox);for(var i=0;i<n.length;i++){var s=JM(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ix(e){_M(e.g,function(e,t){this.g.hasOwnProperty(t)&&tx(e)},e),e.g={}}function kx(){this.g=!0}function Ax(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ux(n)}catch{return t}}(e,n)+(r?" "+r:"")})}Px.prototype.M=function(){Px.Z.M.call(this),Ix(this)},Px.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},kx.prototype.Aa=function(){this.g=!1},kx.prototype.info=function(){};var Nx={},Mx=null;function xx(){return Mx=Mx||new ax}function Rx(e){UM.call(this,Nx.Ma,e)}function Dx(e){const t=xx();cx(t,new Rx(t,e))}function Lx(e,t){UM.call(this,Nx.STAT_EVENT,e),this.stat=t}function Fx(e){const t=xx();cx(t,new Lx(t,e))}function Bx(e,t){UM.call(this,Nx.Na,e),this.size=t}function Ux(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return YN.setTimeout(function(){e()},t)}Nx.Ma="serverreachability",sM(Rx,UM),Nx.STAT_EVENT="statevent",sM(Lx,UM),Nx.Na="timingevent",sM(Bx,UM);var Vx={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$x={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function zx(){}function Hx(){}zx.prototype.h=null;var Gx,qx={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Wx(){UM.call(this,"d")}function jx(){UM.call(this,"c")}function Zx(){}function Yx(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Px(this),this.P=Jx,this.W=new Cx(e=IM?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Kx}function Kx(){this.i=null,this.g="",this.h=!1}sM(Wx,UM),sM(jx,UM),sM(Zx,zx),Zx.prototype.g=function(){return new XMLHttpRequest},Zx.prototype.i=function(){return{}},Gx=new Zx;var Jx=45e3,Qx={},Xx={};function eR(e,t,n){e.K=1,e.v=bR(yR(t)),e.s=n,e.U=!0,tR(e,null)}function tR(e,t){e.F=Date.now(),sR(e),e.A=yR(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),LR(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Kx,e.g=LD(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Sx(rM(e.Ia,e,e.g),e.O)),Tx(e.V,e.g,"readystatechange",e.gb),t=e.H?CM(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Dx(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function nR(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function rR(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=iR(e,n),r==Xx){4==t&&(e.o=4,Fx(14),i=!1),Ax(e.j,e.m,null,"[Incomplete Response]");break}if(r==Qx){e.o=4,Fx(15),Ax(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ax(e.j,e.m,r,null),uR(e,r)}nR(e)&&r!=Xx&&r!=Qx&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Fx(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ID(t),t.L=!0,Fx(11))):(Ax(e.j,e.m,n,"[Invalid Chunked Response]"),lR(e),cR(e))}function iR(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Xx:(n=Number(t.substring(n,r)),isNaN(n)?Qx:(r+=1)+n>t.length?Xx:(t=t.substr(r,n),e.C=r+n,t))}function sR(e){e.Y=Date.now()+e.P,oR(e,e.P)}function oR(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ux(rM(e.eb,e),t)}function aR(e){e.B&&(YN.clearTimeout(e.B),e.B=null)}function cR(e){0==e.l.G||e.I||ND(e.l,e)}function lR(e){aR(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ex(e.W),Ix(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function uR(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||zR(n.i,e)))if(n.I=e.N,!e.J&&zR(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ux(rM(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;AD(n),_D(n)}TD(n),Fx(18)}if(1>=$R(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else xD(n,11)}else if((e.J||n.g==e)&&AD(n),!dM(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.U=l[0],l=l[1],2==n.G)if("c"==l[0]){n.J=l[1],n.la=l[2];const t=l[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=l[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(gM(e,"spdy")||gM(e,"quic")||gM(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(HR(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,wR(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=DD(r,r.H?r.la:null,r.W),o.J){GR(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(aR(a),sR(a)),r.g=o}else OD(r);0<n.l.length&&wD(n)}else"stop"!=l[0]&&"close"!=l[0]||xD(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?xD(n,7):vD(n):"noop"!=l[0]&&n.j&&n.j.wa(l),n.A=0)}Dx(4)}catch{}}function hR(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(JN(e)||"string"==typeof e)lM(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(JN(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(JN(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function dR(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof dR)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function fR(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];pR(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)pR(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function pR(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(qN=Yx.prototype).setTimeout=function(e){this.P=e},qN.gb=function(e){e=e.target;const t=this.L;t&&3==fD(e)?t.l():this.Ia(e)},qN.Ia=function(e){try{if(e==this.g)e:{const u=fD(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>u)&&(3!=u||IM||this.g&&(this.h.h||this.g.ga()||pD(this.g)))){this.I||4!=u||7==t||Dx(8==t||0>=h?3:2),aR(this);var n=this.g.ba();this.N=n;t:if(nR(this)){var r=pD(this.g);e="";var i=r.length,s=4==fD(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){lR(this),cR(this);var o="";break t}this.h.i=new YN.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dM(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,Fx(12),lR(this),cR(this);break e}Ax(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,uR(this,n)}this.U?(rR(this,u,o),IM&&this.i&&3==u&&(Tx(this.V,this.W,"tick",this.fb),this.W.start())):(Ax(this.j,this.m,o,null),uR(this,o)),4==u&&lR(this),this.i&&!this.I&&(4==u?ND(this.l,this):(this.i=!1,sR(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Fx(12)):(this.o=0,Fx(13)),lR(this),cR(this)}}}catch{}},qN.fb=function(){if(this.g){var e=fD(this.g),t=this.g.ga();this.C<t.length&&(aR(this),rR(this,e,t),this.i&&4!=e&&sR(this))}},qN.cancel=function(){this.I=!0,lR(this)},qN.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(Dx(3),Fx(17)),lR(this),this.o=2,cR(this)):oR(this,this.Y-e)},(qN=dR.prototype).R=function(){fR(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},qN.T=function(){return fR(this),this.g.concat()},qN.get=function(e,t){return pR(this.h,e)?this.h[e]:t},qN.set=function(e,t){pR(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},qN.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var gR=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function mR(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof mR){this.g=void 0!==t?t:e.g,vR(this,e.j),this.s=e.s,_R(this,e.i),CR(this,e.m),this.l=e.l,t=e.h;var n=new MR;n.i=t.i,t.g&&(n.g=new dR(t.g),n.h=t.h),ER(this,n),this.o=e.o}else e&&(n=String(e).match(gR))?(this.g=!!t,vR(this,n[1]||"",!0),this.s=SR(n[2]||""),_R(this,n[3]||"",!0),CR(this,n[4]),this.l=SR(n[5]||"",!0),ER(this,n[6]||"",!0),this.o=SR(n[7]||"")):(this.g=!!t,this.h=new MR(null,this.g))}function yR(e){return new mR(e)}function vR(e,t,n){e.j=n?SR(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function _R(e,t,n){e.i=n?SR(t,!0):t}function CR(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ER(e,t,n){t instanceof MR?(e.h=t,function(e,t){t&&!e.j&&(xR(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(RR(this,t),LR(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=PR(t,AR)),e.h=new MR(t,e.g))}function wR(e,t,n){e.h.set(t,n)}function bR(e){return wR(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function SR(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function PR(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,OR),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function OR(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mR.prototype.toString=function(){var e=[],t=this.j;t&&e.push(PR(t,TR,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(PR(t,TR,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(PR(n,"/"==n.charAt(0)?kR:IR,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",PR(n,NR)),e.join("")};var TR=/[#\/\?@]/g,IR=/[#\?:]/g,kR=/[#\?]/g,AR=/[#\?@]/g,NR=/#/g;function MR(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function xR(e){e.g||(e.g=new dR,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function RR(e,t){xR(e),t=FR(e,t),pR(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,pR((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&fR(e)))}function DR(e,t){return xR(e),t=FR(e,t),pR(e.g.h,t)}function LR(e,t,n){RR(e,t),0<n.length&&(e.i=null,e.g.set(FR(e,t),hM(n)),e.h+=n.length)}function FR(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function BR(e){this.l=e||UR,e=YN.PerformanceNavigationTiming?0<(e=YN.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(YN.g&&YN.g.Ea&&YN.g.Ea()&&YN.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(qN=MR.prototype).add=function(e,t){xR(this),this.i=null,e=FR(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},qN.forEach=function(e,t){xR(this),this.g.forEach(function(n,r){lM(n,function(n){e.call(t,n,r,this)},this)},this)},qN.T=function(){xR(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},qN.R=function(e){xR(this);var t=[];if("string"==typeof e)DR(this,e)&&(t=uM(t,this.g.get(FR(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=uM(t,e[n])}return t},qN.set=function(e,t){return xR(this),this.i=null,DR(this,e=FR(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},qN.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},qN.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var UR=10;function VR(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $R(e){return e.h?1:e.g?e.g.size:0}function zR(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function HR(e,t){e.g?e.g.add(t):e.h=t}function GR(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function qR(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return hM(e.i)}function WR(){}function jR(){this.g=new WR}function ZR(e,t,n){const r=n||"";try{hR(e,function(e,n){let i=e;QN(e)&&(i=ux(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function YR(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function KR(e){this.l=e.$b||null,this.j=e.ib||!1}function JR(e,t){ax.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=QR,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}BR.prototype.cancel=function(){if(this.i=qR(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},WR.prototype.stringify=function(e){return YN.JSON.stringify(e,void 0)},WR.prototype.parse=function(e){return YN.JSON.parse(e,void 0)},sM(KR,zx),KR.prototype.g=function(){return new JR(this.l,this.j)},KR.prototype.i=function(e){return function(){return e}}({}),sM(JR,ax);var QR=0;function XR(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function eD(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tD(e)}function tD(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(qN=JR.prototype).open=function(e,t){if(this.readyState!=QR)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tD(this)},qN.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||YN).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},qN.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,eD(this)),this.readyState=QR},qN.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tD(this)),this.g&&(this.readyState=3,tD(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==YN.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;XR(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},qN.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?eD(this):tD(this),3==this.readyState&&XR(this)}},qN.Ua=function(e){this.g&&(this.response=this.responseText=e,eD(this))},qN.Ta=function(e){this.g&&(this.response=e,eD(this))},qN.ha=function(){this.g&&eD(this)},qN.setRequestHeader=function(e,t){this.v.append(e,t)},qN.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},qN.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(JR.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var nD=YN.JSON.parse;function rD(e){ax.call(this),this.headers=new dR,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=iD,this.K=this.L=!1}sM(rD,ax);var iD="",sD=/^https?$/i,oD=["POST","PUT"];function aD(e){return"content-type"==e.toLowerCase()}function cD(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,lD(e),hD(e)}function lD(e){e.D||(e.D=!0,cx(e,"complete"),cx(e,"error"))}function uD(e){if(e.h&&void 0!==ZN&&(!e.C[1]||4!=fD(e)||2!=e.ba()))if(e.v&&4==fD(e))wx(e.Fa,0,e);else if(cx(e,"readystatechange"),4==fD(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(gR)[1]||null;if(!i&&YN.self&&YN.self.location){var s=YN.self.location.protocol;i=s.substr(0,s.length-1)}r=!sD.test(i?i.toLowerCase():"")}n=r}if(n)cx(e,"complete"),cx(e,"success");else{e.m=6;try{var o=2<fD(e)?e.g.statusText:""}catch{o=""}e.j=o+" ["+e.ba()+"]",lD(e)}}finally{hD(e)}}}function hD(e,t){if(e.g){dD(e);const n=e.g,r=e.C[0]?KN:null;e.g=null,e.C=null,t||cx(e,"ready");try{n.onreadystatechange=r}catch{}}}function dD(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(YN.clearTimeout(e.A),e.A=null)}function fD(e){return e.g?e.g.readyState:0}function pD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case iD:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function gD(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return _M(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):wR(e,t,n))}function mD(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function yD(e){this.za=0,this.l=[],this.h=new kx,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=mD("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=mD("baseRetryDelayMs",5e3,e),this.$a=mD("retryDelaySeedMs",1e4,e),this.Ya=mD("forwardChannelMaxRetries",2,e),this.ra=mD("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new BR(e&&e.concurrentRequestLimit),this.Ca=new jR,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function vD(e){if(CD(e),3==e.G){var t=e.V++,n=yR(e.F);wR(n,"SID",e.J),wR(n,"RID",t),wR(n,"TYPE","terminate"),SD(e,n),(t=new Yx(e,e.h,t,void 0)).K=2,t.v=bR(yR(n)),n=!1,YN.navigator&&YN.navigator.sendBeacon&&(n=YN.navigator.sendBeacon(t.v.toString(),"")),!n&&YN.Image&&((new Image).src=t.v,n=!0),n||(t.g=LD(t.l,null),t.g.ea(t.v)),t.F=Date.now(),sR(t)}RD(e)}function _D(e){e.g&&(ID(e),e.g.cancel(),e.g=null)}function CD(e){_D(e),e.u&&(YN.clearTimeout(e.u),e.u=null),AD(e),e.i.cancel(),e.m&&("number"==typeof e.m&&YN.clearTimeout(e.m),e.m=null)}function ED(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&wD(e)}function wD(e){VR(e.i)||e.m||(e.m=!0,mx(e.Ha,e),e.C=0)}function bD(e,t){var n;n=t?t.m:e.V++;const r=yR(e.F);wR(r,"SID",e.J),wR(r,"RID",n),wR(r,"AID",e.U),SD(e,r),e.o&&e.s&&gD(r,e.o,e.s),n=new Yx(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=PD(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),HR(e.i,n),eR(n,r,t)}function SD(e,t){e.j&&hR({},function(e,n){wR(t,n,e)})}function PD(e,t,n){n=Math.min(e.l.length,n);var r=e.j?rM(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{ZR(a,e,"req"+n+"_")}catch{r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function OD(e){e.g||e.u||(e.Y=1,mx(e.Ga,e),e.A=0)}function TD(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=Ux(rM(e.Ga,e),MD(e,e.A)),e.A++,0))}function ID(e){null!=e.B&&(YN.clearTimeout(e.B),e.B=null)}function kD(e){e.g=new Yx(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=yR(e.oa);wR(t,"RID","rpc"),wR(t,"SID",e.J),wR(t,"CI",e.N?"0":"1"),wR(t,"AID",e.U),SD(e,t),wR(t,"TYPE","xmlhttp"),e.o&&e.s&&gD(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=bR(yR(t)),n.s=null,n.U=!0,tR(n,e)}function AD(e){null!=e.v&&(YN.clearTimeout(e.v),e.v=null)}function ND(e,t){var n=null;if(e.g==t){AD(e),ID(e),e.g=null;var r=2}else{if(!zR(e.i,t))return;n=t.D,GR(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;cx(r=xx(),new Bx(r,n,t,i)),wD(e)}else OD(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!($R(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Ux(rM(e.Ha,e,t),MD(e,e.C)),e.C++,0)))}(e,t)||2==r&&TD(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:xD(e,5);break;case 4:xD(e,10);break;case 3:xD(e,6);break;default:xD(e,2)}}function MD(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function xD(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=rM(e.jb,e);n||(n=new mR("//www.google.com/images/cleardot.gif"),YN.location&&"http"==YN.location.protocol||vR(n,"https"),bR(n)),function(e,t){const n=new kx;if(YN.Image){const r=new Image;r.onload=iM(YR,n,r,"TestLoadImage: loaded",!0,t),r.onerror=iM(YR,n,r,"TestLoadImage: error",!1,t),r.onabort=iM(YR,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=iM(YR,n,r,"TestLoadImage: timeout",!1,t),YN.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else Fx(2);e.G=0,e.j&&e.j.va(t),RD(e),CD(e)}function RD(e){e.G=0,e.I=-1,e.j&&((0!=qR(e.i).length||0!=e.l.length)&&(e.i.i.length=0,hM(e.l),e.l.length=0),e.j.ua())}function DD(e,t,n){let r=function(e){return e instanceof mR?yR(e):new mR(e,void 0)}(n);if(""!=r.i)t&&_R(r,t+"."+r.i),CR(r,r.m);else{const e=YN.location;r=function(e,t,n,r){var i=new mR(null,void 0);return e&&vR(i,e),t&&_R(i,t),n&&CR(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&_M(e.aa,function(e,t){wR(r,t,e)}),n=e.sa,(t=e.D)&&n&&wR(r,t,n),wR(r,"VER",e.ma),SD(e,r),r}function LD(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new rD(n&&e.Ba&&!e.qa?new KR({ib:!0}):e.qa)).L=e.H,t}function FD(){}function BD(){if(OM&&!(10<=Number(FM)))throw Error("Environmental error: no available transport.")}function UD(e,t){ax.call(this),this.g=new yD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!dM(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!dM(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new zD(this)}function VD(e){Wx.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function $D(){jx.call(this),this.status=1}function zD(e){this.g=e}(qN=rD.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Gx.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:Gx),this.g.onreadystatechange=rM(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void cD(this,s)}e=n||"";const i=new dR(this.headers);r&&hR(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=aD;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=YN.FormData&&e instanceof YN.FormData,!(0<=cM(oD,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{dD(this),0<this.B&&((this.K=function(e){return OM&&LM()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=rM(this.pa,this)):this.A=wx(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){cD(this,s)}},qN.pa=function(){void 0!==ZN&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,cx(this,"timeout"),this.abort(8))},qN.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,cx(this,"complete"),cx(this,"abort"),hD(this))},qN.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),hD(this,!0)),rD.Z.M.call(this)},qN.Fa=function(){this.s||(this.F||this.v||this.l?uD(this):this.cb())},qN.cb=function(){uD(this)},qN.ba=function(){try{return 2<fD(this)?this.g.status:-1}catch{return-1}},qN.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},qN.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),nD(t)}},qN.Da=function(){return this.m},qN.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(qN=yD.prototype).ma=8,qN.G=1,qN.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}},qN.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Yx(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=CM(s),wM(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=PD(this,i,t),wR(n=yR(this.F),"RID",e),wR(n,"CVER",22),this.D&&wR(n,"X-HTTP-Session-Id",this.D),SD(this,n),this.o&&s&&gD(n,this.o,s),HR(this.i,i),this.Ra&&wR(n,"TYPE","init"),this.ja?(wR(n,"$req",t),wR(n,"SID","null"),i.$=!0,eR(i,n,null)):eR(i,n,t),this.G=2}}else 3==this.G&&(e?bD(this,e):0==this.l.length||VR(this.i)||bD(this))},qN.Ga=function(){if(this.u=null,kD(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Ux(rM(this.bb,this),e)}},qN.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Fx(10),_D(this),kD(this))},qN.ab=function(){null!=this.v&&(this.v=null,_D(this),TD(this),Fx(19))},qN.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Fx(2)):(this.h.info("Failed to ping google.com"),Fx(1))},(qN=FD.prototype).xa=function(){},qN.wa=function(){},qN.va=function(){},qN.ua=function(){},qN.Oa=function(){},BD.prototype.g=function(e,t){return new UD(e,t)},sM(UD,ax),UD.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),mx(rM(e.hb,e,t))),Fx(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=DD(e,null,e.W),wD(e)},UD.prototype.close=function(){vD(this.g)},UD.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,ED(this.g,t)}else this.v?((t={}).__data__=ux(e),ED(this.g,t)):ED(this.g,e)},UD.prototype.M=function(){this.g.j=null,delete this.j,vD(this.g),delete this.g,UD.Z.M.call(this)},sM(VD,Wx),sM($D,jx),sM(zD,FD),zD.prototype.xa=function(){cx(this.g,"a")},zD.prototype.wa=function(e){cx(this.g,new VD(e))},zD.prototype.va=function(e){cx(this.g,new $D(e))},zD.prototype.ua=function(){cx(this.g,"b")},BD.prototype.createWebChannel=BD.prototype.g,UD.prototype.send=UD.prototype.u,UD.prototype.open=UD.prototype.m,UD.prototype.close=UD.prototype.close,Vx.NO_ERROR=0,Vx.TIMEOUT=8,Vx.HTTP_ERROR=6,$x.COMPLETE="complete",Hx.EventType=qx,qx.OPEN="a",qx.CLOSE="b",qx.ERROR="c",qx.MESSAGE="d",ax.prototype.listen=ax.prototype.N,rD.prototype.listenOnce=rD.prototype.O,rD.prototype.getLastError=rD.prototype.La,rD.prototype.getLastErrorCode=rD.prototype.Da,rD.prototype.getStatus=rD.prototype.ba,rD.prototype.getResponseJson=rD.prototype.Qa,rD.prototype.getResponseText=rD.prototype.ga,rD.prototype.send=rD.prototype.ea;var HD=jN.createWebChannelTransport=function(){return new BD},GD=jN.getStatEventTarget=function(){return xx()},qD=jN.ErrorCode=Vx,WD=jN.EventType=$x,jD=jN.Event=Nx,ZD=jN.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},YD=jN.FetchXmlHttpFactory=KR,KD=jN.WebChannel=Hx,JD=jN.XhrIo=rD;const QD="@firebase/firestore";class XD{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}XD.UNAUTHENTICATED=new XD(null),XD.GOOGLE_CREDENTIALS=new XD("google-credentials-uid"),XD.FIRST_PARTY=new XD("first-party-uid"),XD.MOCK_USER=new XD("mock-user");let eL="9.6.5";const tL=new pb("@firebase/firestore");function nL(){return tL.logLevel}function rL(e,...t){if(tL.logLevel<=lb.DEBUG){const n=t.map(oL);tL.debug(`Firestore (${eL}): ${e}`,...n)}}function iL(e,...t){if(tL.logLevel<=lb.ERROR){const n=t.map(oL);tL.error(`Firestore (${eL}): ${e}`,...n)}}function sL(e,...t){if(tL.logLevel<=lb.WARN){const n=t.map(oL);tL.warn(`Firestore (${eL}): ${e}`,...n)}}function oL(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return e}}function aL(e="Unexpected state"){const t=`FIRESTORE (${eL}) INTERNAL ASSERTION FAILED: `+e;throw iL(t),new Error(t)}function cL(e,t){e||aL()}function lL(e,t){return e}const uL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class hL extends Lw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class dL{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fL{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(XD.UNAUTHENTICATED))}shutdown(){}}class gL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class mL{constructor(e){this.t=e,this.currentUser=XD.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let r=this.i;const i=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new dL;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new dL,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(lw(function*(){yield t.promise,yield i(n.currentUser)}))},a=e=>{rL("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(rL("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new dL)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rL("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(cL("string"==typeof t.accessToken),new fL(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return cL(null===e||"string"==typeof e),new XD(e)}}class yL{constructor(e,t,n){this.type="FirstParty",this.user=XD.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class vL{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new yL(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(XD.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class _L{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CL{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable(()=>{return null!=(e=n).error&&rL("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token);var e})};const n=e=>{rL("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):rL("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(cL("string"==typeof e.token),new _L(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class EL{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function wL(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}EL.I=-1;class bL{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=wL(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function SL(e,t){return e<t?-1:e>t?1:0}function PL(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class OL{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new hL(uL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new hL(uL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new hL(uL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new hL(uL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return OL.fromMillis(Date.now())}static fromDate(e){return OL.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new OL(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?SL(this.nanoseconds,e.nanoseconds):SL(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class TL{constructor(e){this.timestamp=e}static fromTimestamp(e){return new TL(e)}static min(){return new TL(new OL(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function IL(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function kL(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function AL(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class NL{constructor(e,t,n){void 0===t?t=0:t>e.length&&aL(),void 0===n?n=e.length-t:n>e.length-t&&aL(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===NL.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof NL?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ML extends NL{construct(e,t,n){return new ML(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new hL(uL.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ML(t)}static emptyPath(){return new ML([])}}const xL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class RL extends NL{construct(e,t,n){return new RL(e,t,n)}static isValidIdentifier(e){return xL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),RL.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new RL(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new hL(uL.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new hL(uL.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new hL(uL.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new hL(uL.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new RL(t)}static emptyPath(){return new RL([])}}class DL{constructor(e){this.fields=e,e.sort(RL.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return PL(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class LL{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new LL(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new LL(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return SL(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}LL.EMPTY_BYTE_STRING=new LL("");const FL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function BL(e){if(cL(!!e),"string"==typeof e){let t=0;const n=FL.exec(e);if(cL(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:UL(e.seconds),nanos:UL(e.nanos)}}function UL(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function VL(e){return"string"==typeof e?LL.fromBase64String(e):LL.fromUint8Array(e)}function $L(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function zL(e){const t=e.mapValue.fields.__previous_value__;return $L(t)?zL(t):t}function HL(e){const t=BL(e.mapValue.fields.__local_write_time__.timestampValue);return new OL(t.seconds,t.nanos)}function GL(e){return null==e}function qL(e){return 0===e&&1/e==-1/0}class WL{constructor(e){this.path=e}static fromPath(e){return new WL(ML.fromString(e))}static fromName(e){return new WL(ML.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===ML.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ML.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new WL(new ML(e.slice()))}}function jL(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?$L(e)?4:10:aL()}function ZL(e,t){if(e===t)return!0;const n=jL(e);if(n!==jL(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return HL(e).isEqual(HL(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=BL(e.timestampValue),r=BL(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,VL(e.bytesValue).isEqual(VL(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return UL(e.geoPointValue.latitude)===UL(t.geoPointValue.latitude)&&UL(e.geoPointValue.longitude)===UL(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return UL(e.integerValue)===UL(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=UL(e.doubleValue),r=UL(t.doubleValue);return n===r?qL(n)===qL(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return PL(e.arrayValue.values||[],t.arrayValue.values||[],ZL);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(IL(n)!==IL(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ZL(n[i],r[i])))return!1;return!0}(e,t);default:return aL()}var r}function YL(e,t){return void 0!==(e.values||[]).find(e=>ZL(e,t))}function KL(e,t){if(e===t)return 0;const n=jL(e),r=jL(t);if(n!==r)return SL(n,r);switch(n){case 0:return 0;case 1:return SL(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=UL(e.integerValue||e.doubleValue),r=UL(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return JL(e.timestampValue,t.timestampValue);case 4:return JL(HL(e),HL(t));case 5:return SL(e.stringValue,t.stringValue);case 6:return function(e,t){const n=VL(e),r=VL(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=SL(n[i],r[i]);if(0!==e)return e}return SL(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=SL(UL(e.latitude),UL(t.latitude));return 0!==n?n:SL(UL(e.longitude),UL(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=KL(n[i],r[i]);if(e)return e}return SL(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=SL(r[o],s[o]);if(0!==e)return e;const t=KL(n[r[o]],i[s[o]]);if(0!==t)return t}return SL(r.length,s.length)}(e.mapValue,t.mapValue);default:throw aL()}}function JL(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return SL(e,t);const n=BL(e),r=BL(t),i=SL(n.seconds,r.seconds);return 0!==i?i:SL(n.nanos,r.nanos)}function QL(e){return XL(e)}function XL(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=BL(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?VL(e.bytesValue).toBase64():"referenceValue"in e?WL.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=XL(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${XL(e.fields[i])}`;return n+"}"}(e.mapValue):aL();var t}function eF(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function tF(e){return!!e&&"integerValue"in e}function nF(e){return!!e&&"arrayValue"in e}function rF(e){return!!e&&"nullValue"in e}function iF(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sF(e){return!!e&&"mapValue"in e}function oF(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return kL(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=oF(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=oF(e.arrayValue.values[n]);return t}return Object.assign({},e)}class aF{constructor(e){this.value=e}static empty(){return new aF({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!sF(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=oF(t)}setAll(e){let t=RL.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=oF(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());sF(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ZL(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];sF(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){kL(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new aF(oF(this.value))}}function cF(e){const t=[];return kL(e.fields,(e,n)=>{const r=new RL([e]);if(sF(n)){const e=cF(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new DL(t)}class lF{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new lF(e,0,TL.min(),aF.empty(),0)}static newFoundDocument(e,t,n){return new lF(e,1,t,n,0)}static newNoDocument(e,t){return new lF(e,2,t,aF.empty(),0)}static newUnknownDocument(e,t){return new lF(e,3,t,aF.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aF.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aF.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof lF&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new lF(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class uF{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function hF(e,t=null,n=[],r=[],i=null,s=null,o=null){return new uF(e,t,n,r,i,s,o)}function dF(e){const t=lL(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+QL(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),GL(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=PF(t.startAt)),t.endAt&&(e+="|ub:",e+=PF(t.endAt)),t.R=e}return t.R}function fF(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!TF(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!ZL(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!kF(e.startAt,t.startAt)&&kF(e.endAt,t.endAt)}function pF(e){return WL.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class gF extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new mF(e,t,n):"array-contains"===t?new CF(e,n):"in"===t?new EF(e,n):"not-in"===t?new wF(e,n):"array-contains-any"===t?new bF(e,n):new gF(e,t,n)}static P(e,t,n){return"in"===t?new yF(e,n):new vF(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(KL(t,this.value)):null!==t&&jL(this.value)===jL(t)&&this.v(KL(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return aL()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class mF extends gF{constructor(e,t,n){super(e,t,n),this.key=WL.fromName(n.referenceValue)}matches(e){const t=WL.comparator(e.key,this.key);return this.v(t)}}class yF extends gF{constructor(e,t){super(e,"in",t),this.keys=_F(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class vF extends gF{constructor(e,t){super(e,"not-in",t),this.keys=_F(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function _F(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>WL.fromName(e.referenceValue))}class CF extends gF{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return nF(t)&&YL(t.arrayValue,this.value)}}class EF extends gF{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&YL(this.value.arrayValue,t)}}class wF extends gF{constructor(e,t){super(e,"not-in",t)}matches(e){if(YL(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!YL(this.value.arrayValue,t)}}class bF extends gF{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!nF(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>YL(this.value.arrayValue,e))}}class SF{constructor(e,t){this.position=e,this.before=t}}function PF(e){return`${e.before?"b":"a"}:${e.position.map(e=>QL(e)).join(",")}`}class OF{constructor(e,t="asc"){this.field=e,this.dir=t}}function TF(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function IF(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?WL.comparator(WL.fromName(o.referenceValue),n.key):KL(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function kF(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ZL(e.position[n],t.position[n]))return!1;return!0}class AF{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null}}function NF(e){return new AF(e)}function MF(e){return!GL(e.limit)&&"F"===e.limitType}function xF(e){return!GL(e.limit)&&"L"===e.limitType}function RF(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function DF(e){for(const t of e.filters)if(t.V())return t.field;return null}function LF(e){return null!==e.collectionGroup}function FF(e){const t=lL(e);if(null===t.S){t.S=[];const e=DF(t),n=RF(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new OF(e)),t.S.push(new OF(RL.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new OF(RL.keyField(),e))}}}return t.S}function BF(e){const t=lL(e);if(!t.D)if("F"===t.limitType)t.D=hF(t.path,t.collectionGroup,FF(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of FF(t))e.push(new OF(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new SF(t.endAt.position,!t.endAt.before):null,r=t.startAt?new SF(t.startAt.position,!t.startAt.before):null;t.D=hF(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function UF(e,t,n){return new AF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function VF(e,t){return fF(BF(e),BF(t))&&e.limitType===t.limitType}function $F(e){return`${dF(BF(e))}|lt:${e.limitType}`}function zF(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${QL(t.value)}`;var t}).join(", ")}]`),GL(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: "+PF(e.startAt)),e.endAt&&(t+=", endAt: "+PF(e.endAt)),`Target(${t})`}(BF(e))}; limitType=${e.limitType})`}function HF(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):WL.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!IF(n.startAt,FF(n),r)||n.endAt&&IF(n.endAt,FF(n),r)));var n,r}function GF(e){return(t,n)=>{let r=!1;for(const i of FF(e)){const e=qF(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function qF(e,t,n){const r=e.field.isKeyField()?WL.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?KL(r,i):aL()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return aL()}}function WF(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qL(t)?"-0":t}}function jF(e){return{integerValue:""+e}}function ZF(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!qL(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?jF(t):WF(e,t)}class YF{constructor(){this._=void 0}}function KF(e,t,n){return e instanceof XF?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof eB?tB(e,t):e instanceof nB?rB(e,t):function(e,t){const n=QF(e,t),r=sB(n)+sB(e.N);return tF(n)&&tF(e.N)?jF(r):WF(e.k,r)}(e,t)}function JF(e,t,n){return e instanceof eB?tB(e,t):e instanceof nB?rB(e,t):n}function QF(e,t){return e instanceof iB?tF(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}class XF extends YF{}class eB extends YF{constructor(e){super(),this.elements=e}}function tB(e,t){const n=oB(t);for(const r of e.elements)n.some(e=>ZL(e,r))||n.push(r);return{arrayValue:{values:n}}}class nB extends YF{constructor(e){super(),this.elements=e}}function rB(e,t){let n=oB(t);for(const r of e.elements)n=n.filter(e=>!ZL(e,r));return{arrayValue:{values:n}}}class iB extends YF{constructor(e,t){super(),this.k=e,this.N=t}}function sB(e){return UL(e.integerValue||e.doubleValue)}function oB(e){return nF(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class aB{constructor(e,t){this.field=e,this.transform=t}}class cB{constructor(e,t){this.version=e,this.transformResults=t}}class lB{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lB}static exists(e){return new lB(void 0,e)}static updateTime(e){return new lB(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uB(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class hB{}function dB(e,t,n){e instanceof yB?function(e,t,n){const r=e.value.clone(),i=CB(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof vB?function(e,t,n){if(!uB(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=CB(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(_B(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function fB(e,t,n){var r;e instanceof yB?function(e,t,n){if(!uB(e.precondition,t))return;const r=e.value.clone(),i=EB(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(mB(t),r).setHasLocalMutations()}(e,t,n):e instanceof vB?function(e,t,n){if(!uB(e.precondition,t))return;const r=EB(e.fieldTransforms,n,t),i=t.data;i.setAll(_B(e)),i.setAll(r),t.convertToFoundDocument(mB(t),i).setHasLocalMutations()}(e,t,n):uB(e.precondition,r=t)&&r.convertToNoDocument(TL.min())}function pB(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=QF(r.transform,e||null);null!=i&&(null==n&&(n=aF.empty()),n.set(r.field,i))}return n||null}function gB(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&PL(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof eB&&r instanceof eB||n instanceof nB&&r instanceof nB?PL(n.elements,r.elements,ZL):n instanceof iB&&r instanceof iB?ZL(n.N,r.N):n instanceof XF&&r instanceof XF);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}function mB(e){return e.isFoundDocument()?e.version:TL.min()}class yB extends hB{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class vB extends hB{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function _B(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function CB(e,t,n){const r=new Map;cL(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,JF(o,a,n[i]))}return r}function EB(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,KF(e,s,t))}return r}class wB extends hB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class bB extends hB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class SB{constructor(e){this.count=e}}var PB,OB;function TB(e){switch(e){default:return aL();case uL.CANCELLED:case uL.UNKNOWN:case uL.DEADLINE_EXCEEDED:case uL.RESOURCE_EXHAUSTED:case uL.INTERNAL:case uL.UNAVAILABLE:case uL.UNAUTHENTICATED:return!1;case uL.INVALID_ARGUMENT:case uL.NOT_FOUND:case uL.ALREADY_EXISTS:case uL.PERMISSION_DENIED:case uL.FAILED_PRECONDITION:case uL.ABORTED:case uL.OUT_OF_RANGE:case uL.UNIMPLEMENTED:case uL.DATA_LOSS:return!0}}function IB(e){if(void 0===e)return iL("GRPC error has no .code"),uL.UNKNOWN;switch(e){case PB.OK:return uL.OK;case PB.CANCELLED:return uL.CANCELLED;case PB.UNKNOWN:return uL.UNKNOWN;case PB.DEADLINE_EXCEEDED:return uL.DEADLINE_EXCEEDED;case PB.RESOURCE_EXHAUSTED:return uL.RESOURCE_EXHAUSTED;case PB.INTERNAL:return uL.INTERNAL;case PB.UNAVAILABLE:return uL.UNAVAILABLE;case PB.UNAUTHENTICATED:return uL.UNAUTHENTICATED;case PB.INVALID_ARGUMENT:return uL.INVALID_ARGUMENT;case PB.NOT_FOUND:return uL.NOT_FOUND;case PB.ALREADY_EXISTS:return uL.ALREADY_EXISTS;case PB.PERMISSION_DENIED:return uL.PERMISSION_DENIED;case PB.FAILED_PRECONDITION:return uL.FAILED_PRECONDITION;case PB.ABORTED:return uL.ABORTED;case PB.OUT_OF_RANGE:return uL.OUT_OF_RANGE;case PB.UNIMPLEMENTED:return uL.UNIMPLEMENTED;case PB.DATA_LOSS:return uL.DATA_LOSS;default:return aL()}}(OB=PB||(PB={}))[OB.OK=0]="OK",OB[OB.CANCELLED=1]="CANCELLED",OB[OB.UNKNOWN=2]="UNKNOWN",OB[OB.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",OB[OB.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",OB[OB.NOT_FOUND=5]="NOT_FOUND",OB[OB.ALREADY_EXISTS=6]="ALREADY_EXISTS",OB[OB.PERMISSION_DENIED=7]="PERMISSION_DENIED",OB[OB.UNAUTHENTICATED=16]="UNAUTHENTICATED",OB[OB.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",OB[OB.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",OB[OB.ABORTED=10]="ABORTED",OB[OB.OUT_OF_RANGE=11]="OUT_OF_RANGE",OB[OB.UNIMPLEMENTED=12]="UNIMPLEMENTED",OB[OB.INTERNAL=13]="INTERNAL",OB[OB.UNAVAILABLE=14]="UNAVAILABLE",OB[OB.DATA_LOSS=15]="DATA_LOSS";class kB{constructor(e,t){this.comparator=e,this.root=t||NB.EMPTY}insert(e,t){return new kB(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,NB.BLACK,null,null))}remove(e){return new kB(this.comparator,this.root.remove(e,this.comparator).copy(null,null,NB.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new AB(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new AB(this.root,e,this.comparator,!1)}getReverseIterator(){return new AB(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new AB(this.root,e,this.comparator,!0)}}class AB{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class NB{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??NB.RED,this.left=r??NB.EMPTY,this.right=i??NB.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new NB(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return NB.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return NB.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,NB.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,NB.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw aL();const e=this.left.check();if(e!==this.right.check())throw aL();return e+(this.isRed()?0:1)}}NB.EMPTY=null,NB.RED=!0,NB.BLACK=!1,NB.EMPTY=new class{constructor(){this.size=0}get key(){throw aL()}get value(){throw aL()}get color(){throw aL()}get left(){throw aL()}get right(){throw aL()}copy(e,t,n,r,i){return this}insert(e,t,n){return new NB(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class MB{constructor(e){this.comparator=e,this.data=new kB(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xB(this.data.getIterator())}getIteratorFrom(e){return new xB(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof MB)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new MB(this.comparator);return t.data=e,t}}class xB{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const RB=new kB(WL.comparator);function DB(){return RB}const LB=new kB(WL.comparator);function FB(){return LB}const BB=new kB(WL.comparator);const UB=new MB(WL.comparator);function VB(...e){let t=UB;for(const n of e)t=t.add(n);return t}const $B=new MB(SL);function zB(){return $B}class HB{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,GB.createSynthesizedTargetChangeForCurrentChange(e,t)),new HB(TL.min(),n,zB(),DB(),VB())}}class GB{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new GB(LL.EMPTY_BYTE_STRING,t,VB(),VB(),VB())}}class qB{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class WB{constructor(e,t){this.targetId=e,this.M=t}}class jB{constructor(e,t,n=LL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ZB{constructor(){this.F=0,this.L=JB(),this.B=LL.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=VB(),t=VB(),n=VB();return this.L.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:aL()}}),new GB(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=JB()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class YB{constructor(e){this.et=e,this.nt=new Map,this.st=DB(),this.it=KB(),this.rt=new MB(SL)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:aL()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((e,n)=>{this.lt(n)&&t(n)})}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(pF(e))if(0===n){const n=new WL(e.path);this.at(t,n,lF.newNoDocument(n,TL.min()))}else cL(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((n,r)=>{const i=this.wt(r);if(i){if(n.current&&pF(i.target)){const t=new WL(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,lF.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}});let n=VB();this.it.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new HB(e,t,this.rt,this.st,n);return this.st=DB(),this.it=KB(),this.rt=new MB(SL),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new ZB,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new MB(SL),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||rL("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new ZB),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function KB(){return new kB(WL.comparator)}function JB(){return new kB(WL.comparator)}const QB={asc:"ASCENDING",desc:"DESCENDING"},XB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class eU{constructor(e,t){this.databaseId=e,this.C=t}}function tU(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function nU(e,t){return e.C?t.toBase64():t.toUint8Array()}function rU(e,t){return tU(e,t.toTimestamp())}function iU(e){return cL(!!e),TL.fromTimestamp(function(e){const t=BL(e);return new OL(t.seconds,t.nanos)}(e))}function sU(e,t){return(n=e,new ML(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function oU(e){const t=ML.fromString(e);return cL(OU(t)),t}function aU(e,t){return sU(e.databaseId,t.path)}function cU(e,t){const n=oU(t);if(n.get(1)!==e.databaseId.projectId)throw new hL(uL.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new hL(uL.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new WL(hU(n))}function lU(e,t){return sU(e.databaseId,t)}function uU(e){return new ML(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function hU(e){return cL(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function dU(e,t,n){return{name:aU(e,t),fields:n.value.mapValue.fields}}function fU(e,t){return{documents:[lU(e,t.path)]}}function pU(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=lU(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=lU(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(iF(e.value))return{unaryFilter:{field:EU(e.field),op:"IS_NAN"}};if(rF(e.value))return{unaryFilter:{field:EU(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(iF(e.value))return{unaryFilter:{field:EU(e.field),op:"IS_NOT_NAN"}};if(rF(e.value))return{unaryFilter:{field:EU(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:EU(e.field),op:CU(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>{return{field:EU((t=e).field),direction:_U(t.dir)};var t})}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=(a=t.limit,e.C||GL(a)?a:{value:a});var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=yU(t.startAt)),t.endAt&&(n.structuredQuery.endAt=yU(t.endAt)),n}function gU(e){let t=function(e){const t=oU(e);return 4===t.length?ML.emptyPath():hU(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){cL(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=mU(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new OF(wU((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,GL(t)?null:t}(n.limit));let c=null;n.startAt&&(c=vU(n.startAt));let l=null;return n.endAt&&(l=vU(n.endAt)),function(e,t,n,r,i,s,o,a){return new AF(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,l)}function mU(e){return e?void 0!==e.unaryFilter?[SU(e)]:void 0!==e.fieldFilter?[bU(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>mU(e)).reduce((e,t)=>e.concat(t)):aL():[]}function yU(e){return{before:e.before,values:e.position}}function vU(e){return new SF(e.values||[],!!e.before)}function _U(e){return QB[e]}function CU(e){return XB[e]}function EU(e){return{fieldPath:e.canonicalString()}}function wU(e){return RL.fromServerFormat(e.fieldPath)}function bU(e){return gF.create(wU(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return aL()}}(e.fieldFilter.op),e.fieldFilter.value)}function SU(e){switch(e.unaryFilter.op){case"IS_NAN":const t=wU(e.unaryFilter.field);return gF.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=wU(e.unaryFilter.field);return gF.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=wU(e.unaryFilter.field);return gF.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=wU(e.unaryFilter.field);return gF.create(i,"!=",{nullValue:"NULL_VALUE"});default:return aL()}}function PU(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function OU(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function TU(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=kU(t)),t=IU(e.get(n),t);return kU(t)}function IU(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function kU(e){return e+"\x01\x01"}class AU{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}AU.store="owner",AU.key="owner";class NU{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}NU.store="mutationQueues",NU.keyPath="userId";class MU{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}MU.store="mutations",MU.keyPath="batchId",MU.userMutationsIndex="userMutationsIndex",MU.userMutationsKeyPath=["userId","batchId"];class xU{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,TU(t)]}static key(e,t,n){return[e,TU(t),n]}}xU.store="documentMutations",xU.PLACEHOLDER=new xU;class RU{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}RU.store="remoteDocuments",RU.readTimeIndex="readTimeIndex",RU.readTimeIndexPath="readTime",RU.collectionReadTimeIndex="collectionReadTimeIndex",RU.collectionReadTimeIndexPath=["parentPath","readTime"];class DU{constructor(e){this.byteSize=e}}DU.store="remoteDocumentGlobal",DU.key="remoteDocumentGlobalKey";class LU{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}LU.store="targets",LU.keyPath="targetId",LU.queryTargetsIndexName="queryTargetsIndex",LU.queryTargetsKeyPath=["canonicalId","targetId"];class FU{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}FU.store="targetDocuments",FU.keyPath=["targetId","path"],FU.documentTargetsIndex="documentTargetsIndex",FU.documentTargetsKeyPath=["path","targetId"];class BU{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}BU.key="targetGlobalKey",BU.store="targetGlobal";class UU{constructor(e,t){this.collectionId=e,this.parent=t}}UU.store="collectionParents",UU.keyPath=["collectionId","parent"];class VU{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}VU.store="clientMetadata",VU.keyPath="clientId";class $U{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}$U.store="bundles",$U.keyPath="bundleId";class zU{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}zU.store="namedQueries",zU.keyPath="name";const HU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class GU{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&aL(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new GU((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof GU?t:GU.resolve(t)}catch(t){return GU.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):GU.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):GU.reject(t)}static resolve(e){return new GU((t,n)=>{t(e)})}static reject(e){return new GU((t,n)=>{n(e)})}static waitFor(e){return new GU((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=GU.resolve(!1);for(const n of e)t=t.next(e=>e?GU.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}function qU(e){return"IndexedDbTransactionError"===e.name}class WU{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&dB(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&fB(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&fB(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(TL.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),VB())}isEqual(e){return this.batchId===e.batchId&&PL(this.mutations,e.mutations,(e,t)=>gB(e,t))&&PL(this.baseMutations,e.baseMutations,(e,t)=>gB(e,t))}}class jU{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){cL(e.mutations.length===n.length);let r=BB;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new jU(e,t,n,r)}}class ZU{constructor(e,t,n,r,i=TL.min(),s=TL.min(),o=LL.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new ZU(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ZU(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ZU(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class YU{constructor(e){this.Gt=e}}function KU(e){const t=gU({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?UF(t,t.limit,"L"):t}class JU{constructor(){this.zt=new QU}addToCollectionParentIndex(e,t){return this.zt.add(t),GU.resolve()}getCollectionParents(e,t){return GU.resolve(this.zt.getEntries(t))}}class QU{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new MB(ML.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new MB(ML.comparator)).toArray()}}class XU{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new XU(e,XU.DEFAULT_COLLECTION_PERCENTILE,XU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}XU.DEFAULT_COLLECTION_PERCENTILE=10,XU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,XU.DEFAULT=new XU(41943040,XU.DEFAULT_COLLECTION_PERCENTILE,XU.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),XU.DISABLED=new XU(-1,0,0);class eV{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new eV(0)}static re(){return new eV(-1)}}function tV(e){return nV.apply(this,arguments)}function nV(){return(nV=lw(function*(e){if(e.code!==uL.FAILED_PRECONDITION||e.message!==HU)throw e;rL("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class rV{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){kL(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return AL(this.inner)}}class iV{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.bn(e,t,n))}bn(e,t,n){return this.Je.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}vn(e,t){return this.Je.getEntries(e,t).next(t=>this.Vn(e,t).next(()=>t))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return WL.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.Sn(e,t.path):LF(t)?this.Dn(e,t,n):this.Cn(e,t,n);var r}Sn(e,t){return this.Rn(e,new WL(t)).next(e=>{let t=FB();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Dn(e,t,n){const r=t.collectionGroup;let i=FB();return this.Jt.getCollectionParents(e,r).next(s=>GU.forEach(s,s=>{const o=(a=t,c=s.child(r),new AF(c,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,c;return this.Cn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Nn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=lF.newInvalidDocument(n),r=r.insert(n,i)),fB(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{HF(t,n)||(r=r.remove(e))}),r))}Nn(e,t,n){let r=VB();for(const s of t)for(const e of s.mutations)e instanceof vB&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class sV{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=VB(),r=VB();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new sV(e,t.fromCache,n,r)}}class oV{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(TL.min())?this.Fn(e,t):this.Mn.vn(e,r).next(i=>{const s=this.Ln(t,i);return(MF(t)||xF(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(nL()<=lb.DEBUG&&rL("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),zF(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))});var i}Ln(e,t){let n=new MB(GF(e));return t.forEach((t,r)=>{HF(e,r)&&(n=n.add(r))}),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return nL()<=lb.DEBUG&&rL("QueryEngine","Using full collection scan to execute query:",zF(t)),this.Mn.getDocumentsMatchingQuery(e,t,TL.min())}}class aV{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new kB(SL),this.Kn=new rV(e=>dF(e),fF),this.jn=TL.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new iV(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function cV(e,t){return lV.apply(this,arguments)}function lV(){return(lV=lw(function*(e,t){const n=lL(e);let r=n.An,i=n.Wn;const s=yield n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.An.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new iV(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=VB();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next(e=>({Gn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.An=r,n.Wn=i,n.Un.On(n.Wn),s})).apply(this,arguments)}function uV(e,t){const n=lL(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=GU.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);cL(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.An.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}function hV(e){const t=lL(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.He.getLastRemoteSnapshotVersion(e))}function dV(e,t){const n=lL(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.He.addMatchingKeys(e,s.addedDocuments,a)));let l=c.withSequenceNumber(e.currentSequenceNumber);var u,h,d;t.targetMismatches.has(a)?l=l.withResumeToken(LL.EMPTY_BYTE_STRING,TL.min()).withLastLimboFreeSnapshotVersion(TL.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,r)),i=i.insert(a,l),h=l,d=s,(0===(u=c).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.He.updateTargetData(e,l))});let a=DB();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n,r,i){let s=VB();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=DB();return n.forEach((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(TL.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):rL("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(TL.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next(t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return GU.waitFor(o).next(()=>s.apply(e)).next(()=>n.Wn.Vn(e,a)).next(()=>a)}).then(e=>(n.qn=i,e))}function fV(e,t){const n=lL(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)))}function pV(e,t){const n=lL(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.He.getTargetData(e,t).next(i=>i?(r=i,GU.resolve(r)):n.He.allocateTargetId(e).next(i=>(r=new ZU(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e})}function gV(e,t,n){return mV.apply(this,arguments)}function mV(){return(mV=lw(function*(e,t,n){const r=lL(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!qU(o))throw o;rL("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)})).apply(this,arguments)}function yV(e,t,n){const r=lL(e);let i=TL.min(),s=VB();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=lL(e),i=r.Kn.get(n);return void 0!==i?GU.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,BF(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:TL.min(),n?s:VB())).next(e=>({documents:e,zn:s})))}class vV{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return GU.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:iU(n.createTime)}),GU.resolve()}getNamedQuery(e,t){return GU.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(n=t).name,query:KU(n.bundledQuery),readTime:iU(n.readTime)}),GU.resolve();var n}}class _V{constructor(){this.ts=new MB(CV.es),this.ns=new MB(CV.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new CV(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.os(new CV(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new WL(new ML([])),n=new CV(t,e),r=new CV(t,e+1),i=[];return this.ns.forEachInRange([n,r],e=>{this.os(e),i.push(e.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new WL(new ML([])),n=new CV(t,e),r=new CV(t,e+1);let i=VB();return this.ns.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new CV(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class CV{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return WL.comparator(e.key,t.key)||SL(e.fs,t.fs)}static ss(e,t){return SL(e.fs,t.fs)||WL.comparator(e.key,t.key)}}class EV{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new MB(CV.es)}checkEmpty(e){return GU.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++;const s=new WU(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new CV(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return GU.resolve(s)}lookupMutationBatch(e,t){return GU.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.gs(t+1),r=n<0?0:n;return GU.resolve(this.An.length>r?this.An[r]:null)}getHighestUnacknowledgedBatchId(){return GU.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return GU.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new CV(t,0),r=new CV(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],e=>{const t=this._s(e.fs);i.push(t)}),GU.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new MB(SL);return t.forEach(e=>{const t=new CV(e,0),r=new CV(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],e=>{n=n.add(e.fs)})}),GU.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;WL.isDocumentKey(i)||(i=i.child(""));const s=new CV(new WL(i),0);let o=new MB(SL);return this.ws.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)},s),GU.resolve(this.ys(o))}ys(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){cL(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return GU.forEach(t.mutations,r=>{const i=new CV(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ws=n})}ee(e){}containsKey(e,t){const n=new CV(t,0),r=this.ws.firstAfterOrEqual(n);return GU.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return GU.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class wV{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new kB(WL.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return GU.resolve(n?n.document.mutableCopy():lF.newInvalidDocument(t))}getEntries(e,t){let n=DB();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():lF.newInvalidDocument(e))}),GU.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=DB();const i=new WL(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||HF(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return GU.resolve(r)}Es(e,t){return GU.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new bV(this)}getSize(e){return GU.resolve(this.size)}}class bV extends class{constructor(){this.changes=new rV(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:TL.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:lF.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?GU.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)}),GU.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class SV{constructor(e){this.persistence=e,this.Is=new rV(e=>dF(e),fF),this.lastRemoteSnapshotVersion=TL.min(),this.highestTargetId=0,this.As=0,this.Rs=new _V,this.targetCount=0,this.bs=eV.ie()}forEachTarget(e,t){return this.Is.forEach((e,n)=>t(n)),GU.resolve()}getLastRemoteSnapshotVersion(e){return GU.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return GU.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),GU.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),GU.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new eV(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,GU.resolve()}updateTargetData(e,t){return this.ae(t),GU.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,GU.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),GU.waitFor(i).next(()=>r)}getTargetCount(e){return GU.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return GU.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),GU.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),GU.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),GU.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return GU.resolve(n)}containsKey(e,t){return GU.resolve(this.Rs.containsKey(t))}}class PV{constructor(e,t){this.Ps={},this.Be=new EL(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new SV(this),this.Jt=new JU,this.Je=new wV(this.Jt,e=>this.referenceDelegate.vs(e)),this.k=new YU(t),this.Ye=new vV(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new EV(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){rL("MemoryPersistence","Starting transaction:",e);const r=new OV(this.Be.next());return this.referenceDelegate.Vs(),n(r).next(e=>this.referenceDelegate.Ss(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ds(e,t){return GU.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class OV extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}{constructor(e){super(),this.currentSequenceNumber=e}}class TV{constructor(e){this.persistence=e,this.Cs=new _V,this.Ns=null}static ks(e){return new TV(e)}get xs(){if(this.Ns)return this.Ns;throw aL()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),GU.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),GU.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),GU.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return GU.forEach(this.xs,n=>{const r=WL.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return GU.or([()=>GU.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}class IV{constructor(){this.activeTargetIds=zB()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kV{constructor(){this.pi=new IV,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new IV,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class AV{Ei(e){}shutdown(){}}class NV{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){rL("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){rL("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const MV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class xV{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class RV extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);rL("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then(e=>(rL("RestConnection","Received: ",e),e),t=>{throw sL("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+eL,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Ui(e,t){return`${this.Fi}/v1/${t}:${MV[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise((i,s)=>{const o=new JD;o.listenOnce(WD.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case qD.NO_ERROR:const t=o.getResponseJson();rL("Connection","XHR received:",JSON.stringify(t)),i(t);break;case qD.TIMEOUT:rL("Connection",'RPC "'+e+'" timed out'),s(new hL(uL.DEADLINE_EXCEEDED,"Request time out"));break;case qD.HTTP_ERROR:const n=o.getStatus();if(rL("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(uL).indexOf(t)>=0?t:uL.UNKNOWN}(e.status);s(new hL(t,e.message))}else s(new hL(uL.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new hL(uL.UNAVAILABLE,"Connection failed."));break;default:aL()}}finally{rL("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=HD(),s=GD(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new YD({})),this.qi(o.initMessageHeaders,t,n),kw()||Nw()||Iw().indexOf("Electron/")>=0||Mw()||Iw().indexOf("MSAppHost/")>=0||Aw()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");rL("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let l=!1,u=!1;const h=new xV({Vi:e=>{u?rL("Connection","Not sending because WebChannel is closed:",e):(l||(rL("Connection","Opening WebChannel transport."),c.open(),l=!0),rL("Connection","WebChannel sending:",e),c.send(e))},Si:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return d(c,KD.EventType.OPEN,()=>{u||rL("Connection","WebChannel transport opened.")}),d(c,KD.EventType.CLOSE,()=>{u||(u=!0,rL("Connection","WebChannel transport closed"),h.Oi())}),d(c,KD.EventType.ERROR,e=>{u||(u=!0,sL("Connection","WebChannel transport errored:",e),h.Oi(new hL(uL.UNAVAILABLE,"The operation could not be completed")))}),d(c,KD.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];cL(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){rL("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=PB[e];if(void 0!==t)return IB(t)}(e),n=i.message;void 0===t&&(t=uL.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.Oi(new hL(t,n)),c.close()}else rL("Connection","WebChannel received:",n),h.Mi(n)}}),d(s,jD.STAT_EVENT,e=>{e.stat===ZD.PROXY?rL("Connection","Detected buffering proxy"):e.stat===ZD.NOPROXY&&rL("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.$i()},0),h}}function DV(){return"undefined"!=typeof document?document:null}function LV(e){return new eU(e,!0)}class FV{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&rL("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class BV{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new FV(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return lw(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return lw(function*(){if(e.lr())return e.close(0)})()}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(e,t){var n=this;return lw(function*(){n.yr(),n.pr(),n.ur.cancel(),n.rr++,4!==e?n.ur.reset():t&&t.code===uL.RESOURCE_EXHAUSTED?(iL(t.toString()),iL("Using maximum backoff delay to prevent overloading the backend."),n.ur.Xi()):t&&t.code===uL.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Tr(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.rr===t&&this.Ir(e,n)},t=>{e(()=>{const e=new hL(uL.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)})})}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(e=>{n(()=>this.Ar(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}dr(){var e=this;this.state=5,this.ur.Zi(lw(function*(){e.state=0,e.start()}))}Ar(e){return rL("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(rL("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class UV extends BV{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:aL(),s=t.targetChange.targetIds||[],o=function(e,t){return e.C?(cL(void 0===t||"string"==typeof t),LL.fromBase64String(t||"")):(cL(void 0===t||t instanceof Uint8Array),LL.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?uL.UNKNOWN:IB(e.code);return new hL(t,e.message||"")}(a);n=new jB(i,s,o,c||null)}else if("documentChange"in t){const r=t.documentChange,i=cU(e,r.document.name),s=iU(r.document.updateTime),o=new aF({mapValue:{fields:r.document.fields}}),a=lF.newFoundDocument(i,s,o);n=new qB(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=cU(e,r.document),s=r.readTime?iU(r.readTime):TL.min(),o=lF.newNoDocument(i,s);n=new qB([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=cU(e,r.document);n=new qB([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return aL();{const e=t.filter,r=new SB(e.count||0);n=new WB(e.targetId,r)}}var r;return n}(this.k,e),n=function(e){if(!("targetChange"in e))return TL.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?TL.min():t.readTime?iU(t.readTime):TL.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=uU(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=pF(r)?{documents:fU(e,r)}:{query:pU(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=nU(e,t.resumeToken):t.snapshotVersion.compareTo(TL.min())>0&&(n.readTime=tU(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return aL()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=uU(this.k),t.removeTarget=e,this.gr(t)}}class VV extends BV{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(cL(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(cL(void 0!==t),e.map(e=>function(e,t){let n=iU(e.updateTime?e.updateTime:t);return n.isEqual(TL.min())&&(n=iU(t)),new cB(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=iU(e.commitTime);return this.listener.Cr(n,t)}return cL(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=uU(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof yB)n={update:dU(e,t.key,t.value)};else if(t instanceof wB)n={delete:aU(e,t.key)};else if(t instanceof vB)n={update:dU(e,t.key,t.data),updateMask:PU(t.fieldMask)};else{if(!(t instanceof bB))return aL();n={verify:aU(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof XF)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof eB)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof nB)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof iB)return{fieldPath:t.field.canonicalString(),increment:n.N};throw aL()}(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:rU(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:aL()),n;var r}(this.k,e))};this.gr(t)}}class $V extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new hL(uL.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.Bi(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hL(uL.UNKNOWN,e.toString())})}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.ji(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hL(uL.UNKNOWN,e.toString())})}terminate(){this.$r=!0}}class zV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(iL(t),this.Lr=!1):rL("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class HV{constructor(e,t,n,r,i){var s=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(e=>{n.enqueueAndForget(lw(function*(){var e;e$(s)&&(rL("RemoteStore","Restarting streams for network reachability change."),yield(e=lw(function*(e){const t=lL(e);t.Gr.add(4),yield WV(t),t.Jr.set("Unknown"),t.Gr.delete(4),yield GV(t)}),function(t){return e.apply(this,arguments)})(s))}))}),this.Jr=new zV(n,r)}}function GV(e){return qV.apply(this,arguments)}function qV(){return(qV=lw(function*(e){if(e$(e))for(const t of e.zr)yield t(!0)})).apply(this,arguments)}function WV(e){return jV.apply(this,arguments)}function jV(){return(jV=lw(function*(e){for(const t of e.zr)yield t(!1)})).apply(this,arguments)}function ZV(e,t){const n=lL(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),XV(n)?QV(n):I$(n).lr()&&KV(n,t))}function YV(e,t){const n=lL(e),r=I$(n);n.Wr.delete(t),r.lr()&&JV(n,t),0===n.Wr.size&&(r.lr()?r._r():e$(n)&&n.Jr.set("Unknown"))}function KV(e,t){e.Yr.X(t.targetId),I$(e).Pr(t)}function JV(e,t){e.Yr.X(t),I$(e).vr(t)}function QV(e){e.Yr=new YB({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),I$(e).start(),e.Jr.Br()}function XV(e){return e$(e)&&!I$(e).hr()&&e.Wr.size>0}function e$(e){return 0===lL(e).Gr.size}function t$(e){e.Yr=void 0}function n$(e){return r$.apply(this,arguments)}function r$(){return(r$=lw(function*(e){e.Wr.forEach((t,n)=>{KV(e,t)})})).apply(this,arguments)}function i$(e,t){return s$.apply(this,arguments)}function s$(){return(s$=lw(function*(e,t){t$(e),XV(e)?(e.Jr.Kr(t),QV(e)):e.Jr.set("Unknown")})).apply(this,arguments)}function o$(e,t,n){return a$.apply(this,arguments)}function a$(){return(a$=lw(function*(e,t,n){if(e.Jr.set("Online"),t instanceof jB&&2===t.state&&t.cause)try{yield(r=lw(function*(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}),function(e,t){return r.apply(this,arguments)})(e,t)}catch(r){rL("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield c$(e,r)}else if(t instanceof qB?e.Yr.ot(t):t instanceof WB?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(TL.min()))try{const t=yield hV(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(LL.EMPTY_BYTE_STRING,n.snapshotVersion)),JV(e,t);const r=new ZU(n.target,t,1,n.sequenceNumber);KV(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){rL("RemoteStore","Failed to raise snapshot:",r),yield c$(e,r)}var r})).apply(this,arguments)}function c$(e,t,n){return l$.apply(this,arguments)}function l$(){return(l$=lw(function*(e,t,n){if(!qU(t))throw t;e.Gr.add(1),yield WV(e),e.Jr.set("Offline"),n||(n=()=>hV(e.localStore)),e.asyncQueue.enqueueRetryable(lw(function*(){rL("RemoteStore","Retrying IndexedDB access"),yield n(),e.Gr.delete(1),yield GV(e)}))})).apply(this,arguments)}function u$(e,t){return t().catch(n=>c$(e,n,t))}function h$(e){return d$.apply(this,arguments)}function d$(){return(d$=lw(function*(e){const t=lL(e),n=k$(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;f$(t);)try{const e=yield fV(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,p$(t,e)}catch(i){yield c$(t,i)}g$(t)&&m$(t)})).apply(this,arguments)}function f$(e){return e$(e)&&e.Qr.length<10}function p$(e,t){e.Qr.push(t);const n=k$(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function g$(e){return e$(e)&&!k$(e).hr()&&e.Qr.length>0}function m$(e){k$(e).start()}function y$(e){return v$.apply(this,arguments)}function v$(){return(v$=lw(function*(e){k$(e).kr()})).apply(this,arguments)}function _$(e){return C$.apply(this,arguments)}function C$(){return(C$=lw(function*(e){const t=k$(e);for(const n of e.Qr)t.Dr(n.mutations)})).apply(this,arguments)}function E$(e,t,n){return w$.apply(this,arguments)}function w$(){return(w$=lw(function*(e,t,n){const r=e.Qr.shift(),i=jU.from(r,t,n);yield u$(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield h$(e)})).apply(this,arguments)}function b$(e,t){return S$.apply(this,arguments)}function S$(){return(S$=lw(function*(e,t){var n;t&&k$(e).Sr&&(yield(n=lw(function*(e,t){if(TB(n=t.code)&&n!==uL.ABORTED){const n=e.Qr.shift();k$(e).wr(),yield u$(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield h$(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),g$(e)&&m$(e)})).apply(this,arguments)}function P$(e,t){return O$.apply(this,arguments)}function O$(){return(O$=lw(function*(e,t){const n=lL(e);n.asyncQueue.verifyOperationInProgress(),rL("RemoteStore","RemoteStore received new credentials");const r=e$(n);n.Gr.add(3),yield WV(n),r&&n.Jr.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),yield GV(n)})).apply(this,arguments)}function T$(){return(T$=lw(function*(e,t){const n=lL(e);t?(n.Gr.delete(2),yield GV(n)):t||(n.Gr.add(2),yield WV(n),n.Jr.set("Unknown"))})).apply(this,arguments)}function I$(e){return e.Xr||(e.Xr=function(e,t,n){const r=lL(e);return r.Or(),new UV(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:n$.bind(null,e),Ni:i$.bind(null,e),br:o$.bind(null,e)}),e.zr.push(function(){var t=lw(function*(t){t?(e.Xr.wr(),XV(e)?QV(e):e.Jr.set("Unknown")):(yield e.Xr.stop(),t$(e))});return function(e){return t.apply(this,arguments)}}())),e.Xr}function k$(e){return e.Zr||(e.Zr=function(e,t,n){const r=lL(e);return r.Or(),new VV(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:y$.bind(null,e),Ni:b$.bind(null,e),Nr:_$.bind(null,e),Cr:E$.bind(null,e)}),e.zr.push(function(){var t=lw(function*(t){t?(e.Zr.wr(),yield h$(e)):(yield e.Zr.stop(),e.Qr.length>0&&(rL("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))});return function(e){return t.apply(this,arguments)}}())),e.Zr}class A${constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new dL,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new A$(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new hL(uL.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function N$(e,t){if(iL("AsyncQueue",`${t}: ${e}`),qU(e))return new hL(uL.UNAVAILABLE,`${t}: ${e}`);throw e}class M${constructor(e){this.comparator=e?(t,n)=>e(t,n)||WL.comparator(t.key,n.key):(e,t)=>WL.comparator(e.key,t.key),this.keyedMap=FB(),this.sortedSet=new kB(this.comparator)}static emptySet(e){return new M$(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof M$)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new M$;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class x${constructor(){this.eo=new kB(WL.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):aL():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,n)=>{e.push(n)}),e}}class R${constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new R$(e,t,M$.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&VF(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class D${constructor(){this.so=void 0,this.listeners=[]}}class L${constructor(){this.queries=new rV(e=>$F(e),VF),this.onlineState="Unknown",this.io=new Set}}function F$(e,t){return B$.apply(this,arguments)}function B$(){return(B$=lw(function*(e,t){const n=lL(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new D$),i)try{s.so=yield n.onListen(r)}catch(o){const e=N$(o,`Initialization of query '${zF(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&H$(n)})).apply(this,arguments)}function U$(e,t){return V$.apply(this,arguments)}function V$(){return(V$=lw(function*(e,t){const n=lL(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)})).apply(this,arguments)}function $$(e,t){const n=lL(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.oo(i)&&(r=!0);e.so=i}}r&&H$(n)}function z$(e,t,n){const r=lL(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function H$(e){e.io.forEach(e=>{e.next()})}class G${constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new R$(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=R$.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class q${constructor(e){this.key=e}}class W${constructor(e){this.key=e}}class j${constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=VB(),this.mutatedKeys=VB(),this.Ao=GF(e),this.Ro=new M$(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new x$,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=MF(this.query)&&r.size===this.query.limit?r.last():null,c=xF(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const l=r.get(e),u=HF(this.query,t)?t:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.Vo(l,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ao(u,a)>0||c&&this.Ao(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),MF(this.query)||xF(this.query))for(;s.size>this.query.limit;){const e=MF(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return aL()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc)),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new R$(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new x$,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(e=>this.To=this.To.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.To=this.To.delete(e)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=VB(),this.Ro.forEach(e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))});const t=[];return e.forEach(e=>{this.Io.has(e)||t.push(new W$(e))}),this.Io.forEach(n=>{e.has(n)||t.push(new q$(n))}),t}ko(e){this.To=e.zn,this.Io=VB();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return R$.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Z${constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Y${constructor(e){this.key=e,this.$o=!1}}class K${constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new rV(e=>$F(e),VF),this.Fo=new Map,this.Lo=new Set,this.Bo=new kB(WL.comparator),this.Uo=new Map,this.qo=new _V,this.Ko={},this.jo=new Map,this.Qo=eV.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function J$(e,t){return Q$.apply(this,arguments)}function Q$(){return(Q$=lw(function*(e,t){const n=Pz(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=yield pV(n.localStore,BF(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=yield X$(n,t,r,"current"===s),n.isPrimaryClient&&ZV(n.remoteStore,e)}return i})).apply(this,arguments)}function X$(e,t,n,r){return ez.apply(this,arguments)}function ez(){return(ez=lw(function*(e,t,n,r){e.Go=(t,n,r)=>{return(i=lw(function*(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=yield yV(e.localStore,t.query,!1).then(({documents:e})=>t.view.Po(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return yz(e,t.targetId,o.Co),o.snapshot}),function(e,t,n,r){return i.apply(this,arguments)})(e,t,n,r);var i};const i=yield yV(e.localStore,t,!0),s=new j$(t,i.zn),o=s.Po(i.documents),a=GB.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);yz(e,n,c.Co);const l=new Z$(t,n,s);return e.Mo.set(t,l),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),c.snapshot})).apply(this,arguments)}function tz(e,t){return nz.apply(this,arguments)}function nz(){return(nz=lw(function*(e,t){const n=lL(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter(e=>!VF(e,t))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield gV(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),YV(n.remoteStore,r.targetId),gz(n,r.targetId)}).catch(tV))):(gz(n,r.targetId),yield gV(n.localStore,r.targetId,!0))})).apply(this,arguments)}function rz(){return(rz=lw(function*(e,t,n){const r=Oz(e);try{const e=yield function(e,t){const n=lL(e),r=OL.now(),i=t.reduce((e,t)=>e.add(t.key),VB());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Wn.vn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=pB(e,s.get(e.key));null!=t&&o.push(new vB(e.key,t,cF(t.value.mapValue),lB.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new kB(SL)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),yield Cz(r,e.changes),yield h$(r.remoteStore)}catch(i){const e=N$(i,"Failed to persist write");n.reject(e)}})).apply(this,arguments)}function iz(e,t){return sz.apply(this,arguments)}function sz(){return(sz=lw(function*(e,t){const n=lL(e);try{const e=yield dV(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Uo.get(t);r&&(cL(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?cL(r.$o):e.removedDocuments.size>0&&(cL(r.$o),r.$o=!1))}),yield Cz(n,e,t)}catch(r){yield tV(r)}})).apply(this,arguments)}function oz(e,t,n){const r=lL(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=lL(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)}),r&&H$(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function az(e,t,n){return cz.apply(this,arguments)}function cz(){return(cz=lw(function*(e,t,n){const r=lL(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new kB(WL.comparator);e=e.insert(s,lF.newNoDocument(s,TL.min()));const n=VB().add(s),i=new HB(TL.min(),new Map,new MB(SL),e,n);yield iz(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),_z(r)}else yield gV(r.localStore,t,!1).then(()=>gz(r,t,n)).catch(tV)})).apply(this,arguments)}function lz(e,t){return uz.apply(this,arguments)}function uz(){return(uz=lw(function*(e,t){const n=lL(e),r=t.batch.batchId;try{const e=yield uV(n.localStore,t);pz(n,r,null),fz(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Cz(n,e)}catch(i){yield tV(i)}})).apply(this,arguments)}function hz(e,t,n){return dz.apply(this,arguments)}function dz(){return(dz=lw(function*(e,t,n){const r=lL(e);try{const e=yield function(e,t){const n=lL(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.An.lookupMutationBatch(e,t).next(t=>(cL(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t))).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(r.localStore,t);pz(r,t,n),fz(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield Cz(r,e)}catch(i){yield tV(i)}})).apply(this,arguments)}function fz(e,t){(e.jo.get(t)||[]).forEach(e=>{e.resolve()}),e.jo.delete(t)}function pz(e,t,n){const r=lL(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function gz(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach(t=>{e.qo.containsKey(t)||mz(e,t)})}function mz(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(YV(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),_z(e))}function yz(e,t,n){for(const r of n)r instanceof q$?(e.qo.addReference(r.key,t),vz(e,r)):r instanceof W$?(rL("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||mz(e,r.key)):aL()}function vz(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(rL("SyncEngine","New document in limbo: "+n),e.Lo.add(r),_z(e))}function _z(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new WL(ML.fromString(t)),r=e.Qo.next();e.Uo.set(r,new Y$(n)),e.Bo=e.Bo.insert(n,r),ZV(e.remoteStore,new ZU(BF(NF(n.path)),r,2,EL.I))}}function Cz(e,t,n){return Ez.apply(this,arguments)}function Ez(){return(Ez=lw(function*(e,t,n){const r=lL(e),i=[],s=[],o=[];var a;r.Mo.isEmpty()||(r.Mo.forEach((e,a)=>{o.push(r.Go(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=sV.$n(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),r.Oo.br(i),yield(a=lw(function*(e,t){const n=lL(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>GU.forEach(t,t=>GU.forEach(t.kn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>GU.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!qU(r))throw r;rL("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.qn.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.qn=n.qn.insert(e,r)}}}),function(e,t){return a.apply(this,arguments)})(r.localStore,s))})).apply(this,arguments)}function wz(e,t){return bz.apply(this,arguments)}function bz(){return(bz=lw(function*(e,t){const n=lL(e);if(!n.currentUser.isEqual(t)){rL("SyncEngine","User change. New user:",t.toKey());const e=yield cV(n.localStore,t);n.currentUser=t,(r=n).jo.forEach(e=>{e.forEach(e=>{e.reject(new hL(uL.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.jo.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield Cz(n,e.Gn)}var r})).apply(this,arguments)}function Sz(e,t){const n=lL(e),r=n.Uo.get(t);if(r&&r.$o)return VB().add(r.key);{let e=VB();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}function Pz(e){const t=lL(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=iz.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sz.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=az.bind(null,t),t.Oo.br=$$.bind(null,t.eventManager),t.Oo.zo=z$.bind(null,t.eventManager),t}function Oz(e){const t=lL(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=lz.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=hz.bind(null,t),t}class Tz{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return lw(function*(){t.k=LV(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return function(e,t,n,r){return new aV(e,t,n,r)}(this.persistence,new oV,e.initialUser,this.k)}Yo(e){return new PV(TV.ks,this.k)}Jo(e){return new kV}terminate(){var e=this;return lw(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Iz{initialize(e,t){var n=this;return lw(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>oz(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=wz.bind(null,n.syncEngine),yield function(e,t){return T$.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new L$}createDatastore(e){const t=LV(e.databaseInfo.databaseId),n=new RV(e.databaseInfo);return new $V(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>oz(this.syncEngine,e,0),s=NV.Pt()?new NV:new AV,new HV(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new K$(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=lw(function*(e){const t=lL(e);rL("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),yield WV(t),t.Hr.shutdown(),t.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class kz{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Az{constructor(e,t,n,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=XD.UNAUTHENTICATED,this.clientId=bL.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var e=lw(function*(e){rL("FirestoreClient","Received user=",e.uid),yield i.authCredentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(n,e=>(rL("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}getConfiguration(){var e=this;return lw(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new hL(uL.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new dL;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(lw(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const e=N$(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function Nz(e,t){return Mz.apply(this,arguments)}function Mz(){return(Mz=lw(function*(e,t){e.asyncQueue.verifyOperationInProgress(),rL("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(function(){var e=lw(function*(e){r.isEqual(e)||(yield cV(t.localStore,e),r=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function xz(e,t){return Rz.apply(this,arguments)}function Rz(){return(Rz=lw(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield Dz(e);rL("FirestoreClient","Initializing OnlineComponentProvider");const r=yield e.getConfiguration();yield t.initialize(n,r),e.setCredentialChangeListener(e=>P$(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>P$(t.remoteStore,n)),e.onlineComponents=t})).apply(this,arguments)}function Dz(e){return Lz.apply(this,arguments)}function Lz(){return(Lz=lw(function*(e){return e.offlineComponents||(rL("FirestoreClient","Using default OfflineComponentProvider"),yield Nz(e,new Tz)),e.offlineComponents})).apply(this,arguments)}function Fz(e){return Bz.apply(this,arguments)}function Bz(){return(Bz=lw(function*(e){return e.onlineComponents||(rL("FirestoreClient","Using default OnlineComponentProvider"),yield xz(e,new Iz)),e.onlineComponents})).apply(this,arguments)}function Uz(e){return Vz.apply(this,arguments)}function Vz(){return(Vz=lw(function*(e){const t=yield Fz(e),n=t.eventManager;return n.onListen=J$.bind(null,t.syncEngine),n.onUnlisten=tz.bind(null,t.syncEngine),n})).apply(this,arguments)}class $z{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class zz{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof zz&&e.projectId===this.projectId&&e.database===this.database}}const Hz=new Map;function Gz(e,t,n){if(!n)throw new hL(uL.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function qz(e){if(!WL.isDocumentKey(e))throw new hL(uL.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Wz(e){if(WL.isDocumentKey(e))throw new hL(uL.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function jz(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":aL()}function Zz(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new hL(uL.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=jz(e);throw new hL(uL.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Yz{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new hL(uL.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new hL(uL.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new hL(uL.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Kz{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yz({}),this._settingsFrozen=!1,e instanceof zz?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new hL(uL.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zz(e.options.projectId)}(e))}get app(){if(!this._app)throw new hL(uL.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new hL(uL.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yz(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new pL;switch(e.type){case"gapi":const t=e.client;return cL(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new vL(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new hL(uL.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Hz.get(e);t&&(rL("ComponentProvider","Removing Datastore"),Hz.delete(e),t.terminate())}(this),Promise.resolve()}}function Jz(e,t,n,r={}){var i;const s=(e=Zz(e,Kz))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&sL("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=XD.MOCK_USER;else{t=Tw(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new hL(uL.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new XD(s)}e._authCredentials=new gL(new fL(t,n))}}class Qz{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new eH(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qz(this.firestore,e,this._key)}}class Xz{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xz(this.firestore,e,this._query)}}class eH extends Xz{constructor(e,t,n){super(e,t,NF(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qz(this.firestore,null,new WL(e))}withConverter(e){return new eH(this.firestore,e,this._path)}}function tH(e,t,...n){if(e=rb(e),Gz("collection","path",t),e instanceof Kz){const r=ML.fromString(t,...n);return Wz(r),new eH(e,null,r)}{if(!(e instanceof Qz||e instanceof eH))throw new hL(uL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ML.fromString(t,...n));return Wz(r),new eH(e.firestore,null,r)}}function nH(e,t,...n){if(e=rb(e),1===arguments.length&&(t=bL.A()),Gz("doc","path",t),e instanceof Kz){const r=ML.fromString(t,...n);return qz(r),new Qz(e,null,new WL(r))}{if(!(e instanceof Qz||e instanceof eH))throw new hL(uL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ML.fromString(t,...n));return qz(r),new Qz(e.firestore,e instanceof eH?e.converter:null,new WL(r))}}class rH{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new FV(this,"async_queue_retry"),this.bc=()=>{const e=DV();e&&rL("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=DV();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=DV();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new dL;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}Vc(){var e=this;return lw(function*(){if(0!==e.gc.length){try{yield e.gc[0](),e.gc.shift(),e.ur.reset()}catch(t){if(!qU(t))throw t;rL("AsyncQueue","Operation failed with retryable error: "+t)}e.gc.length>0&&e.ur.Zi(()=>e.Vc())}})()}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(e=>{throw this.Ec=e,this.Ic=!1,iL("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ic=!1,e))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=A$.createAndSchedule(this,e,t,n,e=>this.Sc(e));return this.Tc.push(r),r}Pc(){this.Ec&&aL()}verifyOperationInProgress(){}Dc(){var e=this;return lw(function*(){let t;do{t=e.mc,yield t}while(t!==e.mc)})()}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function iH(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class sH extends Kz{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new rH,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||cH(this),this._firestoreClient.terminate()}}function oH(e=kb()){return Sb(e,"firestore").getImmediate()}function aH(e){return e._firestoreClient||cH(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function cH(e){var t;const n=e._freezeSettings(),r=(i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new $z(e._databaseId,i,e._persistenceKey,(s=n).host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));var i,s;e._firestoreClient=new Az(e._authCredentials,e._appCheckCredentials,e._queue,r)}class lH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new hL(uL.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new RL(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class uH{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uH(LL.fromBase64String(e))}catch(t){throw new hL(uL.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new uH(LL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class hH{constructor(e){this._methodName=e}}class dH{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new hL(uL.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new hL(uL.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return SL(this._lat,e._lat)||SL(this._long,e._long)}}const fH=/^__.*__$/;class pH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new vB(e,this.data,this.fieldMask,t,this.fieldTransforms):new yB(e,this.data,t,this.fieldTransforms)}}class gH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new vB(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function mH(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw aL()}}class yH{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new yH(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return AH(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(mH(this.$c)&&fH.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class vH{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||LV(e)}Qc(e,t,n,r=!1){return new yH({$c:e,methodName:t,jc:n,path:RL.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function _H(e){const t=e._freezeSettings(),n=LV(e._databaseId);return new vH(e._databaseId,!!t.ignoreUndefinedProperties,n)}function CH(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);OH("Data must be an object, but it was:",o,r);const a=SH(r,o);let c,l;if(s.merge)c=new DL(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=TH(t,r,n);if(!o.contains(i))throw new hL(uL.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);NH(e,i)||e.push(i)}c=new DL(e),l=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=o.fieldTransforms;return new pH(new aF(a),c,l)}class EH extends hH{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof EH}}class wH extends hH{_toFieldTransform(e){return new aB(e.path,new XF)}isEqual(e){return e instanceof wH}}function bH(e,t){if(PH(e=rb(e)))return OH("Unsupported field value:",t,e),SH(e,t);if(e instanceof hH)return function(e,t){if(!mH(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=bH(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=rb(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ZF(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=OL.fromDate(e);return{timestampValue:tU(t.k,n)}}if(e instanceof OL){const n=new OL(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:tU(t.k,n)}}if(e instanceof dH)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uH)return{bytesValue:nU(t.k,e._byteString)};if(e instanceof Qz){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:sU(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${jz(e)}`)}(e,t)}function SH(e,t){const n={};return AL(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):kL(e,(e,r)=>{const i=bH(r,t.Mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function PH(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof OL||e instanceof dH||e instanceof uH||e instanceof Qz||e instanceof hH)}function OH(e,t,n){if(!PH(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=jz(n);throw t.qc("an object"===r?e+" a custom object":e+" "+r)}var r}function TH(e,t,n){if((t=rb(t))instanceof lH)return t._internalPath;if("string"==typeof t)return kH(e,t);throw AH("Field path arguments must be of type string or ",e,!1,void 0,n)}const IH=new RegExp("[~\\*/\\[\\]]");function kH(e,t,n){if(t.search(IH)>=0)throw AH(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lH(...t.split("."))._internalPath}catch{throw AH(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function AH(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new hL(uL.INVALID_ARGUMENT,a+e+c)}function NH(e,t){return e.some(e=>e.isEqual(t))}class MH{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Qz(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new xH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(RH("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class xH extends MH{data(){return super.data()}}function RH(e,t){return"string"==typeof t?kH(e,t):t instanceof lH?t._internalPath:t._delegate._internalPath}class DH{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class LH extends MH{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new FH(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(RH("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class FH extends LH{data(e={}){return super.data(e)}}class BH{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new DH(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new FH(this._firestore,this._userDataWriter,n.key,n,new DH(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new hL(uL.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new FH(e._firestore,e._userDataWriter,n.doc.key,n.doc,new DH(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new FH(e._firestore,e._userDataWriter,t.doc.key,t.doc,new DH(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:UH(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function UH(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return aL()}}function VH(e){if(xF(e)&&0===e.explicitOrderBy.length)throw new hL(uL.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $H{}function zH(e,...t){for(const n of t)e=n._apply(e);return e}class HH extends $H{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=_H(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new hL(uL.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){KH(o,s);const t=[];for(const n of o)t.push(YH(r,e,n));a={arrayValue:{values:t}}}else a=YH(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||KH(o,s),a=function(e,t,n,r=!1){return bH(n,e.Qc(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);const c=gF.create(i,s,a);return function(e,t){if(t.V()){const n=DF(e);if(null!==n&&!n.isEqual(t.field))throw new hL(uL.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=RF(e);null!==r&&JH(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new hL(uL.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Xz(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new AF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function GH(e,t,n){const r=t,i=RH("where",e);return new HH(i,r,n)}class qH extends $H{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new hL(uL.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new hL(uL.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new OF(t,n);return function(e,t){if(null===RF(e)){const n=DF(e);null!==n&&JH(0,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new Xz(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new AF(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function WH(e,t="asc"){const n=t,r=RH("orderBy",e);return new qH(r,n)}class jH extends $H{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new Xz(e.firestore,e.converter,UF(e._query,this.Xc,this.Zc))}}function ZH(e){return function(e,t){if(t<=0)throw new hL(uL.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),new jH("limit",e,"F")}function YH(e,t,n){if("string"==typeof(n=rb(n))){if(""===n)throw new hL(uL.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!LF(t)&&-1!==n.indexOf("/"))throw new hL(uL.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ML.fromString(n));if(!WL.isDocumentKey(r))throw new hL(uL.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return eF(e,new WL(r))}if(n instanceof Qz)return eF(e,n._key);throw new hL(uL.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jz(n)}.`)}function KH(e,t){if(!Array.isArray(e)||0===e.length)throw new hL(uL.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new hL(uL.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function JH(e,t,n){if(!n.isEqual(t))throw new hL(uL.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function QH(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function XH(e){e=Zz(e,Qz);const t=Zz(e.firestore,sH);return function(e,t,n={}){const r=new dL;return e.asyncQueue.enqueueAndForget(lw(function*(){return function(e,t,n,r,i){const s=new kz({next:s=>{t.enqueueAndForget(()=>U$(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new hL(uL.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new hL(uL.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new G$(NF(n.path),s,{includeMetadataChanges:!0,wo:!0});return F$(e,o)}(yield Uz(e),e.asyncQueue,t,n,r)})),r.promise}(aH(t),e._key).then(n=>cG(t,e,n))}class eG extends class{convertValue(e,t="none"){switch(jL(e)){case 0:return null;case 1:return e.booleanValue;case 2:return UL(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(VL(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw aL()}}convertObject(e,t){const n={};return kL(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new dH(UL(e.latitude),UL(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=zL(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(HL(e));default:return null}}convertTimestamp(e){const t=BL(e);return new OL(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ML.fromString(e);cL(OU(n));const r=new zz(n.get(1),n.get(3)),i=new WL(n.popFirst(5));return r.isEqual(t)||iL(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new uH(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qz(this.firestore,null,t)}}function tG(e){e=Zz(e,Xz);const t=Zz(e.firestore,sH),n=aH(t),r=new eG(t);return VH(e._query),function(e,t,n={}){const r=new dL;return e.asyncQueue.enqueueAndForget(lw(function*(){return function(e,t,n,r,i){const s=new kz({next:n=>{t.enqueueAndForget(()=>U$(e,o)),n.fromCache&&"server"===r.source?i.reject(new hL(uL.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new G$(n,s,{includeMetadataChanges:!0,wo:!0});return F$(e,o)}(yield Uz(e),e.asyncQueue,t,n,r)})),r.promise}(n,e._query).then(n=>new BH(t,r,e,n))}function nG(e,t,n){e=Zz(e,Qz);const r=Zz(e.firestore,sH),i=QH(e.converter,t,n);return aG(r,[CH(_H(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,lB.none())])}function rG(e,t,n,...r){e=Zz(e,Qz);const i=Zz(e.firestore,sH),s=_H(i);let o;return o="string"==typeof(t=rb(t))||t instanceof lH?function(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[TH(t,r,n)],c=[i];if(s.length%2!=0)throw new hL(uL.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(TH(t,s[d])),c.push(s[d+1]);const l=[],u=aF.empty();for(let d=a.length-1;d>=0;--d)if(!NH(l,a[d])){const e=a[d];let t=c[d];t=rb(t);const n=o.Bc(e);if(t instanceof EH)l.push(e);else{const r=bH(t,n);null!=r&&(l.push(e),u.set(e,r))}}const h=new DL(l);return new gH(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qc(1,t,n);OH("Data must be an object, but it was:",i,r);const s=[],o=aF.empty();kL(r,(e,r)=>{const a=kH(t,e,n);r=rb(r);const c=i.Bc(a);if(r instanceof EH)s.push(a);else{const e=bH(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new DL(s);return new gH(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),aG(i,[o.toMutation(e._key,lB.exists(!0))])}function iG(e){return aG(Zz(e.firestore,sH),[new wB(e._key,lB.none())])}function sG(e,t){const n=Zz(e.firestore,sH),r=nH(e),i=QH(e.converter,t);return aG(n,[CH(_H(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,lB.exists(!1))]).then(()=>r)}function oG(e,...t){var n,r,i;e=rb(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||iH(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(iH(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,l,u;if(e instanceof Qz)l=Zz(e.firestore,sH),u=NF(e._key.path),c={next:n=>{t[o]&&t[o](cG(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Zz(e,Xz);l=Zz(n.firestore,sH),u=n._query;const r=new eG(l);c={next:e=>{t[o]&&t[o](new BH(l,r,n,e))},error:t[o+1],complete:t[o+2]},VH(e._query)}return function(e,t,n,r){const i=new kz(r),s=new G$(t,i,n);return e.asyncQueue.enqueueAndForget(lw(function*(){return F$(yield Uz(e),s)})),()=>{i.nc(),e.asyncQueue.enqueueAndForget(lw(function*(){return U$(yield Uz(e),s)}))}}(aH(l),u,a,c)}function aG(e,t){return function(e,t){const n=new dL;return e.asyncQueue.enqueueAndForget(lw(function*(){return function(e,t,n){return rz.apply(this,arguments)}(yield function(e){return Fz(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(aH(e),t)}function cG(e,t,n){const r=n.docs.get(t._key),i=new eG(e);return new LH(e,i,t._key,r,new DH(n.hasPendingWrites,n.fromCache),t.converter)}function lG(){return new wH("serverTimestamp")}!function(e,t=!0){eL="9.6.6",bb(new ib("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new sH(r,new mL(e.getProvider("auth-internal")),new CL(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),Nb(QD,"3.4.4",e),Nb(QD,"3.4.4","esm2017")}();class uG{constructor(e){return e}}const hG=new or("angularfire2.firestore-instances");function dG(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new uG(r)}}const fG={provide:class{constructor(){return uT("firestore")}},deps:[[new Mr,hG]]},pG={provide:uG,useFactory:function(e,t){const n=lT("firestore",e,t);return n&&new uG(n)},deps:[[new Mr,hG],ET]};let gG=(()=>{class e{constructor(){Nb("angularfire",sT.full,"fst")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[pG,fG]}),e})();const mG=CT(sG,!0),yG=CT(tH,!0),vG=CT(Jz,!0),_G=CT(iG,!0),CG=CT(nH,!0),EG=CT(XH,!0),wG=CT(tG,!0),bG=CT(oH,!0),SG=CT(ZH,!0),PG=CT(oG,!0),OG=CT(WH,!0),TG=CT(zH,!0),IG=CT(nG,!0),kG=CT(rG,!0),AG=CT(GH,!0);let NG=(()=>{class e{constructor(e,t){this.collectionName=e,this.firestore=t,this.subDAOs={};this.collection=yG(t,this.collectionName).withConverter({fromFirestore:e=>e.data(),toFirestore:e=>e})}create(e){var t=this;return lw(function*(){return(yield mG(t.collection,e)).id})()}read(e){var t=this;return lw(function*(){const n=yield EG(CG(t.collection,e));return n.exists()?gw.of(uw.getNonNullable(n.data())):gw.empty()})()}exists(e){var t=this;return lw(function*(){return(yield t.read(e)).isPresent()})()}update(e,t){var n=this;return lw(function*(){return kG(CG(n.collection,e),t)})()}delete(e){return _G(CG(this.collection,e))}set(t,n){return hw(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),IG(CG(this.collection,t),n)}subscribeToChanges(e,t){return PG(CG(this.collection,e),e=>{t(gw.ofNullable(e.data()))})}findWhere(e,t,n){var r=this;return lw(function*(){const i=r.constructQuery(e,t,n);return(yield wG(i)).docs.map(e=>({id:e.id,data:e.data()}))})()}observingWhere(t,n,r){const i=this.constructQuery(t,r);return PG(i,t=>{const r=[],i=[],s=[];t.docChanges().forEach(e=>{const t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":i.push(t);break;case"removed":s.push(t)}}),r.length>0&&(hw(e.VERBOSE,"firebase gave us "+r.length+" NEW "+this.collectionName),n.onDocumentCreated(r)),i.length>0&&(hw(e.VERBOSE,"firebase gave us "+i.length+" MODIFIED "+this.collectionName),n.onDocumentModified(i)),s.length>0&&(hw(e.VERBOSE,"firebase gave us "+s.length+" DELETED "+this.collectionName),n.onDocumentDeleted(s))})}constructQuery(e,t,n){let r=TG(this.collection);null!=t&&(r=TG(r,OG(t))),null!=n&&(r=TG(r,SG(n)));for(const i of e)r=TG(r,AG(i[0],i[1],i[2]));return r}subCollectionDAO(t,n){const r=`${this.collection.path}/${t}/${n}`;if(r in this.subDAOs)return this.subDAOs[r];{const t=new class extends e{constructor(e){super(r,e)}}(this.firestore);return this.subDAOs[r]=t,t}}}return e.VERBOSE=!1,e})();class MG{static success(e){return new xG(e)}static failure(e){return new RG(e)}constructor(){}equals(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&pw(this.get(),e.get())}}class xG extends MG{constructor(e){super(),this.value=e}isSuccess(){return!0}isFailure(){return!1}get(){return this.value}getReason(){throw new Error("Cannot get failure reason from a success")}getReasonOr(e){return e}toOptional(){return gw.of(this.value)}toString(){return`MGPFallible.success(${this.value})`}}class RG extends MG{constructor(e){super(),this.reason=e}isSuccess(){return!1}isFailure(){return!0}get(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}getReason(){return this.reason}getReasonOr(e){return this.getReason()}toOptional(){return gw.empty()}toString(){return`MGPFallible.failure(${this.reason})`}}class DG{constructor(e){this.reason=e}static ofFallible(e){return e.isSuccess()?DG.SUCCESS:DG.failure(e.getReason())}static failure(e){return new DG(e)}isFailure(){return!1===this.isSuccess()}isSuccess(){return null==this.reason}getReason(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}toFallible(e){return this.isSuccess()?MG.success(e):MG.failure(this.getReason())}toFailedFallible(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return MG.failure(this.getReason())}}DG.SUCCESS=new DG(null);let LG=(()=>{class e extends NG{constructor(e){super("errors",e)}findErrors(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}return e.\u0275fac=function(t){return new(t||e)(Or(uG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var FG=n(5378);let BG=(()=>{class e{infoMessage(e){this.message(e,"is-info")}gameMessage(e){this.message(e,"is-warning")}criticalMessage(e){this.message(e,"is-danger")}message(e,t){(0,FG.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class UG{constructor(e,t,n){this.errorDAO=e,this.router=t,this.messageDisplayer=n,UG.setSingletonInstance(this)}static setSingletonInstance(e){UG.singleton=gw.of(e)}static logErrorAndFail(e,t,n){throw UG.logError(e,t,n),new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`)}static logError(e,t,n){if(this.singleton.isAbsent())throw new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`);return this.singleton.get().logError(e,t,n),DG.failure(e+": "+t)}logError(e,t,n){var r=this;return lw(function*(){r.messageDisplayer.criticalMessage($localize`An unexpected error was encountered. We have logged it and will try to fix its cause as soon as possible.`);const i=r.router.url,s=yield r.errorDAO.findErrors(e,i,t,n);if(0===s.length){const s={component:e,route:i,message:t,firstEncounter:lG(),lastEncounter:lG(),occurences:1};null!=n&&(s.data=n),yield r.errorDAO.create(s)}else{const e=s[0].id,t=s[0].data;yield r.errorDAO.update(e,{lastEncounter:lG(),occurences:t.occurences+1})}})()}}function VG(e,t){if(!1===e)throw UG.logError("Assertion failure",t),new Error(`Assertion failure: ${t}`)}UG.singleton=gw.empty(),UG.\u0275fac=function(e){return new(e||UG)(Or(LG),Or(Qv),Or(BG))},UG.\u0275prov=be({token:UG,factory:UG.\u0275fac,providedIn:"root"});class $G{constructor(e){this.value=e}}$G.HARD_DRAW=new $G(0),$G.RESIGN=new $G(1),$G.ESCAPE=new $G(2),$G.VICTORY=new $G(3),$G.TIMEOUT=new $G(4),$G.UNACHIEVED=new $G(5),$G.AGREED_DRAW_BY_ZERO=new $G(6),$G.AGREED_DRAW_BY_ONE=new $G(7);class zG{constructor(e,t){this.id=e,this.data=t}getTurn(){return this.data.turn}isHardDraw(){return this.data.result===$G.HARD_DRAW.value}isAgreedDraw(){return this.data.result===$G.AGREED_DRAW_BY_ZERO.value||this.data.result===$G.AGREED_DRAW_BY_ONE.value}getDrawAccepter(){return this.data.result===$G.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(VG(this.data.result===$G.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),uw.getNonNullable(this.data.playerOne))}isWin(){return this.data.result===$G.VICTORY.value}isTimeout(){return this.data.result===$G.TIMEOUT.value}isResign(){return this.data.result===$G.RESIGN.value}getWinner(){return gw.ofNullable(this.data.winner)}getLoser(){return gw.ofNullable(this.data.loser)}setWinnerAndLoser(e,t){return new zG(this.id,{...this.data,winner:e,loser:t})}}let HG=(()=>{class e extends NG{constructor(t){super("parties",t),hw(e.VERBOSE,"PartDAO.constructor")}updateAndBumpIndex(e,t,n,r){var i=this;return lw(function*(){return r={...r,lastUpdate:{index:n+1,player:t.value}},i.update(e,r)})()}observeActiveParts(e){return this.observingWhere([["result","==",$G.UNACHIEVED.value]],e)}userHasActivePart(e){var t=this;return lw(function*(){const n=yield t.findWhere([["playerZero","==",e],["result","==",$G.UNACHIEVED.value]]),r=yield t.findWhere([["playerOne","==",e],["result","==",$G.UNACHIEVED.value]]);return n.length>0||r.length>0})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(uG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),GG=(()=>{class e extends NG{constructor(t){super("chats",t),hw(e.VERBOSE,"ChatDAO.constructor")}addMessage(e,t){var n=this;return lw(function*(){return n.subCollectionDAO(e,"messages").create(t)})()}getLastMessages(e,t){var n=this;return lw(function*(){return n.subCollectionDAO(e,"messages").findWhere([],"postedTime",t)})()}subscribeToMessages(e,t){return this.subCollectionDAO(e,"messages").observingWhere([],t,"postedTime")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(uG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),qG=(()=>{class e{}return e.CANNOT_SEND_MESSAGE=()=>$localize`You're not allowed to send a message here.`,e.FORBIDDEN_MESSAGE=()=>$localize`This message is forbidden.`,e})(),WG=(()=>{class e{constructor(t){this.chatDAO=t,this.followedChatId=gw.empty(),hw(e.VERBOSE,"ChatService.constructor")}startObserving(t,n){hw(e.VERBOSE,"ChatService.startObserving "+t),this.followedChatId.isAbsent()?(hw(e.VERBOSE,"[start watching chat "+t),this.followedChatId=gw.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToMessages(t,n)):this.followedChatId.equalsValue(t)?UG.logErrorAndFail("ChatService","Already observing same chat",{chatId:t}):UG.logErrorAndFail("ChatService","Already observing another chat",{chatId:t,followedChatId:this.followedChatId.get()})}stopObserving(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");hw(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=gw.empty(),this.followedChatUnsubscribe()}isObserving(){return this.followedChatId.isPresent()}deleteChat(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)})()}createNewChat(e){var t=this;return lw(function*(){return t.chatDAO.set(e,{})})()}sendMessage(e,t,n){var r=this;return lw(function*(){if(r.followedChatId.isAbsent())return DG.failure("Cannot send message if not observing chat");const i=r.followedChatId.get();if(!1===r.userCanSendMessage(e.name,i))return DG.failure(qG.CANNOT_SEND_MESSAGE());if(r.isForbiddenMessage(t))return DG.failure(qG.FORBIDDEN_MESSAGE());const s={content:t,sender:e,postedTime:lG(),currentTurn:n};return yield r.chatDAO.addMessage(i,s),DG.SUCCESS})()}userCanSendMessage(e,t){return""!==e}isForbiddenMessage(e){return""===e}ngOnDestroy(){this.isObserving()&&this.stopObserving()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(GG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class jG{constructor(e,t,n){this.onDocumentCreated=e,this.onDocumentModified=t,this.onDocumentDeleted=n}}let ZG=(()=>{class e extends NG{constructor(t){super(e.COLLECTION_NAME,t),hw(e.VERBOSE,"UserDAO.constructor")}usernameIsAvailable(e){var t=this;return lw(function*(){return 0===(yield t.findWhere([["username","==",e]])).length})()}setUsername(e,t){var n=this;return lw(function*(){yield n.update(e,{username:t})})()}markVerified(e){var t=this;return lw(function*(){yield t.update(e,{verified:!0})})()}observeUserByUsername(e,t){return this.observingWhere([["username","==",e]],t)}observeActiveUsers(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}updatePresenceToken(e){return this.update(e,{last_changed:lG()})}}return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(Or(uG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),YG=(()=>{class e{constructor(e){this.userDAO=e,this.activeUsersBS=new sm([]),this.activeUsersObs=this.activeUsersBS.asObservable()}startObserving(){hw(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");const t=new jG(t=>{hw(e.VERBOSE,"our DAO gave us "+t.length+" new user(s)");const n=this.activeUsersBS.value.concat(...t);this.activeUsersBS.next(this.sort(n))},t=>{let n=this.activeUsersBS.value;hw(e.VERBOSE,"our DAO updated "+t.length+" user(s)");for(const e of t)n.forEach(t=>{t.id===e.id&&(t.data=e.data)}),n=this.sort(n);this.activeUsersBS.next(n)},e=>{const t=this.activeUsersBS.value.filter(t=>!e.some(e=>e.id===t.id));this.activeUsersBS.next(this.sort(t))});this.unsubscribe=this.userDAO.observeActiveUsers(t)}stopObserving(){this.unsubscribe(),this.activeUsersBS.next([])}sort(e){return e.sort((e,t)=>{const n=uw.getNonNullable(e.data).last_changed,r=uw.getNonNullable(n).seconds,i=uw.getNonNullable(t.data).last_changed;return r-uw.getNonNullable(i).seconds})}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(ZG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),KG=(()=>{class e{constructor(e,t){this.activeUsersService=e,this.userDAO=t}getActiveUsersObs(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}unSubFromActiveUsersObs(){this.activeUsersService.stopObserving()}observeUserByUsername(e,t){return this.userDAO.observeUserByUsername(e,t)}observeUser(e,t){return this.userDAO.subscribeToChanges(e,t)}getUserLastChanged(e){var t=this;return lw(function*(){const n=yield t.userDAO.read(e);if(n.isAbsent())return gw.empty();{const e=n.get().last_changed;return VG(null!=e,"should not receive a last_changed equal to null"),gw.of(e)}})()}}return e.\u0275fac=function(t){return new(t||e)(Or(YG),Or(ZG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class JG extends A{constructor(e=1/0,t=1/0,n=eT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:i,_windowTime:s}=this;t||(n.push(e),!r&&n.push(i.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:r}=this,i=r.slice();for(let s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2)r=t;r&&n.splice(0,r+1)}}}const QG="@firebase/database";let XG="";class eq{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Vw(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Uw(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class tq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return zw(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const nq=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new eq(t)}}catch{}return new tq},rq=nq("localStorage"),iq=nq("sessionStorage"),sq=new pb("@firebase/database"),oq=function(){let e=1;return function(){return e++}}(),aq=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,mw(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new Jw;n.update(t);const r=n.digest();return _w.encodeByteArray(r)},cq=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=cq.apply(null,r):t+="object"==typeof r?Vw(r):r,t+=" "}return t};let lq=null,uq=!0;const hq=function(...e){if(!0===uq&&(uq=!1,null===lq&&!0===iq.get("logging_enabled")&&function(e,t){mw(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(sq.logLevel=lb.VERBOSE,lq=sq.log.bind(sq),t&&iq.set("logging_enabled",!0)):"function"==typeof e?lq=e:(lq=null,iq.remove("logging_enabled"))}(!0)),lq){const t=cq.apply(null,e);lq(t)}},dq=function(e){return function(...t){hq(e,...t)}},fq=function(...e){const t="FIREBASE INTERNAL ERROR: "+cq(...e);sq.error(t)},pq=function(...e){const t=`FIREBASE FATAL ERROR: ${cq(...e)}`;throw sq.error(t),new Error(t)},gq=function(...e){const t="FIREBASE WARNING: "+cq(...e);sq.warn(t)},mq=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},yq="[MIN_NAME]",vq="[MAX_NAME]",_q=function(e,t){if(e===t)return 0;if(e===yq||t===vq)return-1;if(t===yq||e===vq)return 1;{const n=Tq(e),r=Tq(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Cq=function(e,t){return e===t?0:e<t?-1:1},Eq=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Vw(t))},wq=function(e){if("object"!=typeof e||null===e)return Vw(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Vw(t[r]),n+=":",n+=wq(e[t[r]]);return n+="}",n},bq=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function Sq(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Pq=function(e){mw(!mq(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,1-t)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},Oq=new RegExp("^-?(0*)\\d{1,10}$"),Tq=function(e){if(Oq.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Iq=function(e){try{e()}catch(t){setTimeout(()=>{throw gq("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},kq=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class Aq{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){gq(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Nq{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(hq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gq(e)}}let Mq=(()=>{class e{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return e.OWNER="owner",e})();const xq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Rq="long_polling";class Dq{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=rq.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&rq.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Lq(e,t,n){let r;if(mw("string"==typeof t,"typeof type must == string"),mw("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Rq)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return Sq(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Fq{constructor(){this.counters_={}}incrementCounter(e,t=1){zw(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return bw(this.counters_)}}const Bq={},Uq={};function Vq(e){const t=e.toString();return Bq[t]||(Bq[t]=new Fq),Bq[t]}class $q{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Iq(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class zq{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=dq(e),this.stats_=Vq(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Lq(t,Rq,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new $q(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Hq((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&xq.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){zq.forceAllow_=!0}static forceDisallow(){zq.forceDisallow_=!0}static isAvailable(){return!(!zq.forceAllow_&&(zq.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Vw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Cw(t),r=bq(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Vw(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Hq{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=oq(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Hq.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){hq("frame writing exception"),i.stack&&hq(i.stack),hq(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||hq("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;(!e||"loaded"===e||"complete"===e)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{hq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}let Gq=null;"undefined"!=typeof MozWebSocket?Gq=MozWebSocket:"undefined"!=typeof WebSocket&&(Gq=WebSocket);let qq=(()=>{class e{constructor(t,n,r,i,s,o,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=dq(this.connId),this.stats_=Vq(n),this.connURL=e.connectionURL_(n,o,a,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&xq.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Lq(e,"websocket",i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,rq.set("previous_websocket_failure",!0);try{this.mySock=new Gq(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Gq&&!e.forceDisallow_}static previouslyFailed(){return rq.isInMemoryStorage||!0===rq.get("previous_websocket_failure")}markConnectionHealthy(){rq.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Uw(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(mw(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Vw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=bq(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e})();class Wq{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[zq,qq]}initTransports_(e){const t=qq&&qq.isAvailable();let n=t&&!qq.previouslyFailed();if(e.webSocketOnly&&(t||gq("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[qq];else{const e=this.transports_=[];for(const t of Wq.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class jq{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=dq("c:"+this.id+":"),this.transportManager_=new Wq(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=kq(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Eq("t",e),n=Eq("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Eq("t",e),n=Eq("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Eq("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?fq("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fq("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&gq("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),kq(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kq(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(rq.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Zq{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Yq{constructor(e){this.allowedEvents_=e,this.listeners_={},mw(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){mw(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Kq extends Yq{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!kw()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Kq}getInitialEvent(e){return mw("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Jq{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Qq(){return new Jq("")}function Xq(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function eW(e){return e.pieces_.length-e.pieceNum_}function tW(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Jq(e.pieces_,t)}function nW(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function rW(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function iW(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Jq(t,0)}function sW(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Jq)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Jq(n,0)}function oW(e){return e.pieceNum_>=e.pieces_.length}function aW(e,t){const n=Xq(e),r=Xq(t);if(null===n)return t;if(n===r)return aW(tW(e),tW(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function cW(e,t){const n=rW(e,0),r=rW(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=_q(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function lW(e,t){if(eW(e)!==eW(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function uW(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(eW(e)>eW(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class hW{constructor(e,t){this.errorPrefix_=t,this.parts_=rW(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=tb(this.parts_[n]);dW(this)}}function dW(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+fW(e))}function fW(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class pW extends Yq{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new pW}getInitialEvent(e){return mw("visible"===e,"Unknown event type: "+e),[this.visible_]}}const gW=1e3;let mW,yW=(()=>{class e extends Zq{constructor(t,n,r,i,s,o,a,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=e.nextPersistentConnectionId_++,this.log_=dq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=gW,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");pW.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Kq.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Vw(i)),mw(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Ow,n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const r=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,r,!1,null),t.resolve(r)):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const e=this.outstandingGets_[i];void 0===e||r!==e||(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),t.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),mw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),mw(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){const n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r};t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const o=s.d,a=s.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_("listen response",s),"ok"!==a&&this.removeListen_(r,i),t.onComplete&&t.onComplete(a,o))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&zw(e,"w")){const n=Hw(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();gq(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=$w(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=$w(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),mw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{"ok"!==e.s&&this.log_("reportStats","Error sending stats: "+e.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Vw(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fq("Unrecognized action received from server: "+Vw(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){mw(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=gW,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=gW,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=gW),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return lw(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+e.nextConnectionId_++,a=t.lastSessionId;let c=!1,l=null;const u=function(){l?l.close():(c=!0,s())};t.realtime_={close:u,sendRequest:function(e){mw(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};const h=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[e,n]=yield Promise.all([t.authTokenProvider_.getToken(h),t.appCheckTokenProvider_.getToken(h)]);c?hq("getToken() completed but was canceled"):(hq("getToken() completed. Creating connection."),t.authToken_=e&&e.accessToken,t.appCheckToken_=n&&n.token,l=new jq(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,i,s,e=>{gq(e+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(n){t.log_("Failed to get token: "+n),c||(t.repoInfo_.nodeAdmin&&gq(n),u())}}})()}interrupt(e){hq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){hq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Gw(this.interruptReasons_)&&(this.reconnectDelay_=gW,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>wq(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Jq(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){hq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){hq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+XG.replace(/\./g,"-")]=1,kw()?e["framework.cordova"]=1:Nw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Kq.getInstance().currentlyOnline();return Gw(this.interruptReasons_)&&e}}return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e})();class vW{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new vW(e,t)}}class _W{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new vW(yq,e),r=new vW(yq,t);return 0!==this.compare(n,r)}minPost(){return vW.MIN}}class CW extends _W{static get __EMPTY_NODE(){return mW}static set __EMPTY_NODE(e){mW=e}compare(e,t){return _q(e.name,t.name)}isDefinedOn(e){throw yw("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return vW.MIN}maxPost(){return new vW(vq,mW)}makePost(e,t){return mw("string"==typeof e,"KeyIndex indexValue must always be a string."),new vW(e,mW)}toString(){return".key"}}const EW=new CW;class wW{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let bW,SW=(()=>{class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??PW.EMPTY_NODE,this.right=s??PW.EMPTY_NODE}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return PW.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return PW.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})();class PW{constructor(e,t=PW.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new PW(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,SW.BLACK,null,null))}remove(e){return new PW(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,SW.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new wW(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new wW(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new wW(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new wW(this.root_,null,this.comparator_,!0,e)}}function OW(e,t){return _q(e.name,t.name)}function TW(e,t){return _q(e,t)}PW.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new SW(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const IW=function(e){return"number"==typeof e?"number:"+Pq(e):"string:"+e},kW=function(e){if(e.isLeafNode()){const t=e.val();mw("string"==typeof t||"number"==typeof t||"object"==typeof t&&zw(t,".sv"),"Priority must be a string or number.")}else mw(e===bW||e.isEmpty(),"priority of unexpected type.");mw(e===bW||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let AW,NW,MW,xW=(()=>{class e{constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,mw(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),kW(this.priorityNode_)}static set __childrenNodeConstructor(e){AW=e}static get __childrenNodeConstructor(){return AW}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return oW(t)?this:".priority"===Xq(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const r=Xq(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(mw(".priority"!==r||1===eW(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(tW(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+IW(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Pq(this.value_):this.value_,this.lazyHash_=aq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(mw(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return mw(i>=0,"Unknown leaf type: "+n),mw(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e})();const RW=new class extends _W{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?_q(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return vW.MIN}maxPost(){return new vW(vq,new xW("[PRIORITY-POST]",MW))}makePost(e,t){const n=NW(e);return new vW(t,new xW("[PRIORITY-POST]",n))}toString(){return".priority"}},DW=Math.log(2);class LW{constructor(e){this.count=parseInt(Math.log(e+1)/DW,10),this.current_=this.count-1;const t=(e=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&t}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const FW=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new SW(a,o.node,SW.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=i(t,c),u=i(c+1,r);return o=e[c],a=n?n(o):o,new SW(a,o.node,SW.BLACK,l,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const l=i(s+1,a),u=e[s],h=n?n(u):u;c(new SW(h,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,SW.BLACK):(a(r,SW.BLACK),a(r,SW.RED))}return s}(new LW(e.length));return new PW(r||t,s)};let BW;const UW={};class VW{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return mw(UW&&RW,"ChildrenNode.ts has not been loaded"),BW=BW||new VW({".priority":UW},{".priority":RW}),BW}get(e){const t=Hw(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof PW?t:null}hasIndex(e){return zw(this.indexSet_,e.toString())}addIndex(e,t){mw(e!==EW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(vW.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?FW(n,e.getCompare()):UW;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=s,new VW(l,c)}addToIndexes(e,t){const n=qw(this.indexes_,(n,r)=>{const i=Hw(this.indexSet_,r);if(mw(i,"Missing index implementation for "+r),n===UW){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(vW.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),FW(n,i.getCompare())}return UW}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new vW(e.name,r))),i.insert(e,e.node)}});return new VW(n,this.indexSet_)}removeFromIndexes(e,t){const n=qw(this.indexes_,n=>{if(n===UW)return n;{const r=t.get(e.name);return r?n.remove(new vW(e.name,r)):n}});return new VW(n,this.indexSet_)}}let $W,zW=(()=>{class e{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&kW(this.priorityNode_),this.children_.isEmpty()&&mw(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return $W||($W=new e(new PW(TW),null,VW.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||$W}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?$W:t}}getChild(e){const t=Xq(e);return null===t?this:this.getImmediateChild(t).getChild(tW(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(mw(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const r=new vW(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?$W:this.priorityNode_;return new e(i,o,s)}}updateChild(e,t){const n=Xq(e);if(null===n)return t;{mw(".priority"!==Xq(e)||1===eW(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(tW(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(RW,(o,a)=>{n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){const e=[];for(const t in n)e[t]=n[t];return e}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+IW(this.getPriority().val())+":"),this.forEachChild(RW,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":aq(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new vW(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new vW(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new vW(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,vW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,vW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===HW?-1:0}withIndex(t){if(t===EW||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===EW||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(RW),n=t.getIterator(RW);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===EW?null:this.indexMap_.get(e.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})();const HW=new class extends zW{constructor(){super(new PW(TW),zW.EMPTY_NODE,VW.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return zW.EMPTY_NODE}isEmpty(){return!1}};function GW(e,t=null){if(null===e)return zW.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),mw(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new xW(e,GW(t));if(e instanceof Array){let n=zW.EMPTY_NODE;return Sq(e,(t,r)=>{if(zw(e,t)&&"."!==t.substring(0,1)){const e=GW(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(GW(t))}{const n=[];let r=!1;if(Sq(e,(e,t)=>{if("."!==e.substring(0,1)){const i=GW(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new vW(e,i)))}}),0===n.length)return zW.EMPTY_NODE;const i=FW(n,OW,e=>e.name,TW);if(r){const e=FW(n,RW.getCompare());return new zW(i,GW(t),new VW({".priority":e},{".priority":RW}))}return new zW(i,GW(t),VW.Default)}}Object.defineProperties(vW,{MIN:{value:new vW(yq,zW.EMPTY_NODE)},MAX:{value:new vW(vq,HW)}}),CW.__EMPTY_NODE=zW.EMPTY_NODE,xW.__childrenNodeConstructor=zW,function(e){bW=e}(HW),function(e){MW=e}(HW),function(e){NW=e}(GW);class qW extends _W{constructor(e){super(),this.indexPath_=e,mw(!oW(e)&&".priority"!==Xq(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?_q(e.name,t.name):i}makePost(e,t){const n=GW(e),r=zW.EMPTY_NODE.updateChild(this.indexPath_,n);return new vW(t,r)}maxPost(){const e=zW.EMPTY_NODE.updateChild(this.indexPath_,HW);return new vW(vq,e)}toString(){return rW(this.indexPath_,0).join("/")}}const WW=new class extends _W{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?_q(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return vW.MIN}maxPost(){return vW.MAX}makePost(e,t){const n=GW(e);return new vW(t,n)}toString(){return".value"}};function jW(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ZW{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=RW}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return mw(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return mw(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:yq}hasEnd(){return this.endSet_}getIndexEndValue(){return mw(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return mw(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:vq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return mw(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===RW}copy(){const e=new ZW;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function YW(e){const t={};if(e.isDefault())return t;let n;return e.index_===RW?n="$priority":e.index_===WW?n="$value":e.index_===EW?n="$key":(mw(e.index_ instanceof qW,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Vw(n),e.startSet_&&(t.startAt=Vw(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Vw(e.indexStartName_))),e.endSet_&&(t.endAt=Vw(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Vw(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function KW(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==RW&&(t.i=e.index_.toString()),t}class JW extends Zq{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=dq("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(mw(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=JW.getListenId_(e,n),o={};this.listens_[s]=o;const a=YW(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),Hw(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=JW.getListenId_(e,t);delete this.listens_[n]}get(e){const t=YW(e._queryParams),n=e._path.toString(),r=new Ow;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zw(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=Uw(o.responseText)}catch{gq("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&gq("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class QW{constructor(){this.rootNode_=zW.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function XW(){return{value:null,children:new Map}}function ej(e,t,n){if(oW(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=Xq(t);e.children.has(r)||e.children.set(r,XW()),ej(e.children.get(r),t=tW(t),n)}}function tj(e,t){if(oW(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(RW,(t,n)=>{ej(e,new Jq(t),n)}),tj(e,t)}}if(e.children.size>0){const n=Xq(t);return t=tW(t),e.children.has(n)&&tj(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function nj(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{nj(r,new Jq(t.toString()+"/"+e),n)})}class rj{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Sq(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class ij{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new rj(e);const n=1e4+2e4*Math.random();kq(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Sq(e,(e,r)=>{r>0&&zw(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),kq(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var sj=(()=>(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(sj||(sj={})),sj))();function oj(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class aj{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=sj.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(oW(this.path)){if(null!=this.affectedTree.value)return mw(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Jq(e));return new aj(Qq(),t,this.revert)}}return mw(Xq(this.path)===e,"operationForChild called for unrelated child."),new aj(tW(this.path),this.affectedTree,this.revert)}}class cj{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=sj.OVERWRITE}operationForChild(e){return oW(this.path)?new cj(this.source,Qq(),this.snap.getImmediateChild(e)):new cj(this.source,tW(this.path),this.snap)}}class lj{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=sj.MERGE}operationForChild(e){if(oW(this.path)){const t=this.children.subtree(new Jq(e));return t.isEmpty()?null:t.value?new cj(this.source,Qq(),t.value):new lj(this.source,Qq(),t)}return mw(Xq(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new lj(this.source,tW(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class uj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(oW(e))return this.isFullyInitialized()&&!this.filtered_;const t=Xq(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function hj(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw yw("Should only compare child_ events.");const r=new vW(t.childName,t.snapshotNode),i=new vW(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function dj(e,t){return{eventCache:e,serverCache:t}}function fj(e,t,n,r){return dj(new uj(t,n,r),e.serverCache)}function pj(e,t,n,r){return dj(e.eventCache,new uj(t,n,r))}function gj(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function mj(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let yj;class vj{constructor(e,t=(()=>(yj||(yj=new PW(Cq)),yj))()){this.value=e,this.children=t}static fromObject(e){let t=new vj(null);return Sq(e,(e,n)=>{t=t.set(new Jq(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Qq(),value:this.value};if(oW(e))return null;{const n=Xq(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(tW(e),t);return null!=i?{path:sW(new Jq(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(oW(e))return this;{const t=Xq(e),n=this.children.get(t);return null!==n?n.subtree(tW(e)):new vj(null)}}set(e,t){if(oW(e))return new vj(t,this.children);{const n=Xq(e),r=(this.children.get(n)||new vj(null)).set(tW(e),t),i=this.children.insert(n,r);return new vj(this.value,i)}}remove(e){if(oW(e))return this.children.isEmpty()?new vj(null):new vj(null,this.children);{const t=Xq(e),n=this.children.get(t);if(n){const r=n.remove(tW(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new vj(null):new vj(this.value,i)}return this}}get(e){if(oW(e))return this.value;{const t=Xq(e),n=this.children.get(t);return n?n.get(tW(e)):null}}setTree(e,t){if(oW(e))return t;{const n=Xq(e),r=(this.children.get(n)||new vj(null)).setTree(tW(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new vj(this.value,i)}}fold(e){return this.fold_(Qq(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(sW(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Qq(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(oW(e))return null;{const r=Xq(e),i=this.children.get(r);return i?i.findOnPath_(tW(e),sW(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Qq(),t)}foreachOnPath_(e,t,n){if(oW(e))return this;{this.value&&n(t,this.value);const r=Xq(e),i=this.children.get(r);return i?i.foreachOnPath_(tW(e),sW(t,r),n):new vj(null)}}foreach(e){this.foreach_(Qq(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(sW(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class _j{constructor(e){this.writeTree_=e}static empty(){return new _j(new vj(null))}}function Cj(e,t,n){if(oW(t))return new _j(new vj(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=aW(i,t);return s=s.updateChild(o,n),new _j(e.writeTree_.set(i,s))}{const r=new vj(n),i=e.writeTree_.setTree(t,r);return new _j(i)}}}function Ej(e,t,n){let r=e;return Sq(n,(e,n)=>{r=Cj(r,sW(t,e),n)}),r}function wj(e,t){if(oW(t))return _j.empty();{const n=e.writeTree_.setTree(t,new vj(null));return new _j(n)}}function bj(e,t){return null!=Sj(e,t)}function Sj(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(aW(n.path,t)):null}function Pj(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(RW,(e,n)=>{t.push(new vW(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new vW(e,n.value))}),t}function Oj(e,t){if(oW(t))return e;{const n=Sj(e,t);return new _j(null!=n?new vj(n):e.writeTree_.subtree(t))}}function Tj(e){return e.writeTree_.isEmpty()}function Ij(e,t){return kj(Qq(),e.writeTree_,t)}function kj(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(mw(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=kj(sW(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(sW(e,".priority"),r)),n}}function Aj(e,t){return $j(t,e)}function Nj(e,t){if(e.snap)return uW(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&uW(sW(e.path,n),t))return!0;return!1}function Mj(e){return e.visible}function xj(e,t,n){let r=_j.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)uW(n,e)?(t=aW(n,e),r=Cj(r,t,s.snap)):uW(e,n)&&(t=aW(e,n),r=Cj(r,Qq(),s.snap.getChild(t)));else{if(!s.children)throw yw("WriteRecord should have .snap or .children");if(uW(n,e))t=aW(n,e),r=Ej(r,t,s.children);else if(uW(e,n))if(t=aW(e,n),oW(t))r=Ej(r,Qq(),s.children);else{const e=Hw(s.children,Xq(t));if(e){const n=e.getChild(tW(t));r=Cj(r,Qq(),n)}}}}}return r}function Rj(e,t,n,r,i){if(r||i){const s=Oj(e.visibleWrites,t);return!i&&Tj(s)?n:i||null!=n||bj(s,Qq())?Ij(xj(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(uW(e.path,t)||uW(t,e.path))},t),n||zW.EMPTY_NODE):null}{const r=Sj(e.visibleWrites,t);if(null!=r)return r;{const r=Oj(e.visibleWrites,t);return Tj(r)?n:null!=n||bj(r,Qq())?Ij(r,n||zW.EMPTY_NODE):null}}}function Dj(e,t,n,r){return Rj(e.writeTree,e.treePath,t,n,r)}function Lj(e,t){return function(e,t,n){let r=zW.EMPTY_NODE;const i=Sj(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(RW,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=Oj(e.visibleWrites,t);return n.forEachChild(RW,(e,t)=>{const n=Ij(Oj(i,new Jq(e)),t);r=r.updateImmediateChild(e,n)}),Pj(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Pj(Oj(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Fj(e,t,n,r){return function(e,t,n,r,i){mw(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=sW(t,n);if(bj(e.visibleWrites,s))return null;{const t=Oj(e.visibleWrites,s);return Tj(t)?i.getChild(n):Ij(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Bj(e,t){return function(e,t){return Sj(e.visibleWrites,t)}(e.writeTree,sW(e.treePath,t))}function Uj(e,t,n){return function(e,t,n,r){const i=sW(t,n),s=Sj(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?Ij(Oj(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Vj(e,t){return $j(sW(e.treePath,t),e.writeTree)}function $j(e,t){return{treePath:e,writeTree:t}}class zj{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;mw("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),mw(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,jW(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw yw("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,jW(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Hj=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Gj{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new uj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Uj(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:mj(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const c=Oj(e.visibleWrites,t),l=Sj(c,Qq());if(null!=l)a=l;else{if(null==n)return[];a=Ij(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function qj(e,t,n,r,i,s){const o=t.eventCache;if(null!=Bj(r,n))return t;{let a,c;if(oW(n))if(mw(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=mj(t),i=Lj(r,n instanceof zW?n:zW.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Dj(r,mj(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const l=Xq(n);if(".priority"===l){mw(1===eW(n),"Can't have a priority with additional path components");const i=o.getNode();c=t.serverCache.getNode();const s=Fj(r,n,i,c);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=tW(n);let h;if(o.isCompleteForChild(l)){c=t.serverCache.getNode();const e=Fj(r,n,o.getNode(),c);h=null!=e?o.getNode().getImmediateChild(l).updateChild(u,e):o.getNode().getImmediateChild(l)}else h=Uj(r,l,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),l,h,u,i,s):o.getNode()}}return fj(t,a,o.isFullyInitialized()||oW(n),e.filter.filtersNodes())}}function Wj(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(oW(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=Xq(n);if(!c.isCompleteForPath(n)&&eW(n)>1)return t;const i=tW(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,Hj,null)}const h=pj(t,l,c.isFullyInitialized()||oW(n),u.filtersNodes());return qj(e,h,n,i,new Gj(i,h,s),a)}function jj(e,t,n,r,i,s,o){const a=t.eventCache;let c,l;const u=new Gj(i,t,s);if(oW(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=fj(t,l,!0,e.filter.filtersNodes());else{const i=Xq(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=fj(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=tW(n),l=a.getNode().getImmediateChild(i);let h;if(oW(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===nW(s)&&e.getChild(iW(s)).isEmpty()?e:e.updateChild(s,r):zW.EMPTY_NODE}c=l.equals(h)?t:fj(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Zj(e,t){return e.eventCache.isCompleteForChild(t)}function Yj(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function Kj(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=oW(n)?r:new vj(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const c=Yj(0,t.serverCache.getNode().getImmediateChild(n),r);l=Wj(e,l,new Jq(n),c,i,s,o,a)}}),c.children.inorderTraversal((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!c){const c=Yj(0,t.serverCache.getNode().getImmediateChild(n),r);l=Wj(e,l,new Jq(n),c,i,s,o,a)}}),l}function Jj(e,t){const n=mj(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!oW(t)&&!n.getImmediateChild(Xq(t)).isEmpty())?n.getChild(t):null}function Qj(e,t,n,r){t.type===sj.MERGE&&null!==t.source.queryId&&(mw(mj(e.viewCache_),"We should always have a full cache before handling merges"),mw(gj(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new zj;let o,a;if(n.type===sj.OVERWRITE){const c=n;c.source.fromUser?o=jj(e,t,c.path,c.snap,r,i,s):(mw(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!oW(c.path),o=Wj(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===sj.MERGE){const c=n;c.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,c)=>{const l=sW(n,r);Zj(t,Xq(l))&&(a=jj(e,a,l,c,i,s,o))}),r.foreach((r,c)=>{const l=sW(n,r);Zj(t,Xq(l))||(a=jj(e,a,l,c,i,s,o))}),a}(e,t,c.path,c.children,r,i,s):(mw(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=Kj(e,t,c.path,c.children,r,i,a,s))}else if(n.type===sj.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=Bj(r,n))return t;{const a=new Gj(r,t,i),c=t.eventCache.getNode();let l;if(oW(n)||".priority"===Xq(n)){let n;if(t.serverCache.isFullyInitialized())n=Dj(r,mj(t));else{const e=t.serverCache.getNode();mw(e instanceof zW,"serverChildren would be complete if leaf node"),n=Lj(r,e)}n=n,l=e.filter.updateFullNode(c,n,s)}else{const i=Xq(n);let u=Uj(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=null!=u?e.filter.updateChild(c,i,u,tW(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,zW.EMPTY_NODE,tW(n),a,s):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Dj(r,mj(t)),o.isLeafNode()&&(l=e.filter.updateFullNode(l,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=Bj(r,Qq()),fj(t,l,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=Bj(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(oW(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Wj(e,t,n,c.getNode().getChild(n),i,s,a,o);if(oW(n)){let r=new vj(null);return c.getNode().forEachChild(EW,(e,t)=>{r=r.set(new Jq(e),t)}),Kj(e,t,n,r,i,s,a,o)}return t}{let l=new vj(null);return r.foreach((e,t)=>{const r=sW(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))}),Kj(e,t,n,l,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==sj.LISTEN_COMPLETE)throw yw("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache;return qj(e,pj(t,s.getNode(),s.isFullyInitialized()||oW(n),s.isFiltered()),n,r,Hj,i)}(e,t,n.path,r,s)}const c=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=gj(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(gj(t)))}}(t,o,c),{viewCache:o,changes:c}}(e.processor_,i,t,n,r);return function(e,t){mw(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),mw(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,s.viewCache),mw(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,function(e,t,n,r){return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),hj(e,i,"child_removed",t,r,n),hj(e,i,"child_added",t,r,n),hj(e,i,"child_moved",s,r,n),hj(e,i,"child_changed",t,r,n),hj(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r?[r]:e.eventRegistrations_)}(e,s.changes,s.viewCache.eventCache.getNode(),null)}let Xj,eZ;function tZ(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return mw(null!=s,"SyncTree gave us an op for an invalid query."),Qj(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Qj(s,t,n,r));return i}}function nZ(e,t){let n=null;for(const r of e.views.values())n=n||Jj(r,t);return n}class rZ{constructor(e){this.listenProvider_=e,this.syncPointTree_=new vj(null),this.pendingWriteTree_={visibleWrites:_j.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function iZ(e,t,n,r,i){return function(e,t,n,r,i){mw(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Cj(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?cZ(e,new cj({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function sZ(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);mw(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&Nj(t,r.path)?i=!1:uW(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(function(e){e.visibleWrites=xj(e.allWrites,Mj,Qq()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=wj(e.visibleWrites,r.path):Sq(r.children,t=>{e.visibleWrites=wj(e.visibleWrites,sW(r.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new vj(null);return null!=r.snap?t=t.set(Qq(),!0):Sq(r.children,e=>{t=t.set(new Jq(e),!0)}),cZ(e,new aj(r.path,t,n))}return[]}function oZ(e,t,n){return cZ(e,new cj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function aZ(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=nZ(n,aW(e,t));if(r)return r});return Rj(r,t,i,n,!0)}function cZ(e,t){return lZ(t,e.syncPointTree_,null,Aj(e.pendingWriteTree_,Qq()))}function lZ(e,t,n,r){if(oW(e.path))return uZ(e,t,n,r);{const i=t.get(Qq());null==n&&null!=i&&(n=nZ(i,Qq()));let s=[];const o=Xq(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Vj(r,o);s=s.concat(lZ(a,c,e,t))}return i&&(s=s.concat(tZ(i,e,r,n))),s}}function uZ(e,t,n,r){const i=t.get(Qq());null==n&&null!=i&&(n=nZ(i,Qq()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=Vj(r,t),c=e.operationForChild(t);c&&(s=s.concat(uZ(c,i,o,a)))}),i&&(s=s.concat(tZ(i,e,r,n))),s}function hZ(e,t){return e.tagToQueryMap.get(t)}function dZ(e){const t=e.indexOf("$");return mw(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Jq(e.substr(0,t))}}function fZ(e,t,n){const r=e.syncPointTree_.get(t);return mw(r,"Missing sync point for query tag that we're tracking"),tZ(r,n,Aj(e.pendingWriteTree_,t),null)}class pZ{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new pZ(t)}node(){return this.node_}}class gZ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=sW(this.path_,e);return new gZ(this.syncTree_,t)}node(){return aZ(this.syncTree_,this.path_)}}const mZ=function(e,t,n){return e&&"object"==typeof e?(mw(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?yZ(e[".sv"],t,n):"object"==typeof e[".sv"]?vZ(e[".sv"],t):void mw(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},yZ=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:mw(!1,"Unexpected server value: "+e)}},vZ=function(e,t,n){e.hasOwnProperty("increment")||mw(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&mw(!1,"Unexpected increment value: "+r);const i=t.node();if(mw(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},_Z=function(e,t,n){return CZ(e,new pZ(t),n)};function CZ(e,t,n){const r=e.getPriority().val(),i=mZ(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=mZ(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new xW(s,GW(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new xW(i))),r.forEachChild(RW,(e,r)=>{const i=CZ(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class EZ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function wZ(e,t){let n=t instanceof Jq?t:new Jq(t),r=e,i=Xq(n);for(;null!==i;){const e=Hw(r.node.children,i)||{children:{},childCount:0};r=new EZ(i,r,e),n=tW(n),i=Xq(n)}return r}function bZ(e){return e.node.value}function SZ(e,t){e.node.value=t,kZ(e)}function PZ(e){return e.node.childCount>0}function OZ(e,t){Sq(e.node.children,(n,r)=>{t(new EZ(n,e,r))})}function TZ(e,t,n,r){n&&!r&&t(e),OZ(e,e=>{TZ(e,t,!0,r)}),n&&r&&t(e)}function IZ(e){return new Jq(null===e.parent?e.name:IZ(e.parent)+"/"+e.name)}function kZ(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===bZ(e)&&!PZ(e)}(n),i=zw(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,kZ(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,kZ(e))}(e.parent,e.name,e)}const AZ=/[\[\].#$\/\u0000-\u001F\u007F]/,NZ=/[\[\].#$\u0000-\u001F\u007F]/,MZ=10485760,xZ=function(e){return"string"==typeof e&&0!==e.length&&!AZ.test(e)},RZ=function(e){return"string"==typeof e&&0!==e.length&&!NZ.test(e)},DZ=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!mq(e)||e&&"object"==typeof e&&zw(e,".sv")},LZ=function(e,t,n,r){r&&void 0===t||FZ(eb(e,"value"),t,n)},FZ=function(e,t,n){const r=n instanceof Jq?new hW(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+fW(r));if("function"==typeof t)throw new Error(e+"contains a function "+fW(r)+" with contents = "+t.toString());if(mq(t))throw new Error(e+"contains "+t.toString()+" "+fW(r));if("string"==typeof t&&t.length>MZ/3&&tb(t)>MZ)throw new Error(e+"contains a string greater than "+MZ+" utf8 bytes "+fW(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(Sq(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!xZ(t)))throw new Error(e+" contains an invalid key ("+t+") "+fW(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=tb(t),dW(e)})(r,t),FZ(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=tb(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+fW(r)+" in addition to actual children.")}},BZ=function(e,t,n,r){if(!(r&&void 0===n||RZ(n)))throw new Error(eb(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},UZ=function(e,t){if(".info"===Xq(t))throw new Error(e+" failed = Can't modify data under /.info/")};class VZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function $Z(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null!==n&&!lW(s,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function zZ(e,t,n){$Z(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(HZ(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>uW(e,t)||uW(t,e))}function HZ(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();lq&&hq("event: "+n.toString()),Iq(r)}}}class GZ{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new VZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=XW(),this.transactionQueueTree_=new EZ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qZ(e){const t=e.infoData_.getNode(new Jq(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function WZ(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:qZ(e)})}function jZ(e,t,n,r,i){e.dataUpdateCount++;const s=new Jq(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=qw(n,e=>GW(e));o=function(e,t,n,r){const i=hZ(e,r);if(i){const r=dZ(i),s=r.path,o=r.queryId,a=aW(s,t),c=vj.fromObject(n);return fZ(e,s,new lj(oj(o),a,c))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=GW(n);o=function(e,t,n,r){const i=hZ(e,r);if(null!=i){const r=dZ(i),s=r.path,o=r.queryId,a=aW(s,t);return fZ(e,s,new cj(oj(o),a,n))}return[]}(e.serverSyncTree_,s,t,i)}else if(r){const t=qw(n,e=>GW(e));o=function(e,t,n){const r=vj.fromObject(n);return cZ(e,new lj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=GW(n);o=oZ(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=rY(e,s)),zZ(e.eventQueue_,a,o)}function ZZ(e,t){YZ(e,"connected",t),!1===t&&function(e){XZ(e,"onDisconnectEvents");const t=WZ(e),n=XW();nj(e.onDisconnect_,Qq(),(r,i)=>{const s=function(e,t,n,r){return CZ(t,new gZ(n,e),r)}(r,i,e.serverSyncTree_,t);ej(n,r,s)});let r=[];nj(n,Qq(),(t,n)=>{r=r.concat(oZ(e.serverSyncTree_,t,n));const i=cY(e,t);rY(e,i)}),e.onDisconnect_=XW(),zZ(e.eventQueue_,Qq(),r)}(e)}function YZ(e,t,n){const r=new Jq("/.info/"+t),i=GW(n);e.infoData_.updateSnapshot(r,i);const s=oZ(e.infoSyncTree_,r,i);zZ(e.eventQueue_,r,s)}function KZ(e){return e.nextWriteId_++}function JZ(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&tj(e.onDisconnect_,t),eY(0,n,r,i)})}function QZ(e,t,n,r){const i=GW(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&ej(e.onDisconnect_,t,i),eY(0,r,n,s)})}function XZ(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),hq(n,...t)}function eY(e,t,n,r){t&&Iq(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function tY(e,t,n){return aZ(e.serverSyncTree_,t,n)||zW.EMPTY_NODE}function nY(e,t=e.transactionQueueTree_){if(t||aY(e,t),bZ(t)){const n=sY(e,t);mw(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=tY(e,t,r);let s=i;const o=i.hash();for(let l=0;l<n.length;l++){const e=n[l];mw(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=aW(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),c=t;e.server_.put(c.toString(),a,r=>{XZ(e,"transaction put response",{path:c.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(sZ(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();aY(e,wZ(e.transactionQueueTree_,t)),nY(e,e.transactionQueueTree_),zZ(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Iq(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)n[e].status=3===n[e].status?4:0;else{gq("transaction at "+c.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}rY(e,t)}},o)}(e,IZ(t),n)}else PZ(t)&&OZ(t,t=>{nY(e,t)})}function rY(e,t){const n=iY(e,t),r=IZ(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],c=aW(n,a.path);let l,u=!1;if(mw(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,l=a.abortReason,i=i.concat(sZ(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,l="maxretry",i=i.concat(sZ(e.serverSyncTree_,a.currentWriteId,!0));else{const n=tY(e,a.path,s);a.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){FZ("transaction failed: Data returned ",r,a.path);let t=GW(r);"object"==typeof r&&null!=r&&zw(r,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,c=WZ(e),l=_Z(t,n,c);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=KZ(e),s.splice(s.indexOf(o),1),i=i.concat(iZ(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally)),i=i.concat(sZ(e.serverSyncTree_,o,!0))}else u=!0,l="nodata",i=i.concat(sZ(e.serverSyncTree_,a.currentWriteId,!0))}zZ(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===l?()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot):()=>t[o].onComplete(new Error(l),!1,null)))}aY(e,e.transactionQueueTree_);for(let o=0;o<r.length;o++)Iq(r[o]);nY(e,e.transactionQueueTree_)}(e,sY(e,n),r),r}function iY(e,t){let n,r=e.transactionQueueTree_;for(n=Xq(t);null!==n&&void 0===bZ(r);)r=wZ(r,n),n=Xq(t=tW(t));return r}function sY(e,t){const n=[];return oY(e,t,n),n.sort((e,t)=>e.order-t.order),n}function oY(e,t,n){const r=bZ(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);OZ(t,t=>{oY(e,t,n)})}function aY(e,t){const n=bZ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,SZ(t,n.length>0?n:void 0)}OZ(t,t=>{aY(e,t)})}function cY(e,t){const n=IZ(iY(e,t)),r=wZ(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{lY(e,t)}),lY(e,r),TZ(r,t=>{lY(e,t)}),n}function lY(e,t){const n=bZ(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(mw(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(mw(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(sZ(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?SZ(t,void 0):n.length=s+1,zZ(e.eventQueue_,IZ(t),i);for(let e=0;e<r.length;e++)Iq(r[e])}}const uY=function(e,t){const n=hY(e),r=n.namespace;return"firebase.com"===n.domain&&pq(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&pq("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&gq("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Dq(n.host,n.secure,r,t,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new Jq(n.pathString)}},hY=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch{}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):gq(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class dY{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Ow;return JZ(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){UZ("OnDisconnect.remove",this._path);const e=new Ow;return QZ(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){UZ("OnDisconnect.set",this._path),LZ("OnDisconnect.set",e,this._path,!1);const t=new Ow;return QZ(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){UZ("OnDisconnect.setWithPriority",this._path),LZ("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(mq(t))throw new Error(eb(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!DZ(t))throw new Error(eb(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new Ow;return function(e,t,n,r,i){const s=GW(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&ej(e.onDisconnect_,t,s),eY(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){UZ("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=eb(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Sq(t,(e,t)=>{const r=new Jq(e);if(FZ(i,t,sW(n,r)),".priority"===nW(r)&&!DZ(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=rW(r);for(let t=0;t<i.length;t++)if((".priority"!==i[t]||t!==i.length-1)&&!xZ(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(cW);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&uW(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new Ow;return function(e,t,n,r){if(Gw(n))return hq("onDisconnect().update() called with empty data.  Don't do anything."),void eY(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&Sq(n,(n,r)=>{const i=GW(r);ej(e.onDisconnect_,sW(t,n),i)}),eY(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class fY{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return oW(this._path)?null:nW(this._path)}get ref(){return new pY(this._repo,this._path)}get _queryIdentifier(){const e=KW(this._queryParams),t=wq(e);return"{}"===t?"default":t}get _queryObject(){return KW(this._queryParams)}isEqual(e){if(!((e=rb(e))instanceof fY))return!1;const t=this._repo===e._repo,n=lW(this._path,e._path);return t&&n&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class pY extends fY{constructor(e,t){super(e,t,new ZW,!1)}get parent(){const e=iW(this._path);return null===e?null:new pY(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function gY(e,t){return(e=rb(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===Xq((e=rb(e))._path)?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),BZ(e,t,n,r)}("child","path",t,!1):BZ("child","path",t,!1),new pY(e._repo,sW(e._path,t))}(e._root,t):e._root}function mY(e){return e=rb(e),new dY(e._repo,e._path)}function yY(e,t){e=rb(e),UZ("set",e._path),LZ("set",t,e._path,!1);const n=new Ow;return function(e,t,n,r,i){XZ(e,"set",{path:t.toString(),value:n,priority:r});const s=WZ(e),o=GW(n,r),a=aZ(e.serverSyncTree_,t),c=_Z(o,a,s),l=KZ(e),u=iZ(e.serverSyncTree_,t,c,l,!0);$Z(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||gq("set at "+t+" failed: "+n);const o=sZ(e.serverSyncTree_,l,!s);zZ(e.eventQueue_,t,o),eY(0,i,n,r)});const h=cY(e,t);rY(e,h),zZ(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}(function(e){mw(!Xj,"__referenceConstructor has already been defined"),Xj=e})(pY),function(e){mw(!eZ,"__referenceConstructor has already been defined"),eZ=e}(pY);const vY={};function _Y(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||pq("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),hq("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=uY(s,i),l=c.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=uY(s,i),l=c.repoInfo):o=!c.repoInfo.secure;const u=i&&o?new Mq(Mq.OWNER):new Nq(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!xZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),RZ(e)}(n))throw new Error(eb(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),oW(c.path)||pq("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=vY[t.name];i||(i={},vY[t.name]=i);let s=i[e.toURLString()];return s&&pq("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new GZ(e,false,n,r),i[e.toURLString()]=s,s}(l,e,u,new Aq(e.name,n));return new CY(h,e)}class CY{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=Vq(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new JW(e.repoInfo_,(t,n,r,i)=>{jZ(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>ZZ(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Vw(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new yW(e.repoInfo_,t,(t,n,r,i)=>{jZ(e,t,n,r,i)},t=>{ZZ(e,t)},t=>{!function(e,t){Sq(t,(t,n)=>{YZ(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return Uq[n]||(Uq[n]=t()),Uq[n]}(e.repoInfo_,()=>new ij(e.stats_,e.server_)),e.infoData_=new QW,e.infoSyncTree_=new rZ({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=oZ(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),YZ(e,"connected",!1),e.serverSyncTree_=new rZ({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);zZ(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pY(this._repo,Qq())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=vY[t];(!n||n[e.key]!==e)&&pq(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&pq("Cannot call "+e+" on a deleted database.")}}function EY(e=kb(),t){return Sb(e,"database").getImmediate({identifier:t})}function wY(e,t,n,r={}){(e=rb(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&pq("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&pq('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Mq(Mq.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Tw(r.mockUserToken,e.app.options.projectId);s=new Mq(t)}!function(e,t,n,r){e.repoInfo_=new Dq(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}const bY={".sv":"timestamp"};function SY(){return bY}yW.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},yW.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},XG="9.6.6",bb(new ib("database",(e,{instanceIdentifier:t})=>_Y(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Nb(QG,"0.12.5",void 0),Nb(QG,"0.12.5","esm2017");class PY{constructor(e){return e}}const OY=new or("angularfire2.database-instances");function TY(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new PY(r)}}const IY={provide:class{constructor(){return uT("database")}},deps:[[new Mr,OY]]},kY={provide:PY,useFactory:function(e,t){const n=lT("database",e,t);return n&&new PY(n)},deps:[[new Mr,OY],ET]};let AY=(()=>{class e{constructor(){Nb("angularfire",sT.full,"rtdb")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[kY,IY]}),e})();const NY=CT(wY,!0),MY=CT(EY,!0),xY=CT(mY,!0),RY=CT(gY,!0),DY=CT(yY,!0);class LY{constructor(e){this.db=e}setOffline(e){return DY(RY(this.db,"/status/"+e),LY.OFFLINE)}launchAutomaticPresenceUpdate(e){var t=this;return lw(function*(){const n=RY(t.db,"/status/"+e);yield DY(n,LY.ONLINE),yield xY(n).set(LY.OFFLINE)})()}}LY.OFFLINE={last_changed:SY()},LY.ONLINE={last_changed:SY()},LY.\u0275fac=function(e){return new(e||LY)(Or(PY))},LY.\u0275prov=be({token:LY,factory:LY.\u0275fac,providedIn:"root"});class FY{static createUserWithEmailAndPassword(e,t,n){return FN(e,t,n)}static sendEmailVerification(e){return VN(e)}static sendPasswordResetEmail(e,t){return $N(e,t)}static signInWithEmailAndPassword(e,t,n){return lw(function*(){return(yield zN(e,t,n)).user})()}static signInWithPopup(e,t){return lw(function*(){return(yield HN(e,t)).user})()}static updateProfile(e,t){return GN(e,t)}}class BY{constructor(e,t,n,r){this.id=e,this.email=t,this.username=n,this.verified=r}isConnected(){return this.email.isPresent()}toMinimalUser(){return{id:this.id,name:this.username.get()}}}BY.NOT_CONNECTED=new BY("",gw.empty(),gw.empty(),!1);let UY=(()=>{class e{constructor(t,n,r){var i=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=gw.empty(),this.userUnsubscribe=gw.empty(),hw(e.VERBOSE,"ConnectedUserService constructor"),this.userRS=new JG(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=UN(this.auth,function(){var t=lw(function*(t){null==t?(hw(e.VERBOSE,"User is not connected"),i.userUnsubscribe.isPresent()&&i.userUnsubscribe.get()(),i.userRS.next(BY.NOT_CONNECTED),i.user=gw.empty()):(VG(i.user.isAbsent(),"ConnectedUserService received a double update for an user, this is unexpected"),yield i.connectivityDAO.launchAutomaticPresenceUpdate(t.uid),i.userUnsubscribe=gw.of(i.userDAO.subscribeToChanges(t.uid,n=>{if(n.isPresent()){const r=n.get().username;hw(e.VERBOSE,`User ${r} is connected, and the verified status is ${i.emailVerified(t)}`);const s=!0===i.emailVerified(t)&&null!=r;if(!0===s&&!1===n.get().verified)return i.userDAO.markVerified(t.uid);const o=new BY(t.uid,gw.ofNullable(t.email),gw.ofNullable(r),s);i.user=gw.of(o),i.userRS.next(o)}})))});return function(e){return t.apply(this,arguments)}}())}emailVerified(e){return e.emailVerified}sendPasswordResetEmail(e){var t=this;return lw(function*(){try{return yield FY.sendPasswordResetEmail(t.auth,e),DG.SUCCESS}catch(n){return DG.failure(t.mapFirebaseError(n))}})()}doRegister(t,n,r){var i=this;return lw(function*(){return hw(e.VERBOSE,"ConnectedUserService.doRegister("+n+")"),(yield i.userDAO.usernameIsAvailable(t))?i.registerAfterUsernameCheck(t,n,r):MG.failure($localize`This username is already in use.`)})()}registerAfterUsernameCheck(e,t,n){var r=this;return lw(function*(){try{const i=yield FY.createUserWithEmailAndPassword(r.auth,t,n),s=uw.getNonNullable(i.user);return yield r.createUser(s.uid,e),MG.success(s)}catch(i){return MG.failure(r.mapFirebaseError(i))}})()}mapFirebaseError(e){switch(e.code){case"auth/email-already-in-use":return $localize`This email address is already in use.`;case"auth/invalid-email":return $localize`This email address is invalid.`;case"auth/user-not-found":case"auth/wrong-password":return $localize`You have entered invalid credentials.`;case"auth/invalid-credential":return $localize`The credential is invalid or has expired, please try again.`;case"auth/weak-password":return $localize`Your password is too weak, please use a stronger password.`;case"auth/too-many-requests":return $localize`There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later.`;case"auth/popup-closed-by-user":return $localize`You closed the authentication popup without finalizing your log in.`;case"auth/popup-blocked":return $localize`The authentication popup was blocked. Try again after disabling popup blocking.`;default:return UG.logError("ConnectedUserService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}sendEmailVerification(){var t=this;return lw(function*(){hw(e.VERBOSE,"ConnectedUserService.sendEmailVerification()");const n=gw.ofNullable(t.auth.currentUser);if(!n.isPresent())return UG.logError("ConnectedUserService","Unlogged users cannot request for email verification");if(t.emailVerified(n.get()))return UG.logError("ConnectedUserService","Verified users should not ask email verification after being verified");try{return yield FY.sendEmailVerification(n.get()),DG.SUCCESS}catch(r){return DG.failure(t.mapFirebaseError(r))}})()}doEmailLogin(t,n){var r=this;return lw(function*(){hw(e.VERBOSE,"ConnectedUserService.doEmailLogin("+t+")");try{return yield FY.signInWithEmailAndPassword(r.auth,t,n),DG.SUCCESS}catch(i){return DG.failure(r.mapFirebaseError(i))}})()}createUser(e,t){var n=this;return lw(function*(){null==t?yield n.userDAO.set(e,{verified:!1}):yield n.userDAO.set(e,{username:t,verified:!1})})()}doGoogleLogin(){var e=this;return lw(function*(){return DG.ofFallible(yield e.registerOrLoginWithGoogle())})()}registerOrLoginWithGoogle(){var e=this;return lw(function*(){try{const t=new qk;t.addScope("profile"),t.addScope("email");const n=yield FY.signInWithPopup(e.auth,t);return!1===(yield e.userDAO.exists(n.uid))&&(yield e.createUser(n.uid)),MG.success(n)}catch(t){return MG.failure(e.mapFirebaseError(t))}})()}disconnect(){var e=this;return lw(function*(){const t=gw.ofNullable(e.auth.currentUser);if(t.isPresent()){const n=t.get().uid;return yield e.connectivityDAO.setOffline(n),yield e.auth.signOut(),DG.SUCCESS}return DG.failure("Cannot disconnect a non-connected user")})()}getUserObs(){return this.userObs}setUsername(e){var t=this;return lw(function*(){if(""===e)return DG.failure($localize`Your username may not be empty.`);try{if(!1===(yield t.userDAO.usernameIsAvailable(e)))return DG.failure($localize`This username is already in use, please select a different one.`);const n=uw.getNonNullable(t.auth.currentUser);return yield FY.updateProfile(n,{displayName:e}),yield t.userDAO.setUsername(n.uid,e),yield t.userDAO.markVerified(n.uid),yield t.reloadUser(),DG.SUCCESS}catch(n){return DG.failure(t.mapFirebaseError(n))}})()}setPicture(e){var t=this;return lw(function*(){try{const n=uw.getNonNullable(t.auth.currentUser);return yield FY.updateProfile(n,{photoURL:e}),DG.SUCCESS}catch(n){return DG.failure(t.mapFirebaseError(n))}})()}reloadUser(){var e=this;return lw(function*(){const t=uw.getNonNullable(e.auth.currentUser);yield t.getIdToken(!0),yield t.reload()})()}updateObservedPart(e){return VG(this.user.isPresent(),"Should not call updateObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:e})}removeObservedPart(){return VG(this.user.isPresent(),"Should not call removeObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:null})}sendPresenceToken(){return VG(this.user.isPresent(),"Should not call sendPresenceToken when not connected"),this.userDAO.updatePresenceToken(this.user.get().id)}ngOnDestroy(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(ZG),Or(kN),Or(LY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class VY{constructor(e){this.value=e}static of(e){switch(e){case"CREATOR":return VY.CREATOR;case"RANDOM":return VY.RANDOM;default:return VG("CHOSEN_PLAYER"===e,"Invalid value for FirstPlayer: "+e+"."),VY.CHOSEN_PLAYER}}}VY.CREATOR=new VY("CREATOR"),VY.RANDOM=new VY("RANDOM"),VY.CHOSEN_PLAYER=new VY("CHOSEN_PLAYER");class $Y{constructor(e){this.value=e}static of(e){switch(e){case"STANDARD":return $Y.STANDARD;case"BLITZ":return $Y.BLITZ;case"CUSTOM":return $Y.CUSTOM;default:throw new Error("Invalid part type: "+e+".")}}}$Y.STANDARD=new $Y("STANDARD"),$Y.BLITZ=new $Y("BLITZ"),$Y.CUSTOM=new $Y("CUSTOM"),$Y.NORMAL_MOVE_DURATION=120,$Y.NORMAL_PART_DURATION=1800,$Y.BLITZ_MOVE_DURATION=30,$Y.BLITZ_PART_DURATION=900;class zY{constructor(e){this.value=e}}zY.PART_CREATED=new zY(0),zY.CONFIG_PROPOSED=new zY(2),zY.PART_STARTED=new zY(3),zY.PART_FINISHED=new zY(4);class HY{}class GY extends HY{static disjunction3(e,t,n,r,i){return new class extends GY{encodeMove(s){return r(s)?{type:"T1",encoded:e.encode(s)}:i(s)?{type:"T2",encoded:t.encode(s)}:{type:"T3",encoded:n.encode(s)}}decodeMove(r){const i=uw.getNonNullable(r).type,s=uw.getNonNullable(r).encoded;return"T1"===i?e.decode(s):"T2"===i?t.decode(s):n.decode(s)}}}encode(e){return this.encodeMove(e)}decode(e){return VG(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}class qY extends GY{static ofN(e,t,n){return new class extends qY{maxValue(){return e}encodeNumber(e){return t(e)}decodeNumber(e){return n(e)}}}static tuple(e,t,n){return new class extends qY{maxValue(){let t=0;return Object.keys(e).forEach(n=>{t=t*e[n].shift()+e[n].maxValue()}),t}encodeNumber(n){const r=t(n);let i=0;return Object.keys(r).forEach(t=>{i=i*e[t].shift()+e[t].encode(r[t])}),i}decodeNumber(t){const r={};let i=t;return Object.keys(e).reverse().forEach(t=>{const n=i%e[t].shift();i=(i-n)/e[t].shift(),r[t]=e[t].decode(n)}),n(r)}}}static disjunction(e,t,n){return new class extends qY{maxValue(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}encodeNumber(r){return n(r)?2*e.encodeNumber(r):2*t.encodeNumber(r)+1}decodeNumber(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}}static numberEncoder(e){return new class extends qY{maxValue(){return e}encodeNumber(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}decodeNumber(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}}shift(){return this.maxValue()+1}encodeMove(e){return this.encodeNumber(e)}decodeMove(e){return VG("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}qY.booleanEncoder=new class extends qY{maxValue(){return 1}encodeNumber(e){return e?1:0}decodeNumber(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}};class WY{constructor(){this.value=2}isPlayer(){return!1}toString(){return"PlayerNone"}equals(e){return this===e}}WY.NONE=new WY;class jY{constructor(e){this.value=e}static of(e){switch(e){case 0:return jY.ZERO;default:return uw.expectToBe(e,1),jY.ONE}}static fromTurn(e){return e%2==0?jY.ZERO:jY.ONE}isPlayer(){return!0}toString(){return"Player "+this.value}equals(e){return this===e}getScoreModifier(){return 0===this.value?-1:1}getPreVictory(){return this.getVictoryValue()-this.getScoreModifier()}getDefeatValue(){return this===jY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}getVictoryValue(){return this===jY.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}getOpponent(){switch(this){case jY.ZERO:return jY.ONE;default:return uw.expectToBe(this,jY.ONE),jY.ZERO}}}var ZY;jY.numberEncoder=qY.ofN(2,e=>e.value,e=>2===e?ZY.NONE:jY.of(e)),jY.ZERO=new jY(0),jY.ONE=new jY(1),function(e){e.ZERO=jY.ZERO,e.ONE=jY.ONE,e.NONE=WY.NONE}(ZY||(ZY={}));class YY{static rematchAccepted(e,t){return KY("RematchAccepted",{typeGame:e,partId:t})}static getPlayer(e){return jY.of(uw.getNonNullable(e.data).player)}static getTypeGame(e){return uw.getNonNullable(e.data).typeGame}static getPartId(e){return uw.getNonNullable(e.data).partId}}function KY(e,t){return{code:e,data:t}}function JY(e){return t=>KY(e,{player:t.value})}YY.drawProposed=JY("DrawProposed"),YY.drawAccepted=KY("DrawAccepted",{}),YY.drawRefused=JY("DrawRefused"),YY.takeBackAsked=JY("TakeBackAsked"),YY.takeBackRefused=JY("TakeBackRefused"),YY.takeBackAccepted=JY("TakeBackAccepted"),YY.rematchProposed=JY("RematchProposed"),YY.addTurnTime=JY("AddTurnTime"),YY.addGlobalTime=JY("AddGlobalTime");class QY{static mapBiArray(e,t){const n=[];let r=0;for(;r<e.length;){n[r]=[];let i=0;for(;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}static createTable(e,t,n){const r=[];let i=t-1;for(;i>=0;){r[i]=[];let t=e-1;for(;t>=0;)r[i][t]=n,t--;i--}return r}static copyBiArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=QY.copyImmutableArray(e[n]),n++;return t}static copyImmutableArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=e[n],n++;return t}static sortByDescending(e,t){e.sort((e,n)=>{const r=t(e),i=t(n);return r<i?1:r>i?-1:0})}static compareArray(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===pw(e[n],t[n]))return!1;return!0}static compareTable(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===QY.compareArray(e[n],t[n]))return!1;return!0}}let XY=(()=>{class e extends NG{constructor(t){super("joiners",t),hw(e.VERBOSE,"JoinerDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(uG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),eK=(()=>{class e{constructor(t){this.joinerDAO=t,this.joinerUnsubscribe=gw.empty(),hw(e.VERBOSE,"JoinerService.constructor")}subscribeToChanges(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=gw.of(this.joinerDAO.subscribeToChanges(e,t))}unsubscribe(){VG(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=gw.empty()}createInitialJoiner(t,n){var r=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.createInitialJoiner("+t.id+", "+n+")"),r.set(n,{candidates:[],chosenOpponent:null,firstPlayer:VY.RANDOM.value,partType:$Y.STANDARD.value,partStatus:zY.PART_CREATED.value,maximalMoveDuration:$Y.NORMAL_MOVE_DURATION,totalPartDuration:$Y.NORMAL_PART_DURATION,creator:t})})()}joinGame(t,n){var r=this;return lw(function*(){hw(e.VERBOSE,"JoinerService.joinGame("+t+", "+n.id+")");const i=yield r.joinerDAO.read(t);if(i.isAbsent())return DG.failure(e.GAME_DOES_NOT_EXIST());const s=QY.copyImmutableArray(i.get().candidates);return s.some(e=>e.id===n.id)?DG.failure(e.USER_ALREADY_IN_GAME()):(n.id===i.get().creator.id||(s[s.length]=n,yield r.joinerDAO.update(t,{candidates:s})),DG.SUCCESS)})()}cancelJoining(t){var n=this;return lw(function*(){if(hw(e.VERBOSE,"JoinerService.cancelJoining("+t.name+"); this.observedJoinerId = "+n.observedJoinerId),null==n.observedJoinerId)throw new Error("cannot cancel joining when not observing a joiner");const r=yield n.joinerDAO.read(n.observedJoinerId);if(!r.isAbsent()){const e=r.get(),i=QY.copyImmutableArray(e.candidates),s=i.findIndex(e=>e.id===t.id);let o=e.chosenOpponent,a=e.partStatus;if(i.splice(s,1),o?.id===t.id)o=null,a=zY.PART_CREATED.value;else if(-1===s)throw new Error("someone that was not candidate nor ChosenOpponent just left the chat: "+t.name);return n.joinerDAO.update(n.observedJoinerId,{chosenOpponent:o,partStatus:a,candidates:i})}})()}updateCandidates(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.reviewConfig"),VG(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(n.observedJoinerId,{candidates:t})})()}deleteJoiner(){var t=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),VG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(t.observedJoinerId)})()}proposeConfig(t,n,r,i,s){var o=this;return lw(function*(){return hw(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:s}}),hw(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),VG(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(o.observedJoinerId,{partStatus:zY.CONFIG_PROPOSED.value,chosenOpponent:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:s,firstPlayer:i.value})})()}setChosenOpponent(t){return hw(e.VERBOSE,`JoinerService.setChosenOpponent(${t.name})`),VG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(this.observedJoinerId,{chosenOpponent:t})}reviewConfig(){var t=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.reviewConfig"),VG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(t.observedJoinerId,{partStatus:zY.PART_CREATED.value})})()}reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.reviewConfig"),VG(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(n.observedJoinerId,{partStatus:zY.PART_CREATED.value,candidates:t,chosenOpponent:null})})()}acceptConfig(){return hw(e.VERBOSE,"JoinerService.acceptConfig"),VG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(this.observedJoinerId,{partStatus:zY.PART_STARTED.value})}createJoiner(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)})()}readJoinerById(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),(yield n.joinerDAO.read(t)).get()})()}set(t,n){var r=this;return lw(function*(){return hw(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)})()}updateJoinerById(t,n){var r=this;return lw(function*(){return hw(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)})()}}return e.VERBOSE=!1,e.USER_ALREADY_IN_GAME=()=>$localize`You cannot join this game because you are already in another one.`,e.GAME_DOES_NOT_EXIST=()=>$localize`Game does not exist`,e.\u0275fac=function(t){return new(t||e)(Or(XY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),tK=(()=>{class e{constructor(t,n,r){this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=gw.empty(),hw(e.VERBOSE,"GameService.constructor")}getPartValidity(e,t){var n=this;return lw(function*(){const r=yield n.partDAO.read(e);return r.isAbsent()?DG.failure("NONEXISTENT_PART"):r.get().typeGame===t?DG.SUCCESS:DG.failure("WRONG_GAME_TYPE")})()}createUnstartedPart(t,n){return hw(e.VERBOSE,"GameService.createPart("+t.name+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t.name,turn:-1,result:$G.UNACHIEVED.value,listMoves:[]})}createChat(t){return hw(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}createPartJoinerAndChat(t,n){var r=this;return lw(function*(){hw(e.VERBOSE,`GameService.createGame(${t.id}, ${n})`);const i=yield r.createUnstartedPart(t,n);return yield r.joinerService.createInitialJoiner(t,i),yield r.createChat(i),i})()}startGameWithConfig(t,n,r,i){hw(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));const s=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,s)}getStartingConfig(e){let t,n,r=VY.of(e.firstPlayer);return r===VY.RANDOM&&(r=Math.random()<.5?VY.CREATOR:VY.CHOSEN_PLAYER),r===VY.CREATOR?(t=e.creator.name,n=uw.getNonNullable(e.chosenOpponent).name):(t=uw.getNonNullable(e.chosenOpponent).name,n=e.creator.name),{playerZero:t,playerOne:n,turn:0,beginning:lG(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}deletePart(t){var n=this;return lw(function*(){return hw(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)})()}acceptConfig(t,n){var r=this;return lw(function*(){return hw(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),yield r.joinerService.acceptConfig(),r.startGameWithConfig(t,jY.ONE,0,n)})()}startObserving(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");hw(e.VERBOSE,"[start watching part "+t),this.followedPartId=gw.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}resign(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:$G.RESIGN.value,request:null})}notifyTimeout(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:$G.TIMEOUT.value,request:null})}sendRequest(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}proposeDraw(e,t,n){return this.sendRequest(e,n,t,YY.drawProposed(n))}acceptDraw(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===jY.ZERO?$G.AGREED_DRAW_BY_ZERO:$G.AGREED_DRAW_BY_ONE).value,request:null})}refuseDraw(e,t,n){return this.sendRequest(e,n,t,YY.drawRefused(n))}proposeRematch(e,t,n){return this.sendRequest(e,n,t,YY.rematchProposed(n))}acceptRematch(t,n,r){var i=this;return lw(function*(){hw(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t});const s=uw.getNonNullable(t.data),o=yield i.joinerService.readJoinerById(t.id);let a;a=s.playerZero===o.creator.name?VY.CHOSEN_PLAYER:VY.CREATOR;const c={...o,candidates:[],firstPlayer:a.value,partStatus:zY.PART_STARTED.value},l=yield i.joinerService.createJoiner(c),u=i.getStartingConfig(c),h={lastUpdate:{index:0,player:r.value},typeGame:s.typeGame,result:$G.UNACHIEVED.value,listMoves:[],...u};return yield i.partDAO.set(l,h),yield i.createChat(l),i.sendRequest(t.id,r,n,YY.rematchAccepted(s.typeGame,l))})()}askTakeBack(e,t,n){return this.sendRequest(e,n,t,YY.takeBackAsked(n))}acceptTakeBack(e,t,n,r){var i=this;return lw(function*(){VG(YY.getPlayer(uw.getNonNullable(t.data.request))!==n,"Illegal to accept your own request");const s=YY.takeBackAccepted(n);let o=t.data.listMoves.slice(0,t.data.listMoves.length-1);o.length%2===n.value&&(o=o.slice(0,o.length-1));const a={request:s,listMoves:o,turn:o.length,lastUpdateTime:lG(),remainingMsForZero:uw.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:uw.getNonNullable(t.data.remainingMsForOne)-r[1]},c=t.data.lastUpdate.index;return yield i.partDAO.updateAndBumpIndex(e,n,c,a)})()}refuseTakeBack(e,t,n){const r=YY.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}addGlobalTime(e,t,n,r){var i=this;return lw(function*(){let s={request:YY.addGlobalTime(r.getOpponent())};return s=r===jY.ZERO?{...s,remainingMsForOne:uw.getNonNullable(n.remainingMsForOne)+3e5}:{...s,remainingMsForZero:uw.getNonNullable(n.remainingMsForZero)+3e5},yield i.partDAO.updateAndBumpIndex(e,r,t,s)})()}addTurnTime(e,t,n){var r=this;return lw(function*(){const i={request:YY.addTurnTime(e.getOpponent())};return yield r.partDAO.updateAndBumpIndex(n,e,t,i)})()}stopObserving(){hw(e.VERBOSE,"GameService.stopObserving();"),VG(this.followedPartId.isPresent(),"!!! GameService.stopObserving: we already stop watching doc"),hw(e.VERBOSE,"stopped watching joiner "+this.followedPartId+"]"),this.followedPartId=gw.empty(),this.followedPartUnsubscribe()}updateDBBoard(t,n,r,i,s,o,a,c){var l=this;return lw(function*(){hw(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:s,msToSubstract:i,notifyDraw:o,winner:a,loser:c}});const u=(yield l.partDAO.read(t)).get(),h=u.lastUpdate.index,d=u.turn+1,f=QY.copyImmutableArray(u.listMoves);f[f.length]=r;let p={listMoves:f,turn:d,request:null,lastUpdateTime:lG()};return p=l.updateScore(p,s),p=l.substractMs(p,u,i),null!=a?p={...p,winner:a,loser:c,result:$G.VICTORY.value}:!0===o&&(p={...p,result:$G.HARD_DRAW.value}),yield l.partDAO.updateAndBumpIndex(t,n,h,p)})()}updateScore(e,t){return void 0!==t?{...e,scorePlayerZero:t[0],scorePlayerOne:t[1]}:e}substractMs(e,t,n){return n[0]>0?{...e,remainingMsForZero:uw.getNonNullable(t.remainingMsForZero)-n[0]}:n[1]>0?{...e,remainingMsForOne:uw.getNonNullable(t.remainingMsForOne)-n[1]}:e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(HG),Or(eK),Or(WG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class nK{static getNavigatorLanguage(){return navigator.language}static getLocale(){const e=(localStorage.getItem("locale")||nK.getNavigatorLanguage()||"fr").slice(0,2).toLowerCase();return["en","fr"].some(t=>t===e)?e:"fr"}}let rK=(()=>{class e{constructor(){}changeTheme(e){localStorage.setItem("theme",e)}getTheme(){return gw.ofNullable(localStorage.getItem("theme"))}changeLanguage(e){localStorage.setItem("locale",e.toLowerCase())}getLanguage(){return nK.getLocale()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),iK=(()=>{class e{constructor(e,t){this.document=e,this.userSettingsService=t,this.availableThemes=["dark","light"];const n=this.getStoredTheme();n.isPresent()?this.loadTheme(n.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}getStoredTheme(){const e=this.userSettingsService.getTheme();if(e.isPresent()){const t=e.get();if(this.availableThemes.some(e=>e===t))return gw.of(t)}return gw.empty()}loadTheme(e){this.loadStyle(e+".css"),this.theme=e}loadStyle(e){const t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{const n=this.document.createElement("link");n.id="theme",n.rel="stylesheet",n.href=`${e}`,t.appendChild(n)}}getTheme(){return this.theme}}return e.\u0275fac=function(t){return new(t||e)(Or(Rh),Or(rK))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var sK={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},oK={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},aK={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},cK={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},lK={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},uK={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]};function hK(e){return(hK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){fK(e,t,n[t])})}return e}function gK(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,s=c}finally{try{!r&&null!=a.return&&a.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var mK={},yK={};try{"undefined"!=typeof window&&(mK=window),"undefined"!=typeof document&&(yK=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch{}var vK=(mK.navigator||{}).userAgent,_K=void 0===vK?"":vK,CK=mK,EK=yK,wK=!!EK.documentElement&&!!EK.head&&"function"==typeof EK.addEventListener&&"function"==typeof EK.createElement,bK=(~_K.indexOf("MSIE")||_K.indexOf("Trident/"),"___FONT_AWESOME___"),SK="svg-inline--fa",PK=[1,2,3,4,5,6,7,8,9,10],OK=PK.concat([11,12,13,14,15,16,17,18,19,20]),TK={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},IK=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",TK.GROUP,TK.SWAP_OPACITY,TK.PRIMARY,TK.SECONDARY].concat(PK.map(function(e){return"".concat(e,"x")})).concat(OK.map(function(e){return"w-".concat(e)})),CK.FontAwesomeConfig||{});EK&&"function"==typeof EK.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=gK(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=EK.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(IK[n]=r)});var kK=pK({},{familyPrefix:"fa",replacementClass:SK,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},IK);kK.autoReplaceSvg||(kK.observeMutations=!1);var AK=pK({},kK);CK.FontAwesomeConfig=AK;var NK=CK||{};NK[bK]||(NK[bK]={}),NK[bK].styles||(NK[bK].styles={}),NK[bK].hooks||(NK[bK].hooks={}),NK[bK].shims||(NK[bK].shims=[]);var MK=NK[bK],xK=[];wK&&((EK.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(EK.readyState)||EK.addEventListener("DOMContentLoaded",function e(){EK.removeEventListener("DOMContentLoaded",e),xK.map(function(e){return e()})}));var RK,DK="pending",LK="fulfilled",FK="rejected",BK=function(){},UK="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,VK="undefined"==typeof setImmediate?setTimeout:setImmediate,$K=[];function zK(){for(var e=0;e<$K.length;e++)$K[e][0]($K[e][1]);$K=[],RK=!1}function HK(e,t){$K.push([e,t]),RK||(RK=!0,VK(zK,0))}function GK(e){var t=e.owner,n=t._state,r=t._data,i=e[n],s=e.then;if("function"==typeof i){n=LK;try{r=i(r)}catch(o){ZK(s,o)}}qK(s,r)||(n===LK&&WK(s,r),n===FK&&ZK(s,r))}function qK(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===hK(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?jK(e,r):WK(e,r))},function(t){n||(n=!0,ZK(e,t))}),!0}}catch(i){return n||ZK(e,i),!0}return!1}function WK(e,t){(e===t||!qK(e,t))&&jK(e,t)}function jK(e,t){e._state===DK&&(e._state="settled",e._data=t,HK(KK,e))}function ZK(e,t){e._state===DK&&(e._state="settled",e._data=t,HK(JK,e))}function YK(e){e._then=e._then.forEach(GK)}function KK(e){e._state=LK,YK(e)}function JK(e){e._state=FK,YK(e),!e._handled&&UK&&global.process.emit("unhandledRejection",e._data,e)}function QK(e){global.process.emit("rejectionHandled",e)}function XK(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof XK))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){ZK(t,e)}try{e(function(e){WK(t,e)},n)}catch(r){n(r)}}(e,this)}XK.prototype={constructor:XK,_state:DK,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(BK),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===FK&&UK&&HK(QK,this)),this._state===LK||this._state===FK?HK(GK,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},XK.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new XK(function(t,n){var r=[],i=0;function s(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,a=0;a<e.length;a++)(o=e[a])&&"function"==typeof o.then?o.then(s(a),n):r[a]=o;i||t(r)})},XK.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new XK(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},XK.resolve=function(e){return e&&"object"===hK(e)&&e.constructor===XK?e:new XK(function(t){t(e)})},XK.reject=function(e){return new XK(function(t,n){n(e)})};var eJ={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function tJ(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function nJ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function rJ(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function iJ(e){return e.size!==eJ.size||e.x!==eJ.x||e.y!==eJ.y||e.rotate!==eJ.rotate||e.flipX||e.flipY}function sJ(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),s="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(s," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var oJ={x:0,y:0,width:"100%",height:"100%"};function aJ(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function cJ(e){return"g"===e.tag?e.children:[e]}function lJ(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,s=e.iconName,o=e.transform,a=e.symbol,c=e.title,l=e.maskId,u=e.titleId,h=e.extra,d=e.watchable,f=void 0!==d&&d,p=r.found?r:n,g=p.width,m=p.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(g/m*16)),_=[AK.replacementClass,s?"".concat(AK.familyPrefix,"-").concat(s):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),C={children:[],attributes:pK({},h.attributes,{"data-prefix":i,"data-icon":s,class:_,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(g," ").concat(m)})},E=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(g/m*16*.0625,"em")}:{};f&&(C.attributes["data-fa-i2svg"]=""),c&&C.children.push({tag:"title",attributes:{id:C.attributes["aria-labelledby"]||"title-".concat(u||tJ())},children:[c]});var w=pK({},C,{prefix:i,iconName:s,main:n,mask:r,maskId:l,transform:o,symbol:a,styles:pK({},E,h.styles)}),b=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,s=e.maskId,o=r.icon,a=i.icon,c=sJ({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),l={tag:"rect",attributes:pK({},oJ,{fill:"white"})},u=o.children?{children:o.children.map(aJ)}:{},h={tag:"g",attributes:pK({},c.inner),children:[aJ(pK({tag:o.tag,attributes:pK({},o.attributes,c.path)},u))]},d={tag:"g",attributes:pK({},c.outer),children:[h]},f="mask-".concat(s||tJ()),p="clip-".concat(s||tJ()),g={tag:"mask",attributes:pK({},oJ,{id:f,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[l,d]},m={tag:"defs",children:[{tag:"clipPath",attributes:{id:p},children:cJ(a)},g]};return t.push(m,{tag:"rect",attributes:pK({fill:"currentColor","clip-path":"url(#".concat(p,")"),mask:"url(#".concat(f,")")},oJ)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,s=rJ(e.styles);if(s.length>0&&(n.style=s),iJ(i)){var o=sJ({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:pK({},o.outer),children:[{tag:"g",attributes:pK({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:pK({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),S=b.attributes;return w.children=b.children,w.attributes=S,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:pK({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(AK.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,s=e.styles,o=e.transform;if(iJ(o)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=rJ(pK({},s,{"transform-origin":"".concat(a.x+o.x/16,"em ").concat(a.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var uJ=function(e,t,n,r){var i,s,o,a=Object.keys(e),c=a.length,l=void 0!==r?function(e,t){return function(n,r,i,s){return e.call(t,n,r,i,s)}}(t,r):t;for(void 0===n?(i=1,o=e[a[0]]):(i=0,o=n);i<c;i++)o=l(o,e[s=a[i]],s,e);return o};function hJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,s=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof MK.hooks.addPack||i?MK.styles[e]=pK({},MK.styles[e]||{},s):MK.hooks.addPack(e,s),"fas"===e&&hJ("fa",t)}var dJ=MK.styles,fJ=MK.shims,pJ=function(){var e=function(e){return uJ(dJ,function(t,n,r){return t[r]=uJ(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in dJ;uJ(fJ,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function gJ(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function mJ(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,s=void 0===i?[]:i;return"string"==typeof e?nJ(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(nJ(e[n]),'" ')},"").trim()}(r),">").concat(s.map(mJ).join(""),"</").concat(t,">")}pJ();function yJ(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}(yJ.prototype=Object.create(Error.prototype)).constructor=yJ;var vJ={fill:"currentColor"},_J={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},CJ=(pK({},vJ,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),pK({},_J,{attributeName:"opacity"}));function EJ(e){var t=e[0],n=e[1],r=gK(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(AK.familyPrefix,"-").concat(TK.GROUP)},children:[{tag:"path",attributes:{class:"".concat(AK.familyPrefix,"-").concat(TK.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(AK.familyPrefix,"-").concat(TK.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function wJ(){AK.autoAddCss&&!OJ&&(function(e){if(e&&wK){var t=EK.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=EK.head.childNodes,r=null,i=n.length-1;i>-1;i--){var s=n[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}EK.head.insertBefore(t,r)}}(function(){var e="fa",t=SK,n=AK.familyPrefix,r=AK.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var s=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(s,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),OJ=!0)}function bJ(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return mJ(e)})}}),Object.defineProperty(e,"node",{get:function(){if(wK){var t=EK.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function SJ(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return gJ(PJ.definitions,n,r)||gJ(MK.styles,n,r)}pK({},vJ,{cx:"256",cy:"364",r:"28"}),pK({},_J,{attributeName:"r",values:"28;14;28;28;14;28;"}),pK({},CJ,{values:"1;0;1;1;0;1;"}),pK({},vJ,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),pK({},CJ,{values:"1;0;0;0;0;1;"}),pK({},vJ,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),pK({},CJ,{values:"0;0;1;1;0;0;"});var PJ=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&dK(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=pK({},e.definitions[t]||{},i[t]),hJ(t,i[t]),pJ()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,s=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][s]=o}),e}}]),e}()),OJ=!1,TJ=function(e){return function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(e)},IJ=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:SJ(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:SJ(i||{})),e(r,pK({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?eJ:n,i=t.symbol,s=void 0!==i&&i,o=t.mask,a=void 0===o?null:o,c=t.maskId,l=void 0===c?null:c,u=t.title,h=void 0===u?null:u,d=t.titleId,f=void 0===d?null:d,p=t.classes,g=void 0===p?[]:p,m=t.attributes,y=void 0===m?{}:m,v=t.styles,_=void 0===v?{}:v;if(e){var C=e.prefix,E=e.iconName,w=e.icon;return bJ(pK({type:"icon"},e),function(){return wJ(),AK.autoA11y&&(h?y["aria-labelledby"]="".concat(AK.replacementClass,"-title-").concat(f||tJ()):(y["aria-hidden"]="true",y.focusable="false")),lJ({icons:{main:EJ(w),mask:a?EJ(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:C,iconName:E,transform:pK({},eJ,r),symbol:s,title:h,maskId:l,titleId:f,extra:{attributes:y,styles:_,classes:g}})})}});const kJ=["*"],AJ=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let NJ=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),MJ=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e){t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t;for(const e of t.icon[2])"string"==typeof e&&(this.definitions[t.prefix][e]=t)}}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),xJ=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[vt]}),e})(),RJ=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(ca(ul),ca(al))},e.\u0275cmp=Xe({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[vt],ngContentSelectors:kJ,decls:1,vars:0,template:function(e,t){1&e&&(function(e){const t=zt()[16][6];if(!t.projection){const n=t.projection=fr(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?ba(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}(),function(e,t=0,n){const r=zt(),i=Ht(),s=Fs(i,20+e,16,null,n||null);null===s.projection&&(s.projection=t),Kt(),64!=(64&s.flags)&&function(e,t,n){hs(t[11],0,t,n,ji(e,n,t),Xi(n.parent||t[6],n,t))}(i,r,s)}(0))},encapsulation:2}),e})(),DJ=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=this.icon??this.config.fallbackIcon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=((e,t)=>(e=>void 0!==e.prefix&&void 0!==e.iconName)(e)?e:Array.isArray(e)&&2===e.length?{prefix:e[0],iconName:e[1]}:"string"==typeof e?{prefix:t,iconName:e}:void 0)(e,this.config.defaultPrefix);return"icon"in t?t:this.iconLibrary.getIconDefinition(t.prefix,t.iconName)??((e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null)}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?TJ(this.transform):this.transform;return{title:this.title,transform:t,classes:[...AJ(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=IJ(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(ca(Sf),ca(NJ),ca(MJ),ca(xJ,8),ca(RJ,8))},e.\u0275cmp=Xe({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(Va("innerHTML",t.renderedIconHTML,vi),na("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[vt],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),LJ=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function FJ(e,t){if(1&e){const e=ma();pa(0),ha(1,"div",9),ha(2,"a",10),Da(3),da(),ha(4,"div",12),ha(5,"a",24),_a("click",function(){return Gt(e),wa().logout()}),Hc(6,25),da(),da(),da(),ga()}if(2&e){const e=wa();Ts(3),La(e.username)}}const BJ=function(){return["/register"]},UJ=function(){return["/login"]};function VJ(e,t){1&e&&(ha(0,"div",26),ha(1,"a",27),ha(2,"strong"),Hc(3,28),da(),da(),ha(4,"a",29),Hc(5,30),da(),da()),2&e&&(Ts(1),la("routerLink",ou(2,BJ)),Ts(3),la("routerLink",ou(3,UJ)))}const $J=function(){return["/"]},zJ=function(){return["/play"]},HJ=function(){return["/lobby"]},GJ=function(){return["/local"]},qJ=function(){return["/tutorial"]},WJ=function(){return["/settings"]};let jJ=(()=>{class e{constructor(e,t,n){this.router=e,this.connectedUserService=t,this.userService=n,this.username="connecting...",this.faCog=oK,this.showMenu=!1}ngOnInit(){this.userSub=this.connectedUserService.getUserObs().subscribe(e=>{this.username=e.username.isPresent()?e.username.get():e.email.getOrElse("")})}logout(){var e=this;return lw(function*(){yield e.connectedUserService.disconnect(),yield e.router.navigate(["/"])})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(UY),ca(KG))},e.\u0275cmp=Xe({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){let e,t,n,r,i,s,o,a,c,l,u;return e=$localize`Home`,t=$localize`Play online`,n=$localize`Create a game`,r=$localize`Join a game`,i=$localize`Play offline`,s=$localize`Create a game`,o=$localize`Learn the rules`,a=$localize`Settings`,c=$localize`Log out`,l=$localize`Register`,u=$localize`Log in`,[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],e,[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],t,[1,"navbar-dropdown"],n,r,i,s,o,[1,"navbar-end"],["data-tooltip",a,1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["connect",""],["id","logout",1,"navbar-item",3,"click"],c,[1,"buttons"],[1,"button","is-primary",3,"routerLink"],l,[1,"button","is-light",3,"routerLink"],u]},template:function(e,t){if(1&e&&(ha(0,"nav",0),ha(1,"div",1),ha(2,"a",2),fa(3,"img",3),da(),ha(4,"a",4),_a("click",function(){return t.showMenu=!t.showMenu}),fa(5,"span",5),fa(6,"span",5),fa(7,"span",5),da(),da(),ha(8,"div",6),_a("click",function(){return t.showMenu=!t.showMenu}),ha(9,"div",7),ha(10,"a",2),Hc(11,8),da(),ha(12,"div",9),ha(13,"a",10),Hc(14,11),da(),ha(15,"div",12),ha(16,"a",2),Hc(17,13),da(),ha(18,"a",2),Hc(19,14),da(),da(),da(),ha(20,"div",9),ha(21,"a",10),Hc(22,15),da(),ha(23,"div",12),ha(24,"a",2),Hc(25,16),da(),ha(26,"a",2),Hc(27,17),da(),da(),da(),da(),ha(28,"div",18),ha(29,"a",19),fa(30,"fa-icon",20),da(),ha(31,"div",21),oa(32,FJ,7,1,"ng-container",22),oa(33,VJ,6,4,"ng-template",null,23,Ru),da(),da(),da(),da()),2&e){const e=aa(34);Ts(2),la("routerLink",ou(12,$J)),Ts(2),la("ngClass",t.showMenu?"is-active":""),Ts(4),la("ngClass",t.showMenu?"is-active":""),Ts(2),la("routerLink",ou(13,$J)),Ts(6),la("routerLink",ou(14,zJ)),Ts(2),la("routerLink",ou(15,HJ)),Ts(6),la("routerLink",ou(16,GJ)),Ts(2),la("routerLink",ou(17,qJ)),Ts(3),la("routerLink",ou(18,WJ)),Ts(1),la("icon",t.faCog),Ts(2),la("ngIf",t.username)("ngIfElse",e)}},directives:[t_,Fd,DJ,$d],encapsulation:2}),e})(),ZJ=(()=>{class e{constructor(e,t){this._themeService=e,this._errorLoggerService=t}}return e.\u0275fac=function(t){return new(t||e)(ca(iK),ca(UG))},e.\u0275cmp=Xe({type:e,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container","mt-2"]],template:function(e,t){1&e&&(fa(0,"app-header"),ha(1,"main",0),fa(2,"router-outlet"),da())},directives:[jJ,r_],encapsulation:2}),e})();class YJ{constructor(e,t){this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}}class KJ extends YJ{isDown(){return 1===this.y}isUp(){return-1===this.y}isLeft(){return-1===this.x}isRight(){return 1===this.x}toInt(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}toString(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}class JJ{of(e,t){for(const n of this.all)if(n.x===e&&n.y===t)return MG.success(n);return MG.failure("Invalid x and y in direction construction")}fromDelta(e,t){return 0===e&&0===t?MG.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):MG.failure(`Invalid delta for direction: ${e}, ${t}`)}fromMove(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}fromString(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return MG.failure(`Invalid direction string ${e}`)}}fromInt(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return MG.failure(`Invalid int direction: ${e}`)}}}class QJ extends KJ{constructor(e,t){super(e,t)}isDiagonal(){return 0!==this.x&&0!==this.y}getOpposite(){return QJ.factory.of(-this.x,-this.y).get()}}QJ.UP=new QJ(0,-1),QJ.UP_RIGHT=new QJ(1,-1),QJ.RIGHT=new QJ(1,0),QJ.DOWN_RIGHT=new QJ(1,1),QJ.DOWN=new QJ(0,1),QJ.DOWN_LEFT=new QJ(-1,1),QJ.LEFT=new QJ(-1,0),QJ.UP_LEFT=new QJ(-1,-1),QJ.factory=new class extends JJ{constructor(){super(...arguments),this.all=[QJ.UP,QJ.UP_RIGHT,QJ.RIGHT,QJ.DOWN_RIGHT,QJ.DOWN,QJ.DOWN_LEFT,QJ.LEFT,QJ.UP_LEFT]}},QJ.DIRECTIONS=QJ.factory.all,QJ.encoder=new class extends HY{encode(e){return e.toString()}decode(e){return VG("string"==typeof e,"Invalid encoded direction"),QJ.factory.fromString(e).get()}};class XJ extends KJ{constructor(e,t){super(e,t)}getOpposite(){return XJ.factory.of(-this.x,-this.y).get()}}XJ.UP=new XJ(0,-1),XJ.RIGHT=new XJ(1,0),XJ.DOWN=new XJ(0,1),XJ.LEFT=new XJ(-1,0),XJ.factory=new class extends JJ{constructor(){super(...arguments),this.all=[XJ.UP,XJ.RIGHT,XJ.DOWN,XJ.LEFT]}of(e,t){return 0===e&&-1===t?MG.success(XJ.UP):1===e&&0===t?MG.success(XJ.RIGHT):0===e&&1===t?MG.success(XJ.DOWN):-1===e&&0===t?MG.success(XJ.LEFT):MG.failure("Invalid orthogonal from x and y")}},XJ.ORTHOGONALS=XJ.factory.all,XJ.encoder=new class extends HY{encode(e){return e.toString()}decode(e){return VG("string"==typeof e,"Invalid encoded orthogonal"),XJ.factory.fromString(e).get()}};class eQ{constructor(e,t){this.x=e,this.y=t}static numberEncoder(e,t){return qY.tuple([qY.numberEncoder(e),qY.numberEncoder(t)],e=>[e.x,e.y],e=>new eQ(e[0],e[1]))}getNext(e,t){return new eQ(this.x+(t=t??1)*e.x,this.y+t*e.y)}getPrevious(e,t){return this.getNext(e,-(t=t??1))}getLeft(e){return new eQ(this.x+e.y,this.y+-e.x)}getRight(e){return new eQ(this.x+-e.y,this.y+e.x)}getOpposite(){return new eQ(-this.x,-this.y)}isInRange(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}isNotInRange(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}getDirectionToward(e){return QJ.factory.fromMove(this,e)}getOrthogonalDistance(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}getDistance(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");const t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}isHexagonallyAlignedWith(e){const t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}isAlignedWith(e){const t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}getVectorToward(e){return new eQ(e.x-this.x,e.y-this.y)}getMinimalVectorToward(e){return this.getVectorToward(e).toVector()}getCoordsToward(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];const t=this.getDirectionToward(e).get();let n=this.getNext(t,1);const r=[];for(;!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}toVector(){const e=Math.abs(this.x),t=Math.abs(this.y),n=Math.max(e,t);let r=this.x,i=this.y,s=2;for(;s<=n;)r%s==0&&i%s==0?(r/=s,i/=s):s++;return new eQ(r,i)}isBetween(e,t){const n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}equals(e){return this===e||e.x===this.x&&e.y===this.y}compareTo(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}toString(){return"("+this.x+", "+this.y+")"}}eQ.encoder=new class extends HY{encode(e){return{x:e.x,y:e.y}}decode(e){const t=e;return VG(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new eQ(t.x,t.y)}};let tQ=(()=>{class e{constructor(e){this.messageDisplayer=e,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=gw.empty(),this.imagesLocation="assets/images/"}message(e){this.messageDisplayer.gameMessage(e)}cancelMove(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?DG.SUCCESS:(this.messageDisplayer.gameMessage(e),DG.failure(e))}cancelMoveAttempt(){}getPlayerClass(e){switch(e){case jY.ZERO:return"player0";case jY.ONE:return"player1";default:return uw.expectToBe(e,ZY.NONE),""}}pass(){var e=this;return lw(function*(){return UG.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name})})()}getTurn(){return this.rules.node.gameState.turn}getCurrentPlayer(){return this.rules.node.gameState.getCurrentPlayer()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}range(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),nQ=(()=>{class e extends tQ{getHexaCoordsBy(e,t){const n=new eQ(e,t);return this.getHexaCoordsAt(n)}getHexaCoordsAt(e){let t="";const n=this.hexaLayout.getHexaCoordsAt(e);for(const r of n)t+=r.x+" "+r.y+" ";return t+=n[0].x+" "+n[0].y,t}getCenterBy(e,t){const n=new eQ(e,t);return this.getCenterAt(n)}getCenterAt(e){return this.hexaLayout.getCenterAt(e)}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class rQ{constructor(e){this.value=e}static from(e){switch(e){case rQ.ZERO.value:return rQ.ZERO;case rQ.ONE.value:return rQ.ONE;case rQ.EMPTY.value:return rQ.EMPTY;case rQ.NONE.value:return rQ.NONE;default:throw new Error("FourStatePiece has no value matching "+e)}}static ofPlayer(e){switch(e){case jY.ZERO:return rQ.ZERO;default:return uw.expectToBe(e,jY.ONE),rQ.ONE}}equals(e){return this===e}is(e){return this.value===e.value}isPlayer(){return this===rQ.ZERO||this===rQ.ONE}}rQ.ZERO=new rQ(jY.ZERO.value),rQ.ONE=new rQ(jY.ONE.value),rQ.EMPTY=new rQ(ZY.NONE.value),rQ.NONE=new rQ(3);class iQ extends KJ{constructor(e,t){super(e,t)}static getAngle(e){switch(e){case iQ.UP:return 0;case iQ.UP_RIGHT:return 60;case iQ.RIGHT:return 120;case iQ.DOWN:return 180;case iQ.DOWN_LEFT:return 240;default:return uw.expectToBe(e,iQ.LEFT),300}}getOpposite(){return iQ.factory.of(-this.x,-this.y).get()}}iQ.UP=new iQ(0,-1),iQ.LEFT=new iQ(-1,0),iQ.UP_RIGHT=new iQ(1,-1),iQ.DOWN_LEFT=new iQ(-1,1),iQ.RIGHT=new iQ(1,0),iQ.DOWN=new iQ(0,1),iQ.factory=new class extends JJ{constructor(){super(...arguments),this.all=[iQ.UP,iQ.UP_RIGHT,iQ.RIGHT,iQ.DOWN,iQ.DOWN_LEFT,iQ.LEFT]}},iQ.encoder=new class extends qY{maxValue(){return 5}encodeNumber(e){switch(e){case iQ.UP:return 0;case iQ.UP_RIGHT:return 1;case iQ.RIGHT:return 2;case iQ.DOWN:return 3;case iQ.DOWN_LEFT:return 4;default:return 5}}decodeNumber(e){return VG(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),iQ.factory.all[e]}};class sQ{constructor(e,t,n){this.size=e,this.origin=t,this.orientation=n}getCenterAt(e){const t=this.orientation.conversionMatrix;return new eQ(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}getCornerOffset(e){const t=2*Math.PI*(this.orientation.startAngle+e)/6;return new eQ(this.size*Math.cos(t),this.size*Math.sin(t))}getHexaCoordsAt(e){const t=this.getCenterAt(e),n=[];for(let r=0;r<6;r+=1){const e=this.getCornerOffset(r);n.push(new eQ(t.x+e.x,t.y+e.y))}return n}}class oQ{}class aQ extends oQ{constructor(){super(),this.startAngle=.5,this.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],this.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3]}}aQ.INSTANCE=new aQ;class cQ extends oQ{constructor(){super(),this.startAngle=0,this.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],this.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3]}isOnBorder(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}isOnTopRightBorder(e,t){return 0===t.y}isOnRightBorder(e,t){return t.x===e.width-1}isOnLeftBorder(e,t){return 0===t.x}isOnBottomLeftBorder(e,t){return t.y===e.height-1}isOnTopLeftBorder(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}isOnBottomRightBorder(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}getAllBorders(e){const t=[];return e.forEachCoord((n,r)=>{this.isOnBorder(e,n)&&t.push(n)}),t}isTopCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}isTopLeftCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isTopRightCorner(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}isBottomCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}isBottomLeftCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isBottomRightCorner(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}cQ.INSTANCE=new cQ;let lQ=(()=>{class e{}return e.CANNOT_CHOOSE_OPPONENT_PIECE=()=>$localize`You cannot pick a piece of the opponent.`,e.MUST_CLICK_ON_EMPTY_SPACE=()=>$localize`You must click on an empty space.`,e.CANNOT_SELF_CAPTURE=()=>$localize`Your landing space should be empty or contain a piece of the opponent.`,e.MUST_CHOOSE_PLAYER_PIECE=()=>$localize`You must pick one of your pieces.`,e.CANNOT_PASS=()=>$localize`You cannot pass your turn.`,e.MUST_LAND_ON_EMPTY_SPACE=()=>$localize`You must drop your piece on an empty space.`,e.MUST_PASS=()=>$localize`You must pass your turn.`,e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=()=>$localize`You have selected an empty space, you must select one of your own pieces.`,e.MOVE_CANNOT_BE_STATIC=()=>$localize`You must choose different starting and ending coordinates.`,e})();class uQ{constructor(e,t){this.ruler=e,this.name=t}toString(){return this.name}}class hQ{constructor(e){this.value=e}static fromWinner(e){return e.isPlayer()?new hQ(e.getVictoryValue()):new hQ(0)}toString(){return""+this.value}}class dQ{static toComparableObjectSet(e){const t=[];return e.forEach(e=>{t.some(t=>t.equals(e))||t.push(e)}),t}static toComparableSet(e){const t=[];return e.forEach(e=>{t.some(t=>pw(t,e))||t.push(e)}),t}}class fQ{constructor(e){this.values=void 0===e?[]:dQ.toComparableSet(e)}equals(e){if(e.size()!==this.size())return!1;for(const t of this)if(!1===e.contains(t))return!1;return!0}toString(){let e="";for(const t of this)e+=null==t?"null, ":t.toString()+", ";return"["+e.slice(0,-2)+"]"}add(e){return!this.contains(e)&&(this.values.push(e),!0)}union(e){for(const t of e)this.add(t)}contains(e){for(const t of this.values)if(pw(t,e))return!0;return!1}size(){return this.values.length}toList(){const e=[];for(const t of this)e.push(t);return e}getAnyElement(){return this.size()>0?gw.of(this.values[0]):gw.empty()}[Symbol.iterator](){return this.values.values()}}class pQ{constructor(e){this.turn=e}getCurrentPlayer(){return jY.fromTurn(this.turn)}getCurrentOpponent(){return this.turn%2==1?jY.ZERO:jY.ONE}}class gQ extends pQ{constructor(e,t){super(t),this.board=e}getPieceAt(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}isOnBoard(e){return e.isInRange(this.board[0].length,this.board.length)}getPieceAtXY(e,t){return this.getPieceAt(new eQ(e,t))}forEachCoord(e){for(const[t,n]of this.getCoordsAndContents())e(t,n)}getCoordsAndContents(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++){const r=new eQ(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}getCopiedBoard(){return QY.copyBiArray(this.board)}}class mQ extends gQ{static getInitialState(){const e=rQ.EMPTY,t=rQ.NONE,n=rQ.ZERO,r=rQ.ONE;return new mQ([[t,t,t,t,r,r,r,r,r],[t,t,t,r,r,r,r,r,r],[t,t,e,e,r,r,r,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,n,n,n,e,e,t,t],[n,n,n,n,n,n,t,t,t],[n,n,n,n,n,t,t,t,t]],0)}isInBoard(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==rQ.NONE}isPiece(e){return this.getPieceAt(e).isPlayer()}getScores(){const e=[14,14];for(let t=0;t<9;t++)for(let n=0;n<9;n++)this.getPieceAtXY(n,t)===rQ.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===rQ.ONE&&(e[0]=e[0]-1);return e}}class yQ{}class vQ extends yQ{constructor(e,t){super(),this.coord=new eQ(e,t)}}class _Q extends vQ{constructor(e,t,n){if(super(e.x,e.y),this.dir=t,this.lastPiece=n,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!")}static fromSingleCoord(e,t){try{return MG.success(new _Q(e,t,gw.empty()))}catch(n){return MG.failure(n.message)}}static fromDoubleCoord(e,t,n){const r=[e,t];QY.sortByDescending(r,_Q.sortCoord);const i=r[1].getDirectionToward(r[0]).get(),s=iQ.factory.fromDelta(i.x,i.y);if(s.isFailure())return MG.failure("Invalid direction");const o=s.get();return r[1].getDistance(r[0])>2?MG.failure("Distance between first coord and last coord is too great"):o.equals(n)?_Q.fromSingleCoord(r[1],n):o.getOpposite().equals(n)?_Q.fromSingleCoord(r[0],n):MG.success(new _Q(r[1],n,gw.of(r[0])))}static sortCoord(e){return 9*e.y+e.x}toString(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}isSingleCoord(){return this.lastPiece.isAbsent()}equals(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}_Q.encoder=new class extends qY{maxValue(){return 104831}encodeNumber(e){const t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;{const n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}}decodeNumber(e){const t=e%8;e=(e-t)/8;const n=iQ.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;const s=new eQ(i,r);if(0===e)return _Q.fromSingleCoord(s,n).get();{const t=(e=(e-1)/2)%9,r=(e=(e-t)/9)%9;e=(e-r)/9;const i=new eQ(r,t);return _Q.fromDoubleCoord(s,i,n).get()}}};var CQ=(()=>(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(CQ||(CQ={})),CQ))();class EQ{constructor(){this.map=[],this.isImmutable=!1}makeImmutable(){this.isImmutable=!0}get(e){for(const t of this.map)if(pw(t.key,e))return gw.of(t.value);return gw.empty()}forEach(e){for(let t=0;t<this.map.length;t++)e(this.getByIndex(t))}getByIndex(e){return this.map[e]}putAll(e){this.checkImmutability("putAll");for(const t of e.map)this.put(t.key,t.value)}checkImmutability(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}put(e,t){this.checkImmutability("put");for(const n of this.map)if(pw(n.key,e)){const e=n.value;return n.value=t,gw.of(e)}return this.map.push({key:e,value:t}),gw.empty()}containsKey(e){return this.map.some(t=>pw(t.key,e))}size(){return this.map.length}listKeys(){return this.map.map(e=>e.key)}getKeySet(){return new fQ(this.listKeys())}filter(e){const t=new EQ;for(const n of this.map)e(n.key,n.value)&&t.set(n.key,n.value);return t}replace(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}set(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}delete(e){this.checkImmutability("delete");for(let t=0;t<this.map.length;t++)if(pw(this.map[t].key,e)){const e=this.map[t].value,n=this.map.slice(0,t),r=this.map.slice(t+1);return this.map=n.concat(r),e}throw new Error('No Value to delete for key "'+e.toString()+'"!')}getCopy(){const e=new this.constructor;for(const t of this.listKeys())e.set(t,this.get(t).get());return e}equals(e){const t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;for(const r of t){const t=this.get(r).get(),n=e.get(r);if(VG(n.isPresent(),"value is absent in a map even though its key is present!"),!1===pw(t,n.get()))return!1}return!0}}class wQ extends EQ{reverse(){const e=new wQ;for(const t of this.listKeys()){const n=this.get(t).get();if(e.containsKey(n))e.get(n).get().add(t);else{const r=new fQ;r.add(t),e.set(n,r)}}return e}}let bQ=(()=>{class e{}return e.createdNodes=0,e.minimaxTime=0,e})();class SQ{constructor(e,t=gw.empty(),n=gw.empty(),r){if(this.gameState=e,this.mother=t,this.move=n,this.minimaxCreator=r,this.childs=gw.empty(),this.hopedValue=new EQ,this.ownValue=new EQ,this.possibleMoves=new EQ,this.ownValue=new EQ,null!=r){const e=r.getBoardValue(this);this.ownValue.set(r.name,e),this.hopedValue.set(r.name,e.value)}bQ.createdNodes++,hw(SQ.VERBOSE||!1,"creating "+this.myToString())}static getScoreStatus(e){const t=!1;return e===Number.MAX_SAFE_INTEGER||e===Number.MIN_SAFE_INTEGER?(hw(SQ.VERBOSE||t,"VICTORY"),CQ.VICTORY):e===Number.MIN_SAFE_INTEGER+1?(hw(SQ.VERBOSE||t,"PRE_VICTORY_MIN"),CQ.PRE_VICTORY):e===Number.MAX_SAFE_INTEGER-1?(hw(SQ.VERBOSE||t,"PRE_VICTORY_MAX"),CQ.PRE_VICTORY):(hw(SQ.VERBOSE||t,"DEFAULT"),CQ.DEFAULT)}findBestMove(e,t,n=!1,r=!0){const i=(new Date).getTime();let s=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);for(;s.gameState.turn>this.gameState.turn+1;)s=s.mother.get(),e--;return bQ.minimaxTime+=(new Date).getTime()-i,s.move.get()}alphaBeta(e,t,n,r,i,s){if(e<1)return hw(SQ.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+e),this;if(r.ruler.getGameStatus(this).isEndGame)return hw(SQ.VERBOSE||!1,"isLeaf-EndGame("+SQ.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+e),this;const o=this.getPossibleMoves(r);VG(o.length>0,"Minimax "+r.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=gw.of([]));let a=[];const c=this.gameState.getCurrentPlayer();let l=c===jY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER;const u=c===jY.ZERO?(e,t)=>e<t:(e,t)=>e>t;for(const f of o){const o=this.getOrCreateChild(f,r).alphaBeta(e-1,t,n,r,i,s),h=o.getHopedValue(r);if(u(h,l)||0===a.length?(l=h,a=[o]):h===l&&a.push(o),s&&u(l,c===jY.ZERO?t:n))break;c===jY.ZERO?n=Math.min(l,n):t=Math.max(l,t)}let h;h=i?a[Math.floor(Math.random()*a.length)]:a[0];const d=h.hopedValue.get(r.toString()).get();return this.hopedValue.put(r.toString(),d),h}getPossibleMoves(e){const t=this.possibleMoves.get(e.name);if(t.isAbsent()){const t=e.getListMoves(this);return this.possibleMoves.set(e.name,new fQ(t)),t}return t.get().toList()}getOrCreateChild(e,t){let n=this.getSonByMove(e);if(n.isAbsent()){const r=t.ruler.isLegal(e,this.gameState);VG(r.isSuccess(),"The minimax has accepted an illegal move, this should not happen.");const i=t.ruler.applyLegalMove(e,this.gameState,r.get());n=gw.of(new SQ(i,gw.of(this),gw.of(e),t)),this.childs.get().push(n.get())}return n.get()}getSonByMove(e){VG(this.childs.isPresent(),"Cannot get son of uncalculated node");for(const t of this.childs.get())if(t.move.isPresent()&&t.move.equalsValue(e))return gw.of(t);return gw.empty()}getInitialNode(){let e=this;for(;e.mother.isPresent();)e=e.mother.get();return e}getHopedValue(e){return this.hopedValue.get(e.name).get()}getOwnValue(e){const t=this.ownValue.get(e.name);if(t.isAbsent()){const t=e.getBoardValue(this);return this.ownValue.set(e.name,t),t}return t.get()}myToString(){let e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}hasMoves(){return this.childs.isPresent()}countDescendants(){if(this.childs.isAbsent())return 0;let e=this.childs.get().length;for(const t of this.childs.get())e+=t.countDescendants();return e}}SQ.VERBOSE=!1,SQ.minimaxes=new EQ;class PQ{constructor(e,t){this.isEndGame=e,this.winner=t}static getVictory(e){return e===jY.ZERO?PQ.ZERO_WON:PQ.ONE_WON}static getDefeat(e){return e===jY.ZERO?PQ.ONE_WON:PQ.ZERO_WON}toBoardValue(){return this.winner.isPlayer()?this.winner.getVictoryValue():0}}PQ.ZERO_WON=new PQ(!0,jY.ZERO),PQ.ONE_WON=new PQ(!0,jY.ONE),PQ.DRAW=new PQ(!0,ZY.NONE),PQ.ONGOING=new PQ(!1,ZY.NONE);class OQ{constructor(e){this.stateType=e,this.setInitialBoard()}choose(e){const t=!1;hw(t,"Rules.choose: "+e.toString()+" was proposed");const n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){hw(t,"Rules.choose: current node has moves");const r=this.node.getSonByMove(e);if(r.isPresent())return VG(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),hw(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(hw(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return hw(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;hw(t,"Rules.choose: Move is legal, let's apply it");const r=this.applyLegalMove(e,this.node.gameState,n.get()),i=new SQ(r,gw.of(this.node),gw.of(e));return this.node=i,!0}setInitialBoard(){if(null==this.node){const e=this.stateType.getInitialState();SQ.ruler=this,this.node=new SQ(e)}else this.node=this.node.getInitialNode()}applyMoves(e,t,n){let r=0;for(const i of e){const e=n(i),s=this.isLegal(e,t);VG(s.isSuccess(),"Can't create state from invalid moves ("+r+"): "+s.toString()+"."),t=this.applyLegalMove(e,t,s.get()),r++}return t}}let TQ=(()=>{class e{}return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=()=>$localize`You cannot move more than 3 of your pieces!`,e.NOT_ENOUGH_PIECE_TO_PUSH=()=>$localize`You don't have enough pieces to push that group!`,e.CANNOT_PUSH_YOUR_OWN_PIECES=()=>$localize`You cannot push this piece because it is blocked by one of yours!`,e.MUST_ONLY_TRANSLATE_YOUR_PIECES=()=>$localize`This line contains pieces of your opponent or empty spaces, which is forbidden.`,e.TRANSLATION_IMPOSSIBLE=()=>$localize`This move is impossible, some landing spaces are occupied.`,e.LINE_AND_COORD_NOT_ALIGNED=()=>$localize`This space is not aligned with the current line.`,e})();class IQ extends OQ{static isLegal(e,t){const n=this.getFirstPieceValidity(e,t);return n.isFailure()?n.toFailedFallible():e.isSingleCoord()?IQ.isLegalPush(e,t):IQ.isLegalSideStep(e,t)}static getFirstPieceValidity(e,t){const n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?DG.failure(lQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===rQ.ofPlayer(t.getCurrentOpponent())?DG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):DG.SUCCESS}static isLegalPush(e,t){let n=1,r=e.coord.getNext(e.dir);const i=rQ.ofPlayer(t.getCurrentPlayer()),s=rQ.EMPTY,o=t.getCopiedBoard();for(o[e.coord.y][e.coord.x]=s;n<=3&&t.isOnBoard(r)&&t.getPieceAt(r)===i;)n++,r=r.getNext(e.dir);return n>3?MG.failure(TQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(r)||(o[r.y][r.x]=i,t.getPieceAt(r)===s)?MG.success(o):IQ.isLegalRealPush(r,e,t,n,o)}static isLegalRealPush(e,t,n,r,i){let s=0;const o=rQ.ofPlayer(n.getCurrentOpponent()),a=rQ.ofPlayer(n.getCurrentPlayer());for(;s<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)s++,e=e.getNext(t.dir);return s>=r?MG.failure(TQ.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===rQ.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===a)?MG.failure(TQ.CANNOT_PUSH_YOUR_OWN_PIECES()):MG.success(i)}static isLegalSideStep(e,t){let n=e.lastPiece.get();const r=e.coord.getDirectionToward(n).get();n=n.getNext(r);let i=e.coord;const s=rQ.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();for(;!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==s)return MG.failure(TQ.MUST_ONLY_TRANSLATE_YOUR_PIECES());const n=i.getNext(e.dir);if(o[i.y][i.x]=rQ.EMPTY,n.isInRange(9,9)){if(t.isPiece(n))return MG.failure(TQ.TRANSLATION_IMPOSSIBLE());t.getPieceAt(n)===rQ.EMPTY&&(o[n.y][n.x]=s)}i=i.getNext(r)}return MG.success(o)}static getGameStatus(e){const t=e.gameState.getScores();return t[0]>5?PQ.ZERO_WON:t[1]>5?PQ.ONE_WON:PQ.ONGOING}applyLegalMove(e,t,n){return new mQ(n,t.turn+1)}isLegal(e,t){return IQ.isLegal(e,t)}getGameStatus(e){return IQ.getGameStatus(e)}}class kQ extends uQ{getListMoves(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<9;i++)for(let e=0;e<9;e++){const s=new eQ(e,i);if(!1!==n.getPieceAt(s).is(r))for(const e of iQ.factory.all){const r=_Q.fromSingleCoord(s,e).get();if(this.isAcceptablePush(r,n)){t.push(r);for(const r of iQ.factory.all)for(let i=1;i<=2&&!r.equals(e);i++){const o=s.getNext(r,i);if(!o.isInRange(9,9))break;{const r=_Q.fromDoubleCoord(s,o,e).get();IQ.isLegal(r,n).isSuccess()&&t.push(r)}}}}}return new fQ(t).toList()}isAcceptablePush(e,t){const n=t.getScores(),r=IQ.isLegal(e,t);if(r.isSuccess()){const e=t.getCurrentOpponent().value;return!(new mQ(r.get(),t.turn+1).getScores()[e]>n[e])}return!1}getBoardValue(e){const t=IQ.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState.getScores();return new hQ(n[1]-n[0])}}class AQ{constructor(e,t,n){this.title=e,this.instruction=t,this.state=n,this.previousMove=gw.empty()}static fromMove(e,t,n,r,i,s){return new MQ(e,t,n,r,i,s)}static forClick(e,t,n,r,i,s){return new RQ(e,t,n,r,i,s)}static anyMove(e,t,n,r,i){return new xQ(e,t,n,r,i)}static fromPredicate(e,t,n,r,i,s){return new DQ(e,t,n,r,i,s)}static informational(e,t,n){return new LQ(e,t,n)}isMove(){return!1}isAnyMove(){return!1}isClick(){return!1}isPredicate(){return!1}isInformation(){return!1}hasSolution(){return!1}withPreviousMove(e){return this.previousMove=gw.of(e),this}}class NQ extends AQ{constructor(e,t,n,r,i){super(e,t,n),this.solution=r,this.successMessage=i}hasSolution(){return!0}getSolution(){return this.solution}getSuccessMessage(){return this.successMessage}}class MQ extends NQ{constructor(e,t,n,r,i,s){super(e,t,n,r[0],i),this.acceptedMoves=r,this.failureMessage=s,VG(r.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational")}isMove(){return!0}getFailureMessage(){return this.failureMessage}}class xQ extends NQ{constructor(e,t,n,r,i){super(e,t,n,r,i)}isAnyMove(){return!0}}class RQ extends AQ{constructor(e,t,n,r,i,s){super(e,t,n),this.acceptedClicks=r,this.successMessage=i,this.failureMessage=s}isClick(){return!0}getSuccessMessage(){return this.successMessage}getFailureMessage(){return this.failureMessage}}class DQ extends NQ{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this.predicate=i}isPredicate(){return!0}}class LQ extends AQ{isInformation(){return!0}}const FQ=rQ.EMPTY,BQ=rQ.NONE,UQ=rQ.ZERO,VQ=rQ.ONE;class $Q{constructor(){this.tutorial=[AQ.informational($localize`Initial board and goal of the game`,$localize`At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!`,mQ.getInitialState()),AQ.anyMove($localize`Moving a piece`,$localize`At each turn, move one, two, or three pieces either along their line, or on their side.
        For your moves you can therefore choose between up to 6 directions.
        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).
        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>
        You're playing Dark, make any move!`,mQ.getInitialState(),_Q.fromSingleCoord(new eQ(2,6),iQ.UP).get(),$localize`Congratulations!`),AQ.fromMove($localize`Pushing`,$localize`To push one opponent piece, you must move at least two of your pieces.
        To push two opponent pieces, you must move three of your pieces.
        If one of your pieces is in the way, it will be impossible to push.
        You cannot move more than three pieces.<br/><br/>
        Only one push towards the right is possible here, find it. (You're playing Dark).`,new mQ([[BQ,BQ,BQ,BQ,FQ,UQ,UQ,VQ,VQ],[BQ,BQ,BQ,FQ,FQ,FQ,FQ,FQ,FQ],[BQ,BQ,FQ,UQ,UQ,UQ,VQ,UQ,FQ],[BQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ],[FQ,FQ,FQ,FQ,UQ,UQ,UQ,VQ,VQ],[FQ,FQ,FQ,FQ,FQ,FQ,FQ,FQ,BQ],[FQ,FQ,FQ,FQ,UQ,VQ,FQ,BQ,BQ],[FQ,FQ,FQ,UQ,FQ,FQ,BQ,BQ,BQ],[FQ,FQ,UQ,FQ,FQ,BQ,BQ,BQ,BQ]],0),[_Q.fromSingleCoord(new eQ(4,4),iQ.RIGHT).get()],$localize`Congratulations! You know everything you need to start a game!`,$localize`Failed!`)]}}function zQ(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",6),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onPieceClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();Oa("id","piece_",e,"_",t,""),la("ngClass",n.getPieceClasses(e,t)),na("cx",n.getCenterBy(e,t).x)("cy",n.getCenterBy(e,t).y)("r",.5*n.SPACE_SIZE)}}function HQ(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"polyline",4),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onCaseClick(t,n)}),da(),oa(2,zQ,1,6,"circle",5),da()}if(2&e){const e=wa(),t=e.index,n=e.$implicit,r=wa().index,i=wa();Ts(1),Oa("id","case_",t,"_",r,""),la("ngClass",i.getSquareClasses(t,r)),na("points",i.getHexaCoordsBy(t,r)),Ts(1),la("ngIf",i.isPiece(n))}}function GQ(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,HQ,3,5,"g",3),da()),2&e){const e=t.$implicit,n=wa(2);Ts(1),la("ngIf",n.isBoard(e))}}function qQ(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,GQ,2,1,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function WQ(e,t){1&e&&(Cn(),ha(0,"marker",7),fa(1,"polygon",8),da()),2&e&&Pa("id","arrowhead_",t.$implicit.dir.toString(),"")}function jQ(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),fa(1,"line",9),ha(2,"line",10),_a("click",function(){const t=Gt(e).$implicit;return wa().chooseDirection(t.dir)}),da(),ha(3,"polygon",11),_a("click",function(){const t=Gt(e).$implicit;return wa().chooseDirection(t.dir)}),da(),da()}if(2&e){const e=t.$implicit;Ts(1),Pa("id","line_start_",e.dir.toString(),""),na("x1",e.startCenter.x)("y1",e.startCenter.y)("x2",e.middle.x)("y2",e.middle.y),Ts(1),Pa("id","line_end_",e.dir.toString(),""),na("x1",e.middle.x)("y1",e.middle.y)("x2",e.landingCenter.x)("y2",e.landingCenter.y),Ts(1),Pa("id","direction_",e.dir.toString(),""),na("transform",e.transformation)}}class ZQ{constructor(e,t,n,r,i,s){this.startCenter=e,this.middle=t,this.landingCenter=n,this.landing=r,this.dir=i,this.transformation=s}}let YQ=(()=>{class e extends nQ{constructor(e){super(e),this.moveds=[],this.directions=[],this.selecteds=[],this.rules=new IQ(mQ),this.availableMinimaxes=[new kQ(this.rules,"Dummy")],this.encoder=_Q.encoder,this.tutorial=(new $Q).tutorial,this.scores=gw.of([0,0]),this.SPACE_SIZE=30,this.hexaLayout=new sQ(this.SPACE_SIZE,new eQ(-8*this.SPACE_SIZE,2*this.SPACE_SIZE),aQ.INSTANCE),this.updateBoard()}updateBoard(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=gw.of(this.rules.node.gameState.getScores())}hidePreviousMove(){this.moveds=[]}cancelMoveAttempt(){this.directions=[],this.selecteds=[]}showPreviousMove(){const e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}showPushingMove(e){const t=this.rules.node.mother.get().gameState;let n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}showSideStepMove(e){let t=e.lastPiece.get();const n=e.coord.getDirectionToward(t).get();t=t.getNext(n);let r=e.coord;for(;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}onPieceClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#piece_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=n.rules.node.gameState.getCurrentOpponent();return n.hexaBoard[t][e].is(i)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t)})()}opponentClick(e,t){var n=this;return lw(function*(){return(yield n.tryChoosingDirection(e,t)).isSuccess()?DG.SUCCESS:n.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE())})()}firstClick(e,t){var n=this;return lw(function*(){return n.selecteds=[new eQ(e,t)],n.showPossibleDirections(),DG.SUCCESS})()}showPossibleDirections(){this.directions=[],this.showDirection(1===this.selecteds.length)}showDirection(e){const t=this.rules.node.gameState,n=rQ.ofPlayer(t.getCurrentPlayer()),r=this.selecteds[0],i=this.selecteds[this.selecteds.length-1];for(const s of iQ.factory.all){let o,a=r.getNext(s,1);if(t.isOnBoard(a)&&t.getPieceAt(a)===n){if(e)continue;if(a=i.getNext(s,1),t.isOnBoard(a)&&t.getPieceAt(a)===n)continue}if(o=e?_Q.fromSingleCoord(r,s).get():_Q.fromDoubleCoord(r,i,s).get(),this.rules.isLegal(o,t).isSuccess()){const e=this.getCenterAt(r),t=this.getCenterAt(a),n=this.getMiddleOfArrow(s,a,t),i=t.x+" "+t.y,o=iQ.getAngle(s)+150,c=new ZQ(e,n,t,a,s,"rotate("+o+" "+i+") translate("+i+")");this.directions.push(c)}}}getMiddleOfArrow(e,t,n){const r=t.getPrevious(e),i=this.getCenterAt(r);return new eQ(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}isBoard(e){return e!==rQ.NONE}isPiece(e){return e!==rQ.EMPTY}secondClick(e,t){var n=this;return lw(function*(){const r=n.selecteds[0],i=new eQ(e,t);if(i.equals(r))return n.cancelMoveAttempt(),DG.SUCCESS;if(!1===i.isHexagonallyAlignedWith(r))return n.cancelMoveAttempt(),n.firstClick(e,t);const s=i.getDistance(r);if(s>2)return n.cancelMove(TQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES());const o=r.getDirectionToward(i).get();n.selecteds=[r];for(let e=0;e<s;e++)n.selecteds.push(r.getNext(o,e+1));if(3===n.selecteds.length){const r=n.selecteds[1],i=n.rules.node.gameState.getCurrentPlayer();if(!1===n.hexaBoard[r.y][r.x].is(i))return n.cancelMoveAttempt(),n.firstClick(e,t)}return n.showPossibleDirections(),DG.SUCCESS})()}thirdClick(e,t){var n=this;return lw(function*(){const r=new eQ(e,t),i=n.selecteds[0];if(r.equals(i))return n.deselectExtremity(!0);const s=n.selecteds[n.selecteds.length-1];return r.equals(s)?n.deselectExtremity(!1):3===n.selecteds.length&&r.equals(n.selecteds[1])?(n.cancelMoveAttempt(),DG.SUCCESS):n.tryExtension(r,i,s)})()}tryExtension(e,t,n){var r=this;return lw(function*(){const i=QJ.factory.fromMove(t,e);if(i.isSuccess()){const s=QJ.factory.fromMove(n,e);if(i.equals(s)){const i=t.getDistance(e),s=n.getDistance(e);return 2===Math.max(i,s)?(r.selecteds.push(e),QY.sortByDescending(r.selecteds,_Q.sortCoord),r.showPossibleDirections(),DG.SUCCESS):r.cancelMove(TQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES())}}const s=r.cancelMove(TQ.LINE_AND_COORD_NOT_ALIGNED());return yield r.firstClick(e.x,e.y),s})()}deselectExtremity(e){var t=this;return lw(function*(){return t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),DG.SUCCESS})()}chooseDirection(e){var t=this;return lw(function*(){const n=t.canUserPlay("#direction_"+e.toString());return n.isFailure()?t.cancelMove(n.getReason()):t._chooseDirection(e)})()}_chooseDirection(e){var t=this;return lw(function*(){const n=t.rules.node.gameState;let r;const i=t.selecteds[0];return r=1===t.selecteds.length?_Q.fromSingleCoord(i,e).get():_Q.fromDoubleCoord(i,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(r,n,t.scores.get())})()}onCaseClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#case_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.tryChoosingDirection(e,t)})()}tryChoosingDirection(e,t){var n=this;return lw(function*(){const r=new eQ(e,t);for(const e of n.directions)if(e.landing.equals(r))return n._chooseDirection(e.dir);return DG.failure("not a direction")})()}getSquareClasses(e,t){const n=new eQ(e,t),r=[];return this.moveds.some(e=>e.equals(n))&&r.push("moved"),r}getPieceClasses(e,t){const n=new eQ(e,t),r=jY.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(e=>e.equals(n))&&i.push("highlighted"),i}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-abalone"]],features:[Ho],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,qQ,2,1,"g",1),ha(2,"defs"),oa(3,WQ,2,1,"marker",2),da(),oa(4,jQ,4,12,"g",1),da()),2&e&&(Ts(1),la("ngForOf",t.hexaBoard),Ts(2),la("ngForOf",t.directions),Ts(1),la("ngForOf",t.directions))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class KQ{constructor(e){this.x=e}static from(e){switch(e){case 0:return KQ.ZERO;case 1:return KQ.ONE;case 2:return KQ.TWO;default:return VG(3===e,"Invalid Apagos Coord "+e),KQ.THREE}}equals(e){return this.x===e.x}}KQ.ZERO=new KQ(0),KQ.ONE=new KQ(1),KQ.TWO=new KQ(2),KQ.THREE=new KQ(3);let JQ=(()=>{class e{}return e.PIECE_SHOULD_MOVE_DOWNWARD=()=>$localize`Pieces should only move downward!`,e.CANNOT_LAND_ON_A_FULL_SQUARE=()=>$localize`That square is already full, you cannot put a piece in it!`,e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=()=>$localize`You have no pieces in that square, select one that contains at least one of your pieces!`,e.NO_PIECE_REMAINING_TO_DROP=()=>$localize`There are no remaining pieces of that color to drop!`,e.NO_POSSIBLE_TRANSFER_REMAINS=()=>$localize`There is no possible transfer from that square!`,e})();class QQ extends yQ{constructor(e,t,n){super(),this.landing=e,this.piece=t,this.starting=n}static drop(e,t){return uw.getNonNullable(QQ.ALL_MOVES.find(n=>n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(gw.empty())))}static transfer(e,t){if(e.x<=t.x)return MG.failure(JQ.PIECE_SHOULD_MOVE_DOWNWARD());const n=uw.getNonNullable(QQ.ALL_MOVES.find(n=>n.landing.equals(t)&&n.piece.equals(gw.empty())&&n.starting.equals(gw.of(e))));return MG.success(n)}isDrop(){return this.piece.isPresent()}toString(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}equals(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}QQ.ALL_MOVES=[new QQ(KQ.ZERO,gw.of(jY.ZERO),gw.empty()),new QQ(KQ.ONE,gw.of(jY.ZERO),gw.empty()),new QQ(KQ.TWO,gw.of(jY.ZERO),gw.empty()),new QQ(KQ.THREE,gw.of(jY.ZERO),gw.empty()),new QQ(KQ.ZERO,gw.of(jY.ONE),gw.empty()),new QQ(KQ.ONE,gw.of(jY.ONE),gw.empty()),new QQ(KQ.TWO,gw.of(jY.ONE),gw.empty()),new QQ(KQ.THREE,gw.of(jY.ONE),gw.empty()),new QQ(KQ.TWO,gw.empty(),gw.of(KQ.THREE)),new QQ(KQ.ONE,gw.empty(),gw.of(KQ.THREE)),new QQ(KQ.ZERO,gw.empty(),gw.of(KQ.THREE)),new QQ(KQ.ONE,gw.empty(),gw.of(KQ.TWO)),new QQ(KQ.ZERO,gw.empty(),gw.of(KQ.TWO)),new QQ(KQ.ZERO,gw.empty(),gw.of(KQ.ONE))],QQ.encoder=new class extends qY{maxValue(){return QQ.ALL_MOVES.length}encodeNumber(e){const t=QQ.ALL_MOVES.findIndex(t=>t.equals(e));return VG(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}decodeNumber(e){return VG(e<QQ.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),QQ.ALL_MOVES[e]}};class XQ{constructor(e){this.containing=e}static from(e,t,n){if(e+t>n)return MG.failure("invalid starting space");const r=new EQ;r.set(jY.ZERO,e),r.set(jY.ONE,t),r.set(ZY.NONE,n),r.makeImmutable();const i=new XQ(r);return MG.success(i)}isFull(){return this.count(jY.ZERO)+this.count(jY.ONE)>=this.count(ZY.NONE)}count(e){return this.containing.get(e).get()}addPiece(e){let t=this.count(jY.ZERO),n=this.count(jY.ONE);const r=this.count(ZY.NONE);return e===jY.ZERO?t++:n++,XQ.from(t,n,r).get()}substractPiece(e){let t=this.count(jY.ZERO),n=this.count(jY.ONE);const r=this.count(ZY.NONE);return e===jY.ZERO?t--:n--,XQ.from(t,n,r).get()}getDominatingPlayer(){const e=this.count(jY.ZERO),t=this.count(jY.ONE);return e>t?jY.ZERO:t>e?jY.ONE:ZY.NONE}equals(e){return this.containing.equals(e.containing)}}let eX=(()=>{class e extends pQ{constructor(e,t,n){super(e),this.board=t,this.remaining=n,this.remaining.makeImmutable()}static getInitialState(){return e.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}static fromRepresentation(t,n,r,i){const s=[];for(let e=0;e<4;e++){const t=XQ.from(n[0][e],n[1][e],n[2][e]).get();s.push(t)}const o=new EQ;return o.set(jY.ZERO,r),o.set(jY.ONE,i),new e(t,s,o)}getPieceAt(e){return this.board[e.x]}updateAt(t,n){const r=[];for(let e=0;e<4;e++)r.push(t.x===e?n:this.board[e]);const i=this.getRemainingCopy();return new e(this.turn,r,i)}getRemainingCopy(){return this.remaining.getCopy()}getRemaining(e){return this.remaining.get(e).get()}equals(e){return this.turn===e.turn&&QY.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}return e.PIECES_PER_PLAYER=10,e})();class tX extends OQ{static get(){return tX.singleton.isAbsent()&&(tX.singleton=gw.of(new tX(eX))),this.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}applyLegalDrop(e,t){const n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);const i=new eX(t.turn+1,t.board,n),s=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(s);if(e.landing===KQ.THREE)return i.updateAt(e.landing,o);{const t=KQ.from(e.landing.x+1),n=i.getPieceAt(t);return i.updateAt(e.landing,n).updateAt(t,o)}}applyLegalTransfer(e,t){const n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),s=t.getPieceAt(e.landing).addPiece(n);let o=t.updateAt(r,i);return o=o.updateAt(e.landing,s),new eX(o.turn+1,o.board,o.remaining)}isLegal(e,t){return t.getPieceAt(e.landing).isFull()?MG.failure(JQ.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}isLegalDrop(e,t){return t.getRemaining(e.piece.get())<=0?MG.failure(JQ.NO_PIECE_REMAINING_TO_DROP()):MG.success(void 0)}isLegalSlideDown(e,t){const n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?MG.failure(JQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):MG.success(void 0)}getGameStatus(e){const t=e.gameState;for(let r=0;r<4;r++)if(!1===t.getPieceAt(KQ.from(r)).isFull())return PQ.ONGOING;const n=t.getPieceAt(KQ.THREE).getDominatingPlayer();return VG(n.isPlayer(),"winner can only be a player if the game is finished"),PQ.getVictory(n)}}tX.singleton=gw.empty();class nX extends uQ{getListMoves(e){const t=e.gameState;return QQ.ALL_MOVES.filter(function(e){return tX.get().isLegal(e,t).isSuccess()})}getBoardValue(e){const t=tX.get().getGameStatus(e);if(t.isEndGame)return hQ.fromWinner(t.winner);const n=e.gameState.board[3].getDominatingPlayer();return n.isPlayer()?new hQ(n.getScoreModifier()):new hQ(0)}}class rX{constructor(){this.tutorial=[AQ.informational($localize`Initial board and goal of the game`,$localize`At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!`,eX.getInitialState()),AQ.anyMove($localize`Drop`,$localize`There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You play Light.<br/><br/>Drop a piece on one of those three squares.`,eX.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),QQ.drop(KQ.ZERO,jY.ZERO),$localize`Congratulations!`),AQ.fromPredicate($localize`Transfer`,$localize`The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!`,eX.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),QQ.transfer(KQ.TWO,KQ.ZERO).get(),(e,t)=>e.isDrop()?DG.failure($localize`This move is a drop, please do a transfer!`):DG.SUCCESS,$localize`Congratulations!`),AQ.fromPredicate($localize`Victory`,$localize`When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!`,eX.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),QQ.drop(KQ.TWO,jY.ONE),(e,t)=>e.isDrop()?e.piece.equalsValue(jY.ONE)?DG.SUCCESS:DG.failure($localize`You actively made your opponent win!`):DG.failure($localize`Wrong choice, your opponent will win in the next turn no matter which piece is dropped!`),$localize`Congratulations!`)]}}function iX(e,t){if(1&e&&(Cn(),fa(0,"circle",5)),2&e){const e=t.$implicit,n=wa();na("cx",(e+1)*n.PIECE_RADIUS)("cy",n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function sX(e,t){if(1&e){const e=ma();Cn(),ha(0,"polygon",7),_a("click",function(){Gt(e);const t=wa().index,n=wa();return n.onArrowClick(t,n.PlayerOrNone.ZERO)}),da()}if(2&e){const e=wa().index,t=wa();Pa("id","dropArrow_zero_",e,""),la("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ZERO)),na("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ZERO))}}function oX(e,t){if(1&e){const e=ma();Cn(),ha(0,"polygon",7),_a("click",function(){Gt(e);const t=wa().index,n=wa();return n.onArrowClick(t,n.PlayerOrNone.ONE)}),da()}if(2&e){const e=wa().index,t=wa();Pa("id","dropArrow_one_",e,""),la("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ONE)),na("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ONE))}}function aX(e,t){if(1&e){const e=ma();Cn(),pa(0),ha(1,"circle",8),_a("click",function(){Gt(e);const t=wa().index;return wa().onSquareClick(t)}),da(),ga()}if(2&e){const e=t.$implicit,n=wa(),r=n.index,i=n.$implicit,s=wa();Ts(1),Ta("id","square_",r,"_piece_",e,"_out_of_",i.count(s.PlayerOrNone.NONE),""),la("ngClass",s.getPieceClasses(r,e,i)),na("cx",s.getCircleCenter(r,e,i).x)("cy",s.getCircleCenter(r,e,i).y)}}function cX(e,t){if(1&e){const e=ma();Cn(),pa(0),oa(1,sX,1,4,"polygon",6),oa(2,oX,1,4,"polygon",6),ha(3,"rect",7),_a("click",function(){const t=Gt(e).index;return wa().onSquareClick(t)}),da(),oa(4,aX,2,6,"ng-container",3),ga()}if(2&e){const e=t.$implicit,n=t.index,r=wa();Ts(1),la("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ZERO)),Ts(1),la("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ONE)),Ts(1),Pa("id","square_",n,""),la("ngClass",r.getSquareClasses(n)),na("x",n*r.SPACE_SIZE)("y",(5-n)*r.SPACE_SIZE*.25)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),la("ngForOf",r.range(e.count(r.PlayerOrNone.NONE)))}}function lX(e,t){if(1&e&&(Cn(),fa(0,"circle",9)),2&e){const e=t.$implicit,n=wa();na("cx",4*n.SPACE_SIZE-(e+1)*n.PIECE_RADIUS)("cy",2.25*n.SPACE_SIZE+3*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}let uX=(()=>{class e extends tQ{constructor(t){super(t),this.PlayerOrNone=ZY,this.ARROW_COORD=e.getArrowCoord(),this.PIECES_PER_PLAYER=eX.PIECES_PER_PLAYER,this.selectedPiece=gw.empty(),this.leftPiece=gw.empty(),this.droppedPiece=gw.empty(),this.displayableArrow=[],this.rules=new tX(eX),this.availableMinimaxes=[new nX(this.rules,"ApagosDummyMinimax")],this.encoder=QQ.encoder,this.tutorial=(new rX).tutorial,this.PIECE_RADIUS=200/(this.PIECES_PER_PLAYER+1),this.updateBoard()}static getArrowCoord(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}cancelMoveAttempt(){this.selectedPiece=gw.empty(),this.showPossibleDrops()}updateBoard(){const e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(jY.ZERO).get(),this.remainingOne=e.remaining.get(jY.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}hideLastMove(){this.movedSquare=[],this.droppedPiece=gw.empty(),this.leftPiece=gw.empty(),this.selectedPiece=gw.empty()}showLastMove(){const e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}showLastDrop(e){const t=e.piece.get();let n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));const r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=gw.of({square:n,piece:r})}getLowestPlayerPiece(e,t){const n=e.count(t);return t===jY.ZERO?n-1:e.count(ZY.NONE)-n}showLastTransfer(e){const t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=gw.of({square:r,piece:i});const s=e.landing.x,o=this.getLowestPlayerPiece(this.board[s],n);this.droppedPiece=gw.of({square:s,piece:o})}showPossibleDrops(){this.displayableArrow=[];const e=this.rules.node.gameState;for(let t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(jY.ZERO).get()>0&&this.displayableArrow.push({x:t,player:jY.ZERO}),e.remaining.get(jY.ONE).get()>0&&this.displayableArrow.push({x:t,player:jY.ONE}))}getCircleCenter(e,t,n){const r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(ZY.NONE))return new eQ(r,i);const s=n.count(ZY.NONE),o=2*t*Math.PI/s-Math.PI/2,a=.3*this.SPACE_SIZE,c=a*Math.cos(o),l=a*Math.sin(o);return new eQ(r+c,i+l)}canDisplayArrow(e,t){return this.displayableArrow.some(n=>n.x===e&&n.player.equals(t))}getArrowClasses(e,t){return[this.getPlayerClass(t)]}getArrowTransform(e,t){let n=t===jY.ZERO?0:.5*this.SPACE_SIZE;return n+=e*this.SPACE_SIZE,"translate("+n+", "+(3-e)*this.SPACE_SIZE*.25+")"}getSquareClasses(e){const t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}onArrowClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#dropArrow_"+(t===jY.ZERO?"zero":"one")+"_"+e);if(r.isFailure())return n.cancelMove(r.getReason());const i=KQ.from(e);let s;if(n.selectedPiece.isPresent()){const e=n.selectedPiece.get().square;s=QQ.transfer(KQ.from(e),i).get()}else s=QQ.drop(i,t);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e,t,n){const r={square:e,piece:t},i=[];let s=n.count(jY.ZERO),o=n.count(jY.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===jY.ZERO?s++:o++}const a=n.count(ZY.NONE)-(o+s),c=this.getPieceColor(t,s,a);return""!==c&&i.push(c),i}getPieceColor(e,t,n){return e<t?"player0":e>=t+n?"player1":""}onSquareClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#square_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.selectedPiece.isPresent()&&t.selectedPiece.get().square===e)return t.cancelMoveAttempt(),DG.SUCCESS;const r=t.rules.node.gameState.getCurrentPlayer(),i=t.board[e];return i.count(r)<=0?t.cancelMove(JQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=gw.of({square:e,piece:t.getLowestPlayerPiece(i,r)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(JQ.NO_POSSIBLE_TRANSFER_REMAINS()):DG.SUCCESS)})()}showAndGetPossibleTranfers(){this.displayableArrow=[];let e=this.selectedPiece.get().square-1;const t=this.rules.node.gameState.getCurrentPlayer();for(;0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-apagos"]],features:[Ho],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,iX,1,3,"circle",1),ha(2,"g",2),oa(3,cX,5,9,"ng-container",3),da(),oa(4,lX,1,3,"circle",4),da()),2&e&&(Ts(1),la("ngForOf",t.range(t.remainingZero)),Ts(1),na("transform","translate(0, "+2*t.PIECE_RADIUS+")"),Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.range(t.remainingOne)))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),hX=(()=>{class e extends tQ{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class dX extends gQ{constructor(e,t,n){super(e,t),this.captured=n}static getInitialState(){const e=QY.createTable(6,2,4);return new dX(e,0,[0,0])}getCapturedCopy(){return[this.captured[0],this.captured[1]]}}let fX=(()=>{class e{}return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=()=>$localize`You cannot distribute from the opponent's home.`,e.MUST_CHOOSE_NONEMPTY_HOUSE=()=>$localize`You should choose a non-empty house to distribute.`,e.SHOULD_DISTRIBUTE=()=>$localize`You should distribute but you do not.`,e})(),pX=(()=>{class e extends OQ{applyLegalMove(t,n,r){hw(e.VERBOSE,{called:"AwaleRules.applyLegalMove",move:t,state:n});const i=t.x,s=n.getCurrentPlayer().value,o=n.getCurrentPlayer().getOpponent().value;let a=n.getCopiedBoard();const c=e.distribute(i,s,a);if(c.y===s)return new dX(a,n.turn+1,n.captured);{let t=[0,0];const r=QY.copyBiArray(a);return t[s]=e.capture(c.x,o,s,a),t[s]>0&&e.isStarving(o,a)&&(a=r,t=[0,0]),e.isStarving(s,a)&&!1===e.canDistribute(o,a)&&(t[o]+=e.mansoon(o,a)),t[0]+=n.captured[0],t[1]+=n.captured[1],new dX(a,n.turn+1,t)}}static mansoon(e,t){let n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}static isLegal(t,n){const r=n.getCurrentPlayer().value,i=n.getCurrentPlayer().getOpponent().value,s=t.x;if(0===n.getPieceAtXY(s,r))return MG.failure(fX.MUST_CHOOSE_NONEMPTY_HOUSE());const o=e.isStarving(i,n.board),a=!1===e.doesDistribute(s,r,n.board);return o&&a?MG.failure(fX.SHOULD_DISTRIBUTE()):MG.success(void 0)}isLegal(t,n){return e.isLegal(t,n)}static doesDistribute(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}static canDistribute(t,n){for(let r=0;r<6;r++)if(e.doesDistribute(r++,t,n))return!0;return!1}static isStarving(e,t){let n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}static distribute(e,t,n){const r=e,i=t;let s=n[t][e];for(n[t][e]=0;s>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,s--);return new eQ(e,t)}static capture(e,t,n,r){VG(t!==n,"AwaleRules.capture called with wrong values of x and player");let i=r[t][e];if(i<2||i>3)return 0;let s=0,o=-1,a=-1;0===n&&(o=1,a=6);do{s+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==a&&(2===i||3===i));return s}static getGameStatus(e){const t=e.gameState;return t.captured[0]>24?PQ.ZERO_WON:t.captured[1]>24?PQ.ONE_WON:24===t.captured[0]&&24===t.captured[1]?PQ.DRAW:PQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class gX extends yQ{constructor(e){super(),this.x=e}static from(e){switch(e){case 0:return gX.ZERO;case 1:return gX.ONE;case 2:return gX.TWO;case 3:return gX.THREE;case 4:return gX.FOUR;default:return VG(5===e,"Invalid x for AwaleMove: "+e),gX.FIVE}}equals(e){return e===this||e.x===this.x}toString(){return"AwaleMove("+this.x+")"}}gX.ZERO=new gX(0),gX.ONE=new gX(1),gX.TWO=new gX(2),gX.THREE=new gX(3),gX.FOUR=new gX(4),gX.FIVE=new gX(5),gX.encoder=new class extends qY{maxValue(){return 5}encodeNumber(e){return e.x}decodeNumber(e){return gX.from(e)}};class mX extends uQ{getListMoves(e){const t=[],n=e.gameState,r=n.turn%2;let i,s=0;do{0!==n.getPieceAtXY(s,r)&&(i=gX.from(s),pX.isLegal(i,n).isSuccess()&&(i=gX.from(s),t.push(i))),s++}while(s<6);return this.orderMoves(e,t)}orderMoves(e,t){const n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return QY.sortByDescending(t,t=>{const i=e.gameState.getCopiedBoard(),s=i[n][t.x],o=pX.distribute(t.x,n,i);let a,c=0;return o.y===n?(a=0,s<=6&&(c=10)):a=pX.capture(o.x,r,n,i),100*a+c-s}),t}getBoardValue(e){const t=pX.getGameStatus(e);if(t.isEndGame)return hQ.fromWinner(t.winner);const n=e.gameState.getCapturedCopy();return new hQ(n[1]-n[0])}}class yX{constructor(){this.tutorial=[AQ.anyMove($localize`Sowing`,$localize`Awal is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.
         Let's see how seeds are sown.
         As you're playing first, the 6 houses on the top are yours.<br/><br>
         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house.`,dX.getInitialState(),gX.ZERO,$localize`Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.
        This is how seeds are sown:
        one by one from the house next to the one they come from, clockwise.`),AQ.anyMove($localize`Big sowing`,$localize`You are now the second player (on the bottom).
        When there are enough seeds to make a full turn, something else happens.<br/><br/>
        Sow the house that contains 12 seeds.`,new dX([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),gX.ONE,$localize`See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds).`),AQ.fromMove($localize`Simple capture`,$localize`After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.
         Then, the player looks at the preceding house:
         if it is still in the opponent's side and contains two or three seeds, they are also captured.
         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>
         You are the second player, try to capture some pieces!`,new dX([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[gX.ZERO],$localize`Well done! This was a simple capture, now let us see how to make multiple captures.`,$localize`Failed. Try again and sow from the leftmost house.`),AQ.fromMove($localize`Multiple captures`,$localize`By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.
        As these are consecutive houses, all seeds in them will be captured.<br/><br/>
        Capture them.`,new dX([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[gX.ZERO],$localize`Nice, you win 3 points from the first house, and 2 from the second!`,$localize`Failed. Try again.`),AQ.fromMove($localize`Interrupted capture`,$localize`By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>
        Do it.`,new dX([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[gX.ZERO],$localize`Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house.`,$localize`Failed. Try again.`),AQ.fromMove($localize`Capture on the other side only`,$localize`Try to capture the two leftmost houses of the opponent.`,new dX([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[gX.ONE],$localize`Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!`,$localize`You have only captured one house, try again!`),AQ.fromMove($localize`Do not starve`,$localize`You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>
        Try it.`,new dX([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[gX.ZERO],$localize`Sadly, you cannot capture here, otherwise the opponent could not play after you.
        When this happens, the move can be made, but no capture takes place!`,$localize`Failed. Try again.`),AQ.anyMove($localize`Feeding is mandatory`,$localize`You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>
        Go ahead!`,new dX([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),gX.THREE,$localize`Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.
        It is often a good way to have easy captures!`),AQ.anyMove($localize`End of the game`,$localize`A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>
         Sow the house on the top right.`,new dX([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),gX.FIVE,$localize`Also, as soon as on player cannot play, the other player captures all the seeds in its own side.
         Here, it was the first player's turn, and the second player has taken all the remaining seeds.`)]}}function vX(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",4),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"text",5),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),Da(3),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","click_",n,"_",r,""),la("ngClass",i.getSquareClasses(n,r)),na("cx",50+100*n)("cy",50+120*r),Ts(1),na("x",50+100*n)("y",66+120*r),Ts(1),Fa(" ",e," ")}}function _X(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,vX,4,8,"g",2),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let CX=(()=>{class e extends hX{constructor(e){super(e),this.last=gw.empty(),this.captured=[],this.moved=[],this.scores=gw.of([0,0]),this.rules=new pX(dX),this.availableMinimaxes=[new mX(this.rules,"AwaleMinimax")],this.encoder=gX.encoder,this.tutorial=(new yX).tutorial,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState;this.scores=gw.of(e.getCapturedCopy()),this.hidePreviousMove();const t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){const n=e.getCurrentOpponent().value;this.last=gw.of(new eQ(t.get().x,n)),this.showPreviousMove()}else this.last=gw.empty()}hidePreviousMove(){this.captured=[],this.moved=[]}showPreviousMove(){const e=this.rules.node.mother.get().gameState;for(let t=0;t<=1;t++)for(let n=0;n<=5;n++){const r=new eQ(n,t),i=this.board[t][n],s=e.getPieceAt(r);this.last.equalsValue(r)||(i<s?this.captured.push(r):i>s&&this.moved.push(r))}}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(t!==n.rules.node.gameState.getCurrentPlayer().value)return n.cancelMove(fX.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME());n.last=gw.empty();const i=gX.from(e);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}getSquareClasses(e,t){const n=new eQ(e,t);return this.captured.some(e=>e.equals(n))?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(e=>e.equals(n))?["moved"]:[]}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-awale-component"]],features:[Ho],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),fa(1,"rect",1),oa(2,_X,2,1,"g",2),fa(3,"line",3),da()),2&e&&(Ts(2),la("ngForOf",t.board))},directives:[Ud,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class EX extends vQ{constructor(e,t){if(super(e.x,e.y),e.equals(t))throw new Error(lQ.MOVE_CANNOT_BE_STATIC());this.end=t}static getEncoder(e,t,n){return new class extends qY{constructor(){super(...arguments),this.shiftAX=t,this.shiftDY=this.shiftAX*e,this.shiftDX=this.shiftDY*t}maxValue(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}decodeNumber(r){const i=r%t;r/=t;const s=new eQ((r-=r%1)%e,i);r/=e;const o=(r-=r%1)%t;r/=t;const a=new eQ((r-=r%1)%e,o);return n(a,s)}}}length(){return this.coord.getDistance(this.end)}getDirection(){return QJ.factory.fromMove(this.coord,this.end)}}let wX=(()=>{class e{}return e.LANDING_ON_OCCUPIED_CASE=()=>$localize`You cannot land on an occupied square.`,e.THRONE_IS_LEFT_FOR_GOOD=()=>$localize`Once you left the central throne, you cannot return to it.`,e.SOLDIERS_CANNOT_SIT_ON_THRONE=()=>$localize`Soldiers cannot sit on the throne.`,e.SOMETHING_IN_THE_WAY=()=>$localize`Something is in the way.`,e.MOVE_MUST_BE_ORTHOGONAL=()=>$localize`Tafl moves must be orthogonal.`,e})();class bX extends EX{constructor(e,t){if(super(e,t),e.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(t.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+t.toString()+".");const n=e.getDirectionToward(t);if(n.isFailure()||n.get().isDiagonal())throw new Error(wX.MOVE_MUST_BE_ORTHOGONAL())}equals(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"TaflMove("+this.coord+"->"+this.end+")"}}class SX extends bX{static of(e,t){return new SX(e,t)}static from(e,t){try{const n=new SX(e,t);return MG.success(n)}catch(n){return MG.failure(n.message)}}getMaximalDistance(){return 7}}SX.encoder=EX.getEncoder(7,7,SX.of);const PX={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:jY.ZERO};class OX{constructor(e,t){this.owner=e,this.king=t}isKing(){return this.king}getOwner(){return this.owner}}OX.UNOCCUPIED=new OX(ZY.NONE,!1),OX.PLAYER_ONE_KING=new OX(jY.ONE,!0),OX.INVADERS=new OX(jY.ZERO,!1),OX.DEFENDERS=new OX(jY.ONE,!1);class TX{constructor(e){this.value=e}}TX.NONE=new TX("NONE"),TX.OPPONENT=new TX("OPPONENT"),TX.PLAYER=new TX("PLAYER");class IX extends gQ{isCentralThrone(e){return e.equals(this.getCentralThrone())}getCentralThrone(){const e=(this.board.length-1)/2;return new eQ(e,e)}getRelativeOwner(e,t){const n=this.getAbsoluteOwner(t);let r;return r=n===ZY.NONE?TX.NONE:e===n?TX.PLAYER:TX.OPPONENT,r}getAbsoluteOwner(e){return this.getPieceAt(e).getOwner()}}class kX extends IX{static getInitialState(){const e=OX.UNOCCUPIED,t=OX.INVADERS,n=OX.DEFENDERS;return new kX([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,n,e,e,e],[t,t,n,OX.PLAYER_ONE_KING,n,t,t],[e,e,e,n,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}from(e,t){return new kX(e,t)}}let AX=(()=>{class e extends OQ{constructor(e,t,n){super(e),this.config=t,this.generateMove=n}isLegal(t,n){hw(e.VERBOSE,{tablutRules_isLegal:{move:t,state:n}});const r=n.getCurrentPlayer(),i=this.getMoveValidity(r,t,n);return i.isFailure()?MG.failure(i.getReason()):MG.success(void 0)}getMoveValidity(e,t,n){const r=n.getRelativeOwner(e,t.coord);if(r===TX.NONE)return DG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE());if(r===TX.OPPONENT)return DG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==TX.NONE)return DG.failure(wX.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return DG.failure(wX.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return DG.failure(wX.THRONE_IS_LEFT_FOR_GOOD())}const i=t.coord.getDirectionToward(t.end).get(),s=t.coord.getOrthogonalDistance(t.end);let o=t.coord.getNext(i);for(let a=1;a<s;a++){if(n.getPieceAt(o)!==OX.UNOCCUPIED)return DG.failure(wX.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return DG.SUCCESS}isThrone(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}isExternalThrone(e){const t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}tryCapture(e,t,n,r){const i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===TX.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):gw.empty()}captureKing(e,t,n,r){const i=t.getNext(n),{backCoord:s,back:o,backInRange:a,left:c,leftCoord:l,right:u,rightCoord:h}=this.getSurroundings(i,n,e,r);return!1===a?this.captureKingAgainstTheWall(c,u,i):o===TX.NONE&&this.isThrone(r,s)?this.captureKingAgainstThrone(s,i,c,u):o===TX.PLAYER?this.captureKingWithAtLeastASandwich(r,i,c,l,u,h):gw.empty()}getSurroundings(e,t,n,r){const i=e.getNext(t),s=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=s?r.getRelativeOwner(n,i):TX.NONE,a=e.getLeft(t),c=a.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,a):TX.NONE,l=e.getRight(t),u=l.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,l):TX.NONE;return{backCoord:i,back:o,backInRange:s,leftCoord:a,left:c,rightCoord:l,right:u}}captureKingAgainstTheWall(t,n,r){let i=t===TX.PLAYER?1:0;return i+=n===TX.PLAYER?1:0,2===i&&this.config.BORDER_CAN_SURROUND_KING?(hw(e.VERBOSE||!1,"king captured by 3 invaders against 1 border"),gw.of(r)):gw.empty()}captureKingAgainstThrone(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return gw.of(t)}else{const e=r===TX.PLAYER,i=n===TX.PLAYER||e;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&i)return gw.of(t)}return gw.empty()}capturePawn(t,n,r,i){const s=!1,o=n.getNext(r),a=o.getNext(r);let c=TX.NONE;return a.isInRange(this.config.WIDTH,this.config.WIDTH)&&(c=i.getRelativeOwner(t,a)),c===TX.NONE?!1===this.isThrone(i,a)?(hw(e.VERBOSE||s,"cannot capture a pawn without an ally; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),gw.empty()):(hw(e.VERBOSE||s,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),gw.of(o)):c===TX.PLAYER?(hw(e.VERBOSE||s,"pawn captured by 2 opponents; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),gw.of(o)):(hw(e.VERBOSE||s,"no captures; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),gw.empty())}captureKingWithAtLeastASandwich(t,n,r,i,s,o){if(!1===this.kingTouchCentralThrone(t,n)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return gw.of(n);const a=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,c=this.isThrone(t,i),l=r===TX.PLAYER||c&&a,u=this.isThrone(t,o);return l&&(s===TX.PLAYER||u&&a)?(hw(e.VERBOSE||!1,"king captured by 4 invaders"),gw.of(n)):gw.empty()}kingTouchCentralThrone(e,t){const n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}applyLegalMove(t,n){hw(e.VERBOSE,{TablutRules_applyLegalMove:{move:t,state:n}});const r=n.turn,i=n.getCopiedBoard(),s=n.getCurrentPlayer(),o=t.coord,a=t.end;i[a.y][a.x]=i[o.y][o.x],i[o.y][o.x]=OX.UNOCCUPIED;for(const e of XJ.ORTHOGONALS){const r=this.tryCapture(s,t.end,e,n);r.isPresent()&&(i[r.get().y][r.get().x]=OX.UNOCCUPIED)}return n.from(i,r+1)}getGameStatus(e){const t=this.getWinner(e.gameState);return t.isPresent()?PQ.getVictory(t.get()):PQ.ONGOING}getWinner(e){const t=!1,n=this.getKingCoord(e);if(n.isAbsent())return hw(t,"The king is dead, victory to invader"),gw.of(this.getInvader());const r=n.get();return this.isExternalThrone(r)?(hw(t,"The king escape, victory to defender"),gw.of(this.getDefender())):this.isPlayerImmobilized(jY.ZERO,e)?(hw(t,"Zero has no move, victory to one"),gw.of(jY.ONE)):this.isPlayerImmobilized(jY.ONE,e)?(hw(t,"One has no move, victory to zero"),gw.of(jY.ZERO)):(hw(t,"no victory"),gw.empty())}getKingCoord(t){hw(e.VERBOSE,{TablutRules_getKingCoord:{state:t,con:this.config}});for(let e=0;e<this.config.WIDTH;e++)for(let n=0;n<this.config.WIDTH;n++)if(t.getPieceAtXY(n,e).isKing())return gw.of(new eQ(n,e));return gw.empty()}getInvader(){return this.config.INVADER}getDefender(){return this.config.INVADER.getOpponent()}isPlayerImmobilized(e,t){return 0===this.getPlayerListMoves(e,t).length}getPlayerListMoves(t,n){const r=[],i=this.getPlayerListPawns(t,n);hw(e.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:t,state:n}});for(const e of i){const t=this.getPossibleDestinations(e,n);for(const n of t){const t=this.generateMove(e,n);r.push(t)}}return r}getPlayerListPawns(e,t){const n=[];for(let r=0;r<this.config.WIDTH;r++)for(let i=0;i<this.config.WIDTH;i++){const s=new eQ(i,r);t.getAbsoluteOwner(s)===e&&n.push(s)}return n}getPossibleDestinations(e,t){const n=[];let r;for(const i of XJ.ORTHOGONALS){r=e.getNext(i,1);let s=!1;for(;r.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(r)===ZY.NONE?this.isExternalThrone(r)?t.getPieceAt(e).isKing()&&n.push(r):t.isCentralThrone(r)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&n.push(r):n.push(r):s=!0,r=r.getNext(i,1)}return n}}return e.VERBOSE=!1,e})();class NX extends AX{constructor(){super(kX,PX,SX.of)}static get(){return null==NX.singleton&&(NX.singleton=new NX),SQ.ruler=this.singleton,NX.singleton}}class MX extends hX{constructor(e,t,n){super(e),this.VERBOSE=t,this.generateMove=n,this.NONE=OX.UNOCCUPIED,this.captureds=[],this.chosen=new eQ(-1,-1),this.lastMove=gw.empty()}getViewBox(){const e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}updateBoard(){hw(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove()}showPreviousMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState.getCurrentOpponent();for(const n of XJ.ORTHOGONALS){const r=this.lastMove.get().end.getNext(n,1);if(r.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){const n=e.getRelativeOwner(t,r)===TX.OPPONENT,i=this.rules.node.gameState.getPieceAt(r)===OX.UNOCCUPIED;n&&i&&this.captureds.push(r)}}}onClick(e,t){var n=this;return lw(function*(){hw(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")");const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t)})()}chooseDestination(e,t){var n=this;return lw(function*(){hw(n.VERBOSE,"TaflComponent.chooseDestination");const r=n.chosen,i=new eQ(e,t),s=n.generateMove(r,i);return s.isSuccess()?(n.cancelMove(),yield n.chooseMove(s.get(),n.rules.node.gameState)):n.cancelMove(s.getReason())})()}choosePiece(e,t){return hw(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===OX.UNOCCUPIED?this.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new eQ(e,t),hw(this.VERBOSE,"selected piece = ("+e+", "+t+")"),DG.SUCCESS):this.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE())}pieceBelongToCurrentPlayer(e,t){const n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new eQ(e,t);return n.getRelativeOwner(r,i)===TX.PLAYER}cancelMoveAttempt(){this.chosen=new eQ(-1,-1)}isThrone(e,t){return this.rules.isThrone(this.rules.node.gameState,new eQ(e,t))}isCentralThrone(e,t){return!1===this.rules.node.gameState.isCentralThrone(new eQ(e,t))}getPieceClasses(e,t){const n=[],r=new eQ(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}getRectClasses(e,t){const n=[],r=new eQ(e,t);if(this.captureds.some(e=>e.equals(r)))n.push("captured");else if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;(r.equals(e)||r.equals(t))&&n.push("moved")}return n}getClickables(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new eQ(n,t));return e}isClickable(e,t){return this.pieceBelongToCurrentPlayer(e,t)}isInvader(e,t){return this.board[t][e]===OX.INVADERS}isKing(e,t){return this.board[t][e].isKing()}getKingPolyline(e,t){return 85+100*e+" "+(85+100*t)+" "+(30+100*e)+" "+(30+100*t)+" "+(50+100*e)+" "+(10+100*t)+" "+(70+100*e)+" "+(30+100*t)+" "+(15+100*e)+" "+(85+100*t)}}class xX extends uQ{getListMoves(e){hw(!1,{TaflMinimax_getListMoves:{node:e}});const t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}orderMoves(e,t){const n=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?QY.sortByDescending(t,e=>-e.end.getOrthogonalDistance(n)):QY.sortByDescending(t,e=>e.coord.equals(n)?this.ruler.isExternalThrone(e.end)?2:1:0),t}getBoardValue(e){const t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new hQ(n.get().getVictoryValue());const r=this.ruler.getPlayerListPawns(jY.ZERO,t).length,i=this.ruler.getPlayerListPawns(jY.ONE,t).length;let s=[1,2][this.ruler.config.INVADER.value];s*=jY.ZERO.getScoreModifier();let o=[2,1][this.ruler.config.INVADER.value];return o*=jY.ONE.getScoreModifier(),new hQ(r*s+i*o)}}class RX{constructor(e,t){this.directThreats=e,this.mover=t}equals(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}class DX extends RX{constructor(e,t){super(new fQ([e]),t),this.directThreat=e,this.mover=t}}class LX extends fQ{constructor(e){if(super(),this.map=[],this.values=[],void 0!==e)for(const t of e)this.add(t)}add(e){const t=this.toFields(e);let n=this.map;for(const i of t[0])void 0===n[i]&&(n[i]=[]),n=n[i];const r=t[1];return void 0===n[r]&&(n[r]=!0,this.values.push(e),!0)}contains(e){const t=this.toFields(e);let n=this.map;for(const r of t[0]){if(void 0===n[r])return!1;n=n[r]}return void 0!==n[t[1]]}[Symbol.iterator](){return this.values.values()}}class FX extends LX{toFields(e){return[[e.y],e.x]}}class BX extends xX{constructor(e,t){super(e,t),this.width=this.ruler.config.WIDTH,this.maxInfluence=16*(2*this.width-2),this.scoreByThreatenedPiece=16*this.maxInfluence+1,this.scoreBySafePiece=16*this.scoreByThreatenedPiece+1}getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState,r=OX.UNOCCUPIED;let i=0;const s=this.getPiecesMap(n),o=this.getThreatMap(n,s),a=this.filterThreatMap(o,n);for(const c of[jY.ZERO,jY.ONE])for(const e of s.get(c).get())if(a.get(e).isPresent())i+=c.getScoreModifier()*this.scoreByThreatenedPiece;else{i+=c.getScoreModifier()*this.scoreBySafePiece;let t=0;for(const i of XJ.ORTHOGONALS){let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&n.getPieceAt(s)===r;)t++,s=s.getNext(i,1)}i+=t*c.getScoreModifier()}return new hQ(i)}getPiecesMap(e){const t=OX.UNOCCUPIED,n=new EQ,r=[],i=[];for(let s=0;s<this.width;s++)for(let n=0;n<this.width;n++){const o=new eQ(n,s);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===jY.ZERO?r.push(o):i.push(o))}return n.set(jY.ZERO,new FX(r)),n.set(jY.ONE,new FX(i)),n}getThreatMap(e,t){const n=new EQ;for(const r of[jY.ZERO,jY.ONE])for(const i of t.get(r).get()){const t=this.getThreats(i,e);this.isThreatReal(i,e,t)&&n.set(i,new fQ(t))}return n}getThreats(e,t){const n=t.getAbsoluteOwner(e);VG(n.isPlayer(),"TaflPieceAndInfluenceMinimax.getThreats should be called with an occupied coordinate");const r=n.getOpponent(),i=[];for(const s of XJ.ORTHOGONALS){const n=e.getPrevious(s,1);if(this.isAThreat(n,t,r)){const o=[];for(const n of XJ.ORTHOGONALS){if(n===s.getOpposite())continue;let i=e.getNext(s,1);for(;i.isInRange(this.width,this.width)&&t.getPieceAt(i)===OX.UNOCCUPIED;)i=i.getNext(n);i.isInRange(this.width,this.width)&&t.getAbsoluteOwner(i)===r&&!1===e.getNext(s,1).equals(i)&&o.push(i)}i.push(new DX(n,new FX(o)))}}return i}isAThreat(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==jY.ONE&&t.getPieceAt(e)!==OX.UNOCCUPIED))}isThreatReal(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;for(const r of n)if(r.mover.size()>0)return!0;return!1}filterThreatMap(e,t){const n=new EQ,r=e.listKeys(),i=r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentPlayer()),s=new FX(r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentOpponent()));for(const o of i){const t=e.get(o).get(),r=[];for(const e of t)if(!1===s.contains(e.directThreat)){const t=[];for(const n of e.mover)!1===s.contains(n)&&t.push(n);t.length>0&&r.push(new DX(e.directThreat,new FX(t)))}r.length>0&&n.set(o,new fQ(r))}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}class UX extends BX{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=OX.UNOCCUPIED;let s=0;const o=this.getPiecesMap(n),a=this.getThreatMap(n,o),c=this.filterThreatMap(a,n);for(const l of[jY.ZERO,jY.ONE]){const e=new FX;for(const t of o.get(l).get())if(c.get(t).isPresent())s+=l.getScoreModifier()*UX.SCORE_BY_THREATENED_PIECE;else{s+=l.getScoreModifier()*UX.SCORE_BY_SAFE_PIECE;for(const s of XJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=UX.CONTROL_VALUE[t.y][t.x];s+=l.getScoreModifier()*e}}return new hQ(s)}}UX.SCORE_BY_THREATENED_PIECE=530,UX.SCORE_BY_SAFE_PIECE=16*UX.SCORE_BY_THREATENED_PIECE+1,UX.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];class VX extends UX{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=OX.UNOCCUPIED;let s=0,o=0,a=0;const c=this.getPiecesMap(n),l=this.getThreatMap(n,c),u=this.filterThreatMap(l,n);for(const d of[jY.ZERO,jY.ONE]){const e=new FX;for(const t of c.get(d).get())if(u.get(t).isPresent())o+=d.getScoreModifier();else{s+=d.getScoreModifier();for(const s of XJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=UX.CONTROL_VALUE[t.y][t.x];a+=d.getScoreModifier()*e}}const h=this.getStepForEscape(n);return new hQ(531*h*17*17+531*s*17+531*o+a)}getStepForEscape(e){const t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}_getStepForEscape(e,t,n,r){const i=this.getNextGen(e,n,r);return 0===i.length?gw.empty():i.some(e=>this.ruler.isExternalThrone(e))?gw.of(t):(t++,r.push(...i),this._getStepForEscape(e,t,i,r))}getNextGen(e,t,n){const r=[];for(const i of t)for(const t of XJ.ORTHOGONALS){let s=i.getNext(t,1);for(;s.isInRange(this.ruler.config.WIDTH,this.ruler.config.WIDTH)&&e.getPieceAt(s)===OX.UNOCCUPIED;)n.every(e=>!1===e.equals(s))&&r.push(s),s=s.getNext(t,1)}return r}}VX.SCORE_BY_THREATENED_PIECE=530,VX.SCORE_BY_SAFE_PIECE=16*UX.SCORE_BY_THREATENED_PIECE+1,VX.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];const $X=OX.UNOCCUPIED,zX=OX.INVADERS,HX=OX.DEFENDERS,GX=OX.PLAYER_ONE_KING;class qX{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne.`,kX.getInitialState()),AQ.anyMove($localize`Moving`,$localize`All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move.`,kX.getInitialState(),SX.of(new eQ(3,1),new eQ(1,1)),$localize`Congratulations!`),AQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new kX([[$X,$X,$X,zX,$X,$X,$X],[$X,$X,$X,zX,$X,$X,$X],[zX,$X,$X,HX,$X,$X,$X],[$X,$X,HX,GX,HX,zX,zX],[$X,$X,zX,$X,$X,$X,$X],[$X,$X,$X,HX,$X,zX,$X],[$X,$X,$X,zX,$X,$X,$X]],1),[SX.of(new eQ(3,5),new eQ(2,5))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),AQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new kX([[$X,$X,$X,zX,$X,$X,$X],[$X,$X,zX,$X,$X,$X,$X],[$X,$X,$X,HX,$X,$X,$X],[zX,HX,$X,$X,HX,zX,zX],[$X,HX,$X,$X,$X,$X,$X],[$X,zX,$X,GX,$X,zX,$X],[$X,$X,$X,zX,$X,$X,$X]],12),[SX.of(new eQ(2,1),new eQ(3,1)),SX.of(new eQ(3,0),new eQ(3,1))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),AQ.fromMove($localize`Capturing the king on his throne`,$localize`To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king.`,new kX([[$X,$X,$X,$X,$X,$X,$X],[$X,$X,$X,HX,$X,$X,$X],[$X,$X,$X,zX,$X,$X,$X],[$X,zX,$X,GX,zX,$X,$X],[$X,$X,$X,zX,$X,$X,$X],[$X,HX,$X,$X,$X,$X,$X],[$X,$X,$X,$X,$X,$X,$X]],72),[SX.of(new eQ(1,3),new eQ(2,3))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),AQ.fromMove($localize`Capturing the king next to his throne`,$localize`Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king.`,new kX([[$X,$X,zX,$X,$X,$X,$X],[$X,$X,$X,zX,$X,$X,$X],[$X,$X,$X,GX,zX,$X,$X],[$X,zX,HX,$X,HX,$X,$X],[$X,$X,$X,zX,$X,$X,$X],[$X,$X,$X,$X,$X,$X,$X],[$X,$X,$X,$X,$X,$X,$X]],72),[SX.of(new eQ(2,0),new eQ(2,2))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`),AQ.fromMove($localize`Capturing the king far from his throne`,$localize`When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king.`,new kX([[$X,$X,$X,$X,$X,$X,$X],[$X,$X,$X,$X,$X,$X,$X],[$X,zX,$X,zX,$X,$X,$X],[zX,$X,$X,$X,HX,$X,$X],[$X,$X,$X,HX,$X,$X,$X],[$X,$X,$X,$X,$X,$X,$X],[$X,GX,$X,zX,$X,$X,$X]],72),[SX.of(new eQ(3,6),new eQ(2,6))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function WX(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",6),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();na("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function jX(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",7),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();na("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function ZX(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,WX,1,1,"polyline",4),oa(2,jX,1,1,"ng-template",null,5,Ru),da()),2&e){const e=aa(3),t=wa().index,n=wa().index,r=wa();Ts(1),la("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function YX(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(3,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(4,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(5,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function KX(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"polyline",13),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),da()}if(2&e){const e=wa(3).index,t=wa().index,n=wa();Ts(1),na("points",n.getKingPolyline(e,t))}}function JX(e,t){if(1&e){const e=ma();Cn(),ha(0,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(1,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(3,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(3).index,t=wa().index,n=wa();na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function QX(e,t){if(1&e&&(Cn(),oa(0,KX,2,1,"g",9),oa(1,JX,4,16,"ng-template",null,12,Ru)),2&e){const e=aa(2),t=wa(2).index,n=wa().index;la("ngIf",wa().isKing(t,n))("ngIfElse",e)}}function XX(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",8),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,YX,6,20,"g",9),oa(3,QX,3,2,"ng-template",null,10,Ru),da()}if(2&e){const e=aa(4),t=wa().index,n=wa().index,r=wa();Ts(1),la("ngClass",r.getPieceClasses(t,n)),na("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),la("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function e1(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",2),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,ZX,4,2,"g",3),oa(3,XX,5,6,"g",3),da()}if(2&e){const e=t.index,n=wa().index,r=wa();Ts(1),Oa("id","click_",e,"_",n,""),la("ngClass",r.getRectClasses(e,n)),na("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),la("ngIf",r.board[n][e]===r.NONE&&r.isThrone(e,n)),Ts(1),la("ngIf",r.board[n][e]!==r.NONE)}}function t1(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,e1,4,9,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function n1(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",14),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.x,t.y)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),Oa("id","click_",e.x,"_",e.y,""),na("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let r1=(()=>{class e extends MX{constructor(e){super(e,!1,SX.from),this.rules=NX.get(),this.availableMinimaxes=[new xX(this.rules,"DummyBot"),new BX(this.rules,"Piece > Influence"),new UX(this.rules,"Piece > Control"),new VX(this.rules,"Escape > Piece > Control")],this.encoder=SX.encoder,this.tutorial=(new qX).tutorial}ngOnInit(){this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-brandhub"]],features:[Ho],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,t1,2,1,"g",1),oa(2,n1,2,6,"g",1),da()),2&e&&(na("viewBox",t.getViewBox()),Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.getClickables()))},directives:[Ud,Fd,$d],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),i1=(()=>{class e extends tQ{constructor(){super(...arguments),this.SPACE_SIZE=50}getTriangleCornerCoords(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}getTriangleCoordinate(e,t){return this.getTriangleCornerCoords(e,t).map(e=>e.x+","+e.y).reduce((e,t)=>e+","+t)}getDownwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new eQ(.5*this.SPACE_SIZE*e,i);return[o,new eQ(n,s),new eQ(r,i),o]}getUpwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new eQ(.5*this.SPACE_SIZE*e,s);return[o,new eQ(n,i),new eQ(r,s),o]}getPyramidCoordinate(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}getDownwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}getUpwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Ho],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),s1=(()=>{class e{}return e.INVALID_DISTANCE=()=>$localize`Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is.`,e.NOT_ENOUGH_TILES_TO_EXCHANGE=()=>$localize`You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it.`,e.FIRST_CLICK_SHOULD_NOT_BE_NULL=()=>$localize`Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles.`,e.CANNOT_CAPTURE_FROM_EMPTY=()=>$localize`You cannot capture from an empty space.`,e.CANNOT_CAPTURE_OWN_PIECES=()=>$localize`You cannot capture your own pieces.`,e})();class o1{constructor(e,t){this.direction=e,this.str=t}static fromCoords(e,t){const n=e.getVectorToward(t),r=o1.STEPS.findIndex(e=>e.direction.equals(n));if(-1===r)throw new Error(s1.INVALID_DISTANCE());return o1.STEPS[r]}toInt(){return o1.STEPS.findIndex(e=>e.direction.equals(this.direction))}equals(e){return this===e}toString(){return this.str}}o1.LEFT=new o1(new YJ(-2,0),"LEFT"),o1.UP_LEFT=new o1(QJ.UP_LEFT,"UP_LEFT"),o1.UP_RIGHT=new o1(QJ.UP_RIGHT,"UP_RIGHT"),o1.RIGHT=new o1(new YJ(2,0),"RIGHT"),o1.DOWN_LEFT=new o1(QJ.DOWN_LEFT,"DOWN_LEFT"),o1.DOWN_RIGHT=new o1(QJ.DOWN_RIGHT,"DOWN_RIGHT"),o1.STEPS=[o1.LEFT,o1.UP_LEFT,o1.UP_RIGHT,o1.RIGHT,o1.DOWN_LEFT,o1.DOWN_RIGHT];class a1 extends yQ{constructor(e,t,n,r){super(),this.start=e,this.step=t,this.landingCoord=n,this.capture=r}static fromMovement(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");const n=new eQ(e.x+t.direction.x,e.y+t.direction.y);if(n.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new a1(gw.of(e),gw.of(t),gw.of(n),gw.empty())}static fromTilesExchange(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new a1(gw.empty(),gw.empty(),gw.empty(),gw.of(e))}static fromCoordToCoord(e,t){const n=o1.fromCoords(e,t);return a1.fromMovement(e,n)}isTileExchange(){return this.capture.isPresent()}toString(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}equals(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}a1.encoder=new class extends qY{maxValue(){return 1035}encodeNumber(e){if(e.isTileExchange()){const t=e.capture.get().y;return 10*e.capture.get().x+t}{const t=e.start.get().y,n=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*n+t}}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?a1.fromTilesExchange(new eQ(n,t)):a1.fromMovement(new eQ(n,t),o1.STEPS[e-1])}};class c1{static getNeighbors(e){let t;const n=new eQ(e.x-1,e.y),r=new eQ(e.x+1,e.y);return t=(e.x+e.y)%2==1?[n,r,new eQ(e.x,e.y-1)]:[n,r,new eQ(e.x,e.y+1)],t}static getFakeNeighbors(e){return new eQ(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}static getCommonNeighbor(e,t){const n=c1.getNeighbors(e),r=c1.getNeighbors(t);let i=0;for(;i<n.length;){const e=n[i];let t=0;for(;t<r.length;){if(e.equals(r[t]))return gw.of(e);t++}i++}return gw.empty()}}class l1 extends gQ{static getEmptyNeighbors(e,t,n){const r=[];for(const i of c1.getNeighbors(t))i.isInRange(e[0].length,e.length)&&e[i.y][i.x]===n&&r.push(i);return r}getEmptyNeighboors(e,t){return l1.getEmptyNeighbors(this.board,e,t)}}class u1 extends l1{constructor(e,t,n,r){super(e,t),this.tiles=n,this.captures=r}static getTilesUpperLeftCoord(e){const t=e.x-e.x%3;let n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new eQ(t,n)}static getPresentNeighboorEntrances(e){return[new eQ(e.x+1,e.y-1),new eQ(e.x+3,e.y+0),new eQ(e.x+3,e.y+1),new eQ(e.x+1,e.y+2),new eQ(e.x-1,e.y+1),new eQ(e.x-1,e.y+0)].filter(u1.isInRange)}static getInitialState(){const e=rQ.EMPTY,t=rQ.NONE,n=rQ.ZERO,r=rQ.ONE;return new u1([[t,t,t,t,t,t,n,e,n,t,t,t,t,t,t],[t,t,t,e,e,n,e,e,e,n,e,e,t,t,t],[e,r,e,r,e,e,n,e,n,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[e,n,e,n,e,e,e,e,e,e,e,n,e,n,e],[n,e,e,e,n,e,e,e,e,e,n,e,e,e,n],[e,n,e,n,e,e,r,e,r,e,e,n,e,n,e],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t]],0,[0,0],[0,0])}applyLegalMovement(e){hw(u1.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});const t=e.start.get(),n=e.landingCoord.get(),r=this.getCopiedBoard();return r[n.y][n.x]=rQ.ofPlayer(this.getCurrentPlayer()),r[t.y][t.x]=rQ.EMPTY,new u1(r,this.turn,this.tiles,this.captures)}doMovementCaptures(e){hw(u1.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});const t=this.getCapturedNeighbors(e.landingCoord.get());let n=this;for(const r of t)n=n.capture(r);return n}getCapturedNeighbors(e){const t=this.getCurrentOpponent();return c1.getNeighbors(e).filter(e=>!e.isNotInRange(15,10)&&!!this.getPieceAt(e).is(t)&&this.isSurrounded(e))}isSurrounded(e){return 0===this.getEmptyNeighboors(e,rQ.EMPTY).length}capture(e){hw(u1.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});const t=this.getCopiedBoard(),n=[this.captures[0],this.captures[1]];return hw(u1.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=rQ.EMPTY,n[this.getCurrentPlayer().value]+=1,new u1(t,this.turn,this.tiles,n)}removeTilesIfNeeded(e,t){hw(u1.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});let n=this;const r=u1.getTilesUpperLeftCoord(e);if(this.isTileEmpty(r)&&this.isDeconnectable(r)){n=this.deconnectTile(r,t);const e=u1.getPresentNeighboorEntrances(r);for(const r of e){const e=n.getPieceAt(r);e===rQ.EMPTY?n=n.removeTilesIfNeeded(r,t):e.is(this.getCurrentOpponent())&&n.isSurrounded(r)&&(n=n.capture(r))}}return n}isTileEmpty(e){VG(this.getPieceAt(e)!==rQ.NONE,"Should not call isTileEmpty on removed tile");for(let t=0;t<2;t++)for(let n=0;n<3;n++){const r=e.getNext(new YJ(n,t),1);if(this.getPieceAt(r)!==rQ.EMPTY)return!1}return!0}isDeconnectable(e){const t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;let n=0;for(let r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}areNeighboor(e,t){return e+1===t||0===e&&5===t}getPresentNeighboorTilesRelativeIndexes(e){const t=[];let n=gw.empty();for(let r=0;r<6;r++){const i=e.getNext(u1.NEIGHBOORS_TILES_DIRECTIONS[r],1);i.isInRange(15,10)&&this.getPieceAt(i)!==rQ.NONE&&(n.isAbsent()&&(n=gw.of(r)),t.push(r-n.get()))}return t}deconnectTile(e,t){hw(u1.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});const n=this.getCopiedBoard(),r=e.x,i=e.y;for(let o=0;o<2;o++)for(let e=0;e<3;e++)n[i+o][r+e]=rQ.NONE;const s=[this.tiles[0],this.tiles[1]];return t&&(s[this.getCurrentPlayer().value]+=1),new u1(n,this.turn,s,this.captures)}getLegalLandings(e){const t=[];for(const n of o1.STEPS){const r=e.getNext(n.direction,1);this.isOnBoard(r)&&this.getPieceAt(r)===rQ.EMPTY&&t.push(r)}return t}getPiecesByFreedom(){const e=[[0,0,0,0],[0,0,0,0]];for(let t=0;t<10;t++)for(let n=0;n<15;n++){const r=this.board[t][n];if(r.isPlayer()){const i=this.getEmptyNeighboors(new eQ(n,t),rQ.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}u1.VERBOSE=!1,u1.NEIGHBOORS_TILES_DIRECTIONS=[new YJ(0,-2),new YJ(3,-1),new YJ(3,1),new YJ(0,2),new YJ(-3,1),new YJ(-3,-1)],u1.isInRange=e=>e.isInRange(15,10);let h1=(()=>{class e extends OQ{applyLegalMove(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}applyLegalTileExchange(t,n){const r=n.getCopiedBoard(),i=t.capture.get();r[i.y][i.x]=rQ.EMPTY;const s=[n.captures[0],n.captures[1]];s[n.getCurrentPlayer().value]+=1;const o=[n.tiles[0],n.tiles[1]];o[n.getCurrentPlayer().value]-=2;const a=new u1(r,n.turn,o,s),c=a.removeTilesIfNeeded(i,!1),l=new u1(c.getCopiedBoard(),c.turn+1,c.tiles,c.captures);return hw(e.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:n,afterCapture:a,afterTileRemoval:c,resultingState:l}}),l}applyLegalMovement(t,n){const r=n.applyLegalMovement(t),i=r.removeTilesIfNeeded(t.start.get(),!0),s=i.doMovementCaptures(t),o=new u1(s.board,n.turn+1,s.tiles,s.captures);return hw(e.VERBOSE,{ab_state:n,afterMovement:r,afterTilesRemoved:i,afterCaptures:s,resultingState:o}),o}isLegal(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}isLegalTileExchange(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return MG.failure(s1.NOT_ENOUGH_TILES_TO_EXCHANGE());const n=t.getPieceAt(e.capture.get());return n===rQ.NONE||n===rQ.EMPTY?MG.failure(s1.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?MG.failure(s1.CANNOT_CAPTURE_OWN_PIECES()):MG.success(void 0)}isLegalMovement(e,t){if(t.getPieceAt(e.start.get())===rQ.NONE){const t="Cannot start with a coord outside the board "+e.start.get().toString()+".";return MG.failure(t)}if(t.getPieceAt(e.landingCoord.get())===rQ.NONE){const t="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return MG.failure(t)}const n=t.getPieceAt(e.start.get());return n===rQ.EMPTY?MG.failure(lQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n.is(t.getCurrentOpponent())?MG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE()):MG.success(void 0)}static getGameStatus(e){const t=e.gameState;return t.captures[0]>=18?PQ.ZERO_WON:t.captures[1]>=18?PQ.ONE_WON:PQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class d1 extends uQ{getListMoves(e){let t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}getListExchanges(e){const t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=rQ.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(let s=0;s<10;s++)for(let e=0;e<15;e++){const r=new eQ(e,s);if(n.getPieceAt(r)===i){const e=a1.fromTilesExchange(r);t.push(e)}}return t}getListMovement(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<10;i++)for(let e=0;e<15;e++){const s=new eQ(e,i);if(n.getPieceAt(s).is(r)){const e=n.getLegalLandings(s);for(const n of e){const e=a1.fromCoordToCoord(s,n);t.push(e)}}}return t}getBoardValue(e){const t=h1.getGameStatus(e);if(t.isEndGame)return hQ.fromWinner(t.winner);const n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new hQ(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}getPiecesScore(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}getPlayerPiecesScore(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}putCaptureFirst(e,t){return QY.sortByDescending(t,t=>this.moveCapturesList(e,t).length),t}moveCapturesList(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}let f1=(()=>{class e extends d1{getBoardValue(t){const n=h1.getGameStatus(t);if(n.isEndGame)return hQ.fromWinner(n.winner);const r=t.gameState,i=this.getPiecesMap(r),s=this.getThreatMap(r,i),o=this.filterThreatMap(s,r);let a=0;for(const c of[jY.ZERO,jY.ONE])for(const t of i.get(c).get())o.get(t).isPresent()?a+=c.getScoreModifier()*e.SCORE_BY_THREATENED_PIECE:a+=c.getScoreModifier()*e.SCORE_BY_SAFE_PIECE;return a+=r.tiles[1]-r.tiles[0],new hQ(a)}getPiecesMap(e){const t=new EQ,n=[],r=[];for(let i=0;i<10;i++)for(let t=0;t<15;t++){const s=new eQ(t,i),o=e.getPieceAt(s);o===rQ.ZERO?n.push(s):o===rQ.ONE&&r.push(s)}return t.set(jY.ZERO,new FX(n)),t.set(jY.ONE,new FX(r)),t}getThreatMap(e,t){const n=new EQ;for(const r of[jY.ZERO,jY.ONE])for(const i of t.get(r).get()){const t=this.getThreat(i,e);t.isPresent()&&n.set(i,t.get())}return n}getThreat(e,t){const n=jY.of(t.getPieceAt(e).value).getOpponent();let r=gw.empty();const i=[],s=c1.getNeighbors(e).filter(e=>e.isInRange(15,10));for(const o of s){const e=t.getPieceAt(o);if(e.is(n))i.push(o);else if(e===rQ.EMPTY){if(r.isPresent())return gw.empty();r=gw.of(o)}}if(r.isPresent()){const e=[];for(const s of o1.STEPS){const o=r.get().getNext(s.direction,1);o.isInRange(15,10)&&t.getPieceAt(o).is(n)&&i.every(e=>!1===e.equals(o))&&e.push(o)}if(e.length>0)return gw.of(new RX(new FX(i),new FX(e)))}return gw.empty()}filterThreatMap(e,t){const n=new EQ,r=e.listKeys(),i=r.filter(e=>t.getPieceAt(e).is(t.getCurrentPlayer())),s=new FX(r.filter(e=>t.getPieceAt(e).is(t.getCurrentOpponent())));for(const o of i){const t=e.get(o).get();VG(1===t.directThreats.size(),"oldThreat must contain exactly one direct threat");const r=t.directThreats.getAnyElement().get();let i=gw.empty();if(!1===s.contains(r)){const e=[];for(const n of t.mover)!1===s.contains(n)&&e.push(n);e.length>0&&(i=gw.of(new RX(t.directThreats,new FX(e))))}i.isPresent()&&n.set(o,i.get())}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e})();const p1=rQ.EMPTY,g1=rQ.NONE,m1=rQ.ZERO,y1=rQ.ONE;class v1{constructor(){this.tutorial=[AQ.informational($localize`Board and goal of the game`,$localize`Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.
         The triangles are the spaces on which pieces move during the game.
         The tiles can be removed from the board (you will see how later).
         The dark pieces belong to the first player and can only move on the dark spaces,
         while the light pieces belong to the second player and can only move on the light spaces.
         The goal of the game is to capture all of the opponent's pieces.`,u1.getInitialState()),AQ.anyMove($localize`Move`,$localize`To move a piece, you need to:
        <ol>
          <li>Click on one of your pieces.</li>
          <li>Click on one of the triangular space highlighted in yellow.</li>
        </ol>
        You can pass through the opponent's pieces.
        You're playing first, hence you're playing Dark.<br/><br/>
        Perform any move.`,u1.getInitialState(),a1.fromCoordToCoord(new eQ(3,5),new eQ(5,5)),$localize`Congratulations! Let's see captures now.`),AQ.fromMove($localize`Capture`,$localize`Every piece has three neighboring triangular spaces (2 on the sides).
        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!
        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>
        You're playing Light, make a capture.`,new u1([[g1,g1,g1,g1,g1,g1,m1,p1,m1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,m1,p1,p1,p1,p1,p1,m1,p1,p1,g1,g1,g1],[p1,y1,p1,y1,m1,y1,p1,p1,m1,p1,p1,y1,p1,y1,p1],[y1,p1,p1,p1,p1,p1,p1,p1,p1,p1,y1,p1,p1,p1,y1],[p1,y1,p1,y1,p1,p1,p1,p1,p1,p1,p1,y1,p1,y1,p1],[p1,m1,p1,m1,p1,p1,p1,p1,p1,p1,p1,m1,p1,m1,p1],[m1,p1,p1,p1,m1,p1,p1,p1,p1,p1,m1,p1,p1,p1,m1],[p1,m1,p1,m1,p1,p1,y1,p1,y1,p1,p1,m1,p1,m1,p1],[g1,g1,g1,p1,p1,y1,p1,p1,p1,y1,p1,p1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,y1,p1,y1,g1,g1,g1,g1,g1,g1]],3,[0,0],[0,0]),[a1.fromCoordToCoord(new eQ(5,2),new eQ(4,1)),a1.fromCoordToCoord(new eQ(3,4),new eQ(4,3))],$localize`Congratulations!`,$localize`Failed, you have not captured any piece.`),AQ.fromMove($localize`Gain a tile`,$localize`When a tile is empty, it can become removable from the board.
        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.
        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.
        For example, here, the topmost dark piece will not disconnect its tile when leaving it.
        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>
        Perform a move that lets you gain two tiles.`,new u1([[g1,g1,g1,g1,g1,g1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,y1,p1,p1,g1,g1,g1,g1,g1,g1],[p1,p1,p1,g1,g1,g1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[p1,p1,y1,p1,p1,p1,p1,m1,p1,g1,g1,g1,g1,g1,g1],[p1,p1,p1,y1,p1,p1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[p1,p1,p1,p1,p1,p1,p1,p1,p1,p1,p1,m1,g1,g1,g1],[p1,p1,m1,p1,p1,y1,p1,p1,p1,p1,m1,p1,p1,p1,m1],[p1,p1,p1,p1,p1,p1,y1,p1,y1,p1,p1,m1,p1,m1,p1],[g1,g1,g1,p1,p1,y1,p1,p1,p1,y1,p1,p1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,y1,p1,y1,g1,g1,g1,g1,g1,g1]],2,[0,0],[0,0]),[a1.fromCoordToCoord(new eQ(2,6),new eQ(4,6)),a1.fromCoordToCoord(new eQ(2,6),new eQ(3,5)),a1.fromCoordToCoord(new eQ(2,6),new eQ(3,7))],$localize`Congratulations!`,$localize`Failed, you have not gained the two tiles that you could, try again!`),AQ.fromMove($localize`Exchanging a tile`,$localize`When you have a tile, you can see it on the left of the board.
        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.
        This will cost you two tiles.
        If any tiles are removed during that turn, nobody will get them.<br/><br/>
        Gain some time and capture the last piece!`,new u1([[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,m1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,p1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,p1,y1,p1,y1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,y1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,y1,p1,y1,g1,g1,g1,g1,g1,g1]],1,[0,2],[0,0]),[a1.fromTilesExchange(new eQ(5,5))],$localize`Congratulations!`,$localize`It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!`),AQ.fromMove($localize`Special capture`,$localize`When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!
        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>
        A move that demonstrate both of these things can be done on this board by Light. Try it!`,new u1([[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,p1,p1,m1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,m1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,m1,y1,p1,y1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,y1,m1,p1,p1,p1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,p1,p1,y1,g1,g1,g1,g1,g1,g1,g1,g1,g1],[g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1,g1]],1,[0,0],[0,0]),[a1.fromCoordToCoord(new eQ(7,6),new eQ(6,5)),a1.fromCoordToCoord(new eQ(7,6),new eQ(8,5))],$localize`Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.
        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space.`,$localize`Failed!`)]}}function _1(e,t){if(1&e&&(Cn(),fa(0,"polygon",13)),2&e){const e=wa().index,t=wa().index,n=wa();la("ngClass",n.getPyramidClass(e,t)),na("points",n.getPyramidCoordinate(e,t))}}function C1(e,t){if(1&e&&(Cn(),fa(0,"polygon",15)),2&e){const e=wa(2).index,t=wa().index,n=wa();la("ngClass",n.getEmptyClass(e,t)),na("points",n.getTriangleCoordinate(e,t))}}function E1(e,t){if(1&e&&(Cn(),oa(0,C1,1,2,"polygon",14)),2&e){const e=wa().index,t=wa().index;la("ngIf",wa().isEmptyCase(e,t))}}function w1(e,t){if(1&e&&(Cn(),fa(0,"polygon",16)),2&e){const e=wa().index,t=wa().index,n=wa();Oa("id","dark_line_",e,"_",t,""),na("points",n.getLineCoordinate(e,t))}}function b1(e,t){if(1&e&&(Cn(),fa(0,"polygon",17)),2&e){const e=wa().index,t=wa().index,n=wa();Oa("id","dark_line_",e,"_",t,""),na("points",n.getLineCoordinate(e,t))}}function S1(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",8),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),oa(1,_1,1,2,"polygon",9),oa(2,E1,1,1,"ng-template",null,10,Ru),oa(4,w1,1,3,"polygon",11),oa(5,b1,1,3,"polygon",12),da()}if(2&e){const e=t.$implicit,n=t.index,r=aa(3),i=wa().index,s=wa();Oa("id","click_",n,"_",i,""),Ts(1),la("ngIf",s.isPyramid(n,i))("ngIfElse",r),Ts(3),la("ngIf",e!==s.NONE),Ts(1),la("ngIf",e!==s.NONE)}}function P1(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,S1,6,6,"g",7),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function O1(e,t){if(1&e&&(Cn(),fa(0,"polygon",18)),2&e){const e=t.$implicit;na("points",wa().getTriangleCoordinate(e.x,e.y))}}function T1(e,t){if(1&e&&(Cn(),fa(0,"polygon",19)),2&e){const e=wa();na("points",e.getTriangleCoordinate(e.lastStart.get().x,e.lastStart.get().y))}}function I1(e,t){if(1&e&&(Cn(),fa(0,"polygon",19)),2&e){const e=wa();na("points",e.getTriangleCoordinate(e.lastEnd.get().x,e.lastEnd.get().y))}}function k1(e,t){if(1&e&&(Cn(),fa(0,"polygon",20)),2&e){const e=wa();na("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}function A1(e,t){if(1&e&&(Cn(),ha(0,"g",21),fa(1,"polygon",22),ha(2,"text",23),Da(3),da(),da()),2&e){const e=wa();Ts(1),na("points",e.getTilesCountCoordinate(0,0))("stroke",e.lastTurnWasTilesExchange(0)?"yellow":"black"),Ts(1),na("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+0*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),La(e.tiles[0])}}function N1(e,t){if(1&e&&(Cn(),ha(0,"g",24),fa(1,"polygon",25),ha(2,"text",26),Da(3),da(),da()),2&e){const e=wa();Ts(1),na("points",e.getTilesCountCoordinate(0,9))("stroke",e.lastTurnWasTilesExchange(1)?"yellow":"black"),Ts(1),na("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+9*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),La(e.tiles[1])}}let M1=(()=>{class e extends i1{constructor(e){super(e),this.tiles=[0,0],this.NONE=rQ.NONE,this.chosenCoord=gw.empty(),this.lastStart=gw.empty(),this.lastEnd=gw.empty(),this.highlights=[],this.scores=gw.of([0,0]),this.rules=new h1(u1),this.availableMinimaxes=[new d1(this.rules,"Normal"),new f1(this.rules,"Piece > Threat > Tiles")],this.encoder=a1.encoder,this.tutorial=(new v1).tutorial,this.SPACE_SIZE=70,this.updateBoard()}updateBoard(){this.chosenCoord=gw.empty(),this.state=this.rules.node.gameState,this.scores=gw.of(this.state.captures),this.tiles=this.state.tiles;const e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=gw.empty(),this.lastEnd=gw.empty()),this.board=this.rules.node.gameState.board}showHighlight(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}cancelMoveAttempt(){this.chosenCoord=gw.empty(),this.highlights=[]}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new eQ(e,t);return n.chosenCoord.isAbsent()?n.firstClick(i):n.secondClick(i)})()}firstClick(e){var t=this;return lw(function*(){const n=t.state.getPieceAt(e);if(n.is(t.state.getCurrentOpponent())){const n=a1.fromTilesExchange(e);return t.chooseMove(n,t.state,t.state.captures)}return n.is(t.state.getCurrentPlayer())?(t.chosenCoord=gw.of(e),t.showHighlight(),DG.SUCCESS):t.cancelMove(s1.FIRST_CLICK_SHOULD_NOT_BE_NULL())})()}secondClick(e){var t=this;return lw(function*(){if(e.equals(t.chosenCoord.get()))return t.cancelMoveAttempt(),DG.SUCCESS;if(t.highlights.some(t=>t.equals(e))){const n=a1.fromCoordToCoord(t.chosenCoord.get(),e);return t.chooseMove(n,t.state,t.state.captures)}return t.cancelMove(s1.INVALID_DISTANCE())})()}isPyramid(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}wasOpponent(e,t){const n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}getPyramidClass(e,t){const n=this.board[t][e];return n===rQ.ZERO?this.getPlayerClass(jY.ZERO):n===rQ.ONE?this.getPlayerClass(jY.ONE):"captured"}isEmptyCase(e,t){return this.board[t][e]===rQ.EMPTY||this.wasRemoved(e,t)}wasRemoved(e,t){const n=this.rules.node.mother;if(this.board[t][e]===rQ.NONE&&n.isPresent()){const r=n.get().gameState.getPieceAtXY(e,t);return r===rQ.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}getEmptyClass(e,t){return this.board[t][e]===rQ.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}getTilesCountCoordinate(e,t){const n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}getLineCoordinate(e,t){const n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}mustShowTilesOf(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}lastTurnWasTilesExchange(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-coerceo"]],features:[Ho],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,P1,2,1,"g",1),oa(2,O1,1,1,"polygon",2),oa(3,T1,1,1,"polygon",3),oa(4,I1,1,1,"polygon",3),oa(5,k1,1,1,"polygon",4),oa(6,A1,4,6,"g",5),oa(7,N1,4,6,"g",6),da()),2&e&&(na("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.highlights),Ts(1),la("ngIf",t.lastStart.isPresent()),Ts(1),la("ngIf",t.lastEnd.isPresent()),Ts(1),la("ngIf",t.chosenCoord.isPresent()),Ts(1),la("ngIf",t.mustShowTilesOf(0)),Ts(1),la("ngIf",t.mustShowTilesOf(1)))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),x1=(()=>{class e{}return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=()=>$localize`Your piece should land on a neighboring square.`,e.CANNOT_DROP_AFTER_TURN_40=()=>$localize`You cannot drop a piece during the moving phase.`,e.CANNOT_MOVE_BEFORE_TURN_40=()=>$localize`You cannot move a piece before both players have dropped all of their pieces.`,e.MUST_JUMP_OVER_PIECES=()=>$localize`A jump must be made over a piece, not over an empty square.`,e.MUST_DROP_IN_CENTRAL_ZONE=()=>$localize`A drop must occur in the central zone of the board.`,e.INVALID_JUMP=()=>$localize`A jump must land two squares from its original position, and be done in a straight line in any direction.`,e.SAME_LOCATION_VISITED_IN_JUMP=()=>$localize`You are visiting the same location twice in a move, you are not allowed to do so.`,e})();class R1 extends gQ{static getInitialState(){const e=QY.createTable(R1.WIDTH,R1.HEIGHT,ZY.NONE);return new R1(e,0)}isShelter(e){return 0===e.x||e.x===R1.WIDTH-1?R1.SHELTERS_INDICES.some(t=>e.y===t):(0===e.y||e.y===R1.HEIGHT-1)&&R1.SHELTERS_INDICES.some(t=>e.x===t)}isCentralZone(e){return e.x>=R1.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=R1.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=R1.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=R1.CENTRAL_ZONE_BOTTOM_RIGHT.y}isDropPhase(){return this.turn<40}getSidePieces(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}R1.WIDTH=17,R1.HEIGHT=17,R1.CENTRAL_ZONE_TOP_LEFT=new eQ(4,6),R1.CENTRAL_ZONE_BOTTOM_RIGHT=new eQ(12,10),R1.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],R1.ALL_SHELTERS=new fQ(R1.SHELTERS_INDICES.flatMap(e=>[new eQ(e,0),new eQ(e,R1.HEIGHT-1),new eQ(0,e),new eQ(R1.WIDTH-1,e)])).toList();class D1 extends vQ{constructor(e){super(e.x,e.y)}static of(e){return e.isInRange(R1.WIDTH,R1.HEIGHT)?MG.success(new D1(e)):MG.failure("Move out of board")}toString(){return`ConspirateursMoveDrop(${this.coord.toString()})`}equals(e){return!!e.isDrop()&&this.coord.equals(e.coord)}isDrop(){return!0}isSimple(){return!1}isJump(){return!1}}D1.encoder=class{static getEncoder(e,t,n){return new class extends qY{constructor(){super(...arguments),this.shiftX=t}maxValue(){return(e-1)*this.shiftX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftX+e.coord.y}decodeNumber(r){const i=r%t;r/=t;const s=new eQ((r-=r%1)%e,i);return n(s)}}}}.getEncoder(R1.WIDTH,R1.HEIGHT,e=>D1.of(e).get());class L1 extends EX{constructor(e,t){super(e,t)}static of(e,t){return e.isInRange(R1.WIDTH,R1.HEIGHT)&&t.isInRange(R1.WIDTH,R1.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?MG.success(new L1(e,t)):MG.failure(x1.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):MG.failure("Move out of board")}toString(){return`ConspirateursMoveSimple(${this.coord.toString()} -> ${this.end.toString()})`}equals(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}isDrop(){return!1}isSimple(){return!0}isJump(){return!1}}L1.encoder=EX.getEncoder(R1.WIDTH,R1.HEIGHT,(e,t)=>L1.of(e,t).get());class F1 extends yQ{constructor(e){super(),this.coords=e}static of(e){if(e.length<2)return MG.failure("ConspirateursMoveJump requires at least one jump, so two coords");for(const t of e)if(t.isNotInRange(R1.WIDTH,R1.HEIGHT))return MG.failure("Move out of board");for(let t=1;t<e.length;t++)if(e[t-1].getDirectionToward(e[t]).isFailure()||2!==e[t-1].getDistance(e[t]))return MG.failure(x1.INVALID_JUMP());return new FX(e).size()===e.length?MG.success(new F1(e)):MG.failure(x1.SAME_LOCATION_VISITED_IN_JUMP())}addJump(e){const t=QY.copyImmutableArray(this.coords);return t.push(e),F1.of(t)}getStartingCoord(){return this.coords[0]}getEndingCoord(){return this.coords[this.coords.length-1]}getLandingCoords(){return this.coords.slice(1)}getJumpedOverCoords(){const e=[];for(let t=1;t<this.coords.length;t++){const n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}toString(){return`ConspirateursMoveJump(${this.coords.map(e=>e.toString()).reduce((e,t)=>e+" -> "+t)})`}equals(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}isDrop(){return!1}isSimple(){return!1}isJump(){return!0}}F1.encoder=new class extends GY{constructor(){super(...arguments),this.coordEncoder=eQ.numberEncoder(R1.WIDTH,R1.HEIGHT)}encodeMove(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}decodeMove(e){VG(null!=uw.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");const t=uw.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return F1.of(t).get()}};const B1=GY.disjunction3(D1.encoder,L1.encoder,F1.encoder,e=>e.isDrop(),e=>e.isSimple());class U1 extends OQ{constructor(){super(R1)}static get(){return U1.singleton.isAbsent()&&(U1.singleton=gw.of(new U1)),U1.singleton.get()}applyLegalMove(e,t,n){const r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=ZY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{const n=e.getStartingCoord(),i=e.getEndingCoord();r[n.y][n.x]=ZY.NONE,r[i.y][i.x]=t.getCurrentPlayer()}return new R1(r,t.turn+1)}isLegal(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}dropLegality(e,t){return t.turn>=40?MG.failure(x1.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord).isPlayer()?MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?MG.failure(x1.MUST_DROP_IN_CENTRAL_ZONE()):MG.success(void 0)}simpleMoveLegality(e,t){return t.turn<40?MG.failure(x1.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end).isPlayer()?MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE()):MG.success(void 0)}jumpLegality(e,t){if(t.turn<40)return MG.failure(x1.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE());for(const n of e.getJumpedOverCoords())if(t.getPieceAt(n)===ZY.NONE)return MG.failure(x1.MUST_JUMP_OVER_PIECES());for(const n of e.getLandingCoords())if(t.getPieceAt(n).isPlayer())return MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE());return MG.success(void 0)}jumpTargetsFrom(e){const t=[new eQ(e.x+2,e.y),new eQ(e.x-2,e.y),new eQ(e.x,e.y+2),new eQ(e.x,e.y-2),new eQ(e.x+2,e.y+2),new eQ(e.x+2,e.y-2),new eQ(e.x-2,e.y+2),new eQ(e.x-2,e.y-2)],n=[];for(const r of t)F1.of([e,r]).isSuccess()&&n.push(r);return n}nextJumps(e,t){const n=e.getEndingCoord(),r=[];for(const i of this.jumpTargetsFrom(n)){const n=e.addJump(i);n.isSuccess()&&this.jumpLegality(n.get(),t).isSuccess()&&r.push(n.get())}return r}jumpHasPossibleNextTargets(e,t){return this.nextJumps(e,t).length>0}getGameStatus(e){const t=e.gameState,n=[0,0];for(const r of R1.ALL_SHELTERS){const e=t.getPieceAt(r);if(e.isPlayer()&&(n[e.value]+=1,20===n[e.value]))return PQ.getVictory(e)}return PQ.ONGOING}}U1.singleton=gw.empty();class V1 extends uQ{getListMoves(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}getListMovesDrop(e){const t=[],n=R1.CENTRAL_ZONE_TOP_LEFT,r=R1.CENTRAL_ZONE_BOTTOM_RIGHT;for(let i=n.y;i<=r.y;i++)for(let s=n.x;s<=r.x;s++)e.getPieceAtXY(s,i)===ZY.NONE&&t.push(D1.of(new eQ(s,i)).get());return t}getListMovesAfterDrop(e){let t=[];const n=e.getCurrentPlayer();for(let r=0;r<R1.HEIGHT;r++)for(let i=0;i<R1.WIDTH;i++){const s=new eQ(i,r);e.getPieceAt(s)===n&&(t=t.concat(this.getListSimpleMoves(e,s)),t=t.concat(this.getListJumps(e,s)))}return t}getListSimpleMoves(e,t){const n=[],r=[new eQ(t.x+1,t.y),new eQ(t.x-1,t.y),new eQ(t.x,t.y+1),new eQ(t.x,t.y-1),new eQ(t.x+1,t.y+1),new eQ(t.x+1,t.y-1),new eQ(t.x-1,t.y+1),new eQ(t.x-1,t.y-1)];for(const i of r){const r=L1.of(t,i);r.isSuccess()&&U1.get().simpleMoveLegality(r.get(),e).isSuccess()&&n.push(r.get())}return n}getListJumps(e,t){const n=new fQ;for(const r of U1.get().jumpTargetsFrom(t)){const i=F1.of([t,r]).get();U1.get().jumpLegality(i,e).isSuccess()&&(n.add(i),n.union(this.getListJumpStartingFrom(e,i)))}return n.toList()}getListJumpStartingFrom(e,t){const n=U1.get().nextJumps(t,e),r=new fQ(n);for(const i of n)r.union(this.getListJumpStartingFrom(e,i));return r}getBoardValue(e){const t=e.gameState;let n=0;const r=new EQ;r.set(jY.ZERO,0),r.set(jY.ONE,0);for(let i=0;i<R1.HEIGHT;i++)for(let e=0;e<R1.WIDTH;e++){const s=new eQ(e,i),o=t.getPieceAt(s);if(o.isPlayer())if(t.isShelter(s)){if(n+=20*o.getScoreModifier(),r.replace(o,r.get(o).get()+1),20===r.get(o).get())return new hQ(o.getVictoryValue())}else{let e=100;for(const n of R1.ALL_SHELTERS)if(t.getPieceAt(n)===ZY.NONE){const t=s.getOrthogonalDistance(n);e=Math.min(e,t)}n-=o.getScoreModifier()*e}}return new hQ(n)}}const $1=ZY.NONE,z1=jY.ZERO,H1=jY.ONE;class G1{constructor(){this.tutorial=[AQ.informational($localize`Board and aim of the game`,$localize`Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially.`,R1.getInitialState()),AQ.anyMove($localize`Initial phase`,$localize`In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone.`,R1.getInitialState(),D1.of(new eQ(7,7)).get(),$localize`Congratulations!`),AQ.fromPredicate($localize`Simple move`,$localize`Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move.`,new R1([[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,z1,H1,H1,z1,z1,H1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,H1,z1,H1,z1,z1,z1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,H1,$1,$1,$1,$1,$1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,z1,H1,H1,H1,z1,z1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,H1,H1,H1,H1,H1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1]],40),L1.of(new eQ(4,6),new eQ(3,5)).get(),(e,t)=>e.isSimple()?DG.SUCCESS:DG.failure($localize`You have made a jump, not a simple move. Try again!`),$localize`Congratulations!`),AQ.fromPredicate($localize`Jumps`,$localize`The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful).`,new R1([[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,z1,H1,H1,z1,z1,H1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,H1,z1,H1,z1,z1,z1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,H1,$1,$1,$1,$1,$1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,z1,H1,H1,H1,z1,z1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,H1,H1,H1,H1,H1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1]],40),F1.of([new eQ(6,7),new eQ(6,5)]).get(),(e,t)=>e.isJump()?DG.SUCCESS:DG.failure($localize`You have not performed a jump. Try again!`),$localize`Congratulations!`),AQ.fromMove($localize`Chaining jumps in a single move`,$localize`Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it.`,new R1([[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,H1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,H1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,H1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,z1,$1,H1,z1,z1,H1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,$1,z1,H1,z1,z1,z1,z1,H1,$1,$1,$1,$1],[$1,$1,$1,$1,z1,H1,$1,$1,$1,$1,$1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,z1,H1,H1,H1,z1,z1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,H1,z1,H1,H1,H1,H1,H1,H1,z1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1],[$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1]],40),[F1.of([new eQ(8,6),new eQ(6,4),new eQ(6,2),new eQ(6,0)]).get()],$localize`Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does.`,$localize`You have not performed a triple jump. Try again!`)]}}function q1(e,t){if(1&e){const e=ma();Cn(),ha(0,"rect",9),_a("click",function(){Gt(e);const t=wa().$implicit;return wa(2).onClick(t.coord)}),da()}if(2&e){const e=wa().$implicit,t=wa(2);na("x",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.x+t.STROKE_WIDTH)("y",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.y+t.STROKE_WIDTH)("width",t.SPACE_SIZE-3*t.STROKE_WIDTH)("height",t.SPACE_SIZE-3*t.STROKE_WIDTH)}}function W1(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",6),_a("click",function(){Gt(e);const t=wa().$implicit;return wa(2).onClick(t.coord)}),da()}if(2&e){const e=wa(),t=e.index,n=e.$implicit,r=wa().index,i=wa();Oa("id","piece_",t,"_",r,""),la("ngClass",n.pieceClasses),na("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function j1(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",6),_a("click",function(){const t=Gt(e).$implicit;return wa(2).onClick(t.coord)}),da(),oa(2,q1,1,4,"rect",7),oa(3,W1,1,6,"circle",8),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","click_",n,"_",r,""),la("ngClass",e.squareClasses),na("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngIf",e.isShelter),Ts(1),la("ngIf",e.hasPiece)}}function Z1(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,j1,4,9,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function Y1(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",10),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),la("ngClass",n.viewInfo.boardInfo[e.y][e.x].shelterClasses),na("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function K1(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=t.$implicit,n=wa();Pa("id","sidePiece_0_",e,""),na("cx",-n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function J1(e,t){if(1&e&&(Cn(),fa(0,"circle",12)),2&e){const e=t.$implicit,n=wa();Pa("id","sidePiece_1_",e,""),na("cx",1715+n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function Q1(e,t){if(1&e&&(Cn(),fa(0,"rect",13)),2&e){const e=wa();na("x",e.SPACE_SIZE*e.CENTRAL_ZONE_START.x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.CENTRAL_ZONE_START.y+e.STROKE_WIDTH)("width",e.CENTRAL_ZONE_SIZE.x*e.SPACE_SIZE)("height",e.CENTRAL_ZONE_SIZE.y*e.SPACE_SIZE)}}let X1=(()=>{class e extends tQ{constructor(e){super(e),this.ALL_SHELTERS=R1.ALL_SHELTERS,this.CENTRAL_ZONE_START=R1.CENTRAL_ZONE_TOP_LEFT,this.CENTRAL_ZONE_SIZE=new YJ(R1.CENTRAL_ZONE_BOTTOM_RIGHT.x-R1.CENTRAL_ZONE_TOP_LEFT.x+1,R1.CENTRAL_ZONE_BOTTOM_RIGHT.y-R1.CENTRAL_ZONE_TOP_LEFT.y+1),this.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},this.selected=gw.empty(),this.jumpInConstruction=gw.empty(),this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH),this.rules=U1.get(),this.availableMinimaxes=[new V1(this.rules,"ConspirateursMinimax")],this.encoder=B1,this.tutorial=(new G1).tutorial}ngOnInit(){this.updateBoard()}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}updateViewInfo(){const e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(let t=0;t<R1.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(let n=0;n<R1.WIDTH;n++){const r=new eQ(n,t),i=e.getPieceAt(r),s={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i.isPlayer(),isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(s)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}updateOccupiedShelters(){for(const e of R1.ALL_SHELTERS){const t=this.viewInfo.boardInfo[e.y][e.x];t.isShelter=!0,t.hasPiece&&t.shelterClasses.push("highlighted")}}updateSelected(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){const e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;for(const r of e.coords)this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}else{const e=this.selected.get();this.viewInfo.boardInfo[e.y][e.x].pieceClasses.push("selected")}}updateVictory(){const e=this.getState(),t=U1.get().getGameStatus(this.rules.node);if(!0===t.isEndGame)for(const n of R1.ALL_SHELTERS)e.getPieceAt(n)===t.winner&&this.viewInfo.boardInfo[n.y][n.x].squareClasses.push("victory")}showLastMove(){const e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";for(const t of e.coords)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=t.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=t.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}cancelMoveAttempt(){this.jumpInConstruction=gw.empty(),this.selected=gw.empty(),this.updateBoard()}onClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());const r=t.getState();if(r.getPieceAt(e)===t.getCurrentPlayer())return t.selected=gw.of(e),t.jumpInConstruction=gw.empty(),t.updateViewInfo(),DG.SUCCESS;if(t.jumpInConstruction.isPresent())return t.constructJump(e);if(t.selected.isPresent())return t.selectNextCoord(e);if(r.isDropPhase()){const n=D1.of(e);return VG(n.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(n.get(),r)}return t.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE())})()}constructJump(e){var t=this;return lw(function*(){const n=t.jumpInConstruction.get(),r=t.getState();if(e.equals(n.getEndingCoord()))return t.chooseMove(n,r);{const i=n.addJump(e);if(i.isFailure())return t.cancelMove(i.getReason());const s=t.rules.jumpLegality(i.get(),r);return s.isFailure()?t.cancelMove(s.getReason()):t.updateJump(i.get())}})()}updateJump(e){var t=this;return lw(function*(){const n=t.getState();return t.rules.jumpHasPossibleNextTargets(e,n)?(t.jumpInConstruction=gw.of(e),t.updateViewInfo(),DG.SUCCESS):t.chooseMove(e,n)})()}selectNextCoord(e){var t=this;return lw(function*(){const n=t.selected.get(),r=L1.of(n,e);if(r.isSuccess())return t.chooseMove(r.get(),t.getState());{const r=F1.of([n,e]);return r.isFailure()?t.cancelMove(r.getReason()):t.updateJump(r.get())}})()}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-conspirateurs"]],features:[Ho],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,Z1,2,1,"g",1),oa(2,Y1,2,5,"g",1),oa(3,K1,1,4,"circle",2),oa(4,J1,1,4,"circle",3),oa(5,Q1,1,4,"rect",4),fa(6,"polyline",5),da()),2&e&&(Ts(1),la("ngForOf",t.viewInfo.boardInfo),Ts(1),la("ngForOf",t.ALL_SHELTERS),Ts(1),la("ngForOf",t.range(t.viewInfo.sidePieces[0])),Ts(1),la("ngForOf",t.range(t.viewInfo.sidePieces[1])),Ts(1),la("ngIf",t.viewInfo.dropPhase),Ts(1),na("points",t.viewInfo.lastMoveArrow))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class e0{constructor(e,t){this.owner=e,this.otherPieceType=t}static of(e,t){return e===jY.ZERO?t?e0.ZERO_SECOND:e0.ZERO_FIRST:e===jY.ONE?t?e0.ONE_SECOND:e0.ONE_FIRST:e0.EMPTY}toString(){return`DiamPiece(${this.owner}, ${this.otherPieceType})`}}e0.encoder=qY.tuple([jY.numberEncoder,qY.booleanEncoder],e=>[e.owner,e.otherPieceType],e=>e0.of(e[0],e[1])),e0.EMPTY=new e0(ZY.NONE,!1),e0.ZERO_FIRST=new e0(jY.ZERO,!1),e0.ZERO_SECOND=new e0(jY.ZERO,!0),e0.ONE_FIRST=new e0(jY.ONE,!1),e0.ONE_SECOND=new e0(jY.ONE,!0),e0.PLAYER_PIECES=[e0.ZERO_FIRST,e0.ZERO_SECOND,e0.ONE_FIRST,e0.ONE_SECOND];class t0 extends yQ{constructor(e,t){if(super(),this.target=e,this.piece=t,t===e0.EMPTY)throw new Error("Cannot drop an empty piece")}isDrop(){return!0}getTarget(){return this.target}equals(e){return!(this.target!==e.target||this.piece!==e.piece)}toString(){return`DiamMoveDrop(${this.target}, ${this.piece})`}}t0.encoder=qY.tuple([qY.numberEncoder(7),e0.encoder],e=>[e.target,e.piece],e=>new t0(e[0],e[1]));class n0 extends yQ{constructor(e,t){super(),this.start=e,this.moveDirection=t}static fromRepresentation(e,t){return new n0(new eQ(e.x,3-e.y),t)}isDrop(){return!1}getTarget(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}equals(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}toString(){return`DiamMoveShift(${this.start}, ${this.moveDirection})`}}n0.encoder=qY.tuple([eQ.numberEncoder(8,4),qY.booleanEncoder],e=>[e.start,"clockwise"===e.moveDirection],e=>new n0(e[0],e[1]?"clockwise":"counterclockwise"));const r0=qY.disjunction(t0.encoder,n0.encoder,e=>e.isDrop());let i0=(()=>{class e{}return e.NO_MORE_PIECES_OF_THIS_TYPE=()=>$localize`You do not have any pieces of this type anymore.`,e.SPACE_IS_FULL=()=>$localize`You cannot play here: this space is already full.`,e.TARGET_STACK_TOO_HIGH=()=>$localize`You cannot add more pieces to the target stack, as it will contain more than 4 pieces.`,e.MUST_SHIFT_TO_NEIGHBOR=()=>$localize`To perform a shift, you must move the pieces to a neighboring space.`,e.MUST_SELECT_PIECE_FIRST=()=>$localize`You must first select either a piece from the side, or a stack of pieces to shift on the board.`,e})(),s0=(()=>{class e extends gQ{constructor(e,t,n){super(e,n),this.remainingPieces=t}static getInitialState(){const t=e0.EMPTY;return new e([[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t]],[4,4,4,4],0)}static fromRepresentation(t,n){const r=t.reverse(),i=[4,4,4,4];for(let s=0;s<e.HEIGHT;s++)for(let t=0;t<e.WIDTH;t++){const n=r[s][t];r[s][t]!==e0.EMPTY&&i[e.pieceIndex(n)]--}return VG(i.every(e=>e>=0),"Invalid DiamState representation uses too many pieces"),new e(r,i,n)}static pieceIndex(e){switch(e){case e0.ZERO_FIRST:return 0;case e0.ZERO_SECOND:return 1;case e0.ONE_FIRST:return 2;default:return uw.expectToBe(e,e0.ONE_SECOND),3}}getRemainingPiecesOf(t){return this.remainingPieces[e.pieceIndex(t)]}getStackHeight(t){let n=0;for(let r=0;r<e.HEIGHT&&this.getPieceAtXY(t,r)!==e0.EMPTY;r++)n++;return n}}return e.WIDTH=8,e.HEIGHT=4,e})();class o0 extends OQ{constructor(){super(s0)}static get(){return o0.singleton.isAbsent()&&(o0.singleton=gw.of(new o0)),o0.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}applyLegalDrop(e,t){const n=QY.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;const r=QY.copyImmutableArray(t.remainingPieces);return r[s0.pieceIndex(e.piece)]-=1,new s0(n,r,t.turn+1)}applyLegalShift(e,t){const n=QY.copyBiArray(t.board),r=e.getTarget();let i=t.getStackHeight(r),s=e.start.y;for(;s<s0.HEIGHT&&t.getPieceAtXY(e.start.x,s)!==e0.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,s),n[s][e.start.x]=e0.EMPTY,i++,s++;return new s0(n,t.remainingPieces,t.turn+1)}isLegal(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}isDropLegal(e,t){return e.piece.owner!==t.getCurrentPlayer()?MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?MG.failure(i0.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}dropHeightValidity(e,t){return t.getStackHeight(e.target)===s0.HEIGHT?MG.failure(i0.SPACE_IS_FULL()):MG.success(void 0)}isShiftLegal(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}shiftHeightValidity(e,t){const n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>s0.HEIGHT?MG.failure(i0.TARGET_STACK_TOO_HIGH()):MG.success(void 0)}getGameStatus(e){const t=this.findHighestAlignment(e.gameState);if(t.isPresent()){const n=e.gameState.getPieceAt(t.get());return VG(n.owner.isPlayer(),"highest alignment is owned by a player"),PQ.getVictory(n.owner)}return PQ.ONGOING}findHighestAlignment(e){for(let t=0;t<s0.WIDTH/2;t++)for(let n=s0.HEIGHT-1;n>0;n--){const r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+s0.WIDTH/2,n);if(r!==e0.EMPTY&&r===i)return gw.of(new eQ(t,n))}return gw.empty()}pieceCanMove(e,t){return!!this.isShiftLegal(new n0(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new n0(t,"counterclockwise"),e).isSuccess()}}o0.singleton=gw.empty();class a0 extends uQ{getListMoves(e){const t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}getListShifts(e){const t=[],n=this.getShiftSources(e);for(const r of n)for(const n of[new n0(r,"clockwise"),new n0(r,"counterclockwise")])o0.get().shiftHeightValidity(n,e).isSuccess()&&t.push(n);return t}getListDrops(e){const t=this.getRemainingPiecesForCurrentPlayer(e),n=[];for(let r=0;r<s0.WIDTH;r++)for(const i of t){const t=new t0(r,i);o0.get().dropHeightValidity(t,e).isSuccess()&&n.push(t)}return n}getRemainingPiecesForCurrentPlayer(e){const t=[];for(const n of e0.PLAYER_PIECES)this.currentPlayerCanDropPiece(e,n)&&t.push(n);return t}currentPlayerCanDropPiece(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}getShiftSources(e){const t=[],n=e.getCurrentPlayer();for(let r=0;r<s0.HEIGHT;r++)for(let i=0;i<s0.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new eQ(i,r));return t}getBoardValue(e){const t=o0.get().getGameStatus(e);return new hQ(t.isEndGame?t.toBoardValue():0)}}const c0=e0.EMPTY,l0=e0.ZERO_FIRST,u0=e0.ZERO_SECOND,h0=e0.ONE_FIRST,d0=e0.ONE_SECOND;class f0{constructor(){this.tutorial=[AQ.informational($localize`Initial board and player pieces`,$localize`Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right.`,s0.getInitialState()),AQ.fromMove($localize`Goal of the game`,$localize`At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!`,s0.fromRepresentation([[c0,c0,c0,c0,c0,c0,c0,c0],[c0,c0,c0,c0,c0,c0,c0,c0],[c0,c0,c0,c0,h0,c0,c0,c0],[l0,c0,c0,c0,l0,c0,c0,c0]],3),[new t0(0,e0.ONE_FIRST)],$localize`Congratulations, you won!`,$localize`Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board.`),AQ.fromMove($localize`Types of move`,$localize`You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board.`,s0.fromRepresentation([[c0,c0,c0,c0,c0,c0,c0,c0],[c0,c0,c0,c0,d0,c0,c0,c0],[c0,c0,c0,c0,l0,c0,c0,c0],[h0,c0,c0,c0,u0,c0,c0,c0]],4),[n0.fromRepresentation(new eQ(4,3),"counterclockwise"),n0.fromRepresentation(new eQ(4,3),"clockwise"),n0.fromRepresentation(new eQ(4,2),"counterclockwise"),n0.fromRepresentation(new eQ(4,2),"clockwise")],$localize`Congratulations!`,$localize`Failed, try to move one of your piece that is already on the board.`),AQ.fromMove($localize`Special case`,$localize`It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!`,s0.fromRepresentation([[c0,c0,c0,c0,l0,c0,c0,c0],[c0,c0,c0,c0,d0,c0,c0,l0],[c0,c0,c0,c0,l0,c0,c0,d0],[c0,h0,c0,c0,u0,c0,c0,h0]],8),[n0.fromRepresentation(new eQ(4,2),"counterclockwise")],$localize`Congratulations!`,$localize`Failed, try to shift a stack of pieces to the left.`)]}}function p0(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"path",6),_a("click",function(){const t=Gt(e).$implicit;return wa().onSpaceClick(t)}),da(),ha(2,"path",7),_a("click",function(){const t=Gt(e).$implicit;return wa().onSpaceClick(t)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),Pa("id","click_",e,""),la("ngClass",n.viewInfo.boardInfo[e].spaceClasses),na("d",n.BOARD_PATHS[e]),Ts(1),la("ngClass",n.viewInfo.boardInfo[e].spaceClasses),na("d",n.DECORATION_PATHS[e])}}function g0(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",9),_a("click",function(){const t=Gt(e).$implicit,n=wa().$implicit;return wa().onPieceInGameClick(n,t.y)}),fa(1,"use",10),fa(2,"use",11),da()}if(2&e){const e=t.$implicit;Oa("id","click_",wa().$implicit,"_",e.y,""),la("ngClass",e.foregroundClasses),Ts(1),la("ngClass",e.backgroundClasses),na("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),na("x",e.drawPosition.x)("y",e.drawPosition.y)}}function m0(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,g0,3,8,"g",8),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",n.viewInfo.boardInfo[e].pieces)}}function y0(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",12),_a("click",function(){const t=Gt(e).$implicit;return wa().onRemainingPieceClick(t.actualPiece)}),fa(1,"use",10),fa(2,"use",11),da()}if(2&e){const e=t.$implicit;Oa("id","piece_",e.actualPiece.owner.value,"_",e.actualPiece.otherPieceType?1:0,""),la("ngClass",e.foregroundClasses),Ts(1),la("ngClass",e.backgroundClasses),na("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),na("x",e.drawPosition.x)("y",e.drawPosition.y)}}const v0=function(){return[0,1,2,3,4,5,6,7]},_0=function(){return[2,1,3,0,4,7,5,6]};class C0 extends tQ{constructor(e){super(e),this.BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],this.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],this.selected=gw.empty(),this.viewInfo={boardInfo:[],remainingPieces:[]},this.rules=o0.get(),this.availableMinimaxes=[new a0(this.rules,"DiamDummyMinimax")],this.encoder=r0,this.tutorial=(new f0).tutorial}ngOnInit(){this.updateBoard()}onSpaceClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#click_"+e);return n.isFailure()?t.cancelMove(n.getReason()):t.onSpaceClickAfterCheck(e)})()}onSpaceClickAfterCheck(e){var t=this;return lw(function*(){if(t.selected.isPresent()){const n=t.selected.get();let r;if("pieceFromReserve"===n.type)r=new t0(e,n.piece);else if((n.position.x+1)%s0.WIDTH===e)r=new n0(n.position,"clockwise");else{if((n.position.x+(s0.WIDTH-1))%s0.WIDTH!==e)return t.cancelMove(i0.MUST_SHIFT_TO_NEIGHBOR());r=new n0(n.position,"counterclockwise")}return t.chooseMove(r,t.getState())}return t.cancelMove(i0.MUST_SELECT_PIECE_FIRST())})()}onPieceInGameClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=gw.of({type:"pieceFromBoard",position:new eQ(e,t)}),n.updateViewInfo(),DG.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE())})()}onRemainingPieceClick(e){var t=this;return lw(function*(){const n=t.canUserPlay(t.getPieceId(e));return n.isFailure()?t.cancelMove(n.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=gw.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),DG.SUCCESS):t.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE())})()}getPieceId(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}getLastMovedFromDrop(e,t){const n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),s=this.getDrawPositionOnBoard(r,i),o=new eQ(r,i);return[{start:gw.empty(),end:o,startDrawPosition:n,endDrawPosition:s}]}getLastMovedFromShift(e,t){const n=e.start.x,r=e.getTarget();let i=t.getStackHeight(r);const s=[];for(let o=e.start.y;o<s0.HEIGHT&&t.getPieceAtXY(n,o)!==e0.EMPTY;o++,i++)s.push({start:gw.of(new eQ(n,o)),end:new eQ(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return s}updateViewInfo(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}updateBoardInfo(){for(let e=0;e<s0.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}showLastMove(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}showLastMoveOnSpaces(){const e=this.rules.node.move;VG(e.isPresent(),"showLastMoveOnSpaces called without a last move");const t=e.get();for(let n=0;n<s0.WIDTH;n++){const e=[];t.isDrop()?t.getTarget()===n&&e.push("moved"):(t.getTarget()===n||t.start.x===n)&&e.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=e}}showLastMoveOnPieces(){const e=this.rules.node.move;VG(e.isPresent(),"showLastMoveOnPieces called without a last move");const t=e.get(),n=this.getPreviousState();let r=[];r=t.isDrop()?this.getLastMovedFromDrop(t,n):this.getLastMovedFromShift(t,n);for(const i of r)this.viewInfo.boardInfo[i.end.x].pieces[i.end.y].foregroundClasses.push("last-move")}updateRemainingPiecesInfo(){const e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];const t=this.isPlayerTurn();for(const n of e0.PLAYER_PIECES){const r=this.getState().getRemainingPiecesOf(n);for(let i=0;i<r;i++){const s=[];this.isTopPieceOfReserveAndSelected(i,r,n)&&s.push("selected"),t&&i===r-1&&n.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+n.owner.value+(n.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionRemainingPiece(n,i),actualPiece:n})}}}isTopPieceOfReserveAndSelected(e,t,n){if(this.selected.isPresent()){const r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}getDrawPositionRemainingPiece(e,t){let n,r;return n=e.owner===jY.ZERO?-100:600,r=e.otherPieceType?100:450,new eQ(n,r).getNext(new YJ(0,-t*C0.PIECE_HEIGHT))}getPieces(e){const t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[];for(let i=0;i<s0.HEIGHT;i++){const s=this.getState().getPieceAtXY(e,i),o=new eQ(e,i);if(s!==e0.EMPTY){const a=[];this.pieceFromBoardIsSelected(e,i)&&a.push("selected"),this.isVictory(e,i,t)&&a.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&a.push("clickable-hover"),r.push({backgroundClasses:["player"+s.owner.value+(s.otherPieceType?"-alternate":"")],foregroundClasses:a,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:s})}}return r}pieceFromBoardIsSelected(e,t){if(this.selected.isPresent()){const n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}isVictory(e,t,n){if(n.isPresent()){const r=n.get();return r.x%4==e%4&&r.y===t}return!1}getDrawPositionOnBoard(e,t){return C0.CENTER[e].getNext(new YJ(0,-t*C0.PIECE_HEIGHT))}cancelMoveAttempt(){this.selected=gw.empty(),this.updateBoard()}}C0.CENTER=[new eQ(40,160),new eQ(100,50),new eQ(255,2),new eQ(400,50),new eQ(460,160),new eQ(400,270),new eQ(255,320),new eQ(100,270)],C0.PIECE_HEIGHT=36,C0.\u0275fac=function(e){return new(e||C0)(ca(BG))},C0.\u0275cmp=Xe({type:C0,selectors:[["app-diam"]],features:[Ho],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"defs"),ha(2,"g",1),fa(3,"path",2),fa(4,"ellipse",3),da(),da(),oa(5,p0,3,5,"g",4),oa(6,m0,2,1,"g",4),oa(7,y0,3,8,"g",5),da()),2&e&&(Ts(5),la("ngForOf",ou(3,v0)),Ts(1),la("ngForOf",ou(4,_0)),Ts(1),la("ngForOf",t.viewInfo.remainingPieces))},directives:[Ud,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class E0{constructor(e,t){this.offset=e,this.constant=t}static fromTwoCoords(e,t){const n=e.x,r=t.x,i=e.y,s=t.y,o=n+i,a=r+s;return n===r&&i!==s&&o!==a?gw.of(E0.constantQ(n)):n!==r&&i===s&&o!==a?gw.of(E0.constantR(i)):n!==r&&i!==s&&o===a?gw.of(E0.constantS(o)):gw.empty()}static constantQ(e){return new E0(e,"q")}static constantR(e){return new E0(e,"r")}static constantS(e){return new E0(e,"s")}static areOnSameLine(e){if(e.length<2)return!0;const t=E0.fromTwoCoords(e[0],e[1]);if(t.isAbsent())return!1;const n=t.get();for(const r of e.slice(2))if(!1===n.contains(r))return!1;return!0}toString(){return`Line(${this.constant}, ${this.offset})`}equals(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}contains(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}getDirection(){switch(this.constant){case"q":return iQ.DOWN;case"r":return iQ.RIGHT;case"s":return iQ.DOWN_LEFT}}}class w0 extends gQ{constructor(e,t,n,r,i,s){super(t,e),this.board=t,this.width=n,this.height=r,this.excludedCases=i,this.empty=s,VG(this.excludedCases.length<this.height/2+1,"Invalid excluded cases specification for HexagonalGameState.")}static neighbors(e,t){return[new eQ(e.x+t,e.y-t),new eQ(e.x+t,e.y),new eQ(e.x-t,e.y+t),new eQ(e.x-t,e.y),new eQ(e.x,e.y+t),new eQ(e.x,e.y-t)]}setAt(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}equalsT(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(let n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;for(const n of this.allCoords())if(!1===t(this.getPieceAt(n),e.getPieceAt(n)))return!1;return!0}allCoords(){const e=[];return this.forEachCoord(t=>{e.push(t)}),e}allLines(){const e=[];for(let t=0;t<this.width;t++)e.push(E0.constantQ(t));for(let t=0;t<this.height;t++)e.push(E0.constantR(t));for(let t=this.excludedCases.length;t<this.height+this.excludedCases.length;t++)e.push(E0.constantS(t));return e}getEntranceOnLine(e){let t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new eQ(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new eQ(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new eQ(e.offset,0):new eQ(this.width-1,e.offset-this.width+1))}}findEntranceFrom(e,t){const n=e.getDirection();let r=t;for(let s=0;s<Math.max(this.width,this.height);s++){if(this.isOnBoard(r))return r;r=r.getNext(n)}const i=UG.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(i.getReason())}}class b0{constructor(e,t,n){this.owner=e,this.size=t,this.source=n}static append(e,t){return new b0(e.owner,e.size+t.size,e.source||t.source)}getValue(){return b0.encoder.encodeNumber(this)}getOwner(){return this.owner}belongsTo(e){return this.owner===e}containsSource(){return this.source}isEmpty(){return 0===this.size}getSize(){return this.size}toString(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}b0.sizeEncoder=qY.numberEncoder(49),b0.encoder=qY.tuple([qY.booleanEncoder,jY.numberEncoder,b0.sizeEncoder],e=>[e.source,e.owner,e.size],e=>new b0(e[1],e[2],e[0])),b0.MAX_SIZE=49,b0.EMPTY=new b0(ZY.NONE,0,!1),b0.NONE=new b0(ZY.NONE,-1,!1),b0.PLAYER_ZERO=new b0(jY.ZERO,1,!1),b0.PLAYER_ONE=new b0(jY.ONE,1,!1),b0.SOURCE=new b0(ZY.NONE,1,!0);let S0=(()=>{class e extends w0{constructor(t,n,r){super(n,t,e.WIDTH,e.HEIGHT,e.EXCLUDED_CASES,b0.EMPTY),this.alreadyPassed=r}static balancedBoard(){const e=b0.NONE,t=b0.PLAYER_ZERO,n=b0.PLAYER_ONE,r=b0.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}static isOnBoard(t){return!t.isNotInRange(e.WIDTH,e.HEIGHT)&&e.balancedBoard()[t.y][t.x]!==b0.NONE}static getInitialState(){return new e(e.balancedBoard(),0,!1)}getAllPieces(){const t=[];for(let n=0;n<e.HEIGHT;n++)for(let r=0;r<e.WIDTH;r++){const e=new eQ(r,n);this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()&&t.push(e)}return t}numberOfNeighbors(e){return w0.neighbors(e,1).filter(e=>this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()).length}setAtUnsafe(t,n){const r=QY.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.turn,this.alreadyPassed)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==b0.NONE}}return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e})();class P0 extends EX{constructor(e,t){super(e,t)}static of(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return P0.PASS;if(!S0.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!S0.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new P0(e,t);if(e.x===t.x)return new P0(e,t);if(e.x+e.y===t.x+t.y)return new P0(e,t);throw new Error("Invalid move")}toString(){return this===P0.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}length(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}P0.PASS=new P0(new eQ(-1,-1),new eQ(-2,-2)),P0.encoder=new class extends qY{maxValue(){return 42148}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return P0.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new P0(new eQ((e=e/16|0)%16,r),new eQ(n,t))}};let O0=(()=>{class e{}return e.NOT_PLAYER_PIECE=()=>$localize`You must select a piece or a stack of your color.`,e.EMPTY_STACK=()=>$localize`You must select a stack.`,e.TOO_MANY_NEIGHBORS=()=>$localize`This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors.`,e.CANT_REACH_TARGET=()=>$localize`This stack cannot move because it could never land on another piece.`,e.INVALID_MOVE_LENGTH=()=>$localize`A stack must always be moved by as many spaces as there are pieces in the stack.`,e.EMPTY_TARGET_STACK=()=>$localize`The stack must land on an occupied space.`,e})();class T0 extends OQ{static getGameStatus(e){const t=e.gameState,n=T0.getScores(t);return 0===T0.getMovablePieces(t).length?n[0]>n[1]?PQ.ZERO_WON:n[0]<n[1]?PQ.ONE_WON:PQ.DRAW:PQ.ONGOING}static getMovablePieces(e){return T0.getFreePieces(e).filter(t=>T0.pieceHasTarget(e,t))}static getFreePieces(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6)}static pieceHasTarget(e,t){const n=e.getPieceAt(t).getSize();return void 0!==w0.neighbors(t,n).find(t=>e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty())}static pieceTargets(e,t){const n=e.getPieceAt(t).getSize();return w0.neighbors(t,n).filter(t=>e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty())}static getScores(e){let t=0,n=0;return e.getAllPieces().map(r=>{const i=e.getPieceAt(r);i.belongsTo(jY.ZERO)?t+=i.getSize():i.belongsTo(jY.ONE)&&(n+=i.getSize())}),[t,n]}isMovablePiece(e,t){VG(e.isOnBoard(t),"piece is not on the board");const n=e.getPieceAt(t);return n.getSize()<1?DG.failure(O0.EMPTY_STACK()):n.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?DG.failure(O0.TOO_MANY_NEIGHBORS()):T0.pieceHasTarget(e,t)?DG.SUCCESS:DG.failure(O0.CANT_REACH_TARGET()):DG.failure(O0.NOT_PLAYER_PIECE())}canOnlyPass(e){return 0===T0.getMovablePieces(e).length}sourceCoords(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).containsSource())}markPiecesConnectedTo(e,t,n){w0.neighbors(t,1).forEach(t=>{e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,this.markPiecesConnectedTo(e,t,n))})}removeDisconnectedPieces(e){const t=QY.createTable(S0.WIDTH,S0.HEIGHT,!1);this.sourceCoords(e).forEach(n=>{t[n.y][n.x]=!0,this.markPiecesConnectedTo(e,n,t)});let n=e;return n.getAllPieces().forEach(e=>{t[e.y][e.x]||(n=n.setAt(e,b0.EMPTY))}),n}applyLegalMove(e,t,n){if(e===P0.PASS)return new S0(t.board,t.turn+1,!0);{const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end),i=t.setAt(e.coord,b0.EMPTY).setAt(e.end,b0.append(n,r));return this.removeDisconnectedPieces(new S0(i.board,t.turn+1,!1))}}isLegal(e,t){if(0===T0.getMovablePieces(t).length)return e!==P0.PASS||t.alreadyPassed?MG.failure(lQ.MUST_PASS()):MG.success(void 0);if(e===P0.PASS)return MG.failure(lQ.CANNOT_PASS());const n=this.isMovablePiece(t,e.coord);if(n.isFailure())return n.toFailedFallible();const r=t.getPieceAt(e.coord);return e.length()!==r.getSize()?MG.failure(O0.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?MG.failure(O0.EMPTY_TARGET_STACK()):MG.success(void 0)}getGameStatus(e){return T0.getGameStatus(e)}}class I0 extends uQ{getListMoves(e){const t=e.move,n=e.gameState,r=[];return T0.getMovablePieces(n).forEach(e=>T0.pieceTargets(n,e).forEach(t=>{const n=P0.of(e,t);r.push(n)})),0===r.length&&!1===t.equalsValue(P0.PASS)&&r.push(P0.PASS),r}getBoardValue(e){const t=e.gameState,n=T0.getScores(t);return 0===T0.getMovablePieces(t).length?new hQ(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new hQ(n[0]-n[1])}}class k0 extends I0{getListMoves(e){const t=e.gameState,n=super.getListMoves(e),r=t.getCurrentPlayer().getOpponent();return QY.sortByDescending(n,e=>{VG(e!==P0.PASS,"Cannot sort with DvonnMove.PASS");const n=t.getPieceAt(e.end);return n.belongsTo(r)?n.getSize():0}),n}getBoardValue(e){const t=T0.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState,r=T0.getScores(n),i=n.getAllPieces(),s=i.length,o=i.filter(e=>n.getPieceAt(e).belongsTo(jY.ZERO)).length,a=i.filter(e=>n.getPieceAt(e).belongsTo(jY.ONE)).length;return new hQ((a*r[1]-o*r[0])/s)}}const A0=b0.EMPTY,N0=b0.NONE,M0=b0.SOURCE,x0=b0.PLAYER_ZERO,R0=b0.PLAYER_ONE,D0=new b0(jY.ZERO,2,!1),L0=new b0(jY.ONE,2,!1),F0=new b0(jY.ZERO,4,!1),B0=new b0(jY.ONE,4,!1);class U0{constructor(){this.tutorial=[AQ.anyMove($localize`Moving`,$localize`At Dvonn, each hexagonal space contains a stack of pieces.
        If no number is indicated on a stack, it means that it only contains one piece.
        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.
        The owner of a stack is the one that has a piece at the top of the stack.
        Only the owner of a stack can move it.
        A stack cannot be moved if it is surrounded by 6 other stacks.
        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.
        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.
        Therefore, there are six possible directions.
        The player with dark pieces starts.<br/><br/>
        You're playing Dark, click on a stack and move it by one space.`,S0.getInitialState(),P0.of(new eQ(2,0),new eQ(3,0)),$localize`Congratulations!`),AQ.fromPredicate($localize`Disconnection`,$localize`Pieces with a lightning strike are called "sources".
        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>
        You're playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!`,new S0([[N0,N0,R0,M0,A0,A0,A0,A0,A0,A0,A0],[N0,A0,x0,A0,A0,A0,A0,A0,A0,A0,A0],[A0,A0,B0,A0,A0,A0,A0,R0,M0,A0,A0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,A0,N0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,N0,N0]],0,!1),P0.of(new eQ(2,1),new eQ(2,0)),(e,t)=>e.end.equals(new eQ(3,0))?DG.failure($localize`You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it.`):(VG(e.end.equals(new eQ(2,0)),"player made an impossible move"),DG.SUCCESS),$localize`Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!
        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.
        Disconnected stacks will not be visible at the next turn.`),AQ.fromPredicate($localize`Moving on a source`,$localize`You are allowed to move your stacks on any other stack.
        This means that you can take control of a source by moving one of your stack on top of it.
        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>
        You're playing Dark and you can take control of a source, do it!`,new S0([[N0,N0,M0,R0,A0,A0,A0,A0,A0,A0,A0],[N0,x0,x0,A0,A0,A0,A0,A0,A0,A0,A0],[A0,R0,x0,R0,A0,A0,x0,L0,M0,A0,A0],[A0,A0,R0,A0,A0,A0,A0,A0,A0,A0,N0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,N0,N0]],0,!1),P0.of(new eQ(2,1),new eQ(2,0)),(e,t)=>e.end.equals(new eQ(2,0))?DG.SUCCESS:DG.failure($localize`You have not taken possession of a source, try again.`),$localize`Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!`),AQ.informational($localize`Passing`,$localize`It can happen that you have no possible move to make.
        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>
        This is a situation that occurs here for Dark.`,new S0([[N0,N0,M0,A0,A0,A0,A0,A0,A0,A0,A0],[N0,A0,D0,A0,A0,A0,A0,A0,A0,A0,A0],[A0,A0,L0,A0,A0,A0,A0,L0,M0,F0,A0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,A0,N0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,N0,N0]],0,!1)),AQ.fromMove($localize`End of the game`,$localize`When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>
        Make your last move.`,new S0([[N0,N0,M0,A0,A0,A0,A0,A0,A0,A0,A0],[N0,A0,x0,A0,A0,A0,A0,A0,A0,A0,A0],[A0,A0,A0,A0,A0,A0,A0,A0,M0,F0,A0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,A0,N0],[A0,A0,A0,A0,A0,A0,A0,A0,A0,N0,N0]],0,!1),[P0.of(new eQ(2,1),new eQ(2,0))],$localize`Congratulations, you won 6 - 0!`,$localize`Bad idea, by moving on the source you would have won a point.`)]}}function V0(e,t){if(1&e&&(Cn(),fa(0,"circle",10)),2&e){const e=wa().$implicit,t=wa().$implicit,n=wa();la("ngClass",n.getPieceClasses(e)),na("cx",n.getCenterAt(t).x)("cy",n.getCenterAt(t).y)("r",n.SPACE_SIZE)}}function $0(e,t){if(1&e&&(Cn(),fa(0,"polygon",11)),2&e){const e=wa().$implicit,t=wa().$implicit,n=wa();na("transform",1===e.getSize()?"translate("+(n.getCenterAt(t).x-18)+" "+(n.getCenterAt(t).y-16)+") scale(0.10)":"translate("+(n.getCenterAt(t).x-3)+" "+(n.getCenterAt(t).y-12)+") scale(0.07)")}}function z0(e,t){if(1&e){const e=ma();Cn(),ha(0,"text",12),_a("click",function(){Gt(e);const t=wa(2).$implicit;return wa().onClick(t.x,t.y)}),Da(1),da()}if(2&e){const e=wa().$implicit,t=wa().$implicit,n=wa();na("x",e.containsSource()?n.getCenterAt(t).x-7:n.getCenterAt(t).x)("y",n.getCenterAt(t).y),Ts(1),La(e.getSize())}}function H0(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",5),_a("click",function(){Gt(e);const t=wa().$implicit;return wa().onClick(t.x,t.y)}),fa(1,"polyline",6),oa(2,V0,1,4,"circle",7),oa(3,$0,1,1,"polygon",8),oa(4,z0,2,3,"text",9),da()}if(2&e){const e=t.$implicit,n=wa().$implicit,r=wa();Oa("id","click_",n.x,"_",n.y,""),Ts(1),na("points",r.getHexaCoordsAt(n)),Ts(1),la("ngIf",e.getSize()>0),Ts(1),la("ngIf",e.containsSource()),Ts(1),la("ngIf",e.getSize()>1)}}const G0=function(e){return[e]};function q0(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,H0,5,6,"g",4),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",au(1,G0,n.state.getPieceAt(e)))}}function W0(e,t){if(1&e&&(Cn(),ha(0,"text",16),Da(1),da()),2&e){const e=wa().$implicit,t=wa();na("x",t.getCenterAt(e.coord).x)("y",t.getCenterAt(e.coord).y),Ts(1),La(e.caseContent.getSize())}}function j0(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"polyline",13),fa(2,"circle",14),oa(3,W0,2,3,"text",15),da()),2&e){const e=t.$implicit,n=wa();Ts(1),na("points",n.getHexaCoordsAt(e.coord)),Ts(1),Oa("id","captured_",e.coord.x,"_",e.coord.y,""),la("ngClass",n.getPieceClasses(e.caseContent)),na("cx",n.getCenterAt(e.coord).x)("cy",n.getCenterAt(e.coord).y)("r",n.SPACE_SIZE),Ts(1),la("ngIf",e.caseContent.getSize()>1)}}function Z0(e,t){if(1&e&&(Cn(),pa(0),fa(1,"polyline",17),fa(2,"polyline",17),ga()),2&e){const e=wa();Ts(1),na("points",e.getHexaCoordsAt(e.lastMove.get().coord)),Ts(1),na("points",e.getHexaCoordsAt(e.lastMove.get().end))}}function Y0(e,t){if(1&e&&(Cn(),fa(0,"polyline",18)),2&e){const e=wa();na("points",e.getHexaCoordsAt(e.chosen.get()))}}let K0=(()=>{class e extends nQ{constructor(e){super(e),this.lastMove=gw.empty(),this.chosen=gw.empty(),this.disconnecteds=[],this.rules=new T0(S0),this.availableMinimaxes=[new I0(this.rules,"DvonnMinimax"),new k0(this.rules,"DvonnMinimaxMaximizeStacks")],this.encoder=P0.encoder,this.tutorial=(new U0).tutorial,this.SPACE_SIZE=30,this.canPass=!1,this.scores=gw.of(T0.getScores(this.rules.node.gameState)),this.hexaLayout=new sQ(1.5*this.SPACE_SIZE,new eQ(-this.SPACE_SIZE,2*this.SPACE_SIZE),aQ.INSTANCE),this.state=this.rules.node.gameState,this.hexaBoard=this.rules.node.gameState.board}hideLastMove(){this.lastMove=gw.empty()}updateBoard(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=gw.of(T0.getScores(this.state))}calculateDisconnecteds(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState;for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[n].length;r++){const i=new eQ(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){const s=t.getPieceAt(i),o=e.getPieceAt(i);if(s.isEmpty()&&!o.isEmpty()){const e={coord:new eQ(r,n),caseContent:o};this.disconnecteds.push(e)}}}}cancelMoveAttempt(){this.chosen=gw.empty()}pass(){var e=this;return lw(function*(){return VG(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),yield e.chooseMove(P0.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosen.isAbsent()?n.choosePiece(e,t):n.chosen.equalsValue(new eQ(e,t))?(n.cancelMoveAttempt(),DG.SUCCESS):yield n.chooseDestination(e,t)})()}choosePiece(e,t){const n=new eQ(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=gw.of(n),DG.SUCCESS):this.cancelMove(r.getReason())}chooseDestination(e,t){var n=this;return lw(function*(){const r=n.chosen.get(),i=new eQ(e,t),s=P0.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];const t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-dvonn"]],features:[Ho],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,q0,2,3,"g",1),oa(2,j0,4,8,"g",1),oa(3,Z0,3,2,"ng-container",2),oa(4,Y0,1,1,"polyline",3),da()),2&e&&(Ts(1),la("ngForOf",t.state.allCoords()),Ts(1),la("ngForOf",t.disconnecteds),Ts(1),la("ngIf",t.lastMove.isPresent()),Ts(1),la("ngIf",t.chosen.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();var J0=(()=>(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(J0||(J0={})),J0))();class Q0{constructor(e){this.value=e}static of(e){switch(e){case 0:return this.SMALL_BLACK;case 1:return this.SMALL_WHITE;case 2:return this.MEDIUM_BLACK;case 3:return this.MEDIUM_WHITE;case 4:return this.BIG_BLACK;case 5:return this.BIG_WHITE;case 6:return this.NONE;default:throw new Error("Invalid value "+e+" for EncapsulePiece")}}static ofSizeAndPlayer(e,t){return t===jY.ZERO&&e===J0.BIG?Q0.BIG_BLACK:t===jY.ZERO&&e===J0.MEDIUM?Q0.MEDIUM_BLACK:t===jY.ZERO&&e===J0.SMALL?Q0.SMALL_BLACK:t===jY.ONE&&e===J0.BIG?Q0.BIG_WHITE:t===jY.ONE&&e===J0.MEDIUM?Q0.MEDIUM_WHITE:t===jY.ONE&&e===J0.SMALL?Q0.SMALL_WHITE:Q0.NONE}getPlayer(){switch(this){case Q0.SMALL_BLACK:case Q0.MEDIUM_BLACK:case Q0.BIG_BLACK:return jY.ZERO;case Q0.SMALL_WHITE:case Q0.MEDIUM_WHITE:case Q0.BIG_WHITE:return jY.ONE;default:return ZY.NONE}}getSize(){switch(this){case Q0.BIG_BLACK:case Q0.BIG_WHITE:return J0.BIG;case Q0.MEDIUM_BLACK:case Q0.MEDIUM_WHITE:return J0.MEDIUM;case Q0.SMALL_BLACK:case Q0.SMALL_WHITE:return J0.SMALL;default:return uw.expectToBe(this,Q0.NONE),J0.NONE}}belongsTo(e){return this.getPlayer()===e}equals(e){return this===e}toString(){switch(this){case Q0.BIG_BLACK:return"BIG_BLACK";case Q0.BIG_WHITE:return"BIG_WHITE";case Q0.MEDIUM_BLACK:return"MEDIUM_BLACK";case Q0.MEDIUM_WHITE:return"MEDIUM_WHITE";case Q0.SMALL_BLACK:return"SMALL_BLACK";case Q0.SMALL_WHITE:return"SMALL_WHITE";default:return uw.expectToBe(this,Q0.NONE),"NONE"}}}Q0.SMALL_BLACK=new Q0(0),Q0.SMALL_WHITE=new Q0(1),Q0.MEDIUM_BLACK=new Q0(2),Q0.MEDIUM_WHITE=new Q0(3),Q0.BIG_BLACK=new Q0(4),Q0.BIG_WHITE=new Q0(5),Q0.NONE=new Q0(6);class X0 extends gQ{constructor(e,t,n){super(e,t),this.remainingPieces=n}static getInitialState(){const e=new e2(ZY.NONE,ZY.NONE,ZY.NONE).encode(),t=QY.createTable(3,3,e),n=QY.mapBiArray(t,e=>e2.decode(e));return new X0(n,0,[Q0.BIG_BLACK,Q0.BIG_BLACK,Q0.BIG_WHITE,Q0.BIG_WHITE,Q0.MEDIUM_BLACK,Q0.MEDIUM_BLACK,Q0.MEDIUM_WHITE,Q0.MEDIUM_WHITE,Q0.SMALL_BLACK,Q0.SMALL_BLACK,Q0.SMALL_WHITE,Q0.SMALL_WHITE])}getRemainingPieces(){return QY.copyImmutableArray(this.remainingPieces)}getRemainingPiecesOfPlayer(e){return this.getRemainingPieces().filter(t=>t.getPlayer()===e)}pieceBelongsToCurrentPlayer(e){return e.belongsTo(this.getCurrentPlayer())}isDroppable(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}isInRemainingPieces(e){return this.remainingPieces.some(t=>t===e)}getPlayerRemainingPieces(){return this.remainingPieces.filter(e=>this.pieceBelongsToCurrentPlayer(e))}}class e2{constructor(e,t,n){this.small=e,this.medium=t,this.big=n}static decode(e){VG(e%1==0,"EncapsuleCase must be encoded as integer: "+e),VG(e>=0,"To small representation for EncapsuleCase: "+e),VG(e<=26,"To big representation for EncapsuleCase: "+e);const t=jY.numberEncoder.decodeNumber(e%3);e-=t.value;const n=jY.numberEncoder.decodeNumber((e/=3)%3);e-=n.value;const r=jY.numberEncoder.decodeNumber(e/=3);return new e2(t,n,r)}isEmpty(){return this.small===ZY.NONE&&this.medium===ZY.NONE&&this.big===ZY.NONE}toList(){const e=[];return this.small.isPlayer()&&e.push(Q0.ofSizeAndPlayer(J0.SMALL,this.small)),this.medium.isPlayer()&&e.push(Q0.ofSizeAndPlayer(J0.MEDIUM,this.medium)),this.big.isPlayer()&&e.push(Q0.ofSizeAndPlayer(J0.BIG,this.big)),e}toOrderedPieceNames(){const e=Q0.ofSizeAndPlayer(J0.SMALL,this.small),t=Q0.ofSizeAndPlayer(J0.MEDIUM,this.medium),n=Q0.ofSizeAndPlayer(J0.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}getBiggest(){return this.big===jY.ZERO?Q0.BIG_BLACK:this.big===jY.ONE?Q0.BIG_WHITE:this.medium===jY.ZERO?Q0.MEDIUM_BLACK:this.medium===jY.ONE?Q0.MEDIUM_WHITE:this.small===jY.ZERO?Q0.SMALL_BLACK:this.small===jY.ONE?Q0.SMALL_WHITE:Q0.NONE}tryToSuperposePiece(e){const t=this.getBiggest().getSize();if(e===Q0.NONE)throw new Error("Cannot move NONE on a space");return e.getSize()>t?gw.of(this.put(e)):gw.empty()}removeBiggest(){const e=this.getBiggest();if(e===Q0.NONE)throw new Error("Cannot removed piece from empty space");let t;const n=e.getSize();switch(n){case J0.BIG:t=new e2(this.small,this.medium,ZY.NONE);break;case J0.MEDIUM:t=new e2(this.small,ZY.NONE,ZY.NONE);break;default:uw.expectToBe(n,J0.SMALL),t=new e2(ZY.NONE,ZY.NONE,ZY.NONE)}return{removedCase:t,removedPiece:e}}put(e){if(e===Q0.NONE)throw new Error("Cannot put NONE on space");const t=e.getPlayer(),n=e.getSize();switch(n){case J0.BIG:return new e2(this.small,this.medium,t);case J0.MEDIUM:return VG(this.big===ZY.NONE,"Cannot put a piece on top of a bigger one"),new e2(this.small,t,this.big);default:return uw.expectToBe(n,J0.SMALL),VG(this.big===ZY.NONE,"Cannot put a piece on top of a bigger one"),VG(this.medium===ZY.NONE,"Cannot put a piece on top of a bigger one"),new e2(t,this.medium,this.big)}}encode(){return this.small.value+3*this.medium.value+9*this.big.value}belongsTo(e){return this.getBiggest().getPlayer()===e}toString(){const e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}e2.EMPTY=new e2(ZY.NONE,ZY.NONE,ZY.NONE);let t2=(()=>{class e{}return e.PIECE_OUT_OF_STOCK=()=>$localize`You do not have pieces of this type anymore.`,e.INVALID_PLACEMENT=()=>$localize`You must put your piece on an empty square or on a smaller piece.`,e.NOT_DROPPABLE=()=>$localize`You must pick your piece among the remaining ones.`,e.INVALID_PIECE_SELECTED=()=>$localize`You must pick one of your remaining pieces or one piece on the board that is the biggest of its square.`,e.SAME_DEST_AS_ORIGIN=()=>$localize`You must select a different landing square than the square where the move originates from.`,e.END_YOUR_MOVE=()=>$localize`You are performing a move, you must select a landing square.`,e})();class n2 extends OQ{static isVictory(e){const t=e.getCopiedBoard();for(const n of n2.LINES){const e=n2.isVictoriousLine([t[n[0].y][n[0].x],t[n[1].y][n[1].x],t[n[2].y][n[2].x]]);if(e.isPresent())return e}return gw.empty()}static isVictoriousLine(e){const t=e.map(e=>e.getBiggest()).map(e=>e.getPlayer());return t[0]===ZY.NONE?gw.empty():t[0]===t[1]&&t[1]===t[2]?gw.of(t[0]):gw.empty()}static isLegal(e,t){let n;if(hw(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return MG.failure(t2.PIECE_OUT_OF_STOCK())}else{const r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE())}const r=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return r.isPresent()?MG.success(r.get()):MG.failure(t2.INVALID_PLACEMENT())}isLegal(e,t){return n2.isLegal(e,t)}applyLegalMove(e,t,n){const r=t.getCopiedBoard();let i=t.getRemainingPieces();const s=t.turn+1;let o;if(r[e.landingCoord.y][e.landingCoord.x]=e2.decode(n.encode()),e.isDropping()){o=e.piece.get();const t=i.indexOf(o);i=i.slice(0,t).concat(i.slice(t+1))}else{const t=e.startingCoord.get(),n=r[t.y][t.x].encode(),i=e2.decode(n).removeBiggest();r[t.y][t.x]=e2.decode(i.removedCase.encode()),o=i.removedPiece}return new X0(r,s,i)}static getGameStatus(e){const t=n2.isVictory(e.gameState);return t.isPresent()?PQ.getVictory(t.get()):PQ.ONGOING}getGameStatus(e){return n2.getGameStatus(e)}}n2.LINES=[[new eQ(0,0),new eQ(0,1),new eQ(0,2)],[new eQ(1,0),new eQ(1,1),new eQ(1,2)],[new eQ(2,0),new eQ(2,1),new eQ(2,2)],[new eQ(0,0),new eQ(1,0),new eQ(2,0)],[new eQ(0,1),new eQ(1,1),new eQ(2,1)],[new eQ(0,2),new eQ(1,2),new eQ(2,2)],[new eQ(0,0),new eQ(1,1),new eQ(2,2)],[new eQ(0,2),new eQ(1,1),new eQ(2,0)]];class r2 extends yQ{constructor(e,t,n){super(),this.startingCoord=e,this.landingCoord=t,this.piece=n}static fromMove(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new r2(gw.of(e),t,gw.empty())}static fromDrop(e,t){return new r2(gw.empty(),t,gw.of(e))}isDropping(){return this.startingCoord.isAbsent()}equals(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}toString(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}r2.encoder=new class extends qY{maxValue(){return 161}encodeNumber(e){const t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){const r=0;return 18*e.piece.get().value+6*t+2*n+r}{const r=1,i=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*i+6*t+2*n+r}}decodeNumber(e){const t=e%2;e-=t;const n=(e/=2)%3;e-=n;const r=(e/=3)%3;e-=r,e/=3;const i=new eQ(r,n);if(0===t){const t=Q0.of(e);return r2.fromDrop(t,i)}{const t=e%3;e-=t;const n=new eQ((e/=3)%3,t);return r2.fromMove(n,i)}}};class i2 extends uQ{getBoardValue(e){const t=n2.getGameStatus(e);return new hQ(t.toBoardValue())}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),s=dQ.toComparableObjectSet(n.getPlayerRemainingPieces());for(let o=0;o<3;o++)for(let e=0;e<3;e++){const a=new eQ(e,o);for(const e of s){const r=r2.fromDrop(e,a);n2.isLegal(r,n).isSuccess()&&t.push(r)}if(r[o][e].belongsTo(i))for(let e=0;e<3;e++)for(let r=0;r<3;r++){const i=new eQ(r,e);if(!i.equals(a)){const e=r2.fromMove(a,i);n2.isLegal(e,n).isSuccess()&&t.push(e)}}}return t}}const s2=new e2(ZY.NONE,ZY.NONE,ZY.NONE),o2=new e2(jY.ZERO,ZY.NONE,ZY.NONE),a2=new e2(ZY.NONE,jY.ZERO,ZY.NONE),c2=new e2(ZY.NONE,ZY.NONE,jY.ZERO),l2=new e2(jY.ONE,ZY.NONE,ZY.NONE),u2=new e2(ZY.NONE,ZY.NONE,jY.ONE),h2=new e2(jY.ONE,jY.ZERO,ZY.NONE),d2=new e2(jY.ZERO,jY.ZERO,ZY.NONE);class f2{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`The goal of Encapsule is to align three of your pieces.
        Here, we have a victory of the dark player.`,new X0([[o2,l2,u2],[s2,a2,s2],[s2,s2,c2]],0,[Q0.SMALL_BLACK,Q0.MEDIUM_BLACK,Q0.BIG_BLACK,Q0.SMALL_WHITE,Q0.MEDIUM_WHITE,Q0.MEDIUM_WHITE,Q0.BIG_WHITE])),AQ.anyMove($localize`Putting a piece`,$localize`This is the initial board. You're playing Dark.<br/><br/>
        Pick one of your piece on the side of the board and put it on the board.`,X0.getInitialState(),r2.fromDrop(Q0.SMALL_BLACK,new eQ(1,1)),$localize`Congratulations!`),AQ.fromMove($localize`Moving`,$localize`Another possible action is to move one of your pieces that is already on the board.<br/><br/>
        Click on your dark piece and then on any empty square of the board.`,new X0([[o2,u2,s2],[s2,s2,s2],[s2,s2,s2]],0,[]),[r2.fromMove(new eQ(0,0),new eQ(2,0)),r2.fromMove(new eQ(0,0),new eQ(0,1)),r2.fromMove(new eQ(0,0),new eQ(1,1)),r2.fromMove(new eQ(0,0),new eQ(2,1)),r2.fromMove(new eQ(0,0),new eQ(0,2)),r2.fromMove(new eQ(0,0),new eQ(1,2)),r2.fromMove(new eQ(0,0),new eQ(2,2))],$localize`Congratulations!`,$localize`Failed. Try again.`),AQ.fromPredicate($localize`Particularity`,$localize`At Encapsule, pieces encapsulate each other.
        It is therefore possible to have up to three pieces per square!
        However, only the biggest piece of each square counts:
        you cannot win with a piece that is "hidden" by a bigger piece.
        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.
        Finally, you cannot encapsulate a piece with a smaller piece.
        You're playing Dark and you can win now in various ways.<br/><br/>
        Try to win by making a move, and not by putting a new piece on the board.`,new X0([[h2,s2,l2],[d2,u2,u2],[s2,s2,s2]],0,[Q0.MEDIUM_BLACK,Q0.BIG_BLACK,Q0.MEDIUM_WHITE,Q0.MEDIUM_WHITE]),r2.fromMove(new eQ(0,1),new eQ(0,2)),(e,t)=>{if(e.landingCoord.equals(new eQ(0,2))){if(e.isDropping())return DG.failure($localize`You won, but the exercise is to win while moving a piece!`);if(e.startingCoord.equalsValue(new eQ(0,1)))return DG.SUCCESS}return DG.failure($localize`Failed. Try again.`)},$localize`Congratulations!`)]}}function p2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",5),_a("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return wa().onPieceClick(0,n,r)}),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa();Ts(1),Pa("id","piece_0_",e.toString(),""),la("ngClass",r.getSidePieceClasses(e,n)),na("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(0,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}function g2(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",8),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onBoardClick(t,n)}),da()}if(2&e){const e=t.$implicit,n=wa().index,r=wa().index,i=wa();la("ngClass",i.getPieceClasses(e)),na("r",i.getPieceRadius(e))("cx",i.SPACE_SIZE*n+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function m2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",6),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onBoardClick(t,n)}),da(),oa(2,g2,1,4,"circle",7),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","click_",n,"_",r,""),la("ngClass",i.getRectClasses(n,r)),na("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngForOf",i.getListPieces(e))}}function y2(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,m2,3,8,"g",2),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function v2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",9),_a("click",function(){const t=Gt(e).$implicit;return wa().onBoardClick(t.x,t.y)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),na("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function _2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",5),_a("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return wa().onPieceClick(1,n,r)}),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa();Ts(1),Pa("id","piece_1_",e.toString(),""),la("ngClass",r.getSidePieceClasses(e,n)),na("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(1,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}let C2=(()=>{class e extends hX{constructor(e){super(e),this.INTER_PIECE_SPACE=20,this.lastLandingCoord=gw.empty(),this.lastStartingCoord=gw.empty(),this.chosenCoord=gw.empty(),this.chosenPiece=gw.empty(),this.remainingPieceLeftX=[],this.rules=new n2(X0),this.availableMinimaxes=[new i2(this.rules,"EncapsuleMinimax")],this.encoder=r2.encoder,this.tutorial=(new f2).tutorial,this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard();const e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=gw.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=gw.empty(),this.lastStartingCoord=gw.empty())}getListPieces(e){return e.toList()}getRemainingPieces(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(jY.of(e))}onBoardClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new eQ(e,t),s=n.rules.node.gameState;if(n.chosenCoord.isAbsent()){if(n.chosenCoord=gw.of(i),n.chosenPiece.isPresent()){const e=r2.fromDrop(n.chosenPiece.get(),i);return n.chooseMove(e,n.rules.node.gameState)}return!1===s.getPieceAt(i).belongsTo(s.getCurrentPlayer())?n.cancelMove(t2.INVALID_PIECE_SELECTED()):DG.SUCCESS}if(n.chosenCoord.equalsValue(i))return n.cancelMove(t2.SAME_DEST_AS_ORIGIN());{const e=r2.fromMove(n.chosenCoord.get(),i);return n.chooseMove(e,n.rules.node.gameState)}})()}cancelMoveAttempt(){this.chosenCoord=gw.empty(),this.chosenPiece=gw.empty(),this.chosenPieceIndex=-1}onPieceClick(e,t,n){var r=this;return lw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t.toString());return i.isFailure()?r.cancelMove(i.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(t2.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=gw.of(t),r.chosenPieceIndex=n,DG.SUCCESS):r.cancelMove(t2.END_YOUR_MOVE())})()}getRectClasses(e,t){return this.isSelected(e,t)?"moved":""}isSelected(e,t){const n=new eQ(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}getPieceClasses(e){return[this.getPieceStrokeClass(e)]}getPieceStrokeClass(e){const t=e.getPlayer();return VG(t.isPlayer(),"EncapsuleComponent.getPieceStrokeClass should only be called with actual pieces!"),"player"+t.value+"-stroke"}getPieceRadius(e){switch(e.getSize()){case J0.BIG:return 40;case J0.MEDIUM:return 30;default:return uw.expectToBe(e.getSize(),J0.SMALL),20}}getHighlightedCases(){const e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}getSidePieceClasses(e,t){const n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}isSelectedPiece(e){return this.chosenPiece.equalsValue(e)}calculateLeftX(){this.remainingPieceLeftX=[];for(let e=0;e<=1;e++){this.remainingPieceLeftX.push([]);const t=this.getRemainingPieces(e);for(let n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{const r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}getPieceLeftX(e,t){return this.remainingPieceLeftX[e][t]}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-encapsule"]],features:[Ho],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"g",null,1),oa(3,p2,2,5,"g",2),da(),ha(4,"g",null,3),oa(6,y2,2,1,"g",2),oa(7,v2,2,4,"g",2),da(),ha(8,"g",null,4),oa(10,_2,2,5,"g",2),da(),da()),2&e&&(Ts(1),na("transform","translate("+t.STROKE_WIDTH+", 0)"),Ts(2),la("ngForOf",t.getRemainingPieces(0)),Ts(1),na("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),Ts(2),la("ngForOf",t.board),Ts(1),la("ngForOf",t.getHighlightedCases()),Ts(1),na("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),Ts(2),la("ngForOf",t.getRemainingPieces(1)))},directives:[Ud,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class E2 extends vQ{constructor(e,t,n,r,i){if(super(e,t),this.movedPieces=n,this.stepSize=r,this.direction=i,this.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+this.coord.toString()+".");if(n<1)throw new Error("Must select minimum one piece (got "+n+").");if(r<1)throw new Error("Step size must be minimum one (got "+r+").");if(r>n)throw new Error("Cannot move a phalanx further than its size (got step size "+r+" for "+n+" pieces).")}toString(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}equals(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}E2.encoder=new class extends qY{maxValue(){return 122303}encodeNumber(e){const t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%8;e-=t;const n=(e/=8)%7;e-=n;const r=(e/=7)%13;e-=r;const i=(e/=13)%12;e-=i;const s=e/=12,o=QJ.factory.fromInt(t);return new E2(s,i,r+1,n+1,o.get())}};class w2 extends gQ{static getInitialState(){const e=ZY.NONE,t=jY.ONE,n=jY.ZERO;return new w2([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[n,n,n,n,n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n,n,n,n,n]],0)}count(e,t){let n=0;for(let r=0;r<14;r++)this.board[t][r]===e&&n++;return n}doesOwnPiece(e){for(let t=0;t<12;t++)for(let n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}let b2=(()=>{class e{}return e.PHALANX_IS_LEAVING_BOARD=()=>$localize`The move distance of your phalanx puts it out of the board.`,e.SOMETHING_IN_PHALANX_WAY=()=>$localize`There is something in the way of your phalanx.`,e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=()=>$localize`Your phalanx must be bigger than the one you are capturing.`,e.CASE_NOT_ALIGNED_WITH_SELECTED=()=>$localize`This square is not aligned with the selected piece.`,e.SINGLE_PIECE_MUST_MOVE_BY_ONE=()=>$localize`A single piece can only move by one square.`,e.SINGLE_PIECE_CANNOT_CAPTURE=()=>$localize`A single piece cannot make a capture.`,e.CASE_NOT_ALIGNED_WITH_PHALANX=()=>$localize`This square is not aligned with the direction of the phalanx.`,e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=()=>$localize`A phalanx can't contain pieces outside of the board.`,e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=()=>$localize`A phalanx cannot contain an empty square.`,e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=()=>$localize`A phalanx cannot contain a piece of the opponent.`,e})();class S2 extends OQ{static isLegal(e,t){const n=this.getPhalanxValidity(t,e);if(n.isFailure())return MG.failure(n.getReason());const r=this.getLandingStatus(t,e);if(r.isFailure())return r;const i=QY.copyBiArray(r.get()),s=t.getCurrentOpponent(),o=S2.getCaptureValidity(t,i,e,s);return o.isFailure()?o:MG.success(o.get())}static getPhalanxValidity(e,t){let n=t.coord,r=0;const i=e.getCurrentOpponent();for(;r<t.movedPieces;){if(n.isNotInRange(14,12))return DG.failure(b2.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());const s=e.getPieceAt(n);if(s===ZY.NONE)return DG.failure(b2.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(s===i)return DG.failure(b2.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());n=n.getNext(t.direction,1),r++}return DG.SUCCESS}static getLandingStatus(e,t){const n=e.getCopiedBoard(),r=e.getCurrentPlayer();let i=t.coord,s=t.coord.getNext(t.direction,t.movedPieces),o=0;for(;o+1<t.stepSize;){if(n[i.y][i.x]=ZY.NONE,n[s.y][s.x]=r,s.isNotInRange(14,12))return MG.failure(b2.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(s).isPlayer())return MG.failure(b2.SOMETHING_IN_PHALANX_WAY());o++,s=s.getNext(t.direction,1),i=i.getNext(t.direction,1)}return s.isNotInRange(14,12)?MG.failure(b2.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(s)===r?MG.failure(lQ.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=ZY.NONE,n[s.y][s.x]=r,MG.success(n))}static getCaptureValidity(e,t,n,r){let i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1),s=0;for(;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(s>0&&(t[i.y][i.x]=ZY.NONE),s++,s>=n.movedPieces)return MG.failure(b2.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return MG.success(t)}isLegal(e,t){return S2.isLegal(e,t)}applyLegalMove(e,t,n){return new w2(n,t.turn+1)}getGameStatus(e){const t=e.gameState,n=t.count(jY.ZERO,0),r=t.count(jY.ONE,11);if(t.turn%2==0){if(n>r)return PQ.ZERO_WON}else if(r>n)return PQ.ONE_WON;return!1===t.doesOwnPiece(jY.ZERO)?PQ.ONE_WON:!1===t.doesOwnPiece(jY.ONE)?PQ.ZERO_WON:PQ.ONGOING}}class P2 extends uQ{static getListMoves(e){const t=e.gameState.getCurrentPlayer(),n=e.gameState.getCurrentOpponent(),r=ZY.NONE;let i=[];const s=e.gameState;let o;for(let a=0;a<12;a++)for(let e=0;e<14;e++){const c=new eQ(e,a);if(s.getPieceAt(c)===t)for(const l of QJ.DIRECTIONS){let u=1,h=c.getNext(l,1);for(;h.isInRange(14,12)&&s.getPieceAt(h)===t;)u+=1,h=h.getNext(l,1);let d=1;for(;h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===r;)o=new E2(e,a,u,d,l),i=this.addMove(i,o,s),d++,h=h.getNext(l,1);h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===n&&(o=new E2(e,a,u,d,l),i=this.addMove(i,o,s))}}return i}static addMove(e,t,n){return S2.isLegal(t,n).isSuccess()&&e.push(t),e}getListMoves(e){const t=P2.getListMoves(e);return QY.sortByDescending(t,e=>e.stepSize),t}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new hQ(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}getPieceCountPlusRowDomination(e){let t=0;for(let n=0;n<12;n++){let r=0;const i=[0,0];for(let s=0;s<14;s++){const o=new eQ(s,n),a=e.getPieceAt(o);if(a.isPlayer()){const n=a.getScoreModifier();t+=2002*n,i[a.value]=n,r+=n;for(const r of[QJ.UP_LEFT,QJ.UP,QJ.UP_RIGHT]){let i=o.getNext(r,1);for(;i.isInRange(14,12)&&e.getPieceAt(i)===a;)t+=1*n,i=i.getNext(r,1)}}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce((e,t)=>e+t)}return t}}class O2 extends uQ{getListMoves(e){const t=P2.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}orderMovesByPhalanxSizeAndFilter(e,t){return QY.sortByDescending(e,e=>e.movedPieces),e.length>40?e.filter(e=>!!this.moveIsCapture(e,t)||e.movedPieces*Math.random()>1):e}moveIsCapture(e,t){const n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new hQ(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}getPieceCountThenSupportThenAdvancement(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=new eQ(r,n),s=e.getPieceAt(i);if(s.isPlayer()){let r,o;s===jY.ZERO?(r=12-n,o=[QJ.UP_LEFT,QJ.UP,QJ.UP_RIGHT]):(r=n+1,o=[QJ.DOWN_LEFT,QJ.DOWN,QJ.DOWN_RIGHT]);const a=s.getScoreModifier();t+=r*a,t+=149629*a;for(const n of o){let r=i.getNext(n,1);for(;r.isInRange(14,12)&&e.getPieceAt(r)===s;)t+=337*a,r=r.getNext(n,1)}}}return t}}class T2 extends P2{constructor(){super(...arguments),this.DOMINANCE_FACTOR=20,this.DEFENSE_FACTOR=5,this.TERRITORY_FACTOR=2,this.OFFENSE_FACTOR=10,this.CENTER_FACTOR=5,this.MOBILITY_FACTOR=.12}getDominance(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new eQ(r,n));i.isPlayer()&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}getDefense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new eQ(n,11))===jY.ZERO&&(t+=jY.ZERO.getScoreModifier()),e.getPieceAt(new eQ(n,0))===jY.ONE&&(t+=jY.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}getTerritory(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new eQ(r,n));if(i.isPlayer()){for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const a=new eQ(r+s,n+o);if(a.isInRange(14,12)){const n=e.getPieceAt(a);(n===i||n===ZY.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}getOffense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new eQ(n,0))===jY.ZERO&&(t+=jY.ZERO.getScoreModifier()),e.getPieceAt(new eQ(n,11))===jY.ONE&&(t+=jY.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}getCenter(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new eQ(r,n));i.isPlayer()&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}getMobility(e){let t=0,n=0,r=0;for(let i=0;i<12;i++)for(let s=0;s<14;s++){const o=new eQ(s,i),a=e.getPieceAt(o);if(a.isPlayer())for(const i of QJ.DIRECTIONS){let s=1,c=o.getNext(i,1);for(;c.isInRange(14,12)&&e.getPieceAt(c)===a;)s+=1,c=c.getNext(i,1);let l=1;for(;c.isInRange(14,12)&&l<=s&&e.getPieceAt(c)===ZY.NONE;)l++,c=c.getNext(i,1);t+=l*l*a.getScoreModifier(),a===jY.ZERO?n=Math.max(n,l):a===jY.ONE&&(r=Math.max(r,l))}}return(t+n*jY.ZERO.getScoreModifier()+r*jY.ONE.getScoreModifier())*this.MOBILITY_FACTOR}getBoardValue(e){const t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new hQ(n.toBoardValue());const r=this.getDominance(t),i=this.getDefense(t),s=this.getTerritory(t),o=this.getCenter(t),a=this.getOffense(t),c=this.getMobility(t);return new hQ(r+i+s+o+a+c)}}const I2=ZY.NONE,k2=jY.ZERO,A2=jY.ONE;class N2{constructor(){this.tutorial=[AQ.informational($localize`Initial board`,$localize`This is the initial board of Epaminondas.
        The top line is the starting line of Light.
        The bottom line is the starting line of Dark.`,w2.getInitialState()),AQ.informational($localize`Goal of the game (1/2)`,$localize`After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line
        than the number of pieces the opponent has on the player's starting line, the player wins.
        Here, it's Dark's turn to play: Dark has therefore won.`,new w2([[I2,I2,I2,I2,I2,k2,I2,I2,A2,A2,A2,A2,A2,A2],[I2,I2,I2,I2,I2,k2,I2,I2,I2,I2,I2,I2,A2,A2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,A2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,k2,k2,k2,k2,I2,I2,I2]],0)),AQ.informational($localize`Goal of the game (2/2)`,$localize`Here, it is Light's turn.
        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line.`,new w2([[I2,I2,I2,I2,I2,k2,I2,I2,I2,I2,A2,A2,A2,A2],[I2,I2,I2,I2,I2,k2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,A2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,A2,A2,I2,I2,I2,k2,k2,I2,k2,k2,k2,k2]],1)),AQ.fromPredicate($localize`Moving a piece`,$localize`Here is the starting board. Dark plays first.
        Let's start with moving a single piece:
        <ol>
            <li>Click on a piece.</li>
            <li>Click on a empty neighboring square.</li>
        </ol>`,w2.getInitialState(),new E2(0,10,1,1,QJ.UP),(e,t)=>1===e.movedPieces?DG.SUCCESS:DG.failure($localize`Congratulations, you are in advance. But this is not the exercise here, try again.`),$localize`This is how you move a single piece.`),AQ.fromPredicate($localize`Moving a phalanx`,$localize`Let us now see how to move multiple pieces along a line, which is called a phalanx:
        <ol>
            <li>Click on the first piece of the phalanx.</li>
            <li>Click on the last piece of the phalanx.</li>
            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>
        </ol><br/>
        Move a phalanx!`,w2.getInitialState(),new E2(0,11,2,1,QJ.UP),(e,t)=>e.movedPieces>1?DG.SUCCESS:DG.failure($localize`Failed! You moved only one piece.`),$localize`Congratulations!
        The moved pieces can be horizontally, vertically, or diagonally aligned.
        The move should be made along this axis, forward or backwards.
        There can be no opponent nor holes in the phalanx.`),AQ.fromMove($localize`Capture`,$localize`In order to capture pieces of the opponent:
        <ol>
            <li>It must be aligned with the phalanx you are moving.</li>
            <li>It must be strictly shorter than your phalanx.</li>
            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>
        </ol><br/>
        Capture a phalanx.`,new w2([[I2,I2,I2,I2,I2,I2,I2,I2,A2,A2,A2,A2,A2,A2],[I2,I2,I2,I2,I2,I2,A2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,A2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,A2,I2,A2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,A2,A2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,A2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,k2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,k2,I2,I2,I2,I2,A2,I2,I2,I2,I2,I2,I2],[I2,I2,k2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,k2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2,I2],[I2,I2,I2,I2,I2,I2,I2,k2,k2,k2,k2,k2,k2,k2]],0),[new E2(2,10,4,2,QJ.UP)],$localize`Congratulations, you made it!
        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment.`,$localize`Failed, you have not captured the phalanx.`)]}}function M2(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",4),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa().index,t=wa().index,n=wa();la("ngClass",n.getPieceClasses(e,t)),na("r",.5*(n.SPACE_SIZE-2*n.STROKE_WIDTH))("cx",n.SPACE_SIZE*e+n.STROKE_WIDTH+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.STROKE_WIDTH+n.SPACE_SIZE/2)}}function x2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",2),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,M2,1,4,"circle",3),da()}if(2&e){const e=t.index,n=wa().index,r=wa();Ts(1),Oa("id","click_",e,"_",n,""),la("ngClass",r.getRectClasses(e,n)),na("x",r.SPACE_SIZE*e+r.STROKE_WIDTH)("y",r.SPACE_SIZE*n+r.STROKE_WIDTH)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),la("ngIf",r.board[n][e]!==r.NONE)}}function R2(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,x2,3,8,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function D2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",5),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.x,t.y)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),na("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let L2=(()=>{class e extends hX{constructor(e){super(e),this.NONE=ZY.NONE,this.firstPiece=gw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=gw.empty(),this.phalanxDirection=gw.empty(),this.phalanxMiddles=[],this.moveds=[],this.captureds=[],this.rules=new S2(w2),this.availableMinimaxes=[new P2(this.rules,"Normal"),new O2(this.rules,"Positional"),new T2(this.rules,"Attack")],this.encoder=E2.encoder,this.tutorial=(new N2).tutorial,this.updateBoard()}updateBoard(){this.firstPiece=gw.empty(),this.lastPiece=gw.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}showPreviousMove(){const e=this.rules.node.move.get();let t=e.coord;this.moveds=[t];for(let i=1;i<e.stepSize+e.movedPieces;i++)t=t.getNext(e.direction,1),this.moveds.push(t);const n=this.rules.node.mother.get(),r=n.gameState.getCurrentOpponent();for(;t.isInRange(14,12)&&n.gameState.getPieceAt(t)===r;)this.captureds.push(t),t=t.getNext(e.direction,1)}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t)})()}firstClick(e,t){var n=this;return lw(function*(){const r=n.rules.node.gameState.getCurrentOpponent(),i=n.rules.node.gameState.getCurrentPlayer();switch(n.board[t][e]){case i:return n.firstPiece=gw.of(new eQ(e,t)),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),DG.SUCCESS;case r:return n.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE());default:return uw.expectToBe(n.board[t][e],ZY.NONE),n.cancelMove(lQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())}})()}hidePreviousMove(){this.captureds=[],this.moveds=[]}getValidExtensions(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}getFirstPieceExtensions(e){const t=[];for(const n of QJ.DIRECTIONS){let r=this.firstPiece.get().getNext(n,1);for(;r.isInRange(14,12)&&this.board[r.y][r.x]===e;)t.push(r),r=r.getNext(n,1)}return t}getPhalanxValidExtensions(e){let t=QJ.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get();const n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();const i=this.firstPiece.get().getNext(t,1),s=this.getExtensionsToward(i,t,e);return r.concat(s)}getExtensionsToward(e,t,n){const r=[];for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}getPhalanxValidLandings(){if(this.lastPiece.isPresent()){const e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1;let s=QJ.factory.fromMove(e,t).get();const o=t.getNext(s,1),a=this.getLandingsToward(o,s,i);s=s.getOpposite();const c=e.getNext(s,1);return this.getLandingsToward(c,s,i).concat(a)}return this.getNeighbooringEmptyCases()}getNeighbooringEmptyCases(){const e=[];for(const t of QJ.DIRECTIONS){const n=this.firstPiece.get().getNext(t,1);n.isInRange(14,12)&&this.board[n.y][n.x]===ZY.NONE&&e.push(n)}return e}getLandingsToward(e,t,n){const r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),s=[];for(;e.isInRange(14,12)&&s.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&s.push(e),s;s.push(e),e=e.getNext(t,1)}return s}getPhalanxLength(e,t,n){let r=0;for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}cancelMoveAttempt(){this.firstPiece=gw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=gw.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}secondClick(e,t){var n=this;return lw(function*(){const r=new eQ(e,t),i=n.firstPiece.get();if(r.equals(i))return n.cancelMoveAttempt(),DG.SUCCESS;const s=n.rules.node.gameState.getCurrentOpponent(),o=n.rules.node.gameState.getCurrentPlayer();if(!r.isAlignedWith(i))return n.cancelMove(b2.CASE_NOT_ALIGNED_WITH_SELECTED());const a=r.getDistance(i),c=i.getDirectionToward(r).get();switch(n.board[t][e]){case ZY.NONE:return 1===a?n.tryMove(new E2(i.x,i.y,1,1,c)):n.cancelMove(b2.SINGLE_PIECE_MUST_MOVE_BY_ONE());case s:return n.cancelMove(b2.SINGLE_PIECE_CANNOT_CAPTURE());default:uw.expectToBe(n.board[t][e],o);const l=new E2(i.x,i.y,a,1,c),u=S2.getPhalanxValidity(n.rules.node.gameState,l);return u.isFailure()?n.cancelMove(u.getReason()):(n.lastPiece=gw.of(r),n.validExtensions=n.getValidExtensions(o),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=i.getCoordsToward(r),n.phalanxDirection=gw.of(c),DG.SUCCESS)}})()}thirdClick(e,t){var n=this;return lw(function*(){const r=n.rules.node.gameState.getCurrentPlayer(),i=new eQ(e,t);if(n.firstPiece.equalsValue(i))return n.moveFirstPiece(r);if(n.lastPiece.equalsValue(i))return n.moveLastPiece(r);const s=n.firstPiece.get(),o=n.lastPiece.get();if(!i.isAlignedWith(s))return n.cancelMove(b2.CASE_NOT_ALIGNED_WITH_PHALANX());let a=QJ.factory.fromMove(s,o).get();const c=QJ.factory.fromMove(s,i).get();if(a===c.getOpposite()&&(n.firstPiece=gw.of(o),n.lastPiece=gw.of(s),a=c),a!==c)return n.cancelMove(b2.CASE_NOT_ALIGNED_WITH_PHALANX());if(n.board[t][e]===r){n.lastPiece=gw.of(i);const e=n.firstPiece.get().getDistance(i)+1,t=new E2(n.firstPiece.get().x,n.firstPiece.get().y,e,1,a),s=S2.getPhalanxValidity(n.rules.node.gameState,t);return s.isFailure()?n.cancelMove(s.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(r),n.phalanxValidLandings=n.getPhalanxValidLandings(),DG.SUCCESS)}{const e=n.firstPiece.get().getDistance(n.lastPiece.get())+1,t=n.lastPiece.get().getDistance(i),r=new E2(n.firstPiece.get().x,n.firstPiece.get().y,e,t,a);return n.tryMove(r)}})()}moveFirstPiece(e){var t=this;return lw(function*(){return t.firstPiece=gw.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?yield t.moveOnlyPiece(e):(t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e)),t.phalanxValidLandings=t.getPhalanxValidLandings(),DG.SUCCESS})()}moveLastPiece(e){var t=this;return lw(function*(){return t.lastPiece=gw.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),DG.SUCCESS)})()}moveOnlyPiece(e){var t=this;return lw(function*(){return t.lastPiece=gw.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=gw.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),DG.SUCCESS})()}tryMove(e){const t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}getPieceClasses(e,t){const n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}getPieceStrokeClasses(e,t){const n=new eQ(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(e=>e.equals(n))?["highlighted"]:[]}getRectClasses(e,t){const n=new eQ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:this.moveds.some(e=>e.equals(n))?["moved"]:[]}getHighlightedCoords(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}getCurrentPlayerPieces(){const e=[],t=this.rules.node.gameState.getCurrentPlayer();for(let n=0;n<this.board.length;n++)for(let r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new eQ(r,n));return e}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-epaminondas"]],features:[Ho],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,R2,2,1,"g",1),oa(2,D2,2,4,"g",1),da()),2&e&&(Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.getHighlightedCoords()))},directives:[Ud,Fd,$d],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();function F2(e){return new class extends HY{encode(t){return t.isPresent()?e.encode(t.get()):null}decode(t){return null===t?gw.empty():gw.of(e.decode(t))}}}class B2{constructor(e){if(e.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===E0.areOnSameLine(e))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=QY.copyImmutableArray(e).sort((e,t)=>{if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});let t=gw.empty();for(const n of this.capturedSpaces){if(t.isPresent()&&1!==t.get().getDistance(n))throw new Error("Cannot create a GipfCapture with non-consecutive cases");t=gw.of(n)}}toString(){let e="";for(const t of this.capturedSpaces)""!==e&&(e+=","),e+=t.toString();return e}size(){return this.capturedSpaces.length}forEach(e){this.capturedSpaces.forEach(e)}contains(e){for(let t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}intersectsWith(e){return this.capturedSpaces.some(t=>e.contains(t))}getLine(){return E0.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}equals(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(let t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}B2.encoder=new class extends HY{encode(e){return e.capturedSpaces.map(e=>eQ.encoder.encode(e))}decode(e){return new B2(e.map(e=>eQ.encoder.decode(e)))}};class U2{constructor(e,t){this.coord=e,this.direction=t}toString(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}equals(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}U2.encoder=new class extends HY{constructor(){super(...arguments),this.optionalDirectionEncoder=F2(iQ.encoder)}encode(e){return{coord:eQ.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}decode(e){const t=e;return VG(null!=t.coord,"Invalid encoded GipfPlacement"),new U2(eQ.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}};class V2 extends yQ{constructor(e,t,n){super(),this.placement=e,this.initialCaptures=t,this.finalCaptures=n}toString(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}equals(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===QY.compareArray(this.initialCaptures,e.initialCaptures)||!1===QY.compareArray(this.finalCaptures,e.finalCaptures))}encode(){return V2.encoder.encode(this)}decode(e){return V2.encoder.decode(e)}}V2.encoder=new class extends GY{encodeMove(e){const t={placement:U2.encoder.encode(e.placement)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=B2.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=B2.encoder.encode(e)}),t}decodeMove(e){const t=e;return VG(null!=t.placement,"Invalid encoded GipfMove"),new V2(U2.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",B2.encoder.decode),this.decodeArray(t,"finalCapture",B2.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class $2 extends w0{constructor(e,t,n,r){super(t,e,7,7,[3,2,1],rQ.EMPTY),this.sidePieces=n,this.capturedPieces=r}static getInitialState(){const e=rQ.EMPTY,t=rQ.NONE,n=rQ.ZERO,r=rQ.ONE;return new $2([[t,t,t,r,e,e,n],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[n,e,e,e,e,e,r],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[r,e,e,n,t,t,t]],0,[12,12],[0,0])}equals(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&QY.compareTable(this.board,e.board)}getNumberOfPiecesToPlace(e){return this.sidePieces[e.value]}getNumberOfPiecesCaptured(e){return this.capturedPieces[e.value]}setAtUnsafe(e,t){const n=QY.copyBiArray(this.board);return n[e.y][e.x]=t,new $2(n,this.turn,this.sidePieces,this.capturedPieces)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==rQ.NONE}}let z2=(()=>{class e{}return e.CAPTURE_MUST_BE_ALIGNED=()=>$localize`You can only capture when 4 or more of your pieces are aligned, and it is not the case.`,e.INVALID_CAPTURED_PIECES=()=>$localize`You must select a valid capture that contains 4 pieces or more.`,e.MISSING_CAPTURES=()=>$localize`There are still possible captures to be done.`,e.PLACEMENT_NOT_ON_BORDER=()=>$localize`Pieces must be inserted in spaces on the edge of the board.`,e.INVALID_PLACEMENT_DIRECTION=()=>$localize`You must select a valid placement direction.`,e.PLACEMENT_WITHOUT_DIRECTION=()=>$localize`You must select a placement with a direction alongside the insertion space.`,e.PLACEMENT_ON_COMPLETE_LINE=()=>$localize`You cannot place a piece on a complete line.`,e.AMBIGUOUS_CAPTURE_COORD=()=>$localize`This piece belongs to two captures. Please select another piece in the capture you'd like to make.`,e.CLICK_FURTHER_THAN_ONE_COORD=()=>$localize`You must click on an arrow to select your destination.`,e.NO_DIRECTIONS_AVAILABLE=()=>$localize`You cannot insert a piece here, as all lines are full. Select another space.`,e})();class H2 extends OQ{applyLegalMove(e,t,n){return new $2(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}static applyCaptures(e,t){let n=e;return t.forEach(e=>{n=H2.applyCapture(n,e)}),n}static applyCapture(e,t){const n=e.getCurrentPlayer();let r=e;const i=[e.sidePieces[0],e.sidePieces[1]],s=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(t=>{const o=e.getPieceAt(t);r=r.setAt(t,rQ.EMPTY),o.is(n)?i[n.value]+=1:s[n.value]+=1}),new $2(r.board,e.turn,i,s)}static getPlacements(e){const t=[];return cQ.INSTANCE.getAllBorders(e).forEach(n=>{e.getPieceAt(n)===rQ.EMPTY?t.push(new U2(n,gw.empty())):H2.getAllDirectionsForEntrance(e,n).forEach(r=>{!1===H2.isLineComplete(e,n,r)&&t.push(new U2(n,gw.of(r)))})}),t}static isLineComplete(e,t,n){return H2.nextGapInLine(e,t,n).isAbsent()}static nextGapInLine(e,t,n){for(let r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===rQ.EMPTY)return gw.of(r);return gw.empty()}static applyPlacement(e,t){const n=e.getCurrentPlayer();let r=e,i=rQ.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){const n=t.coord;if(e.getPieceAt(n)!==rQ.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(n,i)}else for(let o=t.coord;r.isOnBoard(o)&&i!==rQ.EMPTY;o=o.getNext(t.direction.get())){const t=e.getPieceAt(o);r=r.setAt(o,i),i=t}const s=[e.sidePieces[0],e.sidePieces[1]];return s[n.value]-=1,new $2(r.board,e.turn,s,e.capturedPieces)}getPiecesMoved(e,t,n){const r=H2.applyCaptures(e,t);if(n.direction.isAbsent())return[n.coord];{const e=n.direction.get(),t=[];t.push(n.coord);let i=n.coord.getNext(e);for(;r.isOnBoard(i)&&r.getPieceAt(i)!==rQ.EMPTY;)t.push(i),i=i.getNext(e);return VG(r.isOnBoard(i)&&r.getPieceAt(i)===rQ.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),t.push(i),t}}static getAllDirectionsForEntrance(e,t){if(cQ.INSTANCE.isTopLeftCorner(e,t))return[iQ.RIGHT,iQ.DOWN,iQ.UP_RIGHT];if(cQ.INSTANCE.isTopCorner(e,t))return[iQ.DOWN,iQ.DOWN_LEFT,iQ.RIGHT];if(cQ.INSTANCE.isTopRightCorner(e,t))return[iQ.DOWN_LEFT,iQ.DOWN,iQ.LEFT];if(cQ.INSTANCE.isBottomLeftCorner(e,t))return[iQ.UP_RIGHT,iQ.UP,iQ.RIGHT];if(cQ.INSTANCE.isBottomCorner(e,t))return[iQ.UP,iQ.LEFT,iQ.UP_RIGHT];if(cQ.INSTANCE.isBottomRightCorner(e,t))return[iQ.LEFT,iQ.UP,iQ.DOWN_LEFT];if(cQ.INSTANCE.isOnTopLeftBorder(e,t))return[iQ.RIGHT,iQ.DOWN];if(cQ.INSTANCE.isOnLeftBorder(e,t))return[iQ.UP_RIGHT,iQ.RIGHT];if(cQ.INSTANCE.isOnBottomLeftBorder(e,t))return[iQ.UP,iQ.UP_RIGHT];if(cQ.INSTANCE.isOnBottomRightBorder(e,t))return[iQ.LEFT,iQ.UP];if(cQ.INSTANCE.isOnRightBorder(e,t))return[iQ.LEFT,iQ.DOWN_LEFT];if(cQ.INSTANCE.isOnTopRightBorder(e,t))return[iQ.DOWN_LEFT,iQ.DOWN];throw new Error("not a border")}isLegal(e,t){const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=H2.applyCaptures(t,e.initialCaptures),i=this.noMoreCapturesValidity(r);if(i.isFailure())return i.toFailedFallible();const s=this.placementValidity(r,e.placement);if(s.isFailure())return s.toFailedFallible();const o=H2.applyPlacement(r,e.placement),a=this.capturesValidity(o,e.finalCaptures);if(a.isFailure())return a.toFailedFallible();const c=H2.applyCaptures(o,e.finalCaptures),l=this.noMoreCapturesValidity(c);return l.isFailure()?l.toFailedFallible():MG.success(c)}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=H2.applyCapture(n,r)}return DG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer(),r=H2.getLinePortionWithFourPiecesOfPlayer(e,n,t.getLine());if(r.isAbsent())return DG.failure(z2.CAPTURE_MUST_BE_ALIGNED());const i=r.get();return H2.getCapturable(e,i).equals(t)?DG.SUCCESS:DG.failure(z2.INVALID_CAPTURED_PIECES())}static getLinePortionsWithFourPiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=H2.getLinePortionWithFourPiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}static getLinePortionWithFourPiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o=i;for(let a=i;e.isOnBoard(a);a=a.getNext(s))if(e.getPieceAt(a).is(t)?(0===r&&(o=a),r+=1):r=0,4===r)return gw.of({0:o,1:a,2:s});return gw.empty()}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===H2.getLinePortionsWithFourPiecesOfPlayer(e,t).length?DG.SUCCESS:DG.failure(z2.MISSING_CAPTURES())}placementValidity(e,t){const n=this.placementCoordValidity(e,t.coord);if(n.isFailure())return n;if(e.getPieceAt(t.coord)!==rQ.EMPTY){if(t.direction.isAbsent())return DG.failure(z2.PLACEMENT_WITHOUT_DIRECTION());if(H2.isLineComplete(e,t.coord,t.direction.get()))return DG.failure(z2.PLACEMENT_ON_COMPLETE_LINE());for(const n of H2.getAllDirectionsForEntrance(e,t.coord))if(n===t.direction.get())return DG.SUCCESS;return DG.failure(z2.INVALID_PLACEMENT_DIRECTION())}return DG.SUCCESS}placementCoordValidity(e,t){return cQ.INSTANCE.isOnBorder(e,t)?DG.SUCCESS:DG.failure(z2.PLACEMENT_NOT_ON_BORDER())}static getCapturable(e,t){const n=[],r=t[0],i=t[1],s=t[2],o=s.getOpposite();let a=r.getNext(o);for(;e.isOnBoard(a)&&e.getPieceAt(a)!==rQ.EMPTY;)n.push(a),a=a.getNext(o);for(let c=r;!c.equals(i);c=c.getNext(s))n.push(c);for(let c=i;e.isOnBoard(c)&&e.getPieceAt(c)!==rQ.EMPTY;c=c.getNext(s))n.push(c);return new B2(n)}static getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return H2.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(t=>{n.push(H2.getCapturable(e,t))}),n}static getPlayerScore(e,t){const n=e.getNumberOfPiecesToPlace(t);if(0===n&&0===H2.getPossibleCaptures(e).length)return gw.empty();const r=e.getNumberOfPiecesCaptured(t);return gw.of(n+3*r)}static isGameOver(e){const t=H2.getPlayerScore(e,jY.ZERO),n=H2.getPlayerScore(e,jY.ONE);return t.isAbsent()||n.isAbsent()}getGameStatus(e){const t=e.gameState,n=H2.getPlayerScore(t,jY.ZERO),r=H2.getPlayerScore(t,jY.ONE);return n.isAbsent()?PQ.ONE_WON:r.isAbsent()?PQ.ZERO_WON:PQ.ONGOING}}class G2 extends uQ{static getPossibleCaptureCombinationsFromPossibleCaptures(e){const t=G2.computeIntersections(e);let n=[[]];return e.forEach((e,r)=>{if(0===t[r].length)n.forEach(e=>{e.push(r)});else{const e=[],i=t[r].some(e=>e>r);for(const s of n)!0===s.some(e=>t[r].some(t=>e===t))?e.push(QY.copyImmutableArray(s)):i?(e.push(QY.copyImmutableArray(s)),s.push(r),e.push(QY.copyImmutableArray(s))):(s.push(r),e.push(QY.copyImmutableArray(s)));n=e}}),n.map(t=>t.map(t=>e[t]))}static computeIntersections(e){const t=[];return e.forEach((n,r)=>{t.push([]),e.forEach((e,i)=>{r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}getBoardValue(e){const t=e.gameState,n=H2.getPlayerScore(t,jY.ZERO),r=H2.getPlayerScore(t,jY.ONE);return n.isAbsent()?new hQ(jY.ONE.getVictoryValue()):r.isAbsent()?new hQ(jY.ZERO.getVictoryValue()):new hQ(n.get()-r.get())}getListMoves(e){return this.getListMoveFromState(e.gameState)}getListMoveFromState(e){const t=[];return H2.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(n=>{const r=H2.applyCaptures(e,n);H2.getPlacements(r).forEach(e=>{const i=H2.applyPlacement(r,e);this.getPossibleCaptureCombinations(i).forEach(r=>{const i=new V2(e,n,r);t.push(i)})})}),t}getPossibleCaptureCombinations(e){const t=H2.getPossibleCaptures(e);return G2.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}class q2{constructor(e,t,n,r,i,s){this.source=e,this.destination=t,this.x1=n,this.y1=r,this.x2=i,this.y2=s}}const W2=rQ.NONE,j2=rQ.EMPTY,Z2=rQ.ZERO,Y2=rQ.ONE;class K2{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.
        This is the initial board.
        Each player has 12 pieces on the side and 3 pieces on the board.
        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.
        The first player plays with the dark pieces, the second player plays with the light pieces.`,$2.getInitialState()),AQ.anyMove($localize`Pushing`,$localize`Pieces can only enter the board through the edges. To insert a new piece:
        <ol>
            <li>Click on a space on the edge of the board.</li>
            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>
        </ol>
        You cannot push when a line is full.<br/><br/>
        You're playing Dark, insert a piece.`,$2.getInitialState(),new V2(new U2(new eQ(3,0),gw.of(iQ.DOWN)),[],[]),$localize`Congratulations!`),AQ.fromMove($localize`Capture (1/3)`,$localize`To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.
        There are multiple important aspects of a capture:
        <ol>
            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>
            <li>As soon as there is an empty space on the line, the capture stops.</li>
            <li>Your own pieces that are captured go back to your stock.
                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>
            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.
                This means that a turn happens in three phases:
                <ol type="A">
                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>
                    <li>Make your insertion.</li>
                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>
                </ol>
            </li>
        </ol><br/>
        You're playing Dark, you can make a capture, do it.`,new $2([[W2,W2,W2,Z2,Y2,j2,j2],[W2,W2,j2,j2,j2,j2,j2],[W2,j2,j2,j2,j2,j2,j2],[Z2,Z2,Z2,j2,j2,j2,j2],[Y2,j2,j2,j2,j2,j2,W2],[j2,j2,j2,Y2,j2,W2,W2],[j2,j2,j2,Y2,W2,W2,W2]],42,[8,8],[0,0]),[new V2(new U2(new eQ(0,3),gw.of(iQ.RIGHT)),[],[new B2([new eQ(0,3),new eQ(1,3),new eQ(2,3),new eQ(3,3)])])],$localize`Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.
        Let's now see how captures can really be useful.`,$localize`Failed!`),AQ.fromMove($localize`Capture (2/3)`,$localize`Here, there are three different ways of capturing.
        <ol>
          <li>One way does not capture any of your opponent's pieces.</li>
          <li>Another way captures one of your opponent's pieces.</li>
          <li>The last way captures two of your opponent's pieces.</li>
        </ol>
        <br/><br/>
        Pick the last one.`,new $2([[W2,W2,W2,j2,j2,j2,j2],[W2,W2,j2,Y2,j2,j2,j2],[W2,j2,j2,Z2,j2,j2,j2],[Z2,Z2,Z2,Y2,j2,j2,j2],[j2,j2,j2,Z2,j2,j2,W2],[j2,j2,j2,Z2,j2,W2,W2],[j2,j2,j2,Y2,W2,W2,W2]],42,[8,4],[2,3]),[new V2(new U2(new eQ(0,3),gw.of(iQ.RIGHT)),[],[new B2([new eQ(3,1),new eQ(3,2),new eQ(3,3),new eQ(3,4),new eQ(3,5),new eQ(3,6)])])],$localize`Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.
        The most you can get is 3 per capture.`,$localize`Failed, the best capture was taking 2 of your opponent's pieces`),AQ.fromMove($localize`Capture (3/3)`,$localize`Here, you must capture at the beginning of your turn.
        This is due to a move of your opponent at the previous turn
        (even though this is a fictitious board for pedagogical purpose).
        After your capture, by performing the right move you can even capture two more of your opponent's pieces!
        Keep it mind that the most useful in a capture is to take your opponent's pieces.`,new $2([[W2,W2,W2,Z2,j2,j2,Z2],[W2,W2,j2,Z2,j2,j2,Z2],[W2,Z2,Z2,j2,Z2,Y2,Z2],[j2,j2,j2,Z2,j2,j2,Z2],[j2,j2,j2,Z2,j2,j2,W2],[Z2,Z2,Z2,Y2,Y2,W2,W2],[j2,j2,j2,Z2,W2,W2,W2]],42,[8,4],[2,3]),[new V2(new U2(new eQ(3,6),gw.of(iQ.UP)),[new B2([new eQ(6,0),new eQ(6,1),new eQ(6,2),new eQ(6,3)])],[new B2([new eQ(0,5),new eQ(1,5),new eQ(2,5),new eQ(3,5),new eQ(4,5)]),new B2([new eQ(1,2),new eQ(2,2),new eQ(3,2),new eQ(4,2),new eQ(5,2)])]),new V2(new U2(new eQ(4,6),gw.of(iQ.UP)),[new B2([new eQ(6,0),new eQ(6,1),new eQ(6,2),new eQ(6,3)])],[new B2([new eQ(0,5),new eQ(1,5),new eQ(2,5),new eQ(3,5),new eQ(4,5)]),new B2([new eQ(3,0),new eQ(3,1),new eQ(3,2),new eQ(3,3),new eQ(3,4)])]),new V2(new U2(new eQ(3,6),gw.of(iQ.UP)),[new B2([new eQ(6,0),new eQ(6,1),new eQ(6,2),new eQ(6,3)])],[new B2([new eQ(1,2),new eQ(2,2),new eQ(3,2),new eQ(4,2),new eQ(5,2)]),new B2([new eQ(0,5),new eQ(1,5),new eQ(2,5),new eQ(3,5),new eQ(4,5)])])],$localize`Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces.`,$localize`Failed, the best capture takes 2 of your opponent's pieces.`)]}}function J2(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa().$implicit,t=wa();la("ngClass",t.getPieceClass(e)),na("cx",t.getCenterAt(e).x)("cy",t.getCenterAt(e).y)("r",t.SPACE_SIZE)}}function Q2(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"g",8),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t)}),fa(2,"polyline",9),oa(3,J2,1,4,"circle",10),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),Oa("id","click_",e.x,"_",e.y,""),Ts(1),Oa("id","case_",e.x,"_",e.y,""),la("ngClass",n.getSpaceClass(e)),na("points",n.getHexaCoordsAt(e)),Ts(1),la("ngIf",n.isPiece(e))}}function X2(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",14),_a("click",function(){const t=Gt(e).$implicit;return wa(2).onClick(t)}),da()}if(2&e){const e=t.$implicit;na("points",wa(2).getHexaCoordsAt(e))}}function e3(e,t){if(1&e&&(Cn(),ha(0,"g",12),oa(1,X2,1,1,"polyline",13),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e.capturedSpaces)}}function t3(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"line",15),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.destination)}),da(),da()}if(2&e){const e=t.$implicit;Ts(1),na("x1",e.x1)("y1",e.y1)("x2",e.x2)("y2",e.y2)}}function n3(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"circle",16),da()),2&e){const e=t.$implicit,n=wa().$implicit,r=wa();Ts(1),Oa("id","piece_",n,"_",e,""),la("ngClass",r.getSidePieceClass(n)),na("cx",10+e*r.SPACE_SIZE*.5)("cy",10+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function r3(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,n3,2,6,"g",5),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",n.getPlayerSidePieces(e))}}function i3(e,t){if(1&e&&(Cn(),fa(0,"line",17)),2&e){const e=wa();na("x1",e.inserted.get().x1)("y1",e.inserted.get().y1)("x2",e.inserted.get().x2)("y2",e.inserted.get().y2)}}const s3=function(){return[0,1]};let o3=(()=>{class e extends nQ{constructor(t){super(t),this.inserted=gw.empty(),this.arrows=[],this.captured=[],this.moved=[],this.movePhase=e.PHASE_PLACEMENT_COORD,this.possibleCaptures=[],this.initialCaptures=[],this.placement=gw.empty(),this.placementEntrance=gw.empty(),this.finalCaptures=[],this.scores=gw.of([0,0]),this.rules=new H2($2),this.availableMinimaxes=[new G2(this.rules,"GipfMinimax")],this.encoder=V2.encoder,this.tutorial=(new K2).tutorial,this.SPACE_SIZE=40,this.constructedState=this.rules.node.gameState,this.hexaLayout=new sQ(1.5*this.SPACE_SIZE,new eQ(2*this.SPACE_SIZE,0),cQ.INSTANCE)}updateBoard(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}showLastMove(){this.inserted=gw.empty();const e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){const t=e.get().placement;this.inserted=gw.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}arrowTowards(e,t){const n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new q2(n,e,i.x,i.y,r.x,r.y)}markCapture(e){e.forEach(e=>{this.captured.push(e)})}getAllCoords(){return this.constructedState.allCoords()}getPlayerSidePieces(e){const t=this.constructedState.getNumberOfPiecesToPlace(jY.of(e)),n=[];for(let r=0;r<t;r+=1)n.push(r);return n}isPiece(e){return this.getPiece(e)!==rQ.EMPTY}getPiece(e){return this.constructedState.getPieceAt(e)}onClick(t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+t.x+"_"+t.y);if(r.isFailure())return n.cancelMove(r.getReason());switch(n.movePhase){case e.PHASE_INITIAL_CAPTURE:case e.PHASE_FINAL_CAPTURE:return n.selectCapture(t);case e.PHASE_PLACEMENT_COORD:return n.selectPlacementCoord(t);default:uw.expectToBe(n.movePhase,e.PHASE_PLACEMENT_DIRECTION);const r=n.placementEntrance.get();if(!1===r.isAlignedWith(t))return n.cancelMove(z2.INVALID_PLACEMENT_DIRECTION());if(1!==r.getDistance(t))return n.cancelMove(z2.CLICK_FURTHER_THAN_ONE_COORD());const i=iQ.factory.fromMove(r,t);return n.selectPlacementDirection(i.toOptional())}})()}selectCapture(t){var n=this;return lw(function*(){const r=[];if(n.possibleCaptures.forEach(e=>{e.contains(t)&&r.push(e)}),r.length>1)return n.cancelMove(z2.AMBIGUOUS_CAPTURE_COORD());if(0===r.length)return n.cancelMove(z2.MISSING_CAPTURES());const i=r[0];switch(n.constructedState=H2.applyCapture(n.constructedState,i),n.markCapture(i),n.possibleCaptures=H2.getPossibleCaptures(n.constructedState),n.movePhase){case e.PHASE_INITIAL_CAPTURE:return n.initialCaptures.push(i),0===n.possibleCaptures.length?n.moveToPlacementPhase():DG.SUCCESS;default:return uw.expectToBe(n.movePhase,e.PHASE_FINAL_CAPTURE),n.finalCaptures.push(i),0===n.possibleCaptures.length?n.tryMove(n.initialCaptures,n.placement.get(),n.finalCaptures):DG.SUCCESS}})()}moveToPlacementPhase(){return this.movePhase=e.PHASE_PLACEMENT_COORD,DG.SUCCESS}moveToInitialCaptureOrPlacementPhase(){return this.possibleCaptures=H2.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?e.PHASE_PLACEMENT_COORD:e.PHASE_INITIAL_CAPTURE,DG.SUCCESS}moveToFinalCapturePhaseOrTryMove(){var t=this;return lw(function*(){return t.possibleCaptures=H2.getPossibleCaptures(t.constructedState),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):(t.movePhase=e.PHASE_FINAL_CAPTURE,DG.SUCCESS)})()}computeArrows(e){this.arrows=[];for(const t of H2.getAllDirectionsForEntrance(this.constructedState,e))if(!1===H2.isLineComplete(this.constructedState,e,t)){const n=e.getNext(t),r=this.getCenterAt(e),i=this.getCenterAt(n);this.arrows.push(new q2(e,n,r.x,r.y,i.x,i.y))}}selectPlacementCoord(t){var n=this;return lw(function*(){const r=n.rules.placementCoordValidity(n.constructedState,t);return r.isFailure()?n.cancelMove(r.getReason()):(n.placementEntrance=gw.of(t),n.constructedState.getPieceAt(t)===rQ.EMPTY?n.selectPlacementDirection(gw.empty()):(n.movePhase=e.PHASE_PLACEMENT_DIRECTION,n.computeArrows(t),0===n.arrows.length&&n.cancelMove(z2.NO_DIRECTIONS_AVAILABLE()),DG.SUCCESS))})()}selectPlacementDirection(e){var t=this;return lw(function*(){t.placement=gw.of(new U2(t.placementEntrance.get(),e));const n=t.rules.placementValidity(t.constructedState,t.placement.get());return n.isFailure()?t.cancelMove(n.getReason()):(t.arrows=[],t.constructedState=H2.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove())})()}tryMove(e,t,n){var r=this;return lw(function*(){const i=new V2(t,e,n);return yield r.chooseMove(i,r.rules.node.gameState,r.scores.get())})()}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];const e=this.rules.node.move;if(e.isPresent()){const t=e.get(),n=this.rules.node.mother.get().gameState;t.initialCaptures.forEach(e=>this.markCapture(e)),t.finalCaptures.forEach(e=>this.markCapture(e)),this.moved=this.rules.getPiecesMoved(n,t.initialCaptures,t.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=gw.empty(),this.placement=gw.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}getSpaceClass(e){return this.captured.some(t=>t.equals(e))?"captured":this.moved.some(t=>t.equals(e))?"moved":""}getPieceClass(e){const t=this.getPiece(e);return this.getPlayerClass(jY.of(t.value))}getSidePieceClass(e){return this.getPlayerClass(jY.of(e))}}return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-gipf"]],features:[Ho],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"defs"),ha(2,"marker",1),fa(3,"polygon",2),da(),ha(4,"marker",3),fa(5,"polygon",4),da(),da(),oa(6,Q2,4,7,"g",5),oa(7,e3,2,1,"g",6),oa(8,t3,2,4,"g",5),oa(9,r3,2,1,"g",5),oa(10,i3,1,4,"line",7),da()),2&e&&(Ts(6),la("ngForOf",t.getAllCoords()),Ts(1),la("ngForOf",t.possibleCaptures),Ts(1),la("ngForOf",t.arrows),Ts(1),la("ngForOf",ou(5,s3)),Ts(1),la("ngIf",t.inserted.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class a3 extends vQ{equals(e){return this===e||this.coord.equals(e.coord)}toString(){return this===a3.PASS?"GoMove.PASS":this===a3.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}a3.PASS=new a3(-1,0),a3.ACCEPT=new a3(-2,0),a3.PASS_NUMBER=-1,a3.ACCEPT_NUMBER=-2,a3.encoder=new class extends qY{maxValue(){return 360}encodeNumber(e){return 19*e.coord.y+e.coord.x}decodeNumber(e){if(e===a3.PASS_NUMBER)return a3.PASS;const t=e%19;return new a3(t,(e-t)/19)}};class c3{constructor(e,t){this.player=e,this.type=t}equals(e){return e===this}toString(){switch(this){case c3.BLACK:return"GoPiece.BLACK";case c3.WHITE:return"GoPiece.WHITE";case c3.EMPTY:return"GoPiece.EMPTY";case c3.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case c3.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case c3.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return VG(this===c3.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}static pieceBelongTo(e,t){return t===e.player&&"territory"!==e.type}static ofPlayer(e){return e===jY.ZERO?c3.BLACK:c3.WHITE}isOccupied(){return[c3.BLACK,c3.WHITE,c3.DEAD_BLACK,c3.DEAD_WHITE].includes(this)}isEmpty(){return[c3.BLACK_TERRITORY,c3.WHITE_TERRITORY,c3.EMPTY].includes(this)}isDead(){return[c3.DEAD_BLACK,c3.DEAD_WHITE].includes(this)}isTerritory(){return[c3.BLACK_TERRITORY,c3.WHITE_TERRITORY].includes(this)}getOwner(){return this.player}nonTerritory(){return VG(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),c3.EMPTY}}c3.BLACK=new c3(jY.ZERO,"alive"),c3.WHITE=new c3(jY.ONE,"alive"),c3.EMPTY=new c3(ZY.NONE,"empty"),c3.DEAD_BLACK=new c3(jY.ZERO,"dead"),c3.DEAD_WHITE=new c3(jY.ONE,"dead"),c3.BLACK_TERRITORY=new c3(ZY.NONE,"territory"),c3.WHITE_TERRITORY=new c3(ZY.NONE,"territory");var l3=(()=>(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(l3||(l3={})),l3))();let u3=(()=>{class e extends gQ{constructor(e,t,n,r,i){super(e,n),this.captured=t,this.koCoord=r,this.phase=i}static getInitialState(){const t=e.getStartingBoard();return new e(t,[0,0],0,gw.empty(),l3.PLAYING)}getCapturedCopy(){return[this.captured[0],this.captured[1]]}static getStartingBoard(){return QY.createTable(e.WIDTH,e.HEIGHT,c3.EMPTY)}copy(){return new e(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}isDead(e){return this.getPieceAt(e).isDead()}isTerritory(e){return this.getPieceAt(e).isTerritory()}}return e.WIDTH=13,e.HEIGHT=13,e})(),h3=(()=>{class e{constructor(e){this.color=e}selfContains(e){return this.getCoords().some(t=>t.equals(e))}static insertAsEntryPoint(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}return e.VERBOSE=!1,e})();class d3 extends h3{constructor(e,t,n,r,i,s){super(e),this.emptyCoords=t,this.blackCoords=n,this.whiteCoords=r,this.deadBlackCoords=i,this.deadWhiteCoords=s}getCoords(){return this.color===c3.BLACK?this.blackCoords:this.color===c3.WHITE?this.whiteCoords:this.color===c3.DEAD_BLACK?this.deadBlackCoords:this.color===c3.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}contains(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(t=>t.equals(e))}addPawn(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case c3.BLACK:this.blackCoords=h3.insertAsEntryPoint(this.blackCoords,e);break;case c3.WHITE:this.whiteCoords=h3.insertAsEntryPoint(this.whiteCoords,e);break;case c3.DEAD_BLACK:this.deadBlackCoords=h3.insertAsEntryPoint(this.deadBlackCoords,e);break;case c3.DEAD_WHITE:this.deadWhiteCoords=h3.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:uw.expectToBeMultiple(t,[c3.EMPTY,c3.BLACK_TERRITORY,c3.WHITE_TERRITORY]),this.emptyCoords=h3.insertAsEntryPoint(this.emptyCoords,e)}}isMonoWrapped(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}getWrapper(){const e=new EQ;e.set(c3.EMPTY,this.emptyCoords.length),e.set(c3.BLACK,this.blackCoords.length+this.deadWhiteCoords.length),e.set(c3.WHITE,this.whiteCoords.length+this.deadBlackCoords.length),e.put(this.color.nonTerritory(),0);const t=e.filter((e,t)=>t>0);if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}getNeighboorsEntryPoint(){const e=[];return this.color!==c3.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==c3.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==c3.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==c3.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==c3.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}class f3 extends class{getGroupDatas(e,t){hw(h3.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");const n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}_getGroupDatas(e,t,n){hw(h3.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});const r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color)for(const i of this.getDirections()){const r=e.getNext(i);r.isInRange(t[0].length,t.length)&&(n.contains(r)||(n=this._getGroupDatas(r,t,n)))}return n}}{getNewInstance(e){return new d3(e,[],[],[],[],[])}getDirections(){return XJ.ORTHOGONALS}}let p3=(()=>{class e{}return e.ILLEGAL_KO=()=>$localize`This move is a ko, you must play somewhere else before you can play in this intersection again.`,e.CANNOT_PASS_AFTER_PASSED_PHASE=()=>$localize`We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn.`,e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=()=>$localize`You cannot accept before the counting phase.`,e.OCCUPIED_INTERSECTION=()=>$localize`This intersection is already occupied.`,e.CANNOT_COMMIT_SUICIDE=()=>$localize`You cannot commit suicide.`,e})(),g3=(()=>{class e extends OQ{static isLegal(t,n){const r=!1;if(hw(e.VERBOSE||r,{isLegal:{move:t,state:n}}),e.isPass(t)){const t=n.phase===l3.PLAYING,i=n.phase===l3.PASSED;return hw(e.VERBOSE||r,"GoRules.isLegal at "+n.phase+(t||i?" forbid":" allowed")+" passing on "+n.getCopiedBoard()),t||i?MG.success([]):MG.failure(p3.CANNOT_PASS_AFTER_PASSED_PHASE())}if(e.isAccept(t)){const e=n.phase===l3.ACCEPT;return n.phase===l3.COUNTING||e?MG.success([]):MG.failure(p3.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return e.isOccupied(t.coord,n.getCopiedBoard())?(hw(e.VERBOSE||r,"GoRules.isLegal: move is marking"),e.isLegalDeadMarking(t,n)?MG.success([]):MG.failure(p3.OCCUPIED_INTERSECTION())):(hw(e.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+t.toString()),e.isLegalNormalMove(t,n))}static getNewKo(e,t,n){if(1===n.length){const r=n[0],i=e.coord,s=t[i.y][i.x],o=(new f3).getGroupDatas(i,t),a=o.emptyCoords,c=c3.pieceBelongTo(s,jY.ZERO)?o.blackCoords:o.whiteCoords;if(1===a.length&&a[0].equals(r)&&1===c.length)return gw.of(r)}return gw.empty()}static markTerritoryAndCount(t){hw(e.VERBOSE,{markTerritoryAndCount:{state:t}});const n=t.getCopiedBoard(),r=e.getTerritoryLikeGroup(t),i=t.getCapturedCopy();for(const e of r){const t=e.getWrapper();if(t===c3.WHITE){i[1]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=c3.WHITE_TERRITORY}else{VG(t===c3.BLACK,"territory should be wrapped by black or white, not by "+t.toString()),i[0]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=c3.BLACK_TERRITORY}}return new u3(n,i,t.turn,t.koCoord,t.phase)}static removeAndSubstractTerritory(e){const t=e.getCopiedBoard(),n=e.getCapturedCopy();let r;for(let i=0;i<e.board.length;i++)for(let s=0;s<e.board[0].length;s++)r=t[i][s],r===c3.BLACK_TERRITORY?(t[i][s]=c3.EMPTY,n[0]=n[0]-1):r===c3.WHITE_TERRITORY&&(t[i][s]=c3.EMPTY,n[1]=n[1]-1);return new u3(t,n,e.turn,e.koCoord,e.phase)}static getEmptyZones(t){return e.getGroupsDatasWhere(t.getCopiedBoard(),e=>e.isEmpty())}static getGroupsDatasWhere(e,t){const n=[];let r,i,s;const o=new f3;for(let a=0;a<e.length;a++)for(let c=0;c<e[0].length;c++)r=new eQ(c,a),s=e[a][c],t(s)&&(n.some(e=>e.selfContains(r))||(i=o.getGroupDatas(r,e),n.push(i)));return n}static addDeadToScore(e){const t=e.getCapturedCopy();let n,r=t[1],i=t[0];for(let s=0;s<e.board.length;s++)for(let t=0;t<e.board[0].length;t++)n=e.getPieceAtXY(t,s),n===c3.DEAD_BLACK?r++:n===c3.DEAD_WHITE&&i++;return[i,r]}static switchAliveness(e,t){const n=t.getCopiedBoard();VG(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");const r=(new f3).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case c3.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;for(const e of r.deadBlackCoords)n[e.y][e.x]=c3.BLACK;break;case c3.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;for(const e of r.deadWhiteCoords)n[e.y][e.x]=c3.WHITE;break;case c3.WHITE:i[0]+=2*r.whiteCoords.length;for(const e of r.whiteCoords)n[e.y][e.x]=c3.DEAD_WHITE;break;default:uw.expectToBe(r.color,c3.BLACK),i[1]+=2*r.blackCoords.length;for(const e of r.blackCoords)n[e.y][e.x]=c3.DEAD_BLACK}return new u3(n,i,t.turn,t.koCoord,t.phase)}static getGameStatus(e){const t=e.gameState;return t.phase===l3.FINISHED?t.captured[0]>t.captured[1]?PQ.ZERO_WON:t.captured[1]>t.captured[0]?PQ.ONE_WON:PQ.DRAW:PQ.ONGOING}static isPass(e){return e.equals(a3.PASS)}static isAccept(e){return e.equals(a3.ACCEPT)}static isLegalDeadMarking(t,n){return e.isOccupied(t.coord,n.getCopiedBoard())&&(n.phase===l3.COUNTING||n.phase===l3.ACCEPT)}static isLegalNormalMove(t,n){const r=n.getCopiedBoard();if(e.isKo(t,n))return MG.failure(p3.ILLEGAL_KO());[l3.COUNTING,l3.ACCEPT].includes(n.phase)&&(n=e.resurrectStones(n));const i=e.getCaptureState(t,n);if(m3.isCapturing(i))return MG.success(i.capturedCoords);{r[t.coord.y][t.coord.x]=n.turn%2==0?c3.BLACK:c3.WHITE;const e=0===(new f3).getGroupDatas(t.coord,r).emptyCoords.length;return r[t.coord.y][t.coord.x]=c3.EMPTY,e?MG.failure(p3.CANNOT_COMMIT_SUICIDE()):MG.success([])}}static isOccupied(e,t){return t[e.y][e.x].isOccupied()}static isKo(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}static getCaptureState(t,n){hw(e.VERBOSE||!1,{getCaptureState:{move:t,state:n}});const r=new m3;let i;for(const s of XJ.ORTHOGONALS)i=e.getCapturedInDirection(t.coord,s,n),i.length>0&&r.capturedCoords.every(e=>!i[0].equals(e))&&(r.capturedCoords=r.capturedCoords.concat(i));return r}static getCapturedInDirection(t,n,r){const i=r.getCopiedBoard(),s=t.getNext(n);if(s.isInRange(r.board[0].length,r.board.length)&&i[s.y][s.x]===(r.turn%2==0?c3.WHITE:c3.BLACK)){hw(e.VERBOSE||!1,"a group could be captured");const t=(new f3).getGroupDatas(s,i);if(e.isCapturableGroup(t,r.koCoord))return hw(e.VERBOSE||!1,{neightbooringGroupCoord:t.getCoords(),message:"is capturable"}),t.getCoords()}return[]}static isCapturableGroup(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}static getTerritoryLikeGroup(t){return e.getEmptyZones(t).filter(e=>e.isMonoWrapped())}static applyPass(t){const n=t.getCopiedBoard(),r=t.getCapturedCopy(),i=t.turn;let s,o;return t.phase===l3.PASSED?(s=l3.COUNTING,o=new u3(n,r,i+1,gw.empty(),s),o=e.markTerritoryAndCount(o)):(VG(t.phase===l3.PLAYING,"Cannot pass in counting phase!"),s=l3.PASSED,o=new u3(n,r,i+1,gw.empty(),s)),o}static applyLegalAccept(e){const t=e.getCopiedBoard();let n;return n=e.phase===l3.COUNTING?l3.ACCEPT:l3.FINISHED,new u3(t,e.getCapturedCopy(),e.turn+1,gw.empty(),n)}static applyNormalLegalMove(t,n,r){let i;hw(e.VERBOSE,{applyNormalLegal:{currentState:t,legalMove:n,status}}),i=[l3.COUNTING,l3.ACCEPT].includes(t.phase)?e.resurrectStones(t):t.copy();const s=n.coord.x,o=n.coord.y,a=i.getCopiedBoard(),c=i.turn,l=c3.ofPlayer(i.getCurrentPlayer()),u=c+1;a[o][s]=l;for(const e of r)a[e.y][e.x]=c3.EMPTY;const h=e.getNewKo(n,a,r),d=i.getCapturedCopy();return d[l.player.value]+=r.length,new u3(a,d,u,h,l3.PLAYING)}static resurrectStones(t){for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[0].length;r++)t.getPieceAtXY(r,n).isDead()&&(t=e.switchAliveness(new eQ(r,n),t));return e.removeAndSubstractTerritory(t)}static applyDeadMarkingMove(t,n){hw(e.VERBOSE,{applyDeadMarkingMove:{legalMove:t,state:n}});const r=e.removeAndSubstractTerritory(n),i=e.switchAliveness(t.coord,r),s=new u3(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,gw.empty(),l3.COUNTING);return e.markTerritoryAndCount(s)}isLegal(t,n){return e.isLegal(t,n)}applyLegalMove(t,n,r){return hw(e.VERBOSE,{applyLegalMove:{legalMove:t,state:n,status:r}}),e.isPass(t)?(hw(e.VERBOSE,"GoRules.applyLegalMove: isPass"),e.applyPass(n)):e.isAccept(t)?(hw(e.VERBOSE,"GoRules.applyLegalMove: isAccept"),e.applyLegalAccept(n)):e.isLegalDeadMarking(t,n)?(hw(e.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),e.applyDeadMarkingMove(t,n)):(hw(e.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),e.applyNormalLegalMove(n,t,r))}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class m3{constructor(){this.capturedCoords=[]}static isCapturing(e){return e.capturedCoords.length>0}}class y3 extends uQ{getListMoves(e){hw(g3.VERBOSE||!1,"GoRules.getListMoves");const t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===l3.PLAYING||t.phase===l3.PASSED)return n.push(a3.PASS),n;{hw(g3.VERBOSE||!1,"GoRules.getListMoves in counting phase");const e=this.getCountingMovesList(t);return 0===e.length?[a3.ACCEPT]:e}}getPlayingMovesList(e){const t=[];let n;for(let r=0;r<e.board.length;r++)for(let i=0;i<e.board[0].length;i++)n=new a3(i,r),e.getPieceAt(n.coord)===c3.EMPTY&&g3.isLegal(n,e).isSuccess()&&t.push(n);return t}getCountingMovesList(e){const t=[],n=this.getCorrectBoard(e).getCopiedBoard(),r=g3.getGroupsDatasWhere(n,e=>e!==c3.EMPTY);for(const i of r){const r=i.getCoords()[0],s=n[r.y][r.x];if(e.getPieceAt(r)!==s){const e=new a3(r.x,r.y);return t.push(e),t}}return t}getCorrectBoard(e){const t=this.mapBoard(e.getCopiedBoard(),e=>e===c3.BLACK?c3.DEAD_BLACK:e===c3.WHITE?c3.DEAD_WHITE:e.isTerritory()?c3.EMPTY:e),n=new u3(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=g3.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}mapBoard(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}setAliveUniqueWrapper(e,t){let n,r=e.copy();for(const i of t){n=i.deadBlackCoords.concat(i.deadWhiteCoords);for(const e of n)r.isDead(e)&&(r=g3.switchAliveness(e,r))}return r}getBoardValue(e){const t=e.gameState,n=g3.getGameStatus(e);if(n.isEndGame)return new hQ(n.toBoardValue());hw(g3.VERBOSE||!1,"GoRules.getBoardValue");const r=g3.markTerritoryAndCount(t),i=r.getCapturedCopy(),s=this.getDeadStones(r);return new hQ(i[1]+2*s[0]-(i[0]+2*s[1]))}getDeadStones(e){const t=[0,0];for(let n=0;n<e.board.length;n++)for(let r=0;r<e.board[0].length;r++){const i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}const v3=c3.WHITE,_3=c3.BLACK,C3=c3.DEAD_WHITE,E3=c3.WHITE_TERRITORY,w3=c3.BLACK_TERRITORY,b3=c3.EMPTY;class S3{constructor(){this.tutorial=[AQ.informational($localize`Preliminary information`,$localize`The game of Go is played on a board called a Goban, and the stones are placed on the intersections.
        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.
        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).
        For this tutorial, we will use a smaller board for pedagogical purposes.`,u3.getInitialState()),AQ.informational($localize`Goal of the game`,$localize`The goal of the game is to have the most points at the end of the game.
        We call "territories" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.
        Here, Dark has 9 territories on the left, and Light has 8 on the right.
        The top part belongs to no one.
        Each player's score at the end of the game is the sum of that player's territories and captures.`,new u3([[b3,_3,b3,b3,v3,v3],[b3,_3,b3,b3,v3,b3],[b3,_3,_3,v3,v3,b3],[b3,b3,_3,v3,b3,b3],[b3,b3,_3,v3,b3,b3],[b3,b3,_3,v3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING)),AQ.fromMove($localize`Simple capture`,$localize`An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).
        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.
        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>
        The light piece only has one liberty left, play there.`,new u3([[b3,b3,b3,b3,b3],[b3,b3,_3,b3,b3],[b3,_3,v3,b3,b3],[b3,b3,_3,b3,b3],[b3,b3,b3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING),[new a3(3,2)],$localize`Congratulations, you have earned one point.`,$localize`Failed, try again by playing on one of the intersections directly next to the light stone.`),AQ.fromMove($localize`Capturing multiple stones`,$localize`Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>
        The light group here only has one liberty left, capture it.`,new u3([[b3,_3,b3,b3,b3],[_3,v3,b3,b3,b3],[_3,v3,v3,_3,b3],[b3,_3,_3,b3,b3],[b3,b3,b3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING),[new a3(2,1)],$localize`Congratulations, you have earned three points and formed a territory.`,$localize`Failed, you have not captured the group. Play on the last liberty of that group.`),AQ.informational($localize`Suicide`,$localize`In Go, suicide is forbidden.
        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.
        Here, the top left intersection is a suicide for Light.
        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player.`,new u3([[b3,_3,b3,b3,b3],[_3,b3,b3,b3,b3],[_3,b3,b3,b3,v3],[v3,_3,b3,v3,b3],[b3,v3,b3,v3,_3]],[0,0],0,gw.empty(),l3.PLAYING)),AQ.informational($localize`Life and death (death)`,$localize`From the capture rule follows the life and death notion:
        dead stones are stones that are definitely capturable (without losing anything else).
        Alive stones are stones that can never be captured.
        From the capture rule, Dark can play inside Light's territory and make a capture.
        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).
        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories.`,new u3([[b3,b3,b3,b3,b3],[_3,_3,_3,b3,b3],[v3,v3,_3,b3,b3],[b3,v3,_3,b3,b3],[v3,v3,_3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING)),AQ.informational($localize`Life and death (eyes)`,$localize`Here, Light cannot play on the top left, nor on the bottom left.
        Light will never be able to capture Dark.
        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive.`,new u3([[b3,_3,v3,b3,b3],[v3,_3,v3,b3,b3],[_3,_3,v3,b3,b3],[v3,_3,v3,b3,b3],[b3,_3,v3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING)),AQ.informational($localize`Seki`,$localize`If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.
        Similarly, if Light plays on the middle line, Dark will capture Light.
        In other words, there is no point in playing on the middle line.
        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral.`,new u3([[b3,v3,_3,b3,v3,_3,b3],[b3,v3,_3,_3,v3,_3,b3],[b3,v3,_3,_3,v3,_3,b3],[b3,v3,_3,_3,v3,_3,b3],[b3,v3,_3,v3,v3,_3,b3],[b3,v3,_3,v3,v3,_3,b3],[b3,v3,_3,b3,v3,_3,b3]],[0,0],0,gw.empty(),l3.PLAYING)),AQ.fromMove($localize`Ko`,$localize`A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>
        Capture the light stone.`,new u3([[b3,b3,b3,b3,b3,b3,b3],[b3,b3,b3,b3,b3,b3,b3],[b3,b3,b3,_3,v3,b3,b3],[b3,b3,_3,v3,b3,v3,b3],[b3,b3,b3,_3,v3,b3,b3],[b3,b3,b3,b3,b3,b3,b3],[b3,b3,b3,b3,b3,b3,b3]],[0,0],0,gw.empty(),l3.PLAYING),[new a3(4,3)],$localize`Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.
        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.
        This rule is called the Ko.
        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after.`,$localize`Failed!`),AQ.fromMove($localize`End of the game`,$localize`When a player feels that there is no advantage to putting a new stone, that player can pass a turn.
        The game phase stops when both players pass consecutively, and we move on to the counting phase.
        The dead groups are then marked by clicking on them.
        Every intersection in a player's territory earns that player a point.
        The winner is the one with most points.<br/><br/>
        A last stone is dead, mark it.`,new u3([[v3,_3,_3,_3,_3,_3,w3,w3,w3],[v3,v3,v3,v3,_3,_3,_3,w3,w3],[v3,E3,v3,v3,_3,C3,C3,_3,w3],[_3,v3,v3,v3,v3,_3,w3,w3,w3],[b3,v3,E3,v3,_3,_3,C3,_3,w3],[v3,E3,v3,v3,_3,_3,_3,_3,_3],[v3,v3,_3,_3,_3,v3,v3,_3,v3],[_3,_3,_3,v3,v3,v3,E3,v3,v3],[w3,w3,_3,_3,_3,v3,v3,E3,E3]],[0,0],0,gw.empty(),l3.COUNTING),[new a3(0,3)],$localize`Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.
        The intersections where the prisoners are count as Dark's territory
        Light has 8 territories and 1 prisoner.
        The end result is therefore 18 - 9 for Dark.`,$localize`Failed, try again.`)]}}function P3(e,t){if(1&e&&(Cn(),fa(0,"circle",10)),2&e){const e=wa(2).index,t=wa().index;na("cx",25+50*e)("cy",25+50*t)("r",22)}}function O3(e,t){if(1&e){const e=ma();Cn(),ha(0,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index;na("x1",50*e)("y1",50*t)("x2",50+50*e)("y2",50+50*t)}}function T3(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",7),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,P3,1,3,"circle",8),oa(3,O3,1,4,"line",9),da()}if(2&e){const e=wa().index,t=wa().index,n=wa();Ts(1),la("ngClass",n.getSpaceClass(e,t)),na("cx",25+50*e)("cy",25+50*t)("r",22),Ts(1),la("ngIf",n.isLastCase(e,t)),Ts(1),la("ngIf",n.isDead(e,t))}}function I3(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",15),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2),t=e.index,n=e.$implicit,r=wa().index,i=wa();na("cx",25+50*t)("cy",25+50*r)("r",10)("class",n===i.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function k3(e,t){if(1&e){const e=ma();Cn(),ha(0,"rect",12),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),ha(1,"line",13),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"line",13),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),oa(3,I3,1,4,"circle",14)}if(2&e){const e=wa().index,t=wa().index,n=wa();Oa("id","click_",e,"_",t,""),na("x",50*e)("y",50*t),Ts(1),na("x1",50*e)("y1",25+50*t)("x2",50+50*e)("y2",25+50*t),Ts(1),na("x1",25+50*e)("y1",50*t)("x2",25+50*e)("y2",50+50*t),Ts(1),la("ngIf",n.isTerritory(e,t))}}function A3(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,T3,4,6,"g",5),oa(2,k3,4,13,"ng-template",null,6,Ru),da()),2&e){const e=t.index,n=aa(3),r=wa().index,i=wa();Ts(1),la("ngIf",i.caseIsFull(e,r))("ngIfElse",n)}}function N3(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,A3,4,2,"g",2),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function M3(e,t){if(1&e&&(Cn(),fa(0,"rect",16)),2&e){const e=wa();na("x",12.5+50*e.ko.get().x)("y",12.5+50*e.ko.get().y)}}function x3(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",17),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.x,t.y)}),da()}if(2&e){const e=t.$implicit;na("cx",25+50*e.x)("cy",25+50*e.y)("r",7)}}let R3=(()=>{class e extends hX{constructor(e){super(e),this.ko=gw.empty(),this.last=gw.empty(),this.captures=[],this.GoPiece=c3,this.scores=gw.of([0,0]),this.rules=new g3(u3),this.availableMinimaxes=[new y3(this.rules,"GoMinimax")],this.encoder=a3.encoder,this.tutorial=(new S3).tutorial,this.canPass=!0,this.updateBoard()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.last=gw.empty();const i=new a3(e,t);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){hw(e.VERBOSE,"updateBoard");const t=this.rules.node.gameState,n=this.rules.node.move,r=t.phase;this.board=t.getCopiedBoard(),this.scores=gw.of(t.getCapturedCopy()),this.ko=t.koCoord,n.isPresent()?this.showCaptures():this.captures=[],this.last=n.map(e=>e.coord),this.canPass=r!==l3.FINISHED}showCaptures(){const e=this.rules.node.mother.get().gameState;this.captures=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[0].length;n++){const r=new eQ(n,t),i=!1===e.getPieceAt(r).isEmpty(),s=this.board[t][n]===c3.EMPTY,o=!1===this.ko.equalsValue(r);i&&s&&o&&this.captures.push(r)}}pass(){var e=this;return lw(function*(){const t=e.rules.node.gameState.phase;return t===l3.PLAYING||t===l3.PASSED?e.onClick(a3.PASS.coord.x,a3.PASS.coord.y):(VG(t===l3.COUNTING||t===l3.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(a3.ACCEPT.coord.x,a3.ACCEPT.coord.y))})()}getSpaceClass(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}caseIsFull(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==c3.EMPTY&&!this.isTerritory(e,t)}isLastCase(e,t){if(this.last.isPresent()){const n=this.last.get();return e===n.x&&t===n.y}return!1}isDead(e,t){return this.rules.node.gameState.isDead(new eQ(e,t))}isTerritory(e,t){return this.rules.node.gameState.isTerritory(new eQ(e,t))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-go"]],features:[Ho],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),fa(1,"rect",1),oa(2,N3,2,1,"g",2),oa(3,M3,1,2,"rect",3),oa(4,x3,1,3,"circle",4),da()),2&e&&(na("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),Ts(1),na("width",50*t.board.length)("height",50*t.board.length),Ts(1),la("ngForOf",t.board),Ts(1),la("ngIf",t.ko.isPresent()),Ts(1),la("ngForOf",t.captures))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class D3{constructor(e,t,n){this.value=e,this.name=t,this.rgb=n}static of(e){switch(e){case 0:return D3.ANY;case 1:return D3.ORANGE;case 2:return D3.BLUE;case 3:return D3.PURPLE;case 4:return D3.PINK;case 5:return D3.YELLOW;case 6:return D3.RED;case 7:return D3.GREEN;default:return uw.expectToBe(e,8,"Invalid value "+e+" for KamisadoColor"),D3.BROWN}}}D3.ANY=new D3(0,"any","#000"),D3.ORANGE=new D3(1,"orange","#d67421"),D3.BLUE=new D3(2,"blue","#006bac"),D3.PURPLE=new D3(3,"purple","#6f3787"),D3.PINK=new D3(4,"pink","#d2719e"),D3.YELLOW=new D3(5,"yellow","#e2c200"),D3.RED=new D3(6,"red","#d23339"),D3.GREEN=new D3(7,"green","#009157"),D3.BROWN=new D3(8,"brown","#562500");class L3{constructor(e,t){this.player=e,this.color=t}static of(e,t){return new L3(e,D3.of(t))}static createPlayerColors(e){return{ORANGE:new L3(e,D3.ORANGE),BLUE:new L3(e,D3.BLUE),PURPLE:new L3(e,D3.PURPLE),PINK:new L3(e,D3.PINK),YELLOW:new L3(e,D3.YELLOW),RED:new L3(e,D3.RED),GREEN:new L3(e,D3.GREEN),BROWN:new L3(e,D3.BROWN)}}equals(e){return e.player===this.player&&e.color===this.color}isEmpty(){return this.player.equals(ZY.NONE)}belongsTo(e){return this.player===e}}L3.NONE=new L3(ZY.NONE,D3.ANY),L3.ZERO=L3.createPlayerColors(jY.ZERO),L3.ONE=L3.createPlayerColors(jY.ONE);class F3{static getColorAt(e,t){return F3.COLORS[t][e]}static getInitialBoard(){const e=L3.NONE;return[[1,2,3,4,5,6,7,8].map(e=>L3.of(jY.ONE,e)),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(e=>L3.of(jY.ZERO,e))]}static isEmptyAt(e,t){return e[t.y][t.x].equals(L3.NONE)}static allPieceCoords(e){const t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++){const i=new eQ(r,n);F3.isEmptyAt(e,i)||t.push(i)}return t}}F3.INITIAL=F3.getInitialBoard(),F3.SIZE=8,F3.COLORS=QY.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],D3.of);class B3 extends EX{constructor(e,t){super(e,t)}static of(e,t){if(e.isNotInRange(F3.SIZE,F3.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(F3.SIZE,F3.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new B3(e,t)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return this===B3.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}B3.PASS=new B3(new eQ(-2,-2),new eQ(-3,-3)),B3.encoder=new class extends qY{maxValue(){return 34952}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return B3.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new B3(new eQ((e=e/16|0)%16,r),new eQ(n,t))}};class U3 extends gQ{constructor(e,t,n,r,i){super(QY.copyBiArray(i),e),this.colorToPlay=t,this.coordToPlay=n,this.alreadyPassed=r}static getInitialState(){return new U3(0,D3.ANY,gw.empty(),!1,F3.INITIAL)}}let V3=(()=>{class e{}return e.NOT_RIGHT_COLOR=()=>$localize`This piece is not of the color you have to play.`,e.DIRECTION_NOT_ALLOWED=()=>$localize`You can only move forward, orthogonally or diagonally.`,e.MOVE_BLOCKED=()=>$localize`This move is blocked by another piece.`,e.PLAY_WITH_SELECTED_PIECE=()=>$localize`You must play with the selected piece.`,e})();class $3 extends OQ{static getColorMatchingPiece(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new eQ(0,7),new eQ(1,7),new eQ(2,7),new eQ(3,7),new eQ(4,7),new eQ(5,7),new eQ(6,7),new eQ(7,7)]}static getMovablePieces(e){return $3.getColorMatchingPiece(e).filter(t=>{for(const n of this.playerDirections(e.getCurrentPlayer())){const r=t.getNext(n);if(e.isOnBoard(r)&&F3.isEmptyAt(e.board,r))return!0}return!1})}static playerDirections(e){return e===jY.ONE?[QJ.DOWN,QJ.DOWN_LEFT,QJ.DOWN_RIGHT]:[QJ.UP,QJ.UP_LEFT,QJ.UP_RIGHT]}static directionAllowedForPlayer(e,t){return t===jY.ZERO?e.y<0:e.y>0}static getListMovesFromState(e){const t=$3.getMovablePieces(e);return 0===t.length?(VG(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[B3.PASS]):$3.getListMovesFromNonBlockedState(e,t)}static getListMovesFromNonBlockedState(e,t){const n=[],r=e.getCurrentPlayer();for(const i of t)for(const t of $3.playerDirections(r))for(let r=1;r<F3.SIZE;r++){const s=i.getNext(t,r);if(!e.isOnBoard(s)||!F3.isEmptyAt(e.board,s))break;{const e=B3.of(i,s);n.push(e)}}return n}static mustPass(e){return 0===this.getMovablePieces(e).length}static getFurthestPiecePositions(e){let t=7,n=0;return F3.allPieceCoords(e.board).forEach(r=>{const i=e.getPieceAt(r);VG(i!==L3.NONE,"allPieceCoords failed to filter KamisadoPiece.NONE"),i.player===jY.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}static isLegal(e,t){const n=e.coord,r=e.end,i=t.colorToPlay;if(e===B3.PASS)return this.isLegalPass(t);if($3.isVictory(t))return MG.failure("You should never see this message");const s=t.getPieceAt(n);if(!s.belongsTo(t.getCurrentPlayer()))return MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE());if(i!==D3.ANY&&s.color!==i)return MG.failure(V3.NOT_RIGHT_COLOR());if(!t.getPieceAt(r).isEmpty())return MG.failure(lQ.MUST_CLICK_ON_EMPTY_SPACE());const o=QJ.factory.fromMove(n,r);if(o.isFailure())return MG.failure(V3.DIRECTION_NOT_ALLOWED());const a=o.get();if(!$3.directionAllowedForPlayer(a,t.getCurrentPlayer()))return MG.failure(V3.DIRECTION_NOT_ALLOWED());let c=n;for(;!c.equals(r);)if(c=c.getNext(a),!t.getPieceAt(c).isEmpty())return MG.failure(V3.MOVE_BLOCKED());return MG.success(void 0)}static isLegalPass(e){return this.mustPass(e)&&!e.alreadyPassed?MG.success(void 0):MG.failure(lQ.CANNOT_PASS())}static isVictory(e){const[t,n]=this.getFurthestPiecePositions(e);return 0===t||7===n}nextCoordToPlay(e,t){return gw.ofNullable(F3.allPieceCoords(e.board).find(n=>{const r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}applyLegalMove(e,t,n){if(e===B3.PASS){const e=this.nextCoordToPlay(t,t.colorToPlay);return new U3(t.turn+1,t.colorToPlay,e,!0,t.board)}const r=e.coord,i=e.end,s=t.getCopiedBoard();s[i.y][i.x]=s[r.y][r.x],s[r.y][r.x]=L3.NONE;const o=F3.getColorAt(i.x,i.y),a=this.nextCoordToPlay(t,o);return new U3(t.turn+1,o,a,!1,s)}isLegal(e,t){return $3.isLegal(e,t)}getGameStatus(e){const t=e.gameState,n=t.getCurrentPlayer();if($3.mustPass(t)&&t.alreadyPassed)return PQ.getDefeat(n);const[r,i]=$3.getFurthestPiecePositions(t);return 7===i?PQ.ONE_WON:0===r?PQ.ZERO_WON:PQ.ONGOING}}class z3 extends uQ{getListMoves(e){const t=$3.getListMovesFromState(e.gameState);return QY.sortByDescending(t,e=>e.length()),t}getBoardValue(e){const t=e.gameState,n=t.getCurrentPlayer();if($3.mustPass(t)&&t.alreadyPassed)return new hQ(n.getDefeatValue());const[r,i]=$3.getFurthestPiecePositions(t);return new hQ(7===i?jY.ONE.getVictoryValue():0===r?jY.ZERO.getVictoryValue():i-(7-r))}}const H3=L3.NONE,G3=L3.ZERO.ORANGE,q3=L3.ONE.ORANGE,W3=L3.ZERO.BLUE,j3=L3.ONE.BLUE,Z3=L3.ZERO.PURPLE,Y3=L3.ONE.PURPLE,K3=L3.ZERO.PINK,J3=L3.ONE.PINK,Q3=L3.ZERO.YELLOW,X3=L3.ONE.YELLOW,e4=L3.ZERO.RED,t4=L3.ONE.RED,n4=L3.ZERO.GREEN,r4=L3.ONE.GREEN,i4=L3.ZERO.BROWN,s4=L3.ONE.BROWN;class o4{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`At Kamisado, there are two ways to win the game:
        either by moving one of your pieces on the opponent's starting line,
        or by forcing the opponent to make a move that blocks the entire game.
        Here, Dark wins because its brown piece is on Light's starting line, on the top left.`,new U3(5,D3.ORANGE,gw.empty(),!1,[[i4,j3,Y3,J3,X3,t4,r4,s4],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,q3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,n4,e4,Q3,K3,Z3,W3,G3]])).withPreviousMove(B3.of(new eQ(0,7),new eQ(0,0))),AQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
        At Kamisado, pieces can only move forward, vertically or diagonally.
        You're playing first, with dark pieces, you can make your first move.<br/><br/>
        Click on the piece of your choice and click on the landing square.`,U3.getInitialState(),B3.of(new eQ(7,7),new eQ(3,3)),$localize`Perfect! Note that each of your piece has a different color.`),AQ.fromMove($localize`Moving`,$localize`Let us now consider the move of Light, after the blue piece has been moved by Dark.
        All moves after the initial move must be made from the piece that corresponds to the color
        of the square upon which the last move ended.
        Here, the last move ended on the pink square, hence the pink piece must move.
        It is already selected, you do not have to click on it.<br/><br/>
        Move it on a blue square.`,new U3(1,D3.PINK,gw.of(new eQ(3,0)),!1,[[q3,j3,Y3,J3,X3,t4,r4,s4],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,W3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[i4,n4,e4,Q3,K3,Z3,H3,G3]]),[B3.of(new eQ(3,0),new eQ(3,6)),B3.of(new eQ(3,0),new eQ(4,1))],$localize`Congratulations!`,$localize`You have not moved your pink piece on a blue square!`).withPreviousMove(B3.of(new eQ(6,7),new eQ(6,5))),AQ.informational($localize`Stuck situation`,$localize`Dark moved to another pink square, hence you have to move your pink piece again.
        However, your pink piece is stuck! In this case, you must pass your turn.
        Dark will now have to play by moving its pink piece.`,new U3(1,D3.PINK,gw.of(new eQ(3,6)),!1,[[q3,j3,Y3,H3,X3,t4,r4,s4],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,H3,W3],[H3,H3,H3,H3,H3,H3,H3,H3],[H3,H3,H3,J3,H3,H3,H3,H3],[i4,n4,e4,Q3,K3,Z3,H3,G3]])).withPreviousMove(B3.of(new eQ(6,5),new eQ(7,4))),AQ.fromMove($localize`Victory by blocking`,$localize`At any time, if a player blocks the entire game, that player loses.
        In other words, if a player forces its opponent to move a piece that the opponent cannot move,
        and the player cannot move its own piece of the same color, then that player loses.
        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>
        Try to make this move.`,new U3(2,D3.RED,gw.of(new eQ(2,4)),!1,[[H3,j3,Y3,H3,H3,t4,H3,H3],[H3,H3,H3,X3,H3,H3,H3,H3],[H3,H3,H3,J3,H3,Y3,H3,H3],[H3,H3,H3,Q3,H3,H3,H3,H3],[H3,H3,e4,H3,H3,H3,H3,H3],[H3,H3,H3,H3,H3,H3,r4,H3],[q3,H3,H3,H3,H3,K3,H3,s4],[i4,n4,H3,H3,H3,H3,W3,G3]]),[B3.of(new eQ(2,4),new eQ(0,2))],$localize`Perfect!
         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.
         Your orange piece will be stuck and you will have to pass your turn.
         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.
         In this case, the last player to have moved a piece loses.
         Here, your opponent will have moved its green piece last, you therefore win!`,$localize`Failed!`).withPreviousMove(B3.of(new eQ(4,0),new eQ(3,1)))]}}function a4(e,t){if(1&e&&(Cn(),fa(0,"circle",8)),2&e){const e=wa(),t=e.index,n=e.$implicit,r=wa().index,i=wa();na("cx",i.SPACE_SIZE/2+t*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("fill",i.pieceColor(n))("r",i.SPACE_SIZE/3)}}function c4(e,t){if(1&e&&(Cn(),fa(0,"rect",9)),2&e){const e=wa(),t=e.$implicit,n=e.index,r=wa().index,i=wa();la("ngClass",i.piecePlayerClass(t)),na("x",i.SPACE_SIZE/2+n*i.SPACE_SIZE-i.SPACE_SIZE/8)("y",i.SPACE_SIZE/2+r*i.SPACE_SIZE-i.SPACE_SIZE/8)("rx",i.isPlayerZero(t)?i.SPACE_SIZE:0)("ry",i.isPlayerZero(t)?i.SPACE_SIZE:0)("width",i.SPACE_SIZE/4)("height",i.SPACE_SIZE/4)}}function l4(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"g",4),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),fa(2,"rect",5),oa(3,a4,1,4,"circle",6),oa(4,c4,1,7,"rect",7),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","click_",n,"_",r,""),Ts(1),na("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)("fill",i.backgroundColor(n,r)),Ts(1),la("ngIf",e!==i.UNOCCUPIED),Ts(1),la("ngIf",e!==i.UNOCCUPIED)}}function u4(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,l4,5,9,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function h4(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"rect",10),fa(2,"rect",10),da()),2&e){const e=wa();Ts(1),na("x",e.lastMove.get().coord.x*e.SPACE_SIZE)("y",e.lastMove.get().coord.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE),Ts(1),na("x",e.lastMove.get().end.x*e.SPACE_SIZE)("y",e.lastMove.get().end.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function d4(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa();na("cx",e.SPACE_SIZE/2+e.chosen.get().x*e.SPACE_SIZE)("cy",e.SPACE_SIZE/2+e.chosen.get().y*e.SPACE_SIZE)}}let f4=(()=>{class e extends hX{constructor(e){super(e),this.UNOCCUPIED=L3.NONE,this.lastMove=gw.empty(),this.chosen=gw.empty(),this.chosenAutomatically=!1,this.rules=new $3(U3),this.availableMinimaxes=[new z3(this.rules,"KamisadoMinimax")],this.encoder=B3.encoder,this.tutorial=(new o4).tutorial,this.canPass=!1,this.updateBoard()}backgroundColor(e,t){return F3.getColorAt(e,t).rgb}isPlayerZero(e){return e.player===jY.ZERO}pieceColor(e){return e.color.rgb}piecePlayerClass(e){return this.getPlayerClass(e.player)}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=$3.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=gw.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}pass(){var e=this;return lw(function*(){return VG(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(B3.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new eQ(e,t);if(n.canPass)return n.cancelMove(lQ.MUST_PASS());if(n.chosen.isAbsent())return n.choosePiece(e,t);if(!1===n.chosenAutomatically&&n.chosen.equalsValue(i))return n.cancelMoveAttempt(),DG.SUCCESS;{const r=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer();return r.belongsTo(s)?n.chosenAutomatically?n.cancelMove(V3.PLAY_WITH_SELECTED_PIECE()):(n.chosen=gw.of(i),DG.SUCCESS):yield n.chooseDestination(e,t)}})()}choosePiece(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=gw.of(new eQ(e,t)),DG.SUCCESS)}chooseDestination(e,t){var n=this;return lw(function*(){const r=n.chosen.get(),i=new eQ(e,t),s=B3.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}cancelMoveAttempt(){this.chosenAutomatically||(this.chosen=gw.empty())}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-kamisado"]],features:[Ho],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,u4,2,1,"g",1),oa(2,h4,3,8,"g",2),oa(3,d4,1,2,"circle",3),da()),2&e&&(na("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),Ts(1),la("ngForOf",t.board),Ts(1),la("ngIf",t.lastMove.isPresent()),Ts(1),la("ngIf",t.chosen.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),p4=(()=>{class e extends gQ{static getInitialState(){const t=ZY.NONE,n=jY.ZERO,r=jY.ONE;return new e([[t,n,n,n,n,n,n,t],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[t,n,n,n,n,n,n,t]],0)}static isOnBoard(t){return t.isInRange(e.SIZE,e.SIZE)}}return e.SIZE=8,e})();class g4 extends EX{constructor(e,t,n){super(e,t),this.direction=n,this.direction=QJ.factory.fromMove(e,t).get()}static of(e,t){const n=QJ.factory.fromMove(e,t);return n.isFailure()?MG.failure(n.getReason()):e.isNotInRange(p4.SIZE,p4.SIZE)?MG.failure("start coord is not in range"):t.isNotInRange(p4.SIZE,p4.SIZE)?MG.failure("end coord is not in range"):MG.success(new g4(e,t,n.get()))}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}encode(){return g4.encoder.encode(this)}decode(e){return g4.encoder.decode(e)}}g4.encoder=EX.getEncoder(p4.SIZE,p4.SIZE,(e,t)=>g4.of(e,t).get());let m4=(()=>{class e{}return e.INVALID_MOVE_LENGTH=()=>$localize`Your move should have a length equal to the number of pieces that exist on the same line.`,e.CANNOT_JUMP_OVER_OPPONENT=()=>$localize`You cannot jump over the opponent's pieces.`,e.PIECE_CANNOT_MOVE=()=>$localize`This piece has no possible move, select another one.`,e.INVALID_DIRECTION=()=>$localize`A move must be orthogonal or diagonal`,e})();class y4 extends OQ{static getListMovesFromState(e){const t=[];if(y4.getVictory(e).isPresent())return t;for(let n=0;n<p4.SIZE;n++)for(let r=0;r<p4.SIZE;r++){const i=new eQ(r,n);if(e.getPieceAt(i).isPlayer())for(const n of y4.possibleTargets(e,i)){const e=g4.of(i,n).get();t.push(e)}}return t}static getNumberOfGroups(e){const t=QY.createTable(p4.SIZE,p4.SIZE,-1),n=[0,0];let r=0;for(let i=0;i<p4.SIZE;i++)for(let s=0;s<p4.SIZE;s++)if(-1===t[i][s]){const o=e.getPieceAt(new eQ(s,i));o.isPlayer()&&(r+=1,y4.markGroupStartingAt(e,t,new eQ(s,i),r),n[o.value]+=1)}return n}static markGroupStartingAt(e,t,n,r){const i=[n],s=e.getPieceAt(n);for(;i.length>0;){const n=uw.getNonNullable(i.pop());if(-1===t[n.y][n.x]){const o=e.getPieceAt(n);if(o===s){t[n.y][n.x]=r;for(const t of QJ.DIRECTIONS){const r=n.getNext(t);e.isOnBoard(r)&&i.push(r)}}else o===ZY.NONE&&(t[n.y][n.x]=0)}}}applyLegalMove(e,t,n){const r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=ZY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new p4(r,t.turn+1)}static isLegal(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?MG.failure(m4.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(e=>t.getPieceAt(e)===t.getCurrentOpponent())?MG.failure(m4.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?MG.failure(lQ.CANNOT_SELF_CAPTURE()):MG.success(void 0)}isLegal(e,t){return y4.isLegal(e,t)}static numberOfPiecesOnLine(e,t,n){let r=0;for(const i of y4.getLineCoords(t,n))e.getPieceAt(i).isPlayer()&&(r+=1);return r}static getLineCoords(e,t){const n=y4.getEntranceAndForwardDirection(e,t);let r=n[0];const i=n[1],s=[];for(;p4.isOnBoard(r);)s.push(r),r=r.getNext(i);return s}static getEntranceAndForwardDirection(e,t){switch(t){case QJ.UP:case QJ.DOWN:return[new eQ(e.x,0),QJ.DOWN];case QJ.LEFT:case QJ.RIGHT:return[new eQ(0,e.y),QJ.RIGHT];case QJ.UP_RIGHT:case QJ.DOWN_LEFT:return[new eQ(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),QJ.UP_RIGHT];default:return uw.expectToBeMultiple(t,[QJ.UP_LEFT,QJ.DOWN_RIGHT]),[new eQ(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),QJ.DOWN_RIGHT]}}static getVictory(e){const[t,n]=y4.getNumberOfGroups(e);return 1===t&&1===n?gw.of(ZY.NONE):1===t?gw.of(jY.ZERO):1===n?gw.of(jY.ONE):gw.empty()}static possibleTargets(e,t){const n=[];for(const r of QJ.DIRECTIONS){const i=y4.numberOfPiecesOnLine(e,t,r),s=t.getNext(r,i);if(e.isOnBoard(s)){const r=g4.of(t,s).get();y4.isLegal(r,e).isSuccess()&&n.push(s)}}return n}getGameStatus(e){const t=e.gameState,[n,r]=y4.getNumberOfGroups(t);return 1===n&&r>1?PQ.ZERO_WON:n>1&&1===r?PQ.ONE_WON:PQ.ONGOING}}class v4 extends uQ{getListMoves(e){return y4.getListMovesFromState(e.gameState)}getBoardValue(e){const t=e.gameState,[n,r]=y4.getNumberOfGroups(t);return new hQ(1===n&&r>1?jY.ZERO.getVictoryValue():n>1&&1===r?jY.ONE.getVictoryValue():100/n*jY.ZERO.getScoreModifier()+100/r*jY.ONE.getScoreModifier())}}const _4=ZY.NONE,C4=jY.ZERO,E4=jY.ONE;class w4{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.
        Here, Dark wins the game:
        Dark's pieces are forming a single group, while Light's pieces form three groups.`,new p4([[_4,_4,_4,_4,_4,_4,_4,_4],[E4,_4,_4,_4,C4,_4,_4,E4],[_4,_4,C4,C4,E4,_4,_4,_4],[_4,_4,_4,C4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4]],0)),AQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
         Moves can be made orthogonally or diagonally.
         The length of a move is equal to the number of pieces that are on the line of the move.
         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>
         You're playing Dark, make the first move!`,p4.getInitialState(),g4.of(new eQ(1,7),new eQ(1,5)).get(),$localize`Congratulations!`),AQ.fromMove($localize`Jumping`,$localize`During a move, it is possible to jump above your own pieces.
        But it is forbidden to jump over the opponent's pieces.<br/><br/>
        You're playing Dark, make a jump over one of your pieces on the following board.`,new p4([[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,E4,C4,C4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,_4,_4,C4]],0),[g4.of(new eQ(3,1),new eQ(6,1)).get()],$localize`Congratulations!`,$localize`Failed. You did not jump over one of your pieces.`),AQ.fromMove($localize`Moving`,$localize`Here is a different board. Pick the dark piece in the middle (line 4, column 4)
        and observe its possible moves.
        Horizontally, this piece can move only of one square because it is the only piece on this line.
        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.
        But it can only go up, as below it the landing square is occupied by one of your pieces.
        Diagonally, only one move is possible: on the diagonal that contains three pieces,
        only in the direction where it does not jump over one of the opponent's pieces.
        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>
        Make one of these moves.`,new p4([[_4,_4,_4,_4,_4,_4,E4,_4],[_4,_4,_4,_4,_4,C4,_4,_4],[_4,_4,_4,_4,E4,_4,_4,_4],[_4,_4,_4,C4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,E4,_4,E4],[_4,_4,_4,C4,_4,_4,E4,E4],[_4,_4,_4,C4,_4,_4,_4,_4]],0),[g4.of(new eQ(3,3),new eQ(3,0)).get(),g4.of(new eQ(3,3),new eQ(0,0)).get(),g4.of(new eQ(3,3),new eQ(2,3)).get(),g4.of(new eQ(3,3),new eQ(4,3)).get()],$localize`Congratulations!`,$localize`Failed. This was not one of the expected moves.`),AQ.fromMove($localize`Capturing`,$localize`If a move ends on an opponent's pieces, this one is captured and removed from the board.
        However, a move cannot end on one of the player's pieces.
        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!
        If a player has only one piece, that player wins the game.<br/><br/>
        On the following board, try to capture one piece with Dark.`,new p4([[_4,C4,_4,C4,C4,C4,C4,_4],[E4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,C4,_4,E4,_4,_4,_4],[E4,_4,_4,_4,_4,_4,_4,E4],[E4,_4,_4,_4,_4,_4,_4,E4],[E4,_4,_4,_4,_4,_4,_4,E4],[E4,_4,_4,_4,_4,_4,_4,E4],[_4,C4,C4,C4,C4,C4,C4,_4]],0),[g4.of(new eQ(2,2),new eQ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`),AQ.fromMove($localize`Tie`,$localize`In the special case where a move ends up connecting all pieces of both player, simultaneously,
        then the game ends up with a tie.<br/><br/>
        You're playing Dark, force the tie in one move.`,new p4([[_4,_4,_4,_4,_4,_4,_4,_4],[_4,_4,_4,_4,_4,_4,_4,_4],[C4,_4,_4,C4,E4,C4,_4,_4],[_4,_4,_4,C4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,_4,_4,E4],[_4,_4,_4,_4,_4,_4,_4,_4]],0),[g4.of(new eQ(0,2),new eQ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`)]}}function b4(e,t){if(1&e&&(Cn(),fa(0,"circle",5)),2&e){const e=wa().index,t=wa().index,n=wa();la("ngClass",n.getPieceClasses(e,t)),na("cx",n.SPACE_SIZE/2+e*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+t*n.SPACE_SIZE)}}function S4(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"g",2),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),fa(2,"rect",3),oa(3,b4,1,3,"circle",4),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","click_",n,"_",r,""),Ts(1),la("ngClass",i.getSquareClasses(n,r)),na("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngIf",e!==i.EMPTY)}}function P4(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,S4,4,8,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function O4(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",6),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.x,t.y)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),na("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}let T4=(()=>{class e extends hX{constructor(e){super(e),this.INDICATOR_SIZE=20,this.EMPTY=ZY.NONE,this.targets=[],this.selected=gw.empty(),this.lastMove=gw.empty(),this.captured=gw.empty(),this.rules=new y4(p4),this.availableMinimaxes=[new v4(this.rules,"LinesOfActionMinimax")],this.encoder=g4.encoder,this.tutorial=(new w4).tutorial,this.updateBoard()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new eQ(e,t);if(n.selected.isPresent()){if(n.getState().getPieceAt(i)===n.getState().getCurrentPlayer())return n.select(i);{const r=g4.of(n.selected.get(),new eQ(e,t));return r.isSuccess()?n.chooseMove(r.get(),n.rules.node.gameState):n.cancelMove(m4.INVALID_DIRECTION())}}return n.select(i)})()}select(e){var t=this;return lw(function*(){return t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=gw.of(e),t.targets=y4.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(m4.PIECE_CANNOT_MOVE()):DG.SUCCESS)})()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}updateBoard(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end).isPlayer()?gw.of(e.end):gw.empty()}}cancelMoveAttempt(){this.selected=gw.empty(),this.targets=[]}getSquareClasses(e,t){const n=new eQ(e,t);if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(e)||n.equals(t))return["moved"]}return[]}getPieceClasses(e,t){const n=this.board[t][e],r=new eQ(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-linesofaction"]],features:[Ho],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["r","40","class","base",3,"ngClass",4,"ngIf"],["r","40",1,"base",3,"ngClass"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,P4,2,1,"g",1),oa(2,O4,2,4,"g",1),da()),2&e&&(Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.targets))},directives:[Ud,Fd,$d],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();const I4=Number.MAX_SAFE_INTEGER,k4=Number.MIN_SAFE_INTEGER;class A4 extends gQ{constructor(e,t){super(QY.copyBiArray(A4.initialBoard),e),this.turn=e,this.location=t}static getInitialState(){return new A4(0,new eQ(0,0))}}A4.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],A4.BOARD_1=[[0,+I4,-1,-1],[1,2,+I4,-1],[+k4,3,4,-1],[-1,+k4,+k4,-1]],A4.BOARD_2=[[0,+I4,-1,-1],[+I4,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],A4.BOARD_3=[[0,1,+k4,-1],[1,+k4,-1,-1],[+k4,-1,-1,-1],[-1,-1,-1,-1]],A4.BOARD_4=[[0,1,+k4,-1],[1,+k4,-1,-1],[+k4,-1,-1,-1],[-1,-1,-1,1]],A4.initialBoard=A4.BOARD_0;class N4 extends OQ{static getGameStatus(e){const t=e.gameState,n=t.getPieceAt(t.location);return n===jY.ZERO.getVictoryValue()?PQ.ZERO_WON:n===jY.ONE.getVictoryValue()?PQ.ONE_WON:t.location.equals(new eQ(3,3))?0===n?PQ.DRAW:n>0?PQ.ONE_WON:PQ.ZERO_WON:PQ.ONGOING}applyLegalMove(e,t,n){const r=new eQ(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new A4(t.turn+1,r)}isLegal(e,t){const n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?MG.failure("incorrect move"):MG.success(void 0)}getGameStatus(e){return N4.getGameStatus(e)}}class M4 extends yQ{constructor(e){super(),this.right=e}equals(e){return this===e||this.right===e.right}toString(){return this.right?"Move RIGHT":"Move DOWN"}}M4.RIGHT=new M4(!0),M4.DOWN=new M4(!1),M4.encoder=new class extends qY{maxValue(){return 1}decodeNumber(e){return 0===e?M4.RIGHT:M4.DOWN}encodeNumber(e){return e.right?0:1}};class x4 extends uQ{getBoardValue(e){const t=N4.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());const n=e.gameState;return new hQ(n.getPieceAt(n.location))}getListMoves(e){const t=[],n=e.gameState;return n.location.x<3&&t.push(M4.RIGHT),n.location.y<3&&t.push(M4.DOWN),t}}function R4(e,t){1&e&&(pa(0),Da(1,"("),ga())}function D4(e,t){1&e&&(pa(0),Da(1,")"),ga())}function L4(e,t){if(1&e&&(ha(0,"td"),oa(1,R4,2,0,"ng-container",3),Da(2),oa(3,D4,2,0,"ng-container",3),da()),2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),la("ngIf",i.coord.x===n&&i.coord.y===r),Ts(1),Fa(" ",e," "),Ts(1),la("ngIf",i.coord.x===n&&i.coord.y===r)}}function F4(e,t){if(1&e&&(ha(0,"tr"),oa(1,L4,4,3,"td",0),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let B4=(()=>{class e extends hX{constructor(e){super(e),this.coord=new eQ(-1,-1),this.rules=new N4(A4),this.availableMinimaxes=[new x4(this.rules,"MinimaxTestingMinimax")],this.encoder=M4.encoder}chooseRight(){var e=this;return lw(function*(){const t=e.canUserPlay("#click_right");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(M4.RIGHT,e.rules.node.gameState)})()}chooseDown(){var e=this;return lw(function*(){const t=e.canUserPlay("#click_down");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(M4.DOWN,e.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-minimax-testing"]],features:[Ho],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(ha(0,"table"),oa(1,F4,2,1,"tr",0),ha(2,"div",1),_a("click",function(){return t.chooseRight()}),Da(3," goRight "),da(),ha(4,"div",2),_a("click",function(){return t.chooseDown()}),Da(5," goDown "),da(),ha(6,"div"),Da(7),da(),da()),2&e&&(Ts(1),la("ngForOf",t.board),Ts(6),Fa(" ",t.coord," "))},directives:[Ud,$d],encapsulation:2}),e})();class U4 extends gQ{static getInitialState(){const e=QY.createTable(7,6,ZY.NONE);return new U4(e,0)}}class V4 extends yQ{constructor(e){super(),this.x=e}static of(e){switch(e){case 0:return V4.ZERO;case 1:return V4.ONE;case 2:return V4.TWO;case 3:return V4.THREE;case 4:return V4.FOUR;case 5:return V4.FIVE;case 6:return V4.SIX;default:throw new Error("Invalid P4Move")}}equals(e){return this===e}toString(){return"P4Move("+this.x+")"}}V4.ZERO=new V4(0),V4.ONE=new V4(1),V4.TWO=new V4(2),V4.THREE=new V4(3),V4.FOUR=new V4(4),V4.FIVE=new V4(5),V4.SIX=new V4(6),V4.encoder=new class extends qY{maxValue(){return 6}encodeNumber(e){return e.x}decodeNumber(e){return V4.of(e)}};let $4=(()=>{class e{}return e.COLUMN_IS_FULL=()=>$localize`Please put your piece in an incomplete column.`,e})(),z4=(()=>{class e extends OQ{static getVictoriousCoords(t){const n=[];for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new eQ(r,i));(s===jY.ZERO.getVictoryValue()||s===jY.ONE.getVictoryValue())&&n.push(new eQ(r,i))}return n}static getBoardValueFromScratch(t){hw(e.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:t}});let n=0;for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new eQ(r,i));if(SQ.getScoreStatus(s)!==CQ.DEFAULT)return hw(e.VERBOSE,{preVictoryOrVictory:{state:t,tmpScore:s,coord:{x:r,y:i}}}),new hQ(s);n+=s}return new hQ(n)}static getLowestUnoccupiedCase(e,t){let n=0;for(;n<6&&e[n][t]===ZY.NONE;)n++;return n-1}static getNumberOfFreeSpacesAndAllies(e,t,n,r,i){let s=0,o=0,a=!0,c=new eQ(t.x+n.x,t.y+n.y);for(;c.isInRange(7,6)&&3!==s;){const t=e[c.y][c.x];if(t===r)return[s,o];t===i&&a?o++:a=!1,t!==r&&t!==i&&s++,c=c.getNext(n)}return[s,o]}static getOpponent(e,t){const n=e[t.y][t.x];return VG(n.isPlayer(),"getOpponent should not be called with PlayerOrNone.NONE"),n===jY.ONE?jY.ZERO:jY.ONE}static getSquareScore(t,n){hw(e.VERBOSE,"getSquareScore(board, "+n.x+", "+n.y+") called"),hw(e.VERBOSE,t);let r=0;const i=e.getOpponent(t,n),s=i.getOpponent(),o=new EQ,a=new EQ;for(const c of QJ.DIRECTIONS){const r=e.getNumberOfFreeSpacesAndAllies(t,n,c,i,s);o.set(c,r[0]),a.set(c,r[1])}for(const c of[QJ.UP,QJ.UP_RIGHT,QJ.RIGHT,QJ.DOWN_RIGHT]){const i=a.get(c).get()+a.get(c.getOpposite()).get();if(i>2)return hw(e.VERBOSE,{text:"there is some kind of victory here ("+n.x+", "+n.y+")\nline allies : "+i+"\n",board:t}),s.getVictoryValue();const l=o.get(c).get()+o.get(c.getOpposite()).get();3===l?r+=2:l>3&&(r+=l-2)}return r*s.getScoreModifier()}static getListMoves(t){hw(e.VERBOSE,{context:"P4Rules.getListMoves",node:t});const n=t.gameState,r=[];for(let e=0;e<7;e++)if(n.getPieceAtXY(e,0)===ZY.NONE){const t=V4.of(e);r.push(t)}return r}static getBoardValue(t){return hw(e.VERBOSE,{text:"P4Rules.getBoardValue called",board:t.getCopiedBoard()}),e.getBoardValueFromScratch(t)}applyLegalMove(t,n,r){const i=t.x,s=n.getCopiedBoard(),o=e.getLowestUnoccupiedCase(s,i),a=n.turn;return s[o][i]=n.getCurrentPlayer(),new U4(s,a+1)}isLegal(t,n){return hw(e.VERBOSE,{context:"P4Rules.isLegal",move:t.toString(),state:n}),n.getPieceAtXY(t.x,0).isPlayer()?MG.failure($4.COLUMN_IS_FULL()):MG.success(void 0)}getGameStatus(t){const n=t.gameState;for(let r=0;r<7;r++)for(let t=5;t>=0&&n.board[t][r].isPlayer();t--){const i=e.getSquareScore(n.board,new eQ(r,t));if(SQ.getScoreStatus(i)===CQ.VICTORY)return PQ.getVictory(n.getCurrentOpponent())}return 42===n.turn?PQ.DRAW:PQ.ONGOING}}return e.VERBOSE=!1,e})();class H4 extends uQ{getListMoves(e){return z4.getListMoves(e)}getBoardValue(e){const t=e.gameState;return hw(z4.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),z4.getBoardValue(t)}}const G4=jY.ZERO,q4=jY.ONE,W4=ZY.NONE;class j4{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.
        The first player plays Dark, the second plays Light.
        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally).`,U4.getInitialState()),AQ.anyMove($localize`Dropping a piece`,$localize`Click on any space in any column.`,U4.getInitialState(),V4.THREE,$localize`As you can see, the piece falls at the bottom of the column.`),AQ.fromMove($localize`Victory`,$localize`You're playing Dark.
        Place your piece so that you create a horizontal alignment of 4 of your pieces.`,new U4([[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,q4,W4,W4,W4],[W4,W4,W4,q4,W4,W4,W4],[W4,W4,G4,G4,G4,q4,W4]],0),[V4.of(1)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`),AQ.fromMove($localize`Other victory`,$localize`You can also align 4 pieces diagonally or vertically.`,new U4([[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,W4,W4,W4,W4],[W4,W4,W4,G4,q4,W4,W4],[W4,W4,G4,G4,q4,W4,W4],[W4,G4,q4,G4,G4,W4,W4]],0),[V4.of(3),V4.of(4)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`)]}}function Z4(e,t){if(1&e&&(Cn(),fa(0,"circle",6)),2&e){const e=wa().index,t=wa().index,n=wa();la("ngClass",n.getSquareFillClass(e,t)),na("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function Y4(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",4),_a("click",function(){const t=Gt(e).index;return wa(2).onClick(t)}),da(),oa(2,Z4,1,4,"circle",5),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Pa("id","click_",n,""),na("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngIf",e!=i.EMPTY_CASE)}}function K4(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,Y4,3,6,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function J4(e,t){if(1&e&&(Cn(),fa(0,"rect",7)),2&e){const e=wa();na("x",e.SPACE_SIZE*e.last.get().x)("y",e.SPACE_SIZE*e.last.get().y)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function Q4(e,t){if(1&e&&(Cn(),fa(0,"rect",8)),2&e){const e=t.$implicit,n=wa();Oa("id","victory_coord_",e.x,"_",e.y,""),na("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let X4=(()=>{class e extends hX{constructor(e){super(e),this.EMPTY_CASE=ZY.NONE,this.victoryCoords=[],this.rules=new z4(U4),this.availableMinimaxes=[new H4(this.rules,"P4Minimax")],this.encoder=V4.encoder,this.tutorial=(new j4).tutorial,this.updateBoard()}onClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#click_"+e);if(n.isFailure())return t.cancelMove(n.getReason());const r=V4.of(e);return yield t.chooseMove(r,t.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=z4.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}showLastMove(){const e=this.rules.node.move,t=z4.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=gw.of(new eQ(e.get().x,t))}hideLastMove(){this.last=gw.empty()}getSquareFillClass(e,t){return[this.getPlayerClass(this.board[t][e])]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-p4"]],features:[Ho],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[1,"base",3,"id","click"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,K4,2,1,"g",1),oa(2,J4,1,4,"rect",2),oa(3,Q4,1,6,"rect",3),da()),2&e&&(Ts(1),la("ngForOf",t.board),Ts(1),la("ngIf",t.last.isPresent()),Ts(1),la("ngForOf",t.victoryCoords))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class e5 extends vQ{constructor(e,t,n,r=!1){if(super(e,t),this.blockTurned=n,this.turnedClockwise=r,this.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+this.coord.toString())}static withRotation(e,t,n,r){if(n<0||3<n)throw new Error("This block do not exist: "+n);return new e5(e,t,gw.of(n),r)}static rotationless(e,t){return new e5(e,t,gw.empty())}toString(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}e5.encoder=new class extends GY{encodeMove(e){const t={coord:eQ.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}decodeMove(e){const t=e,n=eQ.encoder.decode(t.coord),r=gw.ofNullable(t.blockTurned);if(r.isPresent()){const e=t.turnedClockwise;return e5.withRotation(n.x,n.y,r.get(),e)}return e5.rotationless(n.x,n.y)}};let t5=(()=>{class e{}return e.CANNOT_ROTATE_NEUTRAL_BLOCK=()=>$localize`If the quadrant to turn is neutral, please just use move without rotation.`,e.MUST_CHOOSE_BLOCK_TO_ROTATE=()=>$localize`No quadrant is neutral, you must pick a quadrant to rotate.`,e})();class n5 extends gQ{constructor(e,t){super(e,t),this.neutralBlocks=this.getBlocksNeutralities()}static getInitialState(){const e=QY.createTable(6,6,ZY.NONE);return new n5(e,0)}getBlocksNeutralities(){const e=[];for(let t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}getBlockNeutrality(e){const t=n5.getBlockCenter(e),n=this.getPieceAt(t.getNext(QJ.UP,1)),r=this.getPieceAt(t.getNext(QJ.UP_LEFT,1));return this.getPieceAt(t.getNext(QJ.RIGHT,1))===n&&this.getPieceAt(t.getNext(QJ.DOWN,1))===n&&this.getPieceAt(t.getNext(QJ.LEFT,1))===n&&this.getPieceAt(t.getNext(QJ.UP_RIGHT,1))===r&&this.getPieceAt(t.getNext(QJ.DOWN_RIGHT,1))===r&&this.getPieceAt(t.getNext(QJ.DOWN_LEFT,1))===r}static getBlockCenter(e){return new eQ(1+(e%2==0?0:3),1+(e<2?0:3))}applyLegalDrop(e){const t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new n5(t,this.turn)}applyLegalMove(e){const t=this.applyLegalDrop(e),n=t.getCopiedBoard();if(e.blockTurned.isPresent()){const r=n5.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise)for(const e of n5.ROTATION_MAP){const i=e[0].getNext(r),s=e[1].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}else for(const e of n5.ROTATION_MAP){const i=e[1].getNext(r),s=e[0].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}}return new n5(n,this.turn+1)}blockIsNeutral(e){return this.neutralBlocks.includes(e)}}n5.ROTATION_MAP=[[new eQ(-1,-1),new eQ(1,-1)],[new eQ(0,-1),new eQ(1,0)],[new eQ(1,-1),new eQ(1,1)],[new eQ(1,0),new eQ(0,1)],[new eQ(1,1),new eQ(-1,1)],[new eQ(0,1),new eQ(-1,0)],[new eQ(-1,1),new eQ(-1,-1)],[new eQ(-1,0),new eQ(0,-1)]];class r5 extends OQ{static get(){return r5.singleton.isAbsent()&&(r5.singleton=gw.of(new r5(n5))),r5.singleton.get()}applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){if(t.getPieceAt(e.coord).isPlayer())return MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return MG.failure(t5.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){const t=e.blockTurned.get();if(n.neutralBlocks.includes(t))return MG.failure(t5.CANNOT_ROTATE_NEUTRAL_BLOCK())}return MG.success(void 0)}getVictoryCoords(e){let t=[];for(const n of r5.VICTORY_SOURCE){const r=e.getPieceAt(n[0]),i=[n[0]];if(r.isPlayer()){let s=n[0].getNext(n[1]),o=!0;for(let t=0;t<3&&o;t++)e.getPieceAt(s)!==r?o=!1:(i.push(s),s=s.getNext(n[1]));if(o&&(e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i)),n[2])){const s=n[0].getPrevious(n[1],1);e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i))}}}return t}getGameStatus(e){const t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1];for(let i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?PQ.DRAW:PQ.ZERO_WON:!0===r[1]?PQ.ONE_WON:36===t.turn?PQ.DRAW:PQ.ONGOING}}r5.singleton=gw.empty(),r5.VICTORY_SOURCE=[[new eQ(1,0),new YJ(1,1),!1],[new eQ(0,1),new YJ(1,1),!1],[new eQ(4,0),new YJ(-1,1),!1],[new eQ(5,1),new YJ(-1,1),!1],[new eQ(1,1),new YJ(1,1),!0],[new eQ(4,1),new YJ(-1,1),!0],[new eQ(0,1),new YJ(0,1),!0],[new eQ(1,1),new YJ(0,1),!0],[new eQ(2,1),new YJ(0,1),!0],[new eQ(3,1),new YJ(0,1),!0],[new eQ(4,1),new YJ(0,1),!0],[new eQ(5,1),new YJ(0,1),!0],[new eQ(1,0),new YJ(1,0),!0],[new eQ(1,1),new YJ(1,0),!0],[new eQ(1,2),new YJ(1,0),!0],[new eQ(1,3),new YJ(1,0),!0],[new eQ(1,4),new YJ(1,0),!0],[new eQ(1,5),new YJ(1,0),!0]];class i5 extends uQ{getListMoves(e){const t=[],n=e.gameState.neutralBlocks;if(0===e.gameState.turn)return i5.FIRST_TURN_MOVES;const r=this.getLegalDrops(e.gameState);for(const i of r){const r=e5.rotationless(i.x,i.y),s=e.gameState.applyLegalDrop(r),o=this.getLegalRotations(s,n);for(const e of o)t.push(e5.withRotation(i.x,i.y,e[0],e[1]));0===s.neutralBlocks.length==0&&t.push(r)}return t}getLegalDrops(e){const t=[];for(let n=0;n<6;n++)for(let r=0;r<6;r++){const i=new eQ(r,n);e.getPieceAt(i)===ZY.NONE&&t.push(i)}return t}getLegalRotations(e,t){const n=0===e.neutralBlocks.length,r=[];for(let i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}getBoardValue(e){return new hQ(r5.get().getGameStatus(e).toBoardValue())}}i5.FIRST_TURN_MOVES=[e5.rotationless(0,0),e5.rotationless(1,0),e5.rotationless(2,0),e5.rotationless(0,1),e5.rotationless(1,1),e5.rotationless(0,2)];const s5=ZY.NONE,o5=jY.ONE,a5=jY.ZERO;class c5{constructor(){this.tutorial=[AQ.informational($localize`Initial board`,$localize`The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate.`,n5.getInitialState()),AQ.informational($localize`Goal of the game`,$localize`The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins.`,new n5([[a5,s5,s5,a5,o5,s5],[a5,o5,s5,s5,s5,s5],[a5,s5,o5,s5,s5,s5],[a5,s5,s5,s5,s5,o5],[a5,s5,s5,s5,o5,s5],[s5,s5,s5,s5,s5,s5]],10)).withPreviousMove(e5.withRotation(0,0,0,!1)),AQ.fromPredicate($localize`Simple move`,$localize`At their turn, players put a piece on the board and possibly rotate one quadrant.
        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.
        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>
        Do it.`,new n5([[s5,s5,s5,s5,s5,s5],[s5,a5,s5,s5,o5,s5],[s5,s5,s5,s5,s5,s5],[s5,s5,s5,s5,s5,s5],[s5,o5,s5,s5,a5,s5],[s5,s5,s5,s5,s5,s5]],10),e5.rotationless(2,2),(e,t)=>e.blockTurned.isPresent()?DG.failure($localize`You have made a move with a rotation. This tutorial step is about moves without rotations!`):DG.SUCCESS,$localize`Congratulations!`),AQ.fromPredicate($localize`Move with rotation`,$localize`After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>
        Click on one of them and see the rotation!`,new n5([[s5,s5,s5,s5,s5,s5],[s5,a5,s5,s5,o5,s5],[s5,s5,s5,s5,s5,s5],[s5,s5,s5,s5,s5,s5],[s5,o5,s5,s5,a5,s5],[s5,s5,s5,s5,s5,s5]],10),e5.withRotation(0,0,0,!0),(e,t)=>e.blockTurned.isPresent()?DG.SUCCESS:DG.failure($localize`You made a move without rotation, try again!`),$localize`Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation.`)]}}function l5(e,t){if(1&e){const e=ma();Cn(),pa(0),ha(1,"circle",9),_a("click",function(){const t=Gt(e).$implicit,n=wa().$implicit,r=wa().index,i=wa().index;return wa().onClick(3*r+t,3*i+n)}),da(),ga()}if(2&e){const e=t.$implicit,n=wa().$implicit,r=wa(),i=r.index,s=r.$implicit,o=wa(),a=o.index,c=o.$implicit,l=wa();Ts(1),Oa("id","click_",3*i+e,"_",3*a+n,""),la("ngClass",l.getSquareClasses(3*i+e,3*a+n)),na("cx",s+2*l.STROKE_WIDTH+(e+.5)*l.SPACE_SIZE)("cy",c+2*l.STROKE_WIDTH+(n+.5)*l.SPACE_SIZE)("r",(l.SPACE_SIZE-l.STROKE_WIDTH)/2)}}const u5=function(){return[0,1,2]};function h5(e,t){1&e&&(Cn(),pa(0),oa(1,l5,2,6,"ng-container",3),ga()),2&e&&(Ts(1),la("ngForOf",ou(1,u5)))}function d5(e,t){if(1&e&&(Cn(),pa(0),fa(1,"rect",8),oa(2,h5,2,2,"ng-container",3),ga()),2&e){const e=t.$implicit,n=t.index,r=wa(),i=r.index,s=r.$implicit,o=wa();Ts(1),la("ngClass",o.getBlockClasses(n,i)),na("x",o.STROKE_WIDTH+e)("y",o.STROKE_WIDTH+s)("rx",3*o.STROKE_WIDTH)("ry",3*o.STROKE_WIDTH)("width",o.BLOCK_WIDTH)("height",o.BLOCK_WIDTH),Ts(1),la("ngForOf",ou(8,u5))}}const f5=function(e){return[0,e]};function p5(e,t){if(1&e&&(Cn(),pa(0),oa(1,d5,3,9,"ng-container",3),ga()),2&e){const e=wa();Ts(1),la("ngForOf",au(1,f5,e.BLOCK_SEPARATION))}}function g5(e,t){if(1&e&&(Cn(),fa(0,"circle",10)),2&e){const e=wa();Oa("id","currentDrop_",e.currentDrop.get().x,"_",e.currentDrop.get().y,""),la("ngClass",e.getPlayerClass(e.rules.node.gameState.getCurrentPlayer())),na("cx",e.getCenter(e.currentDrop.get().x))("cy",e.getCenter(e.currentDrop.get().y))("r",(e.SPACE_SIZE-e.STROKE_WIDTH)/2)}}function m5(e,t){if(1&e){const e=ma();Cn(),ha(0,"path",11),_a("click",function(){const t=Gt(e).$implicit;return wa().rotate(t)}),da()}if(2&e){const e=t.$implicit,n=wa();Oa("id","rotate_",e[1],"_",e[2]?"clockwise":"counterclockwise",""),na("d",e[0])("stroke-width",2*n.STROKE_WIDTH)}}function y5(e,t){if(1&e&&(Cn(),fa(0,"circle",12)),2&e){const e=t.$implicit,n=wa();Oa("id","victoryCoord_",e.x,"_",e.y,""),la("ngClass",n.getSquareClasses(e.x,e.y)),na("cx",n.getCenter(e.x))("cy",n.getCenter(e.y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)("stroke-width",n.STROKE_WIDTH)}}function v5(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",13),_a("click",function(){return Gt(e),wa().skipRotation()}),fa(1,"circle",14),fa(2,"line",15),da()}if(2&e){const e=wa();Ts(1),na("cx",e.BLOCK_SEPARATION)("cy",e.BLOCK_SEPARATION)("r",.75*e.SPACE_SIZE)("stroke-width",2*e.STROKE_WIDTH),Ts(1),na("x1",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("y1",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("x2",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("y2",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("stroke-width",2*e.STROKE_WIDTH)}}let _5=(()=>{class e extends hX{constructor(e){super(e),this.arrows=[],this.victoryCoords=[],this.rules=new r5(n5),this.availableMinimaxes=[new i5(this.rules,"PentagoMinimax")],this.encoder=e5.encoder,this.tutorial=(new c5).tutorial,this.BLOCK_WIDTH=3*this.SPACE_SIZE+2*this.STROKE_WIDTH,this.BLOCK_SEPARATION=this.BLOCK_WIDTH+2*this.STROKE_WIDTH,this.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*this.SPACE_SIZE,this.ARROWS=this.generateArrowsCoord(),this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}showLastMove(){const e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{const t=e.get();this.movedBlock=t.blockTurned;const n=new eQ(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new eQ(0,0))&&this.coordBelongToBlock(t)){let e;e=t.turnedClockwise?uw.getNonNullable(n5.ROTATION_MAP.find(e=>e[0].equals(n)))[1]:uw.getNonNullable(n5.ROTATION_MAP.find(e=>e[1].equals(n)))[0];const r=t.blockTurned.get();e=e.getNext(new YJ(r%2==0?1:4,r<2?1:4),1),this.lastDrop=gw.of(e)}else this.lastDrop=gw.of(t.coord)}}coordBelongToBlock(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}hidePreviousMove(){this.lastDrop=gw.empty(),this.movedBlock=gw.empty(),this.victoryCoords=[]}generateArrowsCoord(){const e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}cancelMoveAttempt(){this.arrows=[],this.currentDrop=gw.empty(),this.canSkipRotation=!1}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.board[t][e].isPlayer())return n.cancelMove(lQ.MUST_LAND_ON_EMPTY_SPACE());const i=e5.rotationless(e,t),s=n.rules.node.gameState,o=s.applyLegalDrop(i);if(4===o.neutralBlocks.length)return n.chooseMove(i,s);const a=n.rules.getGameStatus(n.rules.node);return n.canSkipRotation=o.neutralBlocks.length>0&&!1===a.isEndGame,n.currentDrop=gw.of(new eQ(e,t)),n.displayArrows(o.neutralBlocks),DG.SUCCESS})()}getCenter(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}displayArrows(e){this.arrows=[];for(let t=0;t<4;t++)if(!1===e.includes(t)){const e=this.ARROWS.filter(e=>e[1]===t);this.arrows=this.arrows.concat(e)}}getBlockClasses(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}getSquareClasses(e,t){const n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new eQ(e,t))&&n.push("last-move"),n}rotate(e){var t=this;return lw(function*(){const n=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"));if(n.isFailure())return t.cancelMove(n.getReason());const r=t.currentDrop.get(),i=e5.withRotation(r.x,r.y,e[1],e[2]);return t.chooseMove(i,t.rules.node.gameState)})()}skipRotation(){var e=this;return lw(function*(){const t=e.canUserPlay("#skipRotation");if(t.isFailure())return e.cancelMove(t.getReason());const n=e.currentDrop.get(),r=e5.rotationless(n.x,n.y);return e.chooseMove(r,e.rules.node.gameState)})()}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-pentago"]],features:[Ho],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"defs"),ha(2,"marker",1),fa(3,"polygon",2),da(),da(),oa(4,p5,2,3,"ng-container",3),oa(5,g5,1,6,"circle",4),oa(6,m5,1,4,"path",5),oa(7,y5,1,7,"circle",6),oa(8,v5,3,9,"g",7),da()),2&e&&(Ts(4),la("ngForOf",au(5,f5,t.BLOCK_SEPARATION)),Ts(1),la("ngIf",t.currentDrop.isPresent()),Ts(1),la("ngForOf",t.arrows),Ts(1),la("ngForOf",t.victoryCoords),Ts(1),la("ngIf",t.canSkipRotation))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class C5 extends eQ{constructor(e,t,n){if(super(e,t),this.z=n,e<0||e>3)throw new Error(`PylosCoord: Invalid X: ${e}.`);if(t<0||t>3)throw new Error(`PylosCoord: Invalid Y: ${t}.`);if(n<0||n>3)throw new Error(`PylosCoord: Invalid Z: ${n}.`);const r=4-n;if(this.isNotInRange(r,r))throw new Error(this.toString()+" is not in range.")}static encodeOptional(e){let t;return t=e.isPresent()?C5.encode(e.get())+1:0,t}static encode(e){return 16*e.x+4*e.y+e.z}static decodeToOptional(e){return 0===e?gw.empty():gw.of(C5.decode(e-1))}static decode(e){const t=e%4;e-=t;const n=(e/=4)%4;return e-=n,new C5(e/=4,n,t)}toString(){return"PylosCoord"+this.toShortString()}toShortString(){return"("+this.x+", "+this.y+", "+this.z+")"}equals(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}isUpperThan(e){return this.z>e.z}getLowerPieces(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");const e=this.z-1;return[new C5(this.x,this.y,e),new C5(this.x+1,this.y,e),new C5(this.x,this.y+1,e),new C5(this.x+1,this.y+1,e)]}getHigherPieces(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");const e=this.z+1,t=new eQ(this.x-1,this.y-1),n=new eQ(this.x,this.y-1),r=new eQ(this.x-1,this.y),i=new eQ(this.x,this.y),s=4-e;return[t,n,r,i].filter(e=>e.isInRange(s,s)).map(t=>new C5(t.x,t.y,e))}getNextValid(e){const t=new eQ(this.x,this.y).getNext(e),n=4-this.z;return t.isNotInRange(n,n)?gw.empty():gw.of(new C5(t.x,t.y,this.z))}}class E5 extends yQ{constructor(e,t,n,r){super(),this.startingCoord=e,this.landingCoord=t,this.firstCapture=n,this.secondCapture=r}static fromClimb(e,t,n){const r=gw.of(e),i=E5.checkCaptures(n),s=new E5(r,t,i.firstCapture,i.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return s}static checkCaptures(e){let t=gw.empty(),n=gw.empty();if(e.length>0&&(t=gw.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=gw.of(e[1]),e[1].isUpperThan(e[0])&&(t=gw.of(e[1]),n=gw.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}static fromDrop(e,t){const n=gw.empty(),r=E5.checkCaptures(t);return new E5(n,e,r.firstCapture,r.secondCapture)}static changeCapture(e,t){const n=E5.checkCaptures(t);return new E5(e.startingCoord,e.landingCoord,n.firstCapture,n.secondCapture)}isClimb(){return this.startingCoord.isPresent()}toString(){const e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}equals(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}E5.encoder=new class extends qY{maxValue(){return 17575999}encodeNumber(e){const t=C5.encode(e.landingCoord),n=C5.encodeOptional(e.startingCoord),r=C5.encodeOptional(e.firstCapture);return 270400*C5.encodeOptional(e.secondCapture)+4160*r+64*n+t}decodeNumber(e){const t=C5.decode(e%64);e-=e%64;const n=C5.decodeToOptional((e/=64)%65);e-=e%65;const r=C5.decodeToOptional((e/=65)%65);e-=e%65;const i=C5.decodeToOptional(e/=65);return new E5(n,t,r,i)}};class w5 extends pQ{constructor(e,t){super(t),this.boards=e}static getInitialState(){const e=QY.createTable(4,4,ZY.NONE),t=QY.createTable(3,3,ZY.NONE),n=QY.createTable(2,2,ZY.NONE);return new w5([e,t,n,[[ZY.NONE]]],0)}getPieceAt(e){return this.boards[e.z][e.y][e.x]}applyLegalMove(e){const t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:ZY.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:ZY.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:ZY.NONE}),this.setBoardAts(t,this.turn+1)}setBoardAts(e,t){const n=[QY.copyBiArray(this.boards[0]),QY.copyBiArray(this.boards[1]),QY.copyBiArray(this.boards[2]),QY.copyBiArray(this.boards[3])];for(const r of e){const e=r.coord;n[e.z][e.y][e.x]=r.value}return new w5(n,t)}isLandable(e){if(this.getPieceAt(e).isPlayer())return!1;if(0===e.z)return!0;const t=e.getLowerPieces();for(const n of t)if(this.getPieceAt(n)===ZY.NONE)return!1;return!0}isSupporting(e){if(3===e.z)return!1;const t=e.getHigherPieces();for(const n of t)if(this.getPieceAt(n).isPlayer())return!0;return!1}getPiecesRepartition(){const e={};e[ZY.NONE.value]=0,e[jY.ZERO.value]=0,e[jY.ONE.value]=0;for(let t=0;t<3;t++)for(let n=0;n<4-t;n++)for(let r=0;r<4-t;r++){const i=new C5(r,n,t),s=this.getPieceAt(i);e[s.value]=1+e[s.value]}return e}}let b5=(()=>{class e{}return e.MUST_MOVE_UPWARD=()=>$localize`You must move your pieces upward.`,e.SHOULD_HAVE_SUPPORTING_PIECES=()=>$localize`Your piece must land on the board or on 4 other pieces.`,e.CANNOT_LAND=()=>$localize`You cannot land on this space.`,e.CANNOT_CAPTURE=()=>$localize`You cannot capture.`,e.INVALID_FIRST_CAPTURE=()=>$localize`Your first capture is invalid.`,e.INVALID_SECOND_CAPTURE=()=>$localize`Your second capture is invalid.`,e})();class S5 extends OQ{static getStateInfo(e){const t=[],n=[];for(let r=0;r<3;r++)for(let i=0;i<4-r;i++)for(let s=0;s<4-r;s++){const o=new C5(s,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}static getClimbingMoves(e){const t=[];for(const n of e.freeToMove)for(const r of e.landable)if(r.isUpperThan(n)&&!1===r.getLowerPieces().some(e=>n.equals(e))){const e=E5.fromClimb(n,r,[]);t.push(e)}return t}static getDropMoves(e){const t=[];for(const n of e.landable){const e=E5.fromDrop(n,[]);t.push(e)}return t}static canCapture(e,t){const n=e.getCurrentPlayer();for(const r of[XJ.UP,XJ.DOWN]){const i=t.getNextValid(r);if(i.isPresent()&&e.getPieceAt(i.get())===n)for(const t of[XJ.LEFT,XJ.RIGHT]){const s=i.get().getNextValid(t);if(s.isPresent()&&e.getPieceAt(s.get())===n){const t=r.getOpposite(),i=s.get().getNextValid(t).get();if(e.getPieceAt(i)===n)return!0}}}return!1}static getPossibleCaptures(e,t,n){const r=[],i=(e=e.filter(e=>!1===t.equalsValue(e))).concat(n);for(let s=0;s<i.length;s++){const e=i[s];r.push([e]);for(let t=s+1;t<i.length;t++)r.push([i[t],e])}return r}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}static isValidCapture(e,t,n){const r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(n=>e.getPieceAt(n).isPlayer()&&!1===n.equals(t.firstCapture.get())).length>0)}static getGameStatus(e){const t=e.gameState.getPiecesRepartition();return 15===t[jY.ZERO.value]?PQ.ONE_WON:15===t[jY.ONE.value]?PQ.ZERO_WON:PQ.ONGOING}applyLegalMove(e,t,n){return S5.applyLegalMove(e,t,n)}isLegal(e,t){if(t.getPieceAt(e.landingCoord).isPlayer())return MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.getCurrentOpponent();if(e.startingCoord.isPresent()){const r=e.startingCoord.get(),i=t.getPieceAt(r);if(i===n)return MG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(i===ZY.NONE)return MG.failure(lQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(r.getHigherPieces().filter(n=>t.getPieceAt(n).isPlayer()||n.equals(e.landingCoord)).length>0)return MG.failure(b5.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return MG.failure(b5.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===S5.canCapture(t,e.landingCoord))return MG.failure(b5.CANNOT_CAPTURE());if(!S5.isValidCapture(t,e,e.firstCapture.get()))return MG.failure(b5.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!S5.isValidCapture(t,e,e.secondCapture.get()))return MG.failure(b5.INVALID_SECOND_CAPTURE())}return MG.success(void 0)}getGameStatus(e){return S5.getGameStatus(e)}}class P5 extends uQ{static getListMoves(e){const t=e.gameState,n=[],r=S5.getStateInfo(t),i=S5.getClimbingMoves(r),s=S5.getDropMoves(r),o=i.concat(s);for(const a of o){let e=[[]];S5.canCapture(t,a.landingCoord)&&(e=S5.getPossibleCaptures(r.freeToMove,a.startingCoord,a.landingCoord));for(const t of e){const e=E5.changeCapture(a,t);n.push(e)}}return n}getListMoves(e){return P5.getListMoves(e)}getBoardValue(e){const t=S5.getGameStatus(e);if(t.isEndGame)return new hQ(t.toBoardValue());{const t=e.gameState.getPiecesRepartition();return new hQ(t[jY.ZERO.value]-t[jY.ONE.value])}}}class O5 extends P5{static countStoneUsed(e){let t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}static sumMoveEmplacementByValue(e){let t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}getListMoves(e){const t=P5.getListMoves(e);return this.orderMoves(t)}orderMoves(e){return e.sort((e,t)=>{const n=12*O5.countStoneUsed(e),r=12*O5.countStoneUsed(t);return n+O5.sumMoveEmplacementByValue(e)-(r+O5.sumMoveEmplacementByValue(t))})}}const T5=ZY.NONE,I5=jY.ZERO,k5=jY.ONE;class A5{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`At Pylos, the goal is to be the last to play.
        To do this, you have to save up your pieces.
        As soon as a player puts its last piece, that player loses the game immediately.
        Here is what the initial board looks like, it is a board of 4 x 4 squares.
        This board will become a pyramid, little by little.
        It will be filled by the pieces of your stock. Each player has 15 pieces.`,w5.getInitialState()),AQ.anyMove($localize`Dropping a piece`,$localize`When it is your turn, you can always drop one of your piece on an empty square.
        The gray squares are where you can drop your pieces.<br/><br/>
        Click on one of the squares to drop a piece there.`,w5.getInitialState(),E5.fromDrop(new C5(1,1,0),[]),$localize`There you go, as simple as that.`),AQ.fromMove($localize`Climbing`,$localize`When 4 pieces form a square, it is possible to put a fifth piece on top.
        However, when that happens, you can save a piece by climbing instead of dropping a piece.
        To climb:
        <ol>
            <li>Click on one of your free pieces, which should be lower than the landing square.</li>
            <li>Click on an empty landing square, higher than your selected piece.</li>
        </ol><br/>
        Go ahead, climb!`,new w5([[[I5,k5,T5,T5],[k5,I5,T5,T5],[T5,T5,T5,T5],[T5,T5,T5,I5]],[[T5,T5,T5],[T5,T5,T5],[T5,T5,T5]],[[T5,T5],[T5,T5]],[[T5]]],0),[E5.fromClimb(new C5(3,3,0),new C5(0,0,1),[])],$localize`Congratulations!<br/>
        Some important notes:
        <ol>
            <li>You cannot move a piece that is directly below another one.</li>
            <li>Of course, you cannot move the opponent's pieces.</li>
            <li>You can only climb when the landing square is higher than the starting square.</li>
        </ol>`,$localize`Failed!`),AQ.fromMove($localize`Square (1/2)`,$localize`When the piece you just moved or dropped is the fourth one of a square of your color,
        you can choose anywhere on the board one or two of your pieces.
        These pieces will be removed from the board, allowing you to save up one or two pieces.
        A chosen piece must not be directly below another piece.
        A chosen piece can be the piece you just placed.
        You're playing Dark.<br/><br/>
        Form a square, then click twice on one of the four pieces to remove only that one.`,new w5([[[I5,I5,T5,T5],[T5,I5,T5,T5],[T5,T5,T5,T5],[T5,T5,T5,T5]],[[T5,T5,T5],[T5,T5,T5],[T5,T5,T5]],[[T5,T5],[T5,T5]],[[T5]]],0),[E5.fromDrop(new C5(0,1,0),[new C5(0,0,0)]),E5.fromDrop(new C5(0,1,0),[new C5(0,1,0)]),E5.fromDrop(new C5(0,1,0),[new C5(1,0,0)]),E5.fromDrop(new C5(0,1,0),[new C5(1,1,0)])],$localize`Congratulations, you have saved up one piece.`,$localize`Failed!`),AQ.fromPredicate($localize`Square (2/2)`,$localize`You're playing Dark.<br/><br/>
        Do like in the previous step, but this time click on two different pieces.`,new w5([[[I5,I5,T5,T5],[T5,I5,T5,T5],[T5,T5,T5,T5],[T5,T5,T5,T5]],[[T5,T5,T5],[T5,T5,T5],[T5,T5,T5]],[[T5,T5],[T5,T5]],[[T5]]],0),E5.fromDrop(new C5(0,1,0),[new C5(0,0,0),new C5(1,0,0)]),(e,t)=>e.secondCapture.isPresent()?DG.SUCCESS:e.firstCapture.isPresent()?DG.failure($localize`Failed, you only captured one piece.`):DG.failure($localize`Failed, you did not capture any piece.`),$localize`Congratulations, you have saved up two pieces.`)]}}function N5(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"circle",4),da()),2&e){const e=t.$implicit,n=wa().$implicit,r=wa();Ts(1),Oa("id","piece_",n,"_",e,""),la("ngClass",r.getPlayerPieceClass(n)),na("cx",.5*r.SPACE_SIZE+(800-r.SPACE_SIZE)/14*e)("cy",860+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function M5(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,N5,2,6,"g",1),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",n.getPlayerSidePieces(e))}}function x5(e,t){if(1&e){const e=ma();Cn(),ha(0,"circle",8),_a("click",function(){Gt(e);const t=wa(2).$implicit,n=wa().$implicit,r=wa().$implicit;return wa().onPieceClick(t,n,r)}),da()}if(2&e){const e=wa(2).$implicit,t=wa().$implicit,n=wa().$implicit,r=wa();Ta("id","piece_",e,"_",t,"_",n,""),la("ngClass",r.getPieceClasses(e,t,n)),na("r",r.getPieceRadius(n)-r.STROKE_WIDTH)("cx",r.getPieceCx(e,t,n))("cy",r.getPieceCy(e,t,n))}}function R5(e,t){if(1&e){const e=ma();Cn(),ha(0,"rect",8),_a("click",function(){Gt(e);const t=wa(2).$implicit,n=wa().$implicit,r=wa().$implicit;return wa().onDrop(t,n,r)}),da()}if(2&e){const e=wa(2).$implicit,t=wa().$implicit,n=wa().$implicit,r=wa();Ta("id","drop_",e,"_",t,"_",n,""),la("ngClass",r.getSquareClasses(e,t,n)),na("width",2*r.getPieceRadius(n))("height",2*r.getPieceRadius(n))("x",r.getPieceCx(e,t,n)-r.getPieceRadius(n))("y",r.getPieceCy(e,t,n)-r.getPieceRadius(n))}}function D5(e,t){if(1&e&&(Cn(),pa(0),oa(1,x5,1,7,"circle",6),oa(2,R5,1,8,"ng-template",null,7,Ru),ga()),2&e){const e=aa(3),t=wa().$implicit,n=wa().$implicit,r=wa().$implicit,i=wa();Ts(1),la("ngIf",i.isOccupied(t,n,r))("ngIfElse",e)}}function L5(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,D5,4,2,"ng-container",5),da()),2&e){const e=t.$implicit,n=wa().$implicit,r=wa().$implicit,i=wa();Ts(1),la("ngIf",i.isDrawable(e,n,r))}}function F5(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,L5,2,1,"g",1),da()),2&e){const e=wa().$implicit,t=wa();Ts(1),la("ngForOf",t.getLevelRange(e))}}function B5(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,F5,2,1,"g",1),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",n.getLevelRange(e))}}function U5(e,t){if(1&e&&(Cn(),fa(0,"rect",9)),2&e){const e=wa();Ta("id","highCapture_",e.highCapture.get().x,"_",e.highCapture.get().y,"_",e.highCapture.get().z,""),na("width",2*e.getPieceRadius(e.highCapture.get().z))("height",2*e.getPieceRadius(e.highCapture.get().z))("x",e.getPieceCx(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))("y",e.getPieceCy(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))}}const V5=function(){return[0,1]},$5=function(){return[0,1,2]};let z5=(()=>{class e extends tQ{constructor(e){super(e),this.lastLandingCoord=gw.empty(),this.lastStartingCoord=gw.empty(),this.lastFirstCapture=gw.empty(),this.lastSecondCapture=gw.empty(),this.highCapture=gw.empty(),this.chosenStartingCoord=gw.empty(),this.chosenLandingCoord=gw.empty(),this.chosenFirstCapture=gw.empty(),this.lastMove=gw.empty(),this.remainingPieces={0:15,1:15},this.rules=new S5(w5),this.availableMinimaxes=[new P5(this.rules,"PylosMinimax"),new O5(this.rules,"PylosOrderedMinimax")],this.encoder=E5.encoder,this.tutorial=(new A5).tutorial,this.SPACE_SIZE=this.getPieceRadius(0),this.updateBoard()}getLevelRange(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return uw.expectToBe(e,2),[0,1]}}isDrawable(e,t,n){const r=new C5(e,t,n);return this.state.getPieceAt(r)!==ZY.NONE||this.state.isLandable(r)}onPieceClick(e,t,n){var r=this;return lw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new C5(e,t,n);return r.state.getPieceAt(s)===r.state.getCurrentOpponent()?r.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=gw.of(s),DG.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=gw.of(s),DG.SUCCESS):r.chosenFirstCapture.equalsValue(s)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),s])})()}concludeMoveWithCapture(e){var t=this;return lw(function*(){let n;return n=t.chosenStartingCoord.isAbsent()?E5.fromDrop(t.chosenLandingCoord.get(),e):E5.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(n,t.state)})()}tryMove(e,t){var n=this;return lw(function*(){return n.cancelMove(),n.chooseMove(e,t)})()}cancelMoveAttempt(){this.chosenStartingCoord=gw.empty(),this.chosenLandingCoord=gw.empty(),this.chosenFirstCapture=gw.empty()}onDrop(e,t,n){var r=this;return lw(function*(){const i=r.canUserPlay("#drop_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new C5(e,t,n);return S5.canCapture(r.state,s)?(r.chosenLandingCoord=gw.of(s),DG.SUCCESS):r.isCapturelessMoveFinished(s)?(r.chosenLandingCoord=gw.of(s),r.concludeMoveWithCapture([])):r.cancelMove(b5.MUST_MOVE_UPWARD())})()}isCapturelessMoveFinished(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}getSquareClasses(e,t,n){const r=new C5(e,t,n);if(this.lastMove.isPresent()){const e=this.lastMove.get();if(e.firstCapture.equalsValue(r)||e.secondCapture.equalsValue(r))return["captured"];if(r.equals(e.landingCoord)||e.startingCoord.equalsValue(r))return["moved"]}return[]}getPieceRadius(e){return 90+5*e}getPieceCx(e,t,n){return 100+100*n+200*e}getPieceCy(e,t,n){return 100+100*n+200*t}isOccupied(e,t,n){const r=new C5(e,t,n),i=this.rules.node.gameState.getPieceAt(r).isPlayer(),s=this.chosenLandingCoord.equalsValue(r);return i||s}getPieceClasses(e,t,n){const r=new C5(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}getPieceFillClass(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}getPlayerPieceClass(e){return this.getPlayerClass(jY.of(e))}getPlayerSidePieces(e){const t=this.remainingPieces[e],n=[];for(let r=0;r<t;r++)n.push(r);return n}updateBoard(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;const e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=gw.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=gw.empty(),this.lastStartingCoord=gw.empty(),this.lastFirstCapture=gw.empty(),this.lastSecondCapture=gw.empty(),this.chosenFirstCapture=gw.empty(),this.chosenStartingCoord=gw.empty(),this.chosenLandingCoord=gw.empty())}showLastMove(){const e=this.lastMove.get();this.lastLandingCoord=gw.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}isDrawableCoord(e){return this.isDrawable(e.x,e.y,e.z)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-pylos"]],features:[Ho],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,M5,2,1,"g",1),fa(2,"rect",2),oa(3,B5,2,1,"g",1),oa(4,U5,1,7,"rect",3),da()),2&e&&(Ts(1),la("ngForOf",ou(3,V5)),Ts(2),la("ngForOf",ou(4,$5)),Ts(1),la("ngIf",t.highCapture.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class H5{constructor(e){this.value=e}static fromInt(e){if(0<=e&&e<=15)return H5.pieces[e];if(16===e)return H5.NONE;throw new Error("Invalid piece ("+e+")")}equals(e){return this===e}toString(){return"QuartoPiece("+this.value+")"}isRectangle(){return this.value%4<2}}H5.AAAA=new H5(0),H5.AAAB=new H5(1),H5.AABA=new H5(2),H5.AABB=new H5(3),H5.ABAA=new H5(4),H5.ABAB=new H5(5),H5.ABBA=new H5(6),H5.ABBB=new H5(7),H5.BAAA=new H5(8),H5.BAAB=new H5(9),H5.BABA=new H5(10),H5.BABB=new H5(11),H5.BBAA=new H5(12),H5.BBAB=new H5(13),H5.BBBA=new H5(14),H5.BBBB=new H5(15),H5.NONE=new H5(16),H5.pieces=[H5.AAAA,H5.AAAB,H5.AABA,H5.AABB,H5.ABAA,H5.ABAB,H5.ABBA,H5.ABBB,H5.BAAA,H5.BAAB,H5.BABA,H5.BABB,H5.BBAA,H5.BBAB,H5.BBBA,H5.BBBB];class G5 extends vQ{constructor(e,t,n){super(e,t),this.piece=n}toString(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}equals(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}G5.encoder=new class extends qY{maxValue(){return 496}encodeNumber(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}decodeNumber(e){const t=e%32;e-=t;const n=(e/=32)%4;return e-=n,new G5(e/=4,n,H5.fromInt(t))}};class q5 extends gQ{constructor(e,t,n){super(e,t),this.pieceInHand=n}static getInitialState(){const e=QY.createTable(4,4,H5.NONE);return new q5(e,0,H5.AAAA)}static isGivable(e,t,n){return e!==n&&!1===q5.isAlreadyOnBoard(e,t)}static isAlreadyOnBoard(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}getRemainingPieces(){const e=H5.pieces,t=[];for(const n of e)q5.isGivable(n,this.board,this.pieceInHand)&&t.push(n);return t}}let W5=(()=>{class e{}return e.MUST_GIVE_A_PIECE=()=>$localize`You must give a piece.`,e.PIECE_ALREADY_ON_BOARD=()=>$localize`That piece is already on the board.`,e.CANNOT_GIVE_PIECE_IN_HAND=()=>$localize`You cannot give the piece that was in your hands.`,e})();class j5{constructor(e){this.subCriterion=[gw.empty(),gw.empty(),gw.empty(),gw.empty()],this.subCriterion[0]=gw.of(8==(8&e.value)),this.subCriterion[1]=gw.of(4==(4&e.value)),this.subCriterion[2]=gw.of(2==(2&e.value)),this.subCriterion[3]=gw.of(1==(1&e.value))}mergeWith(e){let t=4;for(let n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=gw.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}mergeWithQuartoPiece(e){const t=new j5(e);return this.mergeWith(t)}areAllAbsent(){for(let e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}match(e){for(let t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}matchPiece(e){return this.match(new j5(e))}toString(){return"Criterion{"+this.subCriterion.map(e=>e.isPresent()?e.get()?"1":"0":"x").join(" ")+"}"}}class Z5{constructor(e,t){this.initialCoord=e,this.direction=t}allCoords(){const e=[];for(let t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}class Y5 extends OQ{static isOccupied(e){return e!==H5.NONE}static isLegal(e,t){const n=e.coord.x,r=e.coord.y,i=e.piece,s=t.getCopiedBoard(),o=t.pieceInHand;return Y5.isOccupied(s[r][n])?DG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE()):i===H5.NONE?15===t.turn?DG.SUCCESS:DG.failure(W5.MUST_GIVE_A_PIECE()):q5.isAlreadyOnBoard(i,s)?DG.failure(W5.PIECE_ALREADY_ON_BOARD()):o===i?DG.failure(W5.CANNOT_GIVE_PIECE_IN_HAND()):DG.SUCCESS}isLegal(e,t){return Y5.isLegal(e,t).toFallible(void 0)}applyLegalMove(e,t){const n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new q5(n,t.turn+1,e.piece)}static updateBoardStatus(e,t,n){return n.score===CQ.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:CQ.VICTORY,sensitiveSquares:new FX}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}static isThereAVictoriousLine(e,t){let n=e.initialCoord,r=t.getPieceAt(n);const i=new j5(r);for(let s=0;s<3&&!1!==Y5.isOccupied(r)&&!i.areAllAbsent();s++)n=n.getNext(e.direction,1),r=t.getPieceAt(n),i.mergeWithQuartoPiece(r);return!(!Y5.isOccupied(r)||i.areAllAbsent())}static searchForVictoryOrPreVictoryInLine(e,t,n){const r=Y5.getLineInfos(e,t,n);if(r.boardStatus.isPresent())return r.boardStatus.get();const i=r.commonCriterion,s=r.sensitiveCoord;if(i.isPresent()&&!1===i.get().areAllAbsent()){if(s.isAbsent())return{score:CQ.VICTORY,sensitiveSquares:new FX};{i.get().matchPiece(t.pieceInHand)&&(n.score=CQ.PRE_VICTORY);const e=s.get();n.sensitiveSquares.add(e)}}return n}static getLineInfos(e,t,n){let r=gw.empty(),i=gw.empty(),s=e.initialCoord;for(let o=0;o<4;o++){const o=t.getPieceAt(s);if(o===H5.NONE){if(!r.isAbsent())return{sensitiveCoord:gw.of(s),commonCriterion:i,boardStatus:gw.of(n)};r=gw.of(s)}else i.isAbsent()?(i=gw.of(new j5(o)),hw(Y5.VERBOSE,"set commonCrit to "+i.toString())):(i.get().mergeWithQuartoPiece(o),hw(Y5.VERBOSE,"update commonCrit: "+i.toString()));s=s.getNext(e.direction,1)}return{commonCriterion:i,sensitiveCoord:r,boardStatus:gw.empty()}}static scoreToGameStatus(e,t){const n=jY.of(t%2);return e===CQ.VICTORY?PQ.getDefeat(n):16===t?PQ.DRAW:PQ.ONGOING}getGameStatus(e){const t=e.gameState;let n={score:CQ.DEFAULT,sensitiveSquares:new FX};for(const r of Y5.lines)if(n=Y5.updateBoardStatus(r,t,n),n.score===CQ.VICTORY)return Y5.scoreToGameStatus(n.score,t.turn);return Y5.scoreToGameStatus(n.score,t.turn)}getVictoriousCoords(e){for(const t of Y5.lines)if(Y5.isThereAVictoriousLine(t,e))return t.allCoords();return[]}}Y5.VERBOSE=!1,Y5.lines=[new Z5(new eQ(0,0),QJ.DOWN),new Z5(new eQ(1,0),QJ.DOWN),new Z5(new eQ(2,0),QJ.DOWN),new Z5(new eQ(3,0),QJ.DOWN),new Z5(new eQ(0,0),QJ.RIGHT),new Z5(new eQ(0,1),QJ.RIGHT),new Z5(new eQ(0,2),QJ.RIGHT),new Z5(new eQ(0,3),QJ.RIGHT),new Z5(new eQ(0,0),QJ.DOWN_RIGHT),new Z5(new eQ(0,3),QJ.UP_RIGHT)];class K5 extends uQ{static scoreToBoardValue(e,t){if(e===CQ.DEFAULT)return new hQ(0);{const n=jY.of(t%2);return new hQ(e===CQ.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),s=n.pieceInHand;let o;for(let a=0;a<4;a++)for(let e=0;e<4;e++)if(r[a][e]===H5.NONE){if(o=n.getCopiedBoard(),o[a][e]=s,15===n.turn){const n=new G5(e,a,H5.NONE);return t.push(n),t}for(const n of i){const r=new G5(e,a,n);t.push(r)}}return t}getBoardValue(e){const t=e.gameState;let n={score:CQ.DEFAULT,sensitiveSquares:new FX};for(const r of Y5.lines)if(n=Y5.updateBoardStatus(r,t,n),n.score===CQ.VICTORY)break;return K5.scoreToBoardValue(n.score,t.turn)}}const J5=H5.AABA,Q5=H5.AABB,X5=H5.ABAA,e6=H5.ABAB,t6=H5.ABBA,n6=H5.BAAA,r6=H5.BAAB,i6=H5.BABB,s6=H5.BBAA,o6=H5.BBAB,a6=H5.BBBA,c6=H5.BBBB,l6=H5.NONE;class u6{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`Quarto is an alignment game.
        The goal is to align four pieces that have at least one common aspect:
        <ul>
          <li>their color (light or dark),</li>
          <li>their size (big or small),</li>
          <li>their pattern (empty or dotted),</li>
          <li>their shape (round or square).</li>
        </ul>
        Here, we have a board with a victory by an alignment of dark pieces.`,new q5([[a6,s6,X5,J5],[l6,l6,l6,l6],[l6,l6,l6,l6],[l6,l6,l6,l6]],7,H5.ABAB)),AQ.anyMove($localize`Placement`,$localize`Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,
        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.
        If you prefer, the order of these two steps can be reversed.
        Keep in mind that the second click confirms the move.<br/><br/>
        Make a move.`,new q5([[a6,Q5,t6,l6],[l6,l6,l6,l6],[l6,n6,l6,l6],[l6,l6,l6,l6]],7,H5.ABAA),new G5(2,2,H5.BAAB),$localize`Perfect!`),AQ.fromMove($localize`Situation`,$localize`We have here a tricky situation.<br/><br/>
        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move.`,new q5([[c6,a6,o6,l6],[X5,i6,s6,l6],[e6,n6,r6,l6],[l6,l6,l6,l6]],7,H5.AABA),[new G5(3,3,H5.AABB)],$localize`Well done!`,$localize`Failed!`)]}}function h6(e,t){if(1&e&&(Cn(),fa(0,"rect",11)),2&e){const e=wa(2),t=e.$implicit,n=e.index,r=wa().index,i=wa();la("ngClass",i.getPieceClasses(t.value)),na("x",i.SPACE_SIZE*n+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("y",i.SPACE_SIZE*r+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("width",2*i.getPieceSize(t.value))("height",2*i.getPieceSize(t.value))}}function d6(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa(2),t=e.$implicit,n=e.index,r=wa().index,i=wa();la("ngClass",i.getPieceClasses(t.value)),na("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(t.value))}}function f6(e,t){if(1&e&&(Cn(),fa(0,"circle")),2&e){const e=wa(2).index,t=wa().index,n=wa();na("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function p6(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,h6,1,5,"rect",9),oa(2,d6,1,4,"ng-template",null,10,Ru),oa(4,f6,1,3,"circle",3),da()),2&e){const e=aa(3),t=wa().$implicit,n=wa(2);Ts(1),la("ngIf",t.isRectangle())("ngIfElse",e),Ts(3),la("ngIf",n.pieceHasDot(t.value))}}function g6(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",8),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().chooseCoord(t,n)}),da(),oa(2,p6,5,3,"g",3),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","chooseCoord_",n,"_",r,""),la("ngClass",i.getSquareClasses(n,r)),na("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngIf",e!==i.EMPTY)}}function m6(e,t){if(1&e&&(Cn(),ha(0,"g",null,7),oa(2,g6,3,8,"g",2),da()),2&e){const e=t.$implicit;Ts(2),la("ngForOf",e)}}function y6(e,t){if(1&e&&(Cn(),fa(0,"rect",15)),2&e){const e=wa(2);la("ngClass",e.getPieceClasses(e.pieceInHand.value)),na("x",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("y",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function v6(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa(2);la("ngClass",e.getPieceClasses(e.pieceInHand.value)),na("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",e.getPieceSize(e.pieceInHand.value))}}function _6(e,t){if(1&e&&(Cn(),fa(0,"circle")),2&e){const e=wa(2);na("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",10)}}function C6(e,t){if(1&e&&(Cn(),ha(0,"g",null,12),fa(2,"rect",13),oa(3,y6,1,5,"rect",14),oa(4,v6,1,4,"ng-template",null,10,Ru),oa(6,_6,1,3,"circle",3),da()),2&e){const e=aa(5),t=wa();na("transform","translate("+t.chosen.get().x*t.SPACE_SIZE+" "+t.chosen.get().y*t.SPACE_SIZE+")"),Ts(2),na("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),la("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),la("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function E6(e,t){if(1&e&&(Cn(),ha(0,"g",null,16),fa(2,"rect",17),da()),2&e){const e=t.$implicit,n=wa();Ts(2),na("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)("transform","translate("+e.x*n.SPACE_SIZE+" "+e.y*n.SPACE_SIZE+")")}}function w6(e,t){if(1&e&&(Cn(),fa(0,"rect",11)),2&e){const e=wa(2);la("ngClass",e.getPieceClasses(e.pieceInHand.value)),na("x",0)("y",.75*e.SPACE_SIZE)("transform","translate("+-e.getPieceSize(e.pieceInHand.value)+", "+-e.getPieceSize(e.pieceInHand.value)+")")("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function b6(e,t){if(1&e&&(Cn(),fa(0,"circle",19)),2&e){const e=wa(2);la("ngClass",e.getPieceClasses(e.pieceInHand.value)),na("cy",.75*e.SPACE_SIZE)("r",e.getPieceSize(e.pieceInHand.value))}}function S6(e,t){1&e&&(Cn(),fa(0,"circle",20)),2&e&&na("cy",.75*wa(2).SPACE_SIZE)("r",10)}function P6(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,w6,1,6,"rect",9),oa(2,b6,1,3,"ng-template",null,10,Ru),oa(4,S6,1,2,"circle",18),da()),2&e){const e=aa(3),t=wa();Ts(1),la("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),la("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function O6(e,t){if(1&e&&(Cn(),fa(0,"rect",27)),2&e){const e=wa(2).index,t=wa().index,n=wa();na("x",n.SPACE_SIZE*e)("y",n.SPACE_SIZE*t)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function T6(e,t){if(1&e&&(Cn(),fa(0,"rect",11)),2&e){const e=wa(2).index,t=wa().index,n=wa();la("ngClass",n.getPieceClasses(4*t+e)),na("x",n.SPACE_SIZE*e+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("y",n.SPACE_SIZE*t+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("width",2*n.getPieceSize(4*t+e))("height",2*n.getPieceSize(4*t+e))}}function I6(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa(2).index,t=wa().index,n=wa();la("ngClass",n.getPieceClasses(4*t+e)),na("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.getPieceSize(4*t+e))}}function k6(e,t){if(1&e&&(Cn(),fa(0,"circle")),2&e){const e=wa(2).index,t=wa().index,n=wa();na("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function A6(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",25),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().choosePiece(4*n+t)}),oa(1,O6,1,4,"rect",26),oa(2,T6,1,5,"rect",9),oa(3,I6,1,4,"ng-template",null,10,Ru),oa(5,k6,1,3,"circle",3),da()}if(2&e){const e=aa(4),t=wa().index,n=wa().index,r=wa();Pa("id","choosePiece_",4*n+t,""),Ts(1),la("ngIf",r.pieceToGive.value===4*n+t),Ts(1),la("ngIf",(4*n+t)%4<2)("ngIfElse",e),Ts(3),la("ngIf",r.pieceHasDot(4*n+t))}}function N6(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,A6,6,5,"g",24),da()),2&e){const e=t.index,n=wa().index,r=wa();Ts(1),la("ngIf",r.isRemaining(4*n+e))}}function M6(e,t){if(1&e&&(Cn(),ha(0,"g",null,21),fa(2,"rect",22,23),oa(4,N6,2,1,"g",2),da()),2&e){const e=t.$implicit,n=wa();na("transform","translate(0 "+6.5*n.SPACE_SIZE+")"),Ts(2),na("x",-.125*n.SPACE_SIZE)("y",-.125*n.SPACE_SIZE)("width",4.25*n.SPACE_SIZE)("height",4.25*n.SPACE_SIZE),Ts(2),la("ngForOf",e)}}let x6=(()=>{class e extends hX{constructor(e){super(e),this.EMPTY=H5.NONE,this.chosen=gw.empty(),this.lastMove=gw.empty(),this.pieceInHand=H5.NONE,this.pieceToGive=H5.NONE,this.victoriousCoords=[],this.rules=new Y5(q5),this.availableMinimaxes=[new K5(this.rules,"QuartoMinimax")],this.encoder=G5.encoder,this.tutorial=(new u6).tutorial,this.pieceInHand=this.rules.node.gameState.pieceInHand,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=gw.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(e=>e.coord)}chooseCoord(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#chooseCoord_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.hideLastMove(),n.board[t][e]===H5.NONE){if(n.showPieceInHandOnBoard(e,t),15===n.rules.node.gameState.turn){const r=new G5(e,t,H5.NONE);return n.chooseMove(r,n.rules.node.gameState)}if(n.pieceToGive===H5.NONE)return DG.SUCCESS;{const r=new G5(e,t,n.pieceToGive);return n.chooseMove(r,n.rules.node.gameState)}}return n.cancelMove(lQ.MUST_CLICK_ON_EMPTY_SPACE())})()}choosePiece(e){var t=this;return lw(function*(){const n=t.canUserPlay("#choosePiece_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.hideLastMove(),t.pieceToGive=H5.fromInt(e),t.chosen.isAbsent())return DG.SUCCESS;{const e=t.chosen.get(),n=new G5(e.x,e.y,t.pieceToGive);return t.chooseMove(n,t.rules.node.gameState)}})()}hideLastMove(){this.lastMove=gw.empty()}cancelMoveAttempt(){this.hideLastMove(),this.pieceToGive=H5.NONE}showPieceInHandOnBoard(e,t){this.chosen=gw.of(new eQ(e,t))}isRemaining(e){return q5.isGivable(H5.fromInt(e),this.board,this.pieceInHand)}getSquareClasses(e,t){const n=new eQ(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}getPieceClasses(e){const t=[];return t.push(e%2==0?"player0":"player1"),t}getPieceSize(e){return e<8?40:25}pieceHasDot(e){return e!==H5.NONE.value&&e%8<4}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-quarto"]],features:[Ho],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"g",1),oa(2,m6,3,1,"g",2),oa(3,C6,7,6,"g",3),oa(4,E6,3,3,"g",2),ha(5,"g",null,4),fa(7,"rect",5,6),oa(9,P6,5,3,"g",3),da(),oa(10,M6,5,6,"g",2),da(),da()),2&e&&(na("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),Ts(2),la("ngForOf",t.board),Ts(1),la("ngIf",t.chosen.isPresent()),Ts(1),la("ngForOf",t.victoriousCoords),Ts(1),na("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),Ts(2),na("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),Ts(2),la("ngIf",t.chosen.isAbsent()),Ts(1),la("ngForOf",t.board))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),R6=(()=>{class e{}return e.NO_INSIDE_CLICK=()=>$localize`You must pick a space from the edge of the board.`,e})();class D6 extends vQ{constructor(e,t,n){super(e,t),this.direction=n;const r=D6.isValidCoord(this.coord);if(r.isFailure())throw new Error(r.getReason());if(0===e&&n===XJ.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&n===XJ.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===t&&n===XJ.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===t&&n===XJ.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.")}static isValidCoord(e){return e.isNotInRange(5,5)?DG.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?DG.failure(R6.NO_INSIDE_CLICK()):DG.SUCCESS}toString(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}D6.encoder=new class extends qY{maxValue(){return 128}encodeNumber(e){const t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}decodeNumber(e){const t=XJ.factory.fromInt(e%4).get();e-=e%4;const n=(e/=4)%5;return e-=e%5,new D6(e/=5,n,t)}};class L6 extends gQ{static getInitialState(){const e=QY.createTable(5,5,ZY.NONE);return new L6(e,0)}applyLegalMove(e){const t=this.getCopiedBoard(),n=this.turn+1;let r=e.coord,i=e.coord.getNext(e.direction);for(;i.isInRange(5,5);)t[r.y][r.x]=t[i.y][i.x],r=r.getNext(e.direction),i=i.getNext(e.direction);return t[r.y][r.x]=this.getCurrentPlayer(),new L6(t,n)}}class F6 extends OQ{static getVerticalCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new eQ(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new eQ(4,r));return n}static getHorizontalCenterCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new eQ(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new eQ(r,4));return n}static getPossibleDirections(e){const t=[];return 0!==e.x&&t.push(XJ.LEFT),0!==e.y&&t.push(XJ.UP),4!==e.x&&t.push(XJ.RIGHT),4!==e.y&&t.push(XJ.DOWN),t}static getLinesSums(e){const t={};t[jY.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[jY.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(let n=0;n<5;n++)for(let r=0;r<5;r++){const i=e.getPieceAtXY(r,n);if(i.isPlayer()){const e=i.value;t[e].columns[r]=t[e].columns[r]+1,t[e].rows[n]=t[e].rows[n]+1,r===n&&(t[e].diagonals[0]=t[e].diagonals[0]+1),r+n===4&&(t[e].diagonals[1]=t[e].diagonals[1]+1)}}return t}static getVictoriousCoords(e){const t=F6.getLinesSums(e),n=[];for(let r=0;r<2;r++){for(let e=0;e<5;e++){if(5===t[r].columns[e])for(let t=0;t<5;t++)n.push(new eQ(e,t));if(5===t[r].rows[e])for(let t=0;t<5;t++)n.push(new eQ(t,e))}if(5===t[r].diagonals[0])for(let e=0;e<5;e++)n.push(new eQ(e,e));if(5===t[r].diagonals[1])for(let e=0;e<5;e++)n.push(new eQ(e,4-e))}return n}static getFullestLine(e){const t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max(...t)}applyLegalMove(e,t,n){return F6.applyLegalMove(e,t,n)}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?MG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):MG.success(void 0)}getGameStatus(e){const t=e.gameState,n=F6.getLinesSums(t),r=F6.getFullestLine(n[jY.ZERO.value]),i=F6.getFullestLine(n[jY.ONE.value]),s=t.getCurrentPlayer();return 5===r&&(s===jY.ZERO||i<5)?PQ.ZERO_WON:5===i?PQ.ONE_WON:PQ.ONGOING}}class B6 extends uQ{getListMoves(e){const t=[],n=F6.getVerticalCoords(e),r=F6.getHorizontalCenterCoords(e).concat(n);for(const i of r){const e=F6.getPossibleDirections(i);for(const n of e){const e=new D6(i.x,i.y,n);t.push(e)}}return t}getBoardValue(e){const t=e.gameState,n=F6.getLinesSums(t),r=F6.getFullestLine(n[jY.ZERO.value]),i=F6.getFullestLine(n[jY.ONE.value]),s=t.getCurrentPlayer();return new hQ(5===r&&(s===jY.ZERO||i<5)?jY.ZERO.getVictoryValue():5===i?jY.ONE.getVictoryValue():i-r)}}class U6{static getArrowTransform(e,t,n){let r,i,s;switch(n){case XJ.UP:r=0,i=-1,s=-90;break;case XJ.DOWN:r=0,i=1,s=90;break;case XJ.LEFT:r=-1,i=0,s=180;break;default:uw.expectToBe(n,XJ.RIGHT),r=1,i=0,s=0}return[`translate(${t.x*e+e/2+r*e/4} ${t.y*e+e/2+i*e/4})`,"scale(2.5)",`rotate(${s})`].join(" ")}}const V6=ZY.NONE,$6=jY.ZERO,z6=jY.ONE;class H6{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game.`,$localize`At Quixo, the goal is to align 5 of your pieces.
        The first player plays with dark pieces, the second with light pieces.
        The board is made of 25 spaces spread over a 5x5 square.
        Every piece has a neutral side, a light side, and a dark side.`,L6.getInitialState()),AQ.fromMove($localize`What a move looks like (without animation)`,$localize`When it is your turn:
        <ol>
            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.
                You can only choose a piece from the edge of the board.</li>
            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>
        </ol>
        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.
        Once on the other side, all pieces will move by one space in the opposing direction.
        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>
        For example, take the bottom right neutral piece, and move it to the left (you're playing Light).`,new L6([[V6,V6,V6,V6,V6],[V6,V6,V6,V6,V6],[V6,V6,V6,V6,V6],[V6,V6,V6,V6,V6],[$6,$6,$6,$6,V6]],1),[new D6(4,4,XJ.LEFT)],$localize`See how the four dark pieces have been moved one space to the right.
        The neutral piece has been move 4 pieces to the left and has become light.`,$localize`Failed!`),AQ.fromMove($localize`Victory`,$localize`You already know everything you need in order to play, but there is one last particularity.
        If you create a line of 5 of your pieces, you win.
        If you create a line of 5 of your opponent's pieces, you lose.
        If you create both, you lose too!<br/><br/>
        You can win with this board, try it.
        You're playing Light.`,new L6([[V6,z6,V6,z6,z6],[V6,$6,$6,V6,$6],[z6,z6,z6,$6,z6],[$6,V6,$6,z6,z6],[z6,$6,V6,z6,$6]],31),[new D6(3,0,XJ.DOWN)],$localize`Congratulations, you won!`,$localize`Failed!`)]}}function G6(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",4),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onBoardClick(t,n)}),da(),da()}if(2&e){const e=t.index,n=wa().index,r=wa();Ts(1),Oa("id","click_",e,"_",n,""),la("ngClass",r.getPieceClasses(e,n)),na("cx",50+100*e)("cy",50+100*n)}}function q6(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,G6,2,5,"g",2),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function W6(e,t){if(1&e){const e=ma();Cn(),ha(0,"use",6),_a("click",function(){const t=Gt(e).$implicit;return wa(2).chooseDirection(t)}),da()}if(2&e){const e=t.$implicit,n=wa(2);Pa("id","chooseDirection_",e,""),na("transform",n.getArrowTransform(n.chosenCoord.get(),e))}}function j6(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,W6,1,2,"use",5),da()),2&e){const e=wa();Ts(1),la("ngForOf",e.getPossiblesDirections())}}let Z6=(()=>{class e extends hX{constructor(e){super(e),this.lastMoveCoord=gw.empty(),this.chosenCoord=gw.empty(),this.victoriousCoords=[],this.rules=new F6(L6),this.availableMinimaxes=[new B6(this.rules,"QuixoMinimax")],this.encoder=D6.encoder,this.tutorial=(new H6).tutorial,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(e=>e.coord),this.victoriousCoords=F6.getVictoriousCoords(this.state)}cancelMoveAttempt(){this.chosenCoord=gw.empty()}getPieceClasses(e,t){const n=new eQ(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(e=>e.equals(n))&&r.push("victory-stroke"),r}onBoardClick(e,t){const n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=new eQ(e,t),i=D6.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=gw.of(r),DG.SUCCESS)}getPossiblesDirections(){const e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}chooseDirection(e){var t=this;return lw(function*(){const n=t.canUserPlay("#chooseDirection_"+e);return n.isFailure()?t.cancelMove(n.getReason()):(t.chosenDirection=XJ.factory.fromString(e).get(),yield t.tryMove())})()}tryMove(){var e=this;return lw(function*(){const t=e.chosenCoord.get(),n=new D6(t.x,t.y,e.chosenDirection);return e.cancelMove(),e.chooseMove(n,e.rules.node.gameState)})()}getArrowTransform(e,t){return U6.getArrowTransform(this.SPACE_SIZE,e,XJ.factory.fromString(t).get())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-quixo"]],features:[Ho],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"defs"),fa(2,"polygon",1),da(),oa(3,q6,2,1,"g",2),oa(4,j6,2,1,"g",3),da()),2&e&&(Ts(3),la("ngForOf",t.board),Ts(1),la("ngIf",t.chosenCoord.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),Y6=(()=>{class e extends gQ{static getInitialState(){const t=QY.createTable(e.BOARD_WIDTH,e.BOARD_HEIGHT,ZY.NONE);return t[3][3]=jY.ZERO,t[4][4]=jY.ZERO,t[3][4]=jY.ONE,t[4][3]=jY.ONE,new e(t,0)}static getNeighbooringPawnLike(e,t,n,r){let i;const s=[];for(let o=-1;o<2;o++)for(let a=-1;a<2;a++)i=new eQ(n+a,r+o),i.isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&s.push(i);return s}countScore(){const t=[0,0];for(let n=0;n<e.BOARD_HEIGHT;n++)for(let r=0;r<e.BOARD_WIDTH;r++){const e=this.board[n][r];e.isPlayer()&&(t[e.value]+=1)}return t}}return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e})();class K6 extends vQ{equals(e){return e===this||e.coord.equals(this.coord)}toString(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}K6.encoder=new class extends qY{maxValue(){return(Y6.BOARD_HEIGHT-1)*Y6.BOARD_WIDTH+(Y6.BOARD_WIDTH-1)}encodeNumber(e){return e.coord.y*Y6.BOARD_WIDTH+e.coord.x}decodeNumber(e){const t=e%Y6.BOARD_WIDTH;return new K6(t,(e-t)/Y6.BOARD_WIDTH)}},K6.PASS=new K6(-1,-1),K6.PASS_NUMBER=K6.encoder.encodeNumber(K6.PASS);let J6=(()=>{class e{}return e.NO_ELEMENT_SWITCHED=()=>$localize`Your move should switch at least one piece.`,e})();class Q6{constructor(e,t){this.move=e,this.switched=t}}let X6=(()=>{class e extends OQ{static getGameStatus(t){const n=t.gameState;if(!1===e.isGameEnded(n))return PQ.ONGOING;const r=n.countScore(),i=r[1]-r[0];return i<0?PQ.ZERO_WON:i>0?PQ.ONE_WON:PQ.DRAW}applyLegalMove(e,t,n){const r=t.turn,i=t.getCurrentPlayer(),s=t.getCopiedBoard();if(e.equals(K6.PASS))return new Y6(s,r+1);for(const o of n)s[o.y][o.x]=i;return s[e.coord.y][e.coord.x]=i,new Y6(s,r+1)}static getAllSwitcheds(t,n,r){const i=[],s=n.getOpponent();for(const o of QJ.DIRECTIONS){const a=t.coord.getNext(o);if(a.isInRange(Y6.BOARD_WIDTH,Y6.BOARD_HEIGHT)&&r[a.y][a.x]===s){const t=e.getSandwicheds(n,o,a,r);for(const e of t)i.push(e)}}return i}static getSandwicheds(e,t,n,r){const i=[n];let s=n.getNext(t);for(;s.isInRange(Y6.BOARD_WIDTH,Y6.BOARD_HEIGHT);){const n=r[s.y][s.x];if(n===e)return i;if(n===ZY.NONE)return[];i.push(s),s=s.getNext(t)}return[]}static isGameEnded(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}getGameStatus(t){return e.getGameStatus(t)}static playerCanOnlyPass(e){const t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(K6.PASS)}static nextPlayerCantOnlyPass(e){const t=e.getCopiedBoard(),n=new Y6(t,e.turn+1);return this.playerCanOnlyPass(n)}static getListMoves(t){const n=[];let r;const i=t.getCurrentPlayer(),s=t.getCurrentOpponent();for(let o=0;o<8;o++)for(let a=0;a<8;a++)if(t.getPieceAtXY(a,o)===ZY.NONE&&(r=t.getCopiedBoard(),Y6.getNeighbooringPawnLike(r,s,a,o).length>0)){const s=new K6(a,o),c=e.getAllSwitcheds(s,i,r);if(c.length>0){for(const e of c)VG(i!==t.getPieceAt(e),e+"was already switched!"),r[e.y][e.x]=i;r[o][a]=i,n.push(new Q6(s,c.length))}}return 0===n.length&&n.push(new Q6(K6.PASS,0)),n}isLegal(t,n){if(t.equals(K6.PASS))return e.playerCanOnlyPass(n)?MG.success([]):MG.failure(lQ.MUST_PASS());if(n.getPieceAt(t.coord).isPlayer())return hw(e.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),MG.failure(lQ.MUST_CLICK_ON_EMPTY_SPACE());const r=n.getCopiedBoard(),i=e.getAllSwitcheds(t,n.getCurrentPlayer(),r);return hw(e.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?MG.failure(J6.NO_ELEMENT_SWITCHED()):MG.success(i)}}return e.VERBOSE=!1,e})();class e8 extends uQ{getBoardValue(e){const t=X6.getGameStatus(e);if(t.isEndGame)return hQ.fromWinner(t.winner);const n=e.gameState.getCopiedBoard();let r=0,i=0;for(let s=0;s<Y6.BOARD_HEIGHT;s++)for(let e=0;e<Y6.BOARD_WIDTH;e++){const t=(0===e||e===Y6.BOARD_WIDTH-1?4:1)*(0===s||s===Y6.BOARD_HEIGHT-1?4:1);n[s][e]===jY.ZERO&&(r+=t),n[s][e]===jY.ONE&&(i+=t)}return r*=jY.ZERO.getScoreModifier(),i*=jY.ONE.getScoreModifier(),new hQ(i+r)}getListMoves(e){const t=X6.getListMoves(e.gameState);return QY.sortByDescending(t,e=>e8.bestCoords.some(t=>e.move.coord.equals(t))?100:e.switched),t.map(e=>e.move)}}e8.bestCoords=[new eQ(0,0),new eQ(0,Y6.BOARD_HEIGHT-1),new eQ(Y6.BOARD_WIDTH-1,0),new eQ(Y6.BOARD_WIDTH-1,Y6.BOARD_HEIGHT-1)];const t8=ZY.NONE,n8=jY.ZERO,r8=jY.ONE;class i8{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.
        When one piece is flipped, its owner changes.
        The player owning the most pieces at the end of the game wins.
        Here, Dark has 28 points and Light has 36, hence Light wins.`,new Y6([[n8,n8,n8,n8,n8,n8,n8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,n8,n8,n8,n8,n8,n8,n8]],60)),AQ.anyMove($localize`Capture (1/2)`,$localize`At the beginning of the game, pieces are placed as shown here.
        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>
        Do any move by clicking to put your piece
        Dark plays first.`,Y6.getInitialState(),new K6(2,4),$localize`Congratulations!`),AQ.fromMove($localize`Capture (2/2)`,$localize`A move can also capture a bigger line, and more than one lines at a time
        You're playing light here.<br/><br/>
        Play on the bottom left to see an example.`,new Y6([[t8,t8,t8,t8,t8,t8,t8,t8],[t8,t8,t8,t8,t8,t8,t8,t8],[t8,t8,t8,t8,t8,t8,t8,t8],[t8,t8,t8,t8,r8,t8,t8,t8],[t8,t8,t8,n8,t8,t8,t8,t8],[t8,t8,n8,t8,t8,t8,t8,t8],[n8,n8,t8,t8,t8,t8,t8,t8],[t8,n8,r8,n8,r8,n8,t8,t8]],1),[new K6(0,7)],$localize`Congratulations!`,$localize`Lower and more to the left, please.`),AQ.informational($localize`Passing a turn`,$localize`If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass
        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way.`,new Y6([[r8,n8,n8,n8,n8,n8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[n8,r8,r8,r8,r8,r8,r8,n8],[r8,r8,r8,r8,r8,r8,t8,t8],[n8,n8,n8,n8,n8,n8,t8,t8]],60))]}}function s8(e,t){if(1&e&&(Cn(),fa(0,"circle",4)),2&e){const e=wa().index,t=wa().index,n=wa();la("ngClass",n.getPieceClass(e,t)),na("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)}}function o8(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",2),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,s8,1,4,"circle",3),da()}if(2&e){const e=t.index,n=wa().index,r=wa();Ts(1),Oa("id","click_",e,"_",n,""),la("ngClass",r.getRectClasses(e,n)),na("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),la("ngIf",r.board[n][e]!==r.NONE)}}function a8(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,o8,3,8,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let c8=(()=>{class e extends hX{constructor(e){super(e),this.NONE=ZY.NONE,this.lastMove=new eQ(-2,-2),this.captureds=[],this.scores=gw.of([2,2]),this.rules=new X6(Y6),this.availableMinimaxes=[new e8(this.rules,"ReversiMinimax")],this.encoder=K6.encoder,this.tutorial=(new i8).tutorial,this.canPass=!1,this.updateBoard()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new K6(e,t);return yield n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new eQ(-2,-2),this.scores=gw.of(e.countScore()),this.canPass=X6.playerCanOnlyPass(e)}showPreviousMove(){this.lastMove=this.rules.node.move.get().coord;const e=this.rules.node.gameState.getCurrentPlayer(),t=this.rules.node.gameState.getCurrentOpponent();for(const n of QJ.DIRECTIONS){let r=this.lastMove.getNext(n,1);for(;r.isInRange(Y6.BOARD_WIDTH,Y6.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(r)===t&&this.rules.node.mother.get().gameState.getPieceAt(r)===e;)this.captureds.push(r),r=r.getNext(n,1)}}getRectClasses(e,t){const n=new eQ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:n.equals(this.lastMove)?["moved"]:[]}getPieceClass(e,t){return this.getPlayerClass(this.board[t][e])}pass(){var e=this;return lw(function*(){return VG(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(K6.PASS.coord.x,K6.PASS.coord.y)})()}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-reversi"]],features:[Ho],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,a8,2,1,"g",1),da()),2&e&&(na("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),Ts(1),la("ngForOf",t.board))},directives:[Ud,Fd,$d],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),l8=(()=>{class e extends l1{static getInitialState(){const t=rQ.NONE,n=rQ.ZERO,r=rQ.ONE,i=rQ.EMPTY;return new e([[t,t,n,r,i,i,i,n,r,t,t],[t,i,i,i,i,i,i,i,i,i,t],[r,i,i,i,i,i,i,i,i,i,n],[n,i,i,i,i,i,i,i,i,i,r],[t,i,i,i,i,i,i,i,i,i,t],[t,t,r,n,i,i,i,r,n,t,t]],0)}}return e.HEIGHT=6,e.WIDTH=11,e})(),u8=(()=>{class e{}return e.CAN_ONLY_REBOUND_ON_BLACK=()=>$localize`You can only rebound on dark spaces.`,e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=()=>$localize`You can only rebound on empty spaces.`,e.MUST_CHOOSE_PYRAMID_FIRST=()=>$localize`You must pick one of your pyramids first.`,e.MUST_CHOOSE_OWN_PYRAMID=()=>$localize`You must pick one of your pyramids.`,e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=()=>$localize`Those two spaces are not neighbors.`,e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=()=>$localize`Those two spaces have no intermediary neighbor.`,e})();class h8 extends EX{constructor(e,t){super(e,t)}static checkDistanceAndLocation(e,t){const n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return DG.failure(lQ.MOVE_CANNOT_BE_STATIC());if(1===n){const n=c1.getFakeNeighbors(e);if(t.equals(n))return DG.failure(u8.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return DG.failure($localize`You can move one or two spaces, not ${n}.`);if((e.x+e.y)%2==0)return DG.failure(u8.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return DG.failure(u8.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return DG.SUCCESS}static from(e,t){if(!e.isInRange(l8.WIDTH,l8.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(l8.WIDTH,l8.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");const n=h8.checkDistanceAndLocation(e,t);return n.isFailure()?n.toFailedFallible():MG.success(new h8(e,t))}isSimpleStep(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"SaharaMove("+this.coord+"->"+this.end+")"}}h8.encoder=new class extends qY{maxValue(){return 396*l8.WIDTH+66*l8.HEIGHT+6*l8.WIDTH+l8.HEIGHT}encodeNumber(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}decodeNumber(e){const t=e%6;e-=t;const n=(e/=6)%11;e-=n;const r=(e/=11)%6;return e-=r,h8.from(new eQ(e/=6,r),new eQ(n,t)).get()}};let d8=(()=>{class e extends OQ{static getStartingCoords(e,t){const n=[];for(let r=0;r<l8.HEIGHT;r++)for(let i=0;i<l8.WIDTH;i++)e[r][i].is(t)&&n.push(new eQ(i,r));return n}static getBoardValuesFor(t,n){const r=e.getStartingCoords(t,n),i=[];for(const e of r){const n=l1.getEmptyNeighbors(t,e,rQ.EMPTY).length;if(0===n)return[0];i.push(n)}return i.sort((e,t)=>e-t)}applyLegalMove(t,n,r){hw(e.VERBOSE,"Legal move "+t.toString()+" applied");const i=n.getCopiedBoard();return i[t.end.y][t.end.x]=i[t.coord.y][t.coord.x],i[t.coord.y][t.coord.x]=rQ.EMPTY,new l8(i,n.turn+1)}isLegal(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return MG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==rQ.EMPTY)return MG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE());const n=c1.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===rQ.EMPTY?MG.success(void 0):MG.failure(u8.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):MG.success(void 0)}getGameStatus(t){const n=t.gameState.getCopiedBoard(),r=e.getBoardValuesFor(n,jY.ZERO),i=e.getBoardValuesFor(n,jY.ONE);return e.getGameStatusFromFreedoms(r,i)}static getGameStatusFromFreedoms(e,t){return 0===e[0]?PQ.ONE_WON:0===t[0]?PQ.ZERO_WON:PQ.ONGOING}}return e.VERBOSE=!1,e})();class f8 extends uQ{getListMoves(e){const t=[],n=e.gameState.getCopiedBoard(),r=e.gameState.getCurrentPlayer(),i=d8.getStartingCoords(n,r);for(const s of i){const e=l1.getEmptyNeighbors(n,s,rQ.EMPTY);for(const r of e){const e=h8.from(s,r).get();if(n[r.y][r.x]=n[s.y][s.x],n[s.y][s.x]=rQ.EMPTY,t.push(e),(r.y+r.x)%2==0){const e=l1.getEmptyNeighbors(n,r,rQ.EMPTY);for(const i of e)if(!i.equals(s)){const e=h8.from(s,i).get();n[i.y][i.x]=n[r.y][r.x],n[r.y][r.x]=rQ.EMPTY,t.push(e),n[r.y][r.x]=n[i.y][i.x],n[i.y][i.x]=rQ.EMPTY}}n[s.y][s.x]=n[r.y][r.x],n[r.y][r.x]=rQ.EMPTY}}return t}getBoardValue(e){const t=e.gameState.getCopiedBoard(),n=d8.getBoardValuesFor(t,jY.ZERO),r=d8.getBoardValuesFor(t,jY.ONE),i=d8.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return hQ.fromWinner(i.winner);let s=0;for(;s<6&&n[s]===r[s];)s++;return new hQ(r[s%6]-n[s%6])}}const p8=rQ.NONE,g8=rQ.ZERO,m8=rQ.ONE,y8=rQ.EMPTY;class v8{constructor(){this.tutorial=[AQ.informational($localize`Initial board`,$localize`Shr is played on a board where each space is a triangle.
        Each player has six pyramids.`,l8.getInitialState()),AQ.informational($localize`Goal of the game`,$localize`At Shr, the goal of the game is to immobilize one of the opponent's pyramids.
        To do so, you have to occupy all neighboring space of that pyramid.
        Here, Light has lost because its leftmost pyramid is immobilized.`,new l8([[p8,p8,y8,y8,m8,y8,y8,g8,m8,p8,p8],[p8,y8,y8,y8,y8,y8,y8,y8,y8,y8,p8],[m8,g8,y8,y8,y8,y8,y8,y8,y8,y8,g8],[g8,y8,y8,y8,y8,y8,y8,y8,y8,y8,m8],[p8,y8,y8,y8,y8,y8,y8,y8,y8,y8,p8],[p8,p8,m8,g8,y8,y8,y8,m8,g8,p8,p8]],3)),AQ.fromPredicate($localize`Simple step`,$localize`To immobilize your opponent, you have to move your pyramids.
        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).
        You're the first player, playing with the dark pyramids.
        <ol>
            <li>Click on one of your pyramids.</li>
            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>
        </ol><br/>
        Do any simple step.`,l8.getInitialState(),h8.from(new eQ(2,0),new eQ(2,1)).get(),(e,t)=>e.isSimpleStep()?DG.SUCCESS:DG.failure($localize`You have made a double step, which is good but it is the next exercise!`),$localize`Congratulations!`),AQ.fromPredicate($localize`Double step`,$localize`When a pyramid shares its vertices with dark spaces, it can move one or two steps.
        To do so:
        <ol>
            <li>Click on the pyramid to move.</li>
            <li>Click on one of the 6 destinations that you can reach in two steps:
                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.
        </ol>`,l8.getInitialState(),h8.from(new eQ(7,0),new eQ(5,0)).get(),(e,t)=>e.isSimpleStep()?DG.failure($localize`Failed! You have made a single step.`):DG.SUCCESS,$localize`Congratulations!`)]}}function _8(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"polyline",6),da()),2&e){const e=wa().index,t=wa().index,n=wa();Ts(1),la("ngClass",n.getPlayerClassFor(e,t)),na("points",n.getPyramidCoordinate(e,t))}}function C8(e,t){if(1&e&&(Cn(),fa(0,"polyline",9)),2&e){const e=wa(2).index,t=wa().index;na("points",wa().getTriangleCoordinate(e,t))}}function E8(e,t){if(1&e&&(Cn(),fa(0,"polyline",10)),2&e){const e=wa(2).index,t=wa().index;na("points",wa().getTriangleCoordinate(e,t))}}function w8(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,C8,1,1,"polyline",7),oa(2,E8,1,1,"polyline",8),da()),2&e){const e=wa().index,t=wa().index;Ts(1),la("ngIf",(e+t)%2==1),Ts(1),la("ngIf",(e+t)%2==0)}}function b8(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",5),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),oa(1,_8,2,2,"g",2),oa(2,w8,3,2,"g",2),da()}if(2&e){const e=t.$implicit;Oa("id","click_",t.index,"_",wa().index,""),Ts(1),la("ngIf",e.isPlayer()),Ts(1),la("ngIf",2===e.value)}}function S8(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,b8,3,4,"g",4),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function P8(e,t){if(1&e&&(Cn(),pa(0),fa(1,"polyline",11),fa(2,"polyline",11),ga()),2&e){const e=wa();Ts(1),na("points",e.getTriangleCoordinate(e.lastCoord.get().x,e.lastCoord.get().y)),Ts(1),na("points",e.getTriangleCoordinate(e.lastMoved.get().x,e.lastMoved.get().y))}}function O8(e,t){if(1&e&&(Cn(),fa(0,"polyline",12)),2&e){const e=wa();na("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}let T8=(()=>{class e extends i1{constructor(e){super(e),this.lastCoord=gw.empty(),this.lastMoved=gw.empty(),this.chosenCoord=gw.empty(),this.rules=new d8(l8),this.availableMinimaxes=[new f8(this.rules,"SaharaMinimax")],this.encoder=h8.encoder,this.tutorial=(new v8).tutorial,this.updateBoard()}cancelMoveAttempt(){this.chosenCoord=gw.empty()}onClick(e,t){var n=this;return lw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t)})()}choosePiece(e,t){return this.board[t][e]===rQ.EMPTY?this.cancelMove(u8.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=gw.of(new eQ(e,t)),DG.SUCCESS):this.cancelMove(u8.MUST_CHOOSE_OWN_PYRAMID())}chooseLandingCoord(e,t){var n=this;return lw(function*(){const r=new eQ(e,t),i=n.rules.node.gameState.getCurrentPlayer(),s=rQ.ofPlayer(i);if(n.board[t][e]===s)return n.chosenCoord=gw.of(new eQ(e,t)),DG.SUCCESS;const o=h8.from(n.chosenCoord.get(),r);return o.isFailure()?n.cancelMove(o.getReason()):yield n.chooseMove(o.get(),n.rules.node.gameState)})()}updateBoard(){this.chosenCoord=gw.empty();const e=this.rules.node.move;this.lastCoord=e.map(e=>e.coord),this.lastMoved=e.map(e=>e.end),this.board=this.rules.node.gameState.board}getPlayerClassFor(e,t){return this.getPlayerClass(jY.of(this.board[t][e].value))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-sahara"]],features:[Ho],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,S8,2,1,"g",1),oa(2,P8,3,2,"ng-container",2),oa(3,O8,1,1,"polyline",3),da()),2&e&&(Ts(1),la("ngForOf",t.board),Ts(1),la("ngIf",t.lastMoved.isPresent()),Ts(1),la("ngIf",t.chosenCoord.isPresent()))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class I8 extends vQ{constructor(e,t,n,r){super(e,t),this.x=e,this.y=t,this.moveDirection=n,this.landingOrientation=r,this.checkValidity()}checkValidity(){const e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}isRotation(){return this.moveDirection.isAbsent()}equals(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}toString(){const e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}isInsertion(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}I8.encoder=new class extends qY{maxValue(){return 2408}encodeNumber(e){const t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}decodeNumber(e){const t=e%7;e-=t;const n=(e/=7)%7;e-=n;const r=(e/=7)%5,i=4===r?gw.empty():XJ.factory.fromInt(r).toOptional();e-=r;const s=XJ.factory.fromInt(e/=5).get();return new I8(n-1,t-1,i,s)}};class k8{constructor(e){this.value=e}static decode(e){switch(e){case 0:return k8.EMPTY;case 1:return k8.WHITE_UP;case 2:return k8.WHITE_RIGHT;case 3:return k8.WHITE_DOWN;case 4:return k8.WHITE_LEFT;case 5:return k8.BLACK_UP;case 6:return k8.BLACK_RIGHT;case 7:return k8.BLACK_DOWN;case 8:return k8.BLACK_LEFT;case 9:return k8.MOUNTAIN}}belongTo(e){return e===jY.ZERO?1<=this.value&&this.value<=4:5<=this.value&&this.value<=8}isEmptyOrMountain(){return 0===this.value||9===this.value}isPiece(){return!this.isEmptyOrMountain()}getOwner(){return 1<=this.value&&this.value<=4?jY.ZERO:5<=this.value&&this.value<=8?jY.ONE:ZY.NONE}getOptionalDirection(){switch(this.value){case 0:return gw.empty();case 1:case 5:return gw.of(XJ.UP);case 2:case 6:return gw.of(XJ.RIGHT);case 3:case 7:return gw.of(XJ.DOWN);case 4:case 8:return gw.of(XJ.LEFT);default:return uw.expectToBe(this.value,9),gw.empty()}}static of(e,t){return t===jY.ZERO?e===XJ.UP?k8.WHITE_UP:e===XJ.RIGHT?k8.WHITE_RIGHT:e===XJ.DOWN?k8.WHITE_DOWN:k8.WHITE_LEFT:e===XJ.UP?k8.BLACK_UP:e===XJ.RIGHT?k8.BLACK_RIGHT:e===XJ.DOWN?k8.BLACK_DOWN:k8.BLACK_LEFT}getDirection(){return this.getOptionalDirection().get()}toString(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return uw.expectToBe(this.value,9),"MOUNTAIN"}}}k8.EMPTY=new k8(0),k8.WHITE_UP=new k8(1),k8.WHITE_RIGHT=new k8(2),k8.WHITE_DOWN=new k8(3),k8.WHITE_LEFT=new k8(4),k8.BLACK_UP=new k8(5),k8.BLACK_RIGHT=new k8(6),k8.BLACK_DOWN=new k8(7),k8.BLACK_LEFT=new k8(8),k8.MOUNTAIN=new k8(9);class A8 extends gQ{static getInitialState(){const e=QY.createTable(5,5,k8.EMPTY);return e[2][1]=k8.MOUNTAIN,e[2][2]=k8.MOUNTAIN,e[2][3]=k8.MOUNTAIN,new A8(e,0)}countPlayerPawn(){let e=0;for(let t=0;t<5;t++)for(let n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}let N8=(()=>{class e{}return e.CANNOT_INSERT_WHEN_SELECTED=()=>$localize`You cannot insert a piece when you have already selected a piece.`,e.NO_REMAINING_PIECE_TO_INSERT=()=>$localize`You cannot insert a piece, all your pieces are already on the board.`,e.NOT_ENOUGH_FORCE_TO_PUSH=()=>$localize`You do not have enough strength to push.`,e.ILLEGAL_ROTATION=()=>$localize`You cannot push and turn at the same time.`,e.ILLEGAL_PUSH=()=>$localize`Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board.`,e})();class M8{constructor(e,t){this.resultingBoard=e,this.moved=t}}let x8=(()=>{class e extends OQ{isLegal(t,n){if(hw(e.VERBOSE,{SiamRules_isLegal:{move:t,state:n}}),!t.isInsertion()&&!n.getPieceAt(t.coord).belongTo(n.getCurrentPlayer()))return MG.failure(lQ.MUST_CHOOSE_PLAYER_PIECE());if(t.isRotation())return hw(e.VERBOSE,"Move is rotation"),this.isLegalRotation(t,n);{let r;if(t.isInsertion()){hw(e.VERBOSE,"Move is insertion");const i=this.isLegalInsertion(t.coord,n);if(i.legal.isFailure())return MG.failure(i.legal.getReason());r=i.insertedPiece}else hw(e.VERBOSE,"Move is forward"),r=n.getPieceAt(t.coord);return e.isLegalForwarding(t,n,r)}}isLegalInsertion(t,n){const r=n.countPlayerPawn(),i=n.getCurrentPlayer(),s=r<5?DG.SUCCESS:DG.failure(N8.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:e.getInsertedPiece(t,i),legal:s}}static getInsertedPiece(e,t){return k8.of(-1===e.x?XJ.RIGHT:-1===e.y?XJ.DOWN:5===e.x?XJ.LEFT:XJ.UP,t)}static isLegalForwarding(t,n,r){hw(e.VERBOSE,{isLegalForwarding:{move:t.toString(),state:n,firstPiece:r}});const i=[];let s=k8.of(t.landingOrientation,n.getCurrentPlayer());const o=t.moveDirection.get();let a=t.coord.getNext(o);if(a.isInRange(5,5)&&n.getPieceAt(a)!==k8.EMPTY&&!1===e.isStraight(r,t))return hw(e.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),MG.failure(N8.ILLEGAL_PUSH());let c=gw.of(o);const l=o.getOpposite();let u=0;const h=n.getCopiedBoard();t.coord.isInRange(5,5)&&(h[t.coord.y][t.coord.x]=k8.EMPTY,i.push(t.coord));let d=a.isInRange(5,5)&&s!==k8.EMPTY;for(;d;){c.equalsValue(o)?u++:c.equalsValue(l)&&u--,hw(e.VERBOSE,{totalForce:u,movingPiece:s,landingCoord:a});const t=h[a.y][a.x];t===k8.MOUNTAIN&&(u-=.9),h[a.y][a.x]=s,i.push(a),s=t,a=a.getNext(o),c=s.getOptionalDirection(),d=a.isInRange(5,5)&&s!==k8.EMPTY&&u>0}return a.isNotInRange(5,5)&&(hw(e.VERBOSE,"This movement would push "+s+" outside the board"),c.equalsValue(o)?u++:c.equalsValue(l)&&u--),u<=0?(hw(e.VERBOSE,"This move is an illegal push: "+h),MG.failure(N8.NOT_ENOUGH_FORCE_TO_PUSH())):(hw(e.VERBOSE,"This move is a legal push: "+h),MG.success(new M8(h,i)))}static isStraight(e,t){const n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}isLegalRotation(t,n){hw(e.VERBOSE,{isLegalRotation:{rotation:t,state:n}});const r=t.coord,i=n.getPieceAt(r),s=n.getCurrentPlayer();if(i.getDirection()===t.landingOrientation)return MG.failure(N8.ILLEGAL_ROTATION());const o=n.getCopiedBoard();return o[r.y][r.x]=k8.of(t.landingOrientation,s),MG.success(new M8(o,[r]))}applyLegalMove(e,t,n){const r=QY.copyBiArray(n.resultingBoard);return new A8(r,t.turn+1)}static getBoardValueInfo(t,n){const r=e.getMountainsRowsAndColumns(n),i=r.rows,s=r.columns,o=e.getWinner(n,t,r.nbMountain);if(o.isPlayer())return o===jY.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER};{const t=e.getPushers(n,s,i);let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const a=n.getCurrentPlayer();for(const e of t)e.coord.isInRange(5,5)?n.getPieceAt(e.coord).belongTo(jY.ZERO)?r=Math.min(r,e.distance):o=Math.min(o,e.distance):a===jY.ZERO?r=Math.min(r,e.distance):o=Math.min(o,e.distance);return{shortestZero:r,shortestOne:o,boardValue:e.getScoreFromShortestDistances(r,o,a)}}}static getScoreFromShortestDistances(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);const r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}static getMountainsRowsAndColumns(e){const t=[],n=[];let r=0;for(let i=0;i<5;i++)for(let s=0;s<5;s++)e.getPieceAtXY(s,i)===k8.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(s)||n.push(s),r++);return{rows:t,columns:n,nbMountain:r}}static getWinner(t,n,r){return 2===r?e.getPusher(t,n.get()):ZY.NONE}static getPusher(t,n){const r=n.coord;let i;i=r.isInRange(5,5)?t.getPieceAt(r.getNext(n.landingOrientation)):e.getInsertedPiece(r,t.getCurrentOpponent());const s=i.getDirection(),o=e.getPusherCoord(t,s,r),a=t.getPieceAt(o).getOwner();return hw(e.VERBOSE,r.toString()+" belong to "+t.getCurrentOpponent().value+", "+o.toString()+" belong to "+a.value+", "+a.value+" win"),a}static getPusherCoord(e,t,n){let r=n.getNext(t),i=n;for(;r.isInRange(5,5);){n=r,r=r.getNext(t);const s=e.getPieceAt(n);s!==k8.MOUNTAIN&&s.getDirection()===t&&(i=n)}return i}static getPushers(t,n,r){hw(e.VERBOSE,{getPushers:{state:t,mountainsColumn:n,mountainsRow:r}});let i=[];const s=[];for(const e of n){let t=XJ.DOWN,n=new eQ(e,4);s.push({direction:t,fallingCoord:n}),t=XJ.UP,n=new eQ(e,0),s.push({direction:t,fallingCoord:n})}for(const e of r){let t=XJ.LEFT,n=new eQ(0,e);s.push({direction:t,fallingCoord:n}),t=XJ.RIGHT,n=new eQ(4,e),s.push({direction:t,fallingCoord:n})}for(const o of s)i=e.addPotentialDirectionPusher(t,o.fallingCoord,o.direction,i);return i}static addPotentialDirectionPusher(t,n,r,i){const s=e.getLineClosestPusher(t,n,r);if(s.isAbsent())return i;const o=s.get(),a=o.distance;return hw(e.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:a}),i}static getLineClosestPusher(t,n,r){hw(e.VERBOSE,{getDirectionClosestPusher:{state:t,fallingCoord:n,direction:r.toString()}});const i=r.getOpposite();let s=1,o=t.getPieceAt(n),a=n,c=gw.empty(),l=!1,u=!1,h=0;for(;a.isInRange(5,5)&&!1===l;){const e=t.getPieceAt(a);if(e.isEmptyOrMountain())e===k8.MOUNTAIN?(h+=.9,u=!0):s++;else{const t=e.getDirection();t===r?u&&(h-=1,h<=0&&(l=!0,a=a.getNext(r))):t===i?(h+=1,u||s++):u?(c=gw.of(a),o!==k8.EMPTY&&s++):s++}o=e,a=a.getPrevious(r)}if(!1===l&&c.isPresent())for(s++,h-=1;!1===a.equals(c.get());)a=a.getNext(r),s--;return a.isNotInRange(5,5)&&(h-=1,5===t.countPlayerPawn())||h>0?gw.empty():gw.of({distance:s,coord:a})}static getPushingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[];for(let s=0;s<5;s++)r.push(new I8(-1,s,gw.of(XJ.RIGHT),XJ.RIGHT)),i.push(k8.of(XJ.RIGHT,n)),r.push(new I8(5,s,gw.of(XJ.LEFT),XJ.LEFT)),i.push(k8.of(XJ.LEFT,n)),r.push(new I8(s,-1,gw.of(XJ.DOWN),XJ.DOWN)),i.push(k8.of(XJ.DOWN,n)),r.push(new I8(s,5,gw.of(XJ.UP),XJ.UP)),i.push(k8.of(XJ.UP,n));for(let s=0;s<r.length;s++)this.isLegalForwarding(r[s],e.gameState,i[s]).isSuccess()&&t.push(r[s]);return t}static getDerapingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer();let r,i,s;for(let o=1;o<=3;o++)r=new I8(-1,o,gw.of(XJ.RIGHT),XJ.UP),i=k8.of(XJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new I8(-1,o,gw.of(XJ.RIGHT),XJ.DOWN),i=k8.of(XJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new I8(5,o,gw.of(XJ.LEFT),XJ.UP),i=k8.of(XJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new I8(5,o,gw.of(XJ.LEFT),XJ.DOWN),i=k8.of(XJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));for(let o=1;o<=3;o++)r=new I8(o,-1,gw.of(XJ.DOWN),XJ.LEFT),i=k8.of(XJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new I8(o,-1,gw.of(XJ.DOWN),XJ.RIGHT),i=k8.of(XJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new I8(o,5,gw.of(XJ.UP),XJ.LEFT),i=k8.of(XJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new I8(o,5,gw.of(XJ.UP),XJ.RIGHT),i=k8.of(XJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));return t}static getCoordDirection(e,t,n){const r=new eQ(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}getGameStatus(t){const n=e.getMountainsRowsAndColumns(t.gameState),r=e.getWinner(t.gameState,t.move,n.nbMountain);return r.isPlayer()?PQ.getVictory(r):PQ.ONGOING}}return e.VERBOSE=!1,e})();class R8 extends uQ{getBoardValue(e){return new hQ(x8.getBoardValueInfo(e.move,e.gameState).boardValue)}getListMoves(e){let t=[];const n=e.gameState.getCurrentPlayer();let r;for(let i=0;i<5;i++)for(let s=0;s<5;s++)if(r=e.gameState.getPieceAtXY(s,i),r.belongTo(n)){const o=r.getDirection();for(const a of XJ.ORTHOGONALS){if(a!==o){const r=e.gameState.getCopiedBoard(),o=new I8(s,i,gw.empty(),a);r[i][s]=k8.of(a,n),t.push(o)}let c;c=new eQ(s+a.x,i+a.y).isInRange(5,5)?XJ.ORTHOGONALS:[a];for(const n of c){const o=new I8(s,i,gw.of(a),n);x8.isLegalForwarding(o,e.gameState,r).isSuccess()&&t.push(o)}}}return e.gameState.countPlayerPawn()<5&&(t=t.concat(x8.getPushingInsertions(e)),t=t.concat(x8.getDerapingInsertions(e))),hw(x8.VERBOSE,{getListMovesResult:t}),t}}const D8=k8.EMPTY,L8=k8.MOUNTAIN,F8=k8.WHITE_UP,B8=k8.WHITE_LEFT,U8=k8.WHITE_RIGHT,V8=k8.WHITE_DOWN,$8=k8.BLACK_UP,z8=k8.BLACK_LEFT,H8=k8.BLACK_RIGHT,G8=k8.BLACK_DOWN;class q8{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`The goal at Siam is to be the first to push a mountain out of the board.
        The initial board contains three mountains, and no pieces are initially on the board.
        During its turn, a player can do one of the following three actions:
        <ol>
            <li>Put a new piece on the board.</li>
            <li>Change the orientation of one of its piece, and optionally move it.</li>
            <li>Take one of its pieces out of the board.</li>
        </ol>`,A8.getInitialState()),AQ.anyMove($localize`Inserting a piece`,$localize`Each player has 5 pieces in total.
        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:
        <ol>
            <li>Click on one of the big arrows alongside the board.</li>
            <li>Click on one of the small arrows that appeared on the landing square of your piece.
                This is the direction in which your piece will be oriented.</li>
        </ol><br/>
        Insert a piece on the board.`,A8.getInitialState(),new I8(2,-1,gw.of(XJ.DOWN),XJ.DOWN),$localize`Congratulations!`),AQ.fromMove($localize`Moving a piece`,$localize`We will distinguish here "moving" and "pushing".
        A move is made from a piece's square to an empty neighboring square, horizontally or vertically.
        During that move, you can also move the piece out of the board.
        To move a piece:
        <ol>
            <li>Click on it.</li>
            <li>Click on one of the 4 arrows to pick the direction in which it will move.
                You can also click on the middle dot to change the piece's orientation without moving it.</li>
            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>
        </ol><br/>
        Try to move the piece that is on the board one square upwards and to orient it downwards.`,new A8([[D8,D8,D8,D8,D8],[D8,D8,D8,D8,D8],[D8,L8,L8,L8,D8],[D8,D8,D8,D8,D8],[D8,D8,F8,D8,D8]],0),[new I8(2,4,gw.of(XJ.UP),XJ.DOWN)],$localize`Congratulations, you made a side-slip!`,$localize`Failed!`),AQ.fromMove($localize`Moving a piece out of the board`,$localize`To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>
        Get that piece out of the board!`,new A8([[D8,D8,D8,D8,D8],[D8,D8,D8,D8,D8],[D8,L8,L8,L8,D8],[D8,D8,D8,D8,D8],[D8,D8,F8,D8,D8]],0),[new I8(2,4,gw.of(XJ.DOWN),XJ.DOWN)],$localize`Congratulations, even if in this context it was not a useful move.`,$localize`Failed, the piece is still on the board.`),AQ.fromMove($localize`Pushing`,$localize`When the landing square of your move is occupied, we use the term "push".
        In order to push, multiple conditions must hold:
        <ol>
            <li>Your piece must already be oriented in the direction of the push.</li>
            <li>The number of the pieces (opponent's or not) that are facing yours (called the resistants)
                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>
            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>
        </ol>
        Your piece on the top right cannot push because there is one mountain too much.
        Your piece on the bottom right can push.<br/><br/>
        Do it.`,new A8([[U8,L8,L8,z8,B8],[D8,D8,D8,D8,D8],[D8,D8,D8,L8,D8],[D8,D8,D8,D8,D8],[D8,D8,H8,z8,B8]],0),[new I8(4,4,gw.of(XJ.LEFT),XJ.LEFT)],$localize`Congratulations!`,$localize`Failed!`),AQ.fromMove($localize`Victory`,$localize`The game ends when a mountain is pushed out of the board.
        If you pushed it and nobody is in front of you, you're the winner.
        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.
        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>
        You have two ways of ending the game here: you can either win, or lose. Choose correctly!`,new A8([[D8,D8,D8,D8,D8],[D8,D8,D8,D8,D8],[L8,$8,B8,D8,V8],[D8,D8,D8,D8,G8],[D8,D8,D8,D8,L8]],0),[new I8(2,2,gw.of(XJ.LEFT),XJ.LEFT)],$localize`Congratulations, you won!`,$localize`Failed, you lost.`)]}}function W8(e,t){if(1&e){const e=ma();Cn(),ha(0,"use",7),_a("click",function(){const t=Gt(e).$implicit;return wa(3).insertAt(t.x,t.y)}),da()}if(2&e){const e=t.$implicit,n=wa(3);Oa("id","insertAt_",e.x,"_",e.y,""),na("transform",n.getInsertionArrowTransform(e.x+1,e.y+1,e.dir))}}const j8=function(e,t){return{dir:"DOWN",x:e,y:t}},Z8=function(e){return{dir:"UP",x:e,y:5}},Y8=function(e,t){return{dir:"RIGHT",x:e,y:t}},K8=function(e){return{dir:"LEFT",x:5,y:e}},J8=function(e,t,n,r){return[e,t,n,r]};function Q8(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,W8,1,3,"use",6),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",lu(11,J8,cu(1,j8,e,-1),au(4,Z8,e),cu(6,Y8,-1,e),au(9,K8,e)))}}const X8=function(){return[0,1,2,3,4]};function e7(e,t){1&e&&(Cn(),pa(0),oa(1,Q8,2,16,"g",5),ga()),2&e&&(Ts(1),la("ngForOf",ou(1,X8)))}function t7(e,t){if(1&e){const e=ma();Cn(),ha(0,"use",13),_a("click",function(){const t=Gt(e).$implicit;return wa(5).chooseDirection(t)}),da()}if(2&e){const e=t.$implicit,n=wa(3).index,r=wa().index,i=wa();Pa("id","chooseDirection_",e,""),na("transform",i.getArrowTransform(n+1,r+1,e))}}const n7=function(){return["RIGHT","DOWN","LEFT","UP"]};function r7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",11),_a("click",function(){return Gt(e),wa(4).chooseDirection("")}),da(),oa(2,t7,1,2,"use",12),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();Ts(1),na("cx",(e+1)*n.SPACE_SIZE+n.SPACE_SIZE/2)("cy",(t+1)*n.SPACE_SIZE+n.SPACE_SIZE/2),Ts(1),la("ngForOf",ou(3,n7))}}function i7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"use",10),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().clickPiece(t,n)}),da(),oa(2,r7,3,4,"g",4),da()}if(2&e){const e=wa(),t=e.index,n=e.$implicit,r=wa().index,i=wa();Ts(1),Oa("id","clickPiece_",t,"_",r,""),la("ngClass",i.getPieceClasses(n)),na("transform",i.getPieceTransform(t,r)),Ts(1),la("ngIf",i.choosingDirection(t,r))}}function s7(e,t){if(1&e&&(Cn(),fa(0,"use",14)),2&e){const e=wa().index,t=wa().index,n=wa();na("transform","translate("+(e+1)*n.SPACE_SIZE+" "+(t+1)*n.SPACE_SIZE+")")}}function o7(e,t){if(1&e){const e=ma();Cn(),ha(0,"use",13),_a("click",function(){const t=Gt(e).$implicit;return wa(4).chooseOrientation(t)}),da()}if(2&e){const e=t.$implicit,n=wa(2).index,r=wa().index,i=wa();Pa("id","chooseOrientation_",e,""),na("transform",i.getArrowTransform(n+1,r+1,e))}}function a7(e,t){1&e&&(Cn(),ha(0,"g"),oa(1,o7,1,2,"use",12),da()),2&e&&(Ts(1),la("ngForOf",ou(1,n7)))}function c7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",8),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().insertAt(t,n)}),da(),oa(2,i7,3,5,"g",4),oa(3,s7,1,1,"use",9),oa(4,a7,2,2,"g",4),da()}if(2&e){const e=t.$implicit,n=t.index,r=wa().index,i=wa();Ts(1),Oa("id","insertAt_",n,"_",r,""),la("ngClass",i.getSquareClasses(n,r)),na("x",i.SPACE_SIZE*(n+1))("y",i.SPACE_SIZE*(r+1))("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),la("ngIf",e.isPiece()),Ts(1),la("ngIf",i.isMountain(e)),Ts(1),la("ngIf",i.choosingOrientation(n,r))}}function l7(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,c7,5,10,"g",5),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let u7=(()=>{class e extends hX{constructor(e){super(e),this.lastMove=gw.empty(),this.chosenCoord=gw.empty(),this.landingCoord=gw.empty(),this.chosenDirection=gw.empty(),this.chosenOrientation=gw.empty(),this.movedPieces=[],this.rules=new x8(A8),this.availableMinimaxes=[new R8(this.rules,"SiamMinimax")],this.encoder=I8.encoder,this.tutorial=(new q8).tutorial,this.updateBoard()}updateBoard(){if(hw(e.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}cancelMoveAttempt(){this.chosenCoord=gw.empty(),this.chosenDirection=gw.empty(),this.landingCoord=gw.empty(),this.chosenOrientation=gw.empty()}clickPiece(e,t){const n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(lQ.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=gw.of(new eQ(e,t)),DG.SUCCESS)}chooseDirection(t){var n=this;return lw(function*(){hw(e.VERBOSE,"SiamComponent.chooseDirection("+t+")");const r=n.canUserPlay("#chooseDirection_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(""===t)n.chosenDirection=gw.empty(),n.landingCoord=n.chosenCoord;else{const r=XJ.factory.fromString(t).get();if(n.chosenDirection=gw.of(r),n.landingCoord=gw.of(n.chosenCoord.get().getNext(r)),n.landingCoord.get().isNotInRange(5,5))return hw(e.VERBOSE,"orientation and direction should be the same: "+r),n.chosenOrientation=gw.of(r),yield n.tryMove()}return DG.SUCCESS})()}chooseOrientation(t){var n=this;return lw(function*(){hw(e.VERBOSE,"SiamComponent.chooseOrientation("+t+")");const r=n.canUserPlay("#chooseOrientation_"+t);return r.isFailure()?n.cancelMove(r.getReason()):(n.chosenOrientation=gw.of(XJ.factory.fromString(t).get()),yield n.tryMove())})()}insertAt(t,n){var r=this;return lw(function*(){hw(e.VERBOSE,"SiamComponent.insertAt("+t+", "+n+")");const i=r.canUserPlay("#insertAt_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());if(r.chosenCoord.isPresent())return r.cancelMove(N8.CANNOT_INSERT_WHEN_SELECTED());{r.chosenCoord=gw.of(new eQ(t,n));const e=x8.getCoordDirection(t,n,r.rules.node.gameState);return r.chosenDirection=gw.of(e),r.landingCoord=gw.of(r.chosenCoord.get().getNext(e)),DG.SUCCESS}})()}tryMove(){var e=this;return lw(function*(){const t=e.chosenCoord.get(),n=new I8(t.x,t.y,e.chosenDirection,e.chosenOrientation.get());return e.cancelMove(),yield e.chooseMove(n,e.rules.node.gameState)})()}isMountain(e){return e===k8.MOUNTAIN}choosingOrientation(t,n){const r=new eQ(t,n);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(hw(e.VERBOSE,"choosing orientation now"),!0)}choosingDirection(t,n){const r=new eQ(t,n);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(hw(e.VERBOSE,"choosing direction now"),!0)}getInsertionArrowTransform(e,t,n){const r=`rotate(${90*(XJ.factory.fromString(n).get().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}getPieceTransform(e,t){const n=`rotate(${90*(this.board[t][e].getDirection().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}getArrowTransform(e,t,n){return U6.getArrowTransform(this.SPACE_SIZE,new eQ(e,t),XJ.factory.fromString(n).get())}getPieceClasses(e){return[this.getPlayerClass(e.getOwner())]}getSquareClasses(e,t){const n=new eQ(e,t);return this.movedPieces.some(e=>e.equals(n))?["moved"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-siam"]],features:[Ho],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],[0,"xlink","href","#triangle","class","arrow selected-fill no-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),ha(1,"defs"),fa(2,"polygon",1),fa(3,"polygon",2),fa(4,"polygon",3),da(),oa(5,e7,2,2,"ng-container",4),oa(6,l7,2,1,"g",5),da()),2&e&&(Ts(5),la("ngIf",t.isPlayerTurn()),Ts(1),la("ngForOf",t.board))},directives:[$d,Ud,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),h7=(()=>{class e{}return e.NO_MOVEMENT_BEFORE_TURN_40=()=>$localize`You cannot move yet. Pick a space where you will put a new piece.`,e.MUST_CUT=()=>$localize`Several groups are of the same size, you must pick the one to keep.`,e.CANNOT_CHOOSE_TO_KEEP=()=>$localize`You cannot choose which part to keep when one is smaller than the other.`,e.CAN_NO_LONGER_DROP=()=>$localize`You cannot put new pieces anymore. Pick a piece to move.`,e.MUST_CAPTURE_BIGGEST_GROUPS=()=>$localize`You must choose one of the biggest groups to keep it.`,e.CANNOT_KEEP_EMPTY_COORD=()=>$localize`You cannot pick an empty space. Pick one of the biggest groups.`,e.MUST_DROP_NEXT_TO_OTHER_PIECE=()=>$localize`You must put this piece next to another piece.`,e})();class d7 extends pQ{constructor(e,t,n){super(t),this.pieces=e;const r=this.getCalculatedScale();this.pieces=r.pieces,this.width=r.width,this.height=r.height,this.offset=n??r.offset,this.pieces.makeImmutable()}static getInitialState(){return d7.fromRepresentation([[jY.ZERO.value],[jY.ONE.value]],0)}static fromRepresentation(e,t,n){const r=new wQ;for(let i=0;i<e.length;i++)for(let t=0;t<e[0].length;t++)e[i][t]!==ZY.NONE.value&&r.set(new eQ(t,i),jY.of(e[i][t]));return new d7(r,t,n)}static deplacePiece(e,t){const n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}static getGroups(e,t){let n=new wQ,r=0;for(const o of iQ.factory.all){const i=t.getNext(o,1);n=d7.putCoordInGroup(e,i,n,""+r),r++}const i=n.reverse(),s=new fQ;for(let o=0;o<i.size();o++)s.add(i.getByIndex(o).value);return s}static putCoordInGroup(e,t,n,r){if(e.get(t).isPresent()&&n.get(t).isAbsent()){n.set(t,r);for(const i of iQ.factory.all){const s=t.getNext(i,1);n=d7.putCoordInGroup(e,s,n,r)}}return n}getCalculatedScale(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const o of this.pieces.listKeys())e=Math.min(o.x,e),t=Math.max(o.x,t),n=Math.min(o.y,n),r=Math.max(o.y,r);let i=new wQ;const s=new YJ(-e,-n);if(0!==e||0!==n)for(const o of this.pieces.listKeys()){const e=this.pieces.delete(o),t=o.getNext(s);i.set(t,e)}else i=this.pieces;return{width:t+1-e,height:r+1-n,pieces:i,offset:s}}toRepresentation(){const e=QY.createTable(this.width,this.height,ZY.NONE.value);for(const t of this.pieces.listKeys()){const n=this.getPieceAt(t).value;e[t.y][t.x]=n}return e}isIllegalLandingZone(e,t){return this.pieces.containsKey(e)?DG.failure(lQ.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?DG.SUCCESS:DG.failure(h7.MUST_DROP_NEXT_TO_OTHER_PIECE())}isCoordConnected(e,t){for(const n of iQ.factory.all){const r=e.getNext(n,1);if(this.pieces.containsKey(r)&&!1===t.equalsValue(r))return!0}return!1}isOnBoard(e){return this.pieces.containsKey(e)}getPieceAt(e){return this.isOnBoard(e)?this.pieces.get(e).get():ZY.NONE}applyLegalDrop(e){const t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new d7(t,this.turn+1)}applyLegalDeplacement(e,t){const n=d7.deplacePiece(this,e);let r=new wQ;if(t.size()>0){r=new wQ;for(const e of t)r.set(e,n.get(e).get())}else r=n.getCopy();return new d7(r,this.turn+1)}countPieces(){const e=this.pieces.reverse(),t=e.get(jY.ZERO).getOrElse(new FX),n=e.get(jY.ONE).getOrElse(new FX);return[t.size(),n.size()]}switchPiece(e){const t=this.pieces.getCopy(),n=this.getPieceAt(e);if(n.isPlayer())return t.replace(e,n.getOpponent()),new d7(t,this.turn,this.offset);UG.logErrorAndFail("SixState","Cannot switch piece if there is no piece!",{coord:e.toString()})}equals(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}class f7 extends yQ{constructor(e,t,n){if(super(),this.start=e,this.landing=t,this.keep=n,e.equalsValue(t))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(n))throw new Error("Cannot keep starting coord, since it will always be empty after move!")}static fromDrop(e){return new f7(gw.empty(),e,gw.empty())}static fromMovement(e,t){return new f7(gw.of(e),t,gw.empty())}static fromCut(e,t,n){return new f7(gw.of(e),t,gw.of(n))}isDrop(){return this.start.isAbsent()}isCut(){return this.keep.isPresent()}toString(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}equals(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}f7.encoder=new class extends GY{encodeMove(e){return{start:e.start.isPresent()?eQ.encoder.encode(e.start.get()):null,landing:eQ.encoder.encode(e.landing),keep:e.keep.isPresent()?eQ.encoder.encode(e.keep.get()):null}}decodeMove(e){const t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");const n=eQ.encoder.decode(t.landing);if(null==t.start)return f7.fromDrop(n);const r=eQ.encoder.decode(t.start);if(null==t.keep)return f7.fromMovement(r,n);{const e=eQ.encoder.decode(t.keep);return f7.fromCut(r,n,e)}}};class p7 extends OQ{constructor(){super(...arguments),this.VERBOSE=!1}applyLegalMove(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}isLegal(e,t){hw(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});const n=t.isIllegalLandingZone(e.landing,e.start);return n.isFailure()?n.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):p7.isLegalPhaseTwoMove(e,t)}static getLegalLandings(e){const t=new FX;for(const n of e.pieces.listKeys())for(const r of iQ.factory.all){const i=n.getNext(r,1);e.getPieceAt(i)===ZY.NONE&&t.add(i)}return t.toList()}isLegalDrop(e,t){return!1===e.isDrop()?MG.failure(h7.NO_MOVEMENT_BEFORE_TURN_40()):MG.success(t.pieces.getKeySet())}static isLegalPhaseTwoMove(e,t){if(e.isDrop())return MG.failure(h7.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case ZY.NONE:return MG.failure(lQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return MG.failure(lQ.CANNOT_CHOOSE_OPPONENT_PIECE())}const n=d7.deplacePiece(t,e),r=d7.getGroups(n,e.start.get());if(p7.isSplit(r)){const t=this.getBiggerGroups(r);return 1===t.size()?e.keep.isPresent()?MG.failure(h7.CANNOT_CHOOSE_TO_KEEP()):MG.success(t.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,t,n)}return MG.success(new FX)}static isSplit(e){return e.size()>1}static getBiggerGroups(e){let t=0,n=new fQ;for(const r of e){const e=r.size();e>t?(t=e,n=new fQ([r])):e===t&&n.add(r)}return n}static moveKeepBiggerGroup(e,t,n){if(e.isAbsent())return MG.failure(h7.MUST_CUT());if(n.get(e.get()).isAbsent())return MG.failure(h7.CANNOT_KEEP_EMPTY_COORD());const r=e.get();for(const i of t)if(i.contains(r))return MG.success(i);return MG.failure(h7.MUST_CAPTURE_BIGGEST_GROUPS())}getGameStatus(e){const t=e.gameState,n=t.getCurrentOpponent();let r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return PQ.getVictory(n);if(t.turn>39){const e=t.countPieces(),n=e[0],r=e[1];return n<6&&r<6?n<r?PQ.ONE_WON:r<n?PQ.ZERO_WON:PQ.DRAW:n<6?PQ.getDefeat(jY.ZERO):r<6?PQ.getDefeat(jY.ONE):PQ.ONGOING}return PQ.ONGOING}startSearchingVictorySources(){hw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}getShapeVictory(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();const n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(hw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(iQ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return[];const t=(e+i.length)%6;i.push(s),s=s.getNext(iQ.factory.all[t],1)}return i}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=iQ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return[];a=!0,i=i.getOpposite(),s=s.getNext(i,o.length)}s=s.getNext(i,1)}return o}searchVictoryOnlyForTriangleCorner(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=iQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.length%2==0&&(i=iQ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return s}searchVictoryOnlyForTriangleEdge(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=iQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.push(o),s.length%2==0&&(i=iQ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return s}}class g7 extends uQ{calculateBoardValue(e,t){this.startSearchingVictorySources();let n={status:CQ.DEFAULT,victory:gw.empty(),preVictory:gw.empty(),sum:0};for(;this.hasNextVictorySource();){const r=this.getNextVictorySource();let i;if(i=n.status===CQ.PRE_VICTORY?this.searchVictoryOnly(r,e,t):this.getBoardInfo(r,e,t,n),i.status===CQ.VICTORY)return i;n={status:i.status,victory:gw.empty(),preVictory:i.preVictory,sum:n.sum+i.sum}}return n}}class m7 extends hQ{constructor(e,t){super(e),this.value=e,this.preVictory=t}}class y7 extends g7{constructor(){super(...arguments),this.VERBOSE=!1}static get(){if(null==y7.INSTANCE){const e=new p7(d7);y7.INSTANCE=new y7(e,"SixMinimax")}return y7.INSTANCE}getListMoves(e){const t=y7.get(),n=e.getOwnValue(t);if(n.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(n):this.createForcedDeplacement(e,n);const r=p7.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(r):this.getListDeplacement(e.gameState,r)}createForcedDrop(e){hw(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});const t=[],n=f7.fromDrop(e.preVictory.get());return t.push(n),t}createForcedDeplacement(e,t){hw(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});const n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}getDeplacementFrom(e,t,n){const r=[];for(const i of t)for(const t of n){const n=f7.fromMovement(i,t);if(e.isCoordConnected(t,gw.of(i))){const s=d7.deplacePiece(e,n),o=d7.getGroups(s,n.start.get());if(p7.isSplit(o))for(const e of o){const n=e.getAnyElement().get(),s=f7.fromCut(i,t,n);r.push(s)}else r.push(n)}}return r}getSafelyMovablePieceOrFirstOne(e){const t=e.gameState,n=t.pieces.reverse(),r=t.getCurrentPlayer(),i=n.get(r).get(),s=i.getAnyElement().get(),o=[];for(const a of i)!1===this.isPieceBlockingAVictory(t,a)&&o.push(a);return new FX(0===o.length?[s]:o)}isPieceBlockingAVictory(e,t){const n=e.switchPiece(t),r=f7.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===CQ.VICTORY)return!0;return!1}getListDrop(e){const t=[];for(const n of e){const e=f7.fromDrop(n);t.push(e)}return t}getListDeplacement(e,t){const n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}getBoardValue(e){const t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue();let s={status:CQ.DEFAULT,victory:gw.empty(),preVictory:gw.empty(),sum:0};t.isPresent()&&(s=this.calculateBoardValue(t.get(),n));let o=gw.empty();if(s.status===CQ.DEFAULT&&s.preVictory.isPresent()&&(o=gw.of(s.preVictory.get())),s.status===CQ.VICTORY)return new m7(i,gw.empty());if(n.turn>39){const e=n.countPieces(),t=e[0],r=e[1];return t<6&&r<6?new m7(t<r?jY.ONE.getVictoryValue():r<t?jY.ZERO.getVictoryValue():0,gw.empty()):t<6?new m7(jY.ZERO.getDefeatValue(),gw.empty()):r<6?new m7(jY.ONE.getDefeatValue(),gw.empty()):new m7(t-r,o)}return new m7(s.status===CQ.PRE_VICTORY?r.getPreVictory():s.sum*r.getScoreModifier(),o)}startSearchingVictorySources(){hw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(hw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(iQ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return{status:CQ.PRE_VICTORY,victory:gw.empty(),preVictory:gw.empty(),sum:0};const t=(e+i.length)%6;i.push(s),s=s.getNext(iQ.factory.all[t],1)}return{status:CQ.VICTORY,victory:gw.of(i),preVictory:gw.empty(),sum:0}}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=iQ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return{status:CQ.PRE_VICTORY,victory:gw.empty(),preVictory:gw.empty(),sum:0};a=!0,i=i.getOpposite(),s=s.getNext(i,o.length-1)}s=s.getNext(i,1)}return{status:CQ.VICTORY,victory:gw.of(o),preVictory:gw.empty(),sum:0}}searchVictoryOnlyForTriangleCorner(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=iQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:CQ.PRE_VICTORY,victory:gw.empty(),preVictory:gw.empty(),sum:0};s.length%2==0&&(i=iQ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return{status:CQ.VICTORY,victory:gw.of(s),preVictory:gw.empty(),sum:0}}searchVictoryOnlyForTriangleEdge(e,t,n){hw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=iQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:CQ.PRE_VICTORY,victory:gw.empty(),preVictory:gw.empty(),sum:0};s.push(o),s.length%2==0&&(i=iQ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return{status:CQ.VICTORY,victory:gw.of(s),preVictory:gw.empty(),sum:0}}getBoardInfo(e,t,n,r){hw(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});const i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}getBoardInfoForCircle(e,t,n,r){hw(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer(),s=[t];let o=t.getNext(iQ.factory.all[e],1),a=0,c=gw.empty();for(;s.length<6;){const t=n.getPieceAt(o);if(t===i)return r;const l=(e+s.length)%6;s.push(o);const u=iQ.factory.all[l];t===ZY.NONE?(a+=.16,c=gw.of(o)):a++,o=o.getNext(u,1)}return this.getBoardInfoResult(a,c,s,r)}getBoardInfoResult(e,t,n,r){let i=r.preVictory;if(4.16===e){if(hw(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:CQ.PRE_VICTORY,victory:gw.empty(),preVictory:gw.empty(),sum:0};i=t}else if(5===e)return{status:CQ.VICTORY,victory:gw.of(n),preVictory:gw.empty(),sum:0};return{status:r.status,victory:gw.empty(),preVictory:i,sum:r.sum+e}}getBoardInfoForLine(e,t,n,r){hw(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});const i=iQ.factory.all[e];let s=t.getPrevious(i,5),o=[],a=[],c=gw.empty();for(let p=0;p<6;p++){const e=this.updateEncounterAndReturnLastEmpty(n,s,a);e.isPresent()&&(c=e),o.push(s),s=s.getNext(i,1)}let l=r.status,u=r.preVictory,h=0,d=0;for(;h<6;){const e=a.reduce((e,t)=>e+t);if(6===e)return{status:CQ.VICTORY,victory:gw.of(o),preVictory:gw.empty(),sum:0};5.16===e&&l===CQ.DEFAULT&&(u.isPresent()?(VG(!1===u.equals(c),"Impossible to have point aligned with differents line to a same point"),l=CQ.PRE_VICTORY):u=c),d=Math.max(d,e),o=o.slice(1,6),o.push(s),a=a.slice(1,6);const t=this.updateEncounterAndReturnLastEmpty(n,s,a);t.isPresent()&&(c=t),h++,s=s.getNext(i,1)}const f={status:l,victory:gw.of(o),preVictory:u,sum:d};return this.getBoardInfoResult(d,c,o,f)}updateEncounterAndReturnLastEmpty(e,t,n){const r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),gw.empty();case ZY.NONE:return n.push(.16),gw.of(t);default:return n.push(1),gw.empty()}}getBoardInfoForTriangleCorner(e,t,n,r){hw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=iQ.factory.all[e];const o=[t];let a=t.getNext(s,1),c=0,l=gw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===ZY.NONE?(c+=.16,l=gw.of(a)):c++,o.length%2==0&&(s=iQ.factory.all[(e+o.length)%6]),o.push(a),a=a.getNext(s,1)}return this.getBoardInfoResult(c,l,o,r)}getBoardInfoForTriangleEdge(e,t,n,r){hw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=iQ.factory.all[e];const o=[t];let a=t.getNext(s,1),c=0,l=gw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===ZY.NONE?(c+=.16,l=gw.of(a)):c++,o.push(a),o.length%2==0&&(s=iQ.factory.all[(e+o.length)%6]),a=a.getNext(s,1)}return this.getBoardInfoResult(c,l,o,r)}}const v7=ZY.NONE.value,_7=jY.ZERO.value,C7=jY.ONE.value;let E7=(()=>{class e{}return e.MOVEMENT_NOT_DISCONNECTING=()=>$localize`This move does not disconnect your opponent's pieces. Try again with another piece.`,e.MOVEMENT_SELF_DISCONNECTING=()=>$localize`You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!`,e})();class w7{constructor(){this.tutorial=[AQ.informational($localize`Six`,$localize`Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.
        Each player has 21 pieces, with one for each player already on the board.
        The goal of the game is to form one of the three winning shapes with your pieces.`,d7.getInitialState()),AQ.fromMove($localize`Victory (line)`,$localize`On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>
        Find the victory. You're playing Dark.`,d7.fromRepresentation([[_7,C7,C7,C7,C7,_7],[v7,_7,C7,v7,_7,v7],[C7,C7,_7,v7,v7,v7],[v7,v7,_7,v7,v7,v7],[v7,_7,v7,v7,v7,v7],[_7,v7,v7,v7,v7,v7]],0),[f7.fromDrop(new eQ(3,2))],$localize`Congratulations!`,$localize`Failed!`),AQ.fromMove($localize`Victory (circle)`,$localize`On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,d7.fromRepresentation([[v7,v7,v7,C7,v7,v7],[v7,v7,C7,C7,_7,_7],[v7,C7,v7,_7,C7,v7],[C7,_7,_7,_7,_7,C7]],0),[f7.fromDrop(new eQ(5,2))],$localize`Congratulations! Note that if a piece is inside the circle, it does not change anything.`,$localize`Failed!`),AQ.fromMove($localize`Victory (triangle)`,$localize`On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,d7.fromRepresentation([[v7,v7,v7,C7,v7,v7],[v7,_7,C7,_7,_7,_7],[v7,_7,v7,_7,_7,v7],[C7,C7,C7,v7,C7,v7]],0),[f7.fromDrop(new eQ(3,3))],$localize`Congratulations!`,$localize`Failed!`),AQ.fromPredicate($localize`Second phase`,$localize`After 40 turns, your pieces have all been placed and we move on to the second phase of the game.
        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.
        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>
        You're playing Dark. Make a move that disconnects one of your opponent's pieces.`,d7.fromRepresentation([[v7,v7,v7,v7,v7,v7,v7,C7,v7],[v7,v7,v7,v7,v7,v7,_7,v7,v7],[v7,v7,v7,v7,_7,_7,_7,v7,v7],[v7,v7,v7,v7,C7,C7,v7,C7,_7],[v7,_7,C7,C7,_7,_7,C7,v7,v7],[_7,_7,_7,_7,C7,C7,C7,_7,v7],[C7,C7,_7,v7,C7,C7,_7,v7,v7],[v7,_7,v7,_7,_7,v7,v7,v7,v7],[C7,C7,C7,C7,v7,v7,v7,v7,v7],[v7,_7,v7,C7,v7,v7,v7,v7,v7]],40),f7.fromMovement(new eQ(6,1),new eQ(5,1)),(e,t)=>{const n=t.countPieces();return 19===n[0]?18===n[1]?DG.SUCCESS:DG.failure(E7.MOVEMENT_NOT_DISCONNECTING()):DG.failure(E7.MOVEMENT_SELF_DISCONNECTING())},$localize`Congratulations, your opponent now has one piece less and you're closer to victory!`),AQ.fromPredicate($localize`Victory by disconnection`,$localize`During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.
        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.
        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>
        Here, you're playing Dark and you can win. Do it!`,d7.fromRepresentation([[v7,v7,v7,v7,v7,C7],[v7,v7,v7,v7,_7,C7],[v7,v7,v7,C7,_7,_7],[v7,v7,_7,v7,C7,_7],[C7,C7,v7,v7,v7,_7],[_7,C7,v7,v7,v7,v7],[_7,v7,v7,v7,v7,v7]],40),f7.fromMovement(new eQ(2,3),new eQ(3,3)),(e,t)=>e.start.equalsValue(new eQ(2,3))?DG.SUCCESS:DG.failure(E7.MOVEMENT_NOT_DISCONNECTING()),$localize`Congratulations, you won!`),AQ.fromPredicate($localize`Special disconnection`,$localize`During a disconnection, two or more groups could have the same size,
        in which case you will have to click on the group you wish to keep.<br/><br/>
        You're playing Dark, play such a move!`,d7.fromRepresentation([[v7,v7,v7,v7,v7,C7],[v7,v7,v7,v7,_7,C7],[v7,v7,v7,C7,_7,_7],[_7,v7,_7,v7,v7,C7],[C7,C7,v7,v7,v7,v7],[_7,_7,v7,v7,v7,v7],[_7,v7,v7,v7,v7,v7]],40),f7.fromCut(new eQ(2,3),new eQ(2,5),new eQ(2,5)),(e,t)=>e.keep.isAbsent()?DG.failure($localize`This move has not cut the board in two equal halves.`):t.getPieceAt(e.landing.getNext(t.offset))===ZY.NONE?DG.failure($localize`Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again.`):DG.SUCCESS,$localize`Congratulations, you won!`)]}}function b7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",10),_a("click",function(){const t=Gt(e).$implicit;return wa().onPieceClick(t)}),da()}if(2&e){const e=t.$implicit,n=wa();Oa("id","piece_",e.x,"_",e.y,""),la("ngClass",n.getPieceClass(e)),na("points",n.getHexaCoordsAt(e))}}function S7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",11),_a("click",function(){const t=Gt(e).$implicit;return wa().onNeighborClick(t)}),da()}if(2&e){const e=t.$implicit,n=wa();Oa("id","neighbor_",e.x,"_",e.y,""),na("points",n.getHexaCoordsAt(e))}}function P7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",10),_a("click",function(){Gt(e);const t=wa();return t.onPieceClick(t.chosenLanding.get())}),da()}if(2&e){const e=wa();Oa("id","chosenLanding_",e.chosenLanding.get().x,"_",e.chosenLanding.get().y,""),la("ngClass",e.getPlayerClass(e.state.getCurrentPlayer())),na("points",e.getHexaCoordsAt(e.chosenLanding.get()))}}function O7(e,t){if(1&e&&(Cn(),fa(0,"polyline",12)),2&e){const e=t.$implicit,n=wa();Oa("id","disconnected_",e.x,"_",e.y,""),na("points",n.getHexaCoordsAt(e))}}function T7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",13),_a("click",function(){Gt(e);const t=wa();return t.onNeighborClick(t.leftCoord.get())}),da()}if(2&e){const e=wa();Oa("id","leftCoord_",e.leftCoord.get().x,"_",e.leftCoord.get().y,""),na("points",e.getHexaCoordsAt(e.leftCoord.get()))}}function I7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",14),_a("click",function(){Gt(e);const t=wa();return t.onPieceClick(t.lastDrop.get())}),da()}if(2&e){const e=wa();Oa("id","lastDrop_",e.lastDrop.get().x,"_",e.lastDrop.get().y,""),na("points",e.getHexaCoordsAt(e.lastDrop.get()))}}function k7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",15),_a("click",function(){Gt(e);const t=wa();return t.onPieceClick(t.selectedPiece.get())}),da()}if(2&e){const e=wa();Oa("id","selectedPiece_",e.selectedPiece.get().x,"_",e.selectedPiece.get().y,""),la("ngClass",e.getSelectedPieceClass()),na("points",e.getHexaCoordsAt(e.selectedPiece.get()))}}function A7(e,t){if(1&e&&(Cn(),fa(0,"polyline",16)),2&e){const e=t.$implicit,n=wa();Oa("id","victoryCoord_",e.x,"_",e.y,""),na("points",n.getHexaCoordsAt(e))}}function N7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",19),_a("click",function(){const t=Gt(e).$implicit;return wa(2).onPieceClick(t)}),fa(1,"polyline",20),da()}if(2&e){const e=t.$implicit,n=wa(2);Ts(1),Oa("id","cuttable_",e.x,"_",e.y,""),na("points",n.getHexaCoordsAt(e))}}function M7(e,t){if(1&e&&(Cn(),ha(0,"g",17),oa(1,N7,2,3,"g",18),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let x7=(()=>{class e extends nQ{constructor(e){super(e),this.disconnecteds=[],this.cuttableGroups=[],this.leftCoord=gw.empty(),this.lastDrop=gw.empty(),this.selectedPiece=gw.empty(),this.chosenLanding=gw.empty(),this.nextClickShouldSelectGroup=!1,this.rules=new p7(d7),this.availableMinimaxes=[new y7(this.rules,"SixMinimax")],this.encoder=f7.encoder,this.tutorial=(new w7).tutorial,this.SPACE_SIZE=30,this.hexaLayout=new sQ(1.5*this.SPACE_SIZE,new eQ(2*this.SPACE_SIZE,0),cQ.INSTANCE),this.updateBoard()}cancelMoveAttempt(){this.selectedPiece=gw.empty(),this.chosenLanding=gw.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=gw.empty(),this.lastDrop=gw.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}getViewBox(){const e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}mapAbstractCoordToCornerCoords(){const e=this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(e=>this.hexaLayout.getHexaCoordsAt(e));let t=[];for(const n of e)t=t.concat(n);return t}getLimits(e){let t=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;for(const s of e)s.x<r&&(r=s.x),s.y<i&&(i=s.y),t=Math.max(t,s.x),n=Math.max(n,s.y);return{minX:r,minY:i,maxX:t,maxY:n}}showLastMove(){const e=this.rules.node.move.get();this.lastDrop=gw.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?gw.of(e.start.get().getNext(this.state.offset,1)):gw.empty();const t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}getDisconnected(){const e=this.rules.node.mother.get().gameState.pieces.listKeys(),t=this.rules.node.gameState.pieces.listKeys(),n=[];for(const i of e)!1===this.rules.node.move.get().start.equalsValue(i)&&!1===t.some(e=>e.equals(i.getNext(this.state.offset,1)))&&n.push(i.getNext(this.state.offset,1));const r=this.lastDrop.get();return!1===this.pieces.some(e=>e.equals(r))&&!1===t.some(e=>e.equals(r))&&n.push(r),n}getEmptyNeighbors(){let e=p7.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){const t=this.chosenLanding.get();e=e.filter(e=>!1===e.equals(t))}return e}getPieceClass(e){const t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}onPieceClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#piece_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.state.turn<40)return t.cancelMove(h7.NO_MOVEMENT_BEFORE_TURN_40());if(t.chosenLanding.isAbsent())return t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(lQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=gw.of(e),DG.SUCCESS);{const n=f7.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e);return t.chooseMove(n,t.state)}})()}onNeighborClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#neighbor_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.nextClickShouldSelectGroup)return t.cancelMove(h7.MUST_CUT());if(t.state.turn<40)return t.chooseMove(f7.fromDrop(e),t.state);if(t.selectedPiece.isAbsent())return t.cancelMove(h7.CAN_NO_LONGER_DROP());{const n=f7.fromMovement(t.selectedPiece.get(),e),r=p7.isLegalPhaseTwoMove(n,t.state);return t.neededCutting(r)?(t.chosenLanding=gw.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,DG.SUCCESS):t.chooseMove(n,t.state)}})()}neededCutting(e){return e.isFailure()&&e.getReason()===h7.MUST_CUT()}moveVirtuallyPiece(){const e=this.selectedPiece.get();this.pieces=this.pieces.filter(t=>!1===t.equals(e)),this.neighbors=this.getEmptyNeighbors()}showCuttable(){const e=f7.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=d7.deplacePiece(this.state,e),n=d7.getGroups(t,e.start.get()),r=p7.getBiggerGroups(n);this.cuttableGroups=[];for(const i of r)this.cuttableGroups.push(i.toList())}getSelectedPieceClass(){return this.chosenLanding.isPresent()?"moved":"selected"}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-six"]],features:[Ho],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,b7,1,4,"polyline",1),oa(2,S7,1,3,"polyline",2),oa(3,P7,1,4,"polyline",3),oa(4,O7,1,3,"polyline",4),oa(5,T7,1,3,"polyline",5),oa(6,I7,1,3,"polyline",6),oa(7,k7,1,4,"polyline",7),oa(8,A7,1,3,"polyline",8),oa(9,M7,2,1,"g",9),da()),2&e&&(na("viewBox",t.viewBox),Ts(1),la("ngForOf",t.pieces),Ts(1),la("ngForOf",t.neighbors),Ts(1),la("ngIf",t.chosenLanding.isPresent()),Ts(1),la("ngForOf",t.disconnecteds),Ts(1),la("ngIf",t.leftCoord.isPresent()),Ts(1),la("ngIf",t.lastDrop.isPresent()),Ts(1),la("ngIf",t.selectedPiece.isPresent()),Ts(1),la("ngForOf",t.victoryCoords),Ts(1),la("ngForOf",t.cuttableGroups))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class R7 extends bX{static of(e,t){return new R7(e,t)}static from(e,t){try{const n=new R7(e,t);return MG.success(n)}catch(n){return MG.failure(n.message)}}getMaximalDistance(){return 9}}R7.encoder=EX.getEncoder(9,9,R7.of);const D7={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:jY.ZERO};class L7 extends IX{static getInitialState(){const e=OX.UNOCCUPIED,t=OX.INVADERS,n=OX.DEFENDERS;return new L7([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,n,e,e,e,e],[t,e,e,e,n,e,e,e,t],[t,t,n,n,OX.PLAYER_ONE_KING,n,n,t,t],[t,e,e,e,n,e,e,e,t],[e,e,e,e,n,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}from(e,t){return new L7(e,t)}}class F7 extends AX{constructor(){super(L7,D7,R7.of)}static get(){return null==F7.singleton&&(F7.singleton=new F7),SQ.ruler=this.singleton,F7.singleton}}const B7=OX.UNOCCUPIED,U7=OX.INVADERS,V7=OX.DEFENDERS,$7=OX.PLAYER_ONE_KING;class z7{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`Tablut is a strategy game that was played by the Vikings.
        The goal of the game is different for each player.
        The attacker plays first. Its pieces (dark) are close to the edges.
        Its goal is to capture the king, which is in the center of the board.
        The defender plays second. Its pieces (light) are in the middle.
        Its goal is to move the king on one of the 4 thrones in the corners.
        Note that the square in which the king starts, in the center of the board, is also a throne.`,L7.getInitialState()),AQ.anyMove($localize`Moving`,$localize`All pieces move the same way.
        Similarly to a rook in chess, a piece can move:
        <ol>
            <li>By as many squares as you want.</li>
            <li>Without going over another piece or stopping on another piece.</li>
            <li>Horizontally or vertically.</li>
            <li>Only the king can land on a throne.</li>
        </ol>
        To move a piece, click on it and then on its landing square.<br/><br/>
        You're playing Dark, do the first move.`,L7.getInitialState(),R7.of(new eQ(4,1),new eQ(1,1)),$localize`Congratulations!`),AQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new L7([[B7,B7,B7,U7,U7,U7,B7,B7,B7],[B7,B7,B7,B7,U7,B7,B7,B7,B7],[B7,B7,B7,B7,V7,B7,B7,B7,B7],[B7,B7,B7,U7,V7,B7,B7,B7,U7],[U7,U7,V7,V7,$7,V7,V7,U7,U7],[B7,B7,B7,B7,V7,B7,B7,B7,U7],[B7,B7,B7,B7,V7,B7,B7,B7,B7],[B7,B7,B7,B7,U7,B7,B7,B7,B7],[B7,B7,B7,U7,U7,U7,B7,B7,B7]],1),[R7.of(new eQ(2,4),new eQ(2,3)),R7.of(new eQ(4,2),new eQ(3,2))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),AQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new L7([[B7,B7,B7,U7,U7,U7,B7,B7,B7],[B7,B7,B7,B7,U7,B7,B7,B7,B7],[B7,B7,B7,B7,V7,B7,B7,B7,B7],[B7,B7,V7,B7,$7,B7,V7,B7,U7],[U7,U7,B7,V7,B7,V7,V7,U7,U7],[B7,B7,B7,B7,V7,B7,B7,B7,U7],[B7,B7,B7,B7,V7,B7,B7,B7,B7],[B7,B7,B7,B7,U7,B7,B7,B7,B7],[B7,B7,B7,U7,U7,U7,B7,B7,B7]],12),[R7.of(new eQ(1,4),new eQ(2,4))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),AQ.fromMove($localize`Capturing the king (1/2)`,$localize`To capture the king, two soldiers are not enough.
        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.
        This also works if the king is on the throne.<br/><br/>
        Capture the king.`,new L7([[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,U7,B7,B7,B7,B7,B7,B7,B7],[U7,$7,B7,U7,B7,B7,B7,B7,B7],[B7,U7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7]],72),[R7.of(new eQ(3,4),new eQ(2,4))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),AQ.fromMove($localize`Capturing the king (2/2)`,$localize`Another way to capture the king is to immobilize it against an edge of the board.
        Note that the king cannot be captured next to a throne.<br/><br/>
        Capture the king.`,new L7([[B7,B7,U7,$7,U7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,U7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7],[B7,B7,B7,B7,B7,B7,B7,B7,B7]],72),[R7.of(new eQ(3,3),new eQ(3,1))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function H7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",6),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();na("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function G7(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",7),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();na("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function q7(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,H7,1,1,"polyline",4),oa(2,G7,1,1,"ng-template",null,5,Ru),da()),2&e){const e=aa(3),t=wa().index,n=wa().index,r=wa();Ts(1),la("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function W7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(3,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(4,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(5,"line",11),_a("click",function(){Gt(e);const t=wa(2).index,n=wa().index;return wa().onClick(t,n)}),da(),da()}if(2&e){const e=wa(2).index,t=wa().index,n=wa();Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function j7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"polyline",13),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),da()}if(2&e){const e=wa(3).index,t=wa().index,n=wa();Ts(1),na("points",n.getKingPolyline(e,t))}}function Z7(e,t){if(1&e){const e=ma();Cn(),ha(0,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(1,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(2,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da(),ha(3,"line",11),_a("click",function(){Gt(e);const t=wa(3).index,n=wa().index;return wa().onClick(t,n)}),da()}if(2&e){const e=wa(3).index,t=wa().index,n=wa();na("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),na("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function Y7(e,t){if(1&e&&(Cn(),oa(0,j7,2,1,"g",9),oa(1,Z7,4,16,"ng-template",null,12,Ru)),2&e){const e=aa(2),t=wa(2).index,n=wa().index;la("ngIf",wa().isKing(t,n))("ngIfElse",e)}}function K7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"circle",8),_a("click",function(){Gt(e);const t=wa().index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,W7,6,20,"g",9),oa(3,Y7,3,2,"ng-template",null,10,Ru),da()}if(2&e){const e=aa(4),t=wa().index,n=wa().index,r=wa();Ts(1),la("ngClass",r.getPieceClasses(t,n)),na("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),la("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function J7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",2),_a("click",function(){const t=Gt(e).index,n=wa().index;return wa().onClick(t,n)}),da(),oa(2,q7,4,2,"g",3),oa(3,K7,5,6,"g",3),da()}if(2&e){const e=t.index,n=wa().index,r=wa();Ts(1),Oa("id","click_",e,"_",n,""),la("ngClass",r.getRectClasses(e,n)),na("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),la("ngIf",r.board[n][e]===r.NONE&&r.isThrone(e,n)),Ts(1),la("ngIf",r.board[n][e]!==r.NONE)}}function Q7(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,J7,4,9,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function X7(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",14),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t.x,t.y)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),Oa("id","click_",e.x,"_",e.y,""),na("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let e9=(()=>{class e extends MX{constructor(e){super(e,!1,R7.from),this.rules=F7.get(),this.availableMinimaxes=[new xX(this.rules,"DummyBot"),new BX(this.rules,"Piece > Influence"),new UX(this.rules,"Piece > Control"),new VX(this.rules,"Escape > Piece > Control")],this.encoder=R7.encoder,this.tutorial=(new z7).tutorial,this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-tablut"]],features:[Ho],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,Q7,2,1,"g",1),oa(2,X7,2,6,"g",1),da()),2&e&&(na("viewBox",t.getViewBox()),Ts(1),la("ngForOf",t.board),Ts(1),la("ngForOf",t.getClickables()))},directives:[Ud,Fd,$d],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class t9{}t9.PLACEMENT_AFTER_INITIAL_PHASE=()=>$localize`You cannot put a new ring after the tenth turn.`,t9.NO_MARKERS_IN_INITIAL_PHASE=()=>$localize`You cannot put a marker in a ring before placing all of your rings.`,t9.MISSING_CAPTURES=z2.MISSING_CAPTURES,t9.MOVE_DIRECTION_INVALID=()=>$localize`The direction of your move is invalid: a move is made along a straight line.`,t9.CAN_ONLY_CAPTURE_YOUR_MARKERS=()=>$localize`You can only capture your own markers.`,t9.SHOULD_SELECT_PLAYER_RING=()=>$localize`You must pick one of your own rings to move.`,t9.SHOULD_END_MOVE_ON_EMPTY_SPACE=()=>$localize`Your ring must land on an empty space.`,t9.MOVE_SHOULD_NOT_PASS_ABOVE_RING=()=>$localize`A ring can only jump over markers or empty spaces, not over another ring.`,t9.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=()=>$localize`Your ring must land on the first empty space after a group of markers.`,t9.AMBIGUOUS_CAPTURE_COORD=z2.AMBIGUOUS_CAPTURE_COORD,t9.CAPTURE_SHOULD_TAKE_RING=()=>$localize`When you capture markers, you must take one of your ring as well by clicking on it.`;class n9{constructor(e,t){this.player=e,this.isRing=t}static of(e,t){return e===ZY.NONE?n9.EMPTY:t?n9.RINGS[e.value]:n9.MARKERS[e.value]}equals(e){return this===e}flip(){return VG(!1===this.isRing,"cannot flip a ring (it should never happen)"),VG(this.player.isPlayer(),"cannot flip a non-player piece"),n9.of(this.player.getOpponent(),this.isRing)}toString(){switch(this){case n9.NONE:return"NONE";case n9.EMPTY:return"EMPTY";case n9.MARKER_ZERO:return"MARKER_ZERO";case n9.MARKER_ONE:return"MARKER_ONE";case n9.RING_ZERO:return"RING_ZERO";default:return uw.expectToBe(this,n9.RING_ONE),"RING_ONE"}}}n9.encoder=qY.tuple([jY.numberEncoder,qY.booleanEncoder],e=>[e.player,e.isRing],e=>n9.of(e[0],e[1])),n9.NONE=new n9(ZY.NONE,!1),n9.EMPTY=new n9(ZY.NONE,!1),n9.MARKER_ZERO=new n9(jY.ZERO,!1),n9.MARKER_ONE=new n9(jY.ONE,!1),n9.MARKERS=[n9.MARKER_ZERO,n9.MARKER_ONE],n9.RING_ZERO=new n9(jY.ZERO,!0),n9.RING_ONE=new n9(jY.ONE,!0),n9.RINGS=[n9.RING_ZERO,n9.RING_ONE];let r9=(()=>{class e extends w0{constructor(t,n,r){super(r,t,e.SIZE,e.SIZE,[6,4,3,2,1],n9.EMPTY),this.sideRings=n}static getInitialState(){const t=n9.EMPTY,n=n9.NONE;return new e([[n,n,n,n,n,n,t,t,t,t,n],[n,n,n,n,t,t,t,t,t,t,t],[n,n,n,t,t,t,t,t,t,t,t],[n,n,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,n,n],[t,t,t,t,t,t,t,t,n,n,n],[t,t,t,t,t,t,t,n,n,n,n],[n,t,t,t,t,n,n,n,n,n,n]],[5,5],0)}isInitialPlacementPhase(){return this.turn<10}countScores(){return this.turn<10?[0,0]:this.sideRings}equals(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&QY.compareTable(this.board,e.board)}getRingCoords(e){const t=[];return this.forEachCoord((n,r)=>{r.isRing&&r.player===e&&t.push(n)}),t}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==n9.NONE}setAtUnsafe(t,n){const r=QY.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.sideRings,this.turn)}}return e.SIZE=11,e})();class i9 extends B2{constructor(e,t){if(super(e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");this.ringTaken=gw.ofNullable(t)}static of(e,t,n){const r=[],i=iQ.factory.fromMove(e,t).get();for(let s=e;!1===s.equals(t);s=s.getNext(i))r.push(s);return r.push(t),new i9(r,n)}setRingTaken(e){return new i9(this.capturedSpaces,e)}equals(e){return!(!1===super.equals(e)||!1===this.ringTaken.equals(e.ringTaken))}}i9.encoder=new class extends HY{encode(e){return{captured:e.capturedSpaces.map(e=>eQ.encoder.encode(e)),ringTaken:eQ.encoder.encode(e.ringTaken.get())}}decode(e){const t=e;return VG(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new i9(t.captured.map(e=>eQ.encoder.decode(e)),eQ.encoder.decode(t.ringTaken))}};class s9 extends yQ{constructor(e,t,n,r){super(),this.initialCaptures=e,this.start=t,this.end=n,this.finalCaptures=r}isInitialPlacement(){return this.end.isAbsent()}equals(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===QY.compareArray(this.initialCaptures,e.initialCaptures)||!1===QY.compareArray(this.finalCaptures,e.finalCaptures))}toString(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}}s9.coordOptionalEncoder=F2(eQ.encoder),s9.encoder=new class extends GY{encodeMove(e){const t={moveStart:eQ.encoder.encode(e.start),moveEnd:s9.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=i9.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=i9.encoder.encode(e)}),t}decodeMove(e){const t=e;return VG(null!=t.moveStart,"Invalid encoded YinshMove"),new s9(this.decodeArray(t,"initialCapture",i9.encoder.decode),eQ.encoder.decode(t.moveStart),s9.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",i9.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class o9 extends uQ{getBoardValue(e){const t=this.ruler.getGameStatus(e);return t.isEndGame?hQ.fromWinner(t.winner):new hQ(e.gameState.sideRings[0]*jY.ZERO.getScoreModifier()+e.gameState.sideRings[1]*jY.ONE.getScoreModifier())}getListMoves(e){const t=[],n=e.gameState;if(n.isInitialPlacementPhase())for(const[r,i]of n.getCoordsAndContents())i===n9.EMPTY&&t.push(new s9([],r,gw.empty(),[]));else{const e=this.ruler;this.getPossibleCaptureCombinations(n).forEach(r=>{const i=e.applyCaptures(n,r);this.getRingMoves(i).forEach(n=>{const s=e.applyRingMoveAndFlip(i,n.start,n.end);this.getPossibleCaptureCombinations(s).forEach(e=>{const i=new s9(r,n.start,gw.of(n.end),e);t.push(i)})})})}return t}getPossibleCaptureCombinations(e){const t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return G2.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(e=>class{static getCombinations(e,t){return VG(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(e=>this.getPermutations(e)).reduce((e,t)=>e.concat(t))}static getPermutations(e){const t=e.length,n=[e.slice()],r=new Array(t).fill(0);let i=1;for(;i<t;)if(r[i]<i){const t=i%2&&r[i],s=e[i];e[i]=e[t],e[t]=s,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}static getSubsetsOfSize(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];{const i=[];for(;r<=e.length-n;){const s=e[r];for(const e of t(n-1,r+1))e.push(s),i.push(e);++r}return i}}(t,0)}}.getCombinations(n,e.length).map(t=>e.map((e,n)=>new i9(e.capturedSpaces,t[n])))).reduce((e,t)=>e.concat(t),[])}getRingMoves(e){const t=this.ruler,n=[];for(const r of this.getRingCoords(e))for(const i of t.getRingTargets(e,r))n.push({start:r,end:i});return n}getRingCoords(e){const t=e.getCurrentPlayer().value,n=[];return e.forEachCoord((e,r)=>{r===n9.RINGS[t]&&n.push(e)}),n}}class a9 extends OQ{applyLegalMove(e,t,n){return new r9(n.board,n.sideRings,n.turn+1)}applyCaptures(e,t){let n=e;return t.forEach(e=>{n=this.applyCapture(n,e)}),n}applyCapture(e,t){const n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new r9(n,e.sideRings,e.turn),t.ringTaken.get())}takeRing(e,t){const n=e.getCurrentPlayer().value,r=e.setAt(t,n9.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new r9(r,i,e.turn)}applyCaptureWithoutTakingRing(e,t){return t.forEach(t=>{e=e.setAt(t,n9.EMPTY)}),e.board}ringSelectionValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)===n9.RINGS[n]?DG.SUCCESS:DG.failure(t9.CAPTURE_SHOULD_TAKE_RING())}applyRingMoveAndFlip(e,t,n){const r=e.getCurrentPlayer().value;let i=e.setAt(t,n9.MARKERS[r]);i=i.setAt(n,n9.RINGS[r]);const s=iQ.factory.fromMove(t,n).get();for(let o=t.getNext(s);!1===o.equals(n);o=o.getNext(s)){const e=i.getPieceAt(o);e!==n9.EMPTY&&(i=i.setAt(o,e.flip()))}return i}isLegal(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return MG.failure(t9.NO_MARKERS_IN_INITIAL_PHASE());const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();const s=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(s,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();const a=this.applyCaptures(s,e.finalCaptures),c=this.noMoreCapturesValidity(a);return c.isFailure()?c.toFailedFallible():MG.success(a)}initialPlacementValidity(e,t){if(!0!==e.isInitialPlacementPhase())return MG.failure(t9.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==n9.EMPTY)return MG.failure(lQ.MUST_CLICK_ON_EMPTY_SPACE());const n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;const i=e.setAt(t,n9.of(n,!0)).board,s=new r9(i,r,e.turn);return MG.success(s)}moveStartValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==n9.RINGS[n]?DG.failure(t9.SHOULD_SELECT_PLAYER_RING()):DG.SUCCESS}moveValidity(e,t,n){const r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==n9.EMPTY)return DG.failure(t9.SHOULD_END_MOVE_ON_EMPTY_SPACE());const i=iQ.factory.fromMove(t,n);if(i.isFailure())return DG.failure(t9.MOVE_DIRECTION_INVALID());const s=i.get();let o=!1;for(let a=t.getNext(s);!1===a.equals(n);a=a.getNext(s)){const t=e.getPieceAt(a);if(t===n9.EMPTY){if(o)return DG.failure(t9.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(t.isRing)return DG.failure(t9.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return DG.SUCCESS}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=this.applyCapture(n,r)}return DG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer().value;for(const r of t.capturedSpaces)if(e.getPieceAt(r)!==n9.MARKERS[n])return DG.failure(t9.CAN_ONLY_CAPTURE_YOUR_MARKERS());return e.getPieceAt(t.ringTaken.get())!==n9.RINGS[n]?DG.failure(t9.CAPTURE_SHOULD_TAKE_RING()):DG.SUCCESS}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?DG.SUCCESS:DG.failure(t9.MISSING_CAPTURES())}getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=this.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o,a=i;for(o=i;e.isOnBoard(o);o=o.getNext(s)){const n=e.getPieceAt(o);if(n.player===t&&!1===n.isRing)0===r&&(a=o),r+=1;else{if(r>=5)break;r=0}}return r>=5?gw.of({start:a,end:o,dir:s}):gw.empty()}getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(e=>{for(let t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(i9.of(t,t.getNext(e.dir,4)))}),n}getRingTargets(e,t){const n=[];for(const r of iQ.factory.all){let i=!1;for(let s=t.getNext(r);e.isOnBoard(s);s=s.getNext(r)){const t=e.getPieceAt(s);if(t===n9.EMPTY){if(n.push(s),i)break}else{if(t.isRing)break;i=!0}}}return n}getGameStatus(e){return e.gameState.isInitialPlacementPhase()?PQ.ONGOING:e.gameState.sideRings[0]>=3?PQ.ZERO_WON:e.gameState.sideRings[1]>=3?PQ.ONE_WON:PQ.ONGOING}}const c9=n9.EMPTY,l9=n9.NONE,u9=n9.MARKER_ZERO,h9=n9.RING_ZERO,d9=n9.MARKER_ONE,f9=n9.RING_ONE;let p9=(()=>{class e{}return e.MUST_ALIGN_FIVE=()=>$localize`Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time.`,e.MUST_CAPTURE_TWO=()=>$localize`Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again.`,e})();class g9{constructor(){this.tutorial=[AQ.informational($localize`Goal of the game`,$localize`The goal at Yinsh is to capture three rings in total.
        The rings taken are shown on the top left for the dark player,
        and on the bottom right for the light player. Here, Dark won the game.
        Note that on the board you have two types of pieces for each player:
        rings (empty circles) and markers (full circles).`,new r9([[l9,l9,l9,l9,l9,l9,c9,c9,c9,c9,l9],[l9,l9,l9,l9,c9,c9,c9,c9,c9,c9,c9],[l9,l9,l9,u9,f9,c9,c9,c9,c9,c9,c9],[l9,l9,c9,u9,c9,f9,c9,d9,c9,c9,c9],[l9,c9,h9,d9,c9,c9,f9,u9,c9,c9,c9],[l9,c9,c9,u9,d9,c9,c9,c9,c9,c9,l9],[c9,c9,c9,u9,c9,c9,c9,f9,c9,c9,l9],[c9,c9,c9,d9,u9,h9,c9,c9,c9,l9,l9],[c9,c9,c9,c9,c9,c9,c9,c9,l9,l9,l9],[c9,c9,c9,c9,c9,c9,c9,l9,l9,l9,l9],[l9,c9,c9,c9,c9,l9,l9,l9,l9,l9,l9]],[3,1],20)),AQ.anyMove($localize`Initial board and placement phase`,$localize`The initial board is empty.
        At the beginning of the game, each player puts one of its ring on the board at their turn.
        This phase stops when all rings have been placed on the board.
        Put one of your ring on the board by clicking the space where you want to place it.`,new r9(r9.getInitialState().board,[5,5],0),new s9([],new eQ(5,5),gw.empty(),[]),$localize`Congratulations!`),AQ.anyMove($localize`Putting a marker`,$localize`Once the initial phase is done and all rings are on the board, you need to place markers on the board.
        To do so, put a marker in a ring by clicking on that ring.
        Then, the ring must be moved in a straight line, in any direction.
        A ring cannot pass through other rings during its move.
        If it goes over a group of markers, your move must stop at the first empty space after that group.
        All markers in the group are then flipped and their color change.<br/><br/>
        You're playing Dark, do a move.`,new r9([[l9,l9,l9,l9,l9,l9,c9,c9,c9,c9,l9],[l9,l9,l9,l9,c9,c9,c9,c9,c9,c9,c9],[l9,l9,l9,f9,c9,c9,c9,c9,c9,c9,c9],[l9,l9,f9,c9,c9,f9,c9,c9,c9,c9,c9],[l9,c9,h9,d9,c9,c9,f9,c9,c9,c9,c9],[l9,c9,c9,d9,c9,c9,c9,c9,c9,c9,l9],[c9,c9,c9,c9,h9,c9,c9,f9,c9,c9,l9],[c9,c9,c9,c9,c9,h9,c9,c9,c9,l9,l9],[c9,c9,c9,h9,c9,c9,c9,l9,l9,l9,l9],[c9,c9,c9,c9,c9,c9,c9,l9,l9,l9,l9],[l9,c9,c9,c9,c9,l9,l9,l9,l9,l9,l9]],[0,0],20),new s9([],new eQ(2,4),gw.of(new eQ(4,4)),[]),$localize`Congratulations!`),AQ.fromPredicate($localize`Getting a ring by aligning 5 markers`,$localize`Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.
        To do so, you need to align 5 markers of your color.
        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.
        You will then have one more point.
        You must capture when you can.<br/><br/>
        You're playing Dark, perform a capture!`,new r9([[l9,l9,l9,l9,l9,l9,c9,c9,c9,c9,l9],[l9,l9,l9,l9,c9,c9,c9,c9,c9,c9,c9],[l9,l9,l9,f9,c9,c9,c9,c9,c9,c9,c9],[l9,l9,f9,c9,c9,f9,c9,c9,c9,c9,c9],[l9,c9,u9,u9,h9,d9,d9,c9,c9,c9,c9],[l9,c9,c9,f9,c9,c9,c9,c9,c9,c9,l9],[c9,c9,c9,c9,h9,c9,c9,f9,c9,c9,l9],[c9,c9,c9,c9,c9,h9,c9,c9,c9,l9,l9],[c9,c9,c9,h9,c9,c9,c9,h9,l9,l9,l9],[c9,c9,c9,c9,c9,c9,c9,l9,l9,l9,l9],[l9,c9,c9,c9,c9,l9,l9,l9,l9,l9,l9]],[0,0],20),new s9([],new eQ(4,4),gw.of(new eQ(7,4)),[i9.of(new eQ(2,4),new eQ(6,4),new eQ(7,4))]),(e,t)=>1===t.sideRings[jY.ZERO.value]?DG.SUCCESS:DG.failure(p9.MUST_ALIGN_FIVE()),$localize`Congratulations!`),AQ.fromPredicate($localize`Compound captures`,$localize`During a turn, you could have to choose between multiple captures,
        or you could even capture multiple times!
        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>
        Here, you can capture two rings, do it!`,new r9([[l9,l9,l9,l9,l9,l9,c9,c9,c9,c9,l9],[l9,l9,l9,l9,h9,c9,c9,f9,f9,h9,c9],[l9,l9,l9,h9,c9,c9,d9,f9,c9,h9,c9],[l9,l9,c9,h9,c9,c9,c9,c9,c9,f9,c9],[l9,c9,c9,c9,c9,u9,c9,c9,f9,c9,c9],[l9,c9,c9,c9,u9,u9,c9,d9,c9,c9,l9],[c9,c9,c9,u9,c9,u9,c9,c9,c9,c9,l9],[c9,c9,u9,c9,c9,u9,c9,c9,c9,l9,l9],[c9,u9,c9,c9,c9,u9,c9,c9,l9,l9,l9],[c9,c9,c9,c9,c9,u9,c9,l9,l9,l9,l9],[l9,c9,c9,c9,c9,l9,l9,l9,l9,l9,l9]],[0,0],10),new s9([i9.of(new eQ(5,4),new eQ(1,8),new eQ(3,2)),i9.of(new eQ(5,9),new eQ(5,5),new eQ(3,3))],new eQ(4,1),gw.of(new eQ(4,2)),[]),(e,t)=>2===t.sideRings[jY.ZERO.value]?DG.SUCCESS:DG.failure(p9.MUST_CAPTURE_TWO()),$localize`Congratulations!`)]}}function m9(e,t){if(1&e&&(Cn(),fa(0,"circle",9)),2&e){const e=wa(2).$implicit,t=wa(2);na("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringOuterSize)}}function y9(e,t){if(1&e&&(Cn(),fa(0,"circle",10)),2&e){const e=wa(2),t=e.index,n=e.$implicit,r=wa().index,i=wa();Oa("id","ring_",t,"_",r,""),la("ngClass",n.ringClasses),na("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.ringMidSize)}}function v9(e,t){if(1&e&&(Cn(),fa(0,"circle",9)),2&e){const e=wa(2).$implicit,t=wa(2);na("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringInnerSize)}}function _9(e,t){if(1&e&&(Cn(),fa(0,"circle",11)),2&e){const e=wa(2),t=e.index,n=e.$implicit,r=wa().index,i=wa();Oa("id","marker_",t,"_",r,""),la("ngClass",n.markerClasses),na("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.markerSize)}}function C9(e,t){if(1&e){const e=ma();Cn(),ha(0,"g",3),_a("click",function(){Gt(e);const t=wa().$implicit;return wa(2).onClick(t.coord)}),fa(1,"polyline",4),ha(2,"g",5),oa(3,m9,1,3,"circle",6),oa(4,y9,1,6,"circle",7),oa(5,v9,1,3,"circle",6),oa(6,_9,1,6,"circle",8),da(),da()}if(2&e){const e=wa(),t=e.index,n=e.$implicit,r=wa().index;Oa("id","click_",t,"_",r,""),Ts(1),Oa("id","space_",t,"_",r,""),la("ngClass",n.spaceClasses),na("points",n.coordinates),Ts(1),Oa("id","pieceGroup_",t,"_",r,""),la("ngClass",n.removedClass),Ts(1),la("ngIf",n.isRing),Ts(1),la("ngIf",n.isRing),Ts(1),la("ngIf",n.isRing),Ts(1),la("ngIf",n.isMarker)}}function E9(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,C9,7,13,"g",2),da()),2&e){const e=t.$implicit;Ts(1),la("ngIf",null!=e)}}function w9(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,E9,2,1,"g",1),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}function b9(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"polyline",12),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),Oa("id","selected_",e.x,"_",e.y,""),na("points",n.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function S9(e,t){if(1&e){const e=ma();Cn(),ha(0,"polyline",14),_a("click",function(){Gt(e);const t=wa().$implicit;return wa().onClick(t)}),da()}if(2&e){const e=wa().$implicit,t=wa();Oa("id","selectable_",e.x,"_",e.y,""),na("points",t.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function P9(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,S9,1,3,"polyline",13),da()),2&e){const e=wa();Ts(1),la("ngIf",e.isPlayerTurn())}}function O9(e,t){if(1&e){const e=ma();Cn(),ha(0,"g"),ha(1,"rect",15),_a("click",function(){const t=Gt(e).$implicit;return wa().onClick(t)}),da(),da()}if(2&e){const e=t.$implicit,n=wa();Ts(1),na("x",n.viewInfo.spaceInfo[e.y][e.x].center.x-n.viewInfo.indicatorSize/2)("y",n.viewInfo.spaceInfo[e.y][e.x].center.y-n.viewInfo.indicatorSize/2)("width",n.viewInfo.indicatorSize)("height",n.viewInfo.indicatorSize)}}function T9(e,t){if(1&e&&(Cn(),ha(0,"g"),fa(1,"circle",16),fa(2,"circle",9),fa(3,"circle",17),da()),2&e){const e=t.index,n=wa().$implicit,r=wa();Ts(1),Oa("id","player_",n,"_sideRing_",e+1,""),na("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringOuterSize),Ts(1),na("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringInnerSize),Ts(1),la("ngClass",r.viewInfo.sideRingClass[n]),na("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringMidSize)}}const I9=function(){return[]};function k9(e,t){if(1&e&&(Cn(),ha(0,"g"),oa(1,T9,4,12,"g",1),da()),2&e){const e=t.$implicit,n=wa();Ts(1),la("ngForOf",ou(1,I9).constructor(n.viewInfo.sideRings[e]))}}const A9=function(){return[0,1]};class N9 extends nQ{constructor(e){super(e),this.movePhase="MOVE_START",this.moveStart=gw.empty(),this.moveEnd=gw.empty(),this.currentlyMoved=[],this.currentCapture=gw.empty(),this.initialCaptures=[],this.finalCaptures=[],this.possibleCaptures=[],this.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:N9.MARKER_SIZE,ringOuterSize:N9.RING_OUTER_SIZE,ringMidSize:N9.RING_MID_SIZE,ringInnerSize:N9.RING_INNER_SIZE,indicatorSize:N9.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},this.scores=gw.of([0,0]),this.rules=new a9(r9),this.availableMinimaxes=[new o9(this.rules,"YinshMinimax")],this.encoder=s9.encoder,this.tutorial=(new g9).tutorial,this.hexaLayout=new sQ(1.5*N9.RING_OUTER_SIZE,new eQ(2*N9.RING_OUTER_SIZE,0),cQ.INSTANCE),this.constructedState=this.rules.node.gameState,this.constructedState.allCoords().forEach(e=>{null==this.viewInfo.spaceInfo[e.y]&&(this.viewInfo.spaceInfo[e.y]=[]),this.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:this.getHexaCoordsAt(e),center:this.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}})}updateBoard(){this.cancelMoveAttempt(),this.scores=gw.of(this.rules.node.gameState.countScores())}updateViewInfo(){this.constructedState.allCoords().forEach(e=>{this.viewInfo.spaceInfo[e.y][e.x].spaceClasses=this.getSpaceClasses(e);const t=this.constructedState.getPieceAt(e);this.viewInfo.spaceInfo[e.y][e.x].removedClass="",this.setRingInfo(e,t),this.setMarkerInfo(e,t)});for(const e of[jY.ZERO,jY.ONE])this.viewInfo.sideRings[e.value]=this.constructedState.sideRings[e.value];switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];for(const e of this.possibleCaptures)for(const t of e.capturedSpaces)this.viewInfo.selectableCoords.push(t);break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}showCurrentMoveCaptures(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());for(const e of this.initialCaptures)this.markCurrentCapture(e);for(const e of this.finalCaptures)this.markCurrentCapture(e)}getSpaceClasses(e){return this.currentlyMoved.some(t=>t.equals(e))?["moved"]:[]}setRingInfo(e,t){if(t.isRing){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}setMarkerInfo(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==n9.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=gw.empty(),this.moveStart=gw.empty(),this.moveEnd=gw.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}showLastMove(){const e=this.rules.node.move;if(e.isPresent()){const t=e.get();if(t.isInitialPlacement())this.viewInfo.spaceInfo[t.start.y][t.start.x].spaceClasses=["moved"];else{for(const n of this.coordsBetween(t.start,t.end.get()))this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["moved"];const e=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();t.initialCaptures.forEach(t=>this.showLastMoveCapture(t,e)),t.finalCaptures.forEach(t=>this.showLastMoveCapture(t,e))}}}coordsBetween(e,t){const n=[],r=iQ.factory.fromMove(e,t).get();for(let i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==n9.EMPTY&&n.push(i),n.push(t);return n}showLastMoveCapture(e,t){for(const n of e.capturedSpaces)this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["captured"],t&&this.markRemovedMarker(n,this.rules.node.gameState.getCurrentPlayer().getOpponent());this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}moveToInitialCaptureOrMovePhase(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),DG.SUCCESS}onClick(e){var t=this;return lw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());switch(t.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_FIRST":return t.selectCaptureFirstCoord(e);case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_LAST":return t.selectCaptureLastCoord(e);case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":return t.selectRing(e);case"MOVE_START":return t.selectMoveStart(e);case"MOVE_END":return t.selectMoveEnd(e)}})()}selectCaptureFirstCoord(e){var t=this;return lw(function*(){const n=[];if(t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1)t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(n);else{if(0===n.length)return t.cancelMove(t9.MISSING_CAPTURES());t.selectCapture(n[0])}return DG.SUCCESS})()}moveToCaptureSelectLast(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;for(const t of e)for(const e of t.capturedSpaces)this.viewInfo.selectableCoords.push(e);switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}selectCaptureLastCoord(e){var t=this;return lw(function*(){const n=[];return t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1?t.cancelMove(t9.AMBIGUOUS_CAPTURE_COORD()):0===n.length?t.cancelMove(t9.MISSING_CAPTURES()):t.selectCapture(n[0])})()}selectCapture(e){switch(this.currentCapture=gw.of(e),this.constructedState=new r9(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),DG.SUCCESS}markCurrentCapture(e){for(const t of e.capturedSpaces)this.viewInfo.selectedCoords.push(t),this.markRemovedMarker(t,this.rules.node.gameState.getCurrentPlayer());e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}markRemovedMarker(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setMarkerInfo(e,n9.MARKERS[t.value])}markRemovedRing(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setRingInfo(e,n9.RINGS[t.value])}selectRing(e){var t=this;return lw(function*(){const n=t.rules.ringSelectionValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.constructedState=t.rules.takeRing(t.constructedState,e);const r=t.currentCapture.get().setRingTaken(e);switch(t.currentCapture=gw.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase){case"INITIAL_CAPTURE_SELECT_RING":return t.initialCaptures.push(r),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),DG.SUCCESS);default:return uw.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(r),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),DG.SUCCESS)}})()}moveToMovePhase(){return this.movePhase="MOVE_START",this.updateViewInfo(),DG.SUCCESS}tryMove(){var e=this;return lw(function*(){const t=new s9(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures);return yield e.chooseMove(t,e.rules.node.gameState,e.scores.get())})()}selectMoveStart(e){var t=this;return lw(function*(){if(t.constructedState.isInitialPlacementPhase()){const n=t.rules.initialPlacementValidity(t.constructedState,e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveStart=gw.of(e),t.tryMove())}{const n=t.rules.moveStartValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.moveStart=gw.of(e),t.movePhase="MOVE_END",t.updateViewInfo()}return DG.SUCCESS})()}selectMoveEnd(e){var t=this;return lw(function*(){const n=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveEnd=gw.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove())})()}moveToFinalCapturePhaseOrTryMove(){var e=this;return lw(function*(){return e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),DG.SUCCESS)})()}}function M9(e,t){if(1&e&&(ha(0,"option",5),Da(1),da()),2&e){const e=t.$implicit;la("value",e),Ts(1),La(e)}}N9.RING_OUTER_SIZE=40,N9.RING_MID_SIZE=34,N9.RING_INNER_SIZE=28,N9.MARKER_SIZE=N9.RING_INNER_SIZE,N9.INDICATOR_SIZE=10,N9.\u0275fac=function(e){return new(e||N9)(ca(BG))},N9.\u0275cmp=Xe({type:N9,selectors:[["app-yinsh"]],features:[Ho],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),ha(0,"svg",0),oa(1,w9,2,1,"g",1),oa(2,b9,2,3,"g",1),oa(3,P9,2,1,"g",1),oa(4,O9,2,4,"g",1),oa(5,k9,2,2,"g",1),da()),2&e&&(Ts(1),la("ngForOf",t.viewInfo.spaceInfo),Ts(1),la("ngForOf",t.viewInfo.selectedCoords),Ts(1),la("ngForOf",t.viewInfo.selectableCoords),Ts(1),la("ngForOf",t.viewInfo.targets),Ts(1),la("ngForOf",ou(5,A9)))},directives:[Ud,$d,Fd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let x9=(()=>{class e{}return e.ABALONE=()=>$localize`Use simple mechanics to push 6 of the opponent's pieces out of the board!`,e.APAGOS=()=>$localize`Very simple game, but, will you be able to win everytime?`,e.AWALE=()=>$localize`The international version of the famous African strategy game!`,e.BRANDHUB=()=>$localize`The Irish version of the Tafl game family!`,e.COERCEO=()=>$localize`Get rid of all of your opponent's pieces on a board that shrinks little by little!`,e.CONSPIRATEURS=()=>$localize`Hide all of your pieces before your opponent does, or risk to be discovered!`,e.DIAM=()=>$localize`Drop your pieces and move them around to align two pieces of the same color across the board to win!`,e.DVONN=()=>$localize`Stack your pieces and control as many stacks as you can to win!`,e.ENCAPSULE=()=>$localize`An enhanced tic-tac-toe where piece can encapsule other and prevent them to win.`,e.EPAMINONDAS=()=>$localize`An antiquity-war inspired game. Be the first to pierce your opponent's lines!`,e.GIPF=()=>$localize`A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!`,e.GO=()=>$localize`The oldest strategy game still practiced widely. A territory control game.`,e.KAMISADO=()=>$localize`Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!`,e.LINES_OF_ACTION=()=>$localize`Regroup your pieces to win. But your possible moves will often change!`,e.P4=()=>$localize`The classical 4 in a row game!`,e.PENTAGO=()=>$localize`Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!`,e.PYLOS=()=>$localize`Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!`,e.QUARTO=()=>$localize`Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!`,e.QUIXO=()=>$localize`Align 5 of your pieces on a board where pieces slide!`,e.REVERSI=()=>$localize`Sandwich your opponent's pieces to dominate the board!`,e.SAHARA=()=>$localize`Immobilize one of your opponent's pyramids before your opponent does!`,e.SIAM=()=>$localize`Be the first to push a mountain out of the board!`,e.SIX=()=>$localize`Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!`,e.TABLUT=()=>$localize`The Viking board game! Invaders must capture the king, defender must make him escape!`,e.YINSH=()=>$localize`Align your pieces to score points, but beware, pieces can flip!`,e})(),R9=(()=>{class e{constructor(e,t,n,r,i,s=!0){this.name=e,this.urlName=t,this.component=n,this.creationDate=r,this.description=i,this.display=s}}return e.ALL_GAMES=()=>[new e("MinimaxTesting","MinimaxTesting",B4,new Date("1970-01-01"),"",!1),new e($localize`Four in a Row`,"P4",X4,new Date("2018-08-28"),x9.P4()),new e($localize`Awal`,"Awale",CX,new Date("2018-11-29"),x9.AWALE()),new e($localize`Quarto`,"Quarto",x6,new Date("2018-12-09"),x9.QUARTO()),new e($localize`Tablut`,"Tablut",e9,new Date("2018-12-27"),x9.TABLUT()),new e($localize`Reversi`,"Reversi",c8,new Date("2019-01-16"),x9.REVERSI()),new e($localize`Go`,"Go",R3,new Date("2019-12-21"),x9.GO()),new e($localize`Encapsule`,"Encapsule",C2,new Date("2019-12-30"),x9.ENCAPSULE()),new e($localize`Siam`,"Siam",u7,new Date("2020-01-11"),x9.SIAM()),new e($localize`Sahara`,"Sahara",T8,new Date("2020-02-29"),x9.SAHARA()),new e($localize`Pylos`,"Pylos",z5,new Date("2020-10-02"),x9.PYLOS()),new e($localize`Kamisado`,"Kamisado",f4,new Date("2020-10-03"),x9.KAMISADO()),new e($localize`Quixo`,"Quixo",Z6,new Date("2020-10-15"),x9.QUIXO()),new e($localize`Dvonn`,"Dvonn",K0,new Date("2020-10-21"),x9.DVONN()),new e($localize`Epaminondas`,"Epaminondas",L2,new Date("2021-01-16"),x9.EPAMINONDAS()),new e($localize`Gipf`,"Gipf",o3,new Date("2021-02-22"),x9.GIPF()),new e($localize`Coerceo`,"Coerceo",M1,new Date("2021-03-21"),x9.COERCEO()),new e($localize`Six`,"Six",x7,new Date("2021-04-08"),x9.SIX()),new e($localize`Lines of Action`,"LinesOfAction",T4,new Date("2021-04-28"),x9.LINES_OF_ACTION()),new e($localize`Pentago`,"Pentago",_5,new Date("2021-05-23"),x9.PENTAGO()),new e($localize`Abalone`,"Abalone",YQ,new Date("2021-07-13"),x9.ABALONE()),new e($localize`Yinsh`,"Yinsh",N9,new Date("2021-07-31"),x9.YINSH()),new e($localize`Apagos`,"Apagos",uX,new Date("2021-11-04"),x9.APAGOS()),new e($localize`Diam`,"Diam",C0,new Date("2021-11-30"),x9.DIAM()),new e($localize`Brandhub`,"Brandhub",r1,new Date("2021-12-07"),x9.BRANDHUB()),new e($localize`Conspirateurs`,"Conspirateurs",X1,new Date("2021-12-30"),x9.CONSPIRATEURS())].sort((e,t)=>e.name.localeCompare(t.name)),e})(),D9=(()=>{class e{constructor(){this.gameNameList=R9.ALL_GAMES().filter(e=>!0===e.display).map(e=>e.urlName),this.pickGame=new vu}onChange(e){this.pickGame.emit(e.target.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){let e;return e=$localize`Pick a game`,[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],e,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"select",1),_a("change",function(e){return t.onChange(e)}),ha(2,"option",2),Hc(3,3),da(),oa(4,M9,2,2,"option",4),da(),da()),2&e&&(Ts(4),la("ngForOf",t.gameNameList))},directives:[lg,fg,Ud],encapsulation:2}),e})();function L9(e,t){if(1&e){const e=ma();ha(0,"div",26),ha(1,"div",27),_a("click",function(){return Gt(e),wa().closeInfo()}),da(),ha(2,"div",28),ha(3,"header",29),ha(4,"p",30),Da(5),da(),ha(6,"button",31),_a("click",function(){return Gt(e),wa().closeInfo()}),da(),da(),ha(7,"section",32),ha(8,"div",6),ha(9,"div",33),ha(10,"p",34),fa(11,"img",35),da(),da(),ha(12,"div",7),ha(13,"div",13),Da(14),da(),da(),da(),ha(15,"div",6),ha(16,"div",33),ha(17,"a",36),_a("click",function(){Gt(e);const t=wa();return t.createGame(t.gameInfoDetails.get().urlName)}),fa(18,"fa-icon",37),Da(19,"\xa0"),ha(20,"span"),Hc(21,38),da(),da(),da(),ha(22,"div",33),ha(23,"a",36),_a("click",function(){Gt(e);const t=wa();return t.createLocalGame(t.gameInfoDetails.get().urlName)}),fa(24,"fa-icon",37),Da(25,"\xa0"),ha(26,"span"),Hc(27,39),da(),da(),da(),ha(28,"div",33),ha(29,"a",36),_a("click",function(){Gt(e);const t=wa();return t.createTutorial(t.gameInfoDetails.get().urlName)}),fa(30,"fa-icon",37),Da(31,"\xa0"),ha(32,"span"),Hc(33,40),da(),da(),da(),da(),da(),da(),da()}if(2&e){const e=wa();Ts(5),La(e.gameInfoDetails.get().name),Ts(6),Oa("src","assets/images/",e.theme,"/",e.gameInfoDetails.get().urlName,".png",_i),Ts(3),Fa(" ",e.gameInfoDetails.get().description," "),Ts(4),la("icon",e.iconOnlineGame),Ts(6),la("icon",e.iconLocalGame),Ts(6),la("icon",e.iconTutorial)}}function F9(e,t){if(1&e){const e=ma();ha(0,"div",8),ha(1,"div",9),ha(2,"p",10),Da(3),da(),da(),ha(4,"div",42),ha(5,"figure",34),ha(6,"img",43),_a("click",function(){const t=Gt(e).$implicit;return wa(2).openInfo(t)}),da(),ha(7,"figcaption",44),_a("click",function(){const t=Gt(e).$implicit;return wa(2).openInfo(t)}),ha(8,"div",45),Da(9,"?"),da(),da(),ha(10,"figcaption",46),ha(11,"a",47),_a("click",function(){const t=Gt(e).$implicit;return wa(2).createGame(t.urlName)}),fa(12,"fa-icon",37),da(),ha(13,"a",48),_a("click",function(){const t=Gt(e).$implicit;return wa(2).createLocalGame(t.urlName)}),fa(14,"fa-icon",37),da(),ha(15,"a",49),_a("click",function(){const t=Gt(e).$implicit;return wa(2).createTutorial(t.urlName)}),fa(16,"fa-icon",37),da(),da(),da(),da(),ha(17,"div",50),Da(18),da(),da()}if(2&e){const e=t.$implicit,n=wa(2);Ts(3),La(e.name),Ts(3),Pa("id","image_",e.urlName,""),Oa("src","assets/images/",n.theme,"/",e.urlName,".png",_i),Ts(5),Pa("id","playOnline_",e.urlName,""),Ts(1),la("icon",n.iconOnlineGame),Ts(1),Pa("id","playLocally_",e.urlName,""),Ts(1),la("icon",n.iconLocalGame),Ts(1),Pa("id","startTutorial_",e.urlName,""),Ts(1),la("icon",n.iconTutorial),Ts(2),Fa(" ",e.description," ")}}function B9(e,t){if(1&e&&(ha(0,"div",7),oa(1,F9,19,11,"div",41),da()),2&e){const e=t.$implicit;Ts(1),la("ngForOf",e)}}let U9=(()=>{class e{constructor(e,t){this.router=e,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=lK,this.iconLocalGame=aK,this.iconTutorial=sK,this.gameInfoDetails=gw.empty(),this.theme=t.getTheme();const n=R9.ALL_GAMES().filter(e=>!0===e.display);let r=0;for(let i=0;i<n.length;i++)i<this.numberOfColumns&&this.games.push([]),this.games[r].push(n[i]),r=(r+1)%this.numberOfColumns}createGame(e){var t=this;return lw(function*(){return t.router.navigate(["/play",e])})()}createLocalGame(e){var t=this;return lw(function*(){return t.router.navigate(["/local",e])})()}createTutorial(e){return this.router.navigate(["/tutorial",e])}openInfo(e){this.gameInfoDetails=gw.of(e)}closeInfo(){this.gameInfoDetails=gw.empty()}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(iK))},e.\u0275cmp=Xe({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`EveryBoard`,t=$localize`EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.${"\ufffd#6\ufffd\ufffd/#6\ufffd"}:LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn.`,n=$localize`Play online`,r=$localize`Create an online game`,i=$localize`See the game list`,s=$localize`Play offline`,o=$localize`Play`,a=$localize`Learn`,c=$localize`Play online`,l=$localize`Play offline`,u=$localize`Learn the rules`,h=$localize`Play online`,d=$localize`Play offline`,f=$localize`Learn the rules`,[[1,"hero"],[1,"hero-body"],[1,"title"],e,[1,"subtitle"],t,[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],n,[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],r,["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],i,s,[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],o,["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],a,["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],c,l,u,["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",h,1,"button",3,"id","click"],["data-tooltip",d,1,"button",3,"id","click"],["data-tooltip",f,1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(ha(0,"section",0),ha(1,"div",1),ha(2,"p",2),Hc(3,3),da(),ha(4,"p",4),$c(5,5),fa(6,"br"),zc(),da(),da(),ha(7,"div",6),ha(8,"div",7),ha(9,"div",8),ha(10,"header",9),ha(11,"p",10),Hc(12,11),da(),da(),ha(13,"div",12),ha(14,"div",13),ha(15,"button",14),Hc(16,15),da(),ha(17,"button",16),Hc(18,17),da(),da(),da(),da(),da(),ha(19,"div",7),ha(20,"div",8),ha(21,"header",9),ha(22,"p",10),Hc(23,18),da(),da(),ha(24,"div",12),ha(25,"div",19),ha(26,"button",20),Hc(27,21),da(),ha(28,"button",22),Hc(29,23),da(),da(),da(),da(),da(),da(),oa(30,L9,34,7,"div",24),ha(31,"div",6),oa(32,B9,2,1,"div",25),da(),da()),2&e&&(Ts(30),la("ngIf",t.gameInfoDetails.isPresent()),Ts(2),la("ngForOf",t.games))},directives:[e_,$d,Ud,DJ],encapsulation:2}),e})(),V9=(()=>{class e{constructor(e){this.element=e}ngAfterViewInit(){this.element.nativeElement.focus()}}return e.\u0275fac=function(t){return new(t||e)(ca(al))},e.\u0275dir=st({type:e,selectors:[["","autofocus",""]]}),e})(),$9=(()=>{class e{constructor(e){this.shown=!1,this.input=e.nativeElement.parentNode.previousSibling,e.nativeElement.addEventListener("click",e=>{this.toggle()})}toggle(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}return e.\u0275fac=function(t){return new(t||e)(ca(al))},e.\u0275dir=st({type:e,selectors:[["","toggleVisibility",""]]}),e})();function z9(e,t){if(1&e&&(ha(0,"div",29),ha(1,"div",30),Hc(2,31),da(),ha(3,"div",32),Da(4),da(),da()),2&e){const e=wa();Ts(4),La(e.errorMessage)}}const H9=function(){return["/register"]},G9=function(){return["/reset-password"]};let q9=(()=>{class e{constructor(e,t){this.router=e,this.connectedUserService=t,this.faEye=cK,this.loginForm=new Hp({email:new zp,password:new zp})}ngOnInit(){var e=this;this.connectedUserService.getUserObs().subscribe(function(){var t=lw(function*(t){t!==BY.NOT_CONNECTED&&(yield e.redirect())});return function(e){return t.apply(this,arguments)}}())}loginWithEmail(e){var t=this;return lw(function*(){const n=yield t.connectedUserService.doEmailLogin(e.email,e.password);n.isFailure()&&(t.errorMessage=n.getReason())})()}loginWithGoogle(){var e=this;return lw(function*(){const t=yield e.connectedUserService.doGoogleLogin();t.isFailure()&&(e.errorMessage=t.getReason())})()}redirect(){var e=this;return lw(function*(){return e.router.navigate(["/lobby"])})()}canLogin(){return!(""===(this.loginForm.value.email||"")||""===(this.loginForm.value.password||""))}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(UY))},e.\u0275cmp=Xe({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h;return e=$localize`Log in`,t=$localize`Email`,n=$localize`Email`,r=$localize`Password`,i=$localize`Password`,s=$localize`Log in`,o=$localize`Log in with Google`,a=$localize`No account?`,c=$localize`Register`,l=$localize`Forgot your password?`,u=$localize`Reset your password`,h=$localize`Connection error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",n,"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],r,[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",i,"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],s,["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],o,["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],a,[3,"routerLink"],c,l,u,["role","alert",1,"message","is-danger"],[1,"message-header"],h,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"p",1),Hc(2,2),da(),ha(3,"form",3),ha(4,"div",4),ha(5,"div",5),ha(6,"label",6),Hc(7,7),da(),da(),ha(8,"div",8),ha(9,"div",9),ha(10,"div",10),fa(11,"input",11),da(),da(),da(),da(),ha(12,"div",4),ha(13,"div",5),ha(14,"label",12),Hc(15,13),da(),da(),ha(16,"div",8),ha(17,"div",9),ha(18,"div",14),fa(19,"input",15),ha(20,"span",16),fa(21,"fa-icon",17),da(),da(),da(),da(),da(),ha(22,"div",4),fa(23,"div",5),ha(24,"div",8),ha(25,"div",9),ha(26,"div",10),ha(27,"button",18),_a("click",function(){return t.loginWithEmail(t.loginForm.value)}),Hc(28,19),da(),da(),da(),da(),da(),ha(29,"div",4),fa(30,"div",5),ha(31,"div",8),ha(32,"div",9),ha(33,"div",10),ha(34,"button",20),_a("click",function(){return t.loginWithGoogle()}),Hc(35,21),da(),da(),da(),da(),da(),oa(36,z9,5,1,"div",22),ha(37,"p",23),pa(38),Hc(39,24),ga(),Da(40,"\xa0 "),ha(41,"a",25),Hc(42,26),da(),da(),ha(43,"p",23),pa(44),Hc(45,27),ga(),Da(46,"\xa0 "),ha(47,"a",25),Hc(48,28),da(),da(),da(),da()),2&e&&(Ts(3),la("formGroup",t.loginForm),Ts(18),la("icon",t.faEye),Ts(6),la("disabled",!t.canLogin()),Ts(9),la("ngIf",t.errorMessage),Ts(5),la("routerLink",ou(6,H9)),Ts(6),la("routerLink",ou(7,G9)))},directives:[Jp,_p,rg,zf,vp,sg,V9,gg,DJ,$9,$d,t_],encapsulation:2}),e})(),W9=(()=>{class e{constructor(e){this.partDAO=e,this.unsubscribe=gw.empty(),this.activePartsBS=new sm([]),this.activePartsObs=this.activePartsBS.asObservable()}getActivePartsObs(){return this.activePartsObs}startObserving(){VG(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");const e=new jG(e=>{const t=this.activePartsBS.value.concat(...e);this.activePartsBS.next(t)},e=>{const t=this.activePartsBS.value;for(const n of e)t.forEach(e=>{e.id===n.id&&(e.data=n.data)});this.activePartsBS.next(t)},e=>{const t=[];for(const n of this.activePartsBS.value)e.some(e=>e.id===n.id)||t.push(n);this.activePartsBS.next(t)});this.unsubscribe=gw.of(this.partDAO.observeActiveParts(e))}stopObserving(){VG(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=gw.empty()}}return e.\u0275fac=function(t){return new(t||e)(Or(HG))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),j9=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}navigateToOnlineGameCreation(){var e=this;return lw(function*(){yield e.router.navigate(["/play",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Create an online game`,[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(ha(0,"app-pick-game",0),_a("pickGame",function(e){return t.pickGame(e)}),da(),ha(1,"button",1),_a("click",function(){return t.navigateToOnlineGameCreation()}),Hc(2,2),da()),2&e&&(Ts(1),la("disabled",!t.selectedGame))},directives:[D9],encapsulation:2}),e})(),Z9=(()=>{class e{transform(e){return vd(1e3*e.seconds,"HH:mm:ss","en-US")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"firebaseDate",type:e,pure:!0}),e})();const Y9=["chatDiv"];function K9(e,t){1&e&&(pa(0),Hc(1,5),ga())}function J9(e,t){1&e&&Hc(0,6),2&e&&(Gc(wa().unreadMessagesText),qc(0))}function Q9(e,t){if(1&e){const e=ma();ha(0,"button",11),_a("click",function(){return Gt(e),wa(2).scrollToBottom()}),Da(1),da()}if(2&e){const e=wa(2);Ts(1),Fa("",e.unreadMessagesText," \u2193")}}function X9(e,t){if(1&e&&(ha(0,"p"),Da(1),fu(2,"firebaseDate"),ha(3,"b",12),Da(4),da(),ha(5,"span",13),Da(6),da(),da()),2&e){const e=t.$implicit;Ts(1),Fa(" [",pu(2,3,e.postedTime),"] "),Ts(3),Fa("",e.sender.name," : "),Ts(2),La(e.content)}}function eee(e,t){if(1&e){const e=ma();ha(0,"div"),oa(1,Q9,2,1,"button",7),ha(2,"div",8,9),_a("scroll",function(){return Gt(e),wa().updateCurrentScrollPosition()}),oa(4,X9,7,5,"p",10),da(),da()}if(2&e){const e=wa();Ts(1),la("ngIf",e.showUnreadMessagesButton),Ts(3),la("ngForOf",e.chat)}}const tee=function(){return{standalone:!0}};function nee(e,t){if(1&e){const e=ma();ha(0,"form",14),_a("onSubmit",function(){return Gt(e),wa().sendMessage()}),ha(1,"div",15),ha(2,"div",16),ha(3,"input",17,18),_a("ngModelChange",function(t){return Gt(e),wa().userMessage=t}),da(),ha(5,"p",19),Da(6),da(),da(),ha(7,"div",20),ha(8,"button",21),_a("click",function(){return Gt(e),wa().sendMessage()}),fa(9,"fa-icon",22),da(),da(),da(),ha(10,"div",23),ha(11,"p"),ha(12,"strong"),Hc(13,24),da(),da(),da(),da()}if(2&e){const e=aa(4),t=wa();Ts(3),la("ngModel",t.userMessage)("ngModelOptions",ou(4,tee)),Ts(3),Fa("",e.value.length,"/128"),Ts(3),la("icon",t.faReply)}}let ree=(()=>{class e{constructor(t,n){this.chatService=t,this.connectedUserService=n,this.userMessage="",this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=uK,this.isNearBottom=!0,this.notYetScrolled=!0,hw(e.VERBOSE,"ChatComponent constructor")}ngOnInit(){hw(e.VERBOSE,`ChatComponent.ngOnInit for chat ${this.chatId}`),VG(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.loadChatContent()}ngAfterViewChecked(){this.scrollToBottomIfNeeded()}loadChatContent(){const e=e=>{this.updateMessages(e.flatMap(e=>null==e.data.postedTime?[]:[e.data]))},t=new jG(e,e,()=>{});this.chatService.startObserving(this.chatId,t)}updateMessages(e){this.chat=this.chat.concat(e);const t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}updateUnreadMessagesText(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize`no new message`,this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize`1 new message`:$localize`${e} new messages`}scrollToBottomIfNeeded(){this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}updateCurrentScrollPosition(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}scrollToBottom(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}scrollTo(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}sendMessage(){var e=this;return lw(function*(){const t=e.userMessage;e.userMessage="";const n=e.connectedUserService.user.get().toMinimalUser();yield e.chatService.sendMessage(n,t,e.turn)})()}ngOnDestroy(){this.chatService.stopObserving()}switchChatVisibility(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(WG),ca(UY))},e.\u0275cmp=Xe({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&Nu(Y9,5),2&e){let e;Au(e=Mu())&&(t.chatDiv=e.first)}},inputs:{chatId:"chatId",turn:"turn"},decls:7,vars:4,consts:function(){let e,t,n,r;return e=$localize`Hide chat`,t=$localize`Show chat (${"\ufffd0\ufffd"}:INTERPOLATION:)`,n=$localize`Type your message here`,r=$localize`Be polite`,[["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],e,t,["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],[1,"chat-sender"],[1,"chat-message"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",n,"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],[1,"clickable-icon",3,"icon"],[1,"content","is-small"],r]},template:function(e,t){if(1&e&&(ha(0,"div"),ha(1,"button",0),_a("click",function(){return t.switchChatVisibility()}),oa(2,K9,2,0,"ng-container",1),oa(3,J9,1,1,"ng-template",null,2,Ru),da(),oa(5,eee,5,2,"div",3),oa(6,nee,14,5,"form",4),da()),2&e){const e=aa(4);Ts(2),la("ngIf",t.visible)("ngIfElse",e),Ts(3),la("ngIf",t.visible),Ts(1),la("ngIf",t.visible)}},directives:[$d,Ud,Jp,_p,jp,zf,yg,vp,Kp,DJ],pipes:[Z9],encapsulation:2}),e})();function iee(e,t){if(1&e&&(pa(0),Da(1),ga()),2&e){const e=wa().$implicit;Ts(1),La(e.data.playerOne)}}function see(e,t){1&e&&(pa(0),Hc(1,26),ga())}function oee(e,t){if(1&e){const e=ma();ha(0,"tr",22),_a("click",function(){const t=Gt(e).$implicit;return wa(2).joinGame(t.id,t.data.typeGame)}),ha(1,"td",23),Da(2),da(),ha(3,"td",23),Da(4),da(),ha(5,"td",23),oa(6,iee,2,1,"ng-container",24),oa(7,see,2,0,"ng-template",null,25,Ru),da(),ha(9,"td",23),Da(10),da(),da()}if(2&e){const e=t.$implicit,n=t.index,r=aa(8);Pa("id","part_",n,""),Ts(2),La(e.data.typeGame),Ts(2),La(e.data.playerZero),Ts(2),la("ngIf",e.data.playerOne)("ngIfElse",r),Ts(4),La(e.data.turn)}}function aee(e,t){if(1&e&&(ha(0,"div",13),ha(1,"div",14),ha(2,"table",15),ha(3,"thead"),ha(4,"tr"),ha(5,"th",16),Hc(6,17),da(),ha(7,"th",16),Hc(8,18),da(),ha(9,"th",16),Hc(10,19),da(),ha(11,"th",16),Hc(12,20),da(),da(),da(),ha(13,"tbody"),oa(14,oee,11,6,"tr",21),da(),da(),da(),da()),2&e){const e=wa();Ts(14),la("ngForOf",e.activeParts)}}function cee(e,t){1&e&&(ha(0,"div",27),fa(1,"app-online-game-selection",28),da())}function lee(e,t){if(1&e&&(ha(0,"li",39),Da(1),fu(2,"firebaseDate"),da()),2&e){const e=wa().$implicit;Sa("id",e.data.username),Ts(1),Ba("",e.data.username,": ",pu(2,3,e.data.last_changed),"")}}function uee(e,t){if(1&e&&(pa(0),oa(1,lee,3,5,"li",38),ga()),2&e){const e=t.$implicit;Ts(1),la("ngIf",e.data.last_changed)}}function hee(e,t){if(1&e&&(ha(0,"div",29),ha(1,"div",30),ha(2,"div",31),fa(3,"app-chat",32),da(),da(),ha(4,"div",33),ha(5,"div",34),ha(6,"p"),Hc(7,35),da(),ha(8,"ul",36),oa(9,uee,2,1,"ng-container",37),da(),da(),da(),da()),2&e){const e=wa();Ts(3),la("turn",-1),Ts(6),la("ngForOf",e.activeUsers)}}let dee=(()=>{class e{constructor(e,t,n){this.router=e,this.userService=t,this.activePartsService=n,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}ngOnInit(){hw(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(e=>{this.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(e=>{this.activeParts=e})}ngOnDestroy(){hw(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}joinGame(e,t){var n=this;return lw(function*(){yield n.router.navigate(["/play",t,e])})()}selectTab(e){this.currentTab=e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(Qv),ca(KG),ca(W9))},e.\u0275cmp=Xe({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c;return e=$localize`Games`,t=$localize`Create`,n=$localize`Chat`,r=$localize`Game`,i=$localize`First player`,s=$localize`Second player`,o=$localize`Turn`,a=$localize`Waiting for opponent`,c=$localize`Connected users:`,[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],e,["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],t,["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],n,["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],r,i,s,o,[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],a,["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-9"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3"],["id","onlineUsers",1,"box"],c,["id","activeUsersList"],[4,"ngFor","ngForOf"],[3,"id",4,"ngIf"],[3,"id"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"ul"),ha(2,"li",1),ha(3,"a",2),_a("click",function(){return t.selectTab("games")}),Hc(4,3),da(),da(),ha(5,"li",4),ha(6,"a",5),_a("click",function(){return t.selectTab("create")}),Hc(7,6),da(),da(),ha(8,"li",7),ha(9,"a",8),_a("click",function(){return t.selectTab("chat")}),Hc(10,9),da(),da(),da(),da(),oa(11,aee,15,1,"div",10),oa(12,cee,2,0,"div",11),oa(13,hee,10,2,"div",12)),2&e&&(Ts(11),la("ngIf","games"===t.currentTab),Ts(1),la("ngIf","create"===t.currentTab),Ts(1),la("ngIf","chat"===t.currentTab))},directives:[Fd,$d,Ud,j9,ree],pipes:[Z9],encapsulation:2}),e})(),fee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-not-found"]],decls:5,vars:0,consts:function(){let e,t;return e=$localize`Game does not exist`,t=$localize`The game you tried to join does not exist anymore.`,[[1,"message","is-danger"],[1,"message-header"],e,[1,"message-body"],t]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"div",1),Hc(2,2),da(),ha(3,"div",3),Hc(4,4),da(),da())},encapsulation:2}),e})();function pee(e,t){}let gee=(()=>{class e{constructor(t){this.viewContainerRef=t,hw(e.VERBOSE,"GameIncluderComponent constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(ql))},e.\u0275cmp=Xe({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&oa(0,pee,0,0,"ng-template")},encapsulation:2}),e})(),mee=(()=>{class e{}return e.NOT_YOUR_TURN=()=>$localize`It is not your turn!`,e.NO_CLONING_FEATURE=()=>$localize`You cannot clone a game. This feature might be implemented later.`,e})(),yee=(()=>{class e{constructor(t,n,r){this.componentFactoryResolver=t,this.actRoute=n,this.connectedUserService=r,this.players=[gw.empty(),gw.empty()],this.endGame=!1,hw(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}getMatchingComponent(t){hw(e.VERBOSE,"GameWrapper.getMatchingComponent");const n=gw.ofNullable(R9.ALL_GAMES().find(e=>e.urlName===t));return VG(n.isPresent(),"Unknown Games are unwrappable"),n.get().component}afterGameIncluderViewInit(){hw(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit"),this.createGameComponent(),this.gameComponent.rules.setInitialBoard()}createGameComponent(){hw(e.VERBOSE,"GameWrapper.createGameComponent"),VG(null!=this.gameIncluder,"GameIncluder should be present");const t=uw.getNonNullable(this.actRoute.snapshot.paramMap.get("compo")),n=this.getMatchingComponent(t),r=this.componentFactoryResolver.resolveComponentFactory(n),i=this.gameIncluder.viewContainerRef.createComponent(r);this.gameComponent=i.instance,this.gameComponent.chooseMove=(e,t,n)=>this.receiveValidMove(e,t,n),this.gameComponent.canUserPlay=e=>this.onUserClick(e),this.gameComponent.isPlayerTurn=()=>this.isPlayerTurn(),this.gameComponent.cancelMoveOnWrapper=e=>{this.onCancelMove(e)},this.gameComponent.observerRole=this.observerRole,this.canPass=this.gameComponent.canPass}receiveValidMove(t,n,r){var i=this;return lw(function*(){if(hw(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),!i.isPlayerTurn())return DG.failure(mee.NOT_YOUR_TURN());if(i.endGame)return DG.failure($localize`The game has ended.`);const s=i.gameComponent.rules.isLegal(t,n);return s.isFailure()?(i.gameComponent.cancelMove(s.getReason()),DG.ofFallible(s)):(i.gameComponent.cancelMoveAttempt(),yield i.onLegalUserMove(t,r),hw(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),DG.SUCCESS)})()}onUserClick(e){if(this.observerRole===ZY.NONE.value){const e=mee.NO_CLONING_FEATURE();return DG.failure(e)}return this.isPlayerTurn()?DG.SUCCESS:DG.failure(mee.NOT_YOUR_TURN())}onCancelMove(e){}isPlayerTurn(){if(this.observerRole===ZY.NONE.value||null==this.gameComponent)return!1;const t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return hw(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}getBoardHighlight(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(rl),ca(Ay),ca(UY))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&Nu(gee,5),2&e){let e;Au(e=Mu())&&(t.gameIncluder=e.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class vee{constructor(e,t,n){this.added=e,this.modified=t,this.removed=n}static from(e,t){const n=new vee({},{},{});if(null==e)return n.added={...t},n;if(null==t)return n.removed={...e},n;const r=Object.keys(e),i=Object.keys(t),s=r.filter(e=>!1===i.includes(e)),o=r.filter(e=>i.includes(e)),a=i.filter(e=>!1===r.includes(e));return n.addNewKeys(a,t),n.addCommonKey(o,t,e),n.addRemovedKeys(s,e),n}addNewKeys(e,t){for(const n of e)null!=t[n]&&(this.added[n]=t[n])}addCommonKey(e,t,n){for(const r of e)if(null==t[r])null!=n[r]&&(this.removed[r]=n[r]);else if(null==n[r])null!=t[r]&&(this.added[r]=t[r]);else{if(["function","symbol","bigint"].includes(typeof n[r]))throw new Error("Not implemented yet");if(void 0===n[r])throw new Error("YOU RE NOT A REAL VALUE "+r);if(["string","boolean","number"].includes(typeof n[r]))n[r]!==t[r]&&(this.modified[r]=t[r]);else if("number"==typeof n[r].length){if("number"!=typeof t[r].length)throw new Error("Thing should not change type");if(n[r].length===t[r].length){let e=!0;for(let i=0;e&&i<n[r].length;i++)vee.from(n[r][i],t[r][i]).countChanges()>0&&(e=!1,this.modified[r]=t[r])}else this.modified[r]=t[r]}else{const e=vee.from(n[r],t[r]);e.countChanges()>0&&(this.modified[r]=e)}}}countChanges(){const e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}addRemovedKeys(e,t){for(const n of e)this.removed[n]=t[n]}isPresent(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}function _ee(e){return 1e3*e.seconds+e.nanoseconds/1e6}function Cee(e,t){return _ee(t)-_ee(e)}function Eee(e){return x((t,n)=>{Y(e).subscribe(new R(n,()=>n.complete(),p)),!n.closed&&t.subscribe(n)})}let wee=(()=>{class e{transform(e){const t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize`${r} hours`):1===r&&i.push($localize`1 hour`),n>1?i.push($localize`${n} minutes`):1===n&&i.push($localize`1 minute`),t>1?i.push($localize`${t} seconds`):1===t&&i.push($localize`1 second`),0===i.length)return $localize`0 seconds`;if(1===i.length)return i[0];{const e=i.slice(0,-1).join(", "),t=i.slice(-1)[0];return $localize`${e} and ${t}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"humanDuration",type:e,pure:!0}),e})();function bee(e,t){if(1&e&&(pa(0),Da(1),ga()),2&e){const e=wa(3);Ts(1),La(e.viewInfo.chosenOpponent)}}function See(e,t){1&e&&Hc(0,44)}function Pee(e,t){if(1&e&&(ha(0,"div",45),ha(1,"div",8),ha(2,"label",46),pa(3),Hc(4,47),ga(),ha(5,"output"),Da(6),fu(7,"humanDuration"),da(),da(),ha(8,"div",37),fa(9,"input",48),da(),da(),ha(10,"div",8),ha(11,"label",49),$c(12,50),fa(13,"output"),fu(14,"humanDuration"),zc(),da(),ha(15,"div",37),fa(16,"input",51),da(),da(),da()),2&e){const e=wa(3);Ts(6),La(pu(7,2,e.viewInfo.maximalMoveDuration||0)),Ts(8),Gc(pu(14,4,e.viewInfo.totalPartDuration||0)),qc(12)}}function Oee(e,t){1&e&&(ha(0,"div"),$c(1,52),fa(2,"br"),zc(),da())}function Tee(e,t){1&e&&(ha(0,"button",64),Hc(1,65),da())}function Iee(e,t){if(1&e){const e=ma();ha(0,"tr",60),_a("click",function(){const t=Gt(e).$implicit;return wa(4).selectOpponent(t)}),ha(1,"td",61),Da(2),da(),ha(3,"td",62),oa(4,Tee,2,0,"button",63),da(),da()}if(2&e){const e=t.$implicit,n=wa(4);Pa("id","presenceOf_",e,""),la("ngClass",n.viewInfo.candidateClasses[e]),Ts(1),la("id",n.viewInfo.chosenOpponent===e?"selected_"+e:"candidate_"+e),Ts(1),La(e),Ts(2),la("ngIf",n.viewInfo.chosenOpponent!==e)}}function kee(e,t){if(1&e&&(pa(0),Hc(1,53),ga(),ha(2,"div",54),ha(3,"table",55),ha(4,"thead"),ha(5,"tr"),ha(6,"th",56),Hc(7,57),da(),ha(8,"th",56),Hc(9,58),da(),da(),da(),ha(10,"tbody"),oa(11,Iee,5,5,"tr",59),da(),da(),da()),2&e){const e=wa(3);Ts(11),la("ngForOf",e.viewInfo.candidates)}}function Aee(e,t){if(1&e){const e=ma();ha(0,"button",66),_a("click",function(){return Gt(e),wa(3).changeConfig()}),Hc(1,67),da()}}function Nee(e,t){if(1&e){const e=ma();ha(0,"div"),ha(1,"h1",4),Hc(2,5),da(),ha(3,"form",6),ha(4,"fieldset",7),ha(5,"div",8),ha(6,"label",9),Hc(7,10),da(),ha(8,"div",11),ha(9,"button",12),_a("click",function(){return Gt(e),wa(2).selectFirstPlayer("RANDOM")}),Hc(10,13),da(),ha(11,"button",14),_a("click",function(){return Gt(e),wa(2).selectFirstPlayer("CREATOR")}),Hc(12,15),da(),ha(13,"button",16),_a("click",function(){return Gt(e),wa(2).selectFirstPlayer("CHOSEN_PLAYER")}),oa(14,bee,2,1,"ng-container",17),oa(15,See,1,0,"ng-template",null,18,Ru),da(),da(),da(),ha(17,"div",8),ha(18,"label",9),Hc(19,19),da(),ha(20,"div",11),ha(21,"div",20),_a("click",function(){return Gt(e),wa(2).selectPartType("STANDARD")}),ha(22,"div",21),ha(23,"span"),Hc(24,22),da(),da(),ha(25,"div",23),ha(26,"div",24),ha(27,"div",25),ha(28,"p"),pa(29),Hc(30,26),ga(),ha(31,"strong"),Da(32),fu(33,"humanDuration"),da(),fa(34,"br"),pa(35),$c(36,27),fa(37,"strong"),fu(38,"humanDuration"),zc(),ga(),da(),da(),da(),da(),da(),ha(39,"div",28),_a("click",function(){return Gt(e),wa(2).selectPartType("BLITZ")}),ha(40,"div",21),ha(41,"span"),Hc(42,29),da(),da(),ha(43,"div",23),ha(44,"div",24),ha(45,"div",25),ha(46,"p"),pa(47),Hc(48,30),ga(),ha(49,"strong"),Da(50),fu(51,"humanDuration"),da(),fa(52,"br"),pa(53),$c(54,31),fa(55,"strong"),fu(56,"humanDuration"),zc(),ga(),da(),da(),da(),da(),da(),ha(57,"button",32),_a("click",function(){return Gt(e),wa(2).selectPartType("CUSTOM")}),Hc(58,33),da(),da(),da(),oa(59,Pee,17,6,"div",34),ha(60,"div",8),ha(61,"label",35),Hc(62,36),da(),ha(63,"div",37),oa(64,Oee,3,0,"div",17),oa(65,kee,12,1,"ng-template",null,38,Ru),da(),da(),da(),ha(67,"div",8),ha(68,"div",11),ha(69,"button",39),_a("click",function(){return Gt(e),wa(2).proposeConfig()}),Hc(70,40),da(),oa(71,Aee,2,0,"button",41),ha(72,"button",42),_a("click",function(){return Gt(e),wa(2).cancelGameCreation()}),Hc(73,43),da(),da(),da(),da(),da()}if(2&e){const e=aa(16),t=aa(66),n=wa(2);Ts(3),la("formGroup",n.configFormGroup),Ts(1),la("disabled",!n.viewInfo.canEditConfig),Ts(5),la("ngClass",n.viewInfo.firstPlayerClasses.RANDOM),Ts(2),la("ngClass",n.viewInfo.firstPlayerClasses.CREATOR),Ts(2),la("ngClass",n.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),Ts(1),la("ngIf",n.viewInfo.chosenOpponent)("ngIfElse",e),Ts(7),la("ngClass",n.viewInfo.partTypeClasses.STANDARD),Ts(11),La(pu(33,19,n.partType.NORMAL_MOVE_DURATION)),Ts(6),Gc(pu(38,21,n.partType.NORMAL_PART_DURATION)),qc(36),Ts(1),la("ngClass",n.viewInfo.partTypeClasses.BLITZ),Ts(11),La(pu(51,23,n.partType.BLITZ_MOVE_DURATION)),Ts(6),Gc(pu(56,25,n.partType.BLITZ_PART_DURATION)),qc(54),Ts(1),la("ngClass",n.viewInfo.partTypeClasses.CUSTOM),Ts(2),la("ngIf",n.viewInfo.showCustomTime),Ts(5),la("ngIf",0===n.viewInfo.candidates.length)("ngIfElse",t),Ts(5),la("disabled",!n.viewInfo.canProposeConfig),Ts(2),la("ngIf",n.viewInfo.canReviewConfig)}}function Mee(e,t){if(1&e&&(ha(0,"div",74),ha(1,"p"),$c(2,75),fa(3,"br"),zc(),da(),da()),2&e){const e=wa(3);Ts(3),Gc(e.viewInfo.creator),qc(2)}}function xee(e,t){if(1&e&&(ha(0,"span"),Hc(1,81),da()),2&e){const e=wa(4);Ts(1),Gc(e.viewInfo.creator),qc(1)}}function Ree(e,t){1&e&&(ha(0,"span"),Hc(1,82),da())}function Dee(e,t){1&e&&(ha(0,"span"),Hc(1,83),da())}function Lee(e,t){if(1&e){const e=ma();ha(0,"div",74),ha(1,"p"),Hc(2,76),da(),ha(3,"ul"),ha(4,"li"),oa(5,xee,2,1,"span",2),oa(6,Ree,2,0,"span",2),oa(7,Dee,2,0,"span",2),da(),ha(8,"li"),$c(9,77),fa(10,"strong"),fu(11,"humanDuration"),zc(),da(),ha(12,"li"),$c(13,78),fa(14,"strong"),fu(15,"humanDuration"),zc(),da(),da(),ha(16,"button",79),_a("click",function(){return Gt(e),wa(3).acceptConfig()}),Hc(17,80),da(),da()}if(2&e){const e=wa(3);Ts(2),Gc(e.viewInfo.creator)(e.viewInfo.partTypeName),qc(2),Ts(3),la("ngIf","CREATOR"===e.viewInfo.firstPlayer),Ts(1),la("ngIf","CHOSEN_PLAYER"===e.viewInfo.firstPlayer),Ts(1),la("ngIf","RANDOM"===e.viewInfo.firstPlayer),Ts(4),Gc(pu(11,7,e.viewInfo.maximalMoveDuration||0)),qc(9),Ts(4),Gc(pu(15,9,e.viewInfo.totalPartDuration||0)),qc(13)}}function Fee(e,t){if(1&e&&(ha(0,"div"),ha(1,"div",68),ha(2,"div",69),ha(3,"p"),Hc(4,70),da(),da(),ha(5,"div",71),oa(6,Mee,4,1,"div",72),oa(7,Lee,18,11,"ng-template",null,73,Ru),da(),da(),da()),2&e){const e=aa(8),t=wa(2);Ts(6),la("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function Bee(e,t){if(1&e&&(pa(0),Hc(1,86),ga()),2&e){const e=wa(3);Ts(1),Gc(e.viewInfo.creator),qc(1)}}function Uee(e,t){if(1&e&&Hc(0,87),2&e){const e=wa(3);Gc(e.viewInfo.creator)(e.viewInfo.chosenOpponent),qc(0)}}function Vee(e,t){if(1&e&&(ha(0,"div",68),ha(1,"div",69),ha(2,"p"),Hc(3,84),da(),da(),ha(4,"div",71),ha(5,"p"),oa(6,Bee,2,1,"ng-container",17),oa(7,Uee,1,2,"ng-template",null,85,Ru),da(),da(),da()),2&e){const e=aa(8),t=wa(2);Ts(6),la("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function $ee(e,t){if(1&e&&(ha(0,"div",1),oa(1,Nee,74,27,"div",2),oa(2,Fee,9,2,"div",2),oa(3,Vee,9,2,"div",3),da()),2&e){const e=wa();Ts(1),la("ngIf",e.viewInfo.userIsCreator),Ts(1),la("ngIf",e.viewInfo.userIsChosenOpponent),Ts(1),la("ngIf",e.viewInfo.userIsObserver)}}class zee{constructor(e,t,n,r,i,s,o,a){this.router=e,this.connectedUserService=t,this.gameService=n,this.joinerService=r,this.chatService=i,this.userService=s,this.formBuilder=o,this.messageDisplayer=a,this.partType=$Y,this.gameStartNotification=new vu,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.ngUnsubscribe=new A,this.allUserInterval=gw.empty(),this.ownTokenInterval=gw.empty(),this.selfSubscription=()=>{},this.allDocDeleted=!1,hw(zee.VERBOSE,"PartCreationComponent constructed")}ngOnInit(){var e=this;return lw(function*(){hw(zee.VERBOSE,"PartCreationComponent.ngOnInit for "+e.connectedUserService.user.get().username.get()),e.checkInputs(),e.createForms();const t=e.connectedUserService.user.get().toMinimalUser(),n=yield e.joinerService.joinGame(e.partId,t);if(n.isFailure()){const t=n.getReason();e.messageDisplayer.criticalMessage(t)}else yield e.updateUserDocWithObservedPart(),yield e.startSendingPresenceTokens(),e.gameExists=!0,e.subscribeToJoinerDoc(),e.subscribeToFormElements(),hw(zee.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds")})()}checkInputs(){const e=this.connectedUserService.user;VG(e.isPresent()&&e.get()!==BY.NOT_CONNECTED,"PartCreationComponent should not be created with an empty userName"),VG(""!==this.partId,"PartCreationComponent should not be created with an empty partId")}createForms(){this.configFormGroup=this.formBuilder.group({firstPlayer:[VY.RANDOM.value,Zf.required],maximalMoveDuration:[$Y.NORMAL_MOVE_DURATION,Zf.required],partType:["STANDARD",Zf.required],totalPartDuration:[$Y.NORMAL_PART_DURATION,Zf.required],chosenOpponent:["",Zf.required]})}updateUserDocWithObservedPart(){return hw(zee.VERBOSE,"updateUserDocWithObservedPart of '"+this.partId+"'"),this.connectedUserService.updateObservedPart(this.partId)}subscribeToJoinerDoc(){var e=this;this.joinerService.subscribeToChanges(this.partId,function(){var t=lw(function*(t){yield e.onCurrentJoinerUpdate(t)});return function(e){return t.apply(this,arguments)}}())}getForm(e){return uw.getNonNullable(this.configFormGroup.get(e))}subscribeToFormElements(){this.getForm("chosenOpponent").valueChanges.pipe(Eee(this.ngUnsubscribe)).subscribe(e=>{void 0!==this.viewInfo.chosenOpponent&&(this.viewInfo.candidateClasses[this.viewInfo.chosenOpponent]=[]),this.viewInfo.candidateClasses[e]=["is-selected"],this.viewInfo.chosenOpponent=e;const t=uw.getNonNullable(this.currentJoiner).partStatus;this.viewInfo.canProposeConfig=t!==zY.CONFIG_PROPOSED.value&&""!==e}),this.getForm("partType").valueChanges.pipe(Eee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.partTypeClasses[this.viewInfo.partType]=[],this.viewInfo.partTypeClasses[e]=["is-primary","is-selected"],this.viewInfo.partType=e,this.viewInfo.showCustomTime="CUSTOM"===e}),this.getForm("maximalMoveDuration").valueChanges.pipe(Eee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.maximalMoveDuration=e}),this.getForm("totalPartDuration").valueChanges.pipe(Eee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.totalPartDuration=e}),this.getForm("firstPlayer").valueChanges.pipe(Eee(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.firstPlayerClasses[this.viewInfo.firstPlayer]=[],this.viewInfo.firstPlayerClasses[e]=["is-primary","is-selected"],this.viewInfo.firstPlayer=e})}updateViewInfo(){const e=uw.getNonNullable(this.currentJoiner),t=this.connectedUserService.user.get();switch(this.viewInfo.canReviewConfig=e.partStatus===zY.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=e.partStatus!==zY.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=t.id===e.creator.id,this.viewInfo.userIsChosenOpponent=t.id===e.chosenOpponent?.id,this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=e.partStatus!==zY.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=e.creator.name,this.viewInfo.candidates=e.candidates.map(e=>e.name),t.id===e.creator.id?this.setDataForCreator(e):(this.viewInfo.maximalMoveDuration=e.maximalMoveDuration,this.viewInfo.totalPartDuration=e.totalPartDuration,this.viewInfo.partType=e.partType,this.viewInfo.chosenOpponent=e.chosenOpponent?.name,this.viewInfo.firstPlayer=e.firstPlayer),e.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize`custom`;break;case"BLITZ":this.viewInfo.partTypeName=$localize`blitz`;break;case"STANDARD":this.viewInfo.partTypeName=$localize`standard`}}setDataForCreator(e){this.viewInfo.maximalMoveDuration=this.viewInfo.maximalMoveDuration??e.maximalMoveDuration,this.viewInfo.totalPartDuration=this.viewInfo.totalPartDuration??e.totalPartDuration;let t=this.viewInfo.chosenOpponent;null==t||""===t?t=e.chosenOpponent?.name??"":!1===e.candidates.some(e=>e.name===t)&&(t=""),this.getForm("chosenOpponent").setValue(t)}selectFirstPlayer(e){this.getForm("firstPlayer").setValue(e)}selectPartType(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue($Y.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue($Y.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue($Y.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue($Y.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}selectOpponent(e){var t=this;return lw(function*(){hw(zee.VERBOSE,"PartCreationComponent.setChosenOpponent("+e+")");const n=t.getUserFromName(e);return t.joinerService.setChosenOpponent(n)})()}getUserFromName(e){const t=uw.getNonNullable(this.currentJoiner).candidates.find(t=>t.name===e);return uw.getNonNullable(t)}changeConfig(){var e=this;return lw(function*(){return e.joinerService.reviewConfig()})()}proposeConfig(){var e=this;return lw(function*(){const t=e.getForm("chosenOpponent").value,n=e.getForm("partType").value,r=e.getForm("maximalMoveDuration").value,i=e.getForm("firstPlayer").value,s=e.getForm("totalPartDuration").value,o=e.getUserFromName(t);return e.joinerService.proposeConfig(o,$Y.of(n),r,VY.of(i),s)})()}cancelGameCreation(){var e=this;return lw(function*(){e.allDocDeleted=!0,yield e.connectedUserService.removeObservedPart(),hw(zee.VERBOSE,"PartCreationComponent.cancelGameCreation"),yield e.chatService.deleteChat(e.partId),hw(zee.VERBOSE,"PartCreationComponent.cancelGameCreation: chat deleted"),yield e.joinerService.deleteJoiner(),hw(zee.VERBOSE,"PartCreationComponent.cancelGameCreation: chat and joiner deleted"),yield e.gameService.deletePart(e.partId),hw(zee.VERBOSE,"PartCreationComponent.cancelGameCreation: chat, joiner, and part deleted")})()}onCurrentJoinerUpdate(e){var t=this;return lw(function*(){if(hw(zee.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(t.currentJoiner),then:JSON.stringify(e)}}),e.isAbsent())return hw(zee.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),t.onGameCancelled();if(t.chosenOpponentJustLeft(e.get())){const e=uw.getNonNullable(t.currentJoiner),n=uw.getNonNullable(e.chosenOpponent).name;t.messageDisplayer.infoMessage($localize`${n} left the game, please pick another opponent.`)}t.currentJoiner=e.get(),t.allUserInterval.isAbsent()&&(yield t.observeNeededPlayers()),t.updateViewInfo(),t.isGameStarted()&&(hw(zee.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),t.onGameStarted())})()}chosenOpponentJustLeft(e){return null!=this.currentJoiner&&(null!=this.currentJoiner.chosenOpponent&&null==e.chosenOpponent)}onGameCancelled(){var e=this;return lw(function*(){hw(zee.VERBOSE,"PartCreationComponent.onGameCancelled"),e.messageDisplayer.infoMessage($localize`The game has been canceled!`),yield e.router.navigate(["/lobby"])})()}isGameStarted(){return uw.getNonNullable(this.currentJoiner).partStatus===zY.PART_STARTED.value}onGameStarted(){const e=uw.getNonNullable(this.currentJoiner);hw(zee.VERBOSE,{partCreationComponent_onGameStarted:{joiner:e}}),this.gameStartNotification.emit(e),this.gameStarted=!0,hw(zee.VERBOSE,"PartCreationComponent.onGameStarted finished")}observeNeededPlayers(){var e=this;return lw(function*(){const t=uw.getNonNullable(e.currentJoiner),n=e.connectedUserService.user.get().id;hw(zee.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:t}}),e.allUserInterval=gw.of(window.setInterval(lw(function*(){const t=uw.getNonNullable(e.currentJoiner),r=e.lastToken;n===t.creator.id?yield e.checkCandidatesTokensFreshness(r):yield e.checkCreatorTokenFreshness(r)}),zee.TOKEN_INTERVAL))})()}checkCreatorTokenFreshness(e){var t=this;return lw(function*(){const n=uw.getNonNullable(t.currentJoiner);(yield t.didUserTimeout(n.creator.id,e))&&(yield t.destroyDocIfPartDidNotStart())})()}destroyDocIfPartDidNotStart(){var e=this;return lw(function*(){VG(!1==(uw.getNonNullable(e.currentJoiner).partStatus===zY.PART_STARTED.value),"Should not try to cancelGameCreation when part started!"),VG(!1===e.allDocDeleted,"Should not delete doc twice"),yield e.cancelGameCreation()})()}checkCandidatesTokensFreshness(e){var t=this;return lw(function*(){const n=uw.getNonNullable(t.currentJoiner);for(const r of n.candidates)(yield t.didUserTimeout(r.id,e))&&(yield t.removeCandidateFromLobby(r.id))})()}didUserTimeout(e,t){var n=this;return lw(function*(){const r=yield n.userService.getUserLastChanged(e);return r.isAbsent()?(UG.logError("PartCreationComponent","found no user while observing "+e+" !"),!0):Cee(r.get(),t)>zee.TOKEN_TIMEOUT})()}startSendingPresenceTokens(){var e=this;return lw(function*(){yield e.connectedUserService.sendPresenceToken(),VG(e.ownTokenInterval.isAbsent(),"should not start sending presence tokens twice"),e.ownTokenInterval=gw.of(window.setInterval(()=>{e.connectedUserService.sendPresenceToken()},zee.TOKEN_INTERVAL));const t=e.connectedUserService.user.get().id;e.selfSubscription=e.userService.observeUser(t,t=>{VG(t.isPresent(),"connected user should exist");const n=t.get();null!=n.last_changed&&(e.lastToken=n.last_changed)})})()}stopSendingPresenceTokensAndObservingUsersIfNeeded(){this.ownTokenInterval.isPresent()&&(window.clearInterval(this.ownTokenInterval.get()),this.ownTokenInterval=gw.empty()),this.allUserInterval.isPresent()&&window.clearInterval(this.allUserInterval.get()),this.selfSubscription()}removeCandidateFromLobby(e){var t=this;return lw(function*(){const n=uw.getNonNullable(t.currentJoiner);VG(-1!==n.candidates.findIndex(t=>t.id===e),"PartCreationComponent: attempting to remove a user not in the lobby");const r=n.candidates.filter(t=>t.id!==e);return n.chosenOpponent?.id===e?t.joinerService.reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(r):t.joinerService.updateCandidates(r)})()}acceptConfig(){var e=this;return lw(function*(){return hw(zee.VERBOSE,"PartCreationComponent.acceptConfig"),e.gameService.acceptConfig(e.partId,uw.getNonNullable(e.currentJoiner))})()}ngOnDestroy(){var e=this;return lw(function*(){hw(zee.VERBOSE,"PartCreationComponent.ngOnDestroy"),e.ngUnsubscribe.next(),e.ngUnsubscribe.complete(),e.stopSendingPresenceTokensAndObservingUsersIfNeeded(),e.gameExists&&e.joinerService.unsubscribe();const t=e.connectedUserService.user.get();if(!0!==e.gameStarted){if(null===e.currentJoiner)return void hw(zee.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here");t.id===e.currentJoiner.creator.id?(hw(zee.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),yield e.cancelGameCreation()):!1===e.allDocDeleted&&(hw(zee.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),yield e.connectedUserService.removeObservedPart(),yield e.joinerService.cancelJoining(t.toMinimalUser()))}})()}}function Hee(e,t){if(1&e){const e=ma();ha(0,"button",3),_a("click",function(){return Gt(e),wa().addTime()}),Hc(1,4),da()}if(2&e){const e=wa();Ts(1),Gc(e.timeToAdd),qc(1)}}zee.VERBOSE=!1,zee.TOKEN_INTERVAL=5e3,zee.TOKEN_TIMEOUT=2*zee.TOKEN_INTERVAL,zee.\u0275fac=function(e){return new(e||zee)(ca(Qv),ca(UY),ca(tK),ca(eK),ca(WG),ca(KG),ca(Eg),ca(BG))},zee.\u0275cmp=Xe({type:zee,selectors:[["app-part-creation"]],inputs:{partId:"partId"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,v,_,C,E,w,b,S,P,O,T,I,k,A,N,M,x,R,D;return e=$localize`Game creation`,t=$localize`First player`,n=$localize`Random`,r=$localize`You`,i=$localize`Game type`,s=$localize`Standard`,o=$localize`Maximal turn duration: `,a=$localize`Maximal game duration: ${"\ufffd#37\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#37\ufffd"}:CLOSE_TAG_STRONG:`,c=$localize`Blitz`,l=$localize`Maximal turn duration: `,u=$localize`Maximal game duration: ${"\ufffd#55\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#55\ufffd"}:CLOSE_TAG_STRONG:`,h=$localize`Custom`,d=$localize`Opponents`,f=$localize`Propose configuration`,p=$localize`Cancel game`,g=$localize`The opponent`,m=$localize`Maximal turn duration: `,y=$localize`Maximal game duration: ${"\ufffd#13\ufffd"}:START_TAG_OUTPUT:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#13\ufffd"}:CLOSE_TAG_OUTPUT:`,v=$localize`Potential opponents that join the game will appear here.${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:LINE_BREAK:Wait for an opponent to join, so that you can pick one.`,_=$localize`Click on the opponent against which you would like to play.`,C=$localize`Name`,E=$localize`Actions`,w=$localize`Pick`,b=$localize`Change configuration`,S=$localize`Configuration proposal`,P=$localize`You have been selected as the opponent.${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:LINE_BREAK: ${"\ufffd0\ufffd"}:INTERPOLATION: is modifying the configuration.`,O=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: proposes to play a ${"\ufffd1\ufffd"}:INTERPOLATION_1: game`,T=$localize`a turn lasts at most ${"\ufffd#10\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#10\ufffd"}:CLOSE_TAG_STRONG:`,I=$localize`the game lasts at most ${"\ufffd#14\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#14\ufffd"}:CLOSE_TAG_STRONG:`,k=$localize`Accept and start`,A=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: plays first`,N=$localize`you play first`,M=$localize`the first player is selected randomly`,x=$localize`One moment...`,R=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: is configuring the game.`,D=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has proposed a configuration to ${"\ufffd1\ufffd"}:INTERPOLATION_1:.`,[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],e,[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],t,[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],n,["id","firstPlayerCreator",1,"button",3,"ngClass","click"],r,["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],i,["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],s,["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],o,a,["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],c,l,u,["id","partTypeCustom",1,"button",3,"ngClass","click"],h,["id","customTime",4,"ngIf"],[1,"label"],d,[1,"control"],["chooseOpponent",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],f,["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],p,g,["id","customTime"],["for","maximalMoveDuration",1,"label"],m,["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],y,["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],v,_,["id","chooseOpponent",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],C,E,[3,"id","ngClass","click",4,"ngFor","ngForOf"],[3,"id","ngClass","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],w,["id","reviewConfig",1,"button",3,"click"],b,[1,"message","is-primary"],[1,"message-header"],S,[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],P,O,T,I,["id","acceptConfig",1,"button","is-primary",3,"click"],k,A,N,M,x,["proposalSent",""],R,D]},template:function(e,t){1&e&&oa(0,$ee,4,3,"div",0),2&e&&la("ngIf",t.viewInfo)},directives:[$d,Jp,_p,rg,Fd,zf,eg,vp,sg,Ud],pipes:[wee],encapsulation:2});let Gee=(()=>{class e{constructor(){this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new vu,this.addTimeToOpponent=new vu,this.cssClasses=e.SAFE_TIME}ngOnInit(){hw(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}setDuration(t){if(hw(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}changeDuration(e){let t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}displayDuration(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}start(){if(hw(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}resume(){if(hw(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();const t=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(()=>{this.onEndReached()},t),this.countSeconds()}onEndReached(){hw(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}countSeconds(){this.timeoutHandleSec=window.setTimeout(()=>{this.updateShownTime()},1e3)}isIdle(){return!1===this.started||this.isPaused}pause(){if(hw(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}stop(){if(hw(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}isStarted(){return this.started}getTimeClass(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}updateShownTime(){const e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}clearTimeouts(){hw(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(window.clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(window.clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}addTime(){this.addTimeToOpponent.emit()}ngOnDestroy(){this.clearTimeouts()}}return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){let e;return e=$localize`Add ${"\ufffd0\ufffd"}:INTERPOLATION:`,[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],e]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"p",1),Da(2),fu(3,"number"),da(),oa(4,Hee,2,1,"button",2),da()),2&e&&(la("ngClass",t.getTimeClass()),Ts(2),Ba("",t.displayedMinute,":",function(e,t,n,r){const i=e+20,s=zt(),o=xt(s,i);return mu(s,gu(s,i)?du(s,Xt(),t,o.transform,n,r,o):o.transform(n,r))}(3,4,t.displayedSec,"2.0-0"),""),Ts(2),la("ngIf",t.canAddTime))},directives:[Fd,$d],pipes:[Gd],encapsulation:2}),e})();const qee=["partCreation"],Wee=["chatComponent"],jee=["chronoZeroGlobal"],Zee=["chronoOneGlobal"],Yee=["chronoZeroTurn"],Kee=["chronoOneTurn"];function Jee(e,t){if(1&e){const e=ma();ha(0,"app-part-creation",5,6),_a("gameStartNotification",function(t){return Gt(e),wa().startGame(t)}),da()}2&e&&la("partId",wa().currentPartId)}function Qee(e,t){1&e&&(pa(0),Hc(1,40),ga())}function Xee(e,t){if(1&e&&(pa(0),Hc(1,41),ga()),2&e){const e=wa(4);Ts(1),Gc(e.currentPlayer),qc(1)}}function ete(e,t){if(1&e&&(ha(0,"p",37),oa(1,Qee,2,0,"ng-container",38),oa(2,Xee,2,1,"ng-template",null,39,Ru),da()),2&e){const e=aa(3),t=wa(3);Ts(1),la("ngIf",t.currentPlayer===t.getPlayerName())("ngIfElse",e)}}function tte(e,t){if(1&e&&(ha(0,"div",33),ha(1,"p",34),Hc(2,35),da(),oa(3,ete,4,2,"p",36),da()),2&e){const e=wa(2);Ts(2),Gc(e.currentPart.getTurn()+1),qc(2),Ts(1),la("ngIf",!1===e.endGame)}}function nte(e,t){if(1&e&&(ha(0,"p",42),Da(1),da()),2&e){const e=wa(2);la("ngClass",e.getPlayerNameClass(0)),Ts(1),La(e.players[0].get())}}function rte(e,t){if(1&e&&(ha(0,"p",43),Hc(1,44),da()),2&e){const e=wa(2);Ts(1),Gc(e.gameComponent.scores.get()[0]),qc(1)}}function ite(e,t){if(1&e&&(ha(0,"p",45),Da(1),da()),2&e){const e=wa(2);la("ngClass",e.getPlayerNameClass(1)),Ts(1),La(e.players[1].get())}}function ste(e,t){if(1&e&&(ha(0,"p",46),Hc(1,47),da()),2&e){const e=wa(2);Ts(1),Gc(e.gameComponent.scores.get()[1]),qc(1)}}function ote(e,t){if(1&e){const e=ma();ha(0,"button",56),_a("click",function(){return Gt(e),wa(3).resign()}),Hc(1,57),da()}}function ate(e,t){if(1&e){const e=ma();ha(0,"button",58),_a("click",function(){return Gt(e),wa(3).proposeDraw()}),Hc(1,59),da()}}function cte(e,t){if(1&e){const e=ma();ha(0,"button",60),_a("click",function(){return Gt(e),wa(3).acceptDraw()}),Hc(1,61),da()}}function lte(e,t){if(1&e){const e=ma();ha(0,"button",62),_a("click",function(){return Gt(e),wa(3).refuseDraw()}),Hc(1,63),da()}}function ute(e,t){if(1&e){const e=ma();ha(0,"button",64),_a("click",function(){return Gt(e),wa(3).gameComponent.pass()}),Hc(1,65),da()}}function hte(e,t){if(1&e){const e=ma();ha(0,"button",66),_a("click",function(){return Gt(e),wa(3).acceptTakeBack()}),Hc(1,67),da()}}function dte(e,t){if(1&e){const e=ma();ha(0,"button",68),_a("click",function(){return Gt(e),wa(3).refuseTakeBack()}),Hc(1,69),da()}}function fte(e,t){if(1&e){const e=ma();ha(0,"button",70),_a("click",function(){return Gt(e),wa(3).askTakeBack()}),Hc(1,71),da()}}function pte(e,t){if(1&e&&(pa(0),oa(1,ote,2,0,"button",48),oa(2,ate,2,0,"button",49),oa(3,cte,2,0,"button",50),oa(4,lte,2,0,"button",51),oa(5,ute,2,0,"button",52),oa(6,hte,2,0,"button",53),oa(7,dte,2,0,"button",54),oa(8,fte,2,0,"button",55),ga()),2&e){const e=wa(2);Ts(1),la("ngIf",e.canResign()),Ts(1),la("ngIf",e.canProposeDraw()),Ts(1),la("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),la("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),la("ngIf",!1===e.endGame&&e.isPlaying()&&e.gameComponent.canPass&&e.currentPlayer===e.getPlayerName()),Ts(1),la("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),la("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),la("ngIf",!1===e.endGame&&!1===e.isOpponentWaitingForTakeBackResponse()&&e.canAskTakeBack())}}function gte(e,t){1&e&&(ha(0,"div"),ha(1,"p",73),Hc(2,74),da(),da())}function mte(e,t){1&e&&(ha(0,"p",78),Hc(1,79),da())}function yte(e,t){1&e&&(ha(0,"p",80),Hc(1,81),da())}function vte(e,t){1&e&&(ha(0,"p",82),Hc(1,83),da())}function _te(e,t){if(1&e&&(ha(0,"div"),oa(1,mte,2,0,"p",75),oa(2,yte,2,0,"p",76),oa(3,vte,2,0,"p",77),da()),2&e){const e=wa(3);Ts(1),la("ngIf",e.currentPart.getDrawAccepter()===e.getPlayerName()),Ts(1),la("ngIf",e.currentPart.getDrawAccepter()!==e.getPlayerName()&&e.isPlaying()),Ts(1),la("ngIf",!1===e.isPlaying())}}function Cte(e,t){1&e&&(ha(0,"p",86),Hc(1,87),da())}function Ete(e,t){1&e&&(ha(0,"p",88),Hc(1,89),da())}function wte(e,t){if(1&e&&(ha(0,"p",88),Hc(1,90),da()),2&e){const e=wa(4);Ts(1),Gc(e.currentPart.getWinner().get()),qc(1)}}function bte(e,t){if(1&e&&(ha(0,"div"),oa(1,Cte,2,0,"p",84),oa(2,Ete,2,0,"p",85),oa(3,wte,2,1,"p",85),da()),2&e){const e=wa(3);Ts(1),la("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),la("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),la("ngIf",!1===e.isPlaying())}}function Ste(e,t){if(1&e&&(ha(0,"p",86),Hc(1,91),da()),2&e){const e=wa(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function Pte(e,t){1&e&&(ha(0,"p",88),Hc(1,92),da())}function Ote(e,t){if(1&e&&(ha(0,"p",88),Hc(1,93),da()),2&e){const e=wa(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function Tte(e,t){if(1&e&&(ha(0,"div"),oa(1,Ste,2,1,"p",84),oa(2,Pte,2,0,"p",85),oa(3,Ote,2,1,"p",85),da()),2&e){const e=wa(3);Ts(1),la("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),la("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),la("ngIf",!1===e.isPlaying())}}function Ite(e,t){1&e&&(ha(0,"p",95),Hc(1,96),da())}function kte(e,t){if(1&e&&(ha(0,"p",95),Hc(1,97),da()),2&e){const e=wa(4);Ts(1),Gc(e.currentPart.getLoser().get()),qc(1)}}function Ate(e,t){if(1&e&&(ha(0,"div"),oa(1,Ite,2,0,"p",94),oa(2,kte,2,1,"p",94),da()),2&e){const e=wa(3);Ts(1),la("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),la("ngIf",!1===e.isPlaying()||e.currentPart.getWinner().get()===e.getPlayerName())}}function Nte(e,t){if(1&e&&(ha(0,"div",72),fa(1,"hr"),oa(2,gte,3,0,"div",26),oa(3,_te,4,3,"div",26),oa(4,bte,4,3,"div",26),oa(5,Tte,4,3,"div",26),oa(6,Ate,3,2,"div",26),da()),2&e){const e=wa(2);Ts(2),la("ngIf",e.currentPart.isHardDraw()),Ts(1),la("ngIf",e.currentPart.isAgreedDraw()),Ts(1),la("ngIf",e.currentPart.isWin()),Ts(1),la("ngIf",e.currentPart.isTimeout()),Ts(1),la("ngIf",e.currentPart.isResign())}}function Mte(e,t){1&e&&(ha(0,"button",98),Hc(1,99),da())}function xte(e,t){if(1&e){const e=ma();ha(0,"button",100),_a("click",function(){return Gt(e),wa(2).proposeRematch()}),Hc(1,101),da()}}function Rte(e,t){if(1&e){const e=ma();ha(0,"button",102),_a("click",function(){return Gt(e),wa(2).acceptRematch()}),Hc(1,103),da()}}function Dte(e,t){if(1&e){const e=ma();ha(0,"div",7),ha(1,"div",8),ha(2,"div",9),oa(3,tte,4,2,"div",10),ha(4,"div",11),oa(5,nte,2,2,"p",12),oa(6,rte,2,1,"p",13),ha(7,"app-count-down",14,15),_a("outOfTimeAction",function(){return Gt(e),wa().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),wa().addGlobalTime()}),da(),ha(9,"app-count-down",16,17),_a("outOfTimeAction",function(){return Gt(e),wa().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),wa().addTurnTime()}),da(),da(),ha(11,"p",18),Hc(12,19),da(),ha(13,"div",11),oa(14,ite,2,2,"p",20),oa(15,ste,2,1,"p",21),ha(16,"app-count-down",22,23),_a("outOfTimeAction",function(){return Gt(e),wa().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),wa().addGlobalTime()}),da(),ha(18,"app-count-down",24,25),_a("outOfTimeAction",function(){return Gt(e),wa().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),wa().addTurnTime()}),da(),da(),fa(20,"hr"),oa(21,pte,9,8,"ng-container",26),oa(22,Nte,7,5,"div",27),oa(23,Mte,2,0,"button",28),oa(24,xte,2,0,"button",29),oa(25,Rte,2,0,"button",30),da(),da(),ha(26,"div",31),ha(27,"div",32),fa(28,"app-game-includer"),da(),da(),da()}if(2&e){const e=wa();Ts(3),la("ngIf",e.currentPart),Ts(2),la("ngIf",e.players[0].isPresent()),Ts(1),la("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),la("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),la("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(5),la("ngIf",e.players[1].isPresent()),Ts(1),la("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),la("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),la("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(3),la("ngIf",e.isPlaying()),Ts(1),la("ngIf",e.endGame),Ts(1),la("ngIf",e.endGame),Ts(1),la("ngIf",e.endGame&&e.isPlaying()&&!1===e.rematchProposed),Ts(1),la("ngIf",e.endGame&&e.isPlaying()&&e.rematchProposed&&e.opponentProposedRematch),Ts(1),la("ngClass",e.getBoardHighlight())}}class Lte{constructor(e){this.value=e}}Lte.PRE_START_DOC=new Lte("PRE_START_DOC"),Lte.STARTING_DOC=new Lte("STARTING_DOC"),Lte.DUPLICATE=new Lte("DUPLICATE"),Lte.MOVE_WITHOUT_TIME=new Lte("MOVE_WITHOUT_TIME"),Lte.MOVE=new Lte("MOVE"),Lte.REQUEST=new Lte("REQUEST"),Lte.END_GAME=new Lte("END_GAME"),Lte.END_GAME_WITHOUT_TIME=new Lte("END_GAME_WITHOUT_TIME"),Lte.ACCEPT_TAKE_BACK_WITHOUT_TIME=new Lte("ACCEPT_TAKE_BACK_WITHOUT_TIME");let Fte=(()=>{class e extends yee{constructor(t,n,r,i,s,o){super(t,n,r),this.connectedUserService=r,this.router=i,this.userService=s,this.gameService=o,this.gameStarted=!1,this.opponent=null,this.rematchProposed=!1,this.opponentProposedRematch=!1,this.hasUserPlayed=[!1,!1],this.msToSubstract=[0,0],this.opponentSubscription=gw.empty(),this.OFFLINE_FONT_COLOR={color:"lightgrey"},this.globalTimeMessage=$localize`5 minutes`,this.turnTimeMessage=$localize`30 seconds`,hw(e.VERBOSE,"OnlineGameWrapperComponent constructed")}extractPartIdFromURL(){return uw.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}extractGameTypeFromURL(){return uw.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}isPlaying(){return this.observerRole===jY.ZERO.value||this.observerRole===jY.ONE.value}getPlayer(){return jY.of(this.observerRole)}getPlayerName(){return uw.getNonNullable(this.authUser.username.get())}isPlayer(e){return this.observerRole===e.value}isOpponent(e){return this.observerRole!==e.value}redirectIfPartIsInvalid(){var e=this;return lw(function*(){const t=e.extractGameTypeFromURL();if((yield e.gameService.getPartValidity(e.currentPartId,t)).isFailure()){const t="/notFound";e.routerEventsSub.unsubscribe(),yield e.router.navigate([t])}})()}setCurrentPartIdOrRedirect(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartIsInvalid()}ngOnInit(){var t=this;return lw(function*(){hw(e.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),t.routerEventsSub=t.router.events.subscribe(function(){var e=lw(function*(e){e instanceof Sm&&(yield t.setCurrentPartIdOrRedirect())});return function(t){return e.apply(this,arguments)}}()),t.userSub=t.connectedUserService.getUserObs().subscribe(e=>{t.authUser=e}),yield t.setCurrentPartIdOrRedirect()})()}startGame(t){var n=this;return lw(function*(){hw(e.VERBOSE,"OnlineGameWrapperComponent.startGame"),VG(!1===n.gameStarted,"Should not start already started game"),n.joiner=t,n.gameStarted=!0,window.setTimeout(()=>{n.afterGameIncluderViewInit(),n.startPart()},1)})()}startPart(){var t=this;hw(e.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,function(){var e=lw(function*(e){VG(e.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),yield t.onCurrentPartUpdate(e.get())});return function(t){return e.apply(this,arguments)}}())}onCurrentPartUpdate(t){var n=this;return lw(function*(){const r=new zG(n.currentPartId,t);hw(e.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:n.currentPart,then:t.data,before_part_turn:r.data.turn,before_state_turn:n.gameComponent.rules.node.gameState.turn,nbPlayedMoves:r.data.listMoves.length}});const i=n.getUpdateType(r),s=t.turn;hw(e.VERBOSE,i===Lte.REQUEST?"UpdateType: Request("+uw.getNonNullable(r.data.request).code+") ("+s+")":"UpdateType: "+i.value+"("+s+")");const o=n.currentPart;switch(n.currentPart=r,i){case Lte.REQUEST:return yield n.onRequest(uw.getNonNullable(r.data.request),o);case Lte.ACCEPT_TAKE_BACK_WITHOUT_TIME:return void(n.currentPart=o);case Lte.DUPLICATE:return;case Lte.END_GAME_WITHOUT_TIME:return void(n.currentPart=o);case Lte.END_GAME:return n.applyEndGame();case Lte.MOVE_WITHOUT_TIME:return void(n.currentPart=o);case Lte.MOVE:return n.msToSubstract=n.getLastUpdateTime(o,r,i),n.doNewMoves(r);case Lte.PRE_START_DOC:const e=null==n.currentPart||null!=n.currentPart.data.beginning;return void VG(null==o||null==o.data.beginning||e,"old part had no beginning time or new part has, we did not expect this!");default:return VG(i===Lte.STARTING_DOC,"Unexpected update type "+i),n.setChronos(),n.setPlayersDatas(r),n.startCountDownFor(jY.ZERO)}})()}getUpdateType(t){const n=vee.from(null!=this.currentPart?this.currentPart.data:null,t.data);hw(e.VERBOSE,{diff:n});const r=n.countChanges();if(0===r)return Lte.DUPLICATE;if(t.data.request){const e=null!=n.removed.lastUpdateTime;return"TakeBackAccepted"===t.data.request.code&&e?Lte.ACCEPT_TAKE_BACK_WITHOUT_TIME:Lte.REQUEST}if(this.isMove(n,r))return 1===t.data.turn?null==t.data.lastUpdateTime?Lte.MOVE_WITHOUT_TIME:Lte.MOVE:null==n.modified.lastUpdateTime?Lte.MOVE_WITHOUT_TIME:Lte.MOVE;if(null==t.data.beginning)return Lte.PRE_START_DOC;if(t.data.result!==$G.UNACHIEVED.value){const e=null==n.modified.lastUpdateTime;return null!=n.modified.turn&&e?Lte.END_GAME_WITHOUT_TIME:Lte.END_GAME}return VG(null!=t.data.beginning&&0===t.data.listMoves.length,"Unexpected update: "+JSON.stringify(n)),Lte.STARTING_DOC}isMove(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){const n=3;return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+n}return!1}getLastUpdateTime(e,t,n){const r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);VG(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),VG(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");const s=jY.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(uw.getNonNullable(r),uw.getNonNullable(i),n,s)}getMoreRecentTime(e){return e.data.lastUpdateTime??e.data.beginning}getTimeUsedForLastTurn(e,t,n,r){const i=Cee(e,t),s=[0,0];return s[r.value]=i,s}setChronos(){hw(e.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}didUserPlay(e){return this.hasUserPlayed[e.value]}doNewMoves(e){this.switchPlayer();const t=QY.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;for(;n.node.gameState.turn<t.length;){const e=n.node.gameState.turn,r=this.gameComponent.encoder.decode(t[e]),i=n.isLegal(r,n.node.gameState),s="We received an incorrect db move: "+r.toString()+" in "+t+" at turn "+e+'because "'+i.getReasonOr("")+'"';VG(i.isSuccess(),s),n.choose(r)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}switchPlayer(){hw(e.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");const t=jY.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();const n=t.getOpponent();this.didUserPlay(n)&&this.pauseCountDownsFor(n),this.didUserPlay(t)?(hw(e.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(t)):this.startCountDownFor(t)}resetChronoFor(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}applyEndGame(){const t=this.currentPart,n=jY.fromTurn(t.data.turn);this.endGame=!0,[$G.VICTORY,$G.HARD_DRAW].some(e=>e.value===t.data.result)?this.doNewMoves(this.currentPart):(VG(!0===[$G.RESIGN,$G.TIMEOUT,$G.HARD_DRAW,$G.AGREED_DRAW_BY_ZERO,$G.AGREED_DRAW_BY_ONE].some(e=>e.value===t.data.result),"Unknown type of end game ("+t.data.result+")"),hw(e.VERBOSE,"endGame est true et winner est "+t.getWinner())),this.stopCountdownsFor(n)}notifyDraw(e,t){this.endGame=!0;const n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}notifyTimeoutVictory(e,t,n,r){var i=this;return lw(function*(){i.endGame=!0;const s=i.currentPart.setWinnerAndLoser(e,r);i.currentPart=s,yield i.gameService.notifyTimeout(i.currentPartId,t,n,e,r)})()}notifyVictory(t,n){hw(e.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");const r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===PQ.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(VG(r===PQ.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;const i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,t,[0,0],n,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}canAskTakeBack(){return VG(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===ZY.NONE}isOpponentWaitingForTakeBackResponse(){const e=this.getTakeBackRequester();return!!e.isPlayer()&&this.isOpponent(e)}getTakeBackRequester(){if(null==this.currentPart)return ZY.NONE;const e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?YY.getPlayer(e):ZY.NONE}canProposeDraw(){return VG(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&YY.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===ZY.NONE}isOpponentWaitingForDrawResponse(){const e=this.getDrawRequester();return e!==ZY.NONE&&this.isOpponent(e)}getDrawRequester(){if(null==this.currentPart)return ZY.NONE;const e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?YY.getPlayer(e):ZY.NONE}onRequest(t,n){var r=this;return lw(function*(){switch(hw(e.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:t,oldPart:n}),t.code){case"TakeBackAsked":case"TakeBackRefused":break;case"TakeBackAccepted":r.takeBackTo(r.currentPart.data.turn);break;case"RematchProposed":r.rematchProposed=!0;const n=YY.getPlayer(t).getOpponent();r.isPlayer(n)&&(hw(e.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0);break;case"RematchAccepted":yield r.router.navigate(["/nextGameLoading"]),yield r.router.navigate(["/play",YY.getTypeGame(t),YY.getPartId(t)]);break;case"DrawProposed":case"DrawRefused":break;case"AddTurnTime":const i=3e4,s=jY.of(t.data.player);r.addTurnTimeTo(s,i);break;case"AddGlobalTime":const o=3e5,a=jY.of(t.data.player);r.addGlobalTimeTo(a,o);break;default:uw.expectToBe(t.code,"DrawAccepted","Unknown RequestType : "+t.code+" for "+JSON.stringify(t)),yield r.acceptDraw()}})()}takeBackTo(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();const t=jY.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}setPlayersDatas(t){hw(e.VERBOSE,{OnlineGameWrapper_setPlayersDatas:t}),this.players=[gw.of(t.data.playerZero),gw.ofNullable(t.data.playerOne)],VG(null!=t.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[t.data.turn%2].get();let n=gw.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=jY.ZERO.value,n=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=jY.ONE.value,n=this.players[0]):this.observerRole=ZY.NONE.value,n.isPresent()){const e=e=>{this.opponent=e[0].data},t=new jG(e,e,e=>{throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))}),r=this.userService.observeUserByUsername(n.get(),t);this.opponentSubscription=gw.of(r)}}onLegalUserMove(t,n){var r=this;return lw(function*(){if(hw(e.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),!r.isOpponentWaitingForTakeBackResponse())return r.updateDBBoard(t,r.msToSubstract,n);r.gameComponent.message("You must answer to take back request")})()}updateDBBoard(t,n,r){var i=this;return lw(function*(){const s=i.gameComponent.encoder.encodeMove(t);hw(e.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+t.toString()+", "+r+")"),i.gameComponent.rules.choose(t);const o=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node);if(o.isEndGame)return o===PQ.DRAW?i.notifyDraw(s,r):i.notifyVictory(s,r);{const e=i.getPlayer();return i.gameService.updateDBBoard(i.currentPartId,e,s,n,r)}})()}resign(){var e=this;return lw(function*(){const t=e.getLastIndex(),n=e.getPlayer(),r=e.players[e.observerRole%2].get(),i=e.players[(e.observerRole+1)%2].get();yield e.gameService.resign(e.currentPartId,t,n,i,r)})()}getLastIndex(){return this.currentPart.data.lastUpdate.index}reachedOutOfTime(t){var n=this;return lw(function*(){hw(e.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+t+")");const r=n.getLastIndex(),i=n.getPlayer();n.stopCountdownsFor(jY.of(t));const s=uw.getNonNullable(n.opponent);if(t===n.observerRole){const e=uw.getNonNullable(s.username);yield n.notifyTimeoutVictory(e,i,r,n.getPlayerName())}else if(VG(!1===n.endGame,"time might be better handled in the future"),n.opponentIsOffline()){const e=uw.getNonNullable(s.username);yield n.notifyTimeoutVictory(n.getPlayerName(),i,t,e),n.endGame=!0}})()}acceptRematch(){var e=this;return lw(function*(){VG(e.isPlaying(),"Non playing should not call acceptRematch");const t=new zG(e.currentPartId,e.currentPart.data);return yield e.gameService.acceptRematch(t,e.getLastIndex(),e.getPlayer()),!0})()}proposeRematch(){var e=this;return lw(function*(){return VG(e.isPlaying(),"Non playing should not call proposeRematch"),yield e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer()),!0})()}proposeDraw(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptDraw(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}refuseDraw(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}askTakeBack(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptTakeBack(){var e=this;return lw(function*(){const t=e.getPlayer();yield e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,t,e.msToSubstract),e.msToSubstract=[0,0]})()}refuseTakeBack(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}startCountDownFor(t){hw(e.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[t.value]=!0,t===jY.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}resumeCountDownFor(t,n=!0){let r;hw(e.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===jY.ZERO?(this.chronoZeroGlobal.changeDuration(uw.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),r=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(uw.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),r=this.chronoOneTurn),n?(r.setDuration(1e3*this.joiner.maximalMoveDuration),r.start()):r.resume()}pauseCountDownsFor(t,n=!0){let r;hw(e.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+t.value+") (turn "+this.currentPart.data.turn+")"),t===jY.ZERO?(this.chronoZeroGlobal.pause(),r=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),r=this.chronoOneTurn),n?r.stop():r.pause()}stopCountdownsFor(t){hw(e.VERBOSE,"cdc::stopCountDownsFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===jY.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}getPlayerNameClass(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}opponentIsOffline(){return!1}canResign(){return VG(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}addGlobalTime(){const e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}addTurnTime(){const e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}addTurnTimeTo(e,t){const n=jY.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===jY.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}addGlobalTimeTo(e,t){e===jY.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}ngOnDestroy(){this.routerEventsSub.unsubscribe(),this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(rl),ca(Ay),ca(UY),ca(Qv),ca(KG),ca(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){if(1&e&&(Nu(qee,5),Nu(Wee,5),Nu(jee,5),Nu(Zee,5),Nu(Yee,5),Nu(Kee,5)),2&e){let e;Au(e=Mu())&&(t.partCreation=e.first),Au(e=Mu())&&(t.chatComponent=e.first),Au(e=Mu())&&(t.chronoZeroGlobal=e.first),Au(e=Mu())&&(t.chronoOneGlobal=e.first),Au(e=Mu())&&(t.chronoZeroTurn=e.first),Au(e=Mu())&&(t.chronoOneTurn=e.first)}},features:[Ho],decls:5,vars:4,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,v,_,C,E,w,b,S,P,O,T,I;return e=$localize`vs.`,t=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,n=$localize`It is your turn.`,r=$localize`It is ${"\ufffd0\ufffd"}:INTERPOLATION:'s turn.`,i=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Resign`,a=$localize`Propose a draw`,c=$localize`Accept draw`,l=$localize`Reject draw`,u=$localize`Pass a turn`,h=$localize`Accept take back`,d=$localize`Reject take back`,f=$localize`Ask to take back one move`,p=$localize`Draw`,g=$localize`You agreed to draw.`,m=$localize`Your draw proposal has been accepted.`,y=$localize`Players agreed to draw.`,v=$localize`You won.`,_=$localize`You lost.`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won.`,E=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit. You won.`,w=$localize`You reached your time limit.`,b=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit.`,S=$localize`You resigned.`,P=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has resigned.`,O=$localize`Go back to the game list`,T=$localize`Propose to play again`,I=$localize`Accept to play again`,[["id","partCreation",3,"partId","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],e,["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],t,["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],n,r,["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],i,["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],s,["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],o,["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],a,["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],c,["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],l,["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],u,["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],h,["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],d,["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],f,["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],p,["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],g,["id","yourOpponentAgreedToDrawIndicator",1,"title"],m,["id","playersAgreedToDraw",1,"title"],y,["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],v,[1,"title"],_,C,E,w,b,["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],S,P,["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],O,["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],T,["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],I]},template:function(e,t){1&e&&(oa(0,Jee,2,1,"app-part-creation",0),oa(1,Dte,29,27,"div",1),ha(2,"div",2),ha(3,"div",3),fa(4,"app-chat",4),da(),da()),2&e&&(la("ngIf",!1===t.gameStarted),Ts(1),la("ngIf",t.gameStarted),Ts(3),la("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[$d,ree,zee,Gee,Fd,gee,e_],encapsulation:2}),e})();function Bte(e,t){if(1&e&&(ha(0,"option",25),Da(1),da()),2&e){const e=t.$implicit;la("value",e.name),Ts(1),La(e.name)}}function Ute(e,t){if(1&e&&(ha(0,"option",25),Hc(1,29),da()),2&e){const e=t.$implicit;la("value",e),Ts(1),Gc(e),qc(1)}}const Vte=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function $te(e,t){if(1&e){const e=ma();ha(0,"select",26),_a("ngModelChange",function(t){return Gt(e),wa(2).aiDepths[0]=t})("change",function(){return Gt(e),wa(2).updatePlayer(0)}),ha(1,"option",27),Hc(2,28),da(),oa(3,Ute,2,2,"option",16),da()}2&e&&(la("ngModel",wa(2).aiDepths[0]),Ts(3),la("ngForOf",ou(2,Vte)))}function zte(e,t){if(1&e&&(ha(0,"p",30),Hc(1,31),da()),2&e){const e=wa(2);Ts(1),Gc(e.gameComponent.scores.get()[0]),qc(1)}}function Hte(e,t){if(1&e&&(ha(0,"option",25),Da(1),da()),2&e){const e=t.$implicit;la("value",e.name),Ts(1),La(e.name)}}function Gte(e,t){if(1&e&&(ha(0,"option",25),Hc(1,34),da()),2&e){const e=t.$implicit;la("value",e),Ts(1),Gc(e),qc(1)}}function qte(e,t){if(1&e){const e=ma();ha(0,"select",32),_a("ngModelChange",function(t){return Gt(e),wa(2).aiDepths[1]=t})("change",function(){return Gt(e),wa(2).updatePlayer(1)}),ha(1,"option",27),Hc(2,33),da(),oa(3,Gte,2,2,"option",16),da()}2&e&&(la("ngModel",wa(2).aiDepths[1]),Ts(3),la("ngForOf",ou(2,Vte)))}function Wte(e,t){if(1&e&&(ha(0,"p",35),Hc(1,36),da()),2&e){const e=wa(2);Ts(1),Gc(e.gameComponent.scores.get()[1]),qc(1)}}function jte(e,t){if(1&e&&(ha(0,"h4"),Hc(1,40),da()),2&e){const e=wa(3);Ts(1),Gc(e.winner.get()),qc(1)}}function Zte(e,t){1&e&&(ha(0,"h4",41),Hc(1,42),da())}function Yte(e,t){if(1&e&&(ha(0,"div",37),oa(1,jte,2,1,"h4",38),oa(2,Zte,2,0,"h4",39),da()),2&e){const e=wa(2);Ts(1),la("ngIf",e.winner.isPresent()),Ts(1),la("ngIf",e.winner.isAbsent())}}function Kte(e,t){if(1&e){const e=ma();ha(0,"div",6),ha(1,"div",7),ha(2,"p",8),Hc(3,9),da(),da(),ha(4,"div",10),ha(5,"div",11),ha(6,"div",12),ha(7,"select",13),_a("change",function(){return Gt(e),wa().updatePlayer(0)})("ngModelChange",function(t){return Gt(e),wa().playerSelection[0]=t}),ha(8,"option",14),Hc(9,15),da(),oa(10,Bte,2,2,"option",16),da(),da(),ha(11,"div",12),oa(12,$te,4,3,"select",17),da(),oa(13,zte,2,1,"p",18),da(),ha(14,"div",19),ha(15,"div",12),ha(16,"select",20),_a("change",function(){return Gt(e),wa().updatePlayer(1)})("ngModelChange",function(t){return Gt(e),wa().playerSelection[1]=t}),ha(17,"option",14),Hc(18,21),da(),oa(19,Hte,2,2,"option",16),da(),da(),ha(20,"div",12),oa(21,qte,4,3,"select",22),da(),oa(22,Wte,2,1,"p",23),da(),da(),oa(23,Yte,3,2,"div",24),da()}if(2&e){const e=wa();Ts(3),Gc(e.gameComponent.rules.node.gameState.turn+1),qc(3),Ts(4),la("ngModel",e.playerSelection[0]),Ts(3),la("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),la("ngIf",!1===e.players[0].equalsValue("human")),Ts(1),la("ngIf",e.gameComponent.scores.isPresent()),Ts(3),la("ngModel",e.playerSelection[1]),Ts(3),la("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),la("ngIf",!1===e.players[1].equalsValue("human")),Ts(1),la("ngIf",e.gameComponent.scores.isPresent()),Ts(1),la("ngIf",e.endGame)}}function Jte(e,t){if(1&e&&(pa(0),Da(1),fa(2,"br"),ga()),2&e){const e=t.$implicit,n=wa(3);Ts(1),Fa(" ",e.name+": "+e.getBoardValue(n.gameComponent.rules.node)," ")}}function Qte(e,t){if(1&e&&(pa(0),oa(1,Jte,3,1,"ng-container",48),Da(2),fa(3,"br"),Da(4),fa(5,"br"),ga()),2&e){const e=wa(2);Ts(1),la("ngForOf",e.gameComponent.availableMinimaxes),Ts(1),Fa(" Created ",e.getCreatedNodes()," nodes."),Ts(2),Fa(" Minimax time: ",e.getMinimaxTime(),"ms.")}}function Xte(e,t){if(1&e){const e=ma();ha(0,"button",49),_a("click",function(){return Gt(e),wa(2).gameComponent.pass()}),Hc(1,50),da()}}function ene(e,t){if(1&e){const e=ma();ha(0,"button",51),_a("click",function(){return Gt(e),wa(2).takeBack()}),Hc(1,52),da()}}function tne(e,t){if(1&e){const e=ma();ha(0,"div",43),oa(1,Qte,6,3,"ng-container",38),oa(2,Xte,2,0,"button",44),oa(3,ene,2,0,"button",45),ha(4,"button",46),_a("click",function(){return Gt(e),wa().restartGame()}),Hc(5,47),da(),da()}if(2&e){const e=wa();Ts(1),la("ngIf",e.gameComponent.rules.node.move),Ts(1),la("ngIf",!1===e.endGame&&e.gameComponent.canPass),Ts(1),la("ngIf",e.canTakeBack())}}let nne=(()=>{class e extends yee{constructor(t,n,r,i,s){super(t,n,i),this.cdr=r,this.connectedUserService=i,this.messageDisplayer=s,this.aiDepths=["0","0"],this.playerSelection=["human","human"],this.winner=gw.empty(),this.botTimeOut=1e3,this.players=[gw.of(this.playerSelection[0]),gw.of(this.playerSelection[1])],hw(e.VERBOSE,"LocalGameWrapper.constructor")}getCreatedNodes(){return bQ.createdNodes}getMinimaxTime(){return bQ.minimaxTime}ngAfterViewInit(){setTimeout(()=>{this.afterGameIncluderViewInit(),this.restartGame(),this.cdr.detectChanges()},1)}updatePlayer(e){this.players[e]=gw.of(this.playerSelection[e]),this.proposeAIToPlay()}onLegalUserMove(t){var n=this;return lw(function*(){hw(e.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),n.gameComponent.rules.choose(t),n.updateBoard(),n.proposeAIToPlay()})()}updateBoard(){this.gameComponent.updateBoard();const e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner.isPlayer()&&(this.winner=gw.of($localize`Player ${e.winner.value+1}`)))}proposeAIToPlay(){var e=this;const t=this.getPlayingAI();t.isPresent()&&window.setTimeout(lw(function*(){yield e.doAIMove(t.get())}),this.botTimeOut)}getPlayingAI(){if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return gw.empty();const e=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[e]?gw.empty():gw.ofNullable(this.gameComponent.availableMinimaxes.find(t=>this.players[e].equalsValue(t.name)))}doAIMove(e){var t=this;return lw(function*(){const n=t.gameComponent.rules;VG(n.getGameStatus(n.node)===PQ.ONGOING,"IA should not try to play when game is over!");const r=Number.parseInt(t.aiDepths[n.node.gameState.turn%2%2]),i=n.node.findBestMove(r,e,!0);return n.choose(i)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),DG.SUCCESS):(t.messageDisplayer.criticalMessage($localize`The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!`),UG.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:i.toString()}))})()}canTakeBack(){return this.gameComponent.rules.node.gameState.turn>0}takeBack(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}isAITurn(){return this.getPlayingAI().isPresent()}restartGame(){const e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new SQ(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=gw.empty(),this.proposeAIToPlay()}getPlayerName(){return"human"}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(rl),ca(Ay),ca(xl),ca(UY),ca(BG))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-wrapper"]],features:[Ho],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,t=$localize`Human`,n=$localize`Human`,r=$localize`Pick the level`,i=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Pick the level`,a=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,c=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,l=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won`,u=$localize`Draw`,h=$localize`Start a new game`,d=$localize`Pass a turn`,f=$localize`Take back move`,[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],e,["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],t,[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],n,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],r,i,["id","scoreOne",1,"block"],s,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],o,a,["id","scoreZero",1,"block"],c,["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],l,["id","draw"],u,[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],h,[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],d,["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],f]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"div",1),oa(2,Kte,24,10,"div",2),oa(3,tne,6,3,"div",3),da(),ha(4,"div",4),ha(5,"div",5),fa(6,"app-game-includer"),da(),da(),da()),2&e&&(Ts(2),la("ngIf",t.gameComponent),Ts(1),la("ngIf",t.gameComponent),Ts(1),la("ngClass",t.getBoardHighlight()))},directives:[$d,Fd,gee,cg,vp,Kp,lg,fg,Ud],encapsulation:2,changeDetection:0}),e})(),rne=(()=>{class e{}return e.STEP_FINISHED=()=>$localize`Step finished!`,e.INFORMATIONAL_STEP=()=>$localize`This step is not expecting any move from your part.`,e})();function ine(e,t){if(1&e&&(ha(0,"div",20),ha(1,"div",21),Hc(2,22),da(),ha(3,"div",23),Da(4),da(),da()),2&e){const e=wa();Ts(4),La(e.currentReason.get())}}function sne(e,t){if(1&e){const e=ma();ha(0,"button",24),_a("click",function(){return Gt(e),wa().retry()}),Hc(1,25),da()}}function one(e,t){1&e&&(pa(0),Hc(1,30),ga())}function ane(e,t){1&e&&(pa(0),Hc(1,31),ga())}function cne(e,t){if(1&e&&oa(0,ane,2,0,"ng-container",27),2&e){wa();const e=aa(5),t=wa();la("ngIf",t.stepFinished&&t.stepFinished[t.stepIndex])("ngIfElse",e)}}function lne(e,t){1&e&&(pa(0),Hc(1,32),ga())}function une(e,t){if(1&e){const e=ma();ha(0,"button",26),_a("click",function(){return Gt(e),wa().next()}),oa(1,one,2,0,"ng-container",27),oa(2,cne,1,2,"ng-template",null,28,Ru),oa(4,lne,2,0,"ng-template",null,29,Ru),da()}if(2&e){const e=aa(3),t=wa();Ts(1),la("ngIf",t.steps[t.stepIndex]&&t.steps[t.stepIndex].isInformation())("ngIfElse",e)}}function hne(e,t){if(1&e){const e=ma();ha(0,"button",33),_a("click",function(){return Gt(e),wa().start()}),Hc(1,34),da()}}function dne(e,t){if(1&e){const e=ma();ha(0,"button",35),_a("click",function(){return Gt(e),wa().playLocally()}),Hc(1,36),da()}}function fne(e,t){if(1&e){const e=ma();ha(0,"button",37),_a("click",function(){return Gt(e),wa().createGame()}),Hc(1,38),da()}}function pne(e,t){if(1&e){const e=ma();ha(0,"button",39),_a("click",function(){return Gt(e),wa().showSolution()}),Hc(1,40),da()}}function gne(e,t){if(1&e&&(pa(0),ha(1,"option",42),Da(2),da(),ga()),2&e){const e=wa(),t=e.index,n=e.$implicit;Ts(1),Pa("id","step_",t,""),la("value",t),Ts(1),La(n.title)}}function mne(e,t){1&e&&(pa(0),Da(1,"v "),ga())}function yne(e,t){1&e&&Da(0,"x ")}function vne(e,t){if(1&e&&(ha(0,"option",43),oa(1,mne,2,0,"ng-container",27),oa(2,yne,1,0,"ng-template",null,44,Ru),ha(4,"span",45),Da(5),da(),da()),2&e){const e=aa(3),t=wa(),n=t.index,r=t.$implicit,i=wa();la("value",n),Ts(1),la("ngIf",i.stepFinished[n])("ngIfElse",e),Ts(3),Pa("id","step_",n,""),Ts(1),La(r.title)}}function _ne(e,t){if(1&e&&(pa(0),oa(1,gne,3,3,"ng-container",27),oa(2,vne,6,5,"ng-template",null,41,Ru),ga()),2&e){const e=t.index,n=aa(3),r=wa();Ts(1),la("ngIf",e===r.stepIndex)("ngIfElse",n)}}let Cne=(()=>{class e extends yee{constructor(t,n,r,i,s){super(t,n,s),this.router=r,this.cdr=i,this.connectedUserService=s,this.COMPLETED_TUTORIAL_MESSAGE=$localize`Congratulations, you completed the tutorial.`,this.steps=[],this.successfulSteps=0,this.stepIndex=-1,this.currentMessage="",this.currentReason=gw.empty(),this.moveAttemptMade=!1,this.stepFinished=[],this.tutorialOver=!1,hw(e.VERBOSE,"TutorialGameWrapperComponent.constructor")}getNumberOfSteps(){return this.steps.length}getCurrentStepTitle(){return this.steps.length>0?this.steps[this.stepIndex].title:""}ngAfterViewInit(){hw(e.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),this.afterGameIncluderViewInit(),this.start()}start(){this.startTutorial(this.gameComponent.tutorial)}startTutorial(t){hw(e.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:t}}),this.steps=t,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}getCompletionArray(){return this.steps.map(()=>!1)}changeStep(e){this.showStep(Number.parseInt(e.target.value,10))}showStep(t){hw(e.VERBOSE,"tutorialGameWrapperComponent.showStep("+t+")"),this.moveAttemptMade=!1,this.stepFinished[t]=!1,this.updateSuccessCount(),this.stepIndex=t;const n=this.steps[this.stepIndex];this.currentMessage=n.instruction,this.currentReason=gw.empty(),this.gameComponent.rules.node=new SQ(n.state,gw.empty(),n.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}onLegalUserMove(t){var n=this;return lw(function*(){hw(e.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:t}});const r=n.steps[n.stepIndex];if(VG(n.gameComponent.rules.choose(t),"It should be impossible to call onLegalUserMove with an illegal move"),hw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),n.gameComponent.updateBoard(),n.moveAttemptMade=!0,r.isPredicate()){const e=n.gameComponent.rules.node.gameState,i=uw.getNonNullable(r.predicate)(t,e);i.isSuccess()?n.showStepSuccess(r.getSuccessMessage()):n.currentReason=gw.of(i.getReason())}else if(r.isAnyMove())hw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(r.getSuccessMessage());else{VG(r.isMove(),"cannot reach here with a click step");const i=r;i.acceptedMoves.some(e=>e.equals(t))?(hw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(i.getSuccessMessage())):(hw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),n.currentReason=gw.of(i.getFailureMessage()))}n.cdr.detectChanges()})()}retry(){hw(e.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}onUserClick(t){if(hw(e.VERBOSE,"tutorialGameWrapper.onUserClick("+t+")"),this.currentReason=gw.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return DG.failure(rne.STEP_FINISHED());const n=this.steps[this.stepIndex];return n.isClick()?(this.gameComponent.updateBoard(),uw.getNonNullable(n.acceptedClicks).some(e=>e===t)?this.showStepSuccess(n.getSuccessMessage()):this.currentMessage=n.getFailureMessage(),DG.SUCCESS):n.isMove()||n.isPredicate()||n.isAnyMove()?(window.setTimeout(()=>{this.cdr.detectChanges()},10),DG.SUCCESS):DG.failure(rne.INFORMATIONAL_STEP())}onCancelMove(t){hw(e.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+t+")"),void 0!==t&&(this.currentReason=gw.of(t)),this.cdr.detectChanges()}showStepSuccess(t){hw(e.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=t,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}updateSuccessCount(){let e=0;for(const t of this.stepFinished)t&&e++;this.successfulSteps=e}next(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{let e=(this.stepIndex+1)%this.steps.length;for(;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}showSolution(){var t=this;return lw(function*(){hw(e.VERBOSE,"tutorialGameWrapper.showSolution()");const n=t.steps[t.stepIndex];VG(n.hasSolution(),"showSolution called on a step with no solution, this should not be reachable");const r=n,i=r.getSolution();t.showStep(t.stepIndex),t.gameComponent.rules.choose(i),t.gameComponent.updateBoard(),t.moveAttemptMade=!0,t.currentMessage=r.getSuccessMessage(),t.cdr.detectChanges()})()}playLocally(){var e=this;return lw(function*(){const t=uw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/local",t])})()}createGame(){var e=this;return lw(function*(){const t=uw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/play",t])})()}getPlayerName(){return""}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ca(rl),ca(Ay),ca(Qv),ca(xl),ca(UY))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[Ho],decls:22,vars:15,consts:function(){let e,t,n,r,i,s,o,a,c;return e=$localize`Failure`,t=$localize`Try again`,n=$localize`Ok`,r=$localize`Continue`,i=$localize`Skip`,s=$localize`Try again`,o=$localize`Play locally`,a=$localize`Create an online game`,c=$localize`See solution`,[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],e,["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],t,["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],n,r,i,["id","restartButton",1,"button",3,"click"],s,["id","playLocallyButton",1,"button",3,"click"],o,["id","playOnlineButton",1,"button",3,"click"],a,["id","showSolutionButton",1,"button",3,"click"],c,["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"div",1),ha(2,"div",2),fa(3,"progress",3),ha(4,"div",4),ha(5,"p",5),Da(6),da(),fa(7,"p",6),da(),oa(8,ine,5,1,"div",7),ha(9,"div",8),oa(10,sne,2,0,"button",9),oa(11,une,6,2,"button",10),oa(12,hne,2,0,"button",11),oa(13,dne,2,0,"button",12),oa(14,fne,2,0,"button",13),oa(15,pne,2,0,"button",14),ha(16,"div",15),ha(17,"select",16),_a("change",function(e){return t.changeStep(e)}),oa(18,_ne,4,2,"ng-container",17),da(),da(),da(),da(),da(),ha(19,"div",18),ha(20,"div",19),fa(21,"app-game-includer"),da(),da(),da()),2&e&&(Ts(3),na("value",t.successfulSteps)("max",t.getNumberOfSteps()),Ts(3),Ua("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),Ts(1),la("innerHTML",t.currentMessage,vi),Ts(1),la("ngIf",t.currentReason.isPresent()),Ts(2),la("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),Ts(1),la("ngIf",!1===t.tutorialOver),Ts(1),la("ngIf",t.tutorialOver),Ts(1),la("ngIf",t.tutorialOver),Ts(1),la("ngIf",t.tutorialOver),Ts(1),la("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),Ts(3),la("ngForOf",t.steps),Ts(1),la("ngClass",t.getBoardHighlight()))},directives:[$d,Ud,Fd,gee,lg,fg],encapsulation:2,changeDetection:0}),e})();function Ene(e,t){if(1&e&&(ha(0,"div",35),ha(1,"div",36),Hc(2,37),da(),ha(3,"div",38),Da(4),da(),da()),2&e){const e=wa();Ts(4),La(e.errorMessage)}}const wne=function(){return["/login"]};let bne=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.faEye=cK,this.registrationForm=new Hp({email:new zp,username:new zp,password:new zp})}registerWithEmail(){var e=this;return lw(function*(){const t=e.registrationForm.value.username,n=e.registrationForm.value.email,r=e.registrationForm.value.password;if(null==t||null==n||null==r)e.errorMessage=$localize`There are missing fields in the registration form, please check that you filled in all fields.`;else{const i=yield e.authService.doRegister(t,n,r);if(i.isSuccess()){const t=yield e.authService.sendEmailVerification();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()}else e.errorMessage=i.getReason()}})()}registerWithGoogle(){var e=this;return lw(function*(){const t=yield e.authService.doGoogleLogin();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()})()}getPasswordHelpClass(){const e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}canRegister(){const e=this.registrationForm.value.password||"";return!(""===(this.registrationForm.value.email||"")||""===(this.registrationForm.value.username||"")||""===e||e.length<6)}}return e.\u0275fac=function(t){return new(t||e)(ca(UY),ca(Qv))},e.\u0275cmp=Xe({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){let e,t,n,r,i,s,o,a,c,l,u,h,d,f;return e=$localize`Registering`,t=$localize`Email`,n=$localize`Email`,r=$localize`A confirmation email will be sent to validate your account.`,i=$localize`Username`,s=$localize`Username`,o=$localize`Password`,a=$localize`Password`,c=$localize`The password should be at least 6 characters long`,l=$localize`Register`,u=$localize`Register with Google`,h=$localize`Have an account?`,d=$localize`Log in`,f=$localize`Registration error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",n,"type","email","autofocus","","required","",1,"input"],[1,"help"],r,["for","username",1,"label"],i,["id","username","formControlName","username","name","username","placeholder",s,"type","text","required","",1,"input"],["for","password",1,"label"],o,[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",a,"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],c,["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],l,[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],u,[1,"help","level-right"],h,[3,"routerLink"],d,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],f,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"p",1),Hc(2,2),da(),ha(3,"form",3),ha(4,"div",4),ha(5,"div",5),ha(6,"label",6),Hc(7,7),da(),da(),ha(8,"div",8),ha(9,"div",9),ha(10,"div",10),fa(11,"input",11),ha(12,"p",12),Hc(13,13),da(),da(),da(),da(),da(),ha(14,"div",4),ha(15,"div",5),ha(16,"label",14),Hc(17,15),da(),da(),ha(18,"div",8),ha(19,"div",9),ha(20,"div",10),fa(21,"input",16),da(),da(),da(),da(),ha(22,"div",4),ha(23,"div",5),ha(24,"label",17),Hc(25,18),da(),da(),ha(26,"div",8),ha(27,"div",9),ha(28,"div",19),fa(29,"input",20),ha(30,"span",21),fa(31,"fa-icon",22),da(),ha(32,"p",23),Hc(33,24),da(),da(),da(),da(),da(),ha(34,"div",4),fa(35,"div",5),ha(36,"div",8),ha(37,"div",9),ha(38,"div",10),ha(39,"button",25),_a("click",function(){return t.registerWithEmail()}),Hc(40,26),da(),da(),da(),da(),da(),ha(41,"div",4),fa(42,"div",5),ha(43,"div",27),oa(44,Ene,5,1,"div",28),da(),da(),ha(45,"div",4),fa(46,"div",5),ha(47,"div",8),ha(48,"button",29),_a("click",function(){return t.registerWithGoogle()}),Hc(49,30),da(),da(),da(),ha(50,"p",31),pa(51),Hc(52,32),ga(),Da(53,"\xa0 "),ha(54,"a",33),Hc(55,34),da(),da(),da(),da()),2&e&&(Ts(3),la("formGroup",t.registrationForm),Ts(28),la("icon",t.faEye),Ts(1),la("ngClass",t.getPasswordHelpClass()),Ts(7),la("disabled",!t.canRegister()),Ts(5),la("ngIf",t.errorMessage),Ts(10),la("routerLink",ou(6,wne)))},directives:[Jp,_p,rg,zf,vp,sg,V9,gg,DJ,$9,Fd,$d,t_],encapsulation:2}),e})(),Sne=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}playLocally(){var e=this;return lw(function*(){yield e.router.navigate(["local/"+e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Play offline`,[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(ha(0,"app-pick-game",0),_a("pickGame",function(e){return t.pickGame(e)}),da(),ha(1,"button",1),_a("click",function(){return t.playLocally()}),Hc(2,2),da()),2&e&&(Ts(1),la("disabled",!t.selectedGame))},directives:[D9],encapsulation:2}),e})(),Pne=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}launchTutorial(){var e=this;return lw(function*(){yield e.router.navigate(["/tutorial/",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ca(Qv))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Learn the rules`,[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(ha(0,"app-pick-game",0),_a("pickGame",function(e){return t.pickGame(e)}),da(),ha(1,"button",1),_a("click",function(){return t.launchTutorial()}),Hc(2,2),da()),2&e&&(Ts(1),la("disabled",!t.selectedGame))},directives:[D9],encapsulation:2}),e})(),One=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){let e;return e=$localize`The replay game is loading, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(ha(0,"p"),Hc(1,0),da())},encapsulation:2}),e})();const Tne={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1};let Ine=(()=>{class e{constructor(e){this.authService=e}canActivate(){var e=this;return lw(function*(){return new Promise(t=>{e.userSub=e.authService.getUserObs().subscribe(function(){var n=lw(function*(n){yield e.evaluateUserPermission(n).then(t)});return function(e){return n.apply(this,arguments)}}())})})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(UY))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),kne=(()=>{class e extends Ine{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return lw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(UY),Or(Qv))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Ane(e,t){1&e&&(ha(0,"p",20),Hc(1,21),da())}function Nne(e,t){if(1&e){const e=ma();ha(0,"div",7),ha(1,"p",8),Hc(2,9),da(),ha(3,"div",10),ha(4,"p",11),Hc(5,12),da(),ha(6,"button",13),_a("click",function(){return Gt(e),wa().finalizeEmailVerification()}),Hc(7,14),da(),da(),ha(8,"div",15),ha(9,"p",11),Hc(10,16),da(),ha(11,"button",17),_a("click",function(){return Gt(e),wa().sendEmailVerification()}),Hc(12,18),da(),da(),oa(13,Ane,2,0,"p",19),da()}if(2&e){const e=wa();Ts(2),Gc(e.emailAddress),qc(2),Ts(11),la("ngIf",e.success)}}function Mne(e,t){if(1&e){const e=ma();ha(0,"div",24),ha(1,"div",8),Hc(2,25),da(),ha(3,"form",26),ha(4,"div",27),ha(5,"div",28),fa(6,"input",29),da(),ha(7,"div",28),ha(8,"button",30),_a("click",function(){Gt(e);const t=wa(2);return t.pickUsername(t.usernameForm.value)}),Hc(9,31),da(),da(),da(),da(),da()}if(2&e){const e=wa(2);Ts(3),la("formGroup",e.usernameForm)}}const xne=function(){return["/lobby"]};function Rne(e,t){1&e&&(ha(0,"div",32),$c(1,33),fa(2,"a",34),zc(),da()),2&e&&(Ts(2),la("routerLink",ou(1,xne)))}function Dne(e,t){if(1&e&&(pa(0),oa(1,Mne,10,1,"div",22),oa(2,Rne,3,2,"div",23),ga()),2&e){const e=wa();Ts(1),la("ngIf",!e.success),Ts(1),la("ngIf",e.success)}}function Lne(e,t){if(1&e&&(ha(0,"div",35),ha(1,"div",36),Da(2),da(),da()),2&e){const e=wa();Ts(2),La(e.errorMessage)}}let Fne=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new Hp({username:new zp})}ngOnInit(){var e=this;return lw(function*(){e.userSub=e.authService.getUserObs().subscribe(function(){var t=lw(function*(t){e.emailAddress=t.email.get(),t.username.isAbsent()?e.verificationType="enter-username":(e.verificationType="send-email",!0===e.triedToFinalize&&!1===t.verified&&(e.errorMessage=$localize`You have not verified your email! Click on the link in the verification email.`),!0===t.verified&&(yield e.router.navigate(["/lobby"])))});return function(e){return t.apply(this,arguments)}}())})()}pickUsername(e){var t=this;return lw(function*(){const n=yield t.authService.setUsername(e.username);n.isSuccess()?t.success=!0:t.errorMessage=n.getReason()})()}sendEmailVerification(){var e=this;return lw(function*(){const t=yield e.authService.sendEmailVerification();t.isSuccess()?e.success=!0:e.errorMessage=t.getReason()})()}finalizeEmailVerification(){var e=this;return lw(function*(){e.triedToFinalize=!0,yield e.authService.reloadUser(),window.open(window.location.href,"_self")})()}ngOnDestroy(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ca(UY),ca(Qv))},e.\u0275cmp=Xe({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,c,l,u;return e=$localize`Account verification`,t=$localize`In order to finalize your account, you must click on the link that you should have received on your email address (${"\ufffd0\ufffd"}:INTERPOLATION:). The email could be in your spam folder.`,n=$localize`Once you have verified your email, click on the following button:`,r=$localize`Finalize email verification`,i=$localize`If you have not received the verification email, click on the following button:`,s=$localize`Send verification email again`,o=$localize`The email has been sent`,a=$localize`In order to finalize your account, you must choose a username.`,c=$localize`Username`,l=$localize`Pick username`,u=$localize`Your account has now been finalized, you can go back to the ${"\ufffd#2\ufffd"}:START_LINK:list of games${"\ufffd/#2\ufffd"}:CLOSE_LINK:.`,[[1,"box"],[1,"message","is-info"],[1,"message-header"],e,["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],t,[1,"block","level-left"],[1,"level-item"],n,["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],r,[1,"level-left"],i,["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],s,["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],o,["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],a,[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",c,"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],l,["id","success",1,"message-body"],u,[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"div",1),ha(2,"div",2),Hc(3,3),da(),oa(4,Nne,14,2,"div",4),oa(5,Dne,3,2,"ng-container",5),da(),oa(6,Lne,3,1,"div",6),da()),2&e&&(Ts(4),la("ngIf","send-email"===t.verificationType),Ts(1),la("ngIf","enter-username"===t.verificationType),Ts(1),la("ngIf",t.errorMessage))},directives:[$d,Jp,_p,rg,zf,gg,vp,sg,t_],encapsulation:2}),e})(),Bne=(()=>{class e extends Ine{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return lw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(UY),Or(Qv))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Une=(()=>{class e extends Ine{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return lw(function*(){return!1===e.isConnected()||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(UY),Or(Qv))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Vne(e,t){1&e&&(ha(0,"p",12),Hc(1,13),da())}function $ne(e,t){if(1&e&&(ha(0,"div",14),ha(1,"div",15),Hc(2,16),da(),ha(3,"div",17),Da(4),da(),da()),2&e){const e=wa();Ts(4),La(e.errorMessage.get())}}const zne=function(){return{standalone:!0}};let Hne=(()=>{class e{constructor(e){this.authService=e,this.success=!1,this.errorMessage=gw.empty(),this.email=""}resetPassword(){var e=this;return lw(function*(){VG(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=gw.empty(),e.success=!1;const t=yield e.authService.sendPasswordResetEmail(e.email);t.isSuccess()?e.success=!0:e.errorMessage=gw.of(t.getReason())})()}}return e.\u0275fac=function(t){return new(t||e)(ca(UY))},e.\u0275cmp=Xe({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){let e,t,n,r,i,s;return e=$localize`Password reset`,t=$localize`Email`,n=$localize`An email will be sent with instruction to reset your password.`,r=$localize`Reset password`,i=$localize`The email has been sent, please follow the instructions from that email.`,s=$localize`Error`,[[1,"box"],[1,"title"],e,[1,"field"],[1,"control"],["id","email","name","email","placeholder",t,"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],n,["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],r,["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],i,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],s,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"p",1),Hc(2,2),da(),ha(3,"div",3),ha(4,"div",4),ha(5,"input",5),_a("ngModelChange",function(e){return t.email=e}),da(),ha(6,"p",6),Hc(7,7),da(),oa(8,Vne,2,0,"p",8),da(),da(),ha(9,"button",9),_a("click",function(){return t.resetPassword()}),Hc(10,10),da(),oa(11,$ne,5,1,"div",11),da()),2&e&&(Ts(5),la("ngModel",t.email)("ngModelOptions",ou(5,zne)),Ts(3),la("ngIf",t.success),Ts(1),la("disabled",""===t.email),Ts(2),la("ngIf",t.errorMessage.isPresent()))},directives:[zf,V9,gg,vp,Kp,$d],encapsulation:2}),e})();function Gne(e,t){if(1&e&&(ha(0,"option",13),Da(1),da()),2&e){const e=t.$implicit,n=wa();la("value",e.value)("selected",e.value===n.currentTheme),Ts(1),Fa(" ",e.name," ")}}function qne(e,t){if(1&e&&(ha(0,"option",13),Da(1),da()),2&e){const e=t.$implicit,n=wa();la("value",e.value)("selected",e.value===n.currentLanguage),Ts(1),Fa(" ",e.name," ")}}let Wne=(()=>{class e{constructor(e,t){this.userSettingsService=e,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize`Light`},{value:"dark",name:$localize`Dark`}],this.currentTheme=t.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}changeLanguage(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}changeTheme(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}reload(){window.open(window.location.href,"_self")}}return e.\u0275fac=function(t){return new(t||e)(ca(rK),ca(iK))},e.\u0275cmp=Xe({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){let e,t,n;return e=$localize`User settings`,t=$localize`Theme`,n=$localize`Language`,[[1,"box"],[1,"title"],e,[1,"field"],["for","theme",1,"label"],t,[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],n,["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(ha(0,"div",0),ha(1,"p",1),Hc(2,2),da(),ha(3,"div",3),ha(4,"label",4),Hc(5,5),da(),ha(6,"div",6),ha(7,"div",7),ha(8,"select",8),_a("change",function(e){return t.changeTheme(e)}),oa(9,Gne,2,3,"option",9),da(),da(),da(),da(),ha(10,"div",3),ha(11,"label",10),Hc(12,11),da(),ha(13,"div",6),ha(14,"div",7),ha(15,"select",12),_a("change",function(e){return t.changeLanguage(e)}),oa(16,qne,2,3,"option",9),da(),da(),da(),da(),da()),2&e&&(Ts(9),la("ngForOf",t.availableThemes),Ts(7),la("ngForOf",t.availableLanguages))},directives:[Ud,lg,fg],encapsulation:2}),e})(),jne=(()=>{class e{}return e.ALREADY_INGAME=()=>$localize`You are already in a game. Finish it or cancel it first.`,e})(),Zne=(()=>{class e{constructor(e,t,n,r,i,s){this.route=e,this.router=t,this.connectedUserService=n,this.messageDisplayer=r,this.partDAO=i,this.gameService=s}ngOnInit(){var e=this;return lw(function*(){yield e.createGameAndRedirectOrShowError(e.extractGameFromURL())})()}extractGameFromURL(){return uw.getNonNullable(this.route.snapshot.paramMap.get("compo"))}createGameAndRedirectOrShowError(e){var t=this;return lw(function*(){const n=t.connectedUserService.user.get();VG(n.isConnected(),"User must be connected and have a username to reach this page");const r=n.toMinimalUser();if(yield t.canCreateOnlineGame(r.name)){const n=yield t.gameService.createPartJoinerAndChat(r,e);return yield t.router.navigate(["/play",e,n]),!0}return t.messageDisplayer.infoMessage(jne.ALREADY_INGAME()),yield t.router.navigate(["/lobby"]),!1})()}canCreateOnlineGame(e){var t=this;return lw(function*(){return!1===(yield t.partDAO.userHasActivePart(e))})()}}return e.\u0275fac=function(t){return new(t||e)(ca(Ay),ca(Qv),ca(UY),ca(BG),ca(HG),ca(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){let e;return e=$localize`Creating online game, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(ha(0,"p"),Hc(1,0),da())},encapsulation:2}),e})();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[ja.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),Ha[t]=e,n&&(Ha[t][ja.ExtraData]=n)}(e,void 0,void 0)}(aw());const Yne=[{path:"login",component:q9},{path:"lobby",component:dee,canActivate:[kne]},{path:"settings",component:Wne},{path:"register",component:bne,canActivate:[Une]},{path:"reset-password",component:Hne,canActivate:[Une]},{path:"notFound",component:fee},{path:"nextGameLoading",component:One,canActivate:[kne]},{path:"verify-account",component:Fne,canActivate:[Bne]},{path:"play",component:j9,canActivate:[kne]},{path:"play/:compo",component:Zne,canActivate:[kne]},{path:"play/:compo/:id",component:Fte,canActivate:[kne]},{path:"local",component:Sne},{path:"local/:compo",component:nne},{path:"tutorial",component:Pne},{path:"tutorial/:compo",component:Cne},{path:"",component:U9},{path:"**",component:U9}];class Kne{static app(){return function(e,...t){return{ngModule:TT,providers:[{provide:bT,useFactory:OT(e),multi:!0,deps:[nh,$o,pT,...t]}]}}(()=>(Tne.useEmulators&&(Tne.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),IT(Tne.firebaseConfig)))}static firestore(){return function(e,...t){return{ngModule:gG,providers:[{provide:hG,useFactory:dG(e),multi:!0,deps:[nh,$o,pT,wT,[new Mr,AN],[new Mr,aI],...t]}]}}(()=>{const e=bG(),t=e.toJSON().settings.host;return Tne.useEmulators&&"localhost:8080"!==t&&vG(e,"localhost",8080),e})}static database(){return function(e,...t){return{ngModule:AY,providers:[{provide:OY,useFactory:TY(e),multi:!0,deps:[nh,$o,pT,wT,[new Mr,AN],[new Mr,aI],...t]}]}}(()=>{const e=MY();return Tne.useEmulators&&!1===e._instanceStarted&&NY(e,"localhost",9e3),e})}static auth(){return function(e,...t){return{ngModule:DN,providers:[{provide:NN,useFactory:MN(e),multi:!0,deps:[nh,$o,pT,wT,[new Mr,aI],...t]}]}}(()=>{const e=BN();return Tne.useEmulators&&null==e.config.emulator&&LN(e,"http://localhost:9099",{disableWarnings:!0}),e})}}let Jne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e,bootstrap:[ZJ]}),e.\u0275inj=Se({providers:[UY,tK,eK,KG,WG,HG,iK,{provide:Gu,useValue:nK.getLocale()}],imports:[[Kne.app(),Kne.firestore(),Kne.auth(),Kne.database(),If,im,f_.forRoot(Yne,{useHash:!1}),Cg,_g,sw,LJ]]}),e})();"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self;"undefined"!=typeof global&&global;class Qne{constructor(e){this.digits=e}static zero(){return new Qne([0])}static one(){return new Qne([1])}clone(){return new Qne(this.digits.slice())}add(e){const t=this.clone();return t.addToSelf(e),t}addToSelf(e){const t=Math.max(this.digits.length,e.digits.length);let n=0;for(let r=0;r<t;r++){let t=n;r<this.digits.length&&(t+=this.digits[r]),r<e.digits.length&&(t+=e.digits[r]),t>=10?(this.digits[r]=t-10,n=1):(this.digits[r]=t,n=0)}n>0&&(this.digits[t]=1)}toString(){let e="";for(let t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}class Xne{constructor(e){this.powerOfTwos=[e]}getValue(){return this.powerOfTwos[0]}multiplyBy(e){const t=Qne.zero();return this.multiplyByAndAddTo(e,t),t}multiplyByAndAddTo(e,t){for(let n=0;0!==e;e>>>=1,n++)if(1&e){const e=this.getMultipliedByPowerOfTwo(n);t.addToSelf(e)}}getMultipliedByPowerOfTwo(e){for(let t=this.powerOfTwos.length;t<=e;t++){const e=this.powerOfTwos[t-1];this.powerOfTwos[t]=e.add(e)}return this.powerOfTwos[e]}}class ere{constructor(e){this.base=e,this.exponents=[new Xne(Qne.one())]}toThePowerOf(e){for(let t=this.exponents.length;t<=e;t++){const e=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new Xne(e)}return this.exponents[e]}}function tre(e){const t=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){const t=e.charCodeAt(n+1);t>=56320&&t<=57343&&(n++,r=(r-55296<<10)+t-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e);let n=nre(t,0),r=nre(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function nre(e,t){let n,r=2654435769,i=2654435769;const s=e.length;for(n=0;n+12<=s;n+=12){r=sre(r,lre(e,n,ire.Little)),i=sre(i,lre(e,n+4,ire.Little));const s=rre(r,i,t=sre(t,lre(e,n+8,ire.Little)));r=s[0],i=s[1],t=s[2]}return r=sre(r,lre(e,n,ire.Little)),i=sre(i,lre(e,n+4,ire.Little)),t=sre(t,s),rre(r,i,t=sre(t,lre(e,n+8,ire.Little)<<8))[2]}function rre(e,t,n){return e=are(e,t),e=are(e,n),e^=n>>>13,t=are(t,n),t=are(t,e),t^=e<<8,n=are(n,e),n=are(n,t),n^=t>>>13,e=are(e,t),e=are(e,n),e^=n>>>12,t=are(t,n),t=are(t,e),t^=e<<16,n=are(n,e),n=are(n,t),n^=t>>>5,e=are(e,t),e=are(e,n),e^=n>>>3,t=are(t,n),t=are(t,e),t^=e<<10,n=are(n,e),n=are(n,t),[e,t,n^=t>>>15]}var ire=(()=>((ire=ire||{})[ire.Little=0]="Little",ire[ire.Big=1]="Big",ire))();function sre(e,t){return ore(e,t)[1]}function ore(e,t){const n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function are(e,t){const n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function cre(e,t){return t>=e.length?0:e[t]}function lre(e,t,n){let r=0;if(n===ire.Big)for(let i=0;i<4;i++)r+=cre(e,t+i)<<24-8*i;else for(let i=0;i<4;i++)r+=cre(e,t+i)<<8*i;return r}const ure=new ere(256);function hre(e,t,n,r,i=[]){const s={},o={},a=function(e,t){const{text:n,block:r}=dre(e,t);if(void 0===r)return{text:n};{const[e,...t]=r.split("\u241f"),[i,s]=e.split("@@",2);let[o,a]=i.split("|",2);return void 0===a&&(a=o,o=void 0),""===a&&(a=void 0),{text:n,meaning:o,description:a,customId:s,legacyIds:t}}}(e[0],e.raw[0]),c=[a.text],l=[];let u=a.text;for(let f=1;f<e.length;f++){const{text:n,block:r=fre(f)}=dre(e[f],e.raw[f]);u+=`{$${r}}${n}`,void 0!==t&&(s[r]=t[f-1],o[r]=i[f-1]),l.push(r),c.push(n)}const h=a.customId||function(e,t=""){let n=tre(e);if(t){const e=tre(t);n=function(e,t){const n=e[0],r=t[0],i=ore(e[1],t[1]),s=i[0],o=i[1];return[sre(sre(n,r),s),o]}(function(e,t){const n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),e)}return function(e,t){const n=ure.toThePowerOf(0).multiplyBy(t);return ure.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(u,a.meaning||""),d=a.legacyIds?a.legacyIds.filter(e=>e!==h):[];return{id:h,legacyIds:d,substitutions:s,substitutionLocations:o,text:u,customId:a.customId,meaning:a.meaning||"",description:a.description||"",messageParts:c,messagePartLocations:r,placeholderNames:l,location:n}}function dre(e,t){if(":"!==t.charAt(0))return{text:e};{const n=function(e,t){for(let n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}}function fre(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});class pre extends Error{constructor(e){super(`No translation found for ${mre(e)}.`),this.parsedMessage=e,this.type="MissingTranslationError"}}function gre(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function mre(e){const t=e.meaning&&` - "${e.meaning}"`,n=e.legacyIds&&e.legacyIds.length>0?` [${e.legacyIds.map(e=>`"${e}"`).join(", ")}]`:"";return`"${e.id}"${n} ("${e.text}"${t})`}function yre(e,t){try{return function(e,t,n){const r=hre(t,n);let i=e[r.id];if(void 0!==r.legacyIds)for(let s=0;s<r.legacyIds.length&&void 0===i;s++)i=e[r.legacyIds[s]];if(void 0===i)throw new pre(r);return[i.messageParts,i.placeholderNames.map(e=>{if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error(`There is a placeholder name mismatch with the translation provided for the message ${mre(r)}.\nThe translation contains a placeholder with name ${e}, which does not exist in the message.`)})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function vre(){Tne.production&&function(){if(ph)throw new Error("Cannot enable prod mode after platform setup.");fh=!1}(),Of().bootstrapModule(Jne).catch(e=>console.error(e))}const _re=nK.getLocale();"en"!==_re?fetch(Tne.root+"assets/"+_re+".json").then(e=>e.ok?e.json():{locale:"en",translations:{}}).then(e=>{(function(e){$localize.translate||($localize.translate=yre),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(t=>{$localize.TRANSLATIONS[t]=function(e){const t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[];for(let s=1;s<t.length-1;s+=2)r.push(t[s]),n.push(`${t[s+1]}`);const i=n.map(e=>":"===e.charAt(0)?"\\"+e:e);return{text:e,messageParts:gre(n,i),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,vre()}).catch(function(e){console.log(e)}):vre()}},function(e){e(e.s=4928)}]);