(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},9575:function(e,t,n){var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(0,t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0!==(s="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=s)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},5378:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++)n=arguments[r]??{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))});return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){var e;return null!==(e=h)&&void 0!==e?e:document}var l={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},c=n({},l),u={},h=null,d=function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0},p=function(){function e(t){var n=this;r(this,e),this.element=a().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),s=["notification",this.extraClasses];if(this.type&&s.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),l=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";s.push("animate__animated ".concat(o," ").concat(l)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=s.join(" "),this.dismissible){var c=a().createElement("button");c.className="delete",c.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",c)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var u=new f(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){u.pause()}),this.element.addEventListener("mouseout",function(){u.resume()}))}return s(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete u.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete u.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),f=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return s(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){c=n({},l)},e.setDefaults=function(e){c=n(n({},l),e)},e.setDoc=function(e){for(var t in u)u[t].remove();u={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},c),e),r=new p(t),i=function(e,t,n,r,i,s){if(u.position)return u.position;var o=a().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+d(t,n,r,i,s)),e.appendChild(o),u.position=o,o}(t.appendTo||a().body,t.position||c.position,t.offsetTop||c.offsetTop,t.offsetBottom||c.offsetBottom,t.offsetLeft||c.offsetLeft,t.offsetRight||c.offsetRight);if(t.single)for(var s=i.lastElementChild;s;)i.removeChild(s),s=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},6676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function r(e,t,r){var i,s=new Promise(function(s,o){n(i=e[t].apply(e,r)).then(s,o)});return s.request=i,s}function i(e,t,n){var i=r(e,t,n);return i.then(function(e){if(e)return new u(e,i.request)})}function s(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,t,n,i){i.forEach(function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})})}function a(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function l(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})})}function c(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function h(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function f(e){this._db=e}s(c,"_index",["name","keyPath","multiEntry","unique"]),o(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),l(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(u,"_cursor",["direction","key","primaryKey","value"]),o(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),h.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},s(h,"_store",["name","keyPath","indexNames","autoIncrement"]),o(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),l(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(h,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[h,c].forEach(function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,s=i[e].apply(i,n.slice(0,-1));s.onsuccess=function(){r(s.result)}})})}),[c,h].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(i){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)})})})}),e.openDb=function(e,t,n){var i=r(indexedDB,"open",[e,t]),s=i.request;return s&&(s.onupgradeneeded=function(e){n&&n(new p(s.result,e.oldVersion,s.transaction))}),i.then(function(e){return new f(e)})},e.deleteDb=function(e){return r(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})}(t)},4181:function(e,t,n){"use strict";function r(e){return"function"==typeof e}function i(e){const t=e(e=>{Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const s=i(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function o(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class a{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const e of i)e.remove(this);else i.remove(this);const{initialTeardown:o}=this;if(r(o))try{o()}catch(t){e=t instanceof s?t.errors:[t]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const t of a)try{u(t)}catch(n){e=e??[],n instanceof s?e=[...e,...n.errors]:e.push(n)}}if(e)throw new s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)u(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&o(t,e)}remove(e){const{_teardowns:t}=this;t&&o(t,e),e instanceof a&&e._removeParent(this)}}a.EMPTY=(()=>{const e=new a;return e.closed=!0,e})();const l=a.EMPTY;function c(e){return e instanceof a||e&&"closed"in e&&r(e.remove)&&r(e.add)&&r(e.unsubscribe)}function u(e){r(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function p(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function f(){}const g=m("C",void 0,void 0);function m(e,t,n){return{kind:e,value:t,error:n}}let y=null;function v(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!y;if(t&&(y={errorThrown:!1,error:null}),e(),t){const{errorThrown:e,error:t}=y;if(y=null,e)throw t}}else e()}class _ extends a{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,c(e)&&e.add(this)):this.destination=b}static create(e,t,n){return new C(e,t,n)}next(e){this.isStopped?S(m("N",e,void 0),this):this._next(e)}error(e){this.isStopped?S(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?S(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class C extends _{constructor(e,t,n){let i;if(super(),r(e))i=e;else if(e){let r;({next:i,error:t,complete:n}=e),this&&h.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe()):r=e,i=null==i?void 0:i.bind(r),t=null==t?void 0:t.bind(r),n=null==n?void 0:n.bind(r)}this.destination={next:i?E(i):f,error:E(t??w),complete:n?E(n):f}}}function E(e,t){return(...t)=>{try{e(...t)}catch(n){h.useDeprecatedSynchronousErrorHandling?function(e){h.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):p(n)}}}function w(e){throw e}function S(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const b={closed:!0,next:f,error:w,complete:f},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(e){return e}let T=(()=>{class e{constructor(e){e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const i=function(e){return e&&e instanceof _||function(e){return e&&r(e.next)&&r(e.error)&&r(e.complete)}(e)&&c(e)}(e)?e:new C(e,t,n);return v(()=>{const{operator:e,source:t}=this;i.add(e?e.call(i,t):t?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return new(t=I(t))((t,n)=>{const r=new C({next:t=>{try{e(t)}catch(i){n(i),r.unsubscribe()}},error:n,complete:t});this.subscribe(r)})}_subscribe(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}[P](){return this}pipe(...e){return function(e){return 0===e.length?O:1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}}(e)(this)}toPromise(e){return new(e=I(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function I(e){var t;return null!==(t=e??h.Promise)&&void 0!==t?t:Promise}const k=i(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let A=(()=>{class e extends T{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const t=new M(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new k}next(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){const t=this.observers.slice();for(const n of t)n.next(e)}})}error(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:t,isStopped:n,observers:r}=this;return t||n?l:(r.push(e),new a(()=>o(r,e)))}_checkFinalizedStatuses(e){const{hasError:t,thrownError:n,isStopped:r}=this;t?e.error(n):r&&e.complete()}asObservable(){const e=new T;return e.source=this,e}}return e.create=(e,t)=>new M(e,t),e})();class M extends A{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:l}}function N(e){return r(null==e?void 0:e.lift)}function R(e){return t=>{if(N(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class x extends _{constructor(e,t,n,r,i){super(e),this.onFinalize=i,this._next=t?function(n){try{t(n)}catch(r){e.error(r)}}:super._next,this._error=r?function(t){try{r(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function D(e,t){return R((n,r)=>{let i=0;n.subscribe(new x(r,n=>{r.next(e.call(t,n,i++))}))})}function L(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function U(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(l,c):u(s[0][2],e)}(i[e](t))}catch(n){u(s[0][3],n)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function B(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}const V=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $(e){return r(null==e?void 0:e.then)}function z(e){return r(e[P])}function H(e){return Symbol.asyncIterator&&r(null==e?void 0:e[Symbol.asyncIterator])}function G(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const q="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function W(e){return r(null==e?void 0:e[q])}function j(e){return U(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:e,done:n}=yield F(t.read());if(n)return yield F(void 0);yield yield F(e)}}finally{t.releaseLock()}})}function Z(e){return r(null==e?void 0:e.getReader)}function Y(e){if(e instanceof T)return e;if(null!=e){if(z(e))return function(e){return new T(t=>{const n=e[P]();if(r(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(V(e))return function(e){return new T(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($(e))return function(e){return new T(t=>{e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,p)})}(e);if(H(e))return K(e);if(W(e))return function(e){return new T(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Z(e))return function(e){return K(j(e))}(e)}throw G(e)}function K(e){return new T(t=>{(function(e,t){var n,r,i,s;return function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=B(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(e=>t.error(e))})}function Q(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function J(e,t,n=1/0){return r(t)?J((n,r)=>D((e,i)=>t(n,e,r,i))(Y(e(n,r))),n):("number"==typeof t&&(n=t),R((t,r)=>function(e,t,n,r,i,s,o,a){const l=[];let c=0,u=0,h=!1;const d=()=>{h&&!l.length&&!c&&t.complete()},p=e=>c<r?f(e):l.push(e),f=e=>{c++;let i=!1;Y(n(e,u++)).subscribe(new x(t,e=>{t.next(e)},()=>{i=!0},void 0,()=>{if(i)try{for(c--;l.length&&c<r;){const e=l.shift();f(e)}d()}catch(e){t.error(e)}}))};return e.subscribe(new x(t,p,()=>{h=!0,d()})),()=>{}}(t,r,e,n)))}function X(e=1/0){return J(O,e)}const ee=new T(e=>e.complete());function te(e){return e[e.length-1]}function ne(e){return r(te(e))?e.pop():void 0}function re(e){return function(e){return e&&r(e.schedule)}(te(e))?e.pop():void 0}function ie(e,t=0){return R((n,r)=>{n.subscribe(new x(r,n=>Q(r,e,()=>r.next(n),t),()=>Q(r,e,()=>r.complete(),t),n=>Q(r,e,()=>r.error(n),t)))})}function se(e,t=0){return R((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(n=>{Q(n,t,()=>{const r=e[Symbol.asyncIterator]();Q(n,t,()=>{r.next().then(e=>{e.done?n.complete():n.next(e.value)})},0,!0)})})}function ae(e,t){return t?function(e,t){if(null!=e){if(z(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(V(e))return function(e,t){return new T(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if($(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(H(e))return oe(e,t);if(W(e))return function(e,t){return new T(n=>{let i;return Q(n,t,()=>{i=e[q](),Q(n,t,()=>{let e,t;try{({value:e,done:t}=i.next())}catch(r){return void n.error(r)}t?n.complete():n.next(e)},0,!0)}),()=>r(null==i?void 0:i.return)&&i.return()})}(e,t);if(Z(e))return function(e,t){return oe(j(e),t)}(e,t)}throw G(e)}(e,t):Y(e)}function le(e){return e<=0?()=>ee:R((t,n)=>{let r=0;t.subscribe(new x(n,t=>{++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function ce(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(le(1)).subscribe(()=>e())}function ue(e){for(let t in e)if(e[t]===ue)return t;throw Error("Could not find renamed property on target object.")}function he(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function de(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(de).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function pe(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const fe=ue({__forward_ref__:ue});function ge(e){return e.__forward_ref__=ge,e.toString=function(){return de(this())},e}function me(e){return ye(e)?e():e}function ye(e){return"function"==typeof e&&e.hasOwnProperty(fe)&&e.__forward_ref__===ge}class ve extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function _e(e){return"string"==typeof e?e:null==e?"":String(e)}function Ce(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_e(e)}function Ee(e,t){const n=t?` in ${t}`:"";throw new ve("201",`No provider for ${Ce(e)} found${n}`)}function we(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}function Se(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function be(e){return{providers:e.providers||[],imports:e.imports||[]}}function Pe(e){return Oe(e,Ie)||Oe(e,Ae)}function Oe(e,t){return e.hasOwnProperty(t)?e[t]:null}function Te(e){return e&&(e.hasOwnProperty(ke)||e.hasOwnProperty(Me))?e[ke]:null}const Ie=ue({"\u0275prov":ue}),ke=ue({"\u0275inj":ue}),Ae=ue({ngInjectableDef:ue}),Me=ue({ngInjectorDef:ue});var Ne=(()=>((Ne=Ne||{})[Ne.Default=0]="Default",Ne[Ne.Host=1]="Host",Ne[Ne.Self=2]="Self",Ne[Ne.SkipSelf=4]="SkipSelf",Ne[Ne.Optional=8]="Optional",Ne))();let Re;function xe(e){const t=Re;return Re=e,t}function De(e,t,n){const r=Pe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Ne.Optional?null:void 0!==t?t:void Ee(de(e),"Injector")}function Le(e){return{toString:e}.toString()}var Fe=(()=>((Fe=Fe||{})[Fe.OnPush=0]="OnPush",Fe[Fe.Default=1]="Default",Fe))(),Ue=(()=>((Ue=Ue||{})[Ue.Emulated=0]="Emulated",Ue[Ue.None=2]="None",Ue[Ue.ShadowDom=3]="ShadowDom",Ue))();const Be="undefined"!=typeof globalThis&&globalThis,Ve="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ze=Be||"undefined"!=typeof global&&global||Ve||$e,He={},Ge=[],qe=ue({"\u0275cmp":ue}),We=ue({"\u0275dir":ue}),je=ue({"\u0275pipe":ue}),Ze=ue({"\u0275mod":ue}),Ye=ue({"\u0275loc":ue}),Ke=ue({"\u0275fac":ue}),Qe=ue({__NG_ELEMENT_ID__:ue});let Je=0;function Xe(e){return Le(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Fe.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Ge,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Ue.Emulated,id:"c",styles:e.styles||Ge,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Je++,n.inputs=it(e.inputs,t),n.outputs=it(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(et):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(tt):null,n})}function et(e){return at(e)||function(e){return e[We]||null}(e)}function tt(e){return function(e){return e[je]||null}(e)}const nt={};function rt(e){return Le(()=>{const t={type:e.type,bootstrap:e.bootstrap||Ge,declarations:e.declarations||Ge,imports:e.imports||Ge,exports:e.exports||Ge,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nt[e.id]=e.type),t})}function it(e,t){if(null==e)return He;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const st=Xe;function ot(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function at(e){return e[qe]||null}function lt(e,t){const n=e[Ze]||null;if(!n&&!0===t)throw new Error(`Type ${de(e)} does not have '\u0275mod' property.`);return n}function ct(e){return Array.isArray(e)&&"object"==typeof e[1]}function ut(e){return Array.isArray(e)&&!0===e[1]}function ht(e){return 0!=(8&e.flags)}function dt(e){return 2==(2&e.flags)}function pt(e){return 1==(1&e.flags)}function ft(e){return null!==e.template}function gt(e){return 0!=(512&e[2])}function mt(e,t){return e.hasOwnProperty(Ke)?e[Ke]:null}class yt{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function vt(){return _t}function _t(e){return e.type.prototype.ngOnChanges&&(e.setInput=Et),Ct}function Ct(){const e=St(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===He)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Et(e,t,n,r){const i=St(e)||function(e,t){return e[wt]=t}(e,{previous:He,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],l=o[a];s[a]=new yt(l&&l.currentValue,t,o===He),e[r]=t}vt.ngInherit=!0;const wt="__ngSimpleChanges__";function St(e){return e[wt]||null}const bt="http://www.w3.org/2000/svg";let Pt;function Ot(){return void 0!==Pt?Pt:"undefined"!=typeof document?document:void 0}function Tt(e){return!!e.listen}const It={createRenderer:(e,t)=>Ot()};function kt(e){for(;Array.isArray(e);)e=e[0];return e}function At(e,t){return kt(t[e])}function Mt(e,t){return kt(t[e.index])}function Nt(e,t){return e.data[t]}function Rt(e,t){return e[t]}function xt(e,t){const n=t[e];return ct(n)?n:n[0]}function Dt(e){return 4==(4&e[2])}function Lt(e){return 128==(128&e[2])}function Ft(e,t){return null==t?null:e[t]}function Ut(e){e[18]=0}function Bt(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Vt={lFrame:pn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function $t(){return Vt.bindingsEnabled}function zt(){return Vt.lFrame.lView}function Ht(){return Vt.lFrame.tView}function Gt(e){return Vt.lFrame.contextLView=e,e[8]}function qt(){let e=Wt();for(;null!==e&&64===e.type;)e=e.parent;return e}function Wt(){return Vt.lFrame.currentTNode}function jt(){const e=Vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Zt(e,t){const n=Vt.lFrame;n.currentTNode=e,n.isParent=t}function Yt(){return Vt.lFrame.isParent}function Kt(){Vt.lFrame.isParent=!1}function Qt(){return Vt.isInCheckNoChangesMode}function Jt(e){Vt.isInCheckNoChangesMode=e}function Xt(){const e=Vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function en(){return Vt.lFrame.bindingIndex}function tn(){return Vt.lFrame.bindingIndex++}function nn(e){const t=Vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function rn(e){Vt.lFrame.inI18n=e}function sn(e,t){const n=Vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,on(t)}function on(e){Vt.lFrame.currentDirectiveIndex=e}function an(){return Vt.lFrame.currentQueryIndex}function ln(e){Vt.lFrame.currentQueryIndex=e}function cn(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function un(e,t,n){if(n&Ne.SkipSelf){let r=t,i=e;for(;!(r=r.parent,null!==r||n&Ne.Host||(r=cn(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}const r=Vt.lFrame=dn();return r.currentTNode=t,r.lView=e,!0}function hn(e){const t=dn(),n=e[1];Vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function dn(){const e=Vt.lFrame,t=null===e?null:e.child;return null===t?pn(e):t}function pn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function fn(){const e=Vt.lFrame;return Vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gn=fn;function mn(){const e=fn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function yn(){return Vt.lFrame.selectedIndex}function vn(e){Vt.lFrame.selectedIndex=e}function _n(){const e=Vt.lFrame;return Nt(e.tView,e.selectedIndex)}function Cn(){Vt.lFrame.currentNamespace=bt}function En(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function wn(e,t,n){Pn(e,t,3,n)}function Sn(e,t,n,r){(3&e[2])===n&&Pn(e,t,n,r)}function bn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Pn(e,t,n,r){const i=r??-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(On(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function On(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}class Tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function In(e,t,n){const r=Tt(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],l=n[i++];r?e.setAttribute(t,a,l,o):t.setAttributeNS(o,a,l)}else{const o=s,a=n[++i];An(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function kn(e){return 3===e||4===e||6===e}function An(e){return 64===e.charCodeAt(0)}function Mn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Nn(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Nn(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function Rn(e){return-1!==e}function xn(e){return 32767&e}function Dn(e,t){let n=function(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ln=!0;function Fn(e){const t=Ln;return Ln=e,t}let Un=0;function Bn(e,t){const n=$n(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Vn(r.data,e),Vn(t,null),Vn(r.blueprint,null));const i=zn(e,t),s=e.injectorIndex;if(Rn(i)){const e=xn(i),n=Dn(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function Vn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $n(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function zn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hn(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Qe)&&(r=n[Qe]),null==r&&(r=n[Qe]=Un++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Gn(e,t,n){if(n&Ne.Optional)return e;Ee(t,"NodeInjector")}function qn(e,t,n,r){if(n&Ne.Optional&&void 0===r&&(r=null),0==(n&(Ne.Self|Ne.Host))){const i=e[9],s=xe(void 0);try{return i?i.get(t,r,n&Ne.Optional):De(t,r,n&Ne.Optional)}finally{xe(s)}}return Gn(r,t,n)}function Wn(e,t,n,r=Ne.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Qe)?e[Qe]:void 0;return"number"==typeof t?t>=0?255&t:Zn:t}(n);if("function"==typeof s){if(!un(t,e,r))return r&Ne.Host?Gn(i,n,r):qn(t,n,r,i);try{const e=s(r);if(null!=e||r&Ne.Optional)return e;Ee(n)}finally{gn()}}else if("number"==typeof s){let i=null,o=$n(e,t),a=-1,l=r&Ne.Host?t[16][6]:null;for((-1===o||r&Ne.SkipSelf)&&(a=-1===o?zn(e,t):t[o+8],-1!==a&&Xn(r,!1)?(i=t[1],o=xn(a),t=Dn(a,t)):o=-1);-1!==o;){const e=t[1];if(Jn(s,o,e.data)){const e=Yn(o,t,n,i,r,l);if(e!==jn)return e}a=t[o+8],-1!==a&&Xn(r,t[1].data[o+8]===l)&&Jn(s,o,t)?(i=e,o=xn(a),t=Dn(a,t)):o=-1}}}return qn(t,n,r,i)}const jn={};function Zn(){return new er(qt(),zt())}function Yn(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],l=Kn(a,o,n,null==r?dt(a)&&Ln:r!=o&&0!=(3&a.type),i&Ne.Host&&s===a);return null!==l?Qn(t,o,l,a):jn}function Kn(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,l=e.directiveStart,c=s>>20,u=i?a+c:e.directiveEnd;for(let h=r?a:a+c;h<u;h++){const e=o[h];if(h<l&&n===e||h>=l&&e.type===n)return h}if(i){const e=o[l];if(e&&ft(e)&&e.type===n)return l}return null}function Qn(e,t,n,r){let i=e[n];const s=t.data;if(function(e){return e instanceof Tn}(i)){const o=i;o.resolving&&function(e,t){throw new ve("200",`Circular dependency in DI detected for ${e}`)}(Ce(s[n]));const a=Fn(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?xe(o.injectImpl):null;un(e,r,Ne.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=_t(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==l&&xe(l),Fn(a),o.resolving=!1,gn()}}return i}function Jn(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Xn(e,t){return!(e&Ne.Self||e&Ne.Host&&t)}class er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Wn(this._tNode,this._lView,e,n,t)}}function tr(e){return Le(()=>{const t=e.prototype.constructor,n=t[Ke]||nr(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Ke]||nr(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function nr(e){return ye(e)?()=>{const t=nr(me(e));return t&&t()}:mt(e)}function rr(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(kn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(qt(),e)}const ir="__parameters__";function sr(e,t,n){return Le(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(ir)?e[ir]:Object.defineProperty(e,ir,{value:[]})[ir];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class or{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Se({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ar=new or("AnalyzeForEntryComponents"),lr=Function;function cr(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),cr(r,t)):t!==e&&t.push(r)}return t}function ur(e,t){e.forEach(e=>Array.isArray(e)?ur(e,t):t(e))}function hr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function pr(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function fr(e,t,n){let r=mr(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function gr(e,t){const n=mr(e,t);if(n>=0)return e[1|n]}function mr(e,t){return function(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const s=r+(i-r>>1),o=e[s<<n];if(t===o)return s<<n;o>t?i=s:r=s+1}return~(i<<n)}(e,t,1)}const yr={},vr="__NG_DI_FLAG__",_r="ngTempTokenPath",Cr=/\n/gm,Er="__source",wr=ue({provide:String,useValue:ue});let Sr;function br(e){const t=Sr;return Sr=e,t}function Pr(e,t=Ne.Default){if(void 0===Sr)throw new Error("inject() must be called from an injection context");return null===Sr?De(e,void 0,t):Sr.get(e,t&Ne.Optional?null:void 0,t)}function Or(e,t=Ne.Default){return(Re||Pr)(me(e),t)}function Tr(e){const t=[];for(let n=0;n<e.length;n++){const r=me(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=Ne.Default;for(let t=0;t<r.length;t++){const i=r[t],s=kr(i);"number"==typeof s?-1===s?e=i.token:n|=s:e=i}t.push(Or(e,n))}else t.push(Or(r))}return t}function Ir(e,t){return e[vr]=t,e.prototype[vr]=t,e}function kr(e){return e[vr]}function Ar(e,t,n,r){const i=e[_r];throw t[Er]&&i.unshift(t[Er]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=de(t);if(Array.isArray(t))i=t.map(de).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):de(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Cr,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[_r]=null,e}const Mr=Ir(sr("Inject",e=>({token:e})),-1),Nr=Ir(sr("Optional"),8),Rr=Ir(sr("SkipSelf"),4);let xr,Dr;function Lr(e){var t;return(null===(t=function(){if(void 0===xr&&(xr=null,ze.trustedTypes))try{xr=ze.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return xr}())||void 0===t?void 0:t.createHTML(e))||e}function Fr(e){var t;return(null===(t=function(){if(void 0===Dr&&(Dr=null,ze.trustedTypes))try{Dr=ze.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dr}())||void 0===t?void 0:t.createHTML(e))||e}class Ur{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Br extends Ur{getTypeName(){return"HTML"}}class Vr extends Ur{getTypeName(){return"Style"}}class $r extends Ur{getTypeName(){return"Script"}}class zr extends Ur{getTypeName(){return"URL"}}class Hr extends Ur{getTypeName(){return"ResourceURL"}}function Gr(e){return e instanceof Ur?e.changingThisBreaksApplicationSecurity:e}function qr(e,t){const n=Wr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Wr(e){return e instanceof Ur&&e.getTypeName()||null}function jr(e){const t=new Yr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Lr(""),"text/html")}catch{return!1}}()?new Zr(t):t}class Zr{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Lr(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class Yr{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Lr(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=Lr(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kr=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Jr(e){return(e=String(e)).match(Kr)||e.match(Qr)?e:"unsafe:"+e}function Xr(e){return(e=String(e)).split(",").map(e=>Jr(e.trim())).join(", ")}function ei(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function ti(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const ni=ei("area,br,col,hr,img,wbr"),ri=ei("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ii=ei("rp,rt"),si=ti(ni,ti(ri,ei("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ti(ii,ei("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ti(ii,ri)),oi=ei("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ai=ei("srcset"),li=ti(oi,ai,ei("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ei("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ci=ei("script,style,template");class ui{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!si.hasOwnProperty(t))return this.sanitizedSomething=!0,!ci.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let r=0;r<n.length;r++){const e=n.item(r),t=e.name,i=t.toLowerCase();if(!li.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let s=e.value;oi[i]&&(s=Jr(s)),ai[i]&&(s=Xr(s)),this.buf.push(" ",t,'="',pi(s),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();si.hasOwnProperty(t)&&!ni.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(pi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const hi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,di=/([^\#-~ |!])/g;function pi(e){return e.replace(/&/g,"&amp;").replace(hi,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(di,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let fi;function gi(e,t){let n=null;try{fi=fi||jr(e);let r=t?String(t):"";n=fi.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=fi.getInertBodyElement(r)}while(r!==s);return Lr((new ui).sanitizeChildren(mi(n)||n))}finally{if(n){const e=mi(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function mi(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var yi=(()=>((yi=yi||{})[yi.NONE=0]="NONE",yi[yi.HTML=1]="HTML",yi[yi.STYLE=2]="STYLE",yi[yi.SCRIPT=3]="SCRIPT",yi[yi.URL=4]="URL",yi[yi.RESOURCE_URL=5]="RESOURCE_URL",yi))();function vi(e){const t=Ci();return t?Fr(t.sanitize(yi.HTML,e)||""):qr(e,"HTML")?Fr(Gr(e)):gi(Ot(),_e(e))}function _i(e){const t=Ci();return t?t.sanitize(yi.URL,e)||"":qr(e,"URL")?Gr(e):Jr(_e(e))}function Ci(){const e=zt();return e&&e[12]}const Ei="__ngContext__";function wi(e,t){e[Ei]=t}function Si(e){const t=function(e){return e[Ei]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function bi(e){return e.ngOriginalError}function Pi(e,...t){e.error(...t)}class Oi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=(i=e)&&i.ngErrorLogger||Pi;var i;r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(bi(e)):null}_findOriginalError(e){let t=e&&bi(e);for(;t&&bi(t);)t=bi(t);return t||null}}const Ti=/^>|^->|<!--|-->|--!>|<!-$/g,Ii=/(<|>)/;const ki=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ze))();function Ai(e){return e instanceof Function?e():e}var Mi=(()=>((Mi=Mi||{})[Mi.Important=1]="Important",Mi[Mi.DashCase=2]="DashCase",Mi))();let Ni;function Ri(e,t){return Ni(e,t)}function xi(e){const t=e[3];return ut(t)?t[3]:t}function Di(e){return Fi(e[13])}function Li(e){return Fi(e[4])}function Fi(e){for(;null!==e&&!ut(e);)e=e[4];return e}function Ui(e,t,n,r,i){if(null!=r){let s,o=!1;ut(r)?s=r:ct(r)&&(o=!0,r=r[0]);const a=kt(r);0===e&&null!==n?null==i?Ki(t,n,a):Yi(t,n,a,i||null,!0):1===e&&null!==n?Yi(t,n,a,i||null,!0):2===e?ls(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==kt(n)&&Ui(t,e,r,s,i);for(let o=10;o<n.length;o++){const i=n[o];us(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function Bi(e,t){return Tt(e)?e.createText(t):e.createTextNode(t)}function Vi(e,t,n){Tt(e)?e.setValue(t,n):t.textContent=n}function $i(e,t){return e.createComment(function(e){return e.replace(Ti,e=>e.replace(Ii,"\u200b$1\u200b"))}(t))}function zi(e,t,n){return Tt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Hi(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Bt(i,-1)),n.splice(r,1)}function Gi(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Hi(i,r),t>0&&(e[n-1][4]=r[4]);const s=dr(e,10+t);!function(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function qi(e,t){if(!(256&t[2])){const n=t[11];Tt(n)&&n.destroyNode&&us(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Wi(e[1],e);for(;t;){let n=null;if(ct(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)ct(t)&&Wi(t[1],t),t=t[3];null===t&&(t=e),ct(t)&&Wi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Wi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):kt(t[e]),a=r[i=n[s+2]],l=n[s+3];"boolean"==typeof l?o.removeEventListener(n[s],a,l):l>=0?r[i=l]():r[i=-l].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)r[e]();t[7]=null}}(e,t),1===t[1].type&&Tt(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ut(t[3])){n!==t[3]&&Hi(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function ji(e,t,n){return Zi(e,t.parent,n)}function Zi(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Ue.None||t===Ue.Emulated)return null}return Mt(r,n)}function Yi(e,t,n,r,i){Tt(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Ki(e,t,n){Tt(e)?e.appendChild(t,n):t.appendChild(n)}function Qi(e,t,n,r,i){null!==r?Yi(e,t,n,r,i):Ki(e,t,n)}function Ji(e,t){return Tt(e)?e.parentNode(t):t.parentNode}function Xi(e,t,n){return ns(e,t,n)}function es(e,t,n){return 40&e.type?Mt(e,n):null}let ts,ns=es;function rs(e,t){ns=e,ts=t}function is(e,t,n,r){const i=ji(e,r,t),s=t[11],o=Xi(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)Qi(s,i,n[a],o,!1);else Qi(s,i,n,o,!1);void 0!==ts&&ts(s,r,t,n,i)}function ss(e,t){if(null!==t){const n=t.type;if(3&n)return Mt(t,e);if(4&n)return as(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return ss(e,n);{const n=e[t.index];return ut(n)?as(-1,n):kt(n)}}if(32&n)return Ri(t,e)()||kt(e[t.index]);{const n=os(e,t);return null!==n?Array.isArray(n)?n[0]:ss(xi(e[16]),n):ss(e,t.next)}}return null}function os(e,t){return null!==t?e[16][6].projection[t.projection]:null}function as(e,t){const n=10+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return ss(e,r)}return t[7]}function ls(e,t,n){const r=Ji(e,t);r&&function(e,t,n,r){Tt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function cs(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],l=n.type;if(o&&0===t&&(a&&wi(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&l)cs(e,t,n.child,r,i,s,!1),Ui(t,e,i,a,s);else if(32&l){const o=Ri(n,r);let l;for(;l=o();)Ui(t,e,i,l,s);Ui(t,e,i,a,s)}else 16&l?hs(e,t,r,n,i,s):Ui(t,e,i,a,s);n=o?n.projectionNext:n.next}}function us(e,t,n,r,i,s){cs(n,r,e.firstChild,t,i,s,!1)}function hs(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)Ui(t,e,i,a[l],s);else cs(e,t,a,o[3],i,s,!0)}function ds(e,t,n){Tt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function ps(e,t,n){Tt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function fs(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const gs="ng-template";function ms(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==fs(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ys(e){return 4===e.type&&e.value!==gs}function vs(e,t,n){return t===(4!==e.type||n?e.value:gs)}function _s(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(kn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!vs(e,l,n)||""===l&&1===t.length){if(Cs(r))return!1;o=!0}}else{const c=8&r?l:t[++a];if(8&r&&null!==e.attrs){if(!ms(e.attrs,c,n)){if(Cs(r))return!1;o=!0}continue}const u=Es(8&r?"class":l,i,ys(e),n);if(-1===u){if(Cs(r))return!1;o=!0;continue}if(""!==c){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==fs(t,c,0)||2&r&&c!==e){if(Cs(r))return!1;o=!0}}}}else{if(!o&&!Cs(r)&&!Cs(l))return!1;if(o&&Cs(l))continue;o=!1,r=l|1&r}}return Cs(r)||o}function Cs(e){return 0==(1&e)}function Es(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ws(e,t,n=!1){for(let r=0;r<t.length;r++)if(_s(e,t[r],n))return!0;return!1}function Ss(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function bs(e,t){return e?":not("+t.trim()+")":t}function Ps(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Cs(o)&&(t+=bs(s,i),i=""),r=o,s=s||!Cs(r);n++}return""!==i&&(t+=bs(s,i)),t}const Os={};function Ts(e){Is(Ht(),zt(),yn()+e,Qt())}function Is(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&wn(t,r,n)}else{const r=e.preOrderHooks;null!==r&&Sn(t,r,0,n)}vn(n)}function ks(e,t){return e<<17|t<<2}function As(e){return e>>17&32767}function Ms(e){return 2|e}function Ns(e){return(131068&e)>>2}function Rs(e,t){return-131069&e|t<<2}function xs(e){return 1|e}function Ds(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];ln(i),n.contentQueries(2,t[s],s)}}}function Ls(e,t,n,r,i,s,o,a,l,c){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,Ut(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=l||e&&e[12]||null,u[9]=c||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function Fs(e,t,n,r,i){let s=e.data[t];if(null===s)s=Us(e,t,n,r,i),Vt.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=jt();s.injectorIndex=null===e?-1:e.injectorIndex}return Zt(s,!0),s}function Us(e,t,n,r,i){const s=Wt(),o=Yt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}function Bs(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Vs(e,t,n){hn(t);try{const r=e.viewQuery;null!==r&&_o(1,r,n);const i=e.template;null!==i&&Hs(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ds(e,t),e.staticViewQueries&&_o(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)fo(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,mn()}}function $s(e,t,n,r){const i=t[2];if(256==(256&i))return;hn(t);const s=Qt();try{Ut(t),function(e){Vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Hs(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&wn(t,n,null)}else{const n=e.preOrderHooks;null!==n&&Sn(t,n,0,null),bn(t,0)}if(function(e){for(let t=Di(e);null!==t;t=Li(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Bt(r,1),n[2]|=1024}}}(t),function(e){for(let t=Di(e);null!==t;t=Li(t))for(let e=10;e<t.length;e++){const n=t[e],r=n[1];Lt(n)&&$s(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Ds(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&wn(t,n)}else{const n=e.contentHooks;null!==n&&Sn(t,n,1),bn(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)vn(~r);else{const i=r,s=n[++e],o=n[++e];sn(s,i),o(2,t[i])}}}finally{vn(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)ho(e,t[n])}(t,a);const l=e.viewQuery;if(null!==l&&_o(2,l,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&wn(t,n)}else{const n=e.viewHooks;null!==n&&Sn(t,n,2),bn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Bt(t[3],-1))}finally{mn()}}function zs(e,t,n,r){const i=t[10],s=!Qt(),o=Dt(t);try{s&&!o&&i.begin&&i.begin(),o&&Vs(e,t,r),$s(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function Hs(e,t,n,r,i){const s=yn(),o=2&r;try{vn(-1),o&&t.length>20&&Is(e,t,20,Qt()),n(r,i)}finally{vn(s)}}function Gs(e,t,n){if(ht(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function qs(e,t,n){!$t()||(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Bn(n,t),wi(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=ft(r);s&&so(t,n,r);const l=Qn(t,e,a,n);wi(l,t),null!==o&&lo(0,a-i,l,r,0,o),s&&(xt(n.index,t)[8]=l)}}(e,t,n,Mt(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Vt.lFrame.currentDirectiveIndex;try{vn(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];on(n),(null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs)&&eo(r,i)}}finally{vn(-1),on(o)}}(e,t,n))}function Ws(e,t,n=Mt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function js(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zs(e,t,n,r,i,s,o,a,l,c){const u=20+r,h=u+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Os);return n}(u,h),p="function"==typeof c?c():c;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function Ys(e,t,n,r){const i=Eo(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&wo(e).push(r,i.length-1))}function Ks(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Qs(e,t,n,r,i,s,o,a){const l=Mt(t,n);let c,u=t.inputs;!a&&null!=u&&(c=u[r])?(bo(e,n,c,r,i),dt(t)&&function(e,t){const n=xt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,Tt(s)?s.setProperty(l,r,i):An(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function Js(e,t,n,r){let i=!1;if($t()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];ws(n,o.selectors,!1)&&(i||(i=[]),Hn(Bn(n,t),e,o.type),ft(o)?(to(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,ro(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,l=Bs(e,t,s.length,null);for(let i=0;i<s.length;i++){const c=s[i];n.mergedAttrs=Mn(n.mergedAttrs,c.hostAttrs),io(e,n,t,l,c),no(l,c,o),null!==c.contentQueries&&(n.flags|=8),(null!==c.hostBindings||null!==c.hostAttrs||0!==c.hostVars)&&(n.flags|=128);const u=c.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),l++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let l=t.directiveStart;l<n;l++){const e=r[l],n=e.inputs,c=null===i||ys(t)?null:co(n,i);s.push(c),o=Ks(n,l,o),a=Ks(e.outputs,l,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new ve("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Mn(n.mergedAttrs,n.attrs),i}function Xs(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function eo(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function to(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function no(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;ft(t)&&(n[""]=e)}}function ro(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function io(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=mt(i.type)),o=new Tn(s,ft(i),null);e.blueprint[r]=o,n[r]=o,Xs(e,t,0,r,Bs(e,n,i.hostVars,Os),i)}function so(e,t,n){const r=Mt(t,e),i=js(n),s=e[10],o=go(e,Ls(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function oo(e,t,n,r,i,s){const o=Mt(e,t);ao(t[11],o,s,e.value,n,r,i)}function ao(e,t,n,r,i,s,o){if(null==s)Tt(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==o?_e(s):o(s,r||"",i);Tt(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}function lo(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function co(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function uo(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function ho(e,t){const n=xt(t,e);if(Lt(n)){const e=n[1];80&n[2]?$s(e,n,e.template,n[8]):n[5]>0&&po(n)}}function po(e){for(let n=Di(e);null!==n;n=Li(n))for(let e=10;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];$s(e,t,e.template,t[8])}else t[5]>0&&po(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=xt(t[n],e);Lt(r)&&r[5]>0&&po(r)}}function fo(e,t){const n=xt(t,e),r=n[1];(function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Vs(r,n,n[8])}function go(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function mo(e){for(;e;){e[2]|=64;const t=xi(e);if(gt(e)&&!t)return e;e=t}return null}function yo(e,t,n){const r=t[10];r.begin&&r.begin();try{$s(e,t,e.template,n)}catch(i){throw So(t,i),i}finally{r.end&&r.end()}}function vo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=Si(n),i=r[1];zs(i,r,i.template,n)}}(e[8])}function _o(e,t,n){ln(0),t(e,n)}const Co=(()=>Promise.resolve(null))();function Eo(e){return e[7]||(e[7]=[])}function wo(e){return e.cleanup||(e.cleanup=[])}function So(e,t){const n=e[9],r=n?n.get(Oi,null):null;r&&r.handleError(t)}function bo(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],l=t[o],c=e.data[o];null!==c.setInput?c.setInput(l,i,r,a):l[a]=i}}function Po(e,t,n){const r=At(t,e);Vi(e[11],r,n)}function Oo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=pe(i,e):2==s&&(r=pe(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const To=new or("INJECTOR",-1);class Io{get(e,t=yr){if(t===yr){const t=new Error(`NullInjectorError: No provider for ${de(e)}!`);throw t.name="NullInjectorError",t}return t}}const ko=new or("Set Injector scope."),Ao={},Mo={};let No;function Ro(){return void 0===No&&(No=new Io),No}function xo(e,t=null,n=null,r){return new Do(e,n,t||Ro(),r)}class Do{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&ur(t,n=>this.processProvider(n,e,t)),ur([e],e=>this.processInjectorType(e,[],i)),this.records.set(To,Uo(void 0,this));const s=this.records.get(ko);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:de(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=yr,n=Ne.Default){this.assertNotDestroyed();const r=br(this),i=xe(void 0);try{if(!(n&Ne.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(s=e)||"object"==typeof s&&s instanceof or)&&Pe(e);t=n&&this.injectableDefInScope(n)?Uo(Lo(e),Ao):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&Ne.Self?Ro():this.parent).get(e,t=n&Ne.Optional&&t===yr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_r]=o[_r]||[]).unshift(de(e)),r)throw o;return Ar(o,e,"R3InjectorError",this.source)}throw o}finally{xe(i),br(r)}var s}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(de(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=me(e)))return!1;let r=Te(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=Te(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{ur(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];ur(r,e=>this.processProvider(e,n,r||Ge))}}this.injectorDefTypes.add(s);const a=mt(s)||(()=>new s);this.records.set(s,Uo(a,Ao));const l=r.providers;if(null!=l&&!o){const t=e;ur(l,e=>this.processProvider(e,t,l))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=Vo(e=me(e))?e:me(e&&e.provide);const i=function(e,t,n){return Bo(e)?Uo(void 0,e.useValue):Uo(Fo(e),Ao)}(e);if(Vo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Uo(void 0,Ao,!0),t.factory=()=>Tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){return t.value===Ao&&(t.value=Mo,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}injectableDefInScope(e){if(!e.providedIn)return!1;const t=me(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Lo(e){const t=Pe(e),n=null!==t?t.factory:mt(e);if(null!==n)return n;if(e instanceof or)throw new Error(`Token ${de(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=pr(t,"?");throw new Error(`Can't resolve all parameters for ${de(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[Ie]||e[Ae]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Fo(e,t,n){let r;if(Vo(e)){const t=me(e);return mt(t)||Lo(t)}if(Bo(e))r=()=>me(e.useValue);else if(function(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Or(me(e.useExisting));else{const t=me(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return mt(t)||Lo(t);r=()=>new t(...Tr(e.deps))}return r}function Uo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Bo(e){return null!==e&&"object"==typeof e&&wr in e}function Vo(e){return"function"==typeof e}const $o=function(e,t,n){return function(e,t=null,n=null,r){const i=xo(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let zo=(()=>{class e{static create(e,t){return Array.isArray(e)?$o(e,t,""):$o(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=yr,e.NULL=new Io,e.\u0275prov=Se({token:e,providedIn:"any",factory:()=>Or(To)}),e.__NG_ELEMENT_ID__=-1,e})();function Ho(e,t){En(Si(e)[1],qt())}function Go(e){let t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let i;if(ft(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=qo(e.inputs),t.declaredInputs=qo(e.declaredInputs),t.outputs=qo(e.outputs);const n=i.hostBindings;n&&Zo(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&Wo(e,s),o&&jo(e,o),he(e.inputs,i.inputs),he(e.declaredInputs,i.declaredInputs),he(e.outputs,i.outputs),ft(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Go&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Mn(i.hostAttrs,n=Mn(n,i.hostAttrs))}}(r)}function qo(e){return e===He?{}:e===Ge?[]:e}function Wo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function jo(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function Zo(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Yo=null;function Ko(){if(!Yo){const e=ze.Symbol;if(e&&e.iterator)Yo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Yo=n)}}}return Yo}class Qo{constructor(e){this.wrapped=e}static wrap(e){return new Qo(e)}static unwrap(e){return Qo.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Qo}}function Jo(e){return!!Xo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ko()in e)}function Xo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ea(e,t,n){return e[t]=n}function ta(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function na(e,t,n,r){const i=ta(e,t,n);return ta(e,t+1,r)||i}function ra(e,t,n,r){const i=zt();return ta(i,tn(),t)&&(Ht(),oo(_n(),i,e,t,n,r)),ra}function ia(e,t,n,r){return ta(e,tn(),n)?t+_e(n)+r:Os}function sa(e,t,n,r,i,s){const o=na(e,en(),n,i);return nn(2),o?t+_e(n)+r+_e(i)+s:Os}function oa(e,t,n,r,i,s,o,a){const l=function(e,t,n,r,i){const s=na(e,t,n,r);return ta(e,t+2,i)||s}(e,en(),n,i,o);return nn(3),l?t+_e(n)+r+_e(i)+s+_e(o)+a:Os}function aa(e,t,n,r,i,s){const o=zt(),a=ia(o,t,n,r);return a!==Os&&oo(_n(),o,e,a,i,s),aa}function la(e,t,n,r,i,s,o,a){const l=zt(),c=Ht(),u=e+20,h=c.firstCreatePass?function(e,t,n,r,i,s,o,a,l){const c=t.consts,u=Fs(t,e,4,o||null,Ft(c,a));Js(t,n,u,Ft(c,l)),En(t,u);const h=u.tViews=Zs(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,c,l,t,n,r,i,s,o):c.data[u];Zt(h,!1);const d=l[11].createComment("");is(c,l,d,h),wi(d,l),go(l,l[u]=uo(d,l,d,h)),pt(h)&&qs(c,l,h),null!=o&&Ws(l,h,a)}function ca(e){return Rt(Vt.lFrame.contextLView,20+e)}function ua(e,t=Ne.Default){const n=zt();return null===n?Or(e,t):Wn(qt(),n,me(e),t)}function ha(e,t,n){const r=zt();return ta(r,tn(),t)&&Qs(Ht(),_n(),r,e,t,r[11],n,!1),ha}function da(e,t,n,r,i){const s=i?"class":"style";bo(e,n,t.inputs[s],s,r)}function pa(e,t,n,r){const i=zt(),s=Ht(),o=20+e,a=i[11],l=i[o]=zi(a,t,Vt.lFrame.currentNamespace),c=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,l=Fs(t,e,2,i,Ft(a,s));return Js(t,n,l,Ft(a,o)),null!==l.attrs&&Oo(l,l.attrs,!1),null!==l.mergedAttrs&&Oo(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(o,s,i,0,t,n,r):s.data[o];Zt(c,!0);const u=c.mergedAttrs;null!==u&&In(a,l,u);const h=c.classes;null!==h&&ps(a,l,h);const d=c.styles;null!==d&&ds(a,l,d),64!=(64&c.flags)&&is(s,i,l,c),0===Vt.lFrame.elementDepthCount&&wi(l,i),Vt.lFrame.elementDepthCount++,pt(c)&&(qs(s,i,c),Gs(s,c,i)),null!==r&&Ws(i,c)}function fa(){let e=qt();Yt()?Kt():(e=e.parent,Zt(e,!1));const t=e;Vt.lFrame.elementDepthCount--;const n=Ht();n.firstCreatePass&&(En(n,e),ht(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&da(n,t,zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&da(n,t,zt(),t.stylesWithoutHost,!1)}function ga(e,t,n,r){pa(e,t,n,r),fa()}function ma(e,t,n){const r=zt(),i=Ht(),s=e+20,o=i.firstCreatePass?function(e,t,n,r,i){const s=t.consts,o=Ft(s,r),a=Fs(t,e,8,"ng-container",o);return null!==o&&Oo(a,o,!0),Js(t,n,a,Ft(s,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(s,i,r,t,n):i.data[s];Zt(o,!0);const a=r[s]=r[11].createComment("");is(i,r,a,o),wi(a,r),pt(o)&&(qs(i,r,o),Gs(i,o,r)),null!=n&&Ws(r,o)}function ya(){let e=qt();const t=Ht();Yt()?Kt():(e=e.parent,Zt(e,!1)),t.firstCreatePass&&(En(t,e),ht(e)&&t.queries.elementEnd(e))}function va(){return zt()}function _a(e){return!!e&&"function"==typeof e.then}const Ca=function(e){return!!e&&"function"==typeof e.subscribe};function Ea(e,t,n,r){const i=zt(),s=Ht(),o=qt();return function(e,t,n,r,i,s,o,a){const l=pt(r),c=e.firstCreatePass&&wo(e),u=t[8],h=Eo(t);let d=!0;if(3&r.type||a){const p=Mt(r,t),f=a?a(p):p,g=h.length,m=a?e=>a(kt(e[r.index])):r.index;if(Tt(n)){let o=null;if(!a&&l&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=Sa(r,t,u,s,!1);const e=n.listen(f,i,s);h.push(s,e),c&&c.push(i,m,g,g+1)}}else s=Sa(r,t,u,s,!0),f.addEventListener(i,s,o),h.push(s),c&&c.push(i,m,g,o)}else s=Sa(r,t,u,s,!1);const p=r.outputs;let f;if(d&&null!==p&&(f=p[i])){const e=f.length;if(e)for(let n=0;n<e;n+=2){const e=t[f[n]][f[n+1]].subscribe(s),o=h.length;h.push(s,e),c&&c.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,!!n,r),Ea}function wa(e,t,n,r){try{return!1!==n(r)}catch(i){return So(e,i),!1}}function Sa(e,t,n,r,i){return function n(s){if(s===Function)return r;const o=2&e.flags?xt(e.index,t):t;0==(32&t[2])&&mo(o);let a=wa(t,0,r,s),l=n.__ngNextListenerFn__;for(;l;)a=wa(t,0,l,s)&&a,l=l.__ngNextListenerFn__;return i&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function ba(e=1){return function(e){return(Vt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Vt.lFrame.contextLView))[8]}(e)}function Pa(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const s=t[i];if("*"!==s){if(null===r?ws(e,s,!0):Ss(r,s))return i}else n=i}return n}function Oa(e,t,n){return Ta(e,"",t,"",n),Oa}function Ta(e,t,n,r,i){const s=zt(),o=ia(s,t,n,r);return o!==Os&&Qs(Ht(),_n(),s,e,o,s[11],i,!1),Ta}function Ia(e,t,n,r,i,s,o){const a=zt(),l=sa(a,t,n,r,i,s);return l!==Os&&Qs(Ht(),_n(),a,e,l,a[11],o,!1),Ia}function ka(e,t,n,r,i,s,o,a,l){const c=zt(),u=oa(c,t,n,r,i,s,o,a);return u!==Os&&Qs(Ht(),_n(),c,e,u,c[11],l,!1),ka}function Aa(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?As(s):Ns(s),l=!1;for(;0!==a&&(!1===l||o);){const n=e[a+1];Ma(e[a],t)&&(l=!0,e[a+1]=r?xs(n):Ms(n)),a=r?As(n):Ns(n)}l&&(e[n+1]=r?Ms(s):xs(s))}function Ma(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&mr(e,t)>=0}const Na={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ra(e){return e.substring(Na.key,Na.keyEnd)}function xa(e){return e.substring(Na.value,Na.valueEnd)}function Da(e,t){const n=Na.textEnd;let r=Na.key=La(e,t,n);return n===r?-1:(r=Na.keyEnd=function(e,t,n){let r;for(;t<n&&(45===(r=e.charCodeAt(t))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)t++;return t}(e,r,n),r=Fa(e,r,n),r=Na.value=La(e,r,n),r=Na.valueEnd=function(e,t,n){let r=-1,i=-1,s=-1,o=t,a=o;for(;o<n;){const l=e.charCodeAt(o++);if(59===l)return a;34===l||39===l?a=o=Ua(e,l,o,n):t===o-4&&85===s&&82===i&&76===r&&40===l?a=o=Ua(e,41,o,n):l>32&&(a=o),s=i,i=r,r=-33&l}return a}(e,r,n),Fa(e,r,n))}function La(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function Fa(e,t,n,r){return(t=La(e,t,n))<n&&t++,t}function Ua(e,t,n,r){let i=-1,s=n;for(;s<r;){const n=e.charCodeAt(s++);if(n==t&&92!==i)return s;i=92==n&&92===i?0:n}throw new Error}function Ba(e,t){return function(e,t,n,r){const i=zt(),s=Ht(),o=nn(2);s.firstUpdatePass&&Ha(s,e,o,r),t!==Os&&ta(i,o,t)&&ja(s,s.data[yn()],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=de(Gr(e)))),e}(t,n),r,o)}(e,t,null,!0),Ba}function Va(e){!function(e,t,n,r){const i=Ht(),s=nn(2);i.firstUpdatePass&&Ha(i,null,s,r);const o=zt();if(n!==Os&&ta(o,s,n)){const a=i.data[yn()];if(Ka(a,r)&&!za(i,s)){let e=r?a.classesWithoutHost:a.stylesWithoutHost;null!==e&&(n=pe(e,n||"")),da(i,a,o,n,r)}else!function(e,t,n,r,i,s,o,a){i===Os&&(i=Ge);let l=0,c=0,u=0<i.length?i[0]:null,h=0<s.length?s[0]:null;for(;null!==u||null!==h;){const d=l<i.length?i[l+1]:void 0,p=c<s.length?s[c+1]:void 0;let f,g=null;u===h?(l+=2,c+=2,d!==p&&(g=h,f=p)):null===h||null!==u&&u<h?(l+=2,g=u):(c+=2,g=h,f=p),null!==g&&ja(e,t,n,r,g,f,o,a),u=l<i.length?i[l]:null,h=c<s.length?s[c]:null}}(i,a,o,o[11],o[s+1],o[s+1]=function(e,t,n){if(null==n||""===n)return Ge;const r=[],i=Gr(n);if(Array.isArray(i))for(let s=0;s<i.length;s++)e(r,i[s],!0);else if("object"==typeof i)for(const s in i)i.hasOwnProperty(s)&&e(r,s,i[s]);else"string"==typeof i&&t(r,i);return r}(e,t,n),r,s)}}(Wa,$a,e,!1)}function $a(e,t){for(let n=function(e){return function(e){Na.key=0,Na.keyEnd=0,Na.value=0,Na.valueEnd=0,Na.textEnd=e.length}(e),Da(e,La(e,0,Na.textEnd))}(t);n>=0;n=Da(t,n))Wa(e,Ra(t),xa(t))}function za(e,t){return t>=e.expandoStartIndex}function Ha(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[yn()],o=za(e,n);Ka(s,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Vt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=qa(n=Ga(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Ga(i,e,t,n,r),null===s){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Ns(r))return e[As(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=Ga(null,e,t,n[1],r),n=qa(n,t.attrs,r),function(e,t,n,r){e[As(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else s=function(e,t,n){let r;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=qa(r,e[s].hostAttrs,n);return qa(r,t.attrs,n)}(e,t,r)}return void 0!==s&&(r?t.residualClasses=s:t.residualStyles=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=s?t.classBindings:t.styleBindings,a=As(o),l=Ns(o);e[r]=n;let c,u=!1;if(Array.isArray(n)){const e=n;c=e[1],(null===c||mr(e,c)>0)&&(u=!0)}else c=n;if(i)if(0!==l){const t=As(e[a+1]);e[r+1]=ks(t,a),0!==t&&(e[t+1]=Rs(e[t+1],r)),e[a+1]=function(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=ks(a,0),0!==a&&(e[a+1]=Rs(e[a+1],r)),a=r;else e[r+1]=ks(l,0),0===a?a=r:e[l+1]=Rs(e[l+1],r),l=r;u&&(e[r+1]=Ms(e[r+1])),Aa(e,c,r,!0),Aa(e,c,r,!1),function(e,t,n,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&mr(s,t)>=0&&(n[r+1]=xs(n[r+1]))}(t,c,e,r,s),o=ks(a,l),s?t.classBindings=o:t.styleBindings=o}(i,s,t,n,o,r)}}function Ga(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=qa(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function qa(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),fr(e,o,!!n||t[++s]))}return void 0===e?null:e}function Wa(e,t,n){fr(e,t,Gr(n))}function ja(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const l=e.data,c=l[a+1];Ya(function(e){return 1==(1&e)}(c)?Za(l,t,n,i,Ns(c),o):void 0)||(Ya(s)||function(e){return 2==(2&e)}(c)&&(s=Za(l,null,n,i,a,o)),function(e,t,n,r,i){const s=Tt(e);if(t)i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Mi.DashCase;if(null==i)s?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const o="string"==typeof i&&i.endsWith("!important");o&&(i=i.slice(0,-10),t|=Mi.Important),s?e.setStyle(n,r,i,t):n.style.setProperty(r,i,o?"important":"")}}}(r,o,At(yn(),n),i,s))}function Za(e,t,n,r,i,s){const o=null===t;let a;for(;i>0;){const t=e[i],s=Array.isArray(t),l=s?t[1]:t,c=null===l;let u=n[i+1];u===Os&&(u=c?Ge:void 0);let h=c?gr(u,r):l===r?u:void 0;if(s&&!Ya(h)&&(h=gr(t,r)),Ya(h)&&(a=h,o))return a;const d=e[i+1];i=o?As(d):Ns(d)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=gr(e,r))}return a}function Ya(e){return void 0!==e}function Ka(e,t){return 0!=(e.flags&(t?16:32))}function Qa(e,t=""){const n=zt(),r=Ht(),i=e+20,s=r.firstCreatePass?Fs(r,i,1,t,null):r.data[i],o=n[i]=Bi(n[11],t);is(r,n,o,s),Zt(s,!1)}function Ja(e){return Xa("",e,""),Ja}function Xa(e,t,n){const r=zt(),i=ia(r,e,t,n);return i!==Os&&Po(r,yn(),i),Xa}function el(e,t,n,r,i){const s=zt(),o=sa(s,e,t,n,r,i);return o!==Os&&Po(s,yn(),o),el}function tl(e,t,n,r,i,s,o){const a=zt(),l=oa(a,e,t,n,r,i,s,o);return l!==Os&&Po(a,yn(),l),tl}function nl(e,t,n){const r=zt();return ta(r,tn(),t)&&Qs(Ht(),_n(),r,e,t,r[11],n,!0),nl}const rl=void 0;var il=["en",[["a","p"],["AM","PM"],rl],[["AM","PM"],rl,rl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],rl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],rl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",rl,"{1} 'at' {0}",rl],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){const t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let sl={};function ol(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=ll(t);if(n)return n;const r=t.split("-")[0];if(n=ll(r),n)return n;if("en"===r)return il;throw new Error(`Missing locale data for the locale "${e}".`)}function al(e){return ol(e)[cl.PluralCase]}function ll(e){return e in sl||(sl[e]=ze.ng&&ze.ng.common&&ze.ng.common.locales&&ze.ng.common.locales[e]),sl[e]}var cl=(()=>((cl=cl||{})[cl.LocaleId=0]="LocaleId",cl[cl.DayPeriodsFormat=1]="DayPeriodsFormat",cl[cl.DayPeriodsStandalone=2]="DayPeriodsStandalone",cl[cl.DaysFormat=3]="DaysFormat",cl[cl.DaysStandalone=4]="DaysStandalone",cl[cl.MonthsFormat=5]="MonthsFormat",cl[cl.MonthsStandalone=6]="MonthsStandalone",cl[cl.Eras=7]="Eras",cl[cl.FirstDayOfWeek=8]="FirstDayOfWeek",cl[cl.WeekendRange=9]="WeekendRange",cl[cl.DateFormat=10]="DateFormat",cl[cl.TimeFormat=11]="TimeFormat",cl[cl.DateTimeFormat=12]="DateTimeFormat",cl[cl.NumberSymbols=13]="NumberSymbols",cl[cl.NumberFormats=14]="NumberFormats",cl[cl.CurrencyCode=15]="CurrencyCode",cl[cl.CurrencySymbol=16]="CurrencySymbol",cl[cl.CurrencyName=17]="CurrencyName",cl[cl.Currencies=18]="Currencies",cl[cl.Directionality=19]="Directionality",cl[cl.PluralCase=20]="PluralCase",cl[cl.ExtraData=21]="ExtraData",cl))();const ul=["zero","one","two","few","many"],hl="en-US",dl={marker:"element"},pl={marker:"ICU"};var fl=(()=>((fl=fl||{})[fl.SHIFT=2]="SHIFT",fl[fl.APPEND_EAGERLY=1]="APPEND_EAGERLY",fl[fl.COMMENT=2]="COMMENT",fl))();let gl=hl;function ml(e){(function(e,t){null==e&&we(t,e,null,"!=")})(e,"Expected localeId to be defined"),"string"==typeof e&&(gl=e.toLowerCase().replace(/_/g,"-"))}function yl(e,t,n){const r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?es(e,0,n):kt(n[i])}function vl(e,t,n,r,i){const s=t.insertBeforeIndex;if(Array.isArray(s)){let o=r,a=null;if(3&t.type||(a=o,o=i),null!==o&&0==(2&t.flags))for(let t=1;t<s.length;t++)Yi(e,o,n[s[t]],a,!1)}}function _l(e,t){if(e.push(t),e.length>1)for(let n=e.length-2;n>=0;n--){const r=e[n];Cl(r)||El(r,t)&&null===wl(r)&&Sl(r,t.index)}}function Cl(e){return!(64&e.type)}function El(e,t){return Cl(t)||e.index>t.index}function wl(e){const t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function Sl(e,t){const n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(rs(yl,vl),e.insertBeforeIndex=t)}function bl(e,t){const n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function Pl(e,t,n){const r=Us(e,n,64,null,null);return _l(t,r),r}function Ol(e,t){const n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function Tl(e){return e>>>17}function Il(e){return(131070&e)>>>1}let kl=0,Al=0;function Ml(e,t,n,r){const i=n[11];let s,o=null;for(let a=0;a<t.length;a++){const l=t[a];if("string"==typeof l){const e=t[++a];null===n[e]&&(n[e]=Bi(i,l))}else if("number"==typeof l)switch(1&l){case 0:const c=Tl(l);let u,h;if(null===o&&(o=c,s=Ji(i,r)),c===o?(u=r,h=s):(u=null,h=kt(n[c])),null!==h){const t=Il(l);Yi(i,h,n[t],u,!1);const r=bl(e,t);if(null!==r&&"object"==typeof r){const t=Ol(r,n);null!==t&&Ml(e,r.create[t],n,n[r.anchorIdx])}}break;case 1:const d=t[++a],p=t[++a];ao(i,At(l>>>1,n),null,null,d,p,null);break;default:throw new Error(`Unable to determine the type of mutate operation for "${l}"`)}else switch(l){case pl:const e=t[++a],r=t[++a];null===n[r]&&wi(n[r]=$i(i,e),n);break;case dl:const s=t[++a],o=t[++a];null===n[o]&&wi(n[o]=zi(i,s,null),n)}}}function Nl(e,t,n,r,i){for(let s=0;s<n.length;s++){const o=n[s],a=n[++s];if(o&i){let i="";for(let o=s+1;o<=s+a;o++){const s=n[o];if("string"==typeof s)i+=s;else if("number"==typeof s)if(s<0)i+=_e(t[r-s]);else{const a=s>>>2;switch(3&s){case 1:const s=n[++o],l=n[++o],c=e.data[a];"string"==typeof c?ao(t[11],t[a],null,c,s,i,l):Qs(e,c,t,s,i,t[11],l,!1);break;case 0:const u=t[a];null!==u&&Vi(t[11],u,i);break;case 2:xl(e,bl(e,a),t,i);break;case 3:Rl(e,bl(e,a),r,t)}}}}else{const i=n[s+1];if(i>0&&3==(3&i)){const n=bl(e,i>>>2);t[n.currentCaseLViewIndex]<0&&Rl(e,n,r,t)}}s+=a}}function Rl(e,t,n,r){let i=r[t.currentCaseLViewIndex];if(null!==i){let s=kl;i<0&&(i=r[t.currentCaseLViewIndex]=~i,s=-1),Nl(e,r,t.update[i],n,s)}}function xl(e,t,n,r){const i=function(e,t){let n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:{const r=function(e,t){const n=al(t)(parseInt(e,10)),r=ul[n];return void 0!==r?r:"other"}(t,gl);n=e.cases.indexOf(r),-1===n&&"other"!==r&&(n=e.cases.indexOf("other"));break}case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(Ol(t,n)!==i&&(Dl(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){const r=n[t.anchorIdx];r&&Ml(e,t.create[i],n,r)}}function Dl(e,t,n){let r=Ol(t,n);if(null!==r){const i=t.remove[r];for(let t=0;t<i.length;t++){const r=i[t];if(r>0){const e=At(r,n);null!==e&&ls(n[11],e)}else Dl(e,bl(e,~r),n)}}}function Ll(){const e=[];let t,n,r=-1;function i(e,t){r=0;const i=Ol(e,t);n=null!==i?e.remove[i]:Ge}function s(){if(r<n.length){const o=n[r++];return o>0?t[o]:(e.push(r,n),i(t[1].data[~o],t),s())}return 0===e.length?null:(n=e.pop(),r=e.pop(),s())}return function(n,r){for(t=r;e.length;)e.pop();return i(n.value,r),s}}const Fl=/\ufffd(\d+):?\d*\ufffd/gi,Ul=/\ufffd(\d+)\ufffd/,Bl=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,Vl=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,$l=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,zl=/\uE500/g;function Hl(e,t,n,r,i,s,o){const a=Bs(e,r,1,null);let l=a<<fl.SHIFT,c=jt();t===c&&(c=null),null===c&&(l|=fl.APPEND_EAGERLY),o&&(l|=fl.COMMENT,function(e){void 0===Ni&&(Ni=e())}(Ll)),i.push(l,null===s?"":s);const u=Us(e,a,o?32:1,null===s?"":s,null);_l(n,u);const h=u.index;return Zt(u,!1),null!==c&&t!==c&&function(e,t){let n=e.insertBeforeIndex;null===n?(rs(yl,vl),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){e!=t&&we(n,e,t,"==")}(Array.isArray(n),!0,"Expecting array here"),n.push(t))}(c,h),u}function Gl(e,t,n,r,i,s,o){const a=o.match(Fl),l=Hl(e,t,n,s,r,a?null:o,!1);a&&ql(i,o,l.index,null,0,null)}function ql(e,t,n,r,i,s){const o=e.length,a=o+1;e.push(null,null);const l=o+2,c=t.split(Fl);let u=0;for(let h=0;h<c.length;h++){const t=c[h];if(1&h){const n=i+parseInt(t,10);e.push(-1-n),u|=Wl(n)}else""!==t&&e.push(t)}return e.push(n<<2|(r?1:0)),r&&e.push(r,s),e[o]=u,e[a]=e.length-l,u}function Wl(e){return 1<<Math.min(e,31)}function jl(e){let t,n,r="",i=0,s=!1;for(;null!==(t=Vl.exec(e));)s?t[0]===`\ufffd/*${n}\ufffd`&&(i=t.index,s=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],s=!0);return r+=e.substr(i),r}function Zl(e,t,n,r,i,s){let o=0;const a={type:i.type,currentCaseLViewIndex:Bs(e,t,1,null),anchorIdx:s,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(Wl(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,s),function(e,t,n){const r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,s,a);const l=i.values;for(let c=0;c<l.length;c++){const s=l[c],u=[];for(let e=0;e<s.length;e++){const t=s[e];if("string"!=typeof t){const n=u.push(t)-1;s[e]=`\x3c!--\ufffd${n}\ufffd--\x3e`}}o=Ql(e,a,t,n,r,i.cases[c],s.join(""),u)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,s)}function Yl(e){const t=[],n=[];let r=1,i=0;const s=Kl(e=e.replace(Bl,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""}));for(let o=0;o<s.length;){let e=s[o++].trim();1===r&&(e=e.replace(/\s*(?:=)?(\w+)\s*/,"$1")),e.length&&t.push(e);const i=Kl(s[o++]);t.length>n.length&&n.push(i)}return{type:r,mainBinding:i,cases:t,values:n}}function Kl(e){if(!e)return[];let t=0;const n=[],r=[],i=/[{}]/g;let s;for(i.lastIndex=0;s=i.exec(e);){const i=s.index;if("}"==s[0]){if(n.pop(),0==n.length){const n=e.substring(t,i);Bl.test(n)?r.push(Yl(n)):r.push(n),t=i+1}}else{if(0==n.length){const n=e.substring(t,i);r.push(n),t=i+1}n.push("{")}}const o=e.substring(t);return r.push(o),r}function Ql(e,t,n,r,i,s,o,a){const l=[],c=[],u=[];t.cases.push(s),t.create.push(l),t.remove.push(c),t.update.push(u);const h=jr(Ot()).getInertBodyElement(o),d=mi(h)||h;return d?Jl(e,t,n,r,l,c,u,d,i,a,0):0}function Jl(e,t,n,r,i,s,o,a,l,c,u){let h=0,d=a.firstChild;for(;d;){const a=Bs(e,n,1,null);switch(d.nodeType){case Node.ELEMENT_NODE:const p=d,f=p.tagName.toLowerCase();if(si.hasOwnProperty(f)){tc(i,dl,f,l,a),e.data[a]=f;const g=p.attributes;for(let e=0;e<g.length;e++){const t=g.item(e),n=t.name.toLowerCase();t.value.match(Fl)?li.hasOwnProperty(n)&&ql(o,t.value,a,t.name,0,oi[n]?Jr:ai[n]?Xr:null):nc(i,a,t)}h=Jl(e,t,n,r,i,s,o,d,a,c,u+1)|h,Xl(s,a,u)}break;case Node.TEXT_NODE:const g=d.textContent||"",m=g.match(Fl);tc(i,null,m?"":g,l,a),Xl(s,a,u),m&&(h=ql(o,g,a,null,0,null)|h);break;case Node.COMMENT_NODE:const y=Ul.exec(d.textContent||"");if(y){const t=c[parseInt(y[1],10)];tc(i,pl,"",l,a),Zl(e,n,r,l,t,a),ec(s,a,u)}}d=d.nextSibling}return h}function Xl(e,t,n){0===n&&e.push(t)}function ec(e,t,n){0===n&&(e.push(~t),e.push(t))}function tc(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function nc(e,t,n){e.push(t<<1|1,n.name,n.value)}function rc(e,t,n=-1){const r=Ht(),i=zt(),s=20+e,o=Ft(r.consts,t),a=jt();r.firstCreatePass&&function(e,t,n,r,i,s){const o=jt(),a=[],l=[],c=[[]],u=function(e){return e.replace(zl," ")}(i=function(e,t){if(function(e){return-1===e}(t))return jl(e);{const n=e.indexOf(`:${t}\ufffd`)+2+t.toString().length,r=e.search(new RegExp(`\ufffd\\/\\*\\d+:${t}\ufffd`));return jl(e.substring(n,r))}}(i,s)).split($l);for(let h=0;h<u.length;h++){let r=u[h];if(0==(1&h)){const s=Kl(r);for(let r=0;r<s.length;r++){let u=s[r];if(0==(1&r)){const t=u;""!==t&&Gl(e,o,c[0],a,l,n,t)}else{const r=u;if("object"!=typeof r)throw new Error(`Unable to parse ICU expression in "${i}" message.`);Zl(e,n,l,t,r,Hl(e,o,c[0],n,a,"",!0).index)}}}else{const t=47===r.charCodeAt(0),n=(r.charCodeAt(t?1:0),20+Number.parseInt(r.substring(t?2:1)));if(t)c.shift(),Zt(jt(),!1);else{const t=Pl(e,c[0],n);c.unshift([]),Zt(t,!0)}}}e.data[r]={create:a,update:l}}(r,null===a?0:a.index,i,s,o,n);const l=r.data[s],c=Zi(r,a===i[6]?null:a,i);(function(e,t,n,r){const i=e[11];for(let s=0;s<t.length;s++){const o=t[s++],a=t[s],l=(o&fl.COMMENT)===fl.COMMENT,c=(o&fl.APPEND_EAGERLY)===fl.APPEND_EAGERLY,u=o>>>fl.SHIFT;let h=e[u];null===h&&(h=e[u]=l?i.createComment(a):Bi(i,a)),c&&null!==n&&Yi(i,n,h,r,!1)}})(i,l.create,c,a&&8&a.type?i[a.index]:null),rn(!0)}function ic(){rn(!1)}function sc(e,t,n){rc(e,t,n),ic()}function oc(e){return function(e){e&&(kl|=1<<Math.min(Al,31)),Al++}(ta(zt(),tn(),e)),oc}function ac(e){!function(e,t,n){if(Al>0){const r=e.data[n];Nl(e,t,Array.isArray(r)?r:r.update,en()-Al-1,kl)}kl=0,Al=0}(Ht(),zt(),e+20)}function lc(e,t,n,r,i){if(e=me(e),Array.isArray(e))for(let s=0;s<e.length;s++)lc(e[s],t,n,r,i);else{const s=Ht(),o=zt();let a=Vo(e)?e:me(e.provide),l=Fo(e);const c=qt(),u=1048575&c.providerIndexes,h=c.directiveStart,d=c.providerIndexes>>20;if(Vo(e)||!e.multi){const r=new Tn(l,i,ua),p=hc(a,t,i?u:u+d,h);-1===p?(Hn(Bn(c,o),s,a),cc(s,e,t.length),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(r),o.push(r)):(n[p]=r,o[p]=r)}else{const p=hc(a,t,u+d,h),f=hc(a,t,u,u+d),g=p>=0&&n[p],m=f>=0&&n[f];if(i&&!m||!i&&!g){Hn(Bn(c,o),s,a);const u=function(e,t,n,r,i){const s=new Tn(e,n,ua);return s.multi=[],s.index=t,s.componentProviders=0,uc(s,i,r&&!n),s}(i?pc:dc,n.length,i,r,l);!i&&m&&(n[f].providerFactory=u),cc(s,e,t.length,0),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(u),o.push(u)}else cc(s,e,p>-1?p:f,uc(n[i?f:p],l,!i&&r));!i&&r&&m&&n[f].componentProviders++}}}function cc(e,t,n,r){const i=Vo(t);if(i||function(e){return!!e.useClass}(t)){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function uc(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function hc(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function dc(e,t,n,r){return fc(this.multi,[])}function pc(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Qn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),fc(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],fc(i,s);return s}function fc(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function gc(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ht();if(r.firstCreatePass){const i=ft(e);lc(n,r.data,r.blueprint,i,!0),lc(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class mc{}const yc="ngComponent";class vc{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${de(e)}. Did you add it to @NgModule.entryComponents?`);return t[yc]=e,t}(e)}}let _c=(()=>{class e{}return e.NULL=new vc,e})();function Cc(...e){}function Ec(e,t){return new Sc(Mt(e,t))}const wc=function(){return Ec(qt(),zt())};let Sc=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=wc,e})();function bc(e){return e instanceof Sc?e.nativeElement:e}class Pc{}let Oc=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Tc(),e})();const Tc=function(){const e=zt(),t=xt(qt().index,e);return function(e){return e[11]}(ct(t)?t:e)};let Ic=(()=>{class e{}return e.\u0275prov=Se({token:e,providedIn:"root",factory:()=>null}),e})();class kc{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const Ac=new kc("12.2.16");class Mc{constructor(){}supports(e){return Jo(e)}create(e){return new Rc(e)}}const Nc=(e,t)=>t;class Rc{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||Nc}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<Fc(n,r,i)?t:n,o=Fc(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Jo(e))throw new Error(`Error trying to diff '${de(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Ko()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new xc(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Lc),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lc),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class xc{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Dc{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class Lc{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new Dc,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Fc(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class Uc{constructor(){}supports(e){return e instanceof Map||Xo(e)}create(){return new Bc}}class Bc{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Xo(e)))throw new Error(`Error trying to diff '${de(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Vc(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Vc{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function $c(){return new zc([new Mc])}let zc=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||$c()),deps:[[e,new Rr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}return e.\u0275prov=Se({token:e,providedIn:"root",factory:$c}),e})();function Hc(){return new Gc([new Uc])}let Gc=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Hc()),deps:[[e,new Rr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=Se({token:e,providedIn:"root",factory:Hc}),e})();function qc(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(kt(s)),ut(s))for(let e=10;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&qc(t[1],t,n,r)}const o=n.type;if(8&o)qc(e,t,n.child,r);else if(32&o){const e=Ri(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=os(t,n);if(Array.isArray(e))r.push(...e);else{const n=xi(t[16]);qc(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class Wc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return qc(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ut(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Gi(e,n),dr(t,n))}this._attachedToViewContainer=!1}qi(this._lView[1],this._lView)}onDestroy(e){Ys(this._lView[1],this._lView,null,e)}markForCheck(){mo(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){yo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Jt(!0);try{yo(e,t,n)}finally{Jt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,us(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class jc extends Wc{constructor(e){super(e),this._view=e}detectChanges(){vo(this._view)}checkNoChanges(){!function(e){Jt(!0);try{vo(e)}finally{Jt(!1)}}(this._view)}get context(){return null}}const Zc=function(e){return function(e,t,n){if(dt(e)&&!n){const n=xt(e.index,t);return new Wc(n,n)}return 47&e.type?new Wc(t[16],t):null}(qt(),zt(),16==(16&e))};let Yc=(()=>{class e{}return e.__NG_ELEMENT_ID__=Zc,e})();const Kc=[new Uc],Qc=new zc([new Mc]),Jc=new Gc(Kc),Xc=function(){return ru(qt(),zt())};let eu=(()=>{class e{}return e.__NG_ELEMENT_ID__=Xc,e})();const tu=eu,nu=class extends tu{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ls(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vs(t,n,e),new Wc(n)}};function ru(e,t){return 4&e.type?new nu(t,e,Ec(e,t)):null}class iu{}class su{}const ou=function(){return du(qt(),zt())};let au=(()=>{class e{}return e.__NG_ELEMENT_ID__=ou,e})();const lu=au,cu=class extends lu{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Ec(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const e=zn(this._hostTNode,this._hostLView);if(Rn(e)){const t=Dn(e,this._hostLView),n=xn(e);return new er(t[1].data[n+8],t)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=uu(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(iu,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(ut(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new cu(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-10?(t[4]=n[i],hr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=as(i,s),a=n[11],l=Ji(a,s[7]);return null!==l&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,us(e,r,n,1,i,s)}(r,s[6],a,n,l,o),e.attachToViewContainerRef(),hr(hu(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=uu(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);n&&(dr(hu(this._lContainer),t),qi(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);return n&&null!=dr(hu(this._lContainer),t)?new Wc(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function uu(e){return e[8]}function hu(e){return e[8]||(e[8]=[])}function du(e,t){let n;const r=t[e.index];if(ut(r))n=r;else{let i;if(8&e.type)i=kt(r);else{const n=t[11];i=n.createComment("");const r=Mt(e,t);Yi(n,Ji(n,r),i,function(e,t){return Tt(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=uo(r,t,i,e),go(t,n)}return new cu(n,e,t)}const pu={};class fu extends _c{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=at(e);return new yu(t,this.ngModule)}}function gu(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const mu=new or("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ki});class yu extends mc{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ps).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return gu(this.componentDef.inputs)}get outputs(){return gu(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,pu,i);return s!==pu||r===pu?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(Pc,It),o=i.get(Ic,null),a=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=n?function(e,t,n){if(Tt(e))return e.selectRootElement(t,n===Ue.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):zi(s.createRenderer(null,this.componentDef),l,function(e){const t=e.toLowerCase();return"svg"===t?bt:"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),u=this.componentDef.onPush?576:528,h=function(e,t){return{components:[],scheduler:e||ki,clean:Co,playerHandler:t||null,flags:0}}(),d=Zs(0,null,null,1,0,null,null,null,null,null),p=Ls(null,d,h,u,null,null,s,a,o,i);let f,g;hn(p);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=Fs(o,20,2,"#host",null),l=a.mergedAttrs=t.hostAttrs;null!==l&&(Oo(a,l,!0),null!==e&&(In(i,e,l),null!==a.classes&&ps(i,e,a.classes),null!==a.styles&&ds(i,e,a.styles)));const c=r.createRenderer(e,t),u=Ls(n,js(t),null,t.onPush?64:16,n[20],a,r,c,s||null,null);return o.firstCreatePass&&(Hn(Bn(a,n),o,t.type),to(o,a),ro(a,n.length,1)),go(n,u),n[20]=u}(c,this.componentDef,p,s,a);if(c)if(n)In(a,c,["ng-version",Ac.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Cs(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&In(a,c,e),t&&t.length>0&&ps(a,c,t.join(" "))}if(g=Nt(d,20),void 0!==t){const e=g.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}f=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=qt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),io(e,r,t,Bs(e,t,1,null),n));const i=Qn(t,e,r.directiveStart,r);wi(i,t);const s=Mt(r,t);return s&&wi(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=qt();t.contentQueries(1,o,e.directiveStart)}const a=qt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(vn(a.index),Xs(n[1],a,0,a.directiveStart,a.directiveEnd,t),eo(t,o)),o}(e,this.componentDef,p,h,[Ho]),Vs(d,p,null)}finally{mn()}return new vu(this.componentType,f,Ec(g,p),p,g)}}class vu extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new jc(r),this.componentType=e}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const _u=new Map;class Cu extends iu{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new fu(this);const n=lt(e),r=e[Ye]||null;r&&ml(r),this._bootstrapComponents=Ai(n.bootstrap),this._r3Injector=xo(e,t,[{provide:iu,useValue:this},{provide:_c,useValue:this.componentFactoryResolver}],de(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=zo.THROW_IF_NOT_FOUND,n=Ne.Default){return e===zo||e===iu||e===To?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Eu extends su{constructor(e){super(),this.moduleType=e,null!==lt(e)&&function(e){const t=new Set;!function e(n){const r=lt(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${de(t)} vs ${de(t.name)}`)}(i,_u.get(i),n),_u.set(i,n));const s=Ai(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new Cu(this.moduleType,e)}}function wu(e,t,n){const r=Xt()+e,i=zt();return i[r]===Os?ea(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function Su(e,t,n,r){return Tu(zt(),Xt(),e,t,n,r)}function bu(e,t,n,r,i){return Iu(zt(),Xt(),e,t,n,r,i)}function Pu(e,t,n,r,i,s,o){return function(e,t,n,r,i,s,o,a,l){const c=t+n;return function(e,t,n,r,i,s){const o=na(e,t,n,r);return na(e,t+2,i,s)||o}(e,c,i,s,o,a)?ea(e,c+4,l?r.call(l,i,s,o,a):r(i,s,o,a)):Ou(e,c+4)}(zt(),Xt(),e,t,n,r,i,s,o)}function Ou(e,t){const n=e[t];return n===Os?void 0:n}function Tu(e,t,n,r,i,s){const o=t+n;return ta(e,o,i)?ea(e,o+1,s?r.call(s,i):r(i)):Ou(e,o+1)}function Iu(e,t,n,r,i,s,o){const a=t+n;return na(e,a,i,s)?ea(e,a+2,o?r.call(o,i,s):r(i,s)):Ou(e,a+2)}function ku(e,t){const n=Ht();let r;const i=e+20;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new ve("302",`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=mt(r.type)),o=xe(ua);try{const e=Fn(!1),t=s();return Fn(e),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,zt(),i,t),t}finally{xe(o)}}function Au(e,t,n){const r=e+20,i=zt(),s=Rt(i,r);return Nu(i,Mu(i,r)?Tu(i,Xt(),t,s.transform,n,s):s.transform(n))}function Mu(e,t){return e[1].data[t].pure}function Nu(e,t){return Qo.isWrapped(t)&&(t=Qo.unwrap(t),e[en()]=Os),t}function Ru(e){return t=>{setTimeout(e,void 0,t)}}const xu=class extends A{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,i,s;let o=e,l=t||(()=>null),c=n;if(e&&"object"==typeof e){const t=e;o=null===(r=t.next)||void 0===r?void 0:r.bind(t),l=null===(i=t.error)||void 0===i?void 0:i.bind(t),c=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(l=Ru(l),o&&(o=Ru(o)),c&&(c=Ru(c)));const u=super.subscribe({next:o,error:l,complete:c});return e instanceof a&&e.add(u),u}};function Du(){return this._results[Ko()]()}class Lu{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Ko(),n=Lu.prototype;n[t]||(n[t]=Du)}get changes(){return this._changes||(this._changes=new xu)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=cr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Fu{constructor(e){this.queryList=e,this.matches=null}clone(){return new Fu(this.queryList)}setDirty(){this.queryList.setDirty()}}class Uu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new Uu(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==Yu(e,t).matches&&this.queries[t].setDirty()}}class Bu{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Vu{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new Vu(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class $u{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new $u(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,zu(t,i)),this.matchTNodeWithReadOption(e,t,Kn(t,e,i,!1,!1))}else n===eu?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kn(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===Sc||r===au||r===eu&&4&t.type)this.addMatch(t.index,-2);else{const n=Kn(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function zu(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function Hu(e,t,n,r){return-1===n?function(e,t){return 11&e.type?Ec(e,t):4&e.type?ru(e,t):null}(t,e):-2===n?function(e,t,n){return n===Sc?Ec(t,e):n===eu?ru(t,e):n===au?du(t,e):void 0}(e,t,r):Qn(e,e[1],n,t)}function Gu(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,s=n.matches,o=[];for(let e=0;e<s.length;e+=2){const i=s[e];o.push(i<0?null:Hu(t,r[i],s[e+1],n.metadata.read))}i.matches=o}return i.matches}function qu(e,t,n,r){const i=e.queries.getByIndex(n),s=i.matches;if(null!==s){const o=Gu(e,t,i,n);for(let e=0;e<s.length;e+=2){const n=s[e];if(n>0)r.push(o[e/2]);else{const i=s[e+1],o=t[-n];for(let e=10;e<o.length;e++){const t=o[e];t[17]===t[3]&&qu(t[1],t,i,r)}if(null!==o[9]){const e=o[9];for(let t=0;t<e.length;t++){const n=e[t];qu(n[1],n,i,r)}}}}}return r}function Wu(e){const t=zt(),n=Ht(),r=an();ln(r+1);const i=Yu(n,r);if(e.dirty&&Dt(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?qu(n,t,r,[]):Gu(n,t,i,r);e.reset(s,bc),e.notifyOnChanges()}return!0}return!1}function ju(e,t,n){const r=Ht();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Vu),e.queries.track(new $u(t,n))}(r,new Bu(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){const r=new Lu(4==(4&n));Ys(e,t,r,r.destroy),null===t[19]&&(t[19]=new Uu),t[19].queries.push(new Fu(r))}(r,zt(),t)}function Zu(){return e=zt(),t=an(),e[19].queries[t].queryList;var e,t}function Yu(e,t){return e.queries.getByIndex(t)}function Ku(e,t){return ru(e,t)}const Qu=new or("Application Initializer");let Ju=(()=>{class e{constructor(e){this.appInits=e,this.resolve=Cc,this.reject=Cc,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(_a(t))e.push(t);else if(Ca(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(Qu,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Xu=new or("AppId"),eh={provide:Xu,useFactory:function(){return`${th()}${th()}${th()}`},deps:[]};function th(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const nh=new or("Platform Initializer"),rh=new or("Platform ID"),ih=new or("appBootstrapListener");let sh=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const oh=new or("LocaleId"),ah=new or("DefaultCurrencyCode");class lh{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const ch=function(e){return new Eu(e)},uh=ch,hh=function(e){return Promise.resolve(ch(e))},dh=function(e){const t=ch(e),n=Ai(lt(e).declarations).reduce((e,t)=>{const n=at(t);return n&&e.push(new yu(n)),e},[]);return new lh(t,n)},ph=dh,fh=function(e){return Promise.resolve(dh(e))};let gh=(()=>{class e{constructor(){this.compileModuleSync=uh,this.compileModuleAsync=hh,this.compileModuleAndAllComponentsSync=ph,this.compileModuleAndAllComponentsAsync=fh}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const mh=(()=>Promise.resolve(0))();function yh(e){"undefined"==typeof Zone?mh.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class vh{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new xu(!1),this.onMicrotaskEmpty=new xu(!1),this.onStable=new xu(!1),this.onError=new xu(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ze,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Eh(e),e.isCheckStableRunning=!0,Ch(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Eh(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return wh(e),n.invokeTask(i,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),Sh(e)}},onInvoke:(n,r,i,s,o,a,l)=>{try{return wh(e),n.invoke(i,s,o,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),Sh(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Eh(e),Ch(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!vh.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(vh.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,_h,Cc,Cc);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const _h={};function Ch(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Eh(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function wh(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Sh(e){e._nesting--,Ch(e)}class bh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xu,this.onMicrotaskEmpty=new xu,this.onStable=new xu,this.onError=new xu}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let Ph=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{vh.assertNotInAngularZone(),yh(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())yh(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Or(vh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Oh=(()=>{class e{constructor(){this._applications=new Map,Ih.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Ih.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class Th{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let Ih=new Th,kh=!0,Ah=!1;let Mh;const Nh=new or("AllowMultipleToken");class Rh{constructor(e,t){this.name=e,this.token=t}}function xh(e,t,n=[]){const r=`Platform: ${t}`,i=new or(r);return(t=[])=>{let s=Dh();if(!s||s.injector.get(Nh,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:ko,useValue:"platform"});!function(e){if(Mh&&!Mh.destroyed&&!Mh.injector.get(Nh,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Mh=e.get(Lh);const t=e.get(nh,null);t&&t.forEach(e=>e())}(zo.create({providers:e,name:r}))}return function(e){const t=Dh();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Dh(){return Mh&&!Mh.destroyed?Mh:null}let Lh=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new bh:("zone.js"===e?void 0:e)||new vh({enableLongStackTrace:(Ah=!0,kh),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:vh,useValue:n}];return n.run(()=>{const i=zo.create({providers:r,parent:this.injector,name:e.moduleType.name}),s=e.create(i),o=s.injector.get(Oi,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});s.onDestroy(()=>{Bh(this._modules,s),e.unsubscribe()})}),function(e,n,r){try{const t=r();return _a(t)?t.catch(t=>{throw n.runOutsideAngular(()=>e.handleError(t)),t}):t}catch(t){throw n.runOutsideAngular(()=>e.handleError(t)),t}}(o,n,()=>{const e=s.injector.get(Ju);return e.runInitializers(),e.donePromise.then(()=>(ml(s.injector.get(oh,hl)||hl),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const n=Fh({},t);return function(e,t,n){const r=new Eu(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(Uh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${de(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Fh(e,t){return Array.isArray(t)?t.reduce(Fh,e):Object.assign(Object.assign({},e),t)}let Uh=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new T(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),o=new T(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{vh.assertNotInAngularZone(),yh(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{vh.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){const t=re(e),n=function(e,t){return"number"==typeof te(e)?e.pop():1/0}(e),r=e;return r.length?1===r.length?Y(r[0]):X(n)(ae(r,t)):ee}(s,o.pipe(function(e={}){const{connector:t=(()=>new A),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return e=>{let s=null,o=null,a=null,l=0,c=!1,u=!1;const h=()=>{null==o||o.unsubscribe(),o=null},d=()=>{h(),s=a=null,c=u=!1},p=()=>{const e=s;d(),null==e||e.unsubscribe()};return R((e,f)=>{l++,!u&&!c&&h();const g=a=a??t();f.add(()=>{l--,0===l&&!u&&!c&&(o=ce(p,i))}),g.subscribe(f),s||(s=new C({next:e=>g.next(e),error:e=>{u=!0,h(),o=ce(d,n,e),g.error(e)},complete:()=>{c=!0,h(),o=ce(d,r),g.complete()}}),ae(e).subscribe(s))})(e)}}()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof mc?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(iu),i=n.create(zo.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(Ph,null),a=o&&i.injector.get(Oh);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),Bh(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Bh(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ih,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Or(vh),Or(zo),Or(Oi),Or(_c),Or(Ju))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Bh(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Vh{}class $h{}const zh={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Hh=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||zh}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>Gh(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>Gh(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Or(gh),Or($h,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Gh(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const qh=xh(null,"core",[{provide:rh,useValue:"unknown"},{provide:Lh,deps:[zo]},{provide:Oh,deps:[]},{provide:sh,deps:[]}]),Wh=[{provide:Uh,useClass:Uh,deps:[vh,zo,Oi,_c,Ju]},{provide:mu,deps:[vh],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Ju,useClass:Ju,deps:[[new Nr,Qu]]},{provide:gh,useClass:gh,deps:[]},eh,{provide:zc,useFactory:function(){return Qc},deps:[]},{provide:Gc,useFactory:function(){return Jc},deps:[]},{provide:oh,useFactory:function(e){return ml(e=e||"undefined"!=typeof $localize&&$localize.locale||hl),e},deps:[[new Mr(oh),new Nr,new Rr]]},{provide:ah,useValue:"USD"}];let jh=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Or(Uh))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:Wh}),e})(),Zh=null;function Yh(){return Zh}const Kh=new or("DocumentToken");let Qh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:Jh,token:e,providedIn:"platform"}),e})();function Jh(){return Or(ed)}const Xh=new or("Location Initialized");let ed=(()=>{class e extends Qh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Yh().getBaseHref(this._doc)}onPopState(e){const t=Yh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=Yh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){td()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){td()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=Se({factory:nd,token:e,providedIn:"platform"}),e})();function td(){return!!window.history.pushState}function nd(){return new ed(Or(Kh))}function rd(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function id(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function sd(e){return e&&"?"!==e[0]?"?"+e:e}let od=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:ad,token:e,providedIn:"root"}),e})();function ad(e){const t=Or(Kh).location;return new cd(Or(Qh),t&&t.origin||"")}const ld=new or("appBaseHref");let cd=(()=>{class e extends od{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return rd(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+sd(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+sd(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+sd(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Qh),Or(ld,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),ud=(()=>{class e extends od{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=rd(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+sd(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+sd(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Qh),Or(ld,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),hd=(()=>{class e{constructor(e,t){this._subject=new xu,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=id(pd(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+sd(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,pd(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+sd(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+sd(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Or(od),Or(Qh))},e.normalizeQueryParams=sd,e.joinWithSlash=rd,e.stripTrailingSlash=id,e.\u0275prov=Se({factory:dd,token:e,providedIn:"root"}),e})();function dd(){return new hd(Or(od),Or(Qh))}function pd(e){return e.replace(/\/index.html$/,"")}var fd=(()=>((fd=fd||{})[fd.Decimal=0]="Decimal",fd[fd.Percent=1]="Percent",fd[fd.Currency=2]="Currency",fd[fd.Scientific=3]="Scientific",fd))(),gd=(()=>((gd=gd||{})[gd.Zero=0]="Zero",gd[gd.One=1]="One",gd[gd.Two=2]="Two",gd[gd.Few=3]="Few",gd[gd.Many=4]="Many",gd[gd.Other=5]="Other",gd))(),md=(()=>((md=md||{})[md.Format=0]="Format",md[md.Standalone=1]="Standalone",md))(),yd=(()=>((yd=yd||{})[yd.Narrow=0]="Narrow",yd[yd.Abbreviated=1]="Abbreviated",yd[yd.Wide=2]="Wide",yd[yd.Short=3]="Short",yd))(),vd=(()=>((vd=vd||{})[vd.Short=0]="Short",vd[vd.Medium=1]="Medium",vd[vd.Long=2]="Long",vd[vd.Full=3]="Full",vd))(),_d=(()=>((_d=_d||{})[_d.Decimal=0]="Decimal",_d[_d.Group=1]="Group",_d[_d.List=2]="List",_d[_d.PercentSign=3]="PercentSign",_d[_d.PlusSign=4]="PlusSign",_d[_d.MinusSign=5]="MinusSign",_d[_d.Exponential=6]="Exponential",_d[_d.SuperscriptingExponent=7]="SuperscriptingExponent",_d[_d.PerMille=8]="PerMille",_d[_d.Infinity=9]="Infinity",_d[_d.NaN=10]="NaN",_d[_d.TimeSeparator=11]="TimeSeparator",_d[_d.CurrencyDecimal=12]="CurrencyDecimal",_d[_d.CurrencyGroup=13]="CurrencyGroup",_d))();function Cd(e,t){return Od(ol(e)[cl.DateFormat],t)}function Ed(e,t){return Od(ol(e)[cl.TimeFormat],t)}function wd(e,t){return Od(ol(e)[cl.DateTimeFormat],t)}function Sd(e,t){const n=ol(e),r=n[cl.NumberSymbols][t];if(void 0===r){if(t===_d.CurrencyDecimal)return n[cl.NumberSymbols][_d.Decimal];if(t===_d.CurrencyGroup)return n[cl.NumberSymbols][_d.Group]}return r}const bd=al;function Pd(e){if(!e[cl.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[cl.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Od(e,t){for(let n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function Td(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const Id=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,kd={},Ad=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Md=(()=>((Md=Md||{})[Md.Short=0]="Short",Md[Md.ShortGMT=1]="ShortGMT",Md[Md.Long=2]="Long",Md[Md.Extended=3]="Extended",Md))(),Nd=(()=>((Nd=Nd||{})[Nd.FullYear=0]="FullYear",Nd[Nd.Month=1]="Month",Nd[Nd.Date=2]="Date",Nd[Nd.Hours=3]="Hours",Nd[Nd.Minutes=4]="Minutes",Nd[Nd.Seconds=5]="Seconds",Nd[Nd.FractionalSeconds=6]="FractionalSeconds",Nd[Nd.Day=7]="Day",Nd))(),Rd=(()=>((Rd=Rd||{})[Rd.DayPeriods=0]="DayPeriods",Rd[Rd.Days=1]="Days",Rd[Rd.Months=2]="Months",Rd[Rd.Eras=3]="Eras",Rd))();function xd(e,t,n,r){let i=function(e){if(jd(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[t,n=1,r=1]=e.split("-").map(e=>+e);return Dd(t,n-1,r)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let n;if(n=e.match(Id))return function(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,s=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const o=Number(e[4]||0)-n,a=Number(e[5]||0)-r,l=Number(e[6]||0),c=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return s.call(t,o,a,l,c),t}(n)}const t=new Date(e);if(!jd(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=Ld(n,t)||t;let s,o=[];for(;t;){if(s=Ad.exec(t),!s){o.push(t);break}{o=o.concat(s.slice(1));const e=o.pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();r&&(a=Wd(r,a),i=function(e,t,n){const r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(Wd(t,r)-r))}(i,r));let l="";return o.forEach(e=>{const t=function(e){if(qd[e])return qd[e];let t;switch(e){case"G":case"GG":case"GGG":t=Vd(Rd.Eras,yd.Abbreviated);break;case"GGGG":t=Vd(Rd.Eras,yd.Wide);break;case"GGGGG":t=Vd(Rd.Eras,yd.Narrow);break;case"y":t=Bd(Nd.FullYear,1,0,!1,!0);break;case"yy":t=Bd(Nd.FullYear,2,0,!0,!0);break;case"yyy":t=Bd(Nd.FullYear,3,0,!1,!0);break;case"yyyy":t=Bd(Nd.FullYear,4,0,!1,!0);break;case"Y":t=Gd(1);break;case"YY":t=Gd(2,!0);break;case"YYY":t=Gd(3);break;case"YYYY":t=Gd(4);break;case"M":case"L":t=Bd(Nd.Month,1,1);break;case"MM":case"LL":t=Bd(Nd.Month,2,1);break;case"MMM":t=Vd(Rd.Months,yd.Abbreviated);break;case"MMMM":t=Vd(Rd.Months,yd.Wide);break;case"MMMMM":t=Vd(Rd.Months,yd.Narrow);break;case"LLL":t=Vd(Rd.Months,yd.Abbreviated,md.Standalone);break;case"LLLL":t=Vd(Rd.Months,yd.Wide,md.Standalone);break;case"LLLLL":t=Vd(Rd.Months,yd.Narrow,md.Standalone);break;case"w":t=Hd(1);break;case"ww":t=Hd(2);break;case"W":t=Hd(1,!0);break;case"d":t=Bd(Nd.Date,1);break;case"dd":t=Bd(Nd.Date,2);break;case"c":case"cc":t=Bd(Nd.Day,1);break;case"ccc":t=Vd(Rd.Days,yd.Abbreviated,md.Standalone);break;case"cccc":t=Vd(Rd.Days,yd.Wide,md.Standalone);break;case"ccccc":t=Vd(Rd.Days,yd.Narrow,md.Standalone);break;case"cccccc":t=Vd(Rd.Days,yd.Short,md.Standalone);break;case"E":case"EE":case"EEE":t=Vd(Rd.Days,yd.Abbreviated);break;case"EEEE":t=Vd(Rd.Days,yd.Wide);break;case"EEEEE":t=Vd(Rd.Days,yd.Narrow);break;case"EEEEEE":t=Vd(Rd.Days,yd.Short);break;case"a":case"aa":case"aaa":t=Vd(Rd.DayPeriods,yd.Abbreviated);break;case"aaaa":t=Vd(Rd.DayPeriods,yd.Wide);break;case"aaaaa":t=Vd(Rd.DayPeriods,yd.Narrow);break;case"b":case"bb":case"bbb":t=Vd(Rd.DayPeriods,yd.Abbreviated,md.Standalone,!0);break;case"bbbb":t=Vd(Rd.DayPeriods,yd.Wide,md.Standalone,!0);break;case"bbbbb":t=Vd(Rd.DayPeriods,yd.Narrow,md.Standalone,!0);break;case"B":case"BB":case"BBB":t=Vd(Rd.DayPeriods,yd.Abbreviated,md.Format,!0);break;case"BBBB":t=Vd(Rd.DayPeriods,yd.Wide,md.Format,!0);break;case"BBBBB":t=Vd(Rd.DayPeriods,yd.Narrow,md.Format,!0);break;case"h":t=Bd(Nd.Hours,1,-12);break;case"hh":t=Bd(Nd.Hours,2,-12);break;case"H":t=Bd(Nd.Hours,1);break;case"HH":t=Bd(Nd.Hours,2);break;case"m":t=Bd(Nd.Minutes,1);break;case"mm":t=Bd(Nd.Minutes,2);break;case"s":t=Bd(Nd.Seconds,1);break;case"ss":t=Bd(Nd.Seconds,2);break;case"S":t=Bd(Nd.FractionalSeconds,1);break;case"SS":t=Bd(Nd.FractionalSeconds,2);break;case"SSS":t=Bd(Nd.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=$d(Md.Short);break;case"ZZZZZ":t=$d(Md.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=$d(Md.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=$d(Md.Long);break;default:return null}return qd[e]=t,t}(e);l+=t?t(i,n,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function Dd(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function Ld(e,t){const n=function(e){return ol(e)[cl.LocaleId]}(e);if(kd[n]=kd[n]||{},kd[n][t])return kd[n][t];let r="";switch(t){case"shortDate":r=Cd(e,vd.Short);break;case"mediumDate":r=Cd(e,vd.Medium);break;case"longDate":r=Cd(e,vd.Long);break;case"fullDate":r=Cd(e,vd.Full);break;case"shortTime":r=Ed(e,vd.Short);break;case"mediumTime":r=Ed(e,vd.Medium);break;case"longTime":r=Ed(e,vd.Long);break;case"fullTime":r=Ed(e,vd.Full);break;case"short":const t=Ld(e,"shortTime"),n=Ld(e,"shortDate");r=Fd(wd(e,vd.Short),[t,n]);break;case"medium":const i=Ld(e,"mediumTime"),s=Ld(e,"mediumDate");r=Fd(wd(e,vd.Medium),[i,s]);break;case"long":const o=Ld(e,"longTime"),a=Ld(e,"longDate");r=Fd(wd(e,vd.Long),[o,a]);break;case"full":const l=Ld(e,"fullTime"),c=Ld(e,"fullDate");r=Fd(wd(e,vd.Full),[l,c])}return r&&(kd[n][t]=r),r}function Fd(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function Ud(e,t,n="-",r,i){let s="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,s=n));let o=String(e);for(;o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),s+o}function Bd(e,t,n=0,r=!1,i=!1){return function(s,o){let a=function(e,t){switch(e){case Nd.FullYear:return t.getFullYear();case Nd.Month:return t.getMonth();case Nd.Date:return t.getDate();case Nd.Hours:return t.getHours();case Nd.Minutes:return t.getMinutes();case Nd.Seconds:return t.getSeconds();case Nd.FractionalSeconds:return t.getMilliseconds();case Nd.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,s);if((n>0||a>-n)&&(a+=n),e===Nd.Hours)0===a&&-12===n&&(a=12);else if(e===Nd.FractionalSeconds)return function(e,t){return Ud(e,3).substr(0,t)}(a,t);const l=Sd(o,_d.MinusSign);return Ud(a,t,l,r,i)}}function Vd(e,t,n=md.Format,r=!1){return function(i,s){return function(e,t,n,r,i,s){switch(n){case Rd.Months:return function(e,t,n){const r=ol(e),i=Od([r[cl.MonthsFormat],r[cl.MonthsStandalone]],t);return Od(i,n)}(t,i,r)[e.getMonth()];case Rd.Days:return function(e,t,n){const r=ol(e),i=Od([r[cl.DaysFormat],r[cl.DaysStandalone]],t);return Od(i,n)}(t,i,r)[e.getDay()];case Rd.DayPeriods:const o=e.getHours(),a=e.getMinutes();if(s){const e=function(e){const t=ol(e);return Pd(t),(t[cl.ExtraData][2]||[]).map(e=>"string"==typeof e?Td(e):[Td(e[0]),Td(e[1])])}(t),n=function(e,t,n){const r=ol(e);Pd(r);const i=Od([r[cl.ExtraData][0],r[cl.ExtraData][1]],t)||[];return Od(i,n)||[]}(t,i,r),s=e.findIndex(e=>{if(Array.isArray(e)){const[t,n]=e,r=o>=t.hours&&a>=t.minutes,i=o<n.hours||o===n.hours&&a<n.minutes;if(t.hours<n.hours){if(r&&i)return!0}else if(r||i)return!0}else if(e.hours===o&&e.minutes===a)return!0;return!1});if(-1!==s)return n[s]}return function(e,t,n){const r=ol(e),i=Od([r[cl.DayPeriodsFormat],r[cl.DayPeriodsStandalone]],t);return Od(i,n)}(t,i,r)[o<12?0:1];case Rd.Eras:return function(e,t){return Od(ol(e)[cl.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,s,e,t,n,r)}}function $d(e){return function(t,n,r){const i=-1*r,s=Sd(n,_d.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case Md.Short:return(i>=0?"+":"")+Ud(o,2,s)+Ud(Math.abs(i%60),2,s);case Md.ShortGMT:return"GMT"+(i>=0?"+":"")+Ud(o,1,s);case Md.Long:return"GMT"+(i>=0?"+":"")+Ud(o,2,s)+":"+Ud(Math.abs(i%60),2,s);case Md.Extended:return 0===r?"Z":(i>=0?"+":"")+Ud(o,2,s)+":"+Ud(Math.abs(i%60),2,s);default:throw new Error(`Unknown zone width "${e}"`)}}}function zd(e){return Dd(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function Hd(e,t=!1){return function(n,r){let i;if(t){const e=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,t=n.getDate();i=1+Math.floor((t+e)/7)}else{const e=zd(n),t=function(e){const t=Dd(e,0,1).getDay();return Dd(e,0,1+(t<=4?4:11)-t)}(e.getFullYear()),r=e.getTime()-t.getTime();i=1+Math.round(r/6048e5)}return Ud(i,e,Sd(r,_d.MinusSign))}}function Gd(e,t=!1){return function(n,r){return Ud(zd(n).getFullYear(),e,Sd(r,_d.MinusSign),t)}}const qd={};function Wd(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function jd(e){return e instanceof Date&&!isNaN(e.valueOf())}const Zd=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Yd(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class Kd{}let Qd=(()=>{class e extends Kd{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(bd(t||this.locale)(e)){case gd.Zero:return"zero";case gd.One:return"one";case gd.Two:return"two";case gd.Few:return"few";case gd.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Or(oh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Jd(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let Xd=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Jo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${de(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(ua(zc),ua(Gc),ua(Sc),ua(Oc))},e.\u0275dir=st({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class ep{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let tp=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch{throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new ep(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new np(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new np(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(au),ua(eu),ua(zc))},e.\u0275dir=st({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class np{constructor(e,t){this.record=e,this.view=t}}let rp=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new ip,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){sp("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){sp("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(au),ua(eu))},e.\u0275dir=st({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class ip{constructor(){this.$implicit=null,this.ngIf=null}}function sp(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${de(t)}'.`)}let op=(()=>{class e{constructor(e){this._locale=e}transform(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,s,o=!1){let a="",l=!1;if(isFinite(e)){let c=function(e){let t,n,r,i,s,o=Math.abs(e)+"",a=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(s=o.length))t=[0],n=1;else{for(s--;"0"===o.charAt(s);)s--;for(n-=r,t=[],i=0;r<=s;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),a=n-1,n=1),{digits:t,exponent:a,integerLen:n}}(e);o&&(c=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(c));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(s){const e=s.match(Zd);if(null===e)throw new Error(`${s} is not a valid digit info`);const t=e[1],n=e[3],r=e[5];null!=t&&(u=Yd(t)),null!=n&&(h=Yd(n)),null!=r?d=Yd(r):null!=n&&h>d&&(d=h)}!function(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let o=s+e.integerLen,a=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(let e=o;e<r.length;e++)r[e]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let e=1;e<o;e++)r[e]=0}if(a>=5)if(o-1<0){for(let t=0;t>o;t--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let l=0!==s;const c=t+e.integerLen,u=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,l&&(0===r[n]&&n>=c?r.pop():l=!1),t>=10?1:0},0);u&&(r.unshift(u),e.integerLen++)}(c,h,d);let p=c.digits,f=c.integerLen;const g=c.exponent;let m=[];for(l=p.every(e=>!e);f<u;f++)p.unshift(0);for(;f<0;f++)p.unshift(0);f>0?m=p.splice(f,p.length):(m=p,p=[0]);const y=[];for(p.length>=t.lgSize&&y.unshift(p.splice(-t.lgSize,p.length).join(""));p.length>t.gSize;)y.unshift(p.splice(-t.gSize,p.length).join(""));p.length&&y.unshift(p.join("")),a=y.join(Sd(n,r)),m.length&&(a+=Sd(n,i)+m.join("")),g&&(a+=Sd(n,_d.Exponential)+"+"+g)}else a=Sd(n,_d.Infinity);return a=e<0&&!l?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf,a}(e,function(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=o[0],l=o[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<l.length;u++){const e=l.charAt(u);"0"===e?n.minFrac=n.maxFrac=u+1:"#"===e?n.maxFrac=u+1:n.posSuf+=e}const c=a.split(",");if(n.gSize=c[1]?c[1].length:0,n.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,s){const e=i.length-n.posPre.length-n.posSuf.length,t=s.indexOf("#");n.negPre=s.substr(0,t).replace(/'/g,""),n.negSuf=s.substr(t+e).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return ol(e)[cl.NumberFormats][t]}(t,fd.Decimal),Sd(t,_d.MinusSign)),t,_d.Group,_d.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),r,n)}catch(i){throw function(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${de(e)}'`)}(e,i.message)}}}return e.\u0275fac=function(t){return new(t||e)(ua(oh,16))},e.\u0275pipe=ot({name:"number",type:e,pure:!0}),e})();let ap=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[{provide:Kd,useClass:Qd}]}),e})();let lp=(()=>{class e{}return e.\u0275prov=Se({token:e,providedIn:"root",factory:()=>new cp(Or(Kh),window)}),e})();class cp{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=up(this.window.history)||up(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function up(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class hp{}class dp extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new dp,Zh||(Zh=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(fp=fp||document.querySelector("base"),fp?fp.getAttribute("href"):null);return null==t?null:function(e){pp=pp||document.createElement("a"),pp.setAttribute("href",e);const t=pp.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){fp=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Jd(document.cookie,e)}}let pp,fp=null;const gp=new or("TRANSITION_ID"),mp=[{provide:Qu,useFactory:function(e,t,n){return()=>{n.get(Ju).donePromise.then(()=>{const n=Yh(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let e=0;e<r.length;e++)n.remove(r[e])})}},deps:[gp,Kh,zo],multi:!0}];class yp{static init(){var e;e=new yp,Ih=e}addToWindow(e){ze.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),ze.getAllAngularRootElements=()=>e.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(e=>{const t=ze.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){return null==t?null:e.getTestability(t)??(n?Yh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}let vp=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const _p=new or("EventManagerPlugins");let Cp=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Or(_p),Or(vh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class Ep{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=Yh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let wp=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Sp=(()=>{class e extends wp{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(bp),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(bp))}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function bp(e){Yh().remove(e)}const Pp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Op=/%COMP%/g;function Tp(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?Tp(e,i,n):(i=i.replace(Op,e),n.push(i))}return n}function Ip(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let kp=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new Ap(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Ue.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new Mp(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Ue.ShadowDom:return new Np(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=Tp(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Or(Cp),Or(Sp),Or(Xu))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class Ap{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Pp[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=Pp[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=Pp[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(Mi.DashCase|Mi.Important)?e.style.setProperty(t,n,r&Mi.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Mi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Ip(n)):this.eventManager.addEventListener(e,t,Ip(n))}}class Mp extends Ap{constructor(e,t,n,r){super(e),this.component=n;const i=Tp(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(Op,r+"-"+n.id),this.hostAttr=function(e){return"_nghost-%COMP%".replace(Op,e)}(r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class Np extends Ap{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=Tp(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Rp=(()=>{class e extends Ep{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const xp=["alt","control","meta","shift"],Dp={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Lp={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Fp={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Up=(()=>{class e extends Ep{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Yh().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(xp.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Lp.hasOwnProperty(t)&&(t=Lp[t]))}return Dp[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),xp.forEach(r=>{r!=n&&Fp[r](e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Bp=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:function(){return Or(Vp)},token:e,providedIn:"root"}),e})(),Vp=(()=>{class e extends Bp{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case yi.NONE:return t;case yi.HTML:return qr(t,"HTML")?Gr(t):gi(this._doc,String(t)).toString();case yi.STYLE:return qr(t,"Style")?Gr(t):t;case yi.SCRIPT:if(qr(t,"Script"))return Gr(t);throw new Error("unsafe value used in a script context");case yi.URL:return Wr(t),qr(t,"URL")?Gr(t):Jr(String(t));case yi.RESOURCE_URL:if(qr(t,"ResourceURL"))return Gr(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(e){return new Br(e)}(e)}bypassSecurityTrustStyle(e){return function(e){return new Vr(e)}(e)}bypassSecurityTrustScript(e){return function(e){return new $r(e)}(e)}bypassSecurityTrustUrl(e){return function(e){return new zr(e)}(e)}bypassSecurityTrustResourceUrl(e){return function(e){return new Hr(e)}(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=Se({factory:function(){return function(e){return new Vp(e.get(Kh))}(Or(To))},token:e,providedIn:"root"}),e})();const $p=xh(qh,"browser",[{provide:rh,useValue:"browser"},{provide:nh,useValue:function(){dp.makeCurrent(),yp.init()},multi:!0},{provide:Kh,useFactory:function(){return e=document,Pt=e,document;var e},deps:[]}]),zp=[[],{provide:ko,useValue:"root"},{provide:Oi,useFactory:function(){return new Oi},deps:[]},{provide:_p,useClass:Rp,multi:!0,deps:[Kh,vh,rh]},{provide:_p,useClass:Up,multi:!0,deps:[Kh]},[],{provide:kp,useClass:kp,deps:[Cp,Sp,Xu]},{provide:Pc,useExisting:kp},{provide:wp,useExisting:Sp},{provide:Sp,useClass:Sp,deps:[Kh]},{provide:Ph,useClass:Ph,deps:[vh]},{provide:Cp,useClass:Cp,deps:[_p,vh]},{provide:hp,useClass:vp,deps:[]},[]];let Hp=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:Xu,useValue:t.appId},{provide:gp,useExisting:Xu},mp]}}}return e.\u0275fac=function(t){return new(t||e)(Or(e,12))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:zp,imports:[ap,jh]}),e})();"undefined"!=typeof window&&window;const{isArray:Gp}=Array,{getPrototypeOf:qp,prototype:Wp,keys:jp}=Object;function Zp(e){if(1===e.length){const t=e[0];if(Gp(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&qp(e)===Wp}(t)){const e=jp(t);return{args:e.map(e=>t[e]),keys:e}}}return{args:e,keys:null}}const{isArray:Yp}=Array;function Kp(e){return D(t=>function(e,t){return Yp(t)?e(...t):e(t)}(e,t))}function Qp(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}let Jp=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(Sc))},e.\u0275dir=st({type:e}),e})(),Xp=(()=>{class e extends Jp{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();const ef=new or("NgValueAccessor"),tf={provide:ef,useExisting:ge(()=>rf),multi:!0},nf=new or("CompositionEventMode");let rf=(()=>{class e extends Jp{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=Yh()?Yh().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(Sc),ua(nf,8))},e.\u0275dir=st({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&Ea("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[gc([tf]),Go]}),e})();function sf(e){return null==e||0===e.length}function of(e){return null!=e&&"number"==typeof e.length}const af=new or("NgValidators"),lf=new or("NgAsyncValidators"),cf=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class uf{static min(e){return function(e){return t=>{if(sf(t.value)||sf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(e)}static max(e){return function(e){return t=>{if(sf(t.value)||sf(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(e)}static required(e){return hf(e)}static requiredTrue(e){return function(e){return!0===e.value?null:{required:!0}}(e)}static email(e){return function(e){return sf(e.value)||cf.test(e.value)?null:{email:!0}}(e)}static minLength(e){return function(e){return t=>sf(t.value)||!of(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(e)}static maxLength(e){return df(e)}static pattern(e){return function(e){if(!e)return pf;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(sf(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return _f(e)}static composeAsync(e){return Ef(e)}}function hf(e){return sf(e.value)?{required:!0}:null}function df(e){return t=>of(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function pf(e){return null}function ff(e){return null!=e}function gf(e){const t=_a(e)?ae(e):e;return Ca(t),t}function mf(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function yf(e,t){return t.map(t=>t(e))}function vf(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function _f(e){if(!e)return null;const t=e.filter(ff);return 0==t.length?null:function(e){return mf(yf(e,t))}}function Cf(e){return null!=e?_f(vf(e)):null}function Ef(e){if(!e)return null;const t=e.filter(ff);return 0==t.length?null:function(e){return function(...e){const t=ne(e),{args:n,keys:r}=Zp(e),i=new T(e=>{const{length:t}=n;if(!t)return void e.complete();const i=new Array(t);let s=t,o=t;for(let a=0;a<t;a++){let t=!1;Y(n[a]).subscribe(new x(e,e=>{t||(t=!0,o--),i[a]=e},()=>s--,void 0,()=>{(!s||!t)&&(o||e.next(r?Qp(r,i):i),e.complete())}))}});return t?i.pipe(Kp(t)):i}(yf(e,t).map(gf)).pipe(D(mf))}}function wf(e){return null!=e?Ef(vf(e)):null}function Sf(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function bf(e){return e._rawValidators}function Pf(e){return e._rawAsyncValidators}function Of(e){return e?Array.isArray(e)?e:[e]:[]}function Tf(e,t){return Array.isArray(e)?e.includes(t):e===t}function If(e,t){const n=Of(t);return Of(e).forEach(e=>{Tf(n,e)||n.push(e)}),n}function kf(e,t){return Of(t).filter(t=>!Tf(e,t))}let Af=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Cf(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=wf(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e}),e})(),Mf=(()=>{class e extends Af{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();class Nf extends Af{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Rf{constructor(e){this._cd=e}is(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}let xf=(()=>{class e extends Rf{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Nf,2))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Ba("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[Go]}),e})(),Df=(()=>{class e extends Rf{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&Ba("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[Go]}),e})();function Lf(e,t){return[...t.path,e]}function Ff(e,t){Vf(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&zf(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&zf(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Uf(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),$f(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Bf(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Vf(e,t){const n=bf(e);null!==t.validator?e.setValidators(Sf(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=Pf(e);null!==t.asyncValidator?e.setAsyncValidators(Sf(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();Bf(t._rawValidators,i),Bf(t._rawAsyncValidators,i)}function $f(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=bf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=Pf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return Bf(t._rawValidators,r),Bf(t._rawAsyncValidators,r),n}function zf(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Hf(e,t){Vf(e,t)}function Gf(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function qf(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function Wf(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===rf?n=e:function(e){return Object.getPrototypeOf(e.constructor)===Xp}(e)?r=e:i=e}),i||r||n||null}function jf(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Zf="VALID",Yf="INVALID",Kf="PENDING",Qf="DISABLED";function Jf(e){return(ng(e)?e.validators:e)||null}function Xf(e){return Array.isArray(e)?Cf(e):e||null}function eg(e,t){return(ng(t)?t.asyncValidators:e)||null}function tg(e){return Array.isArray(e)?wf(e):e||null}function ng(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class rg{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Xf(this._rawValidators),this._composedAsyncValidatorFn=tg(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Zf}get invalid(){return this.status===Yf}get pending(){return this.status==Kf}get disabled(){return this.status===Qf}get enabled(){return this.status!==Qf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Xf(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=tg(e)}addValidators(e){this.setValidators(If(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(If(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(kf(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(kf(e,this._rawAsyncValidators))}hasValidator(e){return Tf(this._rawValidators,e)}hasAsyncValidator(e){return Tf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Kf,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Qf,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Zf,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Zf||this.status===Kf)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Qf:Zf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Kf,this._hasOwnPendingAsyncValidator=!0;const t=gf(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;let r=e;return t.forEach(e=>{r=r instanceof sg?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof og&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new xu,this.statusChanges=new xu}_calculateStatus(){return this._allControlsDisabled()?Qf:this.errors?Yf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Kf)?Kf:this._anyControlsHaveStatus(Yf)?Yf:Zf}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ng(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class ig extends rg{constructor(e=null,t,n){super(Jf(t),eg(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){jf(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){jf(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class sg extends rg{constructor(e,t,n){super(Jf(t),eg(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof ig?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class og extends rg{constructor(e,t,n){super(Jf(t),eg(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof ig?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const ag={provide:Mf,useExisting:ge(()=>cg)},lg=(()=>Promise.resolve(null))();let cg=(()=>{class e extends Mf{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new xu,this.form=new sg({},Cf(e),wf(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){lg.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Ff(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){lg.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),jf(this._directives,e)})}addFormGroup(e){lg.then(()=>{const t=this._findContainer(e.path),n=new sg({});Hf(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){lg.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){lg.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,qf(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(ua(af,10),ua(lf,10))},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gc([ag]),Go]}),e})();const ug={provide:Nf,useExisting:ge(()=>dg)},hg=(()=>Promise.resolve(null))();let dg=(()=>{class e extends Nf{constructor(e,t,n,r){super(),this.control=new ig,this._registered=!1,this.update=new xu,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Wf(0,r)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),Gf(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?Lf(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ff(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){hg.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,n=""===t||t&&"false"!==t;hg.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,9),ua(af,10),ua(lf,10),ua(ef,10))},e.\u0275dir=st({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[gc([ug]),Go,vt]}),e})(),pg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),fg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();const gg={provide:ef,useExisting:ge(()=>mg),multi:!0};let mg=(()=>{class e extends Xp{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=t=>{e(""==t?null:parseFloat(t))}}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[gc([gg]),Go]}),e})();const yg=new or("NgModelWithFormControlWarning"),vg={provide:Mf,useExisting:ge(()=>_g)};let _g=(()=>{class e extends Mf{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new xu,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&($f(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Ff(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){Uf(e.control||null,e,!1),jf(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,qf(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(Uf(t||null,e),n instanceof ig&&(Ff(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);Hf(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return $f(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Vf(this.form,this),this._oldForm&&$f(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(ua(af,10),ua(lf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gc([vg]),Go,vt]}),e})();const Cg={provide:Nf,useExisting:ge(()=>Eg)};let Eg=(()=>{class e extends Nf{constructor(e,t,n,r,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new xu,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Wf(0,r)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),Gf(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Lf(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,13),ua(af,10),ua(lf,10),ua(ef,10),ua(yg,8))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[gc([Cg]),Go,vt]}),e._ngModelWarningSentOnce=!1,e})();const wg={provide:ef,useExisting:ge(()=>bg),multi:!0};function Sg(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let bg=(()=>{class e extends Xp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const n=Sg(t,e);this.setProperty("value",n)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gc([wg]),Go]}),e})(),Pg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(Sg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(Sc),ua(Oc),ua(bg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const Og={provide:ef,useExisting:ge(()=>Ig),multi:!0};function Tg(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let Ig=(()=>{class e extends Xp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const n=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(n.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const n=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const r=e.item(t),i=this._getOptionValue(r.value);n.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const r=e.item(t);if(r.selected){const e=this._getOptionValue(r.value);n.push(e)}}}this.value=n,e(n)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gc([Og]),Go]}),e})(),kg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(Tg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Tg(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(Sc),ua(Oc),ua(Ig,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const Ag={provide:af,useExisting:ge(()=>Mg),multi:!0};let Mg=(()=>{class e{constructor(){this._required=!1}get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!=`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?hf(e):null}registerOnValidatorChange(e){this._onChange=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&ra("required",t.required?"":null)},inputs:{required:"required"},features:[gc([Ag])]}),e})();const Ng={provide:af,useExisting:ge(()=>Rg),multi:!0};let Rg=(()=>{class e{constructor(){this._validator=pf}ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this.enabled()?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=this.enabled()?df(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):pf}enabled(){return null!=this.maxlength}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&ra("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[gc([Ng]),vt]}),e})(),xg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[[fg]]}),e})(),Dg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[xg]}),e})(),Lg=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:yg,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[xg]}),e})(),Fg=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,s=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,s=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,s=null!=t.asyncValidator?t.asyncValidator:null)),new sg(n,{asyncValidators:s,updateOn:r,validators:i})}control(e,t,n){return new ig(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new og(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof ig||e instanceof sg||e instanceof og?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:function(){return new e},token:e,providedIn:Lg}),e})();function Ug(...e){return ae(e,re(e))}function Bg(e,t){return r(t)?J(e,t,1):J(e,1)}function Vg(e,t){return R((n,r)=>{let i=0;n.subscribe(new x(r,n=>e.call(t,n,i++)&&r.next(n)))})}class $g{}class zg{}class Hg{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Hg?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Hg;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Hg?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Gg{encodeKey(e){return jg(e)}encodeValue(e){return jg(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const qg=/%(\d[a-f0-9])/gi,Wg={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function jg(e){return encodeURIComponent(e).replace(qg,(e,t)=>{var n;return null!==(n=Wg[t])&&void 0!==n?n:e})}function Zg(e){return`${e}`}class Yg{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Gg,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Yg({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Zg(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(Zg(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Kg{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Qg(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Jg(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Xg(e){return"undefined"!=typeof FormData&&e instanceof FormData}class em{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Hg),this.context||(this.context=new Kg),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new Yg,this.urlWithParams=t}serializeBody(){return null===this.body?null:Qg(this.body)||Jg(this.body)||Xg(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Yg?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Xg(this.body)?null:Jg(this.body)?this.body.type||null:Qg(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Yg?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let l=e.headers||this.headers,c=e.params||this.params;const u=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(l=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),l)),e.setParams&&(c=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),c)),new em(n,r,s,{params:c,headers:l,context:u,reportProgress:a,responseType:i,withCredentials:o})}}var tm=(()=>((tm=tm||{})[tm.Sent=0]="Sent",tm[tm.UploadProgress=1]="UploadProgress",tm[tm.ResponseHeader=2]="ResponseHeader",tm[tm.DownloadProgress=3]="DownloadProgress",tm[tm.Response=4]="Response",tm[tm.User=5]="User",tm))();class nm{constructor(e,t=200,n="OK"){this.headers=e.headers||new Hg,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class rm extends nm{constructor(e={}){super(e),this.type=tm.ResponseHeader}clone(e={}){return new rm({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class im extends nm{constructor(e={}){super(e),this.type=tm.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new im({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class sm extends nm{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function om(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let am=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof em)r=e;else{let i,s;i=n.headers instanceof Hg?n.headers:new Hg(n.headers),n.params&&(s=n.params instanceof Yg?n.params:new Yg({fromObject:n.params})),r=new em(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=Ug(r).pipe(Bg(e=>this.handler.handle(e)));if(e instanceof em||"events"===n.observe)return i;const s=i.pipe(Vg(e=>e instanceof im));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(D(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(D(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Yg).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,om(n,t))}post(e,t,n={}){return this.request("POST",e,om(n,t))}put(e,t,n={}){return this.request("PUT",e,om(n,t))}}return e.\u0275fac=function(t){return new(t||e)(Or($g))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class lm{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const cm=new or("HTTP_INTERCEPTORS");let um=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const hm=/^\)\]\}',?\n/;let dm=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new T(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new Hg(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new rm({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),l=null;204!==i&&(l=void 0===n.response?n.responseText:n.response),0===i&&(i=l?200:0);let c=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof l){const e=l;l=l.replace(hm,"");try{l=""!==l?JSON.parse(l):null}catch(u){l=e,c&&(c=!1,l={error:u,text:l})}}c?(t.next(new im({body:l,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new sm({error:l,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new sm({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let l=!1;const c=r=>{l||(t.next(s()),l=!0);let i={type:tm.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&!!n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:tm.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",c),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:tm.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",o),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",c),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Or(hp))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const pm=new or("XSRF_COOKIE_NAME"),fm=new or("XSRF_HEADER_NAME");class gm{}let mm=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Jd(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(rh),Or(pm))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),ym=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(gm),Or(fm))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),vm=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(cm,[]);this.chain=e.reduceRight((e,t)=>new lm(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(zg),Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),_m=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:ym,useClass:um}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:pm,useValue:t.cookieName}:[],t.headerName?{provide:fm,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[ym,{provide:cm,useExisting:ym,multi:!0},{provide:gm,useClass:mm},{provide:pm,useValue:"XSRF-TOKEN"},{provide:fm,useValue:"X-XSRF-TOKEN"}]}),e})(),Cm=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[am,{provide:$g,useClass:vm},dm,{provide:zg,useExisting:dm}],imports:[[_m.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class Em extends A{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function wm(e,t,n){e?Q(n,e,t):t()}const Sm=i(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function bm(...e){return X(1)(ae(e,re(e)))}function Pm(e){return new T(t=>{Y(e()).subscribe(t)})}function Om(){return R((e,t)=>{let n=null;e._refCount++;const r=new x(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class Tm extends T{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,N(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new a;const t=this.getSubject();e.add(this.source.subscribe(new x(t,void 0,()=>{this._teardown(),t.complete()},e=>{this._teardown(),t.error(e)},()=>this._teardown()))),e.closed&&(this._connection=null,e=a.EMPTY)}return e}refCount(){return Om()(this)}}function Im(e,t){return R((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(new x(r,n=>{null==i||i.unsubscribe();let o=0;const l=s++;Y(e(n,l)).subscribe(i=new x(r,e=>r.next(t?t(n,e,l,o++):e),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function km(e,t,n,r,i){return(s,o)=>{let a=n,l=t,c=0;s.subscribe(new x(o,t=>{const n=c++;l=a?e(l,t,n):(a=!0,t),r&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}function Am(e,t){return R(km(e,t,arguments.length>=2,!0))}function Mm(e){return R((t,n)=>{let r,i=null,s=!1;i=t.subscribe(new x(n,void 0,void 0,o=>{r=Y(e(o,Mm(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}function Nm(e){return e<=0?()=>ee:R((t,n)=>{let r=[];t.subscribe(new x(n,t=>{r.push(t),e<r.length&&r.shift()},()=>{for(const e of r)n.next(e);n.complete()},void 0,()=>{r=null}))})}function Rm(e=xm){return R((t,n)=>{let r=!1;t.subscribe(new x(n,e=>{r=!0,n.next(e)},()=>r?n.complete():n.error(e())))})}function xm(){return new Sm}function Dm(e){return R((t,n)=>{let r=!1;t.subscribe(new x(n,e=>{r=!0,n.next(e)},()=>{r||n.next(e),n.complete()}))})}function Lm(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Vg((t,n)=>e(t,n,r)):O,le(1),n?Dm(t):Rm(()=>new Sm))}function Fm(e,t,n){const i=r(e)||t||n?{next:e,error:t,complete:n}:e;return i?R((e,t)=>{var n;null===(n=i.subscribe)||void 0===n||n.call(i);let r=!0;e.subscribe(new x(t,e=>{var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},()=>{var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},e=>{var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},()=>{var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):O}class Um{constructor(e,t){this.id=e,this.url=t}}class Bm extends Um{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Vm extends Um{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class $m extends Um{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class zm extends Um{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Hm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qm extends Um{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Wm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Zm{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ym{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Km{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qm{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Jm{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Xm{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ey{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ty="primary";class ny{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function ry(e){return new ny(e)}const iy="ngNavigationCancelingError";function sy(e){const t=Error("NavigationCancelingError: "+e);return t[iy]=!0,t}function oy(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function ay(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!ly(e[i],t[i]))return!1;return!0}function ly(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function cy(e){return Array.prototype.concat.apply([],e)}function uy(e){return e.length>0?e[e.length-1]:null}function hy(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function dy(e){return Ca(e)?e:_a(e)?ae(Promise.resolve(e)):Ug(e)}const py={exact:function e(t,n,r){if(!wy(t.segments,n.segments)||!vy(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:my},fy={exact:function(e,t){return ay(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>ly(e[n],t[n]))},ignored:()=>!0};function gy(e,t,n){return py[n.paths](e.root,t.root,n.matrixParams)&&fy[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function my(e,t,n){return yy(e,t,t.segments,n)}function yy(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!wy(i,n)||t.hasChildren()||!vy(i,n,r))}if(e.segments.length===n.length){if(!wy(e.segments,n)||!vy(e.segments,n,r))return!1;for(const n in t.children)if(!e.children[n]||!my(e.children[n],t.children[n],r))return!1;return!0}{const i=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(wy(e.segments,i)&&vy(e.segments,i,r)&&e.children[ty])&&yy(e.children[ty],t,s,r)}}function vy(e,t,n){return t.every((t,r)=>fy[n](e[r].parameters,t.parameters))}class _y{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ry(this.queryParams)),this._queryParamMap}toString(){return Py.serialize(this)}}class Cy{constructor(e,t){this.segments=e,this.children=t,this.parent=null,hy(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Oy(this)}}class Ey{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=ry(this.parameters)),this._parameterMap}toString(){return Ry(this)}}function wy(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class Sy{}class by{parse(e){const t=new Uy(e);return new _y(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`${`/${Ty(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${ky(t)}=${ky(e)}`).join("&"):`${ky(t)}=${ky(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const Py=new by;function Oy(e){return e.segments.map(e=>Ry(e)).join("/")}function Ty(e,t){if(!e.hasChildren())return Oy(e);if(t){const t=e.children[ty]?Ty(e.children[ty],!1):"",n=[];return hy(e.children,(e,t)=>{t!==ty&&n.push(`${t}:${Ty(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return hy(e.children,(e,r)=>{r===ty&&(n=n.concat(t(e,r)))}),hy(e.children,(e,r)=>{r!==ty&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===ty?[Ty(e.children[ty],!1)]:[`${n}:${Ty(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[ty]?`${Oy(e)}/${t[0]}`:`${Oy(e)}/(${t.join("//")})`}}function Iy(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ky(e){return Iy(e).replace(/%3B/gi,";")}function Ay(e){return Iy(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function My(e){return decodeURIComponent(e)}function Ny(e){return My(e.replace(/\+/g,"%20"))}function Ry(e){return`${Ay(e.path)}${function(e){return Object.keys(e).map(t=>`;${Ay(t)}=${Ay(e[t])}`).join("")}(e.parameters)}`}const xy=/^[^\/()?;=#]+/;function Dy(e){const t=e.match(xy);return t?t[0]:""}const Ly=/^[^=?&#]+/,Fy=/^[^?&#]+/;class Uy{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Cy([],{}):new Cy([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[ty]=new Cy(e,t)),n}parseSegment(){const e=Dy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Ey(My(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Dy(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=Dy(this.remaining);e&&(n=e,this.capture(n))}e[My(t)]=My(n)}parseQueryParam(e){const t=function(e){const t=e.match(Ly);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Fy);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=Ny(t),i=Ny(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=Dy(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=ty);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s[ty]:new Cy([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class By{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Vy(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Vy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=$y(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return $y(e,this._root).map(e=>e.value)}}function Vy(e,t){if(e===t.value)return t;for(const n of t.children){const t=Vy(e,n);if(t)return t}return null}function $y(e,t){if(e===t.value)return[t];for(const n of t.children){const r=$y(e,n);if(r.length)return r.unshift(t),r}return[]}class zy{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Hy(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class Gy extends By{constructor(e,t){super(e),this.snapshot=t,Ky(this,e)}toString(){return this.snapshot.toString()}}function qy(e,t){const n=function(e,t){const n=new Zy([],{},{},"",{},ty,t,null,e.root,-1,{});return new Yy("",new zy(n,[]))}(e,t),r=new Em([new Ey("",{})]),i=new Em({}),s=new Em({}),o=new Em({}),a=new Em(""),l=new Wy(r,i,o,a,s,ty,t,n.root);return l.snapshot=n.root,new Gy(new zy(l,[]),n)}class Wy{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(D(e=>ry(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(D(e=>ry(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function jy(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Zy{constructor(e,t,n,r,i,s,o,a,l,c,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ry(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ry(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Yy extends By{constructor(e,t){super(t),this.url=e,Ky(this,t)}toString(){return Qy(this._root)}}function Ky(e,t){t.value._routerState=e,t.children.forEach(t=>Ky(e,t))}function Qy(e){const t=e.children.length>0?` { ${e.children.map(Qy).join(", ")} } `:"";return`${e.value}${t}`}function Jy(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,ay(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),ay(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ay(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),ay(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Xy(e,t){return ay(e.params,t.params)&&function(e,t){return wy(e,t)&&e.every((e,n)=>ay(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Xy(e.parent,t.parent))}function ev(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return ev(e,t,r);return ev(e,t)})}(e,t,n);return new zy(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return tv(t,e),e}}const n=function(e){return new Wy(new Em(e.url),new Em(e.params),new Em(e.queryParams),new Em(e.fragment),new Em(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(t=>ev(e,t));return new zy(n,r)}}function tv(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)tv(e.children[n],t.children[n])}function nv(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function rv(e){return"object"==typeof e&&null!=e&&e.outlets}function iv(e,t,n,r,i){let s={};return r&&hy(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new _y(n.root===e?t:sv(n.root,e,t),s,i)}function sv(e,t,n){const r={};return hy(e.children,(e,i)=>{r[i]=e===t?n:sv(e,t,n)}),new Cy(e.segments,r)}class ov{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&nv(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(rv);if(r&&r!==uy(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class av{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function lv(e,t,n){if(e||(e=new Cy([],{})),0===e.segments.length&&e.hasChildren())return cv(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if(rv(o))break;const a=`${o}`,l=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&l&&"object"==typeof l&&void 0===l.outlets){if(!pv(a,l,t))return s;r+=2}else{if(!pv(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new Cy(e.segments.slice(0,r.pathIndex),{});return t.children[ty]=new Cy(e.segments.slice(r.pathIndex),e.children),cv(t,0,i)}return r.match&&0===i.length?new Cy(e.segments,{}):r.match&&!e.hasChildren()?uv(e,t,n):r.match?cv(e,0,i):uv(e,t,n)}function cv(e,t,n){if(0===n.length)return new Cy(e.segments,{});{const r=function(e){return rv(e[0])?e[0].outlets:{[ty]:e}}(n),i={};return hy(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=lv(e.children[r],t,n))}),hy(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new Cy(e.segments,i)}}function uv(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if(rv(s)){const e=hv(s.outlets);return new Cy(r,e)}if(0===i&&nv(n[0])){r.push(new Ey(e.segments[t].path,dv(n[0]))),i++;continue}const o=rv(s)?s.outlets[ty]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&nv(a)?(r.push(new Ey(o,dv(a))),i+=2):(r.push(new Ey(o,{})),i++)}return new Cy(r,{})}function hv(e){const t={};return hy(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=uv(new Cy([],{}),0,e))}),t}function dv(e){const t={};return hy(e,(e,n)=>t[n]=`${e}`),t}function pv(e,t,n){return e==n.path&&ay(t,n.parameters)}class fv{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Jy(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=Hy(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),hy(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=Hy(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=Hy(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Xm(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Qm(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Jy(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),gv(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function gv(e){Jy(e.value),e.children.forEach(gv)}class mv{constructor(e,t){this.routes=e,this.module=t}}function yv(e){return"function"==typeof e}function vv(e){return e instanceof _y}const _v=Symbol("INITIAL_VALUE");function Cv(){return Im(e=>function(...e){const t=re(e),n=ne(e),{args:r,keys:i}=Zp(e);if(0===r.length)return ae([],t);const s=new T(function(e,t,n=O){return r=>{wm(t,()=>{const{length:i}=e,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)wm(t,()=>{const i=ae(e[l],t);let c=!1;i.subscribe(new x(r,e=>{s[l]=e,c||(c=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,t,i?e=>Qp(i,e):O));return n?s.pipe(Kp(n)):s}(e.map(e=>e.pipe(le(1),function(...e){const t=re(e);return R((n,r)=>{(t?bm(e,n,t):bm(e,n)).subscribe(r)})}(_v)))).pipe(Am((e,t)=>{let n=!1;return t.reduce((e,r,i)=>e!==_v?e:(r===_v&&(n=!0),n||!1!==r&&i!==t.length-1&&!vv(r)?e:r),e)},_v),Vg(e=>e!==_v),D(e=>vv(e)?e:!0===e),le(1)))}let Ev=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&ga(0,"router-outlet")},directives:function(){return[__]},encapsulation:2}),e})();function wv(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];Sv(r,bv(t,r))}}function Sv(e,t){e.children&&wv(e.children,t)}function bv(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function Pv(e){const t=e.children&&e.children.map(Pv),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==ty&&(n.component=Ev),n}function Ov(e){return e.outlet||ty}function Tv(e,t){const n=e.filter(e=>Ov(e)===t);return n.push(...e.filter(e=>Ov(e)!==t)),n}const Iv={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function kv(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},Iv):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||oy)(n,e,t);if(!i)return Object.assign({},Iv);const s={};hy(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function Av(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>Mv(e,t,n)&&Ov(n)!==ty)}(e,n,r)){const i=new Cy(t,function(e,t,n,r){const i={};i[ty]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&Ov(s)!==ty){const n=new Cy([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[Ov(s)]=n}return i}(e,t,r,new Cy(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>Mv(e,t,n))}(e,n,r)){const s=new Cy(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(Mv(e,n,a)&&!i[Ov(a)]){const n=new Cy([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[Ov(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new Cy(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Mv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function Nv(e,t,n,r){return!!(Ov(e)===r||r!==ty&&Mv(t,n,e))&&("**"===e.path||kv(t,e,n).matched)}function Rv(e,t,n){return 0===t.length&&!e.children[n]}class xv{constructor(e){this.segmentGroup=e||null}}class Dv{constructor(e){this.urlTree=e}}function Lv(e){return new T(t=>t.error(new xv(e)))}function Fv(e){return new T(t=>t.error(new Dv(e)))}function Uv(e){return new T(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Bv{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(iu)}apply(){const e=Av(this.urlTree.root,[],[],this.config).segmentGroup,t=new Cy(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,ty).pipe(D(e=>this.createUrlTree(Vv(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Mm(e=>{if(e instanceof Dv)return this.allowRedirects=!1,this.match(e.urlTree);throw e instanceof xv?this.noMatchError(e):e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,ty).pipe(D(t=>this.createUrlTree(Vv(t),e.queryParams,e.fragment))).pipe(Mm(e=>{throw e instanceof xv?this.noMatchError(e):e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new Cy([],{[ty]:e}):e;return new _y(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(D(e=>new Cy([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return ae(r).pipe(Bg(r=>{const i=n.children[r],s=Tv(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(D(e=>({segment:e,outlet:r})))}),Am((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Vg((t,n)=>e(t,n,r)):O,Nm(1),n?Dm(t):Rm(()=>new Sm))}())}expandSegment(e,t,n,r,i,s){return ae(n).pipe(Bg(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(Mm(e=>{if(e instanceof xv)return Ug(null);throw e}))),Lm(e=>!!e),Mm((e,n)=>{if(e instanceof Sm||"EmptyError"===e.name){if(Rv(t,r,i))return Ug(new Cy([],{}));throw new xv(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return Nv(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):Lv(t):Lv(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Fv(i):this.lineralizeSegments(n,i).pipe(J(n=>{const i=new Cy(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:l,positionalParamSegments:c}=kv(t,r,i);if(!o)return Lv(t);const u=this.applyRedirectCommands(a,r.redirectTo,c);return r.redirectTo.startsWith("/")?Fv(u):this.lineralizeSegments(r,u).pipe(J(r=>this.expandSegment(e,t,n,r.concat(i.slice(l)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?Ug(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(D(e=>(n._loadedConfig=e,new Cy(r,{})))):Ug(new Cy(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=kv(t,n,r);if(!s)return Lv(t);const l=r.slice(a);return this.getChildConfig(e,n,r).pipe(J(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:c}=Av(t,o,l,s),u=new Cy(a.segments,a.children);if(0===c.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(D(e=>new Cy(o,e)));if(0===s.length&&0===c.length)return Ug(new Cy(o,{}));const h=Ov(n)===i;return this.expandSegment(r,u,s,c,h?ty:i,!0).pipe(D(e=>new Cy(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?Ug(new mv(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Ug(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(J(n=>{return n?this.configLoader.load(e.injector,t).pipe(D(e=>(t._loadedConfig=e,e))):(r=t,new T(e=>e.error(sy(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))));var r})):Ug(new mv([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?Ug(r.map(r=>{const i=e.get(r);let s;if((o=i)&&yv(o.canLoad))s=i.canLoad(t,n);else{if(!yv(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}var o;return dy(s)})).pipe(Cv(),Fm(e=>{if(!vv(e))return;const t=sy(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),D(e=>!0===e)):Ug(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Ug(n);if(r.numberOfChildren>1||!r.children[ty])return Uv(e.redirectTo);r=r.children[ty]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new _y(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return hy(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return hy(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new Cy(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Vv(e){const t={};for(const n of Object.keys(e.children)){const r=Vv(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children[ty]){const t=e.children[ty];return new Cy(e.segments.concat(t.segments),t.children)}return e}(new Cy(e.segments,t))}class $v{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class zv{constructor(e,t){this.component=e,this.route=t}}function Hv(e,t,n){const r=e._root;return qv(r,t?t._root:null,n,[r.value])}function Gv(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function qv(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Hy(t);return e.children.forEach(e=>{(function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!wy(e.url,t.url);case"pathParamsOrQueryParamsChange":return!wy(e.url,t.url)||!ay(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Xy(e,t)||!ay(e.queryParams,t.queryParams);case"paramsChange":default:return!Xy(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new $v(r)):(s.data=o.data,s._resolvedData=o._resolvedData),qv(e,t,s.component?a?a.children:null:n,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new zv(a.outlet.component,o))}else o&&Wv(t,a,i),i.canActivateChecks.push(new $v(r)),qv(e,null,s.component?a?a.children:null:n,r,i)})(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),hy(s,(e,t)=>Wv(e,n.getContext(t),i)),i}function Wv(e,t,n){const r=Hy(e),i=e.value;hy(r,(e,r)=>{Wv(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new zv(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class jv{}function Zv(e){return new T(t=>t.error(e))}class Yv{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=Av(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,ty);if(null===t)return null;const n=new Zy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},ty,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new zy(n,t),i=new Yy(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=jy(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=Tv(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=Qv(n);return r.sort((e,t)=>e.value.outlet===ty?-1:t.value.outlet===ty?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return Rv(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!Nv(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?uy(n).parameters:{};i=new Zy(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,e_(e),Ov(e),e.component,e,Jv(t),Xv(t)+n.length,t_(e))}else{const r=kv(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new Zy(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,e_(e),Ov(e),e.component,e,Jv(t),Xv(t)+s.length,t_(e))}const a=(u=e).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:l,slicedSegments:c}=Av(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);var u;if(0===c.length&&l.hasChildren()){const e=this.processChildren(a,l);return null===e?null:[new zy(i,e)]}if(0===a.length&&0===c.length)return[new zy(i,[])];const h=Ov(e)===r,d=this.processSegment(a,l,c,h?ty:r);return null===d?null:[new zy(i,d)]}}function Kv(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function Qv(e){const t=[],n=new Set;for(const r of e){if(!Kv(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=Qv(r.children);t.push(new zy(r.value,e))}return t.filter(e=>!n.has(e))}function Jv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Xv(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function e_(e){return e.data||{}}function t_(e){return e.resolve||{}}function n_(e){return Im(t=>{const n=e(t);return n?ae(n).pipe(D(()=>t)):Ug(t)})}class r_ extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const i_=new or("ROUTES");class s_{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe(D(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new mv(cy(r.injector.get(i_,void 0,Ne.Self|Ne.Optional)).map(Pv),r)}),Mm(e=>{throw t._loader$=void 0,e}));return t._loader$=new Tm(n,()=>new A).pipe(Om()),t._loader$}loadModuleFactory(e){return"string"==typeof e?ae(this.loader.load(e)):dy(e()).pipe(J(e=>e instanceof su?Ug(e):ae(this.compiler.compileModuleAsync(e))))}}class o_{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new a_,this.attachRef=null}}class a_{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new o_,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class l_{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function c_(e){throw e}function u_(e,t,n){return t.parse("/")}function h_(e,t){return Ug(null)}const d_={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},p_={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let f_=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=c_,this.malformedUriErrorHandler=u_,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:h_,afterPreactivation:h_},this.urlHandlingStrategy=new l_,this.routeReuseStrategy=new r_,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(iu),this.console=i.get(sh);const l=i.get(vh);this.isNgZoneEnabled=l instanceof vh&&vh.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new _y(new Cy([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new s_(s,o,e=>this.triggerEvent(new Zm(e)),e=>this.triggerEvent(new Ym(e))),this.routerState=qy(this.currentUrlTree,this.rootComponentType),this.transitions=new Em({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const t=this.events;return e.pipe(Vg(e=>0!==e.id),D(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Im(e=>{let n=!1,r=!1;return Ug(e).pipe(Fm(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Im(e=>{const n=this.browserUrlTree.toString(),i=!this.navigated||e.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||i)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return g_(e.source)&&(this.browserUrlTree=e.extractedUrl),Ug(e).pipe(Im(e=>{const n=this.transitions.getValue();return t.next(new Bm(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?ee:Promise.resolve(e)}),function(e,t,n,r){return Im(i=>function(e,t,n,r,i){return new Bv(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(D(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Fm(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,i,s){return J(o=>function(e,t,n,i,s="emptyOnly",o="legacy"){try{const r=new Yv(e,t,n,i,s,o).recognize();return null===r?Zv(new jv):Ug(r)}catch(r){return Zv(r)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),i,s).pipe(D(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Fm(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new Hm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(i&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new Bm(n,this.serializeUrl(r),i,s);t.next(a);const l=qy(r,this.rootComponentType).snapshot;return Ug(Object.assign(Object.assign({},e),{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ee}),n_(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Fm(e=>{const t=new Gm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),D(e=>Object.assign(Object.assign({},e),{guards:Hv(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return J(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?Ug(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ae(e).pipe(J(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Ug(s.map(s=>{const o=Gv(s,t,i);let a;if(function(e){return e&&yv(e.canDeactivate)}(o))a=dy(o.canDeactivate(e,t,n,r));else{if(!yv(o))throw new Error("Invalid CanDeactivate guard");a=dy(o(e,t,n,r))}return a.pipe(Lm())})).pipe(Cv()):Ug(!0)}(e.component,e.route,n,t,r)),Lm(e=>!0!==e,!0))}(o,r,i,e).pipe(J(n=>n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ae(t).pipe(Bg(t=>bm(function(e,t){return null!==e&&t&&t(new Km(e)),Ug(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Jm(e)),Ug(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>Pm(()=>Ug(t.guards.map(i=>{const s=Gv(i,t.node,n);let o;if(function(e){return e&&yv(e.canActivateChild)}(s))o=dy(s.canActivateChild(r,e));else{if(!yv(s))throw new Error("Invalid CanActivateChild guard");o=dy(s(r,e))}return o.pipe(Lm())})).pipe(Cv())));return Ug(i).pipe(Cv())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Ug(r.map(r=>Pm(()=>{const i=Gv(r,t,n);let s;if(function(e){return e&&yv(e.canActivate)}(i))s=dy(i.canActivate(t,e));else{if(!yv(i))throw new Error("Invalid CanActivate guard");s=dy(i(t,e))}return s.pipe(Lm())}))).pipe(Cv()):Ug(!0)}(e,t.route,n))),Lm(e=>!0!==e,!0))}(r,s,e,t):Ug(n)),D(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Fm(e=>{if(vv(e.guardsResult)){const t=sy(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new qm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Vg(e=>!!e.guardsResult||(this.restoreHistory(e),this.cancelNavigationTransition(e,""),!1)),n_(e=>{if(e.guards.canActivateChecks.length)return Ug(e).pipe(Fm(e=>{const t=new Wm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Im(e=>{let t=!1;return Ug(e).pipe(function(e,t){return J(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return Ug(n);let s=0;return ae(i).pipe(Bg(n=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return Ug({});const s={};return ae(i).pipe(J(i=>function(e,t,n,r){const i=Gv(e,t,r);return dy(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Fm(e=>{s[i]=e}))),Nm(1),J(()=>Object.keys(s).length===i.length?Ug(s):ee))}(e._resolve,e,t,r).pipe(D(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),jy(e,n).resolve),null)))}(n.route,r,e,t)),Fm(()=>s++),Nm(1),J(e=>s===i.length?Ug(n):ee))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Fm({next:()=>t=!0,complete:()=>{t||(this.restoreHistory(e),this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),Fm(e=>{const t=new jm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),n_(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),D(e=>{const t=function(e,t,n){const r=ev(e,t._root,n?n._root:void 0);return new Gy(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Fm(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),((e,t,n)=>D(r=>(new fv(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,e=>this.triggerEvent(e)),Fm({next(){n=!0},complete(){n=!0}}),function(e){return R((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var t;if(!n&&!r){const t=`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(e),this.cancelNavigationTransition(e,t)):this.cancelNavigationTransition(e,t)}(null===(t=this.currentNavigation)||void 0===t?void 0:t.id)===e.id&&(this.currentNavigation=null)}),Mm(n=>{if(r=!0,function(e){return e&&e[iy]}(n)){const r=vv(n.url);r||(this.navigated=!0,this.restoreHistory(e,!0));const i=new $m(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),r={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||g_(e.source)};this.scheduleNavigation(t,"imperative",null,r,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.restoreHistory(e,!0);const r=new zm(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(i){e.reject(i)}}return ee}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){wv(e),this.config=e.map(Pv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,l=o?this.currentUrlTree.fragment:i;let c=null;switch(s){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return iv(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new ov(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return hy(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new ov(n,t,r)}(n);if(s.toRoot())return iv(t.root,new Cy([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new av(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new av(e,e===t.root,0)}const r=nv(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new av(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?cv(o.segmentGroup,o.index,s.commands):lv(o.segmentGroup,o.index,s.commands);return iv(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,c,l??null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=vv(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},d_):!1===t?Object.assign({},p_):t,vv(e))return gy(this.currentUrlTree,e,n);const r=this.parseUrl(e);return gy(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Vm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,t,n,r,i){var s,o;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),l=g_(t)&&a&&!g_(a.source),c=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(l&&c)return Promise.resolve(!0);let u,h,d;i?(u=i.resolve,h=i.reject,d=i.promise):d=new Promise((e,t)=>{u=e,h=t});const p=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),f=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(s=this.browserPageId)&&void 0!==s?s:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):f=0,this.setTransition({id:p,targetPageId:f,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}restoreHistory(e,t=!1){var n,r;if("computed"===this.canceledNavigationResolution){const t=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===t?this.currentUrlTree===(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)&&0===t&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(t)}else"replace"===this.canceledNavigationResolution&&(t&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){const n=new $m(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(Or(lr),Or(Sy),Or(a_),Or(hd),Or(zo),Or(Vh),Or(gh),Or(void 0))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function g_(e){return"imperative"!==e}let m_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.commands=[],this.onChanges=new A,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}onClick(){const e={skipLocationChange:v_(this.skipLocationChange),replaceUrl:v_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:v_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(Wy),rr("tabindex"),ua(Oc),ua(Sc))},e.\u0275dir=st({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&Ea("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})(),y_=(()=>{class e{constructor(e,t,n){this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.onChanges=new A,this.subscription=e.events.subscribe(e=>{e instanceof Vm&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;const s={skipLocationChange:v_(this.skipLocationChange),replaceUrl:v_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,s),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:v_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(Wy),ua(od))},e.\u0275dir=st({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&Ea("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(nl("href",t.href,_i),ra("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})();function v_(e){return""===e||!!e}let __=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new xu,this.deactivateEvents=new xu,this.name=r||ty,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new C_(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(ua(a_),ua(au),ua(_c),rr("name"),ua(Yc))},e.\u0275dir=st({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class C_{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===Wy?this.route:e===a_?this.childContexts:this.parent.get(e,t)}}class E_{}class w_{preload(e,t){return Ug(null)}}let S_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new s_(t,n,t=>e.triggerEvent(new Zm(t)),t=>e.triggerEvent(new Ym(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Vg(e=>e instanceof Vm),Bg(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(iu);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ae(n).pipe(X(),D(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?Ug(t._loadedConfig):this.loader.load(e.injector,t)).pipe(J(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Or(f_),Or(Vh),Or(gh),Or(zo),Or(E_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),b_=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Bm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Vm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof ey&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new ey(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(f_),Or(lp),Or(void 0))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const P_=new or("ROUTER_CONFIGURATION"),O_=new or("ROUTER_FORROOT_GUARD"),T_=[hd,{provide:Sy,useClass:by},{provide:f_,useFactory:function(e,t,n,r,i,s,o,a={},l,c){const u=new f_(null,e,t,n,r,i,s,cy(o));return l&&(u.urlHandlingStrategy=l),c&&(u.routeReuseStrategy=c),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[Sy,a_,hd,zo,Vh,gh,i_,P_,[class{},new Nr],[class{},new Nr]]},a_,{provide:Wy,useFactory:function(e){return e.routerState.root},deps:[f_]},{provide:Vh,useClass:Hh},S_,w_,class{preload(e,t){return t().pipe(Mm(()=>Ug(null)))}},{provide:P_,useValue:{enableTracing:!1}}];function I_(){return new Rh("Router",f_)}let k_=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[T_,R_(t),{provide:O_,useFactory:N_,deps:[[f_,new Nr,new Rr]]},{provide:P_,useValue:n||{}},{provide:od,useFactory:M_,deps:[Qh,[new Mr(ld),new Nr],P_]},{provide:b_,useFactory:A_,deps:[f_,lp,P_]},{provide:E_,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:w_},{provide:Rh,multi:!0,useFactory:I_},[x_,{provide:Qu,multi:!0,useFactory:D_,deps:[x_]},{provide:F_,useFactory:L_,deps:[x_]},{provide:ih,multi:!0,useExisting:F_}]]}}static forChild(t){return{ngModule:e,providers:[R_(t)]}}}return e.\u0275fac=function(t){return new(t||e)(Or(O_,8),Or(f_,8))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();function A_(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new b_(e,t,n)}function M_(e,t,n={}){return n.useHash?new ud(e,t):new cd(e,t)}function N_(e){return"guarded"}function R_(e){return[{provide:ar,multi:!0,useValue:e},{provide:i_,multi:!0,useValue:e}]}let x_=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(Xh,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let e=null;const t=new Promise(t=>e=t),n=this.injector.get(f_),r=this.injector.get(P_);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?Ug(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(P_),n=this.injector.get(S_),r=this.injector.get(b_),i=this.injector.get(f_),s=this.injector.get(Uh);e===s.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function D_(e){return e.appInitializer.bind(e)}function L_(e){return e.bootstrapListener.bind(e)}const F_=new or("Router Initializer");class U_{}const B_="*";function V_(e,t=null){return{type:2,steps:e,options:t}}function $_(e){return{type:6,styles:e,offset:null}}function z_(e){Promise.resolve(null).then(e)}class H_{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){z_(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class G_{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?z_(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function q_(){return"undefined"!=typeof window&&void 0!==window.document}function W_(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function j_(e){switch(e.length){case 0:return new H_;case 1:return e[0];default:return new G_(e)}}function Z_(e,t,n,r,i={},s={}){const o=[],a=[];let l=-1,c=null;if(r.forEach(e=>{const n=e.offset,r=n==l,u=r&&c||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),a){case"!":a=i[n];break;case B_:a=s[n];break;default:a=t.normalizeStyleValue(n,r,a,o)}u[r]=a}),r||a.push(u),c=u,l=n}),o.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${o.join(e)}`)}return a}function Y_(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&K_(n,"start",e)));break;case"done":e.onDone(()=>r(n&&K_(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&K_(n,"destroy",e)))}}function K_(e,t,n){const r=Q_(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),i=e._data;return null!=i&&(r._data=i),r}function Q_(e,t,n,r,i="",s=0,o){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function J_(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function X_(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let eC=(e,t)=>!1,tC=(e,t)=>!1,nC=(e,t,n)=>[];const rC=W_();(rC||"undefined"!=typeof Element)&&(eC=q_()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),tC=(()=>{if(rC||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):tC}})(),nC=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let iC=null,sC=!1;function oC(e){iC||(iC=("undefined"!=typeof document?document.body:null)||{},sC=!!iC.style&&"WebkitAppearance"in iC.style);let t=!0;return iC.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in iC.style,!t&&sC&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in iC.style)),t}const aC=tC,lC=eC,cC=nC;function uC(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let hC=(()=>{class e{validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,s=[],o){return new H_(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),dC=(()=>{class e{}return e.NOOP=new hC,e})();const pC="ng-enter",fC="ng-leave",gC="ng-trigger",mC=".ng-trigger",yC="ng-animating",vC=".ng-animating";function _C(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:CC(parseFloat(t[1]),t[2])}function CC(e,t){switch(t){case"s":return 1e3*e;default:return e}}function EC(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,s="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=CC(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=CC(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=e;if(!n){let n=!1,s=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(s,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:s}}(e,t,n)}function wC(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function SC(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else wC(e,n);return n}function bC(e,t,n){return n?t+":"+n+";":""}function PC(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=bC(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=bC(0,DC(n),e.style[n]));e.setAttribute("style",t)}function OC(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=xC(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),W_()&&PC(e))}function TC(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=xC(t);e.style[n]=""}),W_()&&PC(e))}function IC(e){return Array.isArray(e)?1==e.length?e[0]:V_(e):e}const kC=new RegExp("{{\\s*(.+?)\\s*}}","g");function AC(e){let t=[];if("string"==typeof e){let n;for(;n=kC.exec(e);)t.push(n[1]);kC.lastIndex=0}return t}function MC(e,t,n){const r=e.toString(),i=r.replace(kC,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function NC(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const RC=/-+([a-z0-9])/g;function xC(e){return e.replace(RC,(...e)=>e[1].toUpperCase())}function DC(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function LC(e,t){return 0===e||0===t}function FC(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let s=t[0],o=[];if(r.forEach(e=>{s.hasOwnProperty(e)||o.push(e),s[e]=n[e]}),o.length)for(var i=1;i<t.length;i++){let n=t[i];o.forEach(function(t){n[t]=BC(e,t)})}}return t}function UC(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function BC(e,t){return window.getComputedStyle(e)[t]}function VC(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],s=r[2],o=r[3];t.push(HC(i,o));"<"==s[0]&&!("*"==i&&"*"==o)&&t.push(HC(o,i))}(e,n,t)):n.push(e),n}const $C=new Set(["true","1"]),zC=new Set(["false","0"]);function HC(e,t){const n=$C.has(e)||zC.has(e),r=$C.has(t)||zC.has(t);return(i,s)=>{let o="*"==e||e==i,a="*"==t||t==s;return!o&&n&&"boolean"==typeof i&&(o=i?$C.has(e):zC.has(e)),!a&&r&&"boolean"==typeof s&&(a=s?$C.has(t):zC.has(t)),o&&a}}const GC=new RegExp("s*:selfs*,?","g");function qC(e,t,n){return new WC(e).build(t,n)}class WC{constructor(e){this._driver=e}build(e,t){const n=new jC(t);return this._resetContextStyleTimingState(n),UC(this,IC(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],s=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,s.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(e=>{if(ZC(e)){const t=e;Object.keys(t).forEach(e=>{AC(t[e]).forEach(e=>{s.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=NC(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=UC(this,IC(e.animation),t);return{type:1,matchers:VC(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:YC(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>UC(this,e,t)),options:YC(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=UC(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:YC(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return KC(EC(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=KC(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||EC(r,t),KC(n.duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;let r,i=e.styles?e.styles:$_({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,s=!1;if(!i){s=!0;const e={};n.easing&&(e.easing=n.easing),i=$_(e)}t.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,t);o.isEmptyStep=s,r=o}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==B_?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(ZC(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=t.collectedStyles[t.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=AC(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const l=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let l=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(ZC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(ZC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),c=0;return null!=l&&(r++,c=n.offset=l),o=o||c<0||c>1,s=s||c<a,a=c,i.push(c),n});o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&t.errors.push("Please ensure that all keyframe offsets are in order");const c=e.steps.length;let u=0;r>0&&r<c?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(u=1/(c-1));const h=c-1,d=t.currentTime,p=t.currentAnimateTimings,f=p.duration;return l.forEach((e,r)=>{const s=u>0?r==h?1:u*r:i[r],o=s*f;t.currentTime=d+p.delay+o,p.duration=o,this._validateStyleAst(e,t),e.offset=s,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:UC(this,IC(e.animation),t),options:YC(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:YC(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:YC(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,s]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(GC,"")),[e=e.replace(/@\*/g,mC).replace(/@\w+/g,e=>mC+"-"+e.substr(1)).replace(/:animating/g,vC),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,J_(t.collectedStyles,t.currentQuerySelector,{});const o=UC(this,IC(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:e.selector,options:YC(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:EC(e.timings,t.errors,!0);return{type:12,animation:UC(this,IC(e.animation),t),timings:n,options:null}}}class jC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function ZC(e){return!Array.isArray(e)&&"object"==typeof e}function YC(e){return e?(e=wC(e)).params&&(e.params=function(e){return e?wC(e):null}(e.params)):e={},e}function KC(e,t,n){return{duration:e,delay:t,easing:n}}function QC(e,t,n,r,i,s,o=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class JC{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const XC=new RegExp(":enter","g"),eE=new RegExp(":leave","g");function tE(e,t,n,r,i,s={},o={},a,l,c=[]){return(new nE).buildKeyframes(e,t,n,r,i,s,o,a,l,c)}class nE{buildKeyframes(e,t,n,r,i,s,o,a,l,c=[]){l=l||new JC;const u=new iE(e,t,l,r,i,c,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),UC(this,n,u);const h=u.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(o).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([o],null,u.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[QC(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&t.transformIntoNewTimeline(s)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?_C(n.duration):null,s=null!=n.delay?_C(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),UC(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=rE);const e=_C(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>UC(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?_C(e.options.delay):0;e.steps.forEach(s=>{const o=t.createSubContext(e.options);i&&o.delayNextStep(i),UC(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return EC(t.params?MC(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,s=t.createSubContext().currentTimeline;s.easing=n.easing,e.styles.forEach(e=>{s.forwardTime((e.offset||0)*i),s.setStyles(e.styles,e.easing,t.errors,t.options),s.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(s),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?_C(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=rE);let s=n;const o=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{t.currentQueryIndex=r;const o=t.createSubContext(e.options,n);i&&o.delayNextStep(i),n===t.element&&(a=o.currentTimeline),UC(this,e.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(s),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,s=Math.abs(i.duration),o=s*(t.currentQueryTotal-1);let a=s*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const l=t.currentTimeline;a&&l.delayNextStep(a);const c=l.currentTime;UC(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}const rE={};class iE{constructor(e,t,n,r,i,s,o,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=rE,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new sE(this._driver,t,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=_C(n.duration)),null!=n.delay&&(r.delay=_C(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{(!t||!e.hasOwnProperty(n))&&(e[n]=MC(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new iE(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=rE,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},i=new oE(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,s){let o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(XC,"."+this._enterClassName)).replace(eE,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),o.push(...t)}return!i&&0==o.length&&s.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),o}}class sE{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new sE(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||B_,this._currentKeyframe[e]=B_}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},s=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=B_})):SC(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(s).forEach(e=>{const t=MC(s[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:B_),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=SC(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?e.add(n):r==B_&&t.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=e.size?NC(e.values()):[],s=t.size?NC(t.values()):[];if(n){const e=r[0],t=wC(e);e.offset=0,t.offset=1,r=[e,t]}return QC(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class oE extends sE{constructor(e,t,n,r,i,s,o=!1){super(e,t,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],s=n+t,o=t/s,a=SC(e[0],!1);a.offset=0,i.push(a);const l=SC(e[0],!1);l.offset=aE(o),i.push(l);const c=e.length-1;for(let r=1;r<=c;r++){let o=SC(e[r],!1);o.offset=aE((t+o.offset*n)/s),i.push(o)}n=s,t=0,r="",e=i}return QC(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function aE(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class lE{}class cE extends lE{normalizePropertyName(e,t){return xC(e)}normalizeStyleValue(e,t,n,r){let i="";const s=n.toString().trim();if(uE[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return s+i}}const uE=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function hE(e,t,n,r,i,s,o,a,l,c,u,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}const dE={};class pE{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],s=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):s}build(e,t,n,r,i,s,o,a,l,c){const u=[],h=this.ast.options&&this.ast.options.params||dE,d=this.buildStyles(n,o&&o.params||dE,u),p=a&&a.params||dE,f=this.buildStyles(r,p,u),g=new Set,m=new Map,y=new Map,v="void"===r,_={params:Object.assign(Object.assign({},h),p)},C=c?[]:tE(e,t,this.ast.animation,i,s,d,f,_,l,u);let E=0;if(C.forEach(e=>{E=Math.max(e.duration+e.delay,E)}),u.length)return hE(t,this._triggerName,n,r,v,d,f,[],[],m,y,E,u);C.forEach(e=>{const n=e.element,r=J_(m,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=J_(y,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&g.add(n)});const w=NC(g.values());return hE(t,this._triggerName,n,r,v,d,f,C,w,m,y,E)}}class fE{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){const n={},r=wC(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let s=i[e];s.length>1&&(s=MC(s,r,t));const o=this.normalizer.normalizePropertyName(e,t);s=this.normalizer.normalizeStyleValue(e,o,s,t),n[o]=s})}}),n}}class gE{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new fE(e.style,e.options&&e.options.params||{},n)}),mE(this.states,"true","1"),mE(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new pE(e,t,this.states))}),this.fallbackTransition=function(e,t,n){return new pE(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},t)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function mE(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const yE=new JC;class vE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=qC(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=Z_(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let s;const o=new Map;if(i?(s=tE(this._driver,t,i,pC,fC,{},{},n,yE,r),s.forEach(e=>{const t=J_(o,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);o.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,B_)})});const a=j_(s.map(e=>{const t=o.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=Q_(t,"","","");return Y_(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const _E="ng-animate-queued",CE="ng-animate-disabled",EE=".ng-animate-disabled",wE=[],SE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},bE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},PE="__ng_removed";class OE{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=(n?e.value:e)??null,n){const t=wC(e);delete t.value,this.options=t}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const TE="void",IE=new OE(TE);class kE{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,FE(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const s=J_(this._elementListeners,e,[]),o={name:t,phase:n,callback:r};s.push(o);const a=J_(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(FE(e,gC),FE(e,gC+"-"+t),a[t]=IE),()=>{this._engine.afterFlush(()=>{const e=s.indexOf(o);e>=0&&s.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),s=new ME(this.id,t,e);let o=this._engine.statesByElement.get(e);o||(FE(e,gC),FE(e,gC+"-"+t),this._engine.statesByElement.set(e,o={}));let a=o[t];const l=new OE(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&l.absorbOptions(a.options),o[t]=l,a||(a=IE),l.value!==TE&&a.value===l.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,l.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(l.value,l.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{TC(e,n),OC(e,r)})}return}const c=J_(this._engine.playersByElement,e,[]);c.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let u=i.matchTransition(a.value,l.value,e,l.params),h=!1;if(!u){if(!r)return;u=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:u,fromState:a,toState:l,player:s,isFallbackTransition:h}),h||(FE(e,_E),s.onStart(()=>{UE(e,_E)})),s.onDone(()=>{let t=this.players.indexOf(s);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(s);e>=0&&n.splice(e,1)}}),this.players.push(s),c.push(s),s}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,mC,!0);n.forEach(e=>{if(e[PE])return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const s=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,TE,r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&j_(s).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const s=this._triggers[i].fallbackTransition,o=n[i]||IE,a=new OE(TE),l=new ME(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:s,fromState:o,toState:a,player:l,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e[PE];(!r||r===SE)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){FE(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(t=>{if(t.name==n.triggerName){const r=Q_(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,Y_(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class AE{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new kE(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(NE(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!NE(t))return;const i=t[PE];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),FE(e,CE)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),UE(e,CE))}removeNode(e,t,n,r){if(NE(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t[PE]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return NE(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,mC,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,vC,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return j_(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[PE];if(t&&t.setForRemoval){if(e[PE]=SE,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,EE)&&this.markElementAsDisabled(e,!1),this.driver.query(e,EE,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)FE(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?j_(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new JC,r=[],i=new Map,s=[],o=new Map,a=new Map,l=new Map,c=new Set;this.disabledNodes.forEach(e=>{c.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)c.add(t[n])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=DE(h,this.collectedEnterElements),p=new Map;let f=0;d.forEach((e,t)=>{const n=pC+f++;p.set(t,n),e.forEach(e=>FE(e,n))});const g=[],m=new Set,y=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const e=this.collectedLeaveElements[A],t=e[PE];t&&t.setForRemoval&&(g.push(e),m.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>m.add(e)):y.add(e))}const v=new Map,_=DE(h,Array.from(m));_.forEach((e,t)=>{const n=fC+f++;v.set(t,n),e.forEach(e=>FE(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=p.get(t);e.forEach(e=>UE(e,n))}),_.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>UE(e,n))}),g.forEach(e=>{this.processLeaveNode(e)})});const C=[],E=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(C.push(t),this.collectedEnterElements.length){const e=i[PE];if(e&&e.setForMove)return void t.destroy()}const c=!u||!this.driver.containsElement(u,i),h=v.get(i),d=p.get(i),f=this._buildInstruction(e,n,d,h,c);if(f.errors&&f.errors.length)E.push(f);else{if(c)return t.onStart(()=>TC(i,f.fromStyles)),t.onDestroy(()=>OC(i,f.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>TC(i,f.fromStyles)),t.onDestroy(()=>OC(i,f.toStyles)),void r.push(t);f.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,f.timelines),s.push({instruction:f,player:t,element:i}),f.queriedElements.forEach(e=>J_(o,e,[]).push(t)),f.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),f.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=l.get(t);r||l.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(E.length){const e=[];E.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),C.forEach(e=>e.destroy()),this.reportError(e)}const w=new Map,S=new Map;s.forEach(e=>{const t=e.element;n.has(t)&&(S.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,w))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{J_(w,t,[]).push(e),e.destroy()})});const b=g.filter(e=>$E(e,a,l)),P=new Map;xE(P,this.driver,y,l,B_).forEach(e=>{$E(e,a,l)&&b.push(e)});const O=new Map;d.forEach((e,t)=>{xE(O,this.driver,new Set(e),a,"!")}),b.forEach(e=>{const t=P.get(e),n=O.get(e);P.set(e,Object.assign(Object.assign({},t),n))});const T=[],I=[],k={};s.forEach(e=>{const{element:t,player:s,instruction:o}=e;if(n.has(t)){if(c.has(t))return s.onDestroy(()=>OC(t,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let e=k;if(S.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=S.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>S.set(t,e))}const n=this._buildAnimation(s.namespaceId,o,w,i,O,P);if(s.setRealPlayer(n),e===k)T.push(s);else{const t=this.playersByElement.get(e);t&&t.length&&(s.parentPlayer=j_(t)),r.push(s)}}else TC(t,o.fromStyles),s.onDestroy(()=>OC(t,o.toStyles)),I.push(s),c.has(t)&&r.push(s)}),I.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=j_(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let A=0;A<g.length;A++){const e=g[A],t=e[PE];if(UE(e,fC),t&&t.hasAnimation)continue;let n=[];if(o.size){let t=o.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,vC,!0);for(let e=0;e<r.length;e++){let t=o.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?BE(this,e,r):this.processLeaveNode(e)}return g.length=0,T.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),T}elementContainsData(e,t){let n=!1;const r=t[PE];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let s=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(s=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==TE;t.forEach(t=>{t.queued||!e&&t.triggerName!=r||s.push(t)})}}return(n||r)&&(s=s.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),s}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName;for(const o of t.timelines){const e=o.element,a=e!==r,l=J_(n,e,[]);this._getPreviousPlayers(e,a,i,s,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),l.push(e)})}TC(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,s){const o=t.triggerName,a=t.element,l=[],c=new Set,u=new Set,h=t.timelines.map(t=>{const h=t.element;c.add(h);const d=h[PE];if(d&&d.removedBeforeQueried)return new H_(t.duration,t.delay);const p=h!==a,f=function(e){const t=[];return VE(e,t),t}((n.get(h)||wE).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),g=i.get(h),m=s.get(h),y=Z_(0,this._normalizer,0,t.keyframes,g,m),v=this._buildPlayer(t,y,f);if(t.subTimeline&&r&&u.add(h),p){const t=new ME(e,o,h);t.setRealPlayer(v),l.push(t)}return v});l.forEach(e=>{J_(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),c.forEach(e=>FE(e,yC));const d=j_(h);return d.onDestroy(()=>{c.forEach(e=>UE(e,yC)),OC(a,t.toStyles)}),u.forEach(e=>{J_(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new H_(e.duration,e.delay)}}class ME{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new H_,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>Y_(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){J_(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function NE(e){return e&&1===e.nodeType}function RE(e,t){const n=e.style.display;return e.style.display=t??"none",n}function xE(e,t,n,r,i){const s=[];n.forEach(e=>s.push(RE(e)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(e=>{const n=s[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[PE]=bE,o.push(r))}),e.set(r,s)});let a=0;return n.forEach(e=>RE(e,s[a++])),o}function DE(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function s(e){if(!e)return 1;let t=i.get(e);if(t)return t;const o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:s(o),i.set(e,t),t}return t.forEach(e=>{const t=s(e);1!==t&&n.get(t).push(e)}),n}const LE="$$classes";function FE(e,t){if(e.classList)e.classList.add(t);else{let n=e[LE];n||(n=e[LE]={}),n[t]=!0}}function UE(e,t){if(e.classList)e.classList.remove(t);else{let n=e[LE];n&&delete n[t]}}function BE(e,t,n){j_(n).onDone(()=>e.processLeaveNode(t))}function VE(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof G_?VE(r.players,t):t.push(r)}}function $E(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class zE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new AE(e,t,n),this._timelineEngine=new vE(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const s=e+"-"+r;let o=this._triggerCache[s];if(!o){const e=[],t=qC(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);o=function(e,t,n){return new gE(e,t,n)}(r,t,this._normalizer),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(t,r,o)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=X_(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=X_(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function HE(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=qE(t[0]),t.length>1&&(r=qE(t[t.length-1]))):t&&(n=qE(t)),n||r?new GE(e,n,r):null}let GE=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&OC(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(OC(this._element,this._initialStyles),this._endStyles&&(OC(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(TC(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(TC(this._element,this._endStyles),this._endStyles=null),OC(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function qE(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];WE(i)&&(t=t||{},t[i]=e[i])}return t}function WE(e){return"display"===e||"position"===e}const jE="animation",ZE="animationend";class YE{constructor(e,t,n,r,i,s,o){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){(function(e,t){const n=tw(e,"").trim();let r=0;n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++;return n}(n)+1,t=`${n}, ${t}`),ew(e,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),XE(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){KE(this._element,this._name,"paused")}resume(){KE(this._element,this._name,"running")}setPosition(e){const t=QE(this._element,this._name);this._position=e*this._duration,ew(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),XE(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=tw(e,"").split(","),r=JE(n,t);r>=0&&(n.splice(r,1),ew(e,"",n.join(",")))}(this._element,this._name))}}function KE(e,t,n){ew(e,"PlayState",n,QE(e,t))}function QE(e,t){const n=tw(e,"");return n.indexOf(",")>0?JE(n.split(","),t):JE([n],t)}function JE(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function XE(e,t,n){n?e.removeEventListener(ZE,t):e.addEventListener(ZE,t)}function ew(e,t,n,r){const i=jE+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function tw(e,t){return e.style[jE+t]||""}class nw{constructor(e,t,n,r,i,s,o,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new YE(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:BC(this.element,n))})}this.currentSnapshot=e}}class rw extends H_{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=uC(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class iw{constructor(){this._count=0}validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>uC(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const s=document.createElement("style");return s.textContent=r,s}animate(e,t,n,r,i,s=[],o){const a=s.filter(e=>e instanceof nw),l={};LC(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const c=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=FC(e,t,l));if(0==n)return new rw(e,c);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,u,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=HE(e,t),p=new nw(e,t,u,n,r,i,c,d);return p.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),p}}class sw{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:BC(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class ow{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(aw().toString()),this._cssKeyframesDriver=new iw}validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const l={},c=s.filter(e=>e instanceof sw);LC(n,r)&&c.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const u=HE(e,t=FC(e,t=t.map(e=>SC(e,!1)),l));return new sw(e,t,a,u)}}function aw(){return q_()&&Element.prototype.animate||{}}let lw=(()=>{class e extends U_{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:Ue.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?V_(e):e;return hw(this._renderer,null,t,"register",[n]),new cw(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(Or(Pc),Or(Kh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class cw extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new uw(this._id,e,t||{},this._renderer)}}class uw{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return hw(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function hw(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const dw="@.disabled";let pw=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new fw("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const s=t=>{Array.isArray(t)?t.forEach(s):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(s),new gw(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(Or(Pc),Or(zE),Or(vh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class fw{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){"@"==t.charAt(0)&&t==dw?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class gw extends fw{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==dw?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if("@"==t.charAt(0)){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let mw=(()=>{class e extends zE{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(dC),Or(lE))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const yw=new or("AnimationModuleType"),vw=[{provide:U_,useClass:lw},{provide:lE,useFactory:function(){return new cE}},{provide:zE,useClass:mw},{provide:Pc,useFactory:function(e,t,n){return new pw(e,t,n)},deps:[kp,zE,vh]}],_w=[{provide:dC,useFactory:function(){return"function"==typeof aw()?new ow:new iw}},{provide:yw,useValue:"BrowserAnimations"},...vw],Cw=[{provide:dC,useClass:hC},{provide:yw,useValue:"NoopAnimations"},...vw];let Ew=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?Cw:_w}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:_w,imports:[Hp]}),e})();var ww=n(9575),Sw=n.n(ww);function bw(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function Pw(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){bw(s,r,i,o,a,"next",e)}function a(e){bw(s,r,i,o,a,"throw",e)}o(void 0)})}}class Ow{static expectToBe(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error(`A default switch case did not observe the correct value, expected ${t}, but got ${e} instead.`)}static expectToBeMultiple(e,t){let n=!1;for(const r of t)if(e===r){n=!0;break}if(!1===n)throw new Error(`A default switch case did not observe the correct value, expected a value among ${t}, but got ${e} instead.`)}static getNonNullable(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}function Tw(e,t){e&&console.log(t)}function Iw(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);{const n=e,r=t;for(const e of Object.keys(n)){if(!(e in r))return!1;if(!1===Iw(n[e],r[e]))return!1}return!0}}return e===t}function kw(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(const t in e)if(null!=e[t]&&!1===kw(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function Aw(e,t){if(kw(e)&&kw(t))return Iw(e,t);throw new Error(`Comparing non comparable objects: ${e.constructor.name} and ${t.constructor.name}`)}class Mw{constructor(e){this.value=e}static of(e){return new Mw(e)}static ofNullable(e){return null==e?Mw.empty():Mw.of(e)}static empty(){return new Mw(null)}isPresent(){return null!=this.value}isAbsent(){return null==this.value}get(){if(this.isPresent())return this.value;throw new Error("Value is absent")}getOrElse(e){return this.isPresent()?this.value:e}equals(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&Aw(this.value,e.value)}equalsValue(e){return this.equals(Mw.of(e))}toString(){return this.isAbsent()?"MGPOptional.empty()":`MGPOptional.of(${this.value})`}map(e){return this.isPresent()?Mw.of(e(this.get())):Mw.empty()}}const Nw=function(e,t){if(!e)throw Rw(t)},Rw=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},xw=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Dw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0;let c=(15&o)<<2|l>>6,u=63&l;a||(u=64,s||(c=64)),r.push(n[t>>2],n[(3&t)<<4|o>>4],n[c],n[u])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(xw(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();r.push(t<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Lw=function(e){const t=xw(e);return Dw.encodeByteArray(t,!0)},Fw=function(e){return Lw(e).replace(/\./g,"")},Uw=function(e){try{return Dw.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Bw(e){return Vw(void 0,e)}function Vw(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)!t.hasOwnProperty(n)||!$w(n)||(e[n]=Vw(e[n],t[n]));return e}function $w(e){return"__proto__"!==e}class zw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Hw(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Fw(JSON.stringify({alg:"none",type:"JWT"})),Fw(JSON.stringify(s)),""].join(".")}function Gw(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function qw(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Gw())}function Ww(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function jw(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Zw(){const e=Gw();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Yw(){return"object"==typeof indexedDB}function Kw(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function Qw(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Jw extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Jw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xw.prototype.create)}}class Xw{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(eS,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error";return new Jw(r,`${this.serviceName}: ${s} (${r}).`,n)}}const eS=/\{\$([^}]+)}/g;function tS(e){return JSON.parse(e)}function nS(e){return JSON.stringify(e)}const rS=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=tS(Uw(s[0])||""),n=tS(Uw(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}};function iS(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function sS(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function oS(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function aS(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function lS(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(cS(n)&&cS(s)){if(!lS(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function cS(e){return null!==e&&"object"==typeof e}function uS(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function hS(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function dS(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class pS{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=l^o&(a^l),i=1518500249):(r=o^a^l,i=1859775393):u<60?(r=o&a|l&(o|a),i=2400959708):(r=o^a^l,i=3395469782);const e=(s<<5|s>>>27)+r+c+i+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class fS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of["next","error","complete"])if(n in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=gS),void 0===r.error&&(r.error=gS),void 0===r.complete&&(r.complete=gS);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gS(){}function mS(e,t){return`${e} failed: ${t} argument `}const yS=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function vS(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function _S(e){return e&&e._delegate?e._delegate:e}class CS{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ES="[DEFAULT]";class wS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new zw;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ES})}catch{}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=ES){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return Pw(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=ES){return this.instances.has(e)}getOptions(e=ES){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===ES?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=ES){return this.component?this.component.multipleInstances?e:ES:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class SS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const bS=[];var PS=(()=>{return(e=PS||(PS={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",PS;var e})();const OS={debug:PS.DEBUG,verbose:PS.VERBOSE,info:PS.INFO,warn:PS.WARN,error:PS.ERROR,silent:PS.SILENT},TS=PS.INFO,IS={[PS.DEBUG]:"log",[PS.VERBOSE]:"log",[PS.INFO]:"info",[PS.WARN]:"warn",[PS.ERROR]:"error"},kS=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=IS[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class AS{constructor(e){this.name=e,this._logLevel=TS,this._logHandler=kS,this._userLogHandler=null,bS.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in PS))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?OS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,PS.DEBUG,...e),this._logHandler(this,PS.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,PS.VERBOSE,...e),this._logHandler(this,PS.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,PS.INFO,...e),this._logHandler(this,PS.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,PS.WARN,...e),this._logHandler(this,PS.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,PS.ERROR,...e),this._logHandler(this,PS.ERROR,...e)}}class MS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const NS="@firebase/app",RS=new AS("@firebase/app"),xS="[DEFAULT]",DS={[NS]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},LS=new Map,FS=new Map;function US(e,t){try{e.container.addComponent(t)}catch(n){RS.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function BS(e){const t=e.name;if(FS.has(t))return RS.debug(`There were multiple attempts to register component ${t}.`),!1;FS.set(t,e);for(const n of LS.values())US(n,e);return!0}function VS(e,t){return e.container.getProvider(t)}const $S=new Xw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class zS{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new CS("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $S.create("app-deleted",{appName:this._name})}}const HS="9.6.6";function GS(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:xS,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw $S.create("bad-app-name",{appName:String(r)});const i=LS.get(r);if(i){if(lS(e,i.options)&&lS(n,i.config))return i;throw $S.create("duplicate-app",{appName:r})}const s=new SS(r);for(const a of FS.values())s.addComponent(a);const o=new zS(e,n,s);return LS.set(r,o),o}function qS(e=xS){const t=LS.get(e);if(!t)throw $S.create("no-app",{appName:e});return t}function WS(){return Array.from(LS.values())}function jS(e,t,n){var r;let i=null!==(r=DS[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void RS.warn(e.join(" "))}BS(new CS(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}BS(new CS("platform-logger",e=>new MS(e),"PRIVATE")),jS(NS,"0.7.16",""),jS(NS,"0.7.16","esm2017"),jS("fire-js",""),jS("firebase","9.6.6","app");var ZS=n(6676);const YS="@firebase/installations",KS="w:0.5.5",QS="FIS_v2",JS=new Xw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function XS(e){return e instanceof Jw&&e.code.includes("request-failed")}function eb({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function tb(e){return{token:e.token,requestStatus:2,expiresIn:lb(e.expiresIn),creationTime:Date.now()}}function nb(e,t){return rb.apply(this,arguments)}function rb(){return(rb=Pw(function*(e,t){const n=(yield t.json()).error;return JS.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})).apply(this,arguments)}function ib({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function sb(e,{refreshToken:t}){const n=ib(e);return n.append("Authorization",function(e){return`${QS} ${e}`}(t)),n}function ob(e){return ab.apply(this,arguments)}function ab(){return(ab=Pw(function*(e){const t=yield e();return t.status>=500&&t.status<600?e():t})).apply(this,arguments)}function lb(e){return Number(e.replace("s","000"))}function cb(e,t){return ub.apply(this,arguments)}function ub(){return(ub=Pw(function*(e,{fid:t}){const n=eb(e),r={method:"POST",headers:ib(e),body:JSON.stringify({fid:t,authVersion:QS,appId:e.appId,sdkVersion:KS})},i=yield ob(()=>fetch(n,r));if(i.ok){const e=yield i.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:tb(e.authToken)}}throw yield nb("Create Installation",i)})).apply(this,arguments)}function hb(e){return new Promise(t=>{setTimeout(t,e)})}const db=/^[cdef][\w-]{21}$/;function pb(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return db.test(t)?t:""}catch{return""}}function fb(e){return`${e.appName}!${e.appId}`}const gb=new Map;function mb(e,t){const n=fb(e);yb(n,t),function(e,t){const n=(!vb&&"BroadcastChannel"in self&&(vb=new BroadcastChannel("[Firebase] FID Change"),vb.onmessage=e=>{yb(e.data.key,e.data.fid)}),vb);n&&n.postMessage({key:e,fid:t}),0===gb.size&&vb&&(vb.close(),vb=null)}(n,t)}function yb(e,t){const n=gb.get(e);if(n)for(const r of n)r(t)}let vb=null;const _b="firebase-installations-store";let Cb=null;function Eb(){return Cb||(Cb=(0,ZS.openDb)("firebase-installations-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(_b)}})),Cb}function wb(e,t){return Sb.apply(this,arguments)}function Sb(){return(Sb=Pw(function*(e,t){const n=fb(e),r=(yield Eb()).transaction(_b,"readwrite"),i=r.objectStore(_b),s=yield i.get(n);return yield i.put(t,n),yield r.complete,(!s||s.fid!==t.fid)&&mb(e,t.fid),t})).apply(this,arguments)}function bb(e){return Pb.apply(this,arguments)}function Pb(){return(Pb=Pw(function*(e){const t=fb(e),n=(yield Eb()).transaction(_b,"readwrite");yield n.objectStore(_b).delete(t),yield n.complete})).apply(this,arguments)}function Ob(e,t){return Tb.apply(this,arguments)}function Tb(){return(Tb=Pw(function*(e,t){const n=fb(e),r=(yield Eb()).transaction(_b,"readwrite"),i=r.objectStore(_b),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.complete,o&&(!s||s.fid!==o.fid)&&mb(e,o.fid),o})).apply(this,arguments)}function Ib(e){return kb.apply(this,arguments)}function kb(){return(kb=Pw(function*(e){let t;const n=yield Ob(e,n=>{const r=Ab(n),i=Mb(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})).apply(this,arguments)}function Ab(e){return Lb(e||{fid:pb(),registrationStatus:0})}function Mb(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(JS.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return Nb.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Rb(e)}:{installationEntry:t}}function Nb(){return(Nb=Pw(function*(e,t){try{return wb(e,yield cb(e,t))}catch(n){throw XS(n)&&409===n.customData.serverCode?yield bb(e):yield wb(e,{fid:t.fid,registrationStatus:0}),n}})).apply(this,arguments)}function Rb(e){return xb.apply(this,arguments)}function xb(){return(xb=Pw(function*(e){let t=yield Db(e);for(;1===t.registrationStatus;)yield hb(100),t=yield Db(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield Ib(e);return n||t}return t})).apply(this,arguments)}function Db(e){return Ob(e,e=>{if(!e)throw JS.create("installation-not-found");return Lb(e)})}function Lb(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function Fb(e,t){return Ub.apply(this,arguments)}function Ub(){return(Ub=Pw(function*({appConfig:e,platformLoggerProvider:t},n){const r=Bb(e,n),i=sb(e,n),s=t.getImmediate({optional:!0});s&&i.append("x-firebase-client",s.getPlatformInfoString());const o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:KS}})},a=yield ob(()=>fetch(r,o));if(a.ok)return tb(yield a.json());throw yield nb("Generate Auth Token",a)})).apply(this,arguments)}function Bb(e,{fid:t}){return`${eb(e)}/${t}/authTokens:generate`}function Vb(e){return $b.apply(this,arguments)}function $b(){return($b=Pw(function*(e,t=!1){let n;const r=yield Ob(e.appConfig,r=>{if(!jb(r))throw JS.create("not-registered");const i=r.authToken;if(!t&&Zb(i))return r;if(1===i.requestStatus)return n=zb(e,t),r;{if(!navigator.onLine)throw JS.create("app-offline");const t=Yb(r);return n=qb(e,t),t}});return n?yield n:r.authToken})).apply(this,arguments)}function zb(e,t){return Hb.apply(this,arguments)}function Hb(){return(Hb=Pw(function*(e,t){let n=yield Gb(e.appConfig);for(;1===n.authToken.requestStatus;)yield hb(100),n=yield Gb(e.appConfig);const r=n.authToken;return 0===r.requestStatus?Vb(e,t):r})).apply(this,arguments)}function Gb(e){return Ob(e,e=>{if(!jb(e))throw JS.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function qb(e,t){return Wb.apply(this,arguments)}function Wb(){return(Wb=Pw(function*(e,t){try{const n=yield Fb(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield wb(e.appConfig,r),n}catch(n){if(!XS(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield wb(e.appConfig,n)}else yield bb(e.appConfig);throw n}})).apply(this,arguments)}function jb(e){return void 0!==e&&2===e.registrationStatus}function Zb(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function Yb(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function Kb(){return(Kb=Pw(function*(e){const t=e,{installationEntry:n,registrationPromise:r}=yield Ib(t.appConfig);return r?r.catch(console.error):Vb(t).catch(console.error),n.fid})).apply(this,arguments)}function Qb(){return(Qb=Pw(function*(e,t=!1){const n=e;return yield Jb(n.appConfig),(yield Vb(n,t)).token})).apply(this,arguments)}function Jb(e){return Xb.apply(this,arguments)}function Xb(){return(Xb=Pw(function*(e){const{registrationPromise:t}=yield Ib(e);t&&(yield t)})).apply(this,arguments)}function eP(e){return JS.create("missing-app-config-values",{valueName:e})}const tP="installations";BS(new CS(tP,e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw eP("App Configuration");if(!e.name)throw eP("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw eP(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:VS(t,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),BS(new CS("installations-internal",e=>{const t=VS(e.getProvider("app").getImmediate(),tP).getImmediate();return{getId:()=>function(e){return Kb.apply(this,arguments)}(t),getToken:e=>function(e){return Qb.apply(this,arguments)}(t,e)}},"PRIVATE")),jS(YS,"0.5.5"),jS(YS,"0.5.5","esm2017");const nP="@firebase/remote-config",rP=new Xw("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class iP{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}fetch(e){var t=this;return Pw(function*(){const[n,r]=yield Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);if(r&&t.isCachedDataFresh(e.cacheMaxAgeMillis,n))return r;e.eTag=r&&r.eTag;const i=yield t.client.fetch(e),s=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===i.status&&s.push(t.storage.setLastSuccessfulFetchResponse(i)),yield Promise.all(s),i})()}}function sP(e=navigator){return e.languages&&e.languages[0]||e.language}class oP{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}fetch(e){var t=this;return Pw(function*(){const[n,r]=yield Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${t.projectId}/namespaces/${t.namespace}:fetch?key=${t.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},o={sdk_version:t.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:t.appId,language_code:sP()},a={method:"POST",headers:s,body:JSON.stringify(o)},l=fetch(i,a),c=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let u;try{yield Promise.race([l,c]),u=yield l}catch(g){let e="fetch-client-network";throw"AbortError"===g.name&&(e="fetch-timeout"),rP.create(e,{originalErrorMessage:g.message})}let h=u.status;const d=u.headers.get("ETag")||void 0;let p,f;if(200===u.status){let e;try{e=yield u.json()}catch(m){throw rP.create("fetch-client-parse",{originalErrorMessage:m.message})}p=e.entries,f=e.state}if("INSTANCE_STATE_UNSPECIFIED"===f?h=500:"NO_CHANGE"===f?h=304:("NO_TEMPLATE"===f||"EMPTY_CONFIG"===f)&&(p={}),304!==h&&200!==h)throw rP.create("fetch-status",{httpStatus:h});return{status:h,eTag:d,config:p}})()}}class aP{constructor(e,t){this.client=e,this.storage=t}fetch(e){var t=this;return Pw(function*(){const n=(yield t.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return t.attemptFetch(e,n)})()}attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r=this;return Pw(function*(){yield function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(rP.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,t);try{const t=yield r.client.fetch(e);return yield r.storage.deleteThrottleMetadata(),t}catch(i){if(!function(e){if(!(e instanceof Jw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(i))throw i;const t={throttleEndTimeMillis:Date.now()+vS(n),backoffCount:n+1};return yield r.storage.setThrottleMetadata(t),r.attemptFetch(e,t)}})()}}class lP{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function cP(e,t){const n=e.target.error||void 0;return rP.create(t,{originalErrorMessage:n&&n.message})}const uP="app_namespace_store";class hP{constructor(e,t,n,r=function(){return new Promise((e,n)=>{try{const t=indexedDB.open("firebase_remote_config",1);t.onerror=e=>{n(cP(e,"storage-open"))},t.onsuccess=t=>{e(t.target.result)},t.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(uP,{keyPath:"compositeKey"})}}}catch(t){n(rP.create("storage-open",{originalErrorMessage:t}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(e){var t=this;return Pw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([uP],"readonly").objectStore(uP),o=t.createCompositeKey(e);try{const e=s.get(o);e.onerror=e=>{i(cP(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;r(t?t.value:void 0)}}catch(a){i(rP.create("storage-get",{originalErrorMessage:a&&a.message}))}})})()}set(e,t){var n=this;return Pw(function*(){const r=yield n.openDbPromise;return new Promise((i,s)=>{const o=r.transaction([uP],"readwrite").objectStore(uP),a=n.createCompositeKey(e);try{const e=o.put({compositeKey:a,value:t});e.onerror=e=>{s(cP(e,"storage-set"))},e.onsuccess=()=>{i()}}catch(l){s(rP.create("storage-set",{originalErrorMessage:l&&l.message}))}})})()}delete(e){var t=this;return Pw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([uP],"readwrite").objectStore(uP),o=t.createCompositeKey(e);try{const e=s.delete(o);e.onerror=e=>{i(cP(e,"storage-delete"))},e.onsuccess=()=>{r()}}catch(a){i(rP.create("storage-delete",{originalErrorMessage:a&&a.message}))}})})()}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class dP{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var e=this;return Pw(function*(){const t=e.storage.getLastFetchStatus(),n=e.storage.getLastSuccessfulFetchTimestampMillis(),r=e.storage.getActiveConfig(),i=yield t;i&&(e.lastFetchStatus=i);const s=yield n;s&&(e.lastSuccessfulFetchTimestampMillis=s);const o=yield r;o&&(e.activeConfig=o)})()}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function pP(){return fP.apply(this,arguments)}function fP(){return(fP=Pw(function*(){if(!Yw())return!1;try{return yield Kw()}catch{return!1}})).apply(this,arguments)}BS(new CS("remote-config",function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw rP.create("registration-window");if(!Yw())throw rP.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw rP.create("registration-project-id");if(!s)throw rP.create("registration-api-key");if(!o)throw rP.create("registration-app-id");const a=new hP(o,n.name,t=t||"firebase"),l=new dP(a),c=new AS(nP);c.logLevel=PS.ERROR;const u=new oP(r,HS,t,i,s,o),h=new aP(u,a),d=new iP(h,a,l,c),p=new lP(n,d,l,a,c);return function(e){const t=_S(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0}))}(p),p},"PUBLIC").setMultipleInstances(!0)),jS(nP,"0.3.4"),jS(nP,"0.3.4","esm2017");const gP="/firebase-messaging-sw.js",mP="/firebase-cloud-messaging-push-scope",yP="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",vP="google.c.a.c_id",_P="google.c.a.c_l",CP="google.c.a.ts",EP="google.c.a.e";var wP=(()=>(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(wP||(wP={})),wP))();function SP(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function bP(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}const PP="fcm_token_details_db",OP="fcm_token_object_Store";function TP(e){return IP.apply(this,arguments)}function IP(){return(IP=Pw(function*(e){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(PP))return null;let t=null;return(yield(0,ZS.openDb)(PP,5,function(){var n=Pw(function*(n){var r;if(n.oldVersion<2||!n.objectStoreNames.contains(OP))return;const i=n.transaction.objectStore(OP),s=yield i.index("fcmSenderId").get(e);if(yield i.clear(),s)if(2===n.oldVersion){const e=s;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:SP(e.vapidKey)}}}else if(3===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:SP(e.auth),p256dh:SP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:SP(e.vapidKey)}}}else if(4===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:SP(e.auth),p256dh:SP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:SP(e.vapidKey)}}}});return function(e){return n.apply(this,arguments)}}())).close(),yield(0,ZS.deleteDb)(PP),yield(0,ZS.deleteDb)("fcm_vapid_details_db"),yield(0,ZS.deleteDb)("undefined"),kP(t)?t:null})).apply(this,arguments)}function kP(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}const AP="firebase-messaging-store";let MP=null;function NP(){return MP||(MP=(0,ZS.openDb)("firebase-messaging-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(AP)}})),MP}function RP(e){return xP.apply(this,arguments)}function xP(){return(xP=Pw(function*(e){const t=BP(e),n=yield(yield NP()).transaction(AP).objectStore(AP).get(t);if(n)return n;{const t=yield TP(e.appConfig.senderId);if(t)return yield DP(e,t),t}})).apply(this,arguments)}function DP(e,t){return LP.apply(this,arguments)}function LP(){return(LP=Pw(function*(e,t){const n=BP(e),r=(yield NP()).transaction(AP,"readwrite");return yield r.objectStore(AP).put(t,n),yield r.complete,t})).apply(this,arguments)}function FP(e){return UP.apply(this,arguments)}function UP(){return(UP=Pw(function*(e){const t=BP(e),n=(yield NP()).transaction(AP,"readwrite");yield n.objectStore(AP).delete(t),yield n.complete})).apply(this,arguments)}function BP({appConfig:e}){return e.appId}const VP=new Xw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function $P(e,t){return zP.apply(this,arguments)}function zP(){return(zP=Pw(function*(e,t){const n=yield ZP(e),r=KP(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(jP(e.appConfig),i)).json()}catch(o){throw VP.create("token-subscribe-failed",{errorInfo:o})}if(s.error)throw VP.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw VP.create("token-subscribe-no-token");return s.token})).apply(this,arguments)}function HP(e,t){return GP.apply(this,arguments)}function GP(){return(GP=Pw(function*(e,t){const n=yield ZP(e),r=KP(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(`${jP(e.appConfig)}/${t.token}`,i)).json()}catch(o){throw VP.create("token-update-failed",{errorInfo:o})}if(s.error)throw VP.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw VP.create("token-update-no-token");return s.token})).apply(this,arguments)}function qP(e,t){return WP.apply(this,arguments)}function WP(){return(WP=Pw(function*(e,t){const n={method:"DELETE",headers:yield ZP(e)};try{const r=yield(yield fetch(`${jP(e.appConfig)}/${t}`,n)).json();if(r.error)throw VP.create("token-unsubscribe-failed",{errorInfo:r.error.message})}catch(r){throw VP.create("token-unsubscribe-failed",{errorInfo:r})}})).apply(this,arguments)}function jP({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function ZP(e){return YP.apply(this,arguments)}function YP(){return(YP=Pw(function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})).apply(this,arguments)}function KP({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==yP&&(i.web.applicationPubKey=r),i}function QP(e){return JP.apply(this,arguments)}function JP(){return(JP=Pw(function*(e){const t=yield sO(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:SP(t.getKey("auth")),p256dh:SP(t.getKey("p256dh"))},r=yield RP(e.firebaseDependencies);if(r){if(aO(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?tO(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{yield qP(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return rO(e.firebaseDependencies,n)}return rO(e.firebaseDependencies,n)})).apply(this,arguments)}function XP(e){return eO.apply(this,arguments)}function eO(){return(eO=Pw(function*(e){const t=yield RP(e.firebaseDependencies);t&&(yield qP(e.firebaseDependencies,t.token),yield FP(e.firebaseDependencies));const n=yield e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()})).apply(this,arguments)}function tO(e,t){return nO.apply(this,arguments)}function nO(){return(nO=Pw(function*(e,t){try{const n=yield HP(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield DP(e.firebaseDependencies,r),n}catch(n){throw yield XP(e),n}})).apply(this,arguments)}function rO(e,t){return iO.apply(this,arguments)}function iO(){return(iO=Pw(function*(e,t){const n={token:yield $P(e,t),createTime:Date.now(),subscriptionOptions:t};return yield DP(e,n),n.token})).apply(this,arguments)}function sO(e,t){return oO.apply(this,arguments)}function oO(){return(oO=Pw(function*(e,t){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:bP(t)})})).apply(this,arguments)}function aO(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function lO(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i)}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){if(!t.fcmOptions)return;e.fcmOptions={};const n=t.fcmOptions.link;n&&(e.fcmOptions.link=n);const r=t.fcmOptions.analytics_label;r&&(e.fcmOptions.analyticsLabel=r)}(t,e),t}function cO(e){return"object"==typeof e&&!!e&&vP in e}function uO(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function hO(e){return VP.create("missing-app-config-values",{valueName:e})}uO("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),uO("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class dO{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw hO("App Configuration Object");if(!e.name)throw hO("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw hO(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function pO(e){return fO.apply(this,arguments)}function fO(){return(fO=Pw(function*(e){try{e.swRegistration=yield navigator.serviceWorker.register(gP,{scope:mP}),e.swRegistration.update().catch(()=>{})}catch(t){throw VP.create("failed-service-worker-registration",{browserErrorMessage:t.message})}})).apply(this,arguments)}function gO(e,t){return mO.apply(this,arguments)}function mO(){return(mO=Pw(function*(e,t){if(!t&&!e.swRegistration&&(yield pO(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw VP.create("invalid-sw-registration");e.swRegistration=t}})).apply(this,arguments)}function yO(e,t){return vO.apply(this,arguments)}function vO(){return(vO=Pw(function*(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=yP)})).apply(this,arguments)}function _O(){return(_O=Pw(function*(e,t){if(!navigator)throw VP.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw VP.create("permission-blocked");return yield yO(e,null==t?void 0:t.vapidKey),yield gO(e,null==t?void 0:t.serviceWorkerRegistration),QP(e)})).apply(this,arguments)}function CO(e,t,n){return EO.apply(this,arguments)}function EO(){return(EO=Pw(function*(e,t,n){const r=wO(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[vP],message_name:n[_P],message_time:n[CP],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function wO(e){switch(e){case wP.NOTIFICATION_CLICKED:return"notification_open";case wP.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function SO(){return(SO=Pw(function*(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===wP.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(lO(n)):e.onMessageHandler.next(lO(n)));const r=n.data;cO(r)&&"1"===r[EP]&&(yield CO(e,n.messageType,r))})).apply(this,arguments)}const bO="@firebase/messaging";function PO(){return OO.apply(this,arguments)}function OO(){return(OO=Pw(function*(){try{yield Kw()}catch{return!1}return"undefined"!=typeof window&&Yw()&&Qw()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}BS(new CS("messaging",e=>{const t=new dO(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>function(e,t){return SO.apply(this,arguments)}(t,e)),t},"PUBLIC")),BS(new CS("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>function(e,t){return _O.apply(this,arguments)}(t,e)}},"PRIVATE")),jS(bO,"0.9.8"),jS(bO,"0.9.8","esm2017");const TO="analytics",IO="firebase_id",kO="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",AO="https://www.googletagmanager.com/gtag/js",MO=new AS("@firebase/analytics");function NO(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function RO(e,t){const n=document.createElement("script");n.src=`${AO}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function xO(e,t,n,r,i,s){return DO.apply(this,arguments)}function DO(){return(DO=Pw(function*(e,t,n,r,i,s){const o=r[i];try{if(o)yield t[o];else{const e=(yield NO(n)).find(e=>e.measurementId===i);e&&(yield t[e.appId])}}catch(a){MO.error(a)}e("config",i,s)})).apply(this,arguments)}function LO(e,t,n,r,i){return FO.apply(this,arguments)}function FO(){return(FO=Pw(function*(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=yield NO(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),yield Promise.all(s),e("event",r,i||{})}catch(s){MO.error(s)}})).apply(this,arguments)}function UO(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(AO))return t;return null}const BO=new Xw("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),VO=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function $O(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function zO(e){return HO.apply(this,arguments)}function HO(){return(HO=Pw(function*(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:$O(r)},s=kO.replace("{app-id}",n),o=yield fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=yield o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch{}throw BO.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()})).apply(this,arguments)}function GO(e){return qO.apply(this,arguments)}function qO(){return(qO=Pw(function*(e,t=VO,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw BO.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw BO.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new KO;return setTimeout(Pw(function*(){a.abort()}),void 0!==n?n:6e4),WO({appId:r,apiKey:i,measurementId:s},o,a,t)})).apply(this,arguments)}function WO(e,t,n){return jO.apply(this,arguments)}function jO(){return(jO=Pw(function*(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=VO){const{appId:s,measurementId:o}=e;try{yield ZO(r,t)}catch(a){if(o)return MO.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}try{const t=yield zO(e);return i.deleteThrottleMetadata(s),t}catch(a){if(!YO(a)){if(i.deleteThrottleMetadata(s),o)return MO.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}const t=503===Number(a.customData.httpStatus)?vS(n,i.intervalMillis,30):vS(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return i.setThrottleMetadata(s,l),MO.debug(`Calling attemptFetch again in ${t} millis`),WO(e,l,r,i)}})).apply(this,arguments)}function ZO(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(BO.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function YO(e){if(!(e instanceof Jw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class KO{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}function QO(){return JO.apply(this,arguments)}function JO(){return(JO=Pw(function*(){if(!Yw())return MO.warn(BO.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield Kw()}catch(e){return MO.warn(BO.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0})).apply(this,arguments)}function XO(){return(XO=Pw(function*(e,t,n,r,i,s,o){var a;const l=GO(e);l.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&MO.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>MO.error(e)),t.push(l);const c=QO().then(e=>{if(e)return r.getId()}),[u,h]=yield Promise.all([l,c]);UO()||RO(s,u.measurementId),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d[IO]=h),i("config",u.measurementId,d),u.measurementId})).apply(this,arguments)}class eT{constructor(e){this.app=e}_delete(){return delete tT[this.app.options.appId],Promise.resolve()}}let tT={},nT=[];const rT={};let iT,sT,oT="dataLayer",aT=!1;function lT(e,t,n){!function(){const e=[];if(Ww()&&e.push("This is a browser extension environment."),Qw()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=BO.create("invalid-analytics-context",{errorInfo:t});MO.warn(n.message)}}();const r=e.options.appId;if(!r)throw BO.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw BO.create("no-api-key");MO.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=tT[r])throw BO.create("already-exists",{id:r});if(!aT){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(oT);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){function i(){return(i=Pw(function*(i,s,o){try{"event"===i?yield LO(e,t,n,s,o):"config"===i?yield xO(e,t,n,r,s,o):e("set",s)}catch(a){MO.error(a)}})).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(tT,nT,rT,oT,"gtag");sT=e,iT=t,aT=!0}return tT[r]=function(e,t,n,r,i,s,o){return XO.apply(this,arguments)}(e,nT,rT,t,iT,oT,n),new eT(e)}function cT(){return(cT=Pw(function*(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=yield t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}})).apply(this,arguments)}function uT(){return hT.apply(this,arguments)}function hT(){return(hT=Pw(function*(){if(Ww()||!Qw()||!Yw())return!1;try{return yield Kw()}catch{return!1}})).apply(this,arguments)}const dT="@firebase/analytics";BS(new CS(TO,(e,{options:t})=>lT(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),BS(new CS("analytics-internal",function(e){try{const t=e.getProvider(TO).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=_S(e),function(e,t,n,r,i){return cT.apply(this,arguments)}(sT,tT[e.app.options.appId],t,n,r).catch(e=>MO.error(e))}(t,e,n,r)}}catch(t){throw BO.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),jS(dT,"0.7.5"),jS(dT,"0.7.5","esm2017");class pT extends a{constructor(e,t){super()}schedule(e,t=0){return this}}const fT={setInterval(...e){const{delegate:t}=fT;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=fT;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0};class gT extends pT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return fT.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;fT.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,o(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const mT={now:()=>(mT.delegate||Date).now(),delegate:void 0};class yT{constructor(e,t=yT.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}yT.now=mT.now;class vT extends yT{constructor(e,t=yT.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}const _T=new class extends vT{}(class extends gT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!=n&&n>0||null==n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}),CT=new vT(gT),ET=new kc("7.2.0"),wT="__angularfire_symbol__analyticsIsSupported",ST="__angularfire_symbol__remoteConfigIsSupported",bT="__angularfire_symbol__messagingIsSupported";function PT(e,t,n){if(t){if(1===t.length)return t[0];const e=t.filter(e=>e.app===n);if(1===e.length)return e[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[wT]||(globalThis[wT]=uT().then(e=>globalThis.__angularfire_symbol__analyticsIsSupportedValue=e)),globalThis[bT]||(globalThis[bT]=PO().then(e=>globalThis.__angularfire_symbol__messagingIsSupportedValue=e)),globalThis[ST]||(globalThis[ST]=pP().then(e=>globalThis.__angularfire_symbol__remoteConfigIsSupportedValue=e));const OT=(e,t)=>{const n=t?[t]:WS(),r=[];return n.forEach(t=>{t.container.getProvider(e).instances.forEach(e=>{r.includes(e)||r.push(e)})}),r};function TT(){}class IT{constructor(e,t=_T){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class kT{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",TT,{},TT,TT)),t.pipe(Fm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let AT=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new IT(Zone.current)),this.insideAngular=e.run(()=>new IT(Zone.current,CT)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(Or(vh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function MT(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function NT(e){return MT().ngZone.runOutsideAngular(()=>e())}function RT(e){return MT().ngZone.run(()=>e())}function xT(e){return MT(),function(e){return function(t){return(t=t.lift(new kT(e.ngZone))).pipe(se(e.outsideAngular),ie(e.insideAngular))}}(MT())(e)}const DT=(e,t)=>{const n=void 0;return function(){return t&&setTimeout(()=>{"scheduled"===t.state&&t.invoke()},10),RT(()=>e.apply(n,arguments))}},LT=(e,t)=>function(){let n;for(let e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&(t&&(n||(n=RT(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",TT,{},TT,TT)))),arguments[e]=DT(arguments[e],n));const r=NT(()=>e.apply(this,arguments));if(!t){if(r instanceof T){const e=MT();return r.pipe(se(e.outsideAngular),ie(e.insideAngular))}return RT(()=>r)}return r instanceof T?r.pipe(xT):r instanceof Promise?RT(()=>new Promise((e,t)=>r.then(t=>RT(()=>e(t)),e=>RT(()=>t(e))))):"function"==typeof r&&n?function(){return setTimeout(()=>{n&&"scheduled"===n.state&&n.invoke()},10),r.apply(this,arguments)}:RT(()=>r)};class FT{constructor(e){return e}}class UT{constructor(){return WS()}}const BT=new or("angularfire2._apps"),VT={provide:FT,useFactory:function(e){return e&&1===e.length?e[0]:new FT(qS())},deps:[[new Nr,BT]]},$T={provide:UT,deps:[[new Nr,BT]]};function zT(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new FT(r)}}let HT=(()=>{class e{constructor(e){jS("angularfire",ET.full,"core"),jS("angularfire",ET.full,"app"),jS("angular",Ac.full,e.toString())}}return e.\u0275fac=function(t){return new(t||e)(Or(rh))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[VT,$T]}),e})();const GT=LT(GS,!0),qT=new Map,WT={activated:!1,tokenObservers:[]},jT={initialized:!1,enabled:!1};function ZT(e){return qT.get(e)||WT}function YT(e,t){qT.set(e,t)}function KT(){return jT}class QT{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return Pw(function*(){t.stop();try{t.pending=new zw,yield function(e){return new Promise(t=>{setTimeout(t,e)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new zw,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(n){t.retryPolicy(n)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const JT=new Xw("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function XT(e){if(!ZT(e).activated)throw JT.create("use-before-activation",{appName:e.name})}function eI(e,t){return tI.apply(this,arguments)}function tI(){return(tI=Pw(function*({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=yield fetch(e,s)}catch(h){throw JT.create("fetch-network-error",{originalErrorMessage:h.message})}if(200!==o.status)throw JT.create("fetch-status-error",{httpStatus:o.status});try{a=yield o.json()}catch(h){throw JT.create("fetch-parse-error",{originalErrorMessage:h.message})}const l=a.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw JT.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const c=1e3*Number(l[1]),u=Date.now();return{token:a.attestationToken,expireTimeMillis:u+c,issuedAtTimeMillis:u}})).apply(this,arguments)}function nI(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}const rI="firebase-app-check-store";let iI=null;function sI(){return iI||(iI=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(JT.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(rI,{keyPath:"compositeKey"})}}}catch(n){t(JT.create("storage-open",{originalErrorMessage:n.message}))}}),iI)}function oI(){return(oI=Pw(function*(e,t){const n=(yield sI()).transaction(rI,"readwrite"),r=n.objectStore(rI).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(JT.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})})).apply(this,arguments)}const aI=new AS("@firebase/app-check");function lI(e,t){return Yw()?function(e,t){return function(e,t){return oI.apply(this,arguments)}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{aI.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function cI(){return KT().enabled}function uI(){return hI.apply(this,arguments)}function hI(){return(hI=Pw(function*(){const e=KT();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const dI={error:"UNKNOWN_ERROR"};function pI(e){return Dw.encodeString(JSON.stringify(e),!1)}function fI(e){return gI.apply(this,arguments)}function gI(){return(gI=Pw(function*(e,t=!1){const n=e.app;XT(n);const r=ZT(n);let i,s=r.token;if(!s){const e=yield r.cachedTokenPromise;e&&_I(e)&&(s=e)}if(!t&&s&&_I(s))return{token:s.token};let o,a=!1;if(cI()){r.exchangeTokenPromise||(r.exchangeTokenPromise=eI(nI(n,yield uI()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=yield r.exchangeTokenPromise;return yield lI(n,t),YT(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=yield r.exchangeTokenPromise}catch(l){"appCheck/throttled"===l.code?aI.warn(l.message):aI.error(l),i=l}return s?(o={token:s.token},YT(n,Object.assign(Object.assign({},r),{token:s})),yield lI(n,s)):o=CI(i),a&&vI(n,o),o})).apply(this,arguments)}function mI(e,t){const n=ZT(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),YT(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function yI(e){const{app:t}=e,n=ZT(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new QT(Pw(function*(){let n;if(n=ZT(t).token?yield fI(e,!0):yield fI(e),n.error)throw n.error}),()=>!0,()=>{const e=ZT(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),YT(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function vI(e,t){const n=ZT(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch{}}function _I(e){return e.expireTimeMillis-Date.now()>0}function CI(e){return{token:pI(dI),error:e}}class EI{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=ZT(this.app);for(const t of e)mI(this.app,t.next);return Promise.resolve()}}const wI="app-check-internal";BS(new CS("app-check",e=>function(e,t){return new EI(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("platform-logger")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(wI).initialize()})),BS(new CS(wI,e=>function(e){return{getToken:t=>fI(e,t),addTokenListener:t=>function(e,t,n,r){const{app:i}=e,s=ZT(i),o={next:n,error:r,type:t};if(YT(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&_I(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),yI(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>yI(e))}(e,"INTERNAL",t),removeTokenListener:t=>mI(e.app,t)}}(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),jS("@firebase/app-check","0.5.3");class SI{constructor(){return OT("app-check")}}"undefined"!=typeof window&&window;const bI=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},PI=new Xw("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),OI=new AS("@firebase/auth");function TI(e,...t){OI.logLevel<=PS.ERROR&&OI.error(`Auth (9.6.6): ${e}`,...t)}function II(e,...t){throw NI(e,...t)}function kI(e,...t){return NI(e,...t)}function AI(e,t,n){const r=Object.assign(Object.assign({},bI()),{[t]:n});return new Xw("auth","Firebase",r).create(t,{appName:e.name})}function MI(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&II(e,"argument-error"),AI(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function NI(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return PI.create(e,...t)}function RI(e,t,...n){if(!e)throw NI(t,...n)}function xI(e){const t="INTERNAL ASSERTION FAILED: "+e;throw TI(t),new Error(t)}function DI(e,t){e||xI(t)}const LI=new Map;function FI(e){DI(e instanceof Function,"Expected a class definition");let t=LI.get(e);return t?(DI(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,LI.set(e,t),t)}function UI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function BI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class VI{constructor(e,t){this.shortDelay=e,this.longDelay=t,DI(t>e,"Short delay should be less than long delay!"),this.isMobile=qw()||jw()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===BI()||"https:"===BI()||Ww()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function $I(e,t){DI(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class zI{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void xI("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void xI("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void xI("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const HI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},GI=new VI(3e4,6e4);function qI(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function WI(e,t,n,r){return jI.apply(this,arguments)}function jI(){return(jI=Pw(function*(e,t,n,r,i={}){return ZI(e,i,Pw(function*(){let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=uS(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),zI.fetch()(JI(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))})).apply(this,arguments)}function ZI(e,t,n){return YI.apply(this,arguments)}function YI(){return(YI=Pw(function*(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},HI),t);try{const t=new XI(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw ek(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ek(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ek(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw AI(e,a,o);II(e,a)}}catch(i){if(i instanceof Jw)throw i;II(e,"network-request-failed")}})).apply(this,arguments)}function KI(e,t,n,r){return QI.apply(this,arguments)}function QI(){return(QI=Pw(function*(e,t,n,r,i={}){const s=yield WI(e,t,n,r,i);return"mfaPendingCredential"in s&&II(e,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function JI(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?$I(e.config,i):`${e.config.apiScheme}://${i}`}class XI{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(kI(this.auth,"network-request-failed")),GI.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ek(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=kI(e,t,r);return i.customData._tokenResponse=n,i}function tk(){return(tk=Pw(function*(e,t){return WI(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function nk(e,t){return rk.apply(this,arguments)}function rk(){return(rk=Pw(function*(e,t){return WI(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function ik(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function sk(){return(sk=Pw(function*(e,t=!1){const n=_S(e),r=yield n.getIdToken(t),i=ak(r);RI(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ik(ok(i.auth_time)),issuedAtTime:ik(ok(i.iat)),expirationTime:ik(ok(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function ok(e){return 1e3*Number(e)}function ak(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return TI("JWT malformed, contained fewer than 3 sections"),null;try{const e=Uw(n);return e?JSON.parse(e):(TI("Failed to decode base64 JWT payload"),null)}catch(i){return TI("Caught error parsing JWT payload as JSON",i),null}}function lk(e,t){return ck.apply(this,arguments)}function ck(){return(ck=Pw(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(r){throw r instanceof Jw&&uk(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})).apply(this,arguments)}function uk({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class hk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(Pw(function*(){yield t.iteration()}),n)}iteration(){var e=this;return Pw(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&e.schedule(!0))}e.schedule()})()}}class dk{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ik(this.lastLoginAt),this.creationTime=ik(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function pk(e){return fk.apply(this,arguments)}function fk(){return(fk=Pw(function*(e){var t;const n=e.auth,r=yield e.getIdToken(),i=yield lk(e,nk(n,{idToken:r}));RI(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?yk(s.providerUserInfo):[],a=mk(e.providerData,o),l=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new dk(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,c)})).apply(this,arguments)}function gk(){return(gk=Pw(function*(e){const t=_S(e);yield pk(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function mk(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function yk(e){return e.map(e=>{var{providerId:t}=e,n=L(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function vk(){return(vk=Pw(function*(e,t){const n=yield ZI(e,{},Pw(function*(){const n=uS({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=JI(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",zI.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class _k{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){RI(e.idToken,"internal-error"),RI(void 0!==e.idToken,"internal-error"),RI(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=ak(e);return RI(t,"internal-error"),RI(void 0!==t.exp,"internal-error"),RI(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return Pw(function*(){return RI(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return Pw(function*(){const{accessToken:r,refreshToken:i,expiresIn:s}=yield function(e,t){return vk.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(r,i,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new _k;return n&&(RI("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(RI("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(RI("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _k,this.toJSON())}_performRefresh(){return xI("not implemented")}}function Ck(e,t){RI("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ek{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=L(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new hk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new dk(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){var t=this;return Pw(function*(){const n=yield lk(t,t.stsTokenManager.getToken(t.auth,e));return RI(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return sk.apply(this,arguments)}(this,e)}reload(){return function(e){return gk.apply(this,arguments)}(this)}_assign(e){this!==e&&(RI(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Ek(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){RI(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return Pw(function*(){let r=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield pk(n)),yield n.auth._persistUserIfCurrent(n),r&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return Pw(function*(){const t=yield e.getIdToken();return yield lk(e,function(e,t){return tk.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:_,isAnonymous:C,providerData:E,stsTokenManager:w}=t;RI(v&&w,e,"internal-error");const S=_k.fromJSON(this.name,w);RI("string"==typeof v,e,"internal-error"),Ck(u,e.name),Ck(h,e.name),RI("boolean"==typeof _,e,"internal-error"),RI("boolean"==typeof C,e,"internal-error"),Ck(d,e.name),Ck(p,e.name),Ck(f,e.name),Ck(g,e.name),Ck(m,e.name),Ck(y,e.name);const b=new Ek({uid:v,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:C,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:S,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(b.providerData=E.map(e=>Object.assign({},e))),g&&(b._redirectEventId=g),b}static _fromIdTokenResponse(e,t,n=!1){return Pw(function*(){const r=new _k;r.updateFromServerResponse(t);const i=new Ek({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield pk(i),i})()}}const wk=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return Pw(function*(){return!0})()}_set(e,t){var n=this;return Pw(function*(){n.storage[e]=t})()}_get(e){var t=this;return Pw(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return Pw(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function Sk(e,t,n){return`firebase:${e}:${t}:${n}`}class bk{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Sk(this.userKey,r.apiKey,i),this.fullPersistenceKey=Sk("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return Pw(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?Ek._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return Pw(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return Pw(function*(){if(!t.length)return new bk(FI(wk),e,n);const r=(yield Promise.all(t.map(function(){var e=Pw(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let i=r[0]||FI(wk);const s=Sk(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){const r=Ek._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&(yield i._set(s,o.toJSON())),yield Promise.all(t.map(function(){var e=Pw(function*(e){if(e!==i)try{yield e._remove(s)}catch{}});return function(t){return e.apply(this,arguments)}}())),new bk(i,e,n)):new bk(i,e,n)})()}}function Pk(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(kk(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ok(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Mk(t))return"Blackberry";if(Nk(t))return"Webos";if(Tk(t))return"Safari";if((t.includes("chrome/")||Ik(t))&&!t.includes("edge/"))return"Chrome";if(Ak(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function Ok(e=Gw()){return/firefox\//i.test(e)}function Tk(e=Gw()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ik(e=Gw()){return/crios\//i.test(e)}function kk(e=Gw()){return/iemobile/i.test(e)}function Ak(e=Gw()){return/android/i.test(e)}function Mk(e=Gw()){return/blackberry/i.test(e)}function Nk(e=Gw()){return/webos/i.test(e)}function Rk(e=Gw()){return/iphone|ipad|ipod/i.test(e)}function xk(e=Gw()){return Rk(e)||Ak(e)||Nk(e)||Mk(e)||/windows phone/i.test(e)||kk(e)}function Dk(e,t=[]){let n;switch(e){case"Browser":n=Pk(Gw());break;case"Worker":n=`${Pk(Gw())}-${e}`;break;default:n=e}return`${n}/JsCore/9.6.6/${t.length?t.join(","):"FirebaseCore-web"}`}class Lk{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Uk(this),this.idTokenSubscription=new Uk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=PI,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=FI(t)),this._initializationPromise=this.queue(Pw(function*(){var r,i;if(!n._deleted&&(n.persistenceManager=yield bk.create(n,e),!n._deleted)){if(null===(r=n._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(i=n.currentUser)||void 0===i?void 0:i.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return Pw(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t)}})()}initializeCurrentUser(e){var t=this;return Pw(function*(){var n;let r=yield t.assertedPersistence.getCurrentUser();if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const i=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null==r?void 0:r._redirectEventId,o=yield t.tryRedirectSignIn(e);(!i||i===s)&&(null==o?void 0:o.user)&&(r=o.user)}return r?r._redirectEventId?(RI(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===r._redirectEventId?t.directlySetCurrentUser(r):t.reloadAndSetCurrentUserOrClear(r)):t.reloadAndSetCurrentUserOrClear(r):t.directlySetCurrentUser(null)})()}tryRedirectSignIn(e){var t=this;return Pw(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return Pw(function*(){try{yield pk(e)}catch(n){if("auth/network-request-failed"!==n.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return Pw(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return Pw(function*(){const n=e?_S(e):null;return n&&RI(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e){var t=this;return Pw(function*(){if(!t._deleted)return e&&RI(t.tenantId===e.tenantId,t,"tenant-id-mismatch"),t.queue(Pw(function*(){yield t.directlySetCurrentUser(e),t.notifyAuthListeners()}))})()}signOut(){var e=this;return Pw(function*(){return(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null)})()}setPersistence(e){var t=this;return this.queue(Pw(function*(){yield t.assertedPersistence.setPersistence(FI(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Xw("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return Pw(function*(){const r=yield n.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return Pw(function*(){if(!t.redirectPersistenceManager){const n=e&&FI(e)||t._popupRedirectResolver;RI(n,t,"argument-error"),t.redirectPersistenceManager=yield bk.create(t,[FI(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return Pw(function*(){var n,r;return t._isInitialized&&(yield t.queue(Pw(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return Pw(function*(){if(e===t.currentUser)return t.queue(Pw(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return RI(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return Pw(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return RI(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Dk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return Pw(function*(){const t={"X-Client-Version":e.clientVersion};return e.app.options.appId&&(t["X-Firebase-gmpid"]=e.app.options.appId),t})()}}function Fk(e){return _S(e)}class Uk{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new fS(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return RI(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Bk(e,t,n){const r=Fk(e);RI(r._canInitEmulator,r,"emulator-config-failed"),RI(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Vk(t),{host:o,port:a}=function(e){const t=Vk(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:$k(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:$k(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Vk(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $k(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class zk{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xI("not implemented")}_getIdTokenResponse(e){return xI("not implemented")}_linkToIdToken(e,t){return xI("not implemented")}_getReauthenticationResolver(e){return xI("not implemented")}}function Hk(){return(Hk=Pw(function*(e,t){return WI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Gk(){return(Gk=Pw(function*(e,t){return KI(e,"POST","/v1/accounts:signInWithPassword",qI(e,t))})).apply(this,arguments)}function qk(e,t){return Wk.apply(this,arguments)}function Wk(){return(Wk=Pw(function*(e,t){return WI(e,"POST","/v1/accounts:sendOobCode",qI(e,t))})).apply(this,arguments)}function jk(e,t){return Zk.apply(this,arguments)}function Zk(){return(Zk=Pw(function*(e,t){return qk(e,t)})).apply(this,arguments)}function Yk(e,t){return Kk.apply(this,arguments)}function Kk(){return(Kk=Pw(function*(e,t){return qk(e,t)})).apply(this,arguments)}function Qk(){return(Qk=Pw(function*(e,t){return KI(e,"POST","/v1/accounts:signInWithEmailLink",qI(e,t))})).apply(this,arguments)}function Jk(){return(Jk=Pw(function*(e,t){return KI(e,"POST","/v1/accounts:signInWithEmailLink",qI(e,t))})).apply(this,arguments)}class Xk extends zk{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Xk(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Xk(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return Pw(function*(){switch(t.signInMethod){case"password":return function(e,t){return Gk.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return Qk.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:II(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return Pw(function*(){switch(n.signInMethod){case"password":return function(e,t){return Hk.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return Jk.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:II(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function eA(e,t){return tA.apply(this,arguments)}function tA(){return(tA=Pw(function*(e,t){return KI(e,"POST","/v1/accounts:signInWithIdp",qI(e,t))})).apply(this,arguments)}class nA extends zk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new nA(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):II("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=L(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new nA(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return eA(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,eA(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,eA(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=uS(t)}return e}}class rA{constructor(e){var t,n,r,i,s,o;const a=hS(dS(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);RI(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=hS(dS(e)).link,n=t?hS(dS(t)).deep_link_id:null,r=hS(dS(e)).deep_link_id;return(r?hS(dS(r)).link:null)||r||n||t||e}(e);try{return new rA(t)}catch{return null}}}let iA=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Xk._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=rA.parseLink(t);return RI(n,"argument-error"),Xk._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class sA{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class oA extends sA{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let aA=(()=>{class e extends oA{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return nA._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})();function lA(e,t){return cA.apply(this,arguments)}function cA(){return(cA=Pw(function*(e,t){return KI(e,"POST","/v1/accounts:signUp",qI(e,t))})).apply(this,arguments)}class uA{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return Pw(function*(){const i=yield Ek._fromIdTokenResponse(e,n,r),s=hA(n);return new uA({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return Pw(function*(){yield e._updateTokensIfNecessary(n,!0);const r=hA(n);return new uA({user:e,providerId:r,_tokenResponse:n,operationType:t})})()}}function hA(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class dA extends Jw{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,dA.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new dA(e,t,n,r)}}function pA(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw"auth/multi-factor-auth-required"===n.code?dA._fromErrorAndOperation(e,n,t,r):n})}function fA(e,t){return gA.apply(this,arguments)}function gA(){return(gA=Pw(function*(e,t,n=!1){const r=yield lk(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return uA._forOperation(e,"link",r)})).apply(this,arguments)}function mA(){return(mA=Pw(function*(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=yield lk(e,pA(r,i,t,e),n);RI(s.idToken,r,"internal-error");const o=ak(s.idToken);RI(o,r,"internal-error");const{sub:a}=o;return RI(e.uid===a,r,"user-mismatch"),uA._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&II(r,"user-mismatch"),s}})).apply(this,arguments)}function yA(e,t){return vA.apply(this,arguments)}function vA(){return(vA=Pw(function*(e,t,n=!1){const r="signIn",i=yield pA(e,r,t),s=yield uA._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function _A(){return(_A=Pw(function*(e,t){return yA(Fk(e),t)})).apply(this,arguments)}function CA(e,t,n){var r;RI((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),RI(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(RI(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(RI(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function EA(e,t,n){return wA.apply(this,arguments)}function wA(){return(wA=Pw(function*(e,t,n){const r=_S(e),i={requestType:"PASSWORD_RESET",email:t};n&&CA(r,i,n),yield Yk(r,i)})).apply(this,arguments)}function SA(e,t,n){return bA.apply(this,arguments)}function bA(){return(bA=Pw(function*(e,t,n){const r=Fk(e),i=yield lA(r,{returnSecureToken:!0,email:t,password:n}),s=yield uA._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(s.user),s})).apply(this,arguments)}function PA(e,t,n){return function(e,t){return _A.apply(this,arguments)}(_S(e),iA.credential(t,n))}function OA(e,t){return TA.apply(this,arguments)}function TA(){return(TA=Pw(function*(e,t){const n=_S(e),r={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&CA(n.auth,r,t);const{email:i}=yield jk(n.auth,r);i!==e.email&&(yield e.reload())})).apply(this,arguments)}function IA(e,t){return kA.apply(this,arguments)}function kA(){return(kA=Pw(function*(e,t){return WI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function AA(e,t){return MA.apply(this,arguments)}function MA(){return(MA=Pw(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=_S(e),i={idToken:yield r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield lk(r,IA(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),yield r._updateTokensIfNecessary(s)})).apply(this,arguments)}function NA(e,t,n,r){return _S(e).onAuthStateChanged(t,n,r)}new WeakMap;const RA="__sak";class xA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(RA,"1"),this.storage.removeItem(RA),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const DA=(()=>{class e extends xA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Gw();return Tk(e)||Rk(e)}()&&function(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=xk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Zw()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return Pw(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return Pw(function*(){const r=yield t().call(n,e);return n.localCache[e]=JSON.stringify(r),r})()}_remove(e){var t=()=>super._remove,n=this;return Pw(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),LA=(()=>{class e extends xA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let FA=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return Pw(function*(){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=t.handlersMap[i];if(!(null==o?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(function(){var e=Pw(function*(e){return e(n.origin,s)});return function(t){return e.apply(this,arguments)}}()),l=yield function(e){return Promise.all(e.map(function(){var e=Pw(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function UA(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class BA{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return Pw(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=UA("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function VA(){return window}function $A(){return void 0!==VA().WorkerGlobalScope&&"function"==typeof VA().importScripts}function zA(){return(zA=Pw(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const HA="firebaseLocalStorageDb",GA="firebaseLocalStorage",qA="fbase_key";class WA{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function jA(e,t){return e.transaction([GA],t?"readwrite":"readonly").objectStore(GA)}function ZA(){const e=indexedDB.open(HA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(GA,{keyPath:qA})}catch(r){n(r)}}),e.addEventListener("success",Pw(function*(){const n=e.result;n.objectStoreNames.contains(GA)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(HA);return new WA(e).toPromise()}(),t(yield ZA()))}))})}function YA(e,t,n){return KA.apply(this,arguments)}function KA(){return(KA=Pw(function*(e,t,n){const r=jA(e,!0).put({[qA]:t,value:n});return new WA(r).toPromise()})).apply(this,arguments)}function QA(){return(QA=Pw(function*(e,t){const n=jA(e,!1).get(t),r=yield new WA(n).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function JA(e,t){const n=jA(e,!0).delete(t);return new WA(n).toPromise()}const XA=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return Pw(function*(){return e.db||(e.db=yield ZA()),e.db})()}_withRetries(e){var t=this;return Pw(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(r){if(n++>3)throw r;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return Pw(function*(){return $A()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return Pw(function*(){e.receiver=FA._getInstance($A()?self:null),e.receiver._subscribe("keyChanged",function(){var t=Pw(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=Pw(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return Pw(function*(){var t,n;if(e.activeServiceWorker=yield function(){return zA.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new BA(e.activeServiceWorker);const r=yield e.sender._send("ping",{},800);!r||(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return Pw(function*(){if(t.sender&&t.activeServiceWorker&&function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return Pw(function*(){try{if(!indexedDB)return!1;const e=yield ZA();return yield YA(e,RA,"1"),yield JA(e,RA),!0}catch{}return!1})()}_withPendingWrite(e){var t=this;return Pw(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return Pw(function*(){return n._withPendingWrite(Pw(function*(){return yield n._withRetries(n=>YA(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return Pw(function*(){const n=yield t._withRetries(t=>function(e,t){return QA.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return Pw(function*(){return t._withPendingWrite(Pw(function*(){return yield t._withRetries(t=>JA(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return Pw(function*(){const t=yield e._withRetries(e=>{const t=jA(e,!1).getAll();return new WA(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of t)r.add(i),JSON.stringify(e.localCache[i])!==JSON.stringify(s)&&(e.notifyListeners(i,s),n.push(i));for(const i of Object.keys(e.localCache))e.localCache[i]&&!r.has(i)&&(e.notifyListeners(i,null),n.push(i));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval(Pw(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function eM(e){return`__${e}${Math.floor(1e6*Math.random())}`}function tM(e,t){return t?FI(t):(RI(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}eM("rcb"),new VI(3e4,6e4);class nM extends zk{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eA(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eA(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eA(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rM(e){return yA(e.auth,new nM(e),e.bypassAuthState)}function iM(e){const{auth:t,user:n}=e;return RI(n,t,"internal-error"),function(e,t){return mA.apply(this,arguments)}(n,new nM(e),e.bypassAuthState)}function sM(e){return oM.apply(this,arguments)}function oM(){return(oM=Pw(function*(e){const{auth:t,user:n}=e;return RI(n,t,"internal-error"),fA(n,new nM(e),e.bypassAuthState)})).apply(this,arguments)}class aM{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=Pw(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(r){e.reject(r)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return Pw(function*(){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const l={auth:t.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(l))}catch(c){t.reject(c)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rM;case"linkViaPopup":case"linkViaRedirect":return sM;case"reauthViaPopup":case"reauthViaRedirect":return iM;default:II(this.auth,"internal-error")}}resolve(e){DI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){DI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const lM=new VI(2e3,1e4);function cM(e,t,n){return uM.apply(this,arguments)}function uM(){return(uM=Pw(function*(e,t,n){const r=Fk(e);MI(e,t,sA);const i=tM(r,n);return new hM(r,"signInViaPopup",t,i).executeNotNull()})).apply(this,arguments)}let hM=(()=>{class e extends aM{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return Pw(function*(){const t=yield e.execute();return RI(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return Pw(function*(){DI(1===e.filter.length,"Popup operations only handle one event");const t=UA();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(kI(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(kI(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(kI(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,lM.get())};e()}}return e.currentPopupAction=null,e})();const dM=new Map;class pM extends aM{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return Pw(function*(){let n=dM.get(t.auth._key());if(!n){try{const r=(yield function(e,t){return fM.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(r)}catch(r){n=()=>Promise.reject(r)}dM.set(t.auth._key(),n)}return t.bypassAuthState||dM.set(t.auth._key(),()=>Promise.resolve(null)),n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return Pw(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const r=yield n.auth._redirectUserForId(e.eventId);if(r)return n.user=r,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return Pw(function*(){})()}cleanUp(){}}function fM(){return(fM=Pw(function*(e,t){const n=mM(t),r=gM(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})).apply(this,arguments)}function gM(e){return FI(e._redirectPersistence)}function mM(e){return Sk("pendingRedirect",e.config.apiKey,e.name)}function yM(e,t){return vM.apply(this,arguments)}function vM(){return(vM=Pw(function*(e,t,n=!1){const r=Fk(e),i=tM(r,t),s=yield new pM(r,i,n).execute();return s&&!n&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})).apply(this,arguments)}class _M{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return EM(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!EM(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(kI(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(CM(e))}saveEventToCache(e){this.cachedEventUids.add(CM(e)),this.lastProcessedEventTime=Date.now()}}function CM(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function EM({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function wM(e){return SM.apply(this,arguments)}function SM(){return(SM=Pw(function*(e,t={}){return WI(e,"GET","/v1/projects",t)})).apply(this,arguments)}const bM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,PM=/^https?/;function OM(){return(OM=Pw(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield wM(e);for(const n of t)try{if(TM(n))return}catch{}II(e,"unauthorized-domain")})).apply(this,arguments)}function TM(e){const t=UI(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!PM.test(n))return!1;if(bM.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const IM=new VI(3e4,6e4);function kM(){const e=VA().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let AM=null;function MM(e){return AM=AM||function(e){return new Promise((t,n)=>{var r,i,s;function o(){kM(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{kM(),n(kI(e,"network-request-failed"))},timeout:IM.get()})}if(null===(i=null===(r=VA().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=VA().gapi)||void 0===s?void 0:s.load)){const t=eM("iframefcb");return VA()[t]=()=>{gapi.load?o():n(kI(e,"network-request-failed"))},function(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=kI("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw AM=null,e})}(e),AM}const NM=new VI(5e3,15e3),RM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},xM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function DM(e){const t=e.config;RI(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?$I(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:HS},i=xM.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${uS(r).slice(1)}`}function LM(){return(LM=Pw(function*(e){const t=yield MM(e),n=VA().gapi;return RI(n,e,"internal-error"),t.open({where:document.body,url:DM(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:RM,dontclear:!0},t=>new Promise(function(){var n=Pw(function*(n,r){yield t.restyle({setHideOnLeave:!1});const i=kI(e,"network-request-failed"),s=VA().setTimeout(()=>{r(i)},NM.get());function o(){VA().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const FM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class UM{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function BM(e,t,n,r,i,s){RI(e.config.authDomain,e,"auth-domain-config-required"),RI(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:HS,eventId:i};if(t instanceof sA){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",oS(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof oA){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];return`${function({config:e}){return e.emulator?$I(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${uS(a).slice(1)}`}const VM="webStorageSupport",$M=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=LA,this._completeRedirectFn=yM}_openPopup(e,t,n,r){var i=this;return Pw(function*(){var s;DI(null===(s=i.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");const o=BM(e,t,n,UI(),r);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},FM),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Gw().toLowerCase();n&&(a=Ik(c)?"_blank":n),Ok(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=Gw()){var t;return Rk(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new UM(null);const h=window.open(t||"",a,u);RI(h,e,"popup-blocked");try{h.focus()}catch{}return new UM(h)}(e,o,UA())})()}_openRedirect(e,t,n,r){var i=this;return Pw(function*(){return yield i._originValidation(e),function(e){VA().location.href=e}(BM(e,t,n,UI(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(DI(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){var t=this;return Pw(function*(){const n=yield function(e){return LM.apply(this,arguments)}(e),r=new _M(e);return n.register("authEvent",t=>(RI(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=n,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(VM,{type:VM},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[VM];void 0!==i&&t(!!i),II(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return OM.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xk()||Tk()||Rk()}};var zM="@firebase/auth";class HM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return Pw(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){RI(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function GM(e=qS()){const t=VS(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=VS(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(lS(n.getOptions(),t??{}))return e;II(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:$M,persistence:[XA,DA,LA]})}!function(e){BS(new CS("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),{apiKey:i,authDomain:s}=r.options;return(t=>{RI(i&&!i.includes(":"),"invalid-api-key",{appName:t.name}),RI(!(null==s?void 0:s.includes(":")),"argument-error",{appName:t.name});const r={apiKey:i,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Dk(e)},o=new Lk(t,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(FI);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,n),o})(r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),BS(new CS("auth-internal",e=>{const t=Fk(e.getProvider("auth").getImmediate());return new HM(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),jS(zM,"0.19.8",void 0),jS(zM,"0.19.8","esm2017")}("Browser");class qM{constructor(e){return e}}class WM{constructor(){return OT("auth")}}const jM=new or("angularfire2.auth-instances");function ZM(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new qM(r)}}const YM={provide:WM,deps:[[new Nr,jM]]},KM={provide:qM,useFactory:function(e,t){const n=PT("auth",e,t);return n&&new qM(n)},deps:[[new Nr,jM],FT]};let QM=(()=>{class e{constructor(){jS("angularfire",ET.full,"auth")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[KM,YM]}),e})();const JM=LT(Bk,!0),XM=LT(SA,!0),eN=LT(GM,!0),tN=LT(NA,!0),nN=LT(OA,!0),rN=LT(EA,!0),iN=LT(PA,!0),sN=LT(cM,!0),oN=LT(AA,!0);var aN,lN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},cN={},uN=uN||{},hN=lN||self;function dN(){}function pN(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function fN(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var gN="closure_uid_"+(1e9*Math.random()>>>0),mN=0;function yN(e,t,n){return e.call.apply(e.bind,arguments)}function vN(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function _N(e,t,n){return(_N=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?yN:vN).apply(null,arguments)}function CN(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function EN(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function wN(){this.s=this.s,this.o=this.o}var SN={};wN.prototype.s=!1,wN.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,gN)&&e[gN]||(e[gN]=++mN)}(this);delete SN[e]}},wN.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const bN=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},PN=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function ON(e){return Array.prototype.concat.apply([],arguments)}function TN(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function IN(e){return/^[\s\xa0]*$/.test(e)}var kN,AN=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function MN(e,t){return-1!=e.indexOf(t)}function NN(e,t){return e<t?-1:e>t?1:0}e:{var RN=hN.navigator;if(RN){var xN=RN.userAgent;if(xN){kN=xN;break e}}kN=""}function DN(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function LN(e){const t={};for(const n in e)t[n]=e[n];return t}var FN="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function UN(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<FN.length;t++)n=FN[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function BN(e){return BN[" "](e),e}BN[" "]=dN;var VN,$N=MN(kN,"Opera"),zN=MN(kN,"Trident")||MN(kN,"MSIE"),HN=MN(kN,"Edge"),GN=HN||zN,qN=MN(kN,"Gecko")&&!(MN(kN.toLowerCase(),"webkit")&&!MN(kN,"Edge"))&&!(MN(kN,"Trident")||MN(kN,"MSIE"))&&!MN(kN,"Edge"),WN=MN(kN.toLowerCase(),"webkit")&&!MN(kN,"Edge");function jN(){var e=hN.document;return e?e.documentMode:void 0}e:{var ZN="",YN=function(){var e=kN;return qN?/rv:([^\);]+)(\)|;)/.exec(e):HN?/Edge\/([\d\.]+)/.exec(e):zN?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):WN?/WebKit\/(\S+)/.exec(e):$N?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(YN&&(ZN=YN?YN[1]:""),zN){var KN=jN();if(null!=KN&&KN>parseFloat(ZN)){VN=String(KN);break e}}VN=ZN}var QN={};function JN(){return e=QN,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=AN(String(VN)).split("."),n=AN("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=NN(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||NN(0==i[2].length,0==s[2].length)||NN(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}var XN=hN.document&&zN&&(jN()||parseInt(VN,10))||void 0,eR=function(){if(!hN.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{hN.addEventListener("test",dN,t),hN.removeEventListener("test",dN,t)}catch{}return e}();function tR(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function nR(e,t){if(tR.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(qN){e:{try{BN(t.nodeName);var i=!0;break e}catch{}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:rR[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&nR.Z.h.call(this)}}tR.prototype.h=function(){this.defaultPrevented=!0},EN(nR,tR);var rR={2:"touch",3:"pen",4:"mouse"};nR.prototype.h=function(){nR.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var iR="closure_listenable_"+(1e6*Math.random()|0),sR=0;function oR(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++sR,this.ca=this.fa=!1}function aR(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function lR(e){this.src=e,this.g={},this.h=0}function cR(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=bN(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(aR(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function uR(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}lR.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=uR(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new oR(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var hR="closure_lm_"+(1e6*Math.random()|0),dR={};function pR(e,t,n,r,i){if(r&&r.once)return gR(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)pR(e,t[s],n,r,i);return null}return n=wR(n),e&&e[iR]?e.N(t,n,fN(r)?!!r.capture:!!r,i):fR(e,t,n,!1,r,i)}function fR(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=fN(i)?!!i.capture:!!i,a=CR(e);if(a||(e[hR]=a=new lR(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=_R;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)eR||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(vR(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function gR(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)gR(e,t[s],n,r,i);return null}return n=wR(n),e&&e[iR]?e.O(t,n,fN(r)?!!r.capture:!!r,i):fR(e,t,n,!0,r,i)}function mR(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)mR(e,t[s],n,r,i);else r=fN(r)?!!r.capture:!!r,n=wR(n),e&&e[iR]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=uR(s=e.g[t],n,r,i))&&(aR(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=CR(e))&&(t=e.g[t.toString()],e=-1,t&&(e=uR(t,n,r,i)),(n=-1<e?t[e]:null)&&yR(n))}function yR(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[iR])cR(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(vR(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=CR(t))?(cR(n,e),0==n.h&&(n.src=null,t[hR]=null)):aR(e)}}}function vR(e){return e in dR?dR[e]:dR[e]="on"+e}function _R(e,t){if(e.ca)e=!0;else{t=new nR(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&yR(e),e=n.call(r,t)}return e}function CR(e){return(e=e[hR])instanceof lR?e:null}var ER="__closure_events_fn_"+(1e9*Math.random()>>>0);function wR(e){return"function"==typeof e?e:(e[ER]||(e[ER]=function(t){return e.handleEvent(t)}),e[ER])}function SR(){wN.call(this),this.i=new lR(this),this.P=this,this.I=null}function bR(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new tR(t,e);else if(t instanceof tR)t.target=t.target||e;else{var i=t;UN(t=new tR(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=PR(o,r,!0,t)&&i}if(i=PR(o=t.g=e,r,!0,t)&&i,i=PR(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=PR(o=t.g=n[s],r,!1,t)&&i}function PR(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,l=o.ia||o.src;o.fa&&cR(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}EN(SR,wN),SR.prototype[iR]=!0,SR.prototype.removeEventListener=function(e,t,n,r){mR(this,e,t,n,r)},SR.prototype.M=function(){if(SR.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)aR(n[r]);delete t.g[e],t.h--}}this.I=null},SR.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},SR.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var OR=hN.JSON.stringify;function TR(){var e=xR;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var IR,kR=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new AR,e=>e.reset());class AR{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function MR(e){hN.setTimeout(()=>{throw e},0)}function NR(e,t){IR||function(){var e=hN.Promise.resolve(void 0);IR=function(){e.then(DR)}}(),RR||(IR(),RR=!0),xR.add(e,t)}var RR=!1,xR=new class{constructor(){this.h=this.g=null}add(e,t){const n=kR.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function DR(){for(var e;e=TR();){try{e.h.call(e.g)}catch(n){MR(n)}var t=kR;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}RR=!1}function LR(e,t){SR.call(this),this.h=e||1,this.g=t||hN,this.j=_N(this.kb,this),this.l=Date.now()}function FR(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function UR(e,t,n){if("function"==typeof e)n&&(e=_N(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=_N(e.handleEvent,e)}return 2147483647<Number(t)?-1:hN.setTimeout(e,t||0)}function BR(e){e.g=UR(()=>{e.g=null,e.i&&(e.i=!1,BR(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}EN(LR,SR),(aN=LR.prototype).da=!1,aN.S=null,aN.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),bR(this,"tick"),this.da&&(FR(this),this.start()))}},aN.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},aN.M=function(){LR.Z.M.call(this),FR(this),delete this.g};class VR extends wN{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:BR(this)}M(){super.M(),this.g&&(hN.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $R(e){wN.call(this),this.h=e,this.g={}}EN($R,wN);var zR=[];function HR(e,t,n,r){Array.isArray(n)||(n&&(zR[0]=n.toString()),n=zR);for(var i=0;i<n.length;i++){var s=pR(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function GR(e){DN(e.g,function(e,t){this.g.hasOwnProperty(t)&&yR(e)},e),e.g={}}function qR(){this.g=!0}function WR(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return OR(n)}catch{return t}}(e,n)+(r?" "+r:"")})}$R.prototype.M=function(){$R.Z.M.call(this),GR(this)},$R.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qR.prototype.Aa=function(){this.g=!1},qR.prototype.info=function(){};var jR={},ZR=null;function YR(){return ZR=ZR||new SR}function KR(e){tR.call(this,jR.Ma,e)}function QR(e){const t=YR();bR(t,new KR(t,e))}function JR(e,t){tR.call(this,jR.STAT_EVENT,e),this.stat=t}function XR(e){const t=YR();bR(t,new JR(t,e))}function ex(e,t){tR.call(this,jR.Na,e),this.size=t}function tx(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return hN.setTimeout(function(){e()},t)}jR.Ma="serverreachability",EN(KR,tR),jR.STAT_EVENT="statevent",EN(JR,tR),jR.Na="timingevent",EN(ex,tR);var nx={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},rx={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ix(){}function sx(){}ix.prototype.h=null;var ox,ax={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function lx(){tR.call(this,"d")}function cx(){tR.call(this,"c")}function ux(){}function hx(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new $R(this),this.P=px,this.W=new LR(e=GN?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new dx}function dx(){this.i=null,this.g="",this.h=!1}EN(lx,tR),EN(cx,tR),EN(ux,ix),ux.prototype.g=function(){return new XMLHttpRequest},ux.prototype.i=function(){return{}},ox=new ux;var px=45e3,fx={},gx={};function mx(e,t,n){e.K=1,e.v=Bx(Rx(t)),e.s=n,e.U=!0,yx(e,null)}function yx(e,t){e.F=Date.now(),Ex(e),e.A=Rx(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Jx(n.h,"t",r),e.C=0,n=e.l.H,e.h=new dx,e.g=JD(e.l,n?t:null,!e.s),0<e.O&&(e.L=new VR(_N(e.Ia,e,e.g),e.O)),HR(e.V,e.g,"readystatechange",e.gb),t=e.H?LN(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),QR(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function vx(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function _x(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Cx(e,n),r==gx){4==t&&(e.o=4,XR(14),i=!1),WR(e.j,e.m,null,"[Incomplete Response]");break}if(r==fx){e.o=4,XR(15),WR(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}WR(e.j,e.m,r,null),Ox(e,r)}vx(e)&&r!=gx&&r!=fx&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,XR(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),GD(t),t.L=!0,XR(11))):(WR(e.j,e.m,n,"[Invalid Chunked Response]"),Px(e),bx(e))}function Cx(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?gx:(n=Number(t.substring(n,r)),isNaN(n)?fx:(r+=1)+n>t.length?gx:(t=t.substr(r,n),e.C=r+n,t))}function Ex(e){e.Y=Date.now()+e.P,wx(e,e.P)}function wx(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=tx(_N(e.eb,e),t)}function Sx(e){e.B&&(hN.clearTimeout(e.B),e.B=null)}function bx(e){0==e.l.G||e.I||jD(e.l,e)}function Px(e){Sx(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,FR(e.W),GR(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ox(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||iD(n.i,e)))if(n.I=e.N,!e.J&&iD(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=tx(_N(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;WD(n),DD(n)}HD(n),XR(18)}if(1>=rD(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else YD(n,11)}else if((e.J||n.g==e)&&WD(n),!IN(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.U=c[0],c=c[1],2==n.G)if("c"==c[0]){n.J=c[1],n.la=c[2];const t=c[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=c[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(MN(e,"spdy")||MN(e,"quic")||MN(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(sD(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,Ux(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=QD(r,r.H?r.la:null,r.W),o.J){oD(r.i,o);var a=o,l=r.K;l&&a.setTimeout(l),a.B&&(Sx(a),Ex(a)),r.g=o}else zD(r);0<n.l.length&&UD(n)}else"stop"!=c[0]&&"close"!=c[0]||YD(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?YD(n,7):xD(n):"noop"!=c[0]&&n.j&&n.j.wa(c),n.A=0)}QR(4)}catch{}}function Tx(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(pN(e)||"string"==typeof e)PN(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(pN(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(pN(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Ix(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Ix)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function kx(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Ax(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Ax(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Ax(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(aN=hx.prototype).setTimeout=function(e){this.P=e},aN.gb=function(e){e=e.target;const t=this.L;t&&3==kD(e)?t.l():this.Ia(e)},aN.Ia=function(e){try{if(e==this.g)e:{const u=kD(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>u)&&(3!=u||GN||this.g&&(this.h.h||this.g.ga()||AD(this.g)))){this.I||4!=u||7==t||QR(8==t||0>=h?3:2),Sx(this);var n=this.g.ba();this.N=n;t:if(vx(this)){var r=AD(this.g);e="";var i=r.length,s=4==kD(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Px(this),bx(this);var o="";break t}this.h.i=new hN.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!IN(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,XR(12),Px(this),bx(this);break e}WR(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ox(this,n)}this.U?(_x(this,u,o),GN&&this.i&&3==u&&(HR(this.V,this.W,"tick",this.fb),this.W.start())):(WR(this.j,this.m,o,null),Ox(this,o)),4==u&&Px(this),this.i&&!this.I&&(4==u?jD(this.l,this):(this.i=!1,Ex(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,XR(12)):(this.o=0,XR(13)),Px(this),bx(this)}}}catch{}},aN.fb=function(){if(this.g){var e=kD(this.g),t=this.g.ga();this.C<t.length&&(Sx(this),_x(this,e,t),this.i&&4!=e&&Ex(this))}},aN.cancel=function(){this.I=!0,Px(this)},aN.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(QR(3),XR(17)),Px(this),this.o=2,bx(this)):wx(this,this.Y-e)},(aN=Ix.prototype).R=function(){kx(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},aN.T=function(){return kx(this),this.g.concat()},aN.get=function(e,t){return Ax(this.h,e)?this.h[e]:t},aN.set=function(e,t){Ax(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},aN.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var Mx=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nx(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Nx){this.g=void 0!==t?t:e.g,xx(this,e.j),this.s=e.s,Dx(this,e.i),Lx(this,e.m),this.l=e.l,t=e.h;var n=new Zx;n.i=t.i,t.g&&(n.g=new Ix(t.g),n.h=t.h),Fx(this,n),this.o=e.o}else e&&(n=String(e).match(Mx))?(this.g=!!t,xx(this,n[1]||"",!0),this.s=Vx(n[2]||""),Dx(this,n[3]||"",!0),Lx(this,n[4]),this.l=Vx(n[5]||"",!0),Fx(this,n[6]||"",!0),this.o=Vx(n[7]||"")):(this.g=!!t,this.h=new Zx(null,this.g))}function Rx(e){return new Nx(e)}function xx(e,t,n){e.j=n?Vx(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Dx(e,t,n){e.i=n?Vx(t,!0):t}function Lx(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Fx(e,t,n){t instanceof Zx?(e.h=t,function(e,t){t&&!e.j&&(Yx(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Kx(this,t),Jx(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=$x(t,Wx)),e.h=new Zx(t,e.g))}function Ux(e,t,n){e.h.set(t,n)}function Bx(e){return Ux(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Vx(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $x(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,zx),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function zx(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Nx.prototype.toString=function(){var e=[],t=this.j;t&&e.push($x(t,Hx,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push($x(t,Hx,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push($x(n,"/"==n.charAt(0)?qx:Gx,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",$x(n,jx)),e.join("")};var Hx=/[#\/\?@]/g,Gx=/[#\?:]/g,qx=/[#\?]/g,Wx=/[#\?@]/g,jx=/#/g;function Zx(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Yx(e){e.g||(e.g=new Ix,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Kx(e,t){Yx(e),t=Xx(e,t),Ax(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Ax((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&kx(e)))}function Qx(e,t){return Yx(e),t=Xx(e,t),Ax(e.g.h,t)}function Jx(e,t,n){Kx(e,t),0<n.length&&(e.i=null,e.g.set(Xx(e,t),TN(n)),e.h+=n.length)}function Xx(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function eD(e){this.l=e||tD,e=hN.PerformanceNavigationTiming?0<(e=hN.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(hN.g&&hN.g.Ea&&hN.g.Ea()&&hN.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(aN=Zx.prototype).add=function(e,t){Yx(this),this.i=null,e=Xx(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},aN.forEach=function(e,t){Yx(this),this.g.forEach(function(n,r){PN(n,function(n){e.call(t,n,r,this)},this)},this)},aN.T=function(){Yx(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},aN.R=function(e){Yx(this);var t=[];if("string"==typeof e)Qx(this,e)&&(t=ON(t,this.g.get(Xx(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=ON(t,e[n])}return t},aN.set=function(e,t){return Yx(this),this.i=null,Qx(this,e=Xx(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},aN.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},aN.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var tD=10;function nD(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rD(e){return e.h?1:e.g?e.g.size:0}function iD(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function sD(e,t){e.g?e.g.add(t):e.h=t}function oD(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function aD(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return TN(e.i)}function lD(){}function cD(){this.g=new lD}function uD(e,t,n){const r=n||"";try{Tx(e,function(e,n){let i=e;fN(e)&&(i=OR(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function hD(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function dD(e){this.l=e.$b||null,this.j=e.ib||!1}function pD(e,t){SR.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=fD,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}eD.prototype.cancel=function(){if(this.i=aD(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},lD.prototype.stringify=function(e){return hN.JSON.stringify(e,void 0)},lD.prototype.parse=function(e){return hN.JSON.parse(e,void 0)},EN(dD,ix),dD.prototype.g=function(){return new pD(this.l,this.j)},dD.prototype.i=function(e){return function(){return e}}({}),EN(pD,SR);var fD=0;function gD(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function mD(e){e.readyState=4,e.l=null,e.j=null,e.A=null,yD(e)}function yD(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(aN=pD.prototype).open=function(e,t){if(this.readyState!=fD)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,yD(this)},aN.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||hN).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},aN.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,mD(this)),this.readyState=fD},aN.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,yD(this)),this.g&&(this.readyState=3,yD(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==hN.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gD(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},aN.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?mD(this):yD(this),3==this.readyState&&gD(this)}},aN.Ua=function(e){this.g&&(this.response=this.responseText=e,mD(this))},aN.Ta=function(e){this.g&&(this.response=e,mD(this))},aN.ha=function(){this.g&&mD(this)},aN.setRequestHeader=function(e,t){this.v.append(e,t)},aN.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},aN.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(pD.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var vD=hN.JSON.parse;function _D(e){SR.call(this),this.headers=new Ix,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=CD,this.K=this.L=!1}EN(_D,SR);var CD="",ED=/^https?$/i,wD=["POST","PUT"];function SD(e){return"content-type"==e.toLowerCase()}function bD(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,PD(e),TD(e)}function PD(e){e.D||(e.D=!0,bR(e,"complete"),bR(e,"error"))}function OD(e){if(e.h&&void 0!==uN&&(!e.C[1]||4!=kD(e)||2!=e.ba()))if(e.v&&4==kD(e))UR(e.Fa,0,e);else if(bR(e,"readystatechange"),4==kD(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Mx)[1]||null;if(!i&&hN.self&&hN.self.location){var s=hN.self.location.protocol;i=s.substr(0,s.length-1)}r=!ED.test(i?i.toLowerCase():"")}n=r}if(n)bR(e,"complete"),bR(e,"success");else{e.m=6;try{var o=2<kD(e)?e.g.statusText:""}catch{o=""}e.j=o+" ["+e.ba()+"]",PD(e)}}finally{TD(e)}}}function TD(e,t){if(e.g){ID(e);const n=e.g,r=e.C[0]?dN:null;e.g=null,e.C=null,t||bR(e,"ready");try{n.onreadystatechange=r}catch{}}}function ID(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(hN.clearTimeout(e.A),e.A=null)}function kD(e){return e.g?e.g.readyState:0}function AD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case CD:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function MD(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return DN(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ux(e,t,n))}function ND(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function RD(e){this.za=0,this.l=[],this.h=new qR,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ND("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ND("baseRetryDelayMs",5e3,e),this.$a=ND("retryDelaySeedMs",1e4,e),this.Ya=ND("forwardChannelMaxRetries",2,e),this.ra=ND("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new eD(e&&e.concurrentRequestLimit),this.Ca=new cD,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function xD(e){if(LD(e),3==e.G){var t=e.V++,n=Rx(e.F);Ux(n,"SID",e.J),Ux(n,"RID",t),Ux(n,"TYPE","terminate"),VD(e,n),(t=new hx(e,e.h,t,void 0)).K=2,t.v=Bx(Rx(n)),n=!1,hN.navigator&&hN.navigator.sendBeacon&&(n=hN.navigator.sendBeacon(t.v.toString(),"")),!n&&hN.Image&&((new Image).src=t.v,n=!0),n||(t.g=JD(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Ex(t)}KD(e)}function DD(e){e.g&&(GD(e),e.g.cancel(),e.g=null)}function LD(e){DD(e),e.u&&(hN.clearTimeout(e.u),e.u=null),WD(e),e.i.cancel(),e.m&&("number"==typeof e.m&&hN.clearTimeout(e.m),e.m=null)}function FD(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&UD(e)}function UD(e){nD(e.i)||e.m||(e.m=!0,NR(e.Ha,e),e.C=0)}function BD(e,t){var n;n=t?t.m:e.V++;const r=Rx(e.F);Ux(r,"SID",e.J),Ux(r,"RID",n),Ux(r,"AID",e.U),VD(e,r),e.o&&e.s&&MD(r,e.o,e.s),n=new hx(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=$D(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),sD(e.i,n),mx(n,r,t)}function VD(e,t){e.j&&Tx({},function(e,n){Ux(t,n,e)})}function $D(e,t,n){n=Math.min(e.l.length,n);var r=e.j?_N(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{uD(a,e,"req"+n+"_")}catch{r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function zD(e){e.g||e.u||(e.Y=1,NR(e.Ga,e),e.A=0)}function HD(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=tx(_N(e.Ga,e),ZD(e,e.A)),e.A++,0))}function GD(e){null!=e.B&&(hN.clearTimeout(e.B),e.B=null)}function qD(e){e.g=new hx(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Rx(e.oa);Ux(t,"RID","rpc"),Ux(t,"SID",e.J),Ux(t,"CI",e.N?"0":"1"),Ux(t,"AID",e.U),VD(e,t),Ux(t,"TYPE","xmlhttp"),e.o&&e.s&&MD(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Bx(Rx(t)),n.s=null,n.U=!0,yx(n,e)}function WD(e){null!=e.v&&(hN.clearTimeout(e.v),e.v=null)}function jD(e,t){var n=null;if(e.g==t){WD(e),GD(e),e.g=null;var r=2}else{if(!iD(e.i,t))return;n=t.D,oD(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;bR(r=YR(),new ex(r,n,t,i)),UD(e)}else zD(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(rD(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=tx(_N(e.Ha,e,t),ZD(e,e.C)),e.C++,0)))}(e,t)||2==r&&HD(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:YD(e,5);break;case 4:YD(e,10);break;case 3:YD(e,6);break;default:YD(e,2)}}function ZD(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function YD(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=_N(e.jb,e);n||(n=new Nx("//www.google.com/images/cleardot.gif"),hN.location&&"http"==hN.location.protocol||xx(n,"https"),Bx(n)),function(e,t){const n=new qR;if(hN.Image){const r=new Image;r.onload=CN(hD,n,r,"TestLoadImage: loaded",!0,t),r.onerror=CN(hD,n,r,"TestLoadImage: error",!1,t),r.onabort=CN(hD,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=CN(hD,n,r,"TestLoadImage: timeout",!1,t),hN.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else XR(2);e.G=0,e.j&&e.j.va(t),KD(e),LD(e)}function KD(e){e.G=0,e.I=-1,e.j&&((0!=aD(e.i).length||0!=e.l.length)&&(e.i.i.length=0,TN(e.l),e.l.length=0),e.j.ua())}function QD(e,t,n){let r=function(e){return e instanceof Nx?Rx(e):new Nx(e,void 0)}(n);if(""!=r.i)t&&Dx(r,t+"."+r.i),Lx(r,r.m);else{const e=hN.location;r=function(e,t,n,r){var i=new Nx(null,void 0);return e&&xx(i,e),t&&Dx(i,t),n&&Lx(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&DN(e.aa,function(e,t){Ux(r,t,e)}),n=e.sa,(t=e.D)&&n&&Ux(r,t,n),Ux(r,"VER",e.ma),VD(e,r),r}function JD(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new _D(n&&e.Ba&&!e.qa?new dD({ib:!0}):e.qa)).L=e.H,t}function XD(){}function eL(){if(zN&&!(10<=Number(XN)))throw Error("Environmental error: no available transport.")}function tL(e,t){SR.call(this),this.g=new RD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!IN(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!IN(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new iL(this)}function nL(e){lx.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function rL(){cx.call(this),this.status=1}function iL(e){this.g=e}(aN=_D.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ox.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:ox),this.g.onreadystatechange=_N(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void bD(this,s)}e=n||"";const i=new Ix(this.headers);r&&Tx(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=SD;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=hN.FormData&&e instanceof hN.FormData,!(0<=bN(wD,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ID(this),0<this.B&&((this.K=function(e){return zN&&JN()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_N(this.pa,this)):this.A=UR(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){bD(this,s)}},aN.pa=function(){void 0!==uN&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bR(this,"timeout"),this.abort(8))},aN.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,bR(this,"complete"),bR(this,"abort"),TD(this))},aN.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),TD(this,!0)),_D.Z.M.call(this)},aN.Fa=function(){this.s||(this.F||this.v||this.l?OD(this):this.cb())},aN.cb=function(){OD(this)},aN.ba=function(){try{return 2<kD(this)?this.g.status:-1}catch{return-1}},aN.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},aN.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),vD(t)}},aN.Da=function(){return this.m},aN.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(aN=RD.prototype).ma=8,aN.G=1,aN.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}},aN.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new hx(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=LN(s),UN(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=$D(this,i,t),Ux(n=Rx(this.F),"RID",e),Ux(n,"CVER",22),this.D&&Ux(n,"X-HTTP-Session-Id",this.D),VD(this,n),this.o&&s&&MD(n,this.o,s),sD(this.i,i),this.Ra&&Ux(n,"TYPE","init"),this.ja?(Ux(n,"$req",t),Ux(n,"SID","null"),i.$=!0,mx(i,n,null)):mx(i,n,t),this.G=2}}else 3==this.G&&(e?BD(this,e):0==this.l.length||nD(this.i)||BD(this))},aN.Ga=function(){if(this.u=null,qD(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=tx(_N(this.bb,this),e)}},aN.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,XR(10),DD(this),qD(this))},aN.ab=function(){null!=this.v&&(this.v=null,DD(this),HD(this),XR(19))},aN.jb=function(e){e?(this.h.info("Successfully pinged google.com"),XR(2)):(this.h.info("Failed to ping google.com"),XR(1))},(aN=XD.prototype).xa=function(){},aN.wa=function(){},aN.va=function(){},aN.ua=function(){},aN.Oa=function(){},eL.prototype.g=function(e,t){return new tL(e,t)},EN(tL,SR),tL.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),NR(_N(e.hb,e,t))),XR(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=QD(e,null,e.W),UD(e)},tL.prototype.close=function(){xD(this.g)},tL.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,FD(this.g,t)}else this.v?((t={}).__data__=OR(e),FD(this.g,t)):FD(this.g,e)},tL.prototype.M=function(){this.g.j=null,delete this.j,xD(this.g),delete this.g,tL.Z.M.call(this)},EN(nL,lx),EN(rL,cx),EN(iL,XD),iL.prototype.xa=function(){bR(this.g,"a")},iL.prototype.wa=function(e){bR(this.g,new nL(e))},iL.prototype.va=function(e){bR(this.g,new rL(e))},iL.prototype.ua=function(){bR(this.g,"b")},eL.prototype.createWebChannel=eL.prototype.g,tL.prototype.send=tL.prototype.u,tL.prototype.open=tL.prototype.m,tL.prototype.close=tL.prototype.close,nx.NO_ERROR=0,nx.TIMEOUT=8,nx.HTTP_ERROR=6,rx.COMPLETE="complete",sx.EventType=ax,ax.OPEN="a",ax.CLOSE="b",ax.ERROR="c",ax.MESSAGE="d",SR.prototype.listen=SR.prototype.N,_D.prototype.listenOnce=_D.prototype.O,_D.prototype.getLastError=_D.prototype.La,_D.prototype.getLastErrorCode=_D.prototype.Da,_D.prototype.getStatus=_D.prototype.ba,_D.prototype.getResponseJson=_D.prototype.Qa,_D.prototype.getResponseText=_D.prototype.ga,_D.prototype.send=_D.prototype.ea;var sL=cN.createWebChannelTransport=function(){return new eL},oL=cN.getStatEventTarget=function(){return YR()},aL=cN.ErrorCode=nx,lL=cN.EventType=rx,cL=cN.Event=jR,uL=cN.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},hL=cN.FetchXmlHttpFactory=dD,dL=cN.WebChannel=sx,pL=cN.XhrIo=_D;const fL="@firebase/firestore";class gL{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gL.UNAUTHENTICATED=new gL(null),gL.GOOGLE_CREDENTIALS=new gL("google-credentials-uid"),gL.FIRST_PARTY=new gL("first-party-uid"),gL.MOCK_USER=new gL("mock-user");let mL="9.6.5";const yL=new AS("@firebase/firestore");function vL(){return yL.logLevel}function _L(e,...t){if(yL.logLevel<=PS.DEBUG){const n=t.map(wL);yL.debug(`Firestore (${mL}): ${e}`,...n)}}function CL(e,...t){if(yL.logLevel<=PS.ERROR){const n=t.map(wL);yL.error(`Firestore (${mL}): ${e}`,...n)}}function EL(e,...t){if(yL.logLevel<=PS.WARN){const n=t.map(wL);yL.warn(`Firestore (${mL}): ${e}`,...n)}}function wL(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return e}}function SL(e="Unexpected state"){const t=`FIRESTORE (${mL}) INTERNAL ASSERTION FAILED: `+e;throw CL(t),new Error(t)}function bL(e,t){e||SL()}function PL(e,t){return e}const OL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class TL extends Jw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class IL{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class kL{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class AL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gL.UNAUTHENTICATED))}shutdown(){}}class ML{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class NL{constructor(e){this.t=e,this.currentUser=gL.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let r=this.i;const i=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new IL;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new IL,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(Pw(function*(){yield t.promise,yield i(n.currentUser)}))},a=e=>{_L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(_L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new IL)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(_L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(bL("string"==typeof t.accessToken),new kL(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return bL(null===e||"string"==typeof e),new gL(e)}}class RL{constructor(e,t,n){this.type="FirstParty",this.user=gL.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class xL{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new RL(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(gL.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class DL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class LL{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable(()=>{return null!=(e=n).error&&_L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token);var e})};const n=e=>{_L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):_L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(bL("string"==typeof e.token),new DL(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class FL{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function UL(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}FL.I=-1;class BL{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=UL(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function VL(e,t){return e<t?-1:e>t?1:0}function $L(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class zL{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new TL(OL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new TL(OL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new TL(OL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new TL(OL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return zL.fromMillis(Date.now())}static fromDate(e){return zL.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new zL(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?VL(this.nanoseconds,e.nanoseconds):VL(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class HL{constructor(e){this.timestamp=e}static fromTimestamp(e){return new HL(e)}static min(){return new HL(new zL(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function GL(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function qL(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function WL(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class jL{constructor(e,t,n){void 0===t?t=0:t>e.length&&SL(),void 0===n?n=e.length-t:n>e.length-t&&SL(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===jL.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jL?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ZL extends jL{construct(e,t,n){return new ZL(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new TL(OL.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ZL(t)}static emptyPath(){return new ZL([])}}const YL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class KL extends jL{construct(e,t,n){return new KL(e,t,n)}static isValidIdentifier(e){return YL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),KL.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new KL(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new TL(OL.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new TL(OL.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new TL(OL.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new TL(OL.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new KL(t)}static emptyPath(){return new KL([])}}class QL{constructor(e){this.fields=e,e.sort(KL.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return $L(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class JL{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new JL(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new JL(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return VL(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}JL.EMPTY_BYTE_STRING=new JL("");const XL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function eF(e){if(bL(!!e),"string"==typeof e){let t=0;const n=XL.exec(e);if(bL(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:tF(e.seconds),nanos:tF(e.nanos)}}function tF(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nF(e){return"string"==typeof e?JL.fromBase64String(e):JL.fromUint8Array(e)}function rF(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function iF(e){const t=e.mapValue.fields.__previous_value__;return rF(t)?iF(t):t}function sF(e){const t=eF(e.mapValue.fields.__local_write_time__.timestampValue);return new zL(t.seconds,t.nanos)}function oF(e){return null==e}function aF(e){return 0===e&&1/e==-1/0}class lF{constructor(e){this.path=e}static fromPath(e){return new lF(ZL.fromString(e))}static fromName(e){return new lF(ZL.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===ZL.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ZL.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new lF(new ZL(e.slice()))}}function cF(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rF(e)?4:10:SL()}function uF(e,t){if(e===t)return!0;const n=cF(e);if(n!==cF(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sF(e).isEqual(sF(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=eF(e.timestampValue),r=eF(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,nF(e.bytesValue).isEqual(nF(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return tF(e.geoPointValue.latitude)===tF(t.geoPointValue.latitude)&&tF(e.geoPointValue.longitude)===tF(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return tF(e.integerValue)===tF(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=tF(e.doubleValue),r=tF(t.doubleValue);return n===r?aF(n)===aF(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return $L(e.arrayValue.values||[],t.arrayValue.values||[],uF);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(GL(n)!==GL(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!uF(n[i],r[i])))return!1;return!0}(e,t);default:return SL()}var r}function hF(e,t){return void 0!==(e.values||[]).find(e=>uF(e,t))}function dF(e,t){if(e===t)return 0;const n=cF(e),r=cF(t);if(n!==r)return VL(n,r);switch(n){case 0:return 0;case 1:return VL(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=tF(e.integerValue||e.doubleValue),r=tF(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return pF(e.timestampValue,t.timestampValue);case 4:return pF(sF(e),sF(t));case 5:return VL(e.stringValue,t.stringValue);case 6:return function(e,t){const n=nF(e),r=nF(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=VL(n[i],r[i]);if(0!==e)return e}return VL(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=VL(tF(e.latitude),tF(t.latitude));return 0!==n?n:VL(tF(e.longitude),tF(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=dF(n[i],r[i]);if(e)return e}return VL(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=VL(r[o],s[o]);if(0!==e)return e;const t=dF(n[r[o]],i[s[o]]);if(0!==t)return t}return VL(r.length,s.length)}(e.mapValue,t.mapValue);default:throw SL()}}function pF(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return VL(e,t);const n=eF(e),r=eF(t),i=VL(n.seconds,r.seconds);return 0!==i?i:VL(n.nanos,r.nanos)}function fF(e){return gF(e)}function gF(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=eF(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?nF(e.bytesValue).toBase64():"referenceValue"in e?lF.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=gF(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${gF(e.fields[i])}`;return n+"}"}(e.mapValue):SL();var t}function mF(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function yF(e){return!!e&&"integerValue"in e}function vF(e){return!!e&&"arrayValue"in e}function _F(e){return!!e&&"nullValue"in e}function CF(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function EF(e){return!!e&&"mapValue"in e}function wF(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return qL(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=wF(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=wF(e.arrayValue.values[n]);return t}return Object.assign({},e)}class SF{constructor(e){this.value=e}static empty(){return new SF({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!EF(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wF(t)}setAll(e){let t=KL.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=wF(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());EF(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return uF(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];EF(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){qL(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new SF(wF(this.value))}}function bF(e){const t=[];return qL(e.fields,(e,n)=>{const r=new KL([e]);if(EF(n)){const e=bF(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new QL(t)}class PF{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new PF(e,0,HL.min(),SF.empty(),0)}static newFoundDocument(e,t,n){return new PF(e,1,t,n,0)}static newNoDocument(e,t){return new PF(e,2,t,SF.empty(),0)}static newUnknownDocument(e,t){return new PF(e,3,t,SF.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=SF.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=SF.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof PF&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new PF(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class OF{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function TF(e,t=null,n=[],r=[],i=null,s=null,o=null){return new OF(e,t,n,r,i,s,o)}function IF(e){const t=PL(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+fF(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),oF(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=$F(t.startAt)),t.endAt&&(e+="|ub:",e+=$F(t.endAt)),t.R=e}return t.R}function kF(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!HF(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!uF(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!qF(e.startAt,t.startAt)&&qF(e.endAt,t.endAt)}function AF(e){return lF.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class MF extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new NF(e,t,n):"array-contains"===t?new LF(e,n):"in"===t?new FF(e,n):"not-in"===t?new UF(e,n):"array-contains-any"===t?new BF(e,n):new MF(e,t,n)}static P(e,t,n){return"in"===t?new RF(e,n):new xF(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(dF(t,this.value)):null!==t&&cF(this.value)===cF(t)&&this.v(dF(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return SL()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class NF extends MF{constructor(e,t,n){super(e,t,n),this.key=lF.fromName(n.referenceValue)}matches(e){const t=lF.comparator(e.key,this.key);return this.v(t)}}class RF extends MF{constructor(e,t){super(e,"in",t),this.keys=DF(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class xF extends MF{constructor(e,t){super(e,"not-in",t),this.keys=DF(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function DF(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>lF.fromName(e.referenceValue))}class LF extends MF{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vF(t)&&hF(t.arrayValue,this.value)}}class FF extends MF{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&hF(this.value.arrayValue,t)}}class UF extends MF{constructor(e,t){super(e,"not-in",t)}matches(e){if(hF(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!hF(this.value.arrayValue,t)}}class BF extends MF{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vF(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>hF(this.value.arrayValue,e))}}class VF{constructor(e,t){this.position=e,this.before=t}}function $F(e){return`${e.before?"b":"a"}:${e.position.map(e=>fF(e)).join(",")}`}class zF{constructor(e,t="asc"){this.field=e,this.dir=t}}function HF(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function GF(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?lF.comparator(lF.fromName(o.referenceValue),n.key):dF(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function qF(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!uF(e.position[n],t.position[n]))return!1;return!0}class WF{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null}}function jF(e){return new WF(e)}function ZF(e){return!oF(e.limit)&&"F"===e.limitType}function YF(e){return!oF(e.limit)&&"L"===e.limitType}function KF(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function QF(e){for(const t of e.filters)if(t.V())return t.field;return null}function JF(e){return null!==e.collectionGroup}function XF(e){const t=PL(e);if(null===t.S){t.S=[];const e=QF(t),n=KF(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new zF(e)),t.S.push(new zF(KL.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new zF(KL.keyField(),e))}}}return t.S}function eU(e){const t=PL(e);if(!t.D)if("F"===t.limitType)t.D=TF(t.path,t.collectionGroup,XF(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of XF(t))e.push(new zF(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new VF(t.endAt.position,!t.endAt.before):null,r=t.startAt?new VF(t.startAt.position,!t.startAt.before):null;t.D=TF(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function tU(e,t,n){return new WF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function nU(e,t){return kF(eU(e),eU(t))&&e.limitType===t.limitType}function rU(e){return`${IF(eU(e))}|lt:${e.limitType}`}function iU(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${fF(t.value)}`;var t}).join(", ")}]`),oF(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: "+$F(e.startAt)),e.endAt&&(t+=", endAt: "+$F(e.endAt)),`Target(${t})`}(eU(e))}; limitType=${e.limitType})`}function sU(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):lF.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!GF(n.startAt,XF(n),r)||n.endAt&&GF(n.endAt,XF(n),r)));var n,r}function oU(e){return(t,n)=>{let r=!1;for(const i of XF(e)){const e=aU(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function aU(e,t,n){const r=e.field.isKeyField()?lF.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?dF(r,i):SL()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return SL()}}function lU(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:aF(t)?"-0":t}}function cU(e){return{integerValue:""+e}}function uU(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!aF(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?cU(t):lU(e,t)}class hU{constructor(){this._=void 0}}function dU(e,t,n){return e instanceof gU?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof mU?yU(e,t):e instanceof vU?_U(e,t):function(e,t){const n=fU(e,t),r=EU(n)+EU(e.N);return yF(n)&&yF(e.N)?cU(r):lU(e.k,r)}(e,t)}function pU(e,t,n){return e instanceof mU?yU(e,t):e instanceof vU?_U(e,t):n}function fU(e,t){return e instanceof CU?yF(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}class gU extends hU{}class mU extends hU{constructor(e){super(),this.elements=e}}function yU(e,t){const n=wU(t);for(const r of e.elements)n.some(e=>uF(e,r))||n.push(r);return{arrayValue:{values:n}}}class vU extends hU{constructor(e){super(),this.elements=e}}function _U(e,t){let n=wU(t);for(const r of e.elements)n=n.filter(e=>!uF(e,r));return{arrayValue:{values:n}}}class CU extends hU{constructor(e,t){super(),this.k=e,this.N=t}}function EU(e){return tF(e.integerValue||e.doubleValue)}function wU(e){return vF(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class SU{constructor(e,t){this.field=e,this.transform=t}}class bU{constructor(e,t){this.version=e,this.transformResults=t}}class PU{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new PU}static exists(e){return new PU(void 0,e)}static updateTime(e){return new PU(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function OU(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class TU{}function IU(e,t,n){e instanceof RU?function(e,t,n){const r=e.value.clone(),i=LU(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof xU?function(e,t,n){if(!OU(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=LU(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(DU(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function kU(e,t,n){var r;e instanceof RU?function(e,t,n){if(!OU(e.precondition,t))return;const r=e.value.clone(),i=FU(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(NU(t),r).setHasLocalMutations()}(e,t,n):e instanceof xU?function(e,t,n){if(!OU(e.precondition,t))return;const r=FU(e.fieldTransforms,n,t),i=t.data;i.setAll(DU(e)),i.setAll(r),t.convertToFoundDocument(NU(t),i).setHasLocalMutations()}(e,t,n):OU(e.precondition,r=t)&&r.convertToNoDocument(HL.min())}function AU(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=fU(r.transform,e||null);null!=i&&(null==n&&(n=SF.empty()),n.set(r.field,i))}return n||null}function MU(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&$L(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof mU&&r instanceof mU||n instanceof vU&&r instanceof vU?$L(n.elements,r.elements,uF):n instanceof CU&&r instanceof CU?uF(n.N,r.N):n instanceof gU&&r instanceof gU);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}function NU(e){return e.isFoundDocument()?e.version:HL.min()}class RU extends TU{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class xU extends TU{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function DU(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function LU(e,t,n){const r=new Map;bL(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,pU(o,a,n[i]))}return r}function FU(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,dU(e,s,t))}return r}class UU extends TU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class BU extends TU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class VU{constructor(e){this.count=e}}var $U,zU;function HU(e){switch(e){default:return SL();case OL.CANCELLED:case OL.UNKNOWN:case OL.DEADLINE_EXCEEDED:case OL.RESOURCE_EXHAUSTED:case OL.INTERNAL:case OL.UNAVAILABLE:case OL.UNAUTHENTICATED:return!1;case OL.INVALID_ARGUMENT:case OL.NOT_FOUND:case OL.ALREADY_EXISTS:case OL.PERMISSION_DENIED:case OL.FAILED_PRECONDITION:case OL.ABORTED:case OL.OUT_OF_RANGE:case OL.UNIMPLEMENTED:case OL.DATA_LOSS:return!0}}function GU(e){if(void 0===e)return CL("GRPC error has no .code"),OL.UNKNOWN;switch(e){case $U.OK:return OL.OK;case $U.CANCELLED:return OL.CANCELLED;case $U.UNKNOWN:return OL.UNKNOWN;case $U.DEADLINE_EXCEEDED:return OL.DEADLINE_EXCEEDED;case $U.RESOURCE_EXHAUSTED:return OL.RESOURCE_EXHAUSTED;case $U.INTERNAL:return OL.INTERNAL;case $U.UNAVAILABLE:return OL.UNAVAILABLE;case $U.UNAUTHENTICATED:return OL.UNAUTHENTICATED;case $U.INVALID_ARGUMENT:return OL.INVALID_ARGUMENT;case $U.NOT_FOUND:return OL.NOT_FOUND;case $U.ALREADY_EXISTS:return OL.ALREADY_EXISTS;case $U.PERMISSION_DENIED:return OL.PERMISSION_DENIED;case $U.FAILED_PRECONDITION:return OL.FAILED_PRECONDITION;case $U.ABORTED:return OL.ABORTED;case $U.OUT_OF_RANGE:return OL.OUT_OF_RANGE;case $U.UNIMPLEMENTED:return OL.UNIMPLEMENTED;case $U.DATA_LOSS:return OL.DATA_LOSS;default:return SL()}}(zU=$U||($U={}))[zU.OK=0]="OK",zU[zU.CANCELLED=1]="CANCELLED",zU[zU.UNKNOWN=2]="UNKNOWN",zU[zU.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zU[zU.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zU[zU.NOT_FOUND=5]="NOT_FOUND",zU[zU.ALREADY_EXISTS=6]="ALREADY_EXISTS",zU[zU.PERMISSION_DENIED=7]="PERMISSION_DENIED",zU[zU.UNAUTHENTICATED=16]="UNAUTHENTICATED",zU[zU.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zU[zU.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zU[zU.ABORTED=10]="ABORTED",zU[zU.OUT_OF_RANGE=11]="OUT_OF_RANGE",zU[zU.UNIMPLEMENTED=12]="UNIMPLEMENTED",zU[zU.INTERNAL=13]="INTERNAL",zU[zU.UNAVAILABLE=14]="UNAVAILABLE",zU[zU.DATA_LOSS=15]="DATA_LOSS";class qU{constructor(e,t){this.comparator=e,this.root=t||jU.EMPTY}insert(e,t){return new qU(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,jU.BLACK,null,null))}remove(e){return new qU(this.comparator,this.root.remove(e,this.comparator).copy(null,null,jU.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new WU(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new WU(this.root,e,this.comparator,!1)}getReverseIterator(){return new WU(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new WU(this.root,e,this.comparator,!0)}}class WU{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class jU{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??jU.RED,this.left=r??jU.EMPTY,this.right=i??jU.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new jU(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return jU.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return jU.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,jU.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,jU.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw SL();const e=this.left.check();if(e!==this.right.check())throw SL();return e+(this.isRed()?0:1)}}jU.EMPTY=null,jU.RED=!0,jU.BLACK=!1,jU.EMPTY=new class{constructor(){this.size=0}get key(){throw SL()}get value(){throw SL()}get color(){throw SL()}get left(){throw SL()}get right(){throw SL()}copy(e,t,n,r,i){return this}insert(e,t,n){return new jU(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ZU{constructor(e){this.comparator=e,this.data=new qU(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new YU(this.data.getIterator())}getIteratorFrom(e){return new YU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ZU)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ZU(this.comparator);return t.data=e,t}}class YU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const KU=new qU(lF.comparator);function QU(){return KU}const JU=new qU(lF.comparator);function XU(){return JU}const eB=new qU(lF.comparator);const tB=new ZU(lF.comparator);function nB(...e){let t=tB;for(const n of e)t=t.add(n);return t}const rB=new ZU(VL);function iB(){return rB}class sB{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,oB.createSynthesizedTargetChangeForCurrentChange(e,t)),new sB(HL.min(),n,iB(),QU(),nB())}}class oB{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new oB(JL.EMPTY_BYTE_STRING,t,nB(),nB(),nB())}}class aB{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class lB{constructor(e,t){this.targetId=e,this.M=t}}class cB{constructor(e,t,n=JL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class uB{constructor(){this.F=0,this.L=pB(),this.B=JL.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=nB(),t=nB(),n=nB();return this.L.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:SL()}}),new oB(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=pB()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class hB{constructor(e){this.et=e,this.nt=new Map,this.st=QU(),this.it=dB(),this.rt=new ZU(VL)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:SL()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((e,n)=>{this.lt(n)&&t(n)})}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(AF(e))if(0===n){const n=new lF(e.path);this.at(t,n,PF.newNoDocument(n,HL.min()))}else bL(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((n,r)=>{const i=this.wt(r);if(i){if(n.current&&AF(i.target)){const t=new lF(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,PF.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}});let n=nB();this.it.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new sB(e,t,this.rt,this.st,n);return this.st=QU(),this.it=dB(),this.rt=new ZU(VL),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new uB,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new ZU(VL),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||_L("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new uB),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function dB(){return new qU(lF.comparator)}function pB(){return new qU(lF.comparator)}const fB={asc:"ASCENDING",desc:"DESCENDING"},gB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class mB{constructor(e,t){this.databaseId=e,this.C=t}}function yB(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function vB(e,t){return e.C?t.toBase64():t.toUint8Array()}function _B(e,t){return yB(e,t.toTimestamp())}function CB(e){return bL(!!e),HL.fromTimestamp(function(e){const t=eF(e);return new zL(t.seconds,t.nanos)}(e))}function EB(e,t){return(n=e,new ZL(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function wB(e){const t=ZL.fromString(e);return bL(zB(t)),t}function SB(e,t){return EB(e.databaseId,t.path)}function bB(e,t){const n=wB(t);if(n.get(1)!==e.databaseId.projectId)throw new TL(OL.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new TL(OL.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new lF(TB(n))}function PB(e,t){return EB(e.databaseId,t)}function OB(e){return new ZL(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function TB(e){return bL(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function IB(e,t,n){return{name:SB(e,t),fields:n.value.mapValue.fields}}function kB(e,t){return{documents:[PB(e,t.path)]}}function AB(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=PB(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=PB(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(CF(e.value))return{unaryFilter:{field:FB(e.field),op:"IS_NAN"}};if(_F(e.value))return{unaryFilter:{field:FB(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(CF(e.value))return{unaryFilter:{field:FB(e.field),op:"IS_NOT_NAN"}};if(_F(e.value))return{unaryFilter:{field:FB(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:FB(e.field),op:LB(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>{return{field:FB((t=e).field),direction:DB(t.dir)};var t})}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=(a=t.limit,e.C||oF(a)?a:{value:a});var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=RB(t.startAt)),t.endAt&&(n.structuredQuery.endAt=RB(t.endAt)),n}function MB(e){let t=function(e){const t=wB(e);return 4===t.length?ZL.emptyPath():TB(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){bL(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=NB(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new zF(UB((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,oF(t)?null:t}(n.limit));let l=null;n.startAt&&(l=xB(n.startAt));let c=null;return n.endAt&&(c=xB(n.endAt)),function(e,t,n,r,i,s,o,a){return new WF(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",l,c)}function NB(e){return e?void 0!==e.unaryFilter?[VB(e)]:void 0!==e.fieldFilter?[BB(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>NB(e)).reduce((e,t)=>e.concat(t)):SL():[]}function RB(e){return{before:e.before,values:e.position}}function xB(e){return new VF(e.values||[],!!e.before)}function DB(e){return fB[e]}function LB(e){return gB[e]}function FB(e){return{fieldPath:e.canonicalString()}}function UB(e){return KL.fromServerFormat(e.fieldPath)}function BB(e){return MF.create(UB(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return SL()}}(e.fieldFilter.op),e.fieldFilter.value)}function VB(e){switch(e.unaryFilter.op){case"IS_NAN":const t=UB(e.unaryFilter.field);return MF.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=UB(e.unaryFilter.field);return MF.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=UB(e.unaryFilter.field);return MF.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=UB(e.unaryFilter.field);return MF.create(i,"!=",{nullValue:"NULL_VALUE"});default:return SL()}}function $B(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function zB(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function HB(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=qB(t)),t=GB(e.get(n),t);return qB(t)}function GB(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function qB(e){return e+"\x01\x01"}class WB{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}WB.store="owner",WB.key="owner";class jB{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}jB.store="mutationQueues",jB.keyPath="userId";class ZB{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}ZB.store="mutations",ZB.keyPath="batchId",ZB.userMutationsIndex="userMutationsIndex",ZB.userMutationsKeyPath=["userId","batchId"];class YB{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,HB(t)]}static key(e,t,n){return[e,HB(t),n]}}YB.store="documentMutations",YB.PLACEHOLDER=new YB;class KB{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}KB.store="remoteDocuments",KB.readTimeIndex="readTimeIndex",KB.readTimeIndexPath="readTime",KB.collectionReadTimeIndex="collectionReadTimeIndex",KB.collectionReadTimeIndexPath=["parentPath","readTime"];class QB{constructor(e){this.byteSize=e}}QB.store="remoteDocumentGlobal",QB.key="remoteDocumentGlobalKey";class JB{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}JB.store="targets",JB.keyPath="targetId",JB.queryTargetsIndexName="queryTargetsIndex",JB.queryTargetsKeyPath=["canonicalId","targetId"];class XB{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}XB.store="targetDocuments",XB.keyPath=["targetId","path"],XB.documentTargetsIndex="documentTargetsIndex",XB.documentTargetsKeyPath=["path","targetId"];class eV{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}eV.key="targetGlobalKey",eV.store="targetGlobal";class tV{constructor(e,t){this.collectionId=e,this.parent=t}}tV.store="collectionParents",tV.keyPath=["collectionId","parent"];class nV{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}nV.store="clientMetadata",nV.keyPath="clientId";class rV{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}rV.store="bundles",rV.keyPath="bundleId";class iV{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}iV.store="namedQueries",iV.keyPath="name";const sV="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oV{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&SL(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new oV((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof oV?t:oV.resolve(t)}catch(t){return oV.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):oV.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):oV.reject(t)}static resolve(e){return new oV((t,n)=>{t(e)})}static reject(e){return new oV((t,n)=>{n(e)})}static waitFor(e){return new oV((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=oV.resolve(!1);for(const n of e)t=t.next(e=>e?oV.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}function aV(e){return"IndexedDbTransactionError"===e.name}class lV{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&IU(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&kU(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&kU(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(HL.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nB())}isEqual(e){return this.batchId===e.batchId&&$L(this.mutations,e.mutations,(e,t)=>MU(e,t))&&$L(this.baseMutations,e.baseMutations,(e,t)=>MU(e,t))}}class cV{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){bL(e.mutations.length===n.length);let r=eB;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new cV(e,t,n,r)}}class uV{constructor(e,t,n,r,i=HL.min(),s=HL.min(),o=JL.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new uV(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new uV(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new uV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class hV{constructor(e){this.Gt=e}}function dV(e){const t=MB({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?tU(t,t.limit,"L"):t}class pV{constructor(){this.zt=new fV}addToCollectionParentIndex(e,t){return this.zt.add(t),oV.resolve()}getCollectionParents(e,t){return oV.resolve(this.zt.getEntries(t))}}class fV{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ZU(ZL.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ZU(ZL.comparator)).toArray()}}class gV{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new gV(e,gV.DEFAULT_COLLECTION_PERCENTILE,gV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}gV.DEFAULT_COLLECTION_PERCENTILE=10,gV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gV.DEFAULT=new gV(41943040,gV.DEFAULT_COLLECTION_PERCENTILE,gV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gV.DISABLED=new gV(-1,0,0);class mV{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new mV(0)}static re(){return new mV(-1)}}function yV(e){return vV.apply(this,arguments)}function vV(){return(vV=Pw(function*(e){if(e.code!==OL.FAILED_PRECONDITION||e.message!==sV)throw e;_L("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class _V{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){qL(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return WL(this.inner)}}class CV{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.bn(e,t,n))}bn(e,t,n){return this.Je.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}vn(e,t){return this.Je.getEntries(e,t).next(t=>this.Vn(e,t).next(()=>t))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return lF.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.Sn(e,t.path):JF(t)?this.Dn(e,t,n):this.Cn(e,t,n);var r}Sn(e,t){return this.Rn(e,new lF(t)).next(e=>{let t=XU();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Dn(e,t,n){const r=t.collectionGroup;let i=XU();return this.Jt.getCollectionParents(e,r).next(s=>oV.forEach(s,s=>{const o=(a=t,l=s.child(r),new WF(l,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,l;return this.Cn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Nn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=PF.newInvalidDocument(n),r=r.insert(n,i)),kU(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{sU(t,n)||(r=r.remove(e))}),r))}Nn(e,t,n){let r=nB();for(const s of t)for(const e of s.mutations)e instanceof xU&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class EV{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=nB(),r=nB();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new EV(e,t.fromCache,n,r)}}class wV{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(HL.min())?this.Fn(e,t):this.Mn.vn(e,r).next(i=>{const s=this.Ln(t,i);return(ZF(t)||YF(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(vL()<=PS.DEBUG&&_L("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),iU(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))});var i}Ln(e,t){let n=new ZU(oU(e));return t.forEach((t,r)=>{sU(e,r)&&(n=n.add(r))}),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return vL()<=PS.DEBUG&&_L("QueryEngine","Using full collection scan to execute query:",iU(t)),this.Mn.getDocumentsMatchingQuery(e,t,HL.min())}}class SV{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new qU(VL),this.Kn=new _V(e=>IF(e),kF),this.jn=HL.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new CV(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function bV(e,t){return PV.apply(this,arguments)}function PV(){return(PV=Pw(function*(e,t){const n=PL(e);let r=n.An,i=n.Wn;const s=yield n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.An.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new CV(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=nB();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next(e=>({Gn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.An=r,n.Wn=i,n.Un.On(n.Wn),s})).apply(this,arguments)}function OV(e,t){const n=PL(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=oV.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);bL(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.An.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}function TV(e){const t=PL(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.He.getLastRemoteSnapshotVersion(e))}function IV(e,t){const n=PL(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach((s,a)=>{const l=i.get(a);if(!l)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.He.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);var u,h,d;t.targetMismatches.has(a)?c=c.withResumeToken(JL.EMPTY_BYTE_STRING,HL.min()).withLastLimboFreeSnapshotVersion(HL.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),h=c,d=s,(0===(u=l).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.He.updateTargetData(e,c))});let a=QU();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n,r,i){let s=nB();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=QU();return n.forEach((n,o)=>{const a=e.get(n),l=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(HL.min())?(t.removeEntry(n,l),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,l),s=s.insert(n,o)):_L("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(HL.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next(t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return oV.waitFor(o).next(()=>s.apply(e)).next(()=>n.Wn.Vn(e,a)).next(()=>a)}).then(e=>(n.qn=i,e))}function kV(e,t){const n=PL(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)))}function AV(e,t){const n=PL(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.He.getTargetData(e,t).next(i=>i?(r=i,oV.resolve(r)):n.He.allocateTargetId(e).next(i=>(r=new uV(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e})}function MV(e,t,n){return NV.apply(this,arguments)}function NV(){return(NV=Pw(function*(e,t,n){const r=PL(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!aV(o))throw o;_L("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)})).apply(this,arguments)}function RV(e,t,n){const r=PL(e);let i=HL.min(),s=nB();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=PL(e),i=r.Kn.get(n);return void 0!==i?oV.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,eU(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:HL.min(),n?s:nB())).next(e=>({documents:e,zn:s})))}class xV{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return oV.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:CB(n.createTime)}),oV.resolve()}getNamedQuery(e,t){return oV.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(n=t).name,query:dV(n.bundledQuery),readTime:CB(n.readTime)}),oV.resolve();var n}}class DV{constructor(){this.ts=new ZU(LV.es),this.ns=new ZU(LV.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new LV(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.os(new LV(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new lF(new ZL([])),n=new LV(t,e),r=new LV(t,e+1),i=[];return this.ns.forEachInRange([n,r],e=>{this.os(e),i.push(e.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new lF(new ZL([])),n=new LV(t,e),r=new LV(t,e+1);let i=nB();return this.ns.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new LV(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class LV{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return lF.comparator(e.key,t.key)||VL(e.fs,t.fs)}static ss(e,t){return VL(e.fs,t.fs)||lF.comparator(e.key,t.key)}}class FV{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new ZU(LV.es)}checkEmpty(e){return oV.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++;const s=new lV(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new LV(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return oV.resolve(s)}lookupMutationBatch(e,t){return oV.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.gs(t+1),r=n<0?0:n;return oV.resolve(this.An.length>r?this.An[r]:null)}getHighestUnacknowledgedBatchId(){return oV.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return oV.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new LV(t,0),r=new LV(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],e=>{const t=this._s(e.fs);i.push(t)}),oV.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ZU(VL);return t.forEach(e=>{const t=new LV(e,0),r=new LV(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],e=>{n=n.add(e.fs)})}),oV.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;lF.isDocumentKey(i)||(i=i.child(""));const s=new LV(new lF(i),0);let o=new ZU(VL);return this.ws.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)},s),oV.resolve(this.ys(o))}ys(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){bL(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return oV.forEach(t.mutations,r=>{const i=new LV(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ws=n})}ee(e){}containsKey(e,t){const n=new LV(t,0),r=this.ws.firstAfterOrEqual(n);return oV.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return oV.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class UV{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new qU(lF.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return oV.resolve(n?n.document.mutableCopy():PF.newInvalidDocument(t))}getEntries(e,t){let n=QU();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():PF.newInvalidDocument(e))}),oV.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=QU();const i=new lF(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||sU(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return oV.resolve(r)}Es(e,t){return oV.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new BV(this)}getSize(e){return oV.resolve(this.size)}}class BV extends class{constructor(){this.changes=new _V(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:HL.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:PF.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?oV.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)}),oV.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class VV{constructor(e){this.persistence=e,this.Is=new _V(e=>IF(e),kF),this.lastRemoteSnapshotVersion=HL.min(),this.highestTargetId=0,this.As=0,this.Rs=new DV,this.targetCount=0,this.bs=mV.ie()}forEachTarget(e,t){return this.Is.forEach((e,n)=>t(n)),oV.resolve()}getLastRemoteSnapshotVersion(e){return oV.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return oV.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),oV.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),oV.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new mV(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,oV.resolve()}updateTargetData(e,t){return this.ae(t),oV.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,oV.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),oV.waitFor(i).next(()=>r)}getTargetCount(e){return oV.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return oV.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),oV.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),oV.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),oV.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return oV.resolve(n)}containsKey(e,t){return oV.resolve(this.Rs.containsKey(t))}}class $V{constructor(e,t){this.Ps={},this.Be=new FL(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new VV(this),this.Jt=new pV,this.Je=new UV(this.Jt,e=>this.referenceDelegate.vs(e)),this.k=new hV(t),this.Ye=new xV(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new FV(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){_L("MemoryPersistence","Starting transaction:",e);const r=new zV(this.Be.next());return this.referenceDelegate.Vs(),n(r).next(e=>this.referenceDelegate.Ss(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ds(e,t){return oV.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class zV extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}{constructor(e){super(),this.currentSequenceNumber=e}}class HV{constructor(e){this.persistence=e,this.Cs=new DV,this.Ns=null}static ks(e){return new HV(e)}get xs(){if(this.Ns)return this.Ns;throw SL()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),oV.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),oV.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),oV.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return oV.forEach(this.xs,n=>{const r=lF.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return oV.or([()=>oV.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}class GV{constructor(){this.activeTargetIds=iB()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qV{constructor(){this.pi=new GV,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new GV,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class WV{Ei(e){}shutdown(){}}class jV{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){_L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){_L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const ZV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class YV{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class KV extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);_L("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then(e=>(_L("RestConnection","Received: ",e),e),t=>{throw EL("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+mL,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Ui(e,t){return`${this.Fi}/v1/${t}:${ZV[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise((i,s)=>{const o=new pL;o.listenOnce(lL.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case aL.NO_ERROR:const t=o.getResponseJson();_L("Connection","XHR received:",JSON.stringify(t)),i(t);break;case aL.TIMEOUT:_L("Connection",'RPC "'+e+'" timed out'),s(new TL(OL.DEADLINE_EXCEEDED,"Request time out"));break;case aL.HTTP_ERROR:const n=o.getStatus();if(_L("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(OL).indexOf(t)>=0?t:OL.UNKNOWN}(e.status);s(new TL(t,e.message))}else s(new TL(OL.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new TL(OL.UNAVAILABLE,"Connection failed."));break;default:SL()}}finally{_L("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=sL(),s=oL(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new hL({})),this.qi(o.initMessageHeaders,t,n),qw()||jw()||Gw().indexOf("Electron/")>=0||Zw()||Gw().indexOf("MSAppHost/")>=0||Ww()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");_L("Connection","Creating WebChannel: "+a,o);const l=i.createWebChannel(a,o);let c=!1,u=!1;const h=new YV({Vi:e=>{u?_L("Connection","Not sending because WebChannel is closed:",e):(c||(_L("Connection","Opening WebChannel transport."),l.open(),c=!0),_L("Connection","WebChannel sending:",e),l.send(e))},Si:()=>l.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return d(l,dL.EventType.OPEN,()=>{u||_L("Connection","WebChannel transport opened.")}),d(l,dL.EventType.CLOSE,()=>{u||(u=!0,_L("Connection","WebChannel transport closed"),h.Oi())}),d(l,dL.EventType.ERROR,e=>{u||(u=!0,EL("Connection","WebChannel transport errored:",e),h.Oi(new TL(OL.UNAVAILABLE,"The operation could not be completed")))}),d(l,dL.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];bL(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){_L("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=$U[e];if(void 0!==t)return GU(t)}(e),n=i.message;void 0===t&&(t=OL.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.Oi(new TL(t,n)),l.close()}else _L("Connection","WebChannel received:",n),h.Mi(n)}}),d(s,cL.STAT_EVENT,e=>{e.stat===uL.PROXY?_L("Connection","Detected buffering proxy"):e.stat===uL.NOPROXY&&_L("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.$i()},0),h}}function QV(){return"undefined"!=typeof document?document:null}function JV(e){return new mB(e,!0)}class XV{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&_L("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class e${constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new XV(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return Pw(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return Pw(function*(){if(e.lr())return e.close(0)})()}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(e,t){var n=this;return Pw(function*(){n.yr(),n.pr(),n.ur.cancel(),n.rr++,4!==e?n.ur.reset():t&&t.code===OL.RESOURCE_EXHAUSTED?(CL(t.toString()),CL("Using maximum backoff delay to prevent overloading the backend."),n.ur.Xi()):t&&t.code===OL.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Tr(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.rr===t&&this.Ir(e,n)},t=>{e(()=>{const e=new TL(OL.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)})})}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(e=>{n(()=>this.Ar(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}dr(){var e=this;this.state=5,this.ur.Zi(Pw(function*(){e.state=0,e.start()}))}Ar(e){return _L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(_L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class t$ extends e${constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:SL(),s=t.targetChange.targetIds||[],o=function(e,t){return e.C?(bL(void 0===t||"string"==typeof t),JL.fromBase64String(t||"")):(bL(void 0===t||t instanceof Uint8Array),JL.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(e){const t=void 0===e.code?OL.UNKNOWN:GU(e.code);return new TL(t,e.message||"")}(a);n=new cB(i,s,o,l||null)}else if("documentChange"in t){const r=t.documentChange,i=bB(e,r.document.name),s=CB(r.document.updateTime),o=new SF({mapValue:{fields:r.document.fields}}),a=PF.newFoundDocument(i,s,o);n=new aB(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=bB(e,r.document),s=r.readTime?CB(r.readTime):HL.min(),o=PF.newNoDocument(i,s);n=new aB([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=bB(e,r.document);n=new aB([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return SL();{const e=t.filter,r=new VU(e.count||0);n=new lB(e.targetId,r)}}var r;return n}(this.k,e),n=function(e){if(!("targetChange"in e))return HL.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?HL.min():t.readTime?CB(t.readTime):HL.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=OB(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=AF(r)?{documents:kB(e,r)}:{query:AB(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=vB(e,t.resumeToken):t.snapshotVersion.compareTo(HL.min())>0&&(n.readTime=yB(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return SL()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=OB(this.k),t.removeTarget=e,this.gr(t)}}class n$ extends e${constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(bL(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(bL(void 0!==t),e.map(e=>function(e,t){let n=CB(e.updateTime?e.updateTime:t);return n.isEqual(HL.min())&&(n=CB(t)),new bU(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=CB(e.commitTime);return this.listener.Cr(n,t)}return bL(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=OB(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof RU)n={update:IB(e,t.key,t.value)};else if(t instanceof UU)n={delete:SB(e,t.key)};else if(t instanceof xU)n={update:IB(e,t.key,t.data),updateMask:$B(t.fieldMask)};else{if(!(t instanceof BU))return SL();n={verify:SB(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof gU)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof mU)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vU)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof CU)return{fieldPath:t.field.canonicalString(),increment:n.N};throw SL()}(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:_B(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:SL()),n;var r}(this.k,e))};this.gr(t)}}class r$ extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new TL(OL.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.Bi(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===OL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new TL(OL.UNKNOWN,e.toString())})}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.ji(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===OL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new TL(OL.UNKNOWN,e.toString())})}terminate(){this.$r=!0}}class i${constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(CL(t),this.Lr=!1):_L("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class s${constructor(e,t,n,r,i){var s=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(e=>{n.enqueueAndForget(Pw(function*(){var e;m$(s)&&(_L("RemoteStore","Restarting streams for network reachability change."),yield(e=Pw(function*(e){const t=PL(e);t.Gr.add(4),yield l$(t),t.Jr.set("Unknown"),t.Gr.delete(4),yield o$(t)}),function(t){return e.apply(this,arguments)})(s))}))}),this.Jr=new i$(n,r)}}function o$(e){return a$.apply(this,arguments)}function a$(){return(a$=Pw(function*(e){if(m$(e))for(const t of e.zr)yield t(!0)})).apply(this,arguments)}function l$(e){return c$.apply(this,arguments)}function c$(){return(c$=Pw(function*(e){for(const t of e.zr)yield t(!1)})).apply(this,arguments)}function u$(e,t){const n=PL(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),g$(n)?f$(n):G$(n).lr()&&d$(n,t))}function h$(e,t){const n=PL(e),r=G$(n);n.Wr.delete(t),r.lr()&&p$(n,t),0===n.Wr.size&&(r.lr()?r._r():m$(n)&&n.Jr.set("Unknown"))}function d$(e,t){e.Yr.X(t.targetId),G$(e).Pr(t)}function p$(e,t){e.Yr.X(t),G$(e).vr(t)}function f$(e){e.Yr=new hB({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),G$(e).start(),e.Jr.Br()}function g$(e){return m$(e)&&!G$(e).hr()&&e.Wr.size>0}function m$(e){return 0===PL(e).Gr.size}function y$(e){e.Yr=void 0}function v$(e){return _$.apply(this,arguments)}function _$(){return(_$=Pw(function*(e){e.Wr.forEach((t,n)=>{d$(e,t)})})).apply(this,arguments)}function C$(e,t){return E$.apply(this,arguments)}function E$(){return(E$=Pw(function*(e,t){y$(e),g$(e)?(e.Jr.Kr(t),f$(e)):e.Jr.set("Unknown")})).apply(this,arguments)}function w$(e,t,n){return S$.apply(this,arguments)}function S$(){return(S$=Pw(function*(e,t,n){if(e.Jr.set("Online"),t instanceof cB&&2===t.state&&t.cause)try{yield(r=Pw(function*(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}),function(e,t){return r.apply(this,arguments)})(e,t)}catch(r){_L("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield b$(e,r)}else if(t instanceof aB?e.Yr.ot(t):t instanceof lB?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(HL.min()))try{const t=yield TV(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(JL.EMPTY_BYTE_STRING,n.snapshotVersion)),p$(e,t);const r=new uV(n.target,t,1,n.sequenceNumber);d$(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){_L("RemoteStore","Failed to raise snapshot:",r),yield b$(e,r)}var r})).apply(this,arguments)}function b$(e,t,n){return P$.apply(this,arguments)}function P$(){return(P$=Pw(function*(e,t,n){if(!aV(t))throw t;e.Gr.add(1),yield l$(e),e.Jr.set("Offline"),n||(n=()=>TV(e.localStore)),e.asyncQueue.enqueueRetryable(Pw(function*(){_L("RemoteStore","Retrying IndexedDB access"),yield n(),e.Gr.delete(1),yield o$(e)}))})).apply(this,arguments)}function O$(e,t){return t().catch(n=>b$(e,n,t))}function T$(e){return I$.apply(this,arguments)}function I$(){return(I$=Pw(function*(e){const t=PL(e),n=q$(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;k$(t);)try{const e=yield kV(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,A$(t,e)}catch(i){yield b$(t,i)}M$(t)&&N$(t)})).apply(this,arguments)}function k$(e){return m$(e)&&e.Qr.length<10}function A$(e,t){e.Qr.push(t);const n=q$(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function M$(e){return m$(e)&&!q$(e).hr()&&e.Qr.length>0}function N$(e){q$(e).start()}function R$(e){return x$.apply(this,arguments)}function x$(){return(x$=Pw(function*(e){q$(e).kr()})).apply(this,arguments)}function D$(e){return L$.apply(this,arguments)}function L$(){return(L$=Pw(function*(e){const t=q$(e);for(const n of e.Qr)t.Dr(n.mutations)})).apply(this,arguments)}function F$(e,t,n){return U$.apply(this,arguments)}function U$(){return(U$=Pw(function*(e,t,n){const r=e.Qr.shift(),i=cV.from(r,t,n);yield O$(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield T$(e)})).apply(this,arguments)}function B$(e,t){return V$.apply(this,arguments)}function V$(){return(V$=Pw(function*(e,t){var n;t&&q$(e).Sr&&(yield(n=Pw(function*(e,t){if(HU(n=t.code)&&n!==OL.ABORTED){const n=e.Qr.shift();q$(e).wr(),yield O$(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield T$(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),M$(e)&&N$(e)})).apply(this,arguments)}function $$(e,t){return z$.apply(this,arguments)}function z$(){return(z$=Pw(function*(e,t){const n=PL(e);n.asyncQueue.verifyOperationInProgress(),_L("RemoteStore","RemoteStore received new credentials");const r=m$(n);n.Gr.add(3),yield l$(n),r&&n.Jr.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),yield o$(n)})).apply(this,arguments)}function H$(){return(H$=Pw(function*(e,t){const n=PL(e);t?(n.Gr.delete(2),yield o$(n)):t||(n.Gr.add(2),yield l$(n),n.Jr.set("Unknown"))})).apply(this,arguments)}function G$(e){return e.Xr||(e.Xr=function(e,t,n){const r=PL(e);return r.Or(),new t$(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:v$.bind(null,e),Ni:C$.bind(null,e),br:w$.bind(null,e)}),e.zr.push(function(){var t=Pw(function*(t){t?(e.Xr.wr(),g$(e)?f$(e):e.Jr.set("Unknown")):(yield e.Xr.stop(),y$(e))});return function(e){return t.apply(this,arguments)}}())),e.Xr}function q$(e){return e.Zr||(e.Zr=function(e,t,n){const r=PL(e);return r.Or(),new n$(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:R$.bind(null,e),Ni:B$.bind(null,e),Nr:D$.bind(null,e),Cr:F$.bind(null,e)}),e.zr.push(function(){var t=Pw(function*(t){t?(e.Zr.wr(),yield T$(e)):(yield e.Zr.stop(),e.Qr.length>0&&(_L("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))});return function(e){return t.apply(this,arguments)}}())),e.Zr}class W${constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new IL,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new W$(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new TL(OL.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function j$(e,t){if(CL("AsyncQueue",`${t}: ${e}`),aV(e))return new TL(OL.UNAVAILABLE,`${t}: ${e}`);throw e}class Z${constructor(e){this.comparator=e?(t,n)=>e(t,n)||lF.comparator(t.key,n.key):(e,t)=>lF.comparator(e.key,t.key),this.keyedMap=XU(),this.sortedSet=new qU(this.comparator)}static emptySet(e){return new Z$(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Z$)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Z$;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Y${constructor(){this.eo=new qU(lF.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):SL():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,n)=>{e.push(n)}),e}}class K${constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new K$(e,t,Z$.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nU(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Q${constructor(){this.so=void 0,this.listeners=[]}}class J${constructor(){this.queries=new _V(e=>rU(e),nU),this.onlineState="Unknown",this.io=new Set}}function X$(e,t){return ez.apply(this,arguments)}function ez(){return(ez=Pw(function*(e,t){const n=PL(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Q$),i)try{s.so=yield n.onListen(r)}catch(o){const e=j$(o,`Initialization of query '${iU(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&sz(n)})).apply(this,arguments)}function tz(e,t){return nz.apply(this,arguments)}function nz(){return(nz=Pw(function*(e,t){const n=PL(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)})).apply(this,arguments)}function rz(e,t){const n=PL(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.oo(i)&&(r=!0);e.so=i}}r&&sz(n)}function iz(e,t,n){const r=PL(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function sz(e){e.io.forEach(e=>{e.next()})}class oz{constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new K$(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=K$.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class az{constructor(e){this.key=e}}class lz{constructor(e){this.key=e}}class cz{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=nB(),this.mutatedKeys=nB(),this.Ao=oU(e),this.Ro=new Z$(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new Y$,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=ZF(this.query)&&r.size===this.query.limit?r.last():null,l=YF(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=sU(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.Vo(c,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.Ao(u,a)>0||l&&this.Ao(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),ZF(this.query)||YF(this.query))for(;s.size>this.query.limit;){const e=ZF(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return SL()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc)),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new K$(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Y$,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(e=>this.To=this.To.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.To=this.To.delete(e)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=nB(),this.Ro.forEach(e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))});const t=[];return e.forEach(e=>{this.Io.has(e)||t.push(new lz(e))}),this.Io.forEach(n=>{e.has(n)||t.push(new az(n))}),t}ko(e){this.To=e.zn,this.Io=nB();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return K$.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class uz{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class hz{constructor(e){this.key=e,this.$o=!1}}class dz{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new _V(e=>rU(e),nU),this.Fo=new Map,this.Lo=new Set,this.Bo=new qU(lF.comparator),this.Uo=new Map,this.qo=new DV,this.Ko={},this.jo=new Map,this.Qo=mV.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function pz(e,t){return fz.apply(this,arguments)}function fz(){return(fz=Pw(function*(e,t){const n=$z(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=yield AV(n.localStore,eU(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=yield gz(n,t,r,"current"===s),n.isPrimaryClient&&u$(n.remoteStore,e)}return i})).apply(this,arguments)}function gz(e,t,n,r){return mz.apply(this,arguments)}function mz(){return(mz=Pw(function*(e,t,n,r){e.Go=(t,n,r)=>{return(i=Pw(function*(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=yield RV(e.localStore,t.query,!1).then(({documents:e})=>t.view.Po(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Rz(e,t.targetId,o.Co),o.snapshot}),function(e,t,n,r){return i.apply(this,arguments)})(e,t,n,r);var i};const i=yield RV(e.localStore,t,!0),s=new cz(t,i.zn),o=s.Po(i.documents),a=oB.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),l=s.applyChanges(o,e.isPrimaryClient,a);Rz(e,n,l.Co);const c=new uz(t,n,s);return e.Mo.set(t,c),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),l.snapshot})).apply(this,arguments)}function yz(e,t){return vz.apply(this,arguments)}function vz(){return(vz=Pw(function*(e,t){const n=PL(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter(e=>!nU(e,t))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield MV(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),h$(n.remoteStore,r.targetId),Mz(n,r.targetId)}).catch(yV))):(Mz(n,r.targetId),yield MV(n.localStore,r.targetId,!0))})).apply(this,arguments)}function _z(){return(_z=Pw(function*(e,t,n){const r=zz(e);try{const e=yield function(e,t){const n=PL(e),r=zL.now(),i=t.reduce((e,t)=>e.add(t.key),nB());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Wn.vn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=AU(e,s.get(e.key));null!=t&&o.push(new xU(e.key,t,bF(t.value.mapValue),PU.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new qU(VL)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),yield Lz(r,e.changes),yield T$(r.remoteStore)}catch(i){const e=j$(i,"Failed to persist write");n.reject(e)}})).apply(this,arguments)}function Cz(e,t){return Ez.apply(this,arguments)}function Ez(){return(Ez=Pw(function*(e,t){const n=PL(e);try{const e=yield IV(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Uo.get(t);r&&(bL(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?bL(r.$o):e.removedDocuments.size>0&&(bL(r.$o),r.$o=!1))}),yield Lz(n,e,t)}catch(r){yield yV(r)}})).apply(this,arguments)}function wz(e,t,n){const r=PL(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=PL(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)}),r&&sz(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Sz(e,t,n){return bz.apply(this,arguments)}function bz(){return(bz=Pw(function*(e,t,n){const r=PL(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new qU(lF.comparator);e=e.insert(s,PF.newNoDocument(s,HL.min()));const n=nB().add(s),i=new sB(HL.min(),new Map,new ZU(VL),e,n);yield Cz(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),Dz(r)}else yield MV(r.localStore,t,!1).then(()=>Mz(r,t,n)).catch(yV)})).apply(this,arguments)}function Pz(e,t){return Oz.apply(this,arguments)}function Oz(){return(Oz=Pw(function*(e,t){const n=PL(e),r=t.batch.batchId;try{const e=yield OV(n.localStore,t);Az(n,r,null),kz(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Lz(n,e)}catch(i){yield yV(i)}})).apply(this,arguments)}function Tz(e,t,n){return Iz.apply(this,arguments)}function Iz(){return(Iz=Pw(function*(e,t,n){const r=PL(e);try{const e=yield function(e,t){const n=PL(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.An.lookupMutationBatch(e,t).next(t=>(bL(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t))).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(r.localStore,t);Az(r,t,n),kz(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield Lz(r,e)}catch(i){yield yV(i)}})).apply(this,arguments)}function kz(e,t){(e.jo.get(t)||[]).forEach(e=>{e.resolve()}),e.jo.delete(t)}function Az(e,t,n){const r=PL(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function Mz(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach(t=>{e.qo.containsKey(t)||Nz(e,t)})}function Nz(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(h$(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Dz(e))}function Rz(e,t,n){for(const r of n)r instanceof az?(e.qo.addReference(r.key,t),xz(e,r)):r instanceof lz?(_L("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||Nz(e,r.key)):SL()}function xz(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(_L("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Dz(e))}function Dz(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new lF(ZL.fromString(t)),r=e.Qo.next();e.Uo.set(r,new hz(n)),e.Bo=e.Bo.insert(n,r),u$(e.remoteStore,new uV(eU(jF(n.path)),r,2,FL.I))}}function Lz(e,t,n){return Fz.apply(this,arguments)}function Fz(){return(Fz=Pw(function*(e,t,n){const r=PL(e),i=[],s=[],o=[];var a;r.Mo.isEmpty()||(r.Mo.forEach((e,a)=>{o.push(r.Go(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=EV.$n(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),r.Oo.br(i),yield(a=Pw(function*(e,t){const n=PL(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>oV.forEach(t,t=>oV.forEach(t.kn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>oV.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!aV(r))throw r;_L("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.qn.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.qn=n.qn.insert(e,r)}}}),function(e,t){return a.apply(this,arguments)})(r.localStore,s))})).apply(this,arguments)}function Uz(e,t){return Bz.apply(this,arguments)}function Bz(){return(Bz=Pw(function*(e,t){const n=PL(e);if(!n.currentUser.isEqual(t)){_L("SyncEngine","User change. New user:",t.toKey());const e=yield bV(n.localStore,t);n.currentUser=t,(r=n).jo.forEach(e=>{e.forEach(e=>{e.reject(new TL(OL.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.jo.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield Lz(n,e.Gn)}var r})).apply(this,arguments)}function Vz(e,t){const n=PL(e),r=n.Uo.get(t);if(r&&r.$o)return nB().add(r.key);{let e=nB();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}function $z(e){const t=PL(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Cz.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vz.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sz.bind(null,t),t.Oo.br=rz.bind(null,t.eventManager),t.Oo.zo=iz.bind(null,t.eventManager),t}function zz(e){const t=PL(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Pz.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Tz.bind(null,t),t}class Hz{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return Pw(function*(){t.k=JV(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return function(e,t,n,r){return new SV(e,t,n,r)}(this.persistence,new wV,e.initialUser,this.k)}Yo(e){return new $V(HV.ks,this.k)}Jo(e){return new qV}terminate(){var e=this;return Pw(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Gz{initialize(e,t){var n=this;return Pw(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>wz(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=Uz.bind(null,n.syncEngine),yield function(e,t){return H$.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new J$}createDatastore(e){const t=JV(e.databaseInfo.databaseId),n=new KV(e.databaseInfo);return new r$(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>wz(this.syncEngine,e,0),s=jV.Pt()?new jV:new WV,new s$(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new dz(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=Pw(function*(e){const t=PL(e);_L("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),yield l$(t),t.Hr.shutdown(),t.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class qz{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Wz{constructor(e,t,n,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=gL.UNAUTHENTICATED,this.clientId=BL.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var e=Pw(function*(e){_L("FirestoreClient","Received user=",e.uid),yield i.authCredentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(n,e=>(_L("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}getConfiguration(){var e=this;return Pw(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new TL(OL.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new IL;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Pw(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const e=j$(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function jz(e,t){return Zz.apply(this,arguments)}function Zz(){return(Zz=Pw(function*(e,t){e.asyncQueue.verifyOperationInProgress(),_L("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(function(){var e=Pw(function*(e){r.isEqual(e)||(yield bV(t.localStore,e),r=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function Yz(e,t){return Kz.apply(this,arguments)}function Kz(){return(Kz=Pw(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield Qz(e);_L("FirestoreClient","Initializing OnlineComponentProvider");const r=yield e.getConfiguration();yield t.initialize(n,r),e.setCredentialChangeListener(e=>$$(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>$$(t.remoteStore,n)),e.onlineComponents=t})).apply(this,arguments)}function Qz(e){return Jz.apply(this,arguments)}function Jz(){return(Jz=Pw(function*(e){return e.offlineComponents||(_L("FirestoreClient","Using default OfflineComponentProvider"),yield jz(e,new Hz)),e.offlineComponents})).apply(this,arguments)}function Xz(e){return eH.apply(this,arguments)}function eH(){return(eH=Pw(function*(e){return e.onlineComponents||(_L("FirestoreClient","Using default OnlineComponentProvider"),yield Yz(e,new Gz)),e.onlineComponents})).apply(this,arguments)}function tH(e){return nH.apply(this,arguments)}function nH(){return(nH=Pw(function*(e){const t=yield Xz(e),n=t.eventManager;return n.onListen=pz.bind(null,t.syncEngine),n.onUnlisten=yz.bind(null,t.syncEngine),n})).apply(this,arguments)}class rH{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class iH{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iH&&e.projectId===this.projectId&&e.database===this.database}}const sH=new Map;function oH(e,t,n){if(!n)throw new TL(OL.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function aH(e){if(!lF.isDocumentKey(e))throw new TL(OL.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function lH(e){if(lF.isDocumentKey(e))throw new TL(OL.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function cH(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":SL()}function uH(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new TL(OL.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=cH(e);throw new TL(OL.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class hH{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new TL(OL.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new TL(OL.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new TL(OL.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dH{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hH({}),this._settingsFrozen=!1,e instanceof iH?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new TL(OL.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iH(e.options.projectId)}(e))}get app(){if(!this._app)throw new TL(OL.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new TL(OL.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hH(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new AL;switch(e.type){case"gapi":const t=e.client;return bL(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new xL(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new TL(OL.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=sH.get(e);t&&(_L("ComponentProvider","Removing Datastore"),sH.delete(e),t.terminate())}(this),Promise.resolve()}}function pH(e,t,n,r={}){var i;const s=(e=uH(e,dH))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&EL("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=gL.MOCK_USER;else{t=Hw(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new TL(OL.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new gL(s)}e._authCredentials=new ML(new kL(t,n))}}class fH{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mH(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fH(this.firestore,e,this._key)}}class gH{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gH(this.firestore,e,this._query)}}class mH extends gH{constructor(e,t,n){super(e,t,jF(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fH(this.firestore,null,new lF(e))}withConverter(e){return new mH(this.firestore,e,this._path)}}function yH(e,t,...n){if(e=_S(e),oH("collection","path",t),e instanceof dH){const r=ZL.fromString(t,...n);return lH(r),new mH(e,null,r)}{if(!(e instanceof fH||e instanceof mH))throw new TL(OL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ZL.fromString(t,...n));return lH(r),new mH(e.firestore,null,r)}}function vH(e,t,...n){if(e=_S(e),1===arguments.length&&(t=BL.A()),oH("doc","path",t),e instanceof dH){const r=ZL.fromString(t,...n);return aH(r),new fH(e,null,new lF(r))}{if(!(e instanceof fH||e instanceof mH))throw new TL(OL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ZL.fromString(t,...n));return aH(r),new fH(e.firestore,e instanceof mH?e.converter:null,new lF(r))}}class _H{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new XV(this,"async_queue_retry"),this.bc=()=>{const e=QV();e&&_L("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=QV();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=QV();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new IL;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}Vc(){var e=this;return Pw(function*(){if(0!==e.gc.length){try{yield e.gc[0](),e.gc.shift(),e.ur.reset()}catch(t){if(!aV(t))throw t;_L("AsyncQueue","Operation failed with retryable error: "+t)}e.gc.length>0&&e.ur.Zi(()=>e.Vc())}})()}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(e=>{throw this.Ec=e,this.Ic=!1,CL("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ic=!1,e))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=W$.createAndSchedule(this,e,t,n,e=>this.Sc(e));return this.Tc.push(r),r}Pc(){this.Ec&&SL()}verifyOperationInProgress(){}Dc(){var e=this;return Pw(function*(){let t;do{t=e.mc,yield t}while(t!==e.mc)})()}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function CH(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class EH extends dH{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new _H,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||bH(this),this._firestoreClient.terminate()}}function wH(e=qS()){return VS(e,"firestore").getImmediate()}function SH(e){return e._firestoreClient||bH(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function bH(e){var t;const n=e._freezeSettings(),r=(i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new rH(e._databaseId,i,e._persistenceKey,(s=n).host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));var i,s;e._firestoreClient=new Wz(e._authCredentials,e._appCheckCredentials,e._queue,r)}class PH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new TL(OL.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new KL(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class OH{constructor(e){this._byteString=e}static fromBase64String(e){try{return new OH(JL.fromBase64String(e))}catch(t){throw new TL(OL.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new OH(JL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class TH{constructor(e){this._methodName=e}}class IH{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new TL(OL.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new TL(OL.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return VL(this._lat,e._lat)||VL(this._long,e._long)}}const kH=/^__.*__$/;class AH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new xU(e,this.data,this.fieldMask,t,this.fieldTransforms):new RU(e,this.data,t,this.fieldTransforms)}}class MH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new xU(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function NH(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw SL()}}class RH{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new RH(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return WH(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(NH(this.$c)&&kH.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class xH{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||JV(e)}Qc(e,t,n,r=!1){return new RH({$c:e,methodName:t,jc:n,path:KL.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function DH(e){const t=e._freezeSettings(),n=JV(e._databaseId);return new xH(e._databaseId,!!t.ignoreUndefinedProperties,n)}function LH(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);zH("Data must be an object, but it was:",o,r);const a=VH(r,o);let l,c;if(s.merge)l=new QL(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=HH(t,r,n);if(!o.contains(i))throw new TL(OL.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);jH(e,i)||e.push(i)}l=new QL(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new AH(new SF(a),l,c)}class FH extends TH{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof FH}}class UH extends TH{_toFieldTransform(e){return new SU(e.path,new gU)}isEqual(e){return e instanceof UH}}function BH(e,t){if($H(e=_S(e)))return zH("Unsupported field value:",t,e),VH(e,t);if(e instanceof TH)return function(e,t){if(!NH(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=BH(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=_S(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return uU(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=zL.fromDate(e);return{timestampValue:yB(t.k,n)}}if(e instanceof zL){const n=new zL(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:yB(t.k,n)}}if(e instanceof IH)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof OH)return{bytesValue:vB(t.k,e._byteString)};if(e instanceof fH){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:EB(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${cH(e)}`)}(e,t)}function VH(e,t){const n={};return WL(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):qL(e,(e,r)=>{const i=BH(r,t.Mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function $H(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof zL||e instanceof IH||e instanceof OH||e instanceof fH||e instanceof TH)}function zH(e,t,n){if(!$H(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=cH(n);throw t.qc("an object"===r?e+" a custom object":e+" "+r)}var r}function HH(e,t,n){if((t=_S(t))instanceof PH)return t._internalPath;if("string"==typeof t)return qH(e,t);throw WH("Field path arguments must be of type string or ",e,!1,void 0,n)}const GH=new RegExp("[~\\*/\\[\\]]");function qH(e,t,n){if(t.search(GH)>=0)throw WH(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new PH(...t.split("."))._internalPath}catch{throw WH(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function WH(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new TL(OL.INVALID_ARGUMENT,a+e+l)}function jH(e,t){return e.some(e=>e.isEqual(t))}class ZH{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new fH(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new YH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(KH("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class YH extends ZH{data(){return super.data()}}function KH(e,t){return"string"==typeof t?qH(e,t):t instanceof PH?t._internalPath:t._delegate._internalPath}class QH{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class JH extends ZH{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new XH(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(KH("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class XH extends JH{data(e={}){return super.data(e)}}class eG{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new QH(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new XH(this._firestore,this._userDataWriter,n.key,n,new QH(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new TL(OL.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new XH(e._firestore,e._userDataWriter,n.doc.key,n.doc,new QH(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new XH(e._firestore,e._userDataWriter,t.doc.key,t.doc,new QH(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:tG(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function tG(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return SL()}}function nG(e){if(YF(e)&&0===e.explicitOrderBy.length)throw new TL(OL.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rG{}function iG(e,...t){for(const n of t)e=n._apply(e);return e}class sG extends rG{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=DH(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new TL(OL.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){dG(o,s);const t=[];for(const n of o)t.push(hG(r,e,n));a={arrayValue:{values:t}}}else a=hG(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||dG(o,s),a=function(e,t,n,r=!1){return BH(n,e.Qc(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);const l=MF.create(i,s,a);return function(e,t){if(t.V()){const n=QF(e);if(null!==n&&!n.isEqual(t.field))throw new TL(OL.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=KF(e);null!==r&&pG(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new TL(OL.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,l),l}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new gH(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new WF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function oG(e,t,n){const r=t,i=KH("where",e);return new sG(i,r,n)}class aG extends rG{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new TL(OL.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new TL(OL.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new zF(t,n);return function(e,t){if(null===KF(e)){const n=QF(e);null!==n&&pG(0,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new gH(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new WF(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function lG(e,t="asc"){const n=t,r=KH("orderBy",e);return new aG(r,n)}class cG extends rG{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new gH(e.firestore,e.converter,tU(e._query,this.Xc,this.Zc))}}function uG(e){return function(e,t){if(t<=0)throw new TL(OL.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),new cG("limit",e,"F")}function hG(e,t,n){if("string"==typeof(n=_S(n))){if(""===n)throw new TL(OL.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!JF(t)&&-1!==n.indexOf("/"))throw new TL(OL.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ZL.fromString(n));if(!lF.isDocumentKey(r))throw new TL(OL.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mF(e,new lF(r))}if(n instanceof fH)return mF(e,n._key);throw new TL(OL.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${cH(n)}.`)}function dG(e,t){if(!Array.isArray(e)||0===e.length)throw new TL(OL.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new TL(OL.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function pG(e,t,n){if(!n.isEqual(t))throw new TL(OL.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function fG(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function gG(e){e=uH(e,fH);const t=uH(e.firestore,EH);return function(e,t,n={}){const r=new IL;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n,r,i){const s=new qz({next:s=>{t.enqueueAndForget(()=>tz(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new TL(OL.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new TL(OL.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new oz(jF(n.path),s,{includeMetadataChanges:!0,wo:!0});return X$(e,o)}(yield tH(e),e.asyncQueue,t,n,r)})),r.promise}(SH(t),e._key).then(n=>bG(t,e,n))}class mG extends class{convertValue(e,t="none"){switch(cF(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tF(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nF(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw SL()}}convertObject(e,t){const n={};return qL(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new IH(tF(e.latitude),tF(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=iF(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(sF(e));default:return null}}convertTimestamp(e){const t=eF(e);return new zL(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ZL.fromString(e);bL(zB(n));const r=new iH(n.get(1),n.get(3)),i=new lF(n.popFirst(5));return r.isEqual(t)||CL(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new OH(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fH(this.firestore,null,t)}}function yG(e){e=uH(e,gH);const t=uH(e.firestore,EH),n=SH(t),r=new mG(t);return nG(e._query),function(e,t,n={}){const r=new IL;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n,r,i){const s=new qz({next:n=>{t.enqueueAndForget(()=>tz(e,o)),n.fromCache&&"server"===r.source?i.reject(new TL(OL.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new oz(n,s,{includeMetadataChanges:!0,wo:!0});return X$(e,o)}(yield tH(e),e.asyncQueue,t,n,r)})),r.promise}(n,e._query).then(n=>new eG(t,r,e,n))}function vG(e,t,n){e=uH(e,fH);const r=uH(e.firestore,EH),i=fG(e.converter,t,n);return SG(r,[LH(DH(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,PU.none())])}function _G(e,t,n,...r){e=uH(e,fH);const i=uH(e.firestore,EH),s=DH(i);let o;return o="string"==typeof(t=_S(t))||t instanceof PH?function(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[HH(t,r,n)],l=[i];if(s.length%2!=0)throw new TL(OL.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(HH(t,s[d])),l.push(s[d+1]);const c=[],u=SF.empty();for(let d=a.length-1;d>=0;--d)if(!jH(c,a[d])){const e=a[d];let t=l[d];t=_S(t);const n=o.Bc(e);if(t instanceof FH)c.push(e);else{const r=BH(t,n);null!=r&&(c.push(e),u.set(e,r))}}const h=new QL(c);return new MH(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qc(1,t,n);zH("Data must be an object, but it was:",i,r);const s=[],o=SF.empty();qL(r,(e,r)=>{const a=qH(t,e,n);r=_S(r);const l=i.Bc(a);if(r instanceof FH)s.push(a);else{const e=BH(r,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new QL(s);return new MH(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),SG(i,[o.toMutation(e._key,PU.exists(!0))])}function CG(e){return SG(uH(e.firestore,EH),[new UU(e._key,PU.none())])}function EG(e,t){const n=uH(e.firestore,EH),r=vH(e),i=fG(e.converter,t);return SG(n,[LH(DH(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,PU.exists(!1))]).then(()=>r)}function wG(e,...t){var n,r,i;e=_S(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||CH(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(CH(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let l,c,u;if(e instanceof fH)c=uH(e.firestore,EH),u=jF(e._key.path),l={next:n=>{t[o]&&t[o](bG(c,e,n))},error:t[o+1],complete:t[o+2]};else{const n=uH(e,gH);c=uH(n.firestore,EH),u=n._query;const r=new mG(c);l={next:e=>{t[o]&&t[o](new eG(c,r,n,e))},error:t[o+1],complete:t[o+2]},nG(e._query)}return function(e,t,n,r){const i=new qz(r),s=new oz(t,i,n);return e.asyncQueue.enqueueAndForget(Pw(function*(){return X$(yield tH(e),s)})),()=>{i.nc(),e.asyncQueue.enqueueAndForget(Pw(function*(){return tz(yield tH(e),s)}))}}(SH(c),u,a,l)}function SG(e,t){return function(e,t){const n=new IL;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n){return _z.apply(this,arguments)}(yield function(e){return Xz(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(SH(e),t)}function bG(e,t,n){const r=n.docs.get(t._key),i=new mG(e);return new JH(e,i,t._key,r,new QH(n.hasPendingWrites,n.fromCache),t.converter)}function PG(){return new UH("serverTimestamp")}!function(e,t=!0){mL="9.6.6",BS(new CS("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new EH(r,new NL(e.getProvider("auth-internal")),new LL(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),jS(fL,"3.4.4",e),jS(fL,"3.4.4","esm2017")}();class OG{constructor(e){return e}}const TG=new or("angularfire2.firestore-instances");function IG(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new OG(r)}}const kG={provide:class{constructor(){return OT("firestore")}},deps:[[new Nr,TG]]},AG={provide:OG,useFactory:function(e,t){const n=PT("firestore",e,t);return n&&new OG(n)},deps:[[new Nr,TG],FT]};let MG=(()=>{class e{constructor(){jS("angularfire",ET.full,"fst")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[AG,kG]}),e})();const NG=LT(EG,!0),RG=LT(yH,!0),xG=LT(pH,!0),DG=LT(CG,!0),LG=LT(vH,!0),FG=LT(gG,!0),UG=LT(yG,!0),BG=LT(wH,!0),VG=LT(uG,!0),$G=LT(wG,!0),zG=LT(lG,!0),HG=LT(iG,!0),GG=LT(vG,!0),qG=LT(_G,!0),WG=LT(oG,!0);let jG=(()=>{class e{constructor(e,t){this.collectionName=e,this.firestore=t,this.subDAOs={};this.collection=RG(t,this.collectionName).withConverter({fromFirestore:e=>e.data(),toFirestore:e=>e})}create(e){var t=this;return Pw(function*(){return(yield NG(t.collection,e)).id})()}read(e){var t=this;return Pw(function*(){const n=yield FG(LG(t.collection,e));return n.exists()?Mw.of(Ow.getNonNullable(n.data())):Mw.empty()})()}exists(e){var t=this;return Pw(function*(){return(yield t.read(e)).isPresent()})()}update(e,t){var n=this;return Pw(function*(){return qG(LG(n.collection,e),t)})()}delete(e){return DG(LG(this.collection,e))}set(t,n){return Tw(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),GG(LG(this.collection,t),n)}subscribeToChanges(e,t){return $G(LG(this.collection,e),e=>{t(Mw.ofNullable(e.data()))})}findWhere(e,t,n){var r=this;return Pw(function*(){const i=r.constructQuery(e,t,n);return(yield UG(i)).docs.map(e=>({id:e.id,data:e.data()}))})()}observingWhere(t,n,r){const i=this.constructQuery(t,r);return $G(i,t=>{const r=[],i=[],s=[];t.docChanges().forEach(e=>{const t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":i.push(t);break;case"removed":s.push(t)}}),r.length>0&&(Tw(e.VERBOSE,"firebase gave us "+r.length+" NEW "+this.collectionName),n.onDocumentCreated(r)),i.length>0&&(Tw(e.VERBOSE,"firebase gave us "+i.length+" MODIFIED "+this.collectionName),n.onDocumentModified(i)),s.length>0&&(Tw(e.VERBOSE,"firebase gave us "+s.length+" DELETED "+this.collectionName),n.onDocumentDeleted(s))})}constructQuery(e,t,n){let r=HG(this.collection);null!=t&&(r=HG(r,zG(t))),null!=n&&(r=HG(r,VG(n)));for(const i of e)r=HG(r,WG(i[0],i[1],i[2]));return r}subCollectionDAO(t,n){const r=`${this.collection.path}/${t}/${n}`;if(r in this.subDAOs)return this.subDAOs[r];{const t=new class extends e{constructor(e){super(r,e)}}(this.firestore);return this.subDAOs[r]=t,t}}}return e.VERBOSE=!1,e})();class ZG{static success(e){return new YG(e)}static failure(e){return new KG(e)}constructor(){}equals(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&Aw(this.get(),e.get())}}class YG extends ZG{constructor(e){super(),this.value=e}isSuccess(){return!0}isFailure(){return!1}get(){return this.value}getReason(){throw new Error("Cannot get failure reason from a success")}getReasonOr(e){return e}toOptional(){return Mw.of(this.value)}toString(){return`MGPFallible.success(${this.value})`}}class KG extends ZG{constructor(e){super(),this.reason=e}isSuccess(){return!1}isFailure(){return!0}get(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}getReason(){return this.reason}getReasonOr(e){return this.getReason()}toOptional(){return Mw.empty()}toString(){return`MGPFallible.failure(${this.reason})`}}class QG{constructor(e){this.reason=e}static ofFallible(e){return e.isSuccess()?QG.SUCCESS:QG.failure(e.getReason())}static failure(e){return new QG(e)}isFailure(){return!1===this.isSuccess()}isSuccess(){return null==this.reason}getReason(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}toFallible(e){return this.isSuccess()?ZG.success(e):ZG.failure(this.getReason())}toFailedFallible(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return ZG.failure(this.getReason())}}QG.SUCCESS=new QG(null);let JG=(()=>{class e extends jG{constructor(e){super("errors",e)}findErrors(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}return e.\u0275fac=function(t){return new(t||e)(Or(OG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var XG=n(5378);let eq=(()=>{class e{infoMessage(e){this.message(e,"is-info")}gameMessage(e){this.message(e,"is-warning")}criticalMessage(e){this.message(e,"is-danger")}message(e,t){(0,XG.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class tq{constructor(e,t,n){this.errorDAO=e,this.router=t,this.messageDisplayer=n,tq.setSingletonInstance(this)}static setSingletonInstance(e){tq.singleton=Mw.of(e)}static logErrorAndFail(e,t,n){throw tq.logError(e,t,n),new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`)}static logError(e,t,n){if(this.singleton.isAbsent())throw new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`);return this.singleton.get().logError(e,t,n),QG.failure(e+": "+t)}logError(e,t,n){var r=this;return Pw(function*(){r.messageDisplayer.criticalMessage($localize`An unexpected error was encountered. We have logged it and will try to fix its cause as soon as possible.`);const i=r.router.url,s=yield r.errorDAO.findErrors(e,i,t,n);if(0===s.length){const s={component:e,route:i,message:t,firstEncounter:PG(),lastEncounter:PG(),occurences:1};null!=n&&(s.data=n),yield r.errorDAO.create(s)}else{const e=s[0].id,t=s[0].data;yield r.errorDAO.update(e,{lastEncounter:PG(),occurences:t.occurences+1})}})()}}function nq(e,t){if(!1===e)throw tq.logError("Assertion failure",t),new Error(`Assertion failure: ${t}`)}tq.singleton=Mw.empty(),tq.\u0275fac=function(e){return new(e||tq)(Or(JG),Or(f_),Or(eq))},tq.\u0275prov=Se({token:tq,factory:tq.\u0275fac,providedIn:"root"});class rq{constructor(e){this.value=e}}rq.HARD_DRAW=new rq(0),rq.RESIGN=new rq(1),rq.ESCAPE=new rq(2),rq.VICTORY=new rq(3),rq.TIMEOUT=new rq(4),rq.UNACHIEVED=new rq(5),rq.AGREED_DRAW_BY_ZERO=new rq(6),rq.AGREED_DRAW_BY_ONE=new rq(7);class iq{constructor(e,t){this.id=e,this.data=t}getTurn(){return this.data.turn}isHardDraw(){return this.data.result===rq.HARD_DRAW.value}isAgreedDraw(){return this.data.result===rq.AGREED_DRAW_BY_ZERO.value||this.data.result===rq.AGREED_DRAW_BY_ONE.value}getDrawAccepter(){return this.data.result===rq.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(nq(this.data.result===rq.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),Ow.getNonNullable(this.data.playerOne))}isWin(){return this.data.result===rq.VICTORY.value}isTimeout(){return this.data.result===rq.TIMEOUT.value}isResign(){return this.data.result===rq.RESIGN.value}getWinner(){return Mw.ofNullable(this.data.winner)}getLoser(){return Mw.ofNullable(this.data.loser)}setWinnerAndLoser(e,t){return new iq(this.id,{...this.data,winner:e,loser:t})}}let sq=(()=>{class e extends jG{constructor(t){super("parties",t),Tw(e.VERBOSE,"PartDAO.constructor")}updateAndBumpIndex(e,t,n,r){var i=this;return Pw(function*(){return r={...r,lastUpdate:{index:n+1,player:t.value}},i.update(e,r)})()}observeActiveParts(e){return this.observingWhere([["result","==",rq.UNACHIEVED.value]],e)}userHasActivePart(e){var t=this;return Pw(function*(){const n=yield t.findWhere([["playerZero","==",e],["result","==",rq.UNACHIEVED.value]]),r=yield t.findWhere([["playerOne","==",e],["result","==",rq.UNACHIEVED.value]]);return n.length>0||r.length>0})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(OG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),oq=(()=>{class e extends jG{constructor(t){super("chats",t),Tw(e.VERBOSE,"ChatDAO.constructor")}addMessage(e,t){var n=this;return Pw(function*(){return n.subCollectionDAO(e,"messages").create(t)})()}getLastMessages(e,t){var n=this;return Pw(function*(){return n.subCollectionDAO(e,"messages").findWhere([],"postedTime",t)})()}subscribeToMessages(e,t){return this.subCollectionDAO(e,"messages").observingWhere([],t,"postedTime")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(OG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),aq=(()=>{class e{}return e.CANNOT_SEND_MESSAGE=()=>$localize`You're not allowed to send a message here.`,e.FORBIDDEN_MESSAGE=()=>$localize`This message is forbidden.`,e})(),lq=(()=>{class e{constructor(t){this.chatDAO=t,this.followedChatId=Mw.empty(),Tw(e.VERBOSE,"ChatService.constructor")}startObserving(t,n){Tw(e.VERBOSE,"ChatService.startObserving "+t),this.followedChatId.isAbsent()?(Tw(e.VERBOSE,"[start watching chat "+t),this.followedChatId=Mw.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToMessages(t,n)):this.followedChatId.equalsValue(t)?tq.logErrorAndFail("ChatService","Already observing same chat",{chatId:t}):tq.logErrorAndFail("ChatService","Already observing another chat",{chatId:t,followedChatId:this.followedChatId.get()})}stopObserving(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");Tw(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=Mw.empty(),this.followedChatUnsubscribe()}isObserving(){return this.followedChatId.isPresent()}deleteChat(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)})()}createNewChat(e){var t=this;return Pw(function*(){return t.chatDAO.set(e,{})})()}sendMessage(e,t,n){var r=this;return Pw(function*(){if(r.followedChatId.isAbsent())return QG.failure("Cannot send message if not observing chat");const i=r.followedChatId.get();if(!1===r.userCanSendMessage(e.name,i))return QG.failure(aq.CANNOT_SEND_MESSAGE());if(r.isForbiddenMessage(t))return QG.failure(aq.FORBIDDEN_MESSAGE());const s={content:t,sender:e,postedTime:PG(),currentTurn:n};return yield r.chatDAO.addMessage(i,s),QG.SUCCESS})()}userCanSendMessage(e,t){return""!==e}isForbiddenMessage(e){return""===e}ngOnDestroy(){this.isObserving()&&this.stopObserving()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(oq))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class cq{constructor(e,t,n){this.onDocumentCreated=e,this.onDocumentModified=t,this.onDocumentDeleted=n}}let uq=(()=>{class e extends jG{constructor(t){super(e.COLLECTION_NAME,t),Tw(e.VERBOSE,"UserDAO.constructor")}usernameIsAvailable(e){var t=this;return Pw(function*(){return 0===(yield t.findWhere([["username","==",e]])).length})()}setUsername(e,t){var n=this;return Pw(function*(){yield n.update(e,{username:t})})()}markVerified(e){var t=this;return Pw(function*(){yield t.update(e,{verified:!0})})()}observeUserByUsername(e,t){return this.observingWhere([["username","==",e]],t)}observeActiveUsers(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}updatePresenceToken(e){return this.update(e,{last_changed:PG()})}}return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(Or(OG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),hq=(()=>{class e{constructor(e){this.userDAO=e,this.activeUsersBS=new Em([]),this.activeUsersObs=this.activeUsersBS.asObservable()}startObserving(){Tw(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");const t=new cq(t=>{Tw(e.VERBOSE,"our DAO gave us "+t.length+" new user(s)");const n=this.activeUsersBS.value.concat(...t);this.activeUsersBS.next(this.sort(n))},t=>{let n=this.activeUsersBS.value;Tw(e.VERBOSE,"our DAO updated "+t.length+" user(s)");for(const e of t)n.forEach(t=>{t.id===e.id&&(t.data=e.data)}),n=this.sort(n);this.activeUsersBS.next(n)},e=>{const t=this.activeUsersBS.value.filter(t=>!e.some(e=>e.id===t.id));this.activeUsersBS.next(this.sort(t))});this.unsubscribe=this.userDAO.observeActiveUsers(t)}stopObserving(){this.unsubscribe(),this.activeUsersBS.next([])}sort(e){return e.sort((e,t)=>{const n=Ow.getNonNullable(e.data).last_changed,r=Ow.getNonNullable(n).seconds,i=Ow.getNonNullable(t.data).last_changed;return r-Ow.getNonNullable(i).seconds})}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(uq))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),dq=(()=>{class e{constructor(e,t){this.activeUsersService=e,this.userDAO=t}getActiveUsersObs(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}unSubFromActiveUsersObs(){this.activeUsersService.stopObserving()}observeUserByUsername(e,t){return this.userDAO.observeUserByUsername(e,t)}observeUser(e,t){return this.userDAO.subscribeToChanges(e,t)}getUserLastChanged(e){var t=this;return Pw(function*(){const n=yield t.userDAO.read(e);if(n.isAbsent())return Mw.empty();{const e=n.get().last_changed;return nq(null!=e,"should not receive a last_changed equal to null"),Mw.of(e)}})()}}return e.\u0275fac=function(t){return new(t||e)(Or(hq),Or(uq))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class pq extends A{constructor(e=1/0,t=1/0,n=mT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:i,_windowTime:s}=this;t||(n.push(e),!r&&n.push(i.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:r}=this,i=r.slice();for(let s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2)r=t;r&&n.splice(0,r+1)}}}const fq="@firebase/database";let gq="";class mq{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),nS(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:tS(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class yq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return iS(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const vq=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new mq(t)}}catch{}return new yq},_q=vq("localStorage"),Cq=vq("sessionStorage"),Eq=new AS("@firebase/database"),wq=function(){let e=1;return function(){return e++}}(),Sq=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,Nw(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new pS;n.update(t);const r=n.digest();return Dw.encodeByteArray(r)},bq=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=bq.apply(null,r):t+="object"==typeof r?nS(r):r,t+=" "}return t};let Pq=null,Oq=!0;const Tq=function(...e){if(!0===Oq&&(Oq=!1,null===Pq&&!0===Cq.get("logging_enabled")&&function(e,t){Nw(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Eq.logLevel=PS.VERBOSE,Pq=Eq.log.bind(Eq),t&&Cq.set("logging_enabled",!0)):"function"==typeof e?Pq=e:(Pq=null,Cq.remove("logging_enabled"))}(!0)),Pq){const t=bq.apply(null,e);Pq(t)}},Iq=function(e){return function(...t){Tq(e,...t)}},kq=function(...e){const t="FIREBASE INTERNAL ERROR: "+bq(...e);Eq.error(t)},Aq=function(...e){const t=`FIREBASE FATAL ERROR: ${bq(...e)}`;throw Eq.error(t),new Error(t)},Mq=function(...e){const t="FIREBASE WARNING: "+bq(...e);Eq.warn(t)},Nq=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Rq="[MIN_NAME]",xq="[MAX_NAME]",Dq=function(e,t){if(e===t)return 0;if(e===Rq||t===xq)return-1;if(t===Rq||e===xq)return 1;{const n=Hq(e),r=Hq(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Lq=function(e,t){return e===t?0:e<t?-1:1},Fq=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+nS(t))},Uq=function(e){if("object"!=typeof e||null===e)return nS(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=nS(t[r]),n+=":",n+=Uq(e[t[r]]);return n+="}",n},Bq=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function Vq(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const $q=function(e){Nw(!Nq(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,1-t)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()},zq=new RegExp("^-?(0*)\\d{1,10}$"),Hq=function(e){if(zq.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Gq=function(e){try{e()}catch(t){setTimeout(()=>{throw Mq("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},qq=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class Wq{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Mq(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class jq{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(Tq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Mq(e)}}let Zq=(()=>{class e{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return e.OWNER="owner",e})();const Yq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Kq="long_polling";class Qq{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=_q.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&_q.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Jq(e,t,n){let r;if(Nw("string"==typeof t,"typeof type must == string"),Nw("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Kq)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return Vq(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Xq{constructor(){this.counters_={}}incrementCounter(e,t=1){iS(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Bw(this.counters_)}}const eW={},tW={};function nW(e){const t=e.toString();return eW[t]||(eW[t]=new Xq),eW[t]}class rW{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Gq(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class iW{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Iq(e),this.stats_=nW(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Jq(t,Kq,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new rW(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sW((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Yq.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){iW.forceAllow_=!0}static forceDisallow(){iW.forceDisallow_=!0}static isAvailable(){return!(!iW.forceAllow_&&(iW.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=nS(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Lw(t),r=Bq(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=nS(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class sW{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=wq(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=sW.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){Tq("frame writing exception"),i.stack&&Tq(i.stack),Tq(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Tq("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;(!e||"loaded"===e||"complete"===e)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Tq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}let oW=null;"undefined"!=typeof MozWebSocket?oW=MozWebSocket:"undefined"!=typeof WebSocket&&(oW=WebSocket);let aW=(()=>{class e{constructor(t,n,r,i,s,o,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Iq(this.connId),this.stats_=nW(n),this.connURL=e.connectionURL_(n,o,a,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Yq.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Jq(e,"websocket",i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_q.set("previous_websocket_failure",!0);try{this.mySock=new oW(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==oW&&!e.forceDisallow_}static previouslyFailed(){return _q.isInMemoryStorage||!0===_q.get("previous_websocket_failure")}markConnectionHealthy(){_q.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=tS(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Nw(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=nS(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Bq(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e})();class lW{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[iW,aW]}initTransports_(e){const t=aW&&aW.isAvailable();let n=t&&!aW.previouslyFailed();if(e.webSocketOnly&&(t||Mq("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[aW];else{const e=this.transports_=[];for(const t of lW.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class cW{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Iq("c:"+this.id+":"),this.transportManager_=new lW(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=qq(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Fq("t",e),n=Fq("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Fq("t",e),n=Fq("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Fq("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?kq("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):kq("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Mq("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),qq(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qq(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_q.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class uW{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class hW{constructor(e){this.allowedEvents_=e,this.listeners_={},Nw(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Nw(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class dW extends hW{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!qw()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new dW}getInitialEvent(e){return Nw("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class pW{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function fW(){return new pW("")}function gW(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function mW(e){return e.pieces_.length-e.pieceNum_}function yW(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new pW(e.pieces_,t)}function vW(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function _W(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function CW(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new pW(t,0)}function EW(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof pW)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new pW(n,0)}function wW(e){return e.pieceNum_>=e.pieces_.length}function SW(e,t){const n=gW(e),r=gW(t);if(null===n)return t;if(n===r)return SW(yW(e),yW(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function bW(e,t){const n=_W(e,0),r=_W(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=Dq(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function PW(e,t){if(mW(e)!==mW(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function OW(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(mW(e)>mW(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class TW{constructor(e,t){this.errorPrefix_=t,this.parts_=_W(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=yS(this.parts_[n]);IW(this)}}function IW(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+kW(e))}function kW(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class AW extends hW{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new AW}getInitialEvent(e){return Nw("visible"===e,"Unknown event type: "+e),[this.visible_]}}const MW=1e3;let NW,RW=(()=>{class e extends uW{constructor(t,n,r,i,s,o,a,l){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=e.nextPersistentConnectionId_++,this.log_=Iq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=MW,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");AW.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&dW.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(nS(i)),Nw(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new zw,n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const r=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,r,!1,null),t.resolve(r)):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const e=this.outstandingGets_[i];void 0===e||r!==e||(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),t.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),Nw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Nw(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){const n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r};t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const o=s.d,a=s.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_("listen response",s),"ok"!==a&&this.removeListen_(r,i),t.onComplete&&t.onComplete(a,o))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&iS(e,"w")){const n=sS(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Mq(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=rS(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=rS(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Nw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{"ok"!==e.s&&this.log_("reportStats","Error sending stats: "+e.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+nS(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):kq("Unrecognized action received from server: "+nS(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Nw(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=MW,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=MW,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=MW),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return Pw(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+e.nextConnectionId_++,a=t.lastSessionId;let l=!1,c=null;const u=function(){c?c.close():(l=!0,s())};t.realtime_={close:u,sendRequest:function(e){Nw(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}};const h=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[e,n]=yield Promise.all([t.authTokenProvider_.getToken(h),t.appCheckTokenProvider_.getToken(h)]);l?Tq("getToken() completed but was canceled"):(Tq("getToken() completed. Creating connection."),t.authToken_=e&&e.accessToken,t.appCheckToken_=n&&n.token,c=new cW(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,i,s,e=>{Mq(e+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(n){t.log_("Failed to get token: "+n),l||(t.repoInfo_.nodeAdmin&&Mq(n),u())}}})()}interrupt(e){Tq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Tq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],oS(this.interruptReasons_)&&(this.reconnectDelay_=MW,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Uq(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new pW(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Tq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Tq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+gq.replace(/\./g,"-")]=1,qw()?e["framework.cordova"]=1:jw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=dW.getInstance().currentlyOnline();return oS(this.interruptReasons_)&&e}}return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e})();class xW{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new xW(e,t)}}class DW{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new xW(Rq,e),r=new xW(Rq,t);return 0!==this.compare(n,r)}minPost(){return xW.MIN}}class LW extends DW{static get __EMPTY_NODE(){return NW}static set __EMPTY_NODE(e){NW=e}compare(e,t){return Dq(e.name,t.name)}isDefinedOn(e){throw Rw("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return xW.MIN}maxPost(){return new xW(xq,NW)}makePost(e,t){return Nw("string"==typeof e,"KeyIndex indexValue must always be a string."),new xW(e,NW)}toString(){return".key"}}const FW=new LW;class UW{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let BW,VW=(()=>{class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??$W.EMPTY_NODE,this.right=s??$W.EMPTY_NODE}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return $W.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return $W.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})();class $W{constructor(e,t=$W.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $W(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,VW.BLACK,null,null))}remove(e){return new $W(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,VW.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new UW(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new UW(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new UW(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new UW(this.root_,null,this.comparator_,!0,e)}}function zW(e,t){return Dq(e.name,t.name)}function HW(e,t){return Dq(e,t)}$W.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new VW(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const GW=function(e){return"number"==typeof e?"number:"+$q(e):"string:"+e},qW=function(e){if(e.isLeafNode()){const t=e.val();Nw("string"==typeof t||"number"==typeof t||"object"==typeof t&&iS(t,".sv"),"Priority must be a string or number.")}else Nw(e===BW||e.isEmpty(),"priority of unexpected type.");Nw(e===BW||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let WW,jW,ZW,YW=(()=>{class e{constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Nw(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),qW(this.priorityNode_)}static set __childrenNodeConstructor(e){WW=e}static get __childrenNodeConstructor(){return WW}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return wW(t)?this:".priority"===gW(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const r=gW(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(Nw(".priority"!==r||1===mW(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(yW(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+GW(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?$q(this.value_):this.value_,this.lazyHash_=Sq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Nw(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return Nw(i>=0,"Unknown leaf type: "+n),Nw(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e})();const KW=new class extends DW{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Dq(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return xW.MIN}maxPost(){return new xW(xq,new YW("[PRIORITY-POST]",ZW))}makePost(e,t){const n=jW(e);return new xW(t,new YW("[PRIORITY-POST]",n))}toString(){return".priority"}},QW=Math.log(2);class JW{constructor(e){this.count=parseInt(Math.log(e+1)/QW,10),this.current_=this.count-1;const t=(e=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&t}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const XW=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new VW(a,o.node,VW.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),u=i(l+1,r);return o=e[l],a=n?n(o):o,new VW(a,o.node,VW.BLACK,c,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const c=i(s+1,a),u=e[s],h=n?n(u):u;l(new VW(h,u.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,VW.BLACK):(a(r,VW.BLACK),a(r,VW.RED))}return s}(new JW(e.length));return new $W(r||t,s)};let ej;const tj={};class nj{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Nw(tj&&KW,"ChildrenNode.ts has not been loaded"),ej=ej||new nj({".priority":tj},{".priority":KW}),ej}get(e){const t=sS(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $W?t:null}hasIndex(e){return iS(this.indexSet_,e.toString())}addIndex(e,t){Nw(e!==FW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(xW.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?XW(n,e.getCompare()):tj;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=s,new nj(c,l)}addToIndexes(e,t){const n=aS(this.indexes_,(n,r)=>{const i=sS(this.indexSet_,r);if(Nw(i,"Missing index implementation for "+r),n===tj){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(xW.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),XW(n,i.getCompare())}return tj}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new xW(e.name,r))),i.insert(e,e.node)}});return new nj(n,this.indexSet_)}removeFromIndexes(e,t){const n=aS(this.indexes_,n=>{if(n===tj)return n;{const r=t.get(e.name);return r?n.remove(new xW(e.name,r)):n}});return new nj(n,this.indexSet_)}}let rj,ij=(()=>{class e{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&qW(this.priorityNode_),this.children_.isEmpty()&&Nw(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return rj||(rj=new e(new $W(HW),null,nj.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||rj}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?rj:t}}getChild(e){const t=gW(e);return null===t?this:this.getImmediateChild(t).getChild(yW(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(Nw(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const r=new xW(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?rj:this.priorityNode_;return new e(i,o,s)}}updateChild(e,t){const n=gW(e);if(null===n)return t;{Nw(".priority"!==gW(e)||1===mW(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(yW(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(KW,(o,a)=>{n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){const e=[];for(const t in n)e[t]=n[t];return e}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+GW(this.getPriority().val())+":"),this.forEachChild(KW,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":Sq(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new xW(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new xW(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new xW(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,xW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,xW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===sj?-1:0}withIndex(t){if(t===FW||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===FW||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(KW),n=t.getIterator(KW);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===FW?null:this.indexMap_.get(e.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})();const sj=new class extends ij{constructor(){super(new $W(HW),ij.EMPTY_NODE,nj.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ij.EMPTY_NODE}isEmpty(){return!1}};function oj(e,t=null){if(null===e)return ij.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Nw(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new YW(e,oj(t));if(e instanceof Array){let n=ij.EMPTY_NODE;return Vq(e,(t,r)=>{if(iS(e,t)&&"."!==t.substring(0,1)){const e=oj(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(oj(t))}{const n=[];let r=!1;if(Vq(e,(e,t)=>{if("."!==e.substring(0,1)){const i=oj(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new xW(e,i)))}}),0===n.length)return ij.EMPTY_NODE;const i=XW(n,zW,e=>e.name,HW);if(r){const e=XW(n,KW.getCompare());return new ij(i,oj(t),new nj({".priority":e},{".priority":KW}))}return new ij(i,oj(t),nj.Default)}}Object.defineProperties(xW,{MIN:{value:new xW(Rq,ij.EMPTY_NODE)},MAX:{value:new xW(xq,sj)}}),LW.__EMPTY_NODE=ij.EMPTY_NODE,YW.__childrenNodeConstructor=ij,function(e){BW=e}(sj),function(e){ZW=e}(sj),function(e){jW=e}(oj);class aj extends DW{constructor(e){super(),this.indexPath_=e,Nw(!wW(e)&&".priority"!==gW(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Dq(e.name,t.name):i}makePost(e,t){const n=oj(e),r=ij.EMPTY_NODE.updateChild(this.indexPath_,n);return new xW(t,r)}maxPost(){const e=ij.EMPTY_NODE.updateChild(this.indexPath_,sj);return new xW(xq,e)}toString(){return _W(this.indexPath_,0).join("/")}}const lj=new class extends DW{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Dq(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return xW.MIN}maxPost(){return xW.MAX}makePost(e,t){const n=oj(e);return new xW(t,n)}toString(){return".value"}};function cj(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class uj{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=KW}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Nw(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Nw(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Rq}hasEnd(){return this.endSet_}getIndexEndValue(){return Nw(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Nw(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:xq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Nw(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===KW}copy(){const e=new uj;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function hj(e){const t={};if(e.isDefault())return t;let n;return e.index_===KW?n="$priority":e.index_===lj?n="$value":e.index_===FW?n="$key":(Nw(e.index_ instanceof aj,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=nS(n),e.startSet_&&(t.startAt=nS(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+nS(e.indexStartName_))),e.endSet_&&(t.endAt=nS(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+nS(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function dj(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==KW&&(t.i=e.index_.toString()),t}class pj extends uW{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Iq("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Nw(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=pj.getListenId_(e,n),o={};this.listens_[s]=o;const a=hj(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),sS(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=pj.getListenId_(e,t);delete this.listens_[n]}get(e){const t=hj(e._queryParams),n=e._path.toString(),r=new zw;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+uS(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=tS(o.responseText)}catch{Mq("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Mq("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class fj{constructor(){this.rootNode_=ij.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function gj(){return{value:null,children:new Map}}function mj(e,t,n){if(wW(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=gW(t);e.children.has(r)||e.children.set(r,gj()),mj(e.children.get(r),t=yW(t),n)}}function yj(e,t){if(wW(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(KW,(t,n)=>{mj(e,new pW(t),n)}),yj(e,t)}}if(e.children.size>0){const n=gW(t);return t=yW(t),e.children.has(n)&&yj(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function vj(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{vj(r,new pW(t.toString()+"/"+e),n)})}class _j{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Vq(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class Cj{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new _j(e);const n=1e4+2e4*Math.random();qq(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Vq(e,(e,r)=>{r>0&&iS(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),qq(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ej=(()=>(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Ej||(Ej={})),Ej))();function wj(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class Sj{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ej.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(wW(this.path)){if(null!=this.affectedTree.value)return Nw(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new pW(e));return new Sj(fW(),t,this.revert)}}return Nw(gW(this.path)===e,"operationForChild called for unrelated child."),new Sj(yW(this.path),this.affectedTree,this.revert)}}class bj{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ej.OVERWRITE}operationForChild(e){return wW(this.path)?new bj(this.source,fW(),this.snap.getImmediateChild(e)):new bj(this.source,yW(this.path),this.snap)}}class Pj{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ej.MERGE}operationForChild(e){if(wW(this.path)){const t=this.children.subtree(new pW(e));return t.isEmpty()?null:t.value?new bj(this.source,fW(),t.value):new Pj(this.source,fW(),t)}return Nw(gW(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Pj(this.source,yW(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Oj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(wW(e))return this.isFullyInitialized()&&!this.filtered_;const t=gW(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Tj(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Rw("Should only compare child_ events.");const r=new xW(t.childName,t.snapshotNode),i=new xW(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function Ij(e,t){return{eventCache:e,serverCache:t}}function kj(e,t,n,r){return Ij(new Oj(t,n,r),e.serverCache)}function Aj(e,t,n,r){return Ij(e.eventCache,new Oj(t,n,r))}function Mj(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Nj(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Rj;class xj{constructor(e,t=(()=>(Rj||(Rj=new $W(Lq)),Rj))()){this.value=e,this.children=t}static fromObject(e){let t=new xj(null);return Vq(e,(e,n)=>{t=t.set(new pW(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:fW(),value:this.value};if(wW(e))return null;{const n=gW(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(yW(e),t);return null!=i?{path:EW(new pW(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(wW(e))return this;{const t=gW(e),n=this.children.get(t);return null!==n?n.subtree(yW(e)):new xj(null)}}set(e,t){if(wW(e))return new xj(t,this.children);{const n=gW(e),r=(this.children.get(n)||new xj(null)).set(yW(e),t),i=this.children.insert(n,r);return new xj(this.value,i)}}remove(e){if(wW(e))return this.children.isEmpty()?new xj(null):new xj(null,this.children);{const t=gW(e),n=this.children.get(t);if(n){const r=n.remove(yW(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new xj(null):new xj(this.value,i)}return this}}get(e){if(wW(e))return this.value;{const t=gW(e),n=this.children.get(t);return n?n.get(yW(e)):null}}setTree(e,t){if(wW(e))return t;{const n=gW(e),r=(this.children.get(n)||new xj(null)).setTree(yW(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new xj(this.value,i)}}fold(e){return this.fold_(fW(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(EW(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,fW(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(wW(e))return null;{const r=gW(e),i=this.children.get(r);return i?i.findOnPath_(yW(e),EW(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,fW(),t)}foreachOnPath_(e,t,n){if(wW(e))return this;{this.value&&n(t,this.value);const r=gW(e),i=this.children.get(r);return i?i.foreachOnPath_(yW(e),EW(t,r),n):new xj(null)}}foreach(e){this.foreach_(fW(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(EW(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Dj{constructor(e){this.writeTree_=e}static empty(){return new Dj(new xj(null))}}function Lj(e,t,n){if(wW(t))return new Dj(new xj(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=SW(i,t);return s=s.updateChild(o,n),new Dj(e.writeTree_.set(i,s))}{const r=new xj(n),i=e.writeTree_.setTree(t,r);return new Dj(i)}}}function Fj(e,t,n){let r=e;return Vq(n,(e,n)=>{r=Lj(r,EW(t,e),n)}),r}function Uj(e,t){if(wW(t))return Dj.empty();{const n=e.writeTree_.setTree(t,new xj(null));return new Dj(n)}}function Bj(e,t){return null!=Vj(e,t)}function Vj(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(SW(n.path,t)):null}function $j(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(KW,(e,n)=>{t.push(new xW(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new xW(e,n.value))}),t}function zj(e,t){if(wW(t))return e;{const n=Vj(e,t);return new Dj(null!=n?new xj(n):e.writeTree_.subtree(t))}}function Hj(e){return e.writeTree_.isEmpty()}function Gj(e,t){return qj(fW(),e.writeTree_,t)}function qj(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(Nw(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=qj(EW(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(EW(e,".priority"),r)),n}}function Wj(e,t){return rZ(t,e)}function jj(e,t){if(e.snap)return OW(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&OW(EW(e.path,n),t))return!0;return!1}function Zj(e){return e.visible}function Yj(e,t,n){let r=Dj.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)OW(n,e)?(t=SW(n,e),r=Lj(r,t,s.snap)):OW(e,n)&&(t=SW(e,n),r=Lj(r,fW(),s.snap.getChild(t)));else{if(!s.children)throw Rw("WriteRecord should have .snap or .children");if(OW(n,e))t=SW(n,e),r=Fj(r,t,s.children);else if(OW(e,n))if(t=SW(e,n),wW(t))r=Fj(r,fW(),s.children);else{const e=sS(s.children,gW(t));if(e){const n=e.getChild(yW(t));r=Lj(r,fW(),n)}}}}}return r}function Kj(e,t,n,r,i){if(r||i){const s=zj(e.visibleWrites,t);return!i&&Hj(s)?n:i||null!=n||Bj(s,fW())?Gj(Yj(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(OW(e.path,t)||OW(t,e.path))},t),n||ij.EMPTY_NODE):null}{const r=Vj(e.visibleWrites,t);if(null!=r)return r;{const r=zj(e.visibleWrites,t);return Hj(r)?n:null!=n||Bj(r,fW())?Gj(r,n||ij.EMPTY_NODE):null}}}function Qj(e,t,n,r){return Kj(e.writeTree,e.treePath,t,n,r)}function Jj(e,t){return function(e,t,n){let r=ij.EMPTY_NODE;const i=Vj(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(KW,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=zj(e.visibleWrites,t);return n.forEachChild(KW,(e,t)=>{const n=Gj(zj(i,new pW(e)),t);r=r.updateImmediateChild(e,n)}),$j(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return $j(zj(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Xj(e,t,n,r){return function(e,t,n,r,i){Nw(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=EW(t,n);if(Bj(e.visibleWrites,s))return null;{const t=zj(e.visibleWrites,s);return Hj(t)?i.getChild(n):Gj(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function eZ(e,t){return function(e,t){return Vj(e.visibleWrites,t)}(e.writeTree,EW(e.treePath,t))}function tZ(e,t,n){return function(e,t,n,r){const i=EW(t,n),s=Vj(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?Gj(zj(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function nZ(e,t){return rZ(EW(e.treePath,t),e.writeTree)}function rZ(e,t){return{treePath:e,writeTree:t}}class iZ{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Nw("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Nw(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,cj(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Rw("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,cj(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const sZ=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class oZ{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Oj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return tZ(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Nj(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const l=zj(e.visibleWrites,t),c=Vj(l,fW());if(null!=c)a=c;else{if(null==n)return[];a=Gj(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function aZ(e,t,n,r,i,s){const o=t.eventCache;if(null!=eZ(r,n))return t;{let a,l;if(wW(n))if(Nw(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Nj(t),i=Jj(r,n instanceof ij?n:ij.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Qj(r,Nj(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=gW(n);if(".priority"===c){Nw(1===mW(n),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=Xj(r,n,i,l);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=yW(n);let h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Xj(r,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else h=tZ(r,c,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),c,h,u,i,s):o.getNode()}}return kj(t,a,o.isFullyInitialized()||wW(n),e.filter.filtersNodes())}}function lZ(e,t,n,r,i,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(wW(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),e,null)}else{const e=gW(n);if(!l.isCompleteForPath(n)&&mW(n)>1)return t;const i=yW(n),s=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,i,sZ,null)}const h=Aj(t,c,l.isFullyInitialized()||wW(n),u.filtersNodes());return aZ(e,h,n,i,new oZ(i,h,s),a)}function cZ(e,t,n,r,i,s,o){const a=t.eventCache;let l,c;const u=new oZ(i,t,s);if(wW(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=kj(t,c,!0,e.filter.filtersNodes());else{const i=gW(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=kj(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=yW(n),c=a.getNode().getImmediateChild(i);let h;if(wW(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===vW(s)&&e.getChild(CW(s)).isEmpty()?e:e.updateChild(s,r):ij.EMPTY_NODE}l=c.equals(h)?t:kj(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return l}function uZ(e,t){return e.eventCache.isCompleteForChild(t)}function hZ(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function dZ(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=wW(n)?r:new xj(null).setTree(n,r);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const l=hZ(0,t.serverCache.getNode().getImmediateChild(n),r);c=lZ(e,c,new pW(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!l){const l=hZ(0,t.serverCache.getNode().getImmediateChild(n),r);c=lZ(e,c,new pW(n),l,i,s,o,a)}}),c}function pZ(e,t){const n=Nj(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!wW(t)&&!n.getImmediateChild(gW(t)).isEmpty())?n.getChild(t):null}function fZ(e,t,n,r){t.type===Ej.MERGE&&null!==t.source.queryId&&(Nw(Nj(e.viewCache_),"We should always have a full cache before handling merges"),Nw(Mj(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new iZ;let o,a;if(n.type===Ej.OVERWRITE){const l=n;l.source.fromUser?o=cZ(e,t,l.path,l.snap,r,i,s):(Nw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!wW(l.path),o=lZ(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===Ej.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,l)=>{const c=EW(n,r);uZ(t,gW(c))&&(a=cZ(e,a,c,l,i,s,o))}),r.foreach((r,l)=>{const c=EW(n,r);uZ(t,gW(c))||(a=cZ(e,a,c,l,i,s,o))}),a}(e,t,l.path,l.children,r,i,s):(Nw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=dZ(e,t,l.path,l.children,r,i,a,s))}else if(n.type===Ej.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=eZ(r,n))return t;{const a=new oZ(r,t,i),l=t.eventCache.getNode();let c;if(wW(n)||".priority"===gW(n)){let n;if(t.serverCache.isFullyInitialized())n=Qj(r,Nj(t));else{const e=t.serverCache.getNode();Nw(e instanceof ij,"serverChildren would be complete if leaf node"),n=Jj(r,e)}n=n,c=e.filter.updateFullNode(l,n,s)}else{const i=gW(n);let u=tZ(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?e.filter.updateChild(l,i,u,yW(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,ij.EMPTY_NODE,yW(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Qj(r,Nj(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=eZ(r,fW()),kj(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=eZ(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(wW(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return lZ(e,t,n,l.getNode().getChild(n),i,s,a,o);if(wW(n)){let r=new xj(null);return l.getNode().forEachChild(FW,(e,t)=>{r=r.set(new pW(e),t)}),dZ(e,t,n,r,i,s,a,o)}return t}{let c=new xj(null);return r.foreach((e,t)=>{const r=EW(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))}),dZ(e,t,n,c,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==Ej.LISTEN_COMPLETE)throw Rw("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache;return aZ(e,Aj(t,s.getNode(),s.isFullyInitialized()||wW(n),s.isFiltered()),n,r,sZ,i)}(e,t,n.path,r,s)}const l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Mj(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(Mj(t)))}}(t,o,l),{viewCache:o,changes:l}}(e.processor_,i,t,n,r);return function(e,t){Nw(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),Nw(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,s.viewCache),Nw(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,function(e,t,n,r){return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),Tj(e,i,"child_removed",t,r,n),Tj(e,i,"child_added",t,r,n),Tj(e,i,"child_moved",s,r,n),Tj(e,i,"child_changed",t,r,n),Tj(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r?[r]:e.eventRegistrations_)}(e,s.changes,s.viewCache.eventCache.getNode(),null)}let gZ,mZ;function yZ(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return Nw(null!=s,"SyncTree gave us an op for an invalid query."),fZ(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(fZ(s,t,n,r));return i}}function vZ(e,t){let n=null;for(const r of e.views.values())n=n||pZ(r,t);return n}class _Z{constructor(e){this.listenProvider_=e,this.syncPointTree_=new xj(null),this.pendingWriteTree_={visibleWrites:Dj.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function CZ(e,t,n,r,i){return function(e,t,n,r,i){Nw(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Lj(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?bZ(e,new bj({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function EZ(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);Nw(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&jj(t,r.path)?i=!1:OW(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(function(e){e.visibleWrites=Yj(e.allWrites,Zj,fW()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=Uj(e.visibleWrites,r.path):Vq(r.children,t=>{e.visibleWrites=Uj(e.visibleWrites,EW(r.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new xj(null);return null!=r.snap?t=t.set(fW(),!0):Vq(r.children,e=>{t=t.set(new pW(e),!0)}),bZ(e,new Sj(r.path,t,n))}return[]}function wZ(e,t,n){return bZ(e,new bj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function SZ(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=vZ(n,SW(e,t));if(r)return r});return Kj(r,t,i,n,!0)}function bZ(e,t){return PZ(t,e.syncPointTree_,null,Wj(e.pendingWriteTree_,fW()))}function PZ(e,t,n,r){if(wW(e.path))return OZ(e,t,n,r);{const i=t.get(fW());null==n&&null!=i&&(n=vZ(i,fW()));let s=[];const o=gW(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=nZ(r,o);s=s.concat(PZ(a,l,e,t))}return i&&(s=s.concat(yZ(i,e,r,n))),s}}function OZ(e,t,n,r){const i=t.get(fW());null==n&&null!=i&&(n=vZ(i,fW()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=nZ(r,t),l=e.operationForChild(t);l&&(s=s.concat(OZ(l,i,o,a)))}),i&&(s=s.concat(yZ(i,e,r,n))),s}function TZ(e,t){return e.tagToQueryMap.get(t)}function IZ(e){const t=e.indexOf("$");return Nw(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new pW(e.substr(0,t))}}function kZ(e,t,n){const r=e.syncPointTree_.get(t);return Nw(r,"Missing sync point for query tag that we're tracking"),yZ(r,n,Wj(e.pendingWriteTree_,t),null)}class AZ{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new AZ(t)}node(){return this.node_}}class MZ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=EW(this.path_,e);return new MZ(this.syncTree_,t)}node(){return SZ(this.syncTree_,this.path_)}}const NZ=function(e,t,n){return e&&"object"==typeof e?(Nw(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?RZ(e[".sv"],t,n):"object"==typeof e[".sv"]?xZ(e[".sv"],t):void Nw(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},RZ=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Nw(!1,"Unexpected server value: "+e)}},xZ=function(e,t,n){e.hasOwnProperty("increment")||Nw(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Nw(!1,"Unexpected increment value: "+r);const i=t.node();if(Nw(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},DZ=function(e,t,n){return LZ(e,new AZ(t),n)};function LZ(e,t,n){const r=e.getPriority().val(),i=NZ(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=NZ(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new YW(s,oj(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new YW(i))),r.forEachChild(KW,(e,r)=>{const i=LZ(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class FZ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function UZ(e,t){let n=t instanceof pW?t:new pW(t),r=e,i=gW(n);for(;null!==i;){const e=sS(r.node.children,i)||{children:{},childCount:0};r=new FZ(i,r,e),n=yW(n),i=gW(n)}return r}function BZ(e){return e.node.value}function VZ(e,t){e.node.value=t,qZ(e)}function $Z(e){return e.node.childCount>0}function zZ(e,t){Vq(e.node.children,(n,r)=>{t(new FZ(n,e,r))})}function HZ(e,t,n,r){n&&!r&&t(e),zZ(e,e=>{HZ(e,t,!0,r)}),n&&r&&t(e)}function GZ(e){return new pW(null===e.parent?e.name:GZ(e.parent)+"/"+e.name)}function qZ(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===BZ(e)&&!$Z(e)}(n),i=iS(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,qZ(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,qZ(e))}(e.parent,e.name,e)}const WZ=/[\[\].#$\/\u0000-\u001F\u007F]/,jZ=/[\[\].#$\u0000-\u001F\u007F]/,ZZ=10485760,YZ=function(e){return"string"==typeof e&&0!==e.length&&!WZ.test(e)},KZ=function(e){return"string"==typeof e&&0!==e.length&&!jZ.test(e)},QZ=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Nq(e)||e&&"object"==typeof e&&iS(e,".sv")},JZ=function(e,t,n,r){r&&void 0===t||XZ(mS(e,"value"),t,n)},XZ=function(e,t,n){const r=n instanceof pW?new TW(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+kW(r));if("function"==typeof t)throw new Error(e+"contains a function "+kW(r)+" with contents = "+t.toString());if(Nq(t))throw new Error(e+"contains "+t.toString()+" "+kW(r));if("string"==typeof t&&t.length>ZZ/3&&yS(t)>ZZ)throw new Error(e+"contains a string greater than "+ZZ+" utf8 bytes "+kW(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(Vq(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!YZ(t)))throw new Error(e+" contains an invalid key ("+t+") "+kW(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=yS(t),IW(e)})(r,t),XZ(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=yS(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+kW(r)+" in addition to actual children.")}},eY=function(e,t,n,r){if(!(r&&void 0===n||KZ(n)))throw new Error(mS(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},tY=function(e,t){if(".info"===gW(t))throw new Error(e+" failed = Can't modify data under /.info/")};class nY{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rY(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null!==n&&!PW(s,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function iY(e,t,n){rY(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(sY(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>OW(e,t)||OW(t,e))}function sY(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();Pq&&Tq("event: "+n.toString()),Gq(r)}}}class oY{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new nY,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=gj(),this.transactionQueueTree_=new FZ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function aY(e){const t=e.infoData_.getNode(new pW(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function lY(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:aY(e)})}function cY(e,t,n,r,i){e.dataUpdateCount++;const s=new pW(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=aS(n,e=>oj(e));o=function(e,t,n,r){const i=TZ(e,r);if(i){const r=IZ(i),s=r.path,o=r.queryId,a=SW(s,t),l=xj.fromObject(n);return kZ(e,s,new Pj(wj(o),a,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=oj(n);o=function(e,t,n,r){const i=TZ(e,r);if(null!=i){const r=IZ(i),s=r.path,o=r.queryId,a=SW(s,t);return kZ(e,s,new bj(wj(o),a,n))}return[]}(e.serverSyncTree_,s,t,i)}else if(r){const t=aS(n,e=>oj(e));o=function(e,t,n){const r=xj.fromObject(n);return bZ(e,new Pj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=oj(n);o=wZ(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=_Y(e,s)),iY(e.eventQueue_,a,o)}function uY(e,t){hY(e,"connected",t),!1===t&&function(e){gY(e,"onDisconnectEvents");const t=lY(e),n=gj();vj(e.onDisconnect_,fW(),(r,i)=>{const s=function(e,t,n,r){return LZ(t,new MZ(n,e),r)}(r,i,e.serverSyncTree_,t);mj(n,r,s)});let r=[];vj(n,fW(),(t,n)=>{r=r.concat(wZ(e.serverSyncTree_,t,n));const i=bY(e,t);_Y(e,i)}),e.onDisconnect_=gj(),iY(e.eventQueue_,fW(),r)}(e)}function hY(e,t,n){const r=new pW("/.info/"+t),i=oj(n);e.infoData_.updateSnapshot(r,i);const s=wZ(e.infoSyncTree_,r,i);iY(e.eventQueue_,r,s)}function dY(e){return e.nextWriteId_++}function pY(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&yj(e.onDisconnect_,t),mY(0,n,r,i)})}function fY(e,t,n,r){const i=oj(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&mj(e.onDisconnect_,t,i),mY(0,r,n,s)})}function gY(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Tq(n,...t)}function mY(e,t,n,r){t&&Gq(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function yY(e,t,n){return SZ(e.serverSyncTree_,t,n)||ij.EMPTY_NODE}function vY(e,t=e.transactionQueueTree_){if(t||SY(e,t),BZ(t)){const n=EY(e,t);Nw(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=yY(e,t,r);let s=i;const o=i.hash();for(let c=0;c<n.length;c++){const e=n[c];Nw(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=SW(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,r=>{gY(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(EZ(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();SY(e,UZ(e.transactionQueueTree_,t)),vY(e,e.transactionQueueTree_),iY(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Gq(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)n[e].status=3===n[e].status?4:0;else{Mq("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}_Y(e,t)}},o)}(e,GZ(t),n)}else $Z(t)&&zZ(t,t=>{vY(e,t)})}function _Y(e,t){const n=CY(e,t),r=GZ(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],l=SW(n,a.path);let c,u=!1;if(Nw(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,c=a.abortReason,i=i.concat(EZ(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,c="maxretry",i=i.concat(EZ(e.serverSyncTree_,a.currentWriteId,!0));else{const n=yY(e,a.path,s);a.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){XZ("transaction failed: Data returned ",r,a.path);let t=oj(r);"object"==typeof r&&null!=r&&iS(r,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,l=lY(e),c=DZ(t,n,l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=c,a.currentWriteId=dY(e),s.splice(s.indexOf(o),1),i=i.concat(CZ(e.serverSyncTree_,a.path,c,a.currentWriteId,a.applyLocally)),i=i.concat(EZ(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",i=i.concat(EZ(e.serverSyncTree_,a.currentWriteId,!0))}iY(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===c?()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot):()=>t[o].onComplete(new Error(c),!1,null)))}SY(e,e.transactionQueueTree_);for(let o=0;o<r.length;o++)Gq(r[o]);vY(e,e.transactionQueueTree_)}(e,EY(e,n),r),r}function CY(e,t){let n,r=e.transactionQueueTree_;for(n=gW(t);null!==n&&void 0===BZ(r);)r=UZ(r,n),n=gW(t=yW(t));return r}function EY(e,t){const n=[];return wY(e,t,n),n.sort((e,t)=>e.order-t.order),n}function wY(e,t,n){const r=BZ(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);zZ(t,t=>{wY(e,t,n)})}function SY(e,t){const n=BZ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,VZ(t,n.length>0?n:void 0)}zZ(t,t=>{SY(e,t)})}function bY(e,t){const n=GZ(CY(e,t)),r=UZ(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{PY(e,t)}),PY(e,r),HZ(r,t=>{PY(e,t)}),n}function PY(e,t){const n=BZ(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(Nw(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(Nw(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(EZ(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?VZ(t,void 0):n.length=s+1,iY(e.eventQueue_,GZ(t),i);for(let e=0;e<r.length;e++)Gq(r[e])}}const OY=function(e,t){const n=TY(e),r=n.namespace;return"firebase.com"===n.domain&&Aq(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&Aq("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Mq("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Qq(n.host,n.secure,r,t,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new pW(n.pathString)}},TY=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch{}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Mq(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class IY{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new zw;return pY(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){tY("OnDisconnect.remove",this._path);const e=new zw;return fY(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){tY("OnDisconnect.set",this._path),JZ("OnDisconnect.set",e,this._path,!1);const t=new zw;return fY(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){tY("OnDisconnect.setWithPriority",this._path),JZ("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(Nq(t))throw new Error(mS(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!QZ(t))throw new Error(mS(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new zw;return function(e,t,n,r,i){const s=oj(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&mj(e.onDisconnect_,t,s),mY(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){tY("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=mS(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Vq(t,(e,t)=>{const r=new pW(e);if(XZ(i,t,EW(n,r)),".priority"===vW(r)&&!QZ(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=_W(r);for(let t=0;t<i.length;t++)if((".priority"!==i[t]||t!==i.length-1)&&!YZ(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(bW);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&OW(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new zw;return function(e,t,n,r){if(oS(n))return Tq("onDisconnect().update() called with empty data.  Don't do anything."),void mY(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&Vq(n,(n,r)=>{const i=oj(r);mj(e.onDisconnect_,EW(t,n),i)}),mY(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class kY{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return wW(this._path)?null:vW(this._path)}get ref(){return new AY(this._repo,this._path)}get _queryIdentifier(){const e=dj(this._queryParams),t=Uq(e);return"{}"===t?"default":t}get _queryObject(){return dj(this._queryParams)}isEqual(e){if(!((e=_S(e))instanceof kY))return!1;const t=this._repo===e._repo,n=PW(this._path,e._path);return t&&n&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class AY extends kY{constructor(e,t){super(e,t,new uj,!1)}get parent(){const e=CW(this._path);return null===e?null:new AY(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function MY(e,t){return(e=_S(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===gW((e=_S(e))._path)?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),eY(e,t,n,r)}("child","path",t,!1):eY("child","path",t,!1),new AY(e._repo,EW(e._path,t))}(e._root,t):e._root}function NY(e){return e=_S(e),new IY(e._repo,e._path)}function RY(e,t){e=_S(e),tY("set",e._path),JZ("set",t,e._path,!1);const n=new zw;return function(e,t,n,r,i){gY(e,"set",{path:t.toString(),value:n,priority:r});const s=lY(e),o=oj(n,r),a=SZ(e.serverSyncTree_,t),l=DZ(o,a,s),c=dY(e),u=CZ(e.serverSyncTree_,t,l,c,!0);rY(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||Mq("set at "+t+" failed: "+n);const o=EZ(e.serverSyncTree_,c,!s);iY(e.eventQueue_,t,o),mY(0,i,n,r)});const h=bY(e,t);_Y(e,h),iY(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}(function(e){Nw(!gZ,"__referenceConstructor has already been defined"),gZ=e})(AY),function(e){Nw(!mZ,"__referenceConstructor has already been defined"),mZ=e}(AY);const xY={};function DY(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||Aq("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Tq("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=OY(s,i),c=l.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${c.namespace}`,l=OY(s,i),c=l.repoInfo):o=!l.repoInfo.secure;const u=i&&o?new Zq(Zq.OWNER):new jq(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!YZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),KZ(e)}(n))throw new Error(mS(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",l),wW(l.path)||Aq("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=xY[t.name];i||(i={},xY[t.name]=i);let s=i[e.toURLString()];return s&&Aq("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new oY(e,false,n,r),i[e.toURLString()]=s,s}(c,e,u,new Wq(e.name,n));return new LY(h,e)}class LY{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=nW(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new pj(e.repoInfo_,(t,n,r,i)=>{cY(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>uY(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{nS(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new RW(e.repoInfo_,t,(t,n,r,i)=>{cY(e,t,n,r,i)},t=>{uY(e,t)},t=>{!function(e,t){Vq(t,(t,n)=>{hY(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return tW[n]||(tW[n]=t()),tW[n]}(e.repoInfo_,()=>new Cj(e.stats_,e.server_)),e.infoData_=new fj,e.infoSyncTree_=new _Z({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=wZ(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),hY(e,"connected",!1),e.serverSyncTree_=new _Z({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);iY(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new AY(this._repo,fW())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=xY[t];(!n||n[e.key]!==e)&&Aq(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Aq("Cannot call "+e+" on a deleted database.")}}function FY(e=qS(),t){return VS(e,"database").getImmediate({identifier:t})}function UY(e,t,n,r={}){(e=_S(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&Aq("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Aq('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Zq(Zq.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Hw(r.mockUserToken,e.app.options.projectId);s=new Zq(t)}!function(e,t,n,r){e.repoInfo_=new Qq(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}const BY={".sv":"timestamp"};function VY(){return BY}RW.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},RW.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},gq="9.6.6",BS(new CS("database",(e,{instanceIdentifier:t})=>DY(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),jS(fq,"0.12.5",void 0),jS(fq,"0.12.5","esm2017");class $Y{constructor(e){return e}}const zY=new or("angularfire2.database-instances");function HY(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new $Y(r)}}const GY={provide:class{constructor(){return OT("database")}},deps:[[new Nr,zY]]},qY={provide:$Y,useFactory:function(e,t){const n=PT("database",e,t);return n&&new $Y(n)},deps:[[new Nr,zY],FT]};let WY=(()=>{class e{constructor(){jS("angularfire",ET.full,"rtdb")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[qY,GY]}),e})();const jY=LT(UY,!0),ZY=LT(FY,!0),YY=LT(NY,!0),KY=LT(MY,!0),QY=LT(RY,!0);class JY{constructor(e){this.db=e}setOffline(e){return QY(KY(this.db,"/status/"+e),JY.OFFLINE)}launchAutomaticPresenceUpdate(e){var t=this;return Pw(function*(){const n=KY(t.db,"/status/"+e);yield QY(n,JY.ONLINE),yield YY(n).set(JY.OFFLINE)})()}}JY.OFFLINE={last_changed:VY()},JY.ONLINE={last_changed:VY()},JY.\u0275fac=function(e){return new(e||JY)(Or($Y))},JY.\u0275prov=Se({token:JY,factory:JY.\u0275fac,providedIn:"root"});class XY{static createUserWithEmailAndPassword(e,t,n){return XM(e,t,n)}static sendEmailVerification(e){return nN(e)}static sendPasswordResetEmail(e,t){return rN(e,t)}static signInWithEmailAndPassword(e,t,n){return Pw(function*(){return(yield iN(e,t,n)).user})()}static signInWithPopup(e,t){return Pw(function*(){return(yield sN(e,t)).user})()}static updateProfile(e,t){return oN(e,t)}}class eK{constructor(e,t,n,r){this.id=e,this.email=t,this.username=n,this.verified=r}isConnected(){return this.email.isPresent()}toMinimalUser(){return{id:this.id,name:this.username.get()}}}eK.NOT_CONNECTED=new eK("",Mw.empty(),Mw.empty(),!1);let tK=(()=>{class e{constructor(t,n,r){var i=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=Mw.empty(),this.userUnsubscribe=Mw.empty(),Tw(e.VERBOSE,"ConnectedUserService constructor"),this.userRS=new pq(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=tN(this.auth,function(){var t=Pw(function*(t){null==t?(Tw(e.VERBOSE,"User is not connected"),i.userUnsubscribe.isPresent()&&i.userUnsubscribe.get()(),i.userRS.next(eK.NOT_CONNECTED),i.user=Mw.empty()):(nq(i.user.isAbsent(),"ConnectedUserService received a double update for an user, this is unexpected"),yield i.connectivityDAO.launchAutomaticPresenceUpdate(t.uid),i.userUnsubscribe=Mw.of(i.userDAO.subscribeToChanges(t.uid,n=>{if(n.isPresent()){const r=n.get().username;Tw(e.VERBOSE,`User ${r} is connected, and the verified status is ${i.emailVerified(t)}`);const s=!0===i.emailVerified(t)&&null!=r;if(!0===s&&!1===n.get().verified)return i.userDAO.markVerified(t.uid);const o=new eK(t.uid,Mw.ofNullable(t.email),Mw.ofNullable(r),s);i.user=Mw.of(o),i.userRS.next(o)}})))});return function(e){return t.apply(this,arguments)}}())}emailVerified(e){return e.emailVerified}sendPasswordResetEmail(e){var t=this;return Pw(function*(){try{return yield XY.sendPasswordResetEmail(t.auth,e),QG.SUCCESS}catch(n){return QG.failure(t.mapFirebaseError(n))}})()}doRegister(t,n,r){var i=this;return Pw(function*(){return Tw(e.VERBOSE,"ConnectedUserService.doRegister("+n+")"),(yield i.userDAO.usernameIsAvailable(t))?i.registerAfterUsernameCheck(t,n,r):ZG.failure($localize`This username is already in use.`)})()}registerAfterUsernameCheck(e,t,n){var r=this;return Pw(function*(){try{const i=yield XY.createUserWithEmailAndPassword(r.auth,t,n),s=Ow.getNonNullable(i.user);return yield r.createUser(s.uid,e),ZG.success(s)}catch(i){return ZG.failure(r.mapFirebaseError(i))}})()}mapFirebaseError(e){switch(e.code){case"auth/email-already-in-use":return $localize`This email address is already in use.`;case"auth/invalid-email":return $localize`This email address is invalid.`;case"auth/user-not-found":case"auth/wrong-password":return $localize`You have entered invalid credentials.`;case"auth/invalid-credential":return $localize`The credential is invalid or has expired, please try again.`;case"auth/weak-password":return $localize`Your password is too weak, please use a stronger password.`;case"auth/too-many-requests":return $localize`There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later.`;case"auth/popup-closed-by-user":return $localize`You closed the authentication popup without finalizing your log in.`;case"auth/popup-blocked":return $localize`The authentication popup was blocked. Try again after disabling popup blocking.`;default:return tq.logError("ConnectedUserService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}sendEmailVerification(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"ConnectedUserService.sendEmailVerification()");const n=Mw.ofNullable(t.auth.currentUser);if(!n.isPresent())return tq.logError("ConnectedUserService","Unlogged users cannot request for email verification");if(t.emailVerified(n.get()))return tq.logError("ConnectedUserService","Verified users should not ask email verification after being verified");try{return yield XY.sendEmailVerification(n.get()),QG.SUCCESS}catch(r){return QG.failure(t.mapFirebaseError(r))}})()}doEmailLogin(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"ConnectedUserService.doEmailLogin("+t+")");try{return yield XY.signInWithEmailAndPassword(r.auth,t,n),QG.SUCCESS}catch(i){return QG.failure(r.mapFirebaseError(i))}})()}createUser(e,t){var n=this;return Pw(function*(){null==t?yield n.userDAO.set(e,{verified:!1}):yield n.userDAO.set(e,{username:t,verified:!1})})()}doGoogleLogin(){var e=this;return Pw(function*(){return QG.ofFallible(yield e.registerOrLoginWithGoogle())})()}registerOrLoginWithGoogle(){var e=this;return Pw(function*(){try{const t=new aA;t.addScope("profile"),t.addScope("email");const n=yield XY.signInWithPopup(e.auth,t);return!1===(yield e.userDAO.exists(n.uid))&&(yield e.createUser(n.uid)),ZG.success(n)}catch(t){return ZG.failure(e.mapFirebaseError(t))}})()}disconnect(){var e=this;return Pw(function*(){const t=Mw.ofNullable(e.auth.currentUser);if(t.isPresent()){const n=t.get().uid;return yield e.connectivityDAO.setOffline(n),yield e.auth.signOut(),QG.SUCCESS}return QG.failure("Cannot disconnect a non-connected user")})()}getUserObs(){return this.userObs}setUsername(e){var t=this;return Pw(function*(){if(""===e)return QG.failure($localize`Your username may not be empty.`);try{if(!1===(yield t.userDAO.usernameIsAvailable(e)))return QG.failure($localize`This username is already in use, please select a different one.`);const n=Ow.getNonNullable(t.auth.currentUser);return yield XY.updateProfile(n,{displayName:e}),yield t.userDAO.setUsername(n.uid,e),yield t.userDAO.markVerified(n.uid),yield t.reloadUser(),QG.SUCCESS}catch(n){return QG.failure(t.mapFirebaseError(n))}})()}setPicture(e){var t=this;return Pw(function*(){try{const n=Ow.getNonNullable(t.auth.currentUser);return yield XY.updateProfile(n,{photoURL:e}),QG.SUCCESS}catch(n){return QG.failure(t.mapFirebaseError(n))}})()}reloadUser(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.auth.currentUser);yield t.getIdToken(!0),yield t.reload()})()}updateObservedPart(e){return nq(this.user.isPresent(),"Should not call updateObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:e})}removeObservedPart(){return nq(this.user.isPresent(),"Should not call removeObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:null})}sendPresenceToken(){return nq(this.user.isPresent(),"Should not call sendPresenceToken when not connected"),this.userDAO.updatePresenceToken(this.user.get().id)}ngOnDestroy(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(uq),Or(qM),Or(JY))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class nK{constructor(e){this.value=e}static of(e){switch(e){case"CREATOR":return nK.CREATOR;case"RANDOM":return nK.RANDOM;default:return nq("CHOSEN_PLAYER"===e,"Invalid value for FirstPlayer: "+e+"."),nK.CHOSEN_PLAYER}}}nK.CREATOR=new nK("CREATOR"),nK.RANDOM=new nK("RANDOM"),nK.CHOSEN_PLAYER=new nK("CHOSEN_PLAYER");class rK{constructor(e){this.value=e}static of(e){switch(e){case"STANDARD":return rK.STANDARD;case"BLITZ":return rK.BLITZ;case"CUSTOM":return rK.CUSTOM;default:throw new Error("Invalid part type: "+e+".")}}}rK.STANDARD=new rK("STANDARD"),rK.BLITZ=new rK("BLITZ"),rK.CUSTOM=new rK("CUSTOM"),rK.NORMAL_MOVE_DURATION=120,rK.NORMAL_PART_DURATION=1800,rK.BLITZ_MOVE_DURATION=30,rK.BLITZ_PART_DURATION=900;class iK{constructor(e){this.value=e}}iK.PART_CREATED=new iK(0),iK.CONFIG_PROPOSED=new iK(2),iK.PART_STARTED=new iK(3),iK.PART_FINISHED=new iK(4);class sK{}class oK extends sK{static disjunction3(e,t,n,r,i){return new class extends oK{encodeMove(s){return r(s)?{type:"T1",encoded:e.encode(s)}:i(s)?{type:"T2",encoded:t.encode(s)}:{type:"T3",encoded:n.encode(s)}}decodeMove(r){const i=Ow.getNonNullable(r).type,s=Ow.getNonNullable(r).encoded;return"T1"===i?e.decode(s):"T2"===i?t.decode(s):n.decode(s)}}}encode(e){return this.encodeMove(e)}decode(e){return nq(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}class aK extends oK{static ofN(e,t,n){return new class extends aK{maxValue(){return e}encodeNumber(e){return t(e)}decodeNumber(e){return n(e)}}}static tuple(e,t,n){return new class extends aK{maxValue(){let t=0;return Object.keys(e).forEach(n=>{t=t*e[n].shift()+e[n].maxValue()}),t}encodeNumber(n){const r=t(n);let i=0;return Object.keys(r).forEach(t=>{i=i*e[t].shift()+e[t].encode(r[t])}),i}decodeNumber(t){const r={};let i=t;return Object.keys(e).reverse().forEach(t=>{const n=i%e[t].shift();i=(i-n)/e[t].shift(),r[t]=e[t].decode(n)}),n(r)}}}static disjunction(e,t,n){return new class extends aK{maxValue(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}encodeNumber(r){return n(r)?2*e.encodeNumber(r):2*t.encodeNumber(r)+1}decodeNumber(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}}static numberEncoder(e){return new class extends aK{maxValue(){return e}encodeNumber(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}decodeNumber(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}}shift(){return this.maxValue()+1}encodeMove(e){return this.encodeNumber(e)}decodeMove(e){return nq("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}aK.booleanEncoder=new class extends aK{maxValue(){return 1}encodeNumber(e){return e?1:0}decodeNumber(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}};class lK{constructor(){this.value=2}isPlayer(){return!1}toString(){return"PlayerNone"}equals(e){return this===e}}lK.NONE=new lK;class cK{constructor(e){this.value=e}static of(e){switch(e){case 0:return cK.ZERO;default:return Ow.expectToBe(e,1),cK.ONE}}static fromTurn(e){return e%2==0?cK.ZERO:cK.ONE}isPlayer(){return!0}toString(){return"Player "+this.value}equals(e){return this===e}getScoreModifier(){return 0===this.value?-1:1}getPreVictory(){return this.getVictoryValue()-this.getScoreModifier()}getDefeatValue(){return this===cK.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}getVictoryValue(){return this===cK.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}getOpponent(){switch(this){case cK.ZERO:return cK.ONE;default:return Ow.expectToBe(this,cK.ONE),cK.ZERO}}}var uK;cK.numberEncoder=aK.ofN(2,e=>e.value,e=>2===e?uK.NONE:cK.of(e)),cK.ZERO=new cK(0),cK.ONE=new cK(1),cK.PLAYERS=[cK.ZERO,cK.ONE],function(e){e.ZERO=cK.ZERO,e.ONE=cK.ONE,e.NONE=lK.NONE}(uK||(uK={}));class hK{static rematchAccepted(e,t){return dK("RematchAccepted",{typeGame:e,partId:t})}static getPlayer(e){return cK.of(Ow.getNonNullable(e.data).player)}static getTypeGame(e){return Ow.getNonNullable(e.data).typeGame}static getPartId(e){return Ow.getNonNullable(e.data).partId}}function dK(e,t){return{code:e,data:t}}function pK(e){return t=>dK(e,{player:t.value})}hK.drawProposed=pK("DrawProposed"),hK.drawAccepted=dK("DrawAccepted",{}),hK.drawRefused=pK("DrawRefused"),hK.takeBackAsked=pK("TakeBackAsked"),hK.takeBackRefused=pK("TakeBackRefused"),hK.takeBackAccepted=pK("TakeBackAccepted"),hK.rematchProposed=pK("RematchProposed"),hK.addTurnTime=pK("AddTurnTime"),hK.addGlobalTime=pK("AddGlobalTime");class fK{static mapBiArray(e,t){const n=[];let r=0;for(;r<e.length;){n[r]=[];let i=0;for(;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}static createTable(e,t,n){const r=[];let i=t-1;for(;i>=0;){r[i]=[];let t=e-1;for(;t>=0;)r[i][t]=n,t--;i--}return r}static copyBiArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=fK.copyImmutableArray(e[n]),n++;return t}static copyImmutableArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=e[n],n++;return t}static sortByDescending(e,t){e.sort((e,n)=>{const r=t(e),i=t(n);return r<i?1:r>i?-1:0})}static compareArray(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===Aw(e[n],t[n]))return!1;return!0}static compareTable(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===fK.compareArray(e[n],t[n]))return!1;return!0}}let gK=(()=>{class e extends jG{constructor(t){super("joiners",t),Tw(e.VERBOSE,"JoinerDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(OG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),mK=(()=>{class e{constructor(t){this.joinerDAO=t,this.joinerUnsubscribe=Mw.empty(),Tw(e.VERBOSE,"JoinerService.constructor")}subscribeToChanges(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=Mw.of(this.joinerDAO.subscribeToChanges(e,t))}unsubscribe(){nq(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=Mw.empty()}createInitialJoiner(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.createInitialJoiner("+t.id+", "+n+")"),r.set(n,{candidates:[],chosenOpponent:null,firstPlayer:nK.RANDOM.value,partType:rK.STANDARD.value,partStatus:iK.PART_CREATED.value,maximalMoveDuration:rK.NORMAL_MOVE_DURATION,totalPartDuration:rK.NORMAL_PART_DURATION,creator:t})})()}joinGame(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"JoinerService.joinGame("+t+", "+n.id+")");const i=yield r.joinerDAO.read(t);if(i.isAbsent())return QG.failure(e.GAME_DOES_NOT_EXIST());const s=fK.copyImmutableArray(i.get().candidates);return s.some(e=>e.id===n.id)?QG.failure(e.USER_ALREADY_IN_GAME()):(n.id===i.get().creator.id||(s[s.length]=n,yield r.joinerDAO.update(t,{candidates:s})),QG.SUCCESS)})()}cancelJoining(t){var n=this;return Pw(function*(){if(Tw(e.VERBOSE,"JoinerService.cancelJoining("+t.name+"); this.observedJoinerId = "+n.observedJoinerId),null==n.observedJoinerId)throw new Error("cannot cancel joining when not observing a joiner");const r=yield n.joinerDAO.read(n.observedJoinerId);if(!r.isAbsent()){const e=r.get(),i=fK.copyImmutableArray(e.candidates),s=i.findIndex(e=>e.id===t.id);let o=e.chosenOpponent,a=e.partStatus;if(i.splice(s,1),o?.id===t.id)o=null,a=iK.PART_CREATED.value;else if(-1===s)throw new Error("someone that was not candidate nor ChosenOpponent just left the chat: "+t.name);return n.joinerDAO.update(n.observedJoinerId,{chosenOpponent:o,partStatus:a,candidates:i})}})()}updateCandidates(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"JoinerService.reviewConfig"),nq(null!=n.observedJoinerId,"JoinerService is not observing a joiner");const r={candidates:t};return n.joinerDAO.update(Ow.getNonNullable(n.observedJoinerId),r)})()}deleteJoiner(){var t=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),nq(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(Ow.getNonNullable(t.observedJoinerId))})()}proposeConfig(t,n,r,i,s){var o=this;return Pw(function*(){return Tw(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:s}}),Tw(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),nq(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(Ow.getNonNullable(o.observedJoinerId),{partStatus:iK.CONFIG_PROPOSED.value,chosenOpponent:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:s,firstPlayer:i.value})})()}setChosenOpponent(t){return Tw(e.VERBOSE,`JoinerService.setChosenOpponent(${t.name})`),nq(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(Ow.getNonNullable(this.observedJoinerId),{chosenOpponent:t})}reviewConfig(){var t=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.reviewConfig"),nq(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(Ow.getNonNullable(t.observedJoinerId),{partStatus:iK.PART_CREATED.value})})()}reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.reviewConfig"),nq(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(Ow.getNonNullable(n.observedJoinerId),{partStatus:iK.PART_CREATED.value,candidates:t,chosenOpponent:null})})()}acceptConfig(){return Tw(e.VERBOSE,"JoinerService.acceptConfig"),nq(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(Ow.getNonNullable(this.observedJoinerId),{partStatus:iK.PART_STARTED.value})}createJoiner(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)})()}readJoinerById(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),(yield n.joinerDAO.read(t)).get()})()}set(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)})()}updateJoinerById(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)})()}}return e.VERBOSE=!1,e.USER_ALREADY_IN_GAME=()=>$localize`You cannot join this game because you are already in another one.`,e.GAME_DOES_NOT_EXIST=()=>$localize`Game does not exist`,e.\u0275fac=function(t){return new(t||e)(Or(gK))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yK=(()=>{class e{constructor(t,n,r){this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=Mw.empty(),Tw(e.VERBOSE,"GameService.constructor")}getPartValidity(e,t){var n=this;return Pw(function*(){const r=yield n.partDAO.read(e);return r.isAbsent()?QG.failure("NONEXISTENT_PART"):r.get().typeGame===t?QG.SUCCESS:QG.failure("WRONG_GAME_TYPE")})()}createUnstartedPart(t,n){return Tw(e.VERBOSE,"GameService.createPart("+t.name+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t.name,turn:-1,result:rq.UNACHIEVED.value,listMoves:[]})}createChat(t){return Tw(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}createPartJoinerAndChat(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,`GameService.createGame(${t.id}, ${n})`);const i=yield r.createUnstartedPart(t,n);return yield r.joinerService.createInitialJoiner(t,i),yield r.createChat(i),i})()}startGameWithConfig(t,n,r,i){Tw(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));const s=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,s)}getStartingConfig(e){let t,n,r=nK.of(e.firstPlayer);return r===nK.RANDOM&&(r=Math.random()<.5?nK.CREATOR:nK.CHOSEN_PLAYER),r===nK.CREATOR?(t=e.creator.name,n=Ow.getNonNullable(e.chosenOpponent).name):(t=Ow.getNonNullable(e.chosenOpponent).name,n=e.creator.name),{playerZero:t,playerOne:n,turn:0,beginning:PG(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}deletePart(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)})()}acceptConfig(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),yield r.joinerService.acceptConfig(),r.startGameWithConfig(t,cK.ONE,0,n)})()}startObserving(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");Tw(e.VERBOSE,"[start watching part "+t),this.followedPartId=Mw.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}resign(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:rq.RESIGN.value,request:null})}notifyTimeout(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:rq.TIMEOUT.value,request:null})}sendRequest(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}proposeDraw(e,t,n){return this.sendRequest(e,n,t,hK.drawProposed(n))}acceptDraw(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===cK.ZERO?rq.AGREED_DRAW_BY_ZERO:rq.AGREED_DRAW_BY_ONE).value,request:null})}refuseDraw(e,t,n){return this.sendRequest(e,n,t,hK.drawRefused(n))}proposeRematch(e,t,n){return this.sendRequest(e,n,t,hK.rematchProposed(n))}acceptRematch(t,n,r){var i=this;return Pw(function*(){Tw(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t});const s=Ow.getNonNullable(t.data),o=yield i.joinerService.readJoinerById(t.id);let a;a=s.playerZero===o.creator.name?nK.CHOSEN_PLAYER:nK.CREATOR;const l={...o,candidates:[],firstPlayer:a.value,partStatus:iK.PART_STARTED.value},c=yield i.joinerService.createJoiner(l),u=i.getStartingConfig(l),h={lastUpdate:{index:0,player:r.value},typeGame:s.typeGame,result:rq.UNACHIEVED.value,listMoves:[],...u};return yield i.partDAO.set(c,h),yield i.createChat(c),i.sendRequest(t.id,r,n,hK.rematchAccepted(s.typeGame,c))})()}askTakeBack(e,t,n){return this.sendRequest(e,n,t,hK.takeBackAsked(n))}acceptTakeBack(e,t,n,r){var i=this;return Pw(function*(){nq(hK.getPlayer(Ow.getNonNullable(t.data.request))!==n,"Illegal to accept your own request");const s=hK.takeBackAccepted(n);let o=t.data.listMoves.slice(0,t.data.listMoves.length-1);o.length%2===n.value&&(o=o.slice(0,o.length-1));const a={request:s,listMoves:o,turn:o.length,lastUpdateTime:PG(),remainingMsForZero:Ow.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:Ow.getNonNullable(t.data.remainingMsForOne)-r[1]},l=t.data.lastUpdate.index;return yield i.partDAO.updateAndBumpIndex(e,n,l,a)})()}refuseTakeBack(e,t,n){const r=hK.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}addGlobalTime(e,t,n,r){var i=this;return Pw(function*(){let s={request:hK.addGlobalTime(r.getOpponent())};return s=r===cK.ZERO?{...s,remainingMsForOne:Ow.getNonNullable(n.remainingMsForOne)+3e5}:{...s,remainingMsForZero:Ow.getNonNullable(n.remainingMsForZero)+3e5},yield i.partDAO.updateAndBumpIndex(e,r,t,s)})()}addTurnTime(e,t,n){var r=this;return Pw(function*(){const i={request:hK.addTurnTime(e.getOpponent())};return yield r.partDAO.updateAndBumpIndex(n,e,t,i)})()}stopObserving(){Tw(e.VERBOSE,"GameService.stopObserving();"),this.followedPartId=Mw.empty(),this.followedPartUnsubscribe()}updateDBBoard(t,n,r,i,s,o,a,l){var c=this;return Pw(function*(){Tw(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:s,msToSubstract:i,notifyDraw:o,winner:a,loser:l}});const u=(yield c.partDAO.read(t)).get(),h=u.lastUpdate.index,d=u.turn+1,p=fK.copyImmutableArray(u.listMoves);p[p.length]=r;let f={listMoves:p,turn:d,request:null,lastUpdateTime:PG()};return f=c.updateScore(f,s),f=c.substractMs(f,u,i),null!=a?f={...f,winner:a,loser:l,result:rq.VICTORY.value}:!0===o&&(f={...f,result:rq.HARD_DRAW.value}),yield c.partDAO.updateAndBumpIndex(t,n,h,f)})()}updateScore(e,t){return void 0!==t?{...e,scorePlayerZero:t[0],scorePlayerOne:t[1]}:e}substractMs(e,t,n){return n[0]>0?{...e,remainingMsForZero:Ow.getNonNullable(t.remainingMsForZero)-n[0]}:n[1]>0?{...e,remainingMsForOne:Ow.getNonNullable(t.remainingMsForOne)-n[1]}:e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(sq),Or(mK),Or(lq))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class vK{static getNavigatorLanguage(){return navigator.language}static getLocale(){const e=(localStorage.getItem("locale")??vK.getNavigatorLanguage()??"fr").slice(0,2).toLowerCase();return["en","fr"].some(t=>t===e)?e:"fr"}}let _K=(()=>{class e{changeTheme(e){localStorage.setItem("theme",e)}getTheme(){return Mw.ofNullable(localStorage.getItem("theme"))}changeLanguage(e){localStorage.setItem("locale",e.toLowerCase())}getLanguage(){return vK.getLocale()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),CK=(()=>{class e{constructor(e,t){this.document=e,this.userSettingsService=t,this.availableThemes=["dark","light"];const n=this.getStoredTheme();n.isPresent()?this.loadTheme(n.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}getStoredTheme(){const e=this.userSettingsService.getTheme();if(e.isPresent()){const t=e.get();if(this.availableThemes.some(e=>e===t))return Mw.of(t)}return Mw.empty()}loadTheme(e){this.loadStyle(e+".css"),this.theme=e}loadStyle(e){const t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{const n=this.document.createElement("link");n.id="theme",n.rel="stylesheet",n.href=`${e}`,t.appendChild(n)}}getTheme(){return this.theme}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(_K))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var EK={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},wK={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},SK={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},bK={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},PK={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},OK={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]};function TK(e){return(TK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function IK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function AK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){kK(e,t,n[t])})}return e}function MK(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,s=l}finally{try{!r&&null!=a.return&&a.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var NK={},RK={};try{"undefined"!=typeof window&&(NK=window),"undefined"!=typeof document&&(RK=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch{}var xK=(NK.navigator||{}).userAgent,DK=void 0===xK?"":xK,LK=NK,FK=RK,UK=!!FK.documentElement&&!!FK.head&&"function"==typeof FK.addEventListener&&"function"==typeof FK.createElement,BK=(~DK.indexOf("MSIE")||DK.indexOf("Trident/"),"___FONT_AWESOME___"),VK="svg-inline--fa",$K=[1,2,3,4,5,6,7,8,9,10],zK=$K.concat([11,12,13,14,15,16,17,18,19,20]),HK={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},GK=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",HK.GROUP,HK.SWAP_OPACITY,HK.PRIMARY,HK.SECONDARY].concat($K.map(function(e){return"".concat(e,"x")})).concat(zK.map(function(e){return"w-".concat(e)})),LK.FontAwesomeConfig||{});FK&&"function"==typeof FK.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=MK(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=FK.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(GK[n]=r)});var qK=AK({},{familyPrefix:"fa",replacementClass:VK,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},GK);qK.autoReplaceSvg||(qK.observeMutations=!1);var WK=AK({},qK);LK.FontAwesomeConfig=WK;var jK=LK||{};jK[BK]||(jK[BK]={}),jK[BK].styles||(jK[BK].styles={}),jK[BK].hooks||(jK[BK].hooks={}),jK[BK].shims||(jK[BK].shims=[]);var ZK=jK[BK],YK=[];UK&&((FK.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(FK.readyState)||FK.addEventListener("DOMContentLoaded",function e(){FK.removeEventListener("DOMContentLoaded",e),YK.map(function(e){return e()})}));var KK,QK="pending",JK="fulfilled",XK="rejected",eQ=function(){},tQ="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,nQ="undefined"==typeof setImmediate?setTimeout:setImmediate,rQ=[];function iQ(){for(var e=0;e<rQ.length;e++)rQ[e][0](rQ[e][1]);rQ=[],KK=!1}function sQ(e,t){rQ.push([e,t]),KK||(KK=!0,nQ(iQ,0))}function oQ(e){var t=e.owner,n=t._state,r=t._data,i=e[n],s=e.then;if("function"==typeof i){n=JK;try{r=i(r)}catch(o){uQ(s,o)}}aQ(s,r)||(n===JK&&lQ(s,r),n===XK&&uQ(s,r))}function aQ(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===TK(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?cQ(e,r):lQ(e,r))},function(t){n||(n=!0,uQ(e,t))}),!0}}catch(i){return n||uQ(e,i),!0}return!1}function lQ(e,t){(e===t||!aQ(e,t))&&cQ(e,t)}function cQ(e,t){e._state===QK&&(e._state="settled",e._data=t,sQ(dQ,e))}function uQ(e,t){e._state===QK&&(e._state="settled",e._data=t,sQ(pQ,e))}function hQ(e){e._then=e._then.forEach(oQ)}function dQ(e){e._state=JK,hQ(e)}function pQ(e){e._state=XK,hQ(e),!e._handled&&tQ&&global.process.emit("unhandledRejection",e._data,e)}function fQ(e){global.process.emit("rejectionHandled",e)}function gQ(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof gQ))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){uQ(t,e)}try{e(function(e){lQ(t,e)},n)}catch(r){n(r)}}(e,this)}gQ.prototype={constructor:gQ,_state:QK,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(eQ),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===XK&&tQ&&sQ(fQ,this)),this._state===JK||this._state===XK?sQ(oQ,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},gQ.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new gQ(function(t,n){var r=[],i=0;function s(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,a=0;a<e.length;a++)(o=e[a])&&"function"==typeof o.then?o.then(s(a),n):r[a]=o;i||t(r)})},gQ.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new gQ(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},gQ.resolve=function(e){return e&&"object"===TK(e)&&e.constructor===gQ?e:new gQ(function(t){t(e)})},gQ.reject=function(e){return new gQ(function(t,n){n(e)})};var mQ={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function yQ(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function vQ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function _Q(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function CQ(e){return e.size!==mQ.size||e.x!==mQ.x||e.y!==mQ.y||e.rotate!==mQ.rotate||e.flipX||e.flipY}function EQ(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),s="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(s," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var wQ={x:0,y:0,width:"100%",height:"100%"};function SQ(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function bQ(e){return"g"===e.tag?e.children:[e]}function PQ(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,s=e.iconName,o=e.transform,a=e.symbol,l=e.title,c=e.maskId,u=e.titleId,h=e.extra,d=e.watchable,p=void 0!==d&&d,f=r.found?r:n,g=f.width,m=f.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(g/m*16)),_=[WK.replacementClass,s?"".concat(WK.familyPrefix,"-").concat(s):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),C={children:[],attributes:AK({},h.attributes,{"data-prefix":i,"data-icon":s,class:_,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(g," ").concat(m)})},E=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(g/m*16*.0625,"em")}:{};p&&(C.attributes["data-fa-i2svg"]=""),l&&C.children.push({tag:"title",attributes:{id:C.attributes["aria-labelledby"]||"title-".concat(u||yQ())},children:[l]});var w=AK({},C,{prefix:i,iconName:s,main:n,mask:r,maskId:c,transform:o,symbol:a,styles:AK({},E,h.styles)}),S=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,s=e.maskId,o=r.icon,a=i.icon,l=EQ({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),c={tag:"rect",attributes:AK({},wQ,{fill:"white"})},u=o.children?{children:o.children.map(SQ)}:{},h={tag:"g",attributes:AK({},l.inner),children:[SQ(AK({tag:o.tag,attributes:AK({},o.attributes,l.path)},u))]},d={tag:"g",attributes:AK({},l.outer),children:[h]},p="mask-".concat(s||yQ()),f="clip-".concat(s||yQ()),g={tag:"mask",attributes:AK({},wQ,{id:p,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[c,d]},m={tag:"defs",children:[{tag:"clipPath",attributes:{id:f},children:bQ(a)},g]};return t.push(m,{tag:"rect",attributes:AK({fill:"currentColor","clip-path":"url(#".concat(f,")"),mask:"url(#".concat(p,")")},wQ)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,s=_Q(e.styles);if(s.length>0&&(n.style=s),CQ(i)){var o=EQ({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:AK({},o.outer),children:[{tag:"g",attributes:AK({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:AK({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),b=S.attributes;return w.children=S.children,w.attributes=b,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:AK({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(WK.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,s=e.styles,o=e.transform;if(CQ(o)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=_Q(AK({},s,{"transform-origin":"".concat(a.x+o.x/16,"em ").concat(a.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var OQ=function(e,t,n,r){var i,s,o,a=Object.keys(e),l=a.length,c=void 0!==r?function(e,t){return function(n,r,i,s){return e.call(t,n,r,i,s)}}(t,r):t;for(void 0===n?(i=1,o=e[a[0]]):(i=0,o=n);i<l;i++)o=c(o,e[s=a[i]],s,e);return o};function TQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,s=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof ZK.hooks.addPack||i?ZK.styles[e]=AK({},ZK.styles[e]||{},s):ZK.hooks.addPack(e,s),"fas"===e&&TQ("fa",t)}var IQ=ZK.styles,kQ=ZK.shims,AQ=function(){var e=function(e){return OQ(IQ,function(t,n,r){return t[r]=OQ(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in IQ;OQ(kQ,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function MQ(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function NQ(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,s=void 0===i?[]:i;return"string"==typeof e?vQ(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(vQ(e[n]),'" ')},"").trim()}(r),">").concat(s.map(NQ).join(""),"</").concat(t,">")}AQ();function RQ(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}(RQ.prototype=Object.create(Error.prototype)).constructor=RQ;var xQ={fill:"currentColor"},DQ={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},LQ=(AK({},xQ,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),AK({},DQ,{attributeName:"opacity"}));function FQ(e){var t=e[0],n=e[1],r=MK(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(WK.familyPrefix,"-").concat(HK.GROUP)},children:[{tag:"path",attributes:{class:"".concat(WK.familyPrefix,"-").concat(HK.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(WK.familyPrefix,"-").concat(HK.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function UQ(){WK.autoAddCss&&!zQ&&(function(e){if(e&&UK){var t=FK.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=FK.head.childNodes,r=null,i=n.length-1;i>-1;i--){var s=n[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}FK.head.insertBefore(t,r)}}(function(){var e="fa",t=VK,n=WK.familyPrefix,r=WK.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var s=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(s,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),zQ=!0)}function BQ(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return NQ(e)})}}),Object.defineProperty(e,"node",{get:function(){if(UK){var t=FK.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function VQ(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return MQ($Q.definitions,n,r)||MQ(ZK.styles,n,r)}AK({},xQ,{cx:"256",cy:"364",r:"28"}),AK({},DQ,{attributeName:"r",values:"28;14;28;28;14;28;"}),AK({},LQ,{values:"1;0;1;1;0;1;"}),AK({},xQ,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),AK({},LQ,{values:"1;0;0;0;0;1;"}),AK({},xQ,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),AK({},LQ,{values:"0;0;1;1;0;0;"});var $Q=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&IK(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=AK({},e.definitions[t]||{},i[t]),TQ(t,i[t]),AQ()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,s=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][s]=o}),e}}]),e}()),zQ=!1,HQ=function(e){return function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(e)},GQ=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:VQ(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:VQ(i||{})),e(r,AK({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?mQ:n,i=t.symbol,s=void 0!==i&&i,o=t.mask,a=void 0===o?null:o,l=t.maskId,c=void 0===l?null:l,u=t.title,h=void 0===u?null:u,d=t.titleId,p=void 0===d?null:d,f=t.classes,g=void 0===f?[]:f,m=t.attributes,y=void 0===m?{}:m,v=t.styles,_=void 0===v?{}:v;if(e){var C=e.prefix,E=e.iconName,w=e.icon;return BQ(AK({type:"icon"},e),function(){return UQ(),WK.autoA11y&&(h?y["aria-labelledby"]="".concat(WK.replacementClass,"-title-").concat(p||yQ()):(y["aria-hidden"]="true",y.focusable="false")),PQ({icons:{main:FQ(w),mask:a?FQ(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:C,iconName:E,transform:AK({},mQ,r),symbol:s,title:h,maskId:c,titleId:p,extra:{attributes:y,styles:_,classes:g}})})}});const qQ=["*"],WQ=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let jQ=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ZQ=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e){t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t;for(const e of t.icon[2])"string"==typeof e&&(this.definitions[t.prefix][e]=t)}}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),YQ=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[vt]}),e})(),KQ=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(Sc))},e.\u0275cmp=Xe({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[vt],ngContentSelectors:qQ,decls:1,vars:0,template:function(e,t){1&e&&(function(e){const t=zt()[16][6];if(!t.projection){const n=t.projection=pr(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?Pa(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}(),function(e,t=0,n){const r=zt(),i=Ht(),s=Fs(i,20+e,16,null,n||null);null===s.projection&&(s.projection=t),Kt(),64!=(64&s.flags)&&function(e,t,n){hs(t[11],0,t,n,ji(e,n,t),Xi(n.parent||t[6],n,t))}(i,r,s)}(0))},encapsulation:2}),e})(),QQ=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=this.icon??this.config.fallbackIcon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=((e,t)=>(e=>void 0!==e.prefix&&void 0!==e.iconName)(e)?e:Array.isArray(e)&&2===e.length?{prefix:e[0],iconName:e[1]}:"string"==typeof e?{prefix:t,iconName:e}:void 0)(e,this.config.defaultPrefix);return"icon"in t?t:this.iconLibrary.getIconDefinition(t.prefix,t.iconName)??((e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null)}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?HQ(this.transform):this.transform;return{title:this.title,transform:t,classes:[...WQ(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=GQ(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(ua(Bp),ua(jQ),ua(ZQ),ua(YQ,8),ua(KQ,8))},e.\u0275cmp=Xe({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(nl("innerHTML",t.renderedIconHTML,vi),ra("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[vt],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),JQ=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();function XQ(e,t){if(1&e){const e=va();ma(0),pa(1,"div",9),pa(2,"a",10),Qa(3),fa(),pa(4,"div",12),pa(5,"a",24),Ea("click",function(){return Gt(e),ba().logout()}),sc(6,25),fa(),fa(),fa(),ya()}if(2&e){const e=ba();Ts(3),Ja(e.username)}}const eJ=function(){return["/register"]},tJ=function(){return["/login"]};function nJ(e,t){1&e&&(pa(0,"div",26),pa(1,"a",27),pa(2,"strong"),sc(3,28),fa(),fa(),pa(4,"a",29),sc(5,30),fa(),fa()),2&e&&(Ts(1),ha("routerLink",wu(2,eJ)),Ts(3),ha("routerLink",wu(3,tJ)))}const rJ=function(){return["/"]},iJ=function(){return["/play"]},sJ=function(){return["/lobby"]},oJ=function(){return["/local"]},aJ=function(){return["/tutorial"]},lJ=function(){return["/settings"]};let cJ=(()=>{class e{constructor(e,t,n){this.router=e,this.connectedUserService=t,this.userService=n,this.username="connecting...",this.faCog=wK,this.showMenu=!1}ngOnInit(){this.userSub=this.connectedUserService.getUserObs().subscribe(e=>{this.username=e.username.isPresent()?e.username.get():e.email.getOrElse("")})}logout(){var e=this;return Pw(function*(){yield e.connectedUserService.disconnect(),yield e.router.navigate(["/"])})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(tK),ua(dq))},e.\u0275cmp=Xe({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Home`,t=$localize`Play online`,n=$localize`Create a game`,r=$localize`Join a game`,i=$localize`Play offline`,s=$localize`Create a game`,o=$localize`Learn the rules`,a=$localize`Settings`,l=$localize`Log out`,c=$localize`Register`,u=$localize`Log in`,[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],e,[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],t,[1,"navbar-dropdown"],n,r,i,s,o,[1,"navbar-end"],["data-tooltip",a,1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["connect",""],["id","logout",1,"navbar-item",3,"click"],l,[1,"buttons"],[1,"button","is-primary",3,"routerLink"],c,[1,"button","is-light",3,"routerLink"],u]},template:function(e,t){if(1&e&&(pa(0,"nav",0),pa(1,"div",1),pa(2,"a",2),ga(3,"img",3),fa(),pa(4,"a",4),Ea("click",function(){return t.showMenu=!t.showMenu}),ga(5,"span",5),ga(6,"span",5),ga(7,"span",5),fa(),fa(),pa(8,"div",6),Ea("click",function(){return t.showMenu=!t.showMenu}),pa(9,"div",7),pa(10,"a",2),sc(11,8),fa(),pa(12,"div",9),pa(13,"a",10),sc(14,11),fa(),pa(15,"div",12),pa(16,"a",2),sc(17,13),fa(),pa(18,"a",2),sc(19,14),fa(),fa(),fa(),pa(20,"div",9),pa(21,"a",10),sc(22,15),fa(),pa(23,"div",12),pa(24,"a",2),sc(25,16),fa(),pa(26,"a",2),sc(27,17),fa(),fa(),fa(),fa(),pa(28,"div",18),pa(29,"a",19),ga(30,"fa-icon",20),fa(),pa(31,"div",21),la(32,XQ,7,1,"ng-container",22),la(33,nJ,6,4,"ng-template",null,23,Ku),fa(),fa(),fa(),fa()),2&e){const e=ca(34);Ts(2),ha("routerLink",wu(12,rJ)),Ts(2),ha("ngClass",t.showMenu?"is-active":""),Ts(4),ha("ngClass",t.showMenu?"is-active":""),Ts(2),ha("routerLink",wu(13,rJ)),Ts(6),ha("routerLink",wu(14,iJ)),Ts(2),ha("routerLink",wu(15,sJ)),Ts(6),ha("routerLink",wu(16,oJ)),Ts(2),ha("routerLink",wu(17,aJ)),Ts(3),ha("routerLink",wu(18,lJ)),Ts(1),ha("icon",t.faCog),Ts(2),ha("ngIf",t.username)("ngIfElse",e)}},directives:[y_,Xd,QQ,rp],encapsulation:2}),e})(),uJ=(()=>{class e{constructor(e,t){this._themeService=e,this._errorLoggerService=t}}return e.\u0275fac=function(t){return new(t||e)(ua(CK),ua(tq))},e.\u0275cmp=Xe({type:e,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container","mt-2"]],template:function(e,t){1&e&&(ga(0,"app-header"),pa(1,"main",0),ga(2,"router-outlet"),fa())},directives:[cJ,__],encapsulation:2}),e})();class hJ{constructor(e,t){this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}}class dJ extends hJ{isDown(){return 1===this.y}isUp(){return-1===this.y}isLeft(){return-1===this.x}isRight(){return 1===this.x}toInt(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}toString(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}class pJ{of(e,t){for(const n of this.all)if(n.x===e&&n.y===t)return ZG.success(n);return ZG.failure("Invalid x and y in direction construction")}fromDelta(e,t){return 0===e&&0===t?ZG.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):ZG.failure(mJ.DIRECTION_MUST_BE_LINEAR())}fromMove(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}fromString(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return ZG.failure(`Invalid direction string ${e}`)}}fromInt(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return ZG.failure(`Invalid int direction: ${e}`)}}}class fJ extends dJ{constructor(e,t){super(e,t)}isDiagonal(){return 0!==this.x&&0!==this.y}getOpposite(){return fJ.factory.of(-this.x,-this.y).get()}}fJ.UP=new fJ(0,-1),fJ.UP_RIGHT=new fJ(1,-1),fJ.RIGHT=new fJ(1,0),fJ.DOWN_RIGHT=new fJ(1,1),fJ.DOWN=new fJ(0,1),fJ.DOWN_LEFT=new fJ(-1,1),fJ.LEFT=new fJ(-1,0),fJ.UP_LEFT=new fJ(-1,-1),fJ.factory=new class extends pJ{constructor(){super(...arguments),this.all=[fJ.UP,fJ.UP_RIGHT,fJ.RIGHT,fJ.DOWN_RIGHT,fJ.DOWN,fJ.DOWN_LEFT,fJ.LEFT,fJ.UP_LEFT]}},fJ.DIRECTIONS=fJ.factory.all,fJ.DIAGONALS=[fJ.UP_RIGHT,fJ.DOWN_RIGHT,fJ.DOWN_LEFT,fJ.UP_LEFT],fJ.ORTHOGONALS=[fJ.UP,fJ.RIGHT,fJ.DOWN,fJ.LEFT],fJ.encoder=new class extends sK{encode(e){return e.toString()}decode(e){return nq("string"==typeof e,"Invalid encoded direction"),fJ.factory.fromString(e).get()}};class gJ extends dJ{constructor(e,t){super(e,t)}getOpposite(){return gJ.factory.of(-this.x,-this.y).get()}}gJ.UP=new gJ(0,-1),gJ.RIGHT=new gJ(1,0),gJ.DOWN=new gJ(0,1),gJ.LEFT=new gJ(-1,0),gJ.factory=new class extends pJ{constructor(){super(...arguments),this.all=[gJ.UP,gJ.RIGHT,gJ.DOWN,gJ.LEFT]}of(e,t){return 0===e&&-1===t?ZG.success(gJ.UP):1===e&&0===t?ZG.success(gJ.RIGHT):0===e&&1===t?ZG.success(gJ.DOWN):-1===e&&0===t?ZG.success(gJ.LEFT):ZG.failure("Invalid orthogonal from x and y")}},gJ.ORTHOGONALS=gJ.factory.all,gJ.encoder=new class extends sK{encode(e){return e.toString()}decode(e){return nq("string"==typeof e,"Invalid encoded orthogonal"),gJ.factory.fromString(e).get()}};let mJ=(()=>{class e{}return e.DIRECTION_MUST_BE_LINEAR=()=>$localize`You must move in a straight line! You can only move orthogonally or diagonally!`,e})();class yJ{constructor(e,t){this.x=e,this.y=t}static numberEncoder(e,t){return aK.tuple([aK.numberEncoder(e),aK.numberEncoder(t)],e=>[e.x,e.y],e=>new yJ(e[0],e[1]))}getNext(e,t){return new yJ(this.x+(t=t??1)*e.x,this.y+t*e.y)}getPrevious(e,t){return this.getNext(e,-(t=t??1))}getLeft(e){return new yJ(this.x+e.y,this.y+-e.x)}getRight(e){return new yJ(this.x+-e.y,this.y+e.x)}getOpposite(){return new yJ(-this.x,-this.y)}isInRange(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}isNotInRange(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}getDirectionToward(e){return fJ.factory.fromMove(this,e)}getOrthogonalDistance(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}getDistance(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");const t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}isHexagonallyAlignedWith(e){const t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}isAlignedWith(e){const t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}getVectorToward(e){return new yJ(e.x-this.x,e.y-this.y)}getMinimalVectorToward(e){return this.getVectorToward(e).toVector()}getCoordsToward(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];const t=this.getDirectionToward(e).get();let n=this.getNext(t,1);const r=[];for(;!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}toVector(){const e=Math.abs(this.x),t=Math.abs(this.y),n=Math.max(e,t);let r=this.x,i=this.y,s=2;for(;s<=n;)r%s==0&&i%s==0?(r/=s,i/=s):s++;return new yJ(r,i)}isBetween(e,t){const n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}getUntil(e){const t=[],n=this.getDirectionToward(e).get();let r=this.getNext(n);for(;!1===r.equals(e);)t.push(r),r=r.getNext(n);return t}equals(e){return this===e||e.x===this.x&&e.y===this.y}compareTo(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}toString(){return"("+this.x+", "+this.y+")"}}yJ.encoder=new class extends sK{encode(e){return{x:e.x,y:e.y}}decode(e){const t=e;return nq(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new yJ(t.x,t.y)}};let vJ=(()=>{class e{constructor(e){this.messageDisplayer=e,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=Mw.empty(),this.imagesLocation="assets/images/"}message(e){this.messageDisplayer.gameMessage(e)}cancelMove(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?QG.SUCCESS:(this.messageDisplayer.gameMessage(e),QG.failure(e))}cancelMoveAttempt(){}getPlayerClass(e){switch(e){case cK.ZERO:return"player0";case cK.ONE:return"player1";default:return Ow.expectToBe(e,uK.NONE),""}}pass(){var e=this;return Pw(function*(){return tq.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name})})()}getTurn(){return this.rules.node.gameState.turn}getCurrentPlayer(){return this.rules.node.gameState.getCurrentPlayer()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}range(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),_J=(()=>{class e extends vJ{getHexaCoordsBy(e,t){const n=new yJ(e,t);return this.getHexaCoordsAt(n)}getHexaCoordsAt(e){let t="";const n=this.hexaLayout.getHexaCoordsAt(e);for(const r of n)t+=r.x+" "+r.y+" ";return t+=n[0].x+" "+n[0].y,t}getCenterBy(e,t){const n=new yJ(e,t);return this.getCenterAt(n)}getCenterAt(e){return this.hexaLayout.getCenterAt(e)}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class CJ{constructor(e){this.value=e}static from(e){switch(e){case CJ.ZERO.value:return CJ.ZERO;case CJ.ONE.value:return CJ.ONE;case CJ.EMPTY.value:return CJ.EMPTY;case CJ.UNREACHABLE.value:return CJ.UNREACHABLE;default:throw new Error("FourStatePiece has no value matching "+e)}}static ofPlayer(e){switch(e){case cK.ZERO:return CJ.ZERO;default:return Ow.expectToBe(e,cK.ONE),CJ.ONE}}equals(e){return this===e}is(e){return this.value===e.value}isPlayer(){return this===CJ.ZERO||this===CJ.ONE}}CJ.ZERO=new CJ(cK.ZERO.value),CJ.ONE=new CJ(cK.ONE.value),CJ.EMPTY=new CJ(uK.NONE.value),CJ.UNREACHABLE=new CJ(3);class EJ extends dJ{constructor(e,t){super(e,t)}static getAngle(e){switch(e){case EJ.UP:return 0;case EJ.UP_RIGHT:return 60;case EJ.RIGHT:return 120;case EJ.DOWN:return 180;case EJ.DOWN_LEFT:return 240;default:return Ow.expectToBe(e,EJ.LEFT),300}}getOpposite(){return EJ.factory.of(-this.x,-this.y).get()}}EJ.UP=new EJ(0,-1),EJ.LEFT=new EJ(-1,0),EJ.UP_RIGHT=new EJ(1,-1),EJ.DOWN_LEFT=new EJ(-1,1),EJ.RIGHT=new EJ(1,0),EJ.DOWN=new EJ(0,1),EJ.factory=new class extends pJ{constructor(){super(...arguments),this.all=[EJ.UP,EJ.UP_RIGHT,EJ.RIGHT,EJ.DOWN,EJ.DOWN_LEFT,EJ.LEFT]}},EJ.encoder=new class extends aK{maxValue(){return 5}encodeNumber(e){switch(e){case EJ.UP:return 0;case EJ.UP_RIGHT:return 1;case EJ.RIGHT:return 2;case EJ.DOWN:return 3;case EJ.DOWN_LEFT:return 4;default:return 5}}decodeNumber(e){return nq(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),EJ.factory.all[e]}};class wJ{constructor(e,t,n){this.size=e,this.origin=t,this.orientation=n}getCenterAt(e){const t=this.orientation.conversionMatrix;return new yJ(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}getCornerOffset(e){const t=2*Math.PI*(this.orientation.startAngle+e)/6;return new yJ(this.size*Math.cos(t),this.size*Math.sin(t))}getHexaCoordsAt(e){const t=this.getCenterAt(e),n=[];for(let r=0;r<6;r+=1){const e=this.getCornerOffset(r);n.push(new yJ(t.x+e.x,t.y+e.y))}return n}}class SJ{}class bJ extends SJ{constructor(){super(),this.startAngle=.5,this.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],this.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3]}}bJ.INSTANCE=new bJ;class PJ extends SJ{constructor(){super(),this.startAngle=0,this.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],this.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3]}isOnBorder(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}isOnTopRightBorder(e,t){return 0===t.y}isOnRightBorder(e,t){return t.x===e.width-1}isOnLeftBorder(e,t){return 0===t.x}isOnBottomLeftBorder(e,t){return t.y===e.height-1}isOnTopLeftBorder(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}isOnBottomRightBorder(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}getAllBorders(e){const t=[];return e.forEachCoord((n,r)=>{this.isOnBorder(e,n)&&t.push(n)}),t}isTopCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}isTopLeftCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isTopRightCorner(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}isBottomCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}isBottomLeftCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isBottomRightCorner(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}PJ.INSTANCE=new PJ;let OJ=(()=>{class e{}return e.CANNOT_CHOOSE_OPPONENT_PIECE=()=>$localize`You cannot pick a piece of the opponent.`,e.MUST_CLICK_ON_EMPTY_SPACE=()=>$localize`You must click on an empty space.`,e.MUST_CLICK_ON_EMPTY_SQUARE=()=>$localize`You must click on an empty square.`,e.CANNOT_SELF_CAPTURE=()=>$localize`Your landing space should be empty or contain a piece of the opponent.`,e.MUST_CHOOSE_PLAYER_PIECE=()=>$localize`You must pick one of your pieces.`,e.CANNOT_PASS=()=>$localize`You cannot pass your turn.`,e.MUST_LAND_ON_EMPTY_SPACE=()=>$localize`You must drop your piece on an empty space.`,e.MUST_PASS=()=>$localize`You must pass your turn.`,e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=()=>$localize`You have selected an empty space, you must select one of your own pieces.`,e.MOVE_CANNOT_BE_STATIC=()=>$localize`You must choose different starting and ending coordinates.`,e.SOMETHING_IN_THE_WAY=()=>$localize`There is a piece between the piece you chose and its landing space.`,e})();class TJ{constructor(e,t){this.ruler=e,this.name=t}toString(){return this.name}}class IJ{constructor(e){this.value=e}static fromWinner(e){return e.isPlayer()?new IJ(e.getVictoryValue()):new IJ(0)}toString(){return""+this.value}}class kJ{static toComparableObjectSet(e){const t=[];return e.forEach(e=>{t.some(t=>t.equals(e))||t.push(e)}),t}static toComparableSet(e){const t=[];return e.forEach(e=>{t.some(t=>Aw(t,e))||t.push(e)}),t}}class AJ{constructor(e){this.values=void 0===e?[]:kJ.toComparableSet(e)}equals(e){if(e.size()!==this.size())return!1;for(const t of this)if(!1===e.contains(t))return!1;return!0}toString(){let e="";for(const t of this)e+=null==t?"null, ":t.toString()+", ";return"["+e.slice(0,-2)+"]"}add(e){return!this.contains(e)&&(this.values.push(e),!0)}union(e){for(const t of e)this.add(t)}contains(e){for(const t of this.values)if(Aw(t,e))return!0;return!1}size(){return this.values.length}toList(){const e=[];for(const t of this)e.push(t);return e}getAnyElement(){return this.size()>0?Mw.of(this.values[0]):Mw.empty()}[Symbol.iterator](){return this.values.values()}}class MJ{constructor(e){this.turn=e}getCurrentPlayer(){return cK.fromTurn(this.turn)}getCurrentOpponent(){return this.turn%2==1?cK.ZERO:cK.ONE}}class NJ extends MJ{constructor(e,t){super(t),this.board=e}getPieceAt(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}tryToGetPieceAt(e){return this.isOnBoard(e)?Mw.of(this.board[e.y][e.x]):Mw.empty()}isOnBoard(e){return e.isInRange(this.board[0].length,this.board.length)}getPieceAtXY(e,t){return this.getPieceAt(new yJ(e,t))}forEachCoord(e){for(const[t,n]of this.getCoordsAndContents())e(t,n)}getCoordsAndContents(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++){const r=new yJ(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}getCopiedBoard(){return fK.copyBiArray(this.board)}}class RJ extends NJ{static getInitialState(){const e=CJ.EMPTY,t=CJ.UNREACHABLE,n=CJ.ZERO,r=CJ.ONE;return new RJ([[t,t,t,t,r,r,r,r,r],[t,t,t,r,r,r,r,r,r],[t,t,e,e,r,r,r,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,n,n,n,e,e,t,t],[n,n,n,n,n,n,t,t,t],[n,n,n,n,n,t,t,t,t]],0)}isInBoard(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==CJ.UNREACHABLE}isPiece(e){return this.getPieceAt(e).isPlayer()}getScores(){const e=[14,14];for(let t=0;t<9;t++)for(let n=0;n<9;n++)this.getPieceAtXY(n,t)===CJ.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===CJ.ONE&&(e[0]=e[0]-1);return e}}class xJ{}class DJ extends xJ{constructor(e,t){super(),this.coord=new yJ(e,t)}}class LJ extends DJ{constructor(e,t,n){if(super(e.x,e.y),this.dir=t,this.lastPiece=n,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!")}static fromSingleCoord(e,t){try{return ZG.success(new LJ(e,t,Mw.empty()))}catch(n){return ZG.failure(n.message)}}static fromDoubleCoord(e,t,n){const r=[e,t];fK.sortByDescending(r,LJ.sortCoord);const i=r[1].getDirectionToward(r[0]).get(),s=EJ.factory.fromDelta(i.x,i.y);if(s.isFailure())return ZG.failure("Invalid direction");const o=s.get();return r[1].getDistance(r[0])>2?ZG.failure("Distance between first coord and last coord is too great"):o.equals(n)?LJ.fromSingleCoord(r[1],n):o.getOpposite().equals(n)?LJ.fromSingleCoord(r[0],n):ZG.success(new LJ(r[1],n,Mw.of(r[0])))}static sortCoord(e){return 9*e.y+e.x}toString(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}isSingleCoord(){return this.lastPiece.isAbsent()}equals(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}LJ.encoder=new class extends aK{maxValue(){return 104831}encodeNumber(e){const t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;{const n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}}decodeNumber(e){const t=e%8;e=(e-t)/8;const n=EJ.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;const s=new yJ(i,r);if(0===e)return LJ.fromSingleCoord(s,n).get();{const t=(e=(e-1)/2)%9,r=(e=(e-t)/9)%9;e=(e-r)/9;const i=new yJ(r,t);return LJ.fromDoubleCoord(s,i,n).get()}}};var FJ=(()=>(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(FJ||(FJ={})),FJ))();class UJ{constructor(e=[],t=!1){this.map=e,this.isImmutable=t}static from(e){const t=Object.keys(e),n=new UJ;for(const r of t)n.set(r,e[r]);return n}makeImmutable(){this.isImmutable=!0}get(e){for(const t of this.map)if(Aw(t.key,e))return Mw.of(t.value);return Mw.empty()}forEach(e){for(let t=0;t<this.map.length;t++)e(this.getByIndex(t))}getByIndex(e){return this.map[e]}putAll(e){this.checkImmutability("putAll");for(const t of e.map)this.put(t.key,t.value)}checkImmutability(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}put(e,t){this.checkImmutability("put");for(const n of this.map)if(Aw(n.key,e)){const e=n.value;return n.value=t,Mw.of(e)}return this.map.push({key:e,value:t}),Mw.empty()}containsKey(e){return this.map.some(t=>Aw(t.key,e))}size(){return this.map.length}listKeys(){return this.map.map(e=>e.key)}getKeySet(){return new AJ(this.listKeys())}filter(e){const t=new UJ;for(const n of this.map)e(n.key,n.value)&&t.set(n.key,n.value);return t}replace(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}set(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}delete(e){this.checkImmutability("delete");for(let t=0;t<this.map.length;t++)if(Aw(this.map[t].key,e)){const e=this.map[t].value,n=this.map.slice(0,t),r=this.map.slice(t+1);return this.map=n.concat(r),e}throw new Error('No Value to delete for key "'+e.toString()+'"!')}getCopy(){const e=new this.constructor;for(const t of this.listKeys())e.set(t,this.get(t).get());return e}equals(e){const t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;for(const r of t){const t=this.get(r).get(),n=e.get(r);if(nq(n.isPresent(),"value is absent in a map even though its key is present!"),!1===Aw(t,n.get()))return!1}return!0}}class BJ extends UJ{reverse(){const e=new BJ;for(const t of this.listKeys()){const n=this.get(t).get();if(e.containsKey(n))e.get(n).get().add(t);else{const r=new AJ;r.add(t),e.set(n,r)}}return e}}let VJ=(()=>{class e{}return e.createdNodes=0,e.minimaxTime=0,e})();class $J{constructor(e,t=Mw.empty(),n=Mw.empty(),r){if(this.gameState=e,this.mother=t,this.move=n,this.minimaxCreator=r,this.childs=Mw.empty(),this.hopedValue=new UJ,this.ownValue=new UJ,this.possibleMoves=new UJ,this.ownValue=new UJ,null!=r){const e=r.getBoardValue(this);this.ownValue.set(r.name,e),this.hopedValue.set(r.name,e.value)}VJ.createdNodes++,Tw($J.VERBOSE||!1,"creating "+this.myToString())}static getScoreStatus(e){const t=!1;return e===Number.MAX_SAFE_INTEGER||e===Number.MIN_SAFE_INTEGER?(Tw($J.VERBOSE||t,"VICTORY"),FJ.VICTORY):e===Number.MIN_SAFE_INTEGER+1?(Tw($J.VERBOSE||t,"PRE_VICTORY_MIN"),FJ.PRE_VICTORY):e===Number.MAX_SAFE_INTEGER-1?(Tw($J.VERBOSE||t,"PRE_VICTORY_MAX"),FJ.PRE_VICTORY):(Tw($J.VERBOSE||t,"DEFAULT"),FJ.DEFAULT)}findBestMove(e,t,n=!1,r=!0){const i=(new Date).getTime();let s=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);for(;s.gameState.turn>this.gameState.turn+1;)s=s.mother.get(),e--;return VJ.minimaxTime+=(new Date).getTime()-i,s.move.get()}alphaBeta(e,t,n,r,i,s){if(e<1)return Tw($J.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+e),this;if(r.ruler.getGameStatus(this).isEndGame)return Tw($J.VERBOSE||!1,"isLeaf-EndGame("+$J.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+e),this;const o=this.getPossibleMoves(r);nq(o.size()>0,"Minimax "+r.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=Mw.of([]));const a=this.getBestChilds(o,e,t,n,r,i,s),l=this.getBestChildAmongst(a,i),c=l.hopedValue.get(r.toString()).get();return this.hopedValue.put(r.toString(),c),l}getPossibleMoves(e){const t=this.possibleMoves.get(e.name);if(t.isAbsent()){const t=e.getListMoves(this);return this.possibleMoves.set(e.name,new AJ(t)),new AJ(t)}return t.get()}getBestChilds(e,t,n,r,i,s,o){let a=[];const l=this.gameState.getCurrentPlayer();let c=l===cK.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER;const u=l===cK.ZERO?(e,t)=>e<t:(e,t)=>e>t;for(const h of e){const e=this.getOrCreateChild(h,i).alphaBeta(t-1,n,r,i,s,o),d=e.getHopedValue(i);if(u(d,c)||0===a.length?(c=d,a=[e]):d===c&&a.push(e),o&&u(c,l===cK.ZERO?n:r))break;l===cK.ZERO?r=Math.min(c,r):n=Math.max(c,n)}return a}getBestChildAmongst(e,t){return t?e[Math.floor(Math.random()*e.length)]:e[0]}getOrCreateChild(e,t){let n=this.getSonByMove(e);if(n.isAbsent()){const r=t.ruler.isLegal(e,this.gameState),i=e.toString();nq(r.isSuccess(),'The minimax "'+t.name+'" has proposed an illegal move ('+i+"), this should not happen.");const s=t.ruler.applyLegalMove(e,this.gameState,r.get());n=Mw.of(new $J(s,Mw.of(this),Mw.of(e),t)),this.childs.get().push(n.get())}return n.get()}getSonByMove(e){nq(this.childs.isPresent(),"Cannot get son of uncalculated node");for(const t of this.childs.get())if(t.move.isPresent()&&t.move.equalsValue(e))return Mw.of(t);return Mw.empty()}getInitialNode(){let e=this;for(;e.mother.isPresent();)e=e.mother.get();return e}getHopedValue(e){return this.hopedValue.get(e.name).get()}getOwnValue(e){const t=this.ownValue.get(e.name);if(t.isAbsent()){const t=e.getBoardValue(this);return this.ownValue.set(e.name,t),t}return t.get()}myToString(){let e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}hasMoves(){return this.childs.isPresent()}countDescendants(){if(this.childs.isAbsent())return 0;let e=this.childs.get().length;for(const t of this.childs.get())e+=t.countDescendants();return e}}$J.VERBOSE=!1,$J.minimaxes=new UJ;class zJ{constructor(e,t){this.isEndGame=e,this.winner=t}static getVictory(e){return e===cK.ZERO?zJ.ZERO_WON:zJ.ONE_WON}static getDefeat(e){return e===cK.ZERO?zJ.ONE_WON:zJ.ZERO_WON}toBoardValue(){return this.winner.isPlayer()?this.winner.getVictoryValue():0}}zJ.ZERO_WON=new zJ(!0,cK.ZERO),zJ.ONE_WON=new zJ(!0,cK.ONE),zJ.DRAW=new zJ(!0,uK.NONE),zJ.ONGOING=new zJ(!1,uK.NONE);class HJ{constructor(e){this.stateType=e,this.setInitialBoard()}choose(e){const t=!1;Tw(t,"Rules.choose: "+e.toString()+" was proposed");const n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){Tw(t,"Rules.choose: current node has moves");const r=this.node.getSonByMove(e);if(r.isPresent())return nq(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),Tw(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(Tw(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return Tw(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;Tw(t,"Rules.choose: Move is legal, let's apply it");const r=this.applyLegalMove(e,this.node.gameState,n.get()),i=new $J(r,Mw.of(this.node),Mw.of(e));return this.node=i,!0}setInitialBoard(){if(null==this.node){const e=this.stateType.getInitialState();$J.ruler=this,this.node=new $J(e)}else this.node=this.node.getInitialNode()}applyMoves(e,t,n){let r=0;for(const i of e){const e=n(i),s=this.isLegal(e,t);nq(s.isSuccess(),"Can't create state from invalid moves ("+r+"): "+s.toString()+"."),t=this.applyLegalMove(e,t,s.get()),r++}return t}}let GJ=(()=>{class e{}return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=()=>$localize`You cannot move more than 3 of your pieces!`,e.NOT_ENOUGH_PIECE_TO_PUSH=()=>$localize`You don't have enough pieces to push that group!`,e.CANNOT_PUSH_YOUR_OWN_PIECES=()=>$localize`You cannot push this piece because it is blocked by one of yours!`,e.MUST_ONLY_TRANSLATE_YOUR_PIECES=()=>$localize`This line contains pieces of your opponent or empty spaces, which is forbidden.`,e.TRANSLATION_IMPOSSIBLE=()=>$localize`This move is impossible, some landing spaces are occupied.`,e.LINE_AND_COORD_NOT_ALIGNED=()=>$localize`This space is not aligned with the current line.`,e})();class qJ extends HJ{static isLegal(e,t){const n=this.getFirstPieceValidity(e,t);return n.isFailure()?n.toFailedFallible():e.isSingleCoord()?qJ.isLegalPush(e,t):qJ.isLegalSideStep(e,t)}static getFirstPieceValidity(e,t){const n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?QG.failure(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===CJ.ofPlayer(t.getCurrentOpponent())?QG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):QG.SUCCESS}static isLegalPush(e,t){let n=1,r=e.coord.getNext(e.dir);const i=CJ.ofPlayer(t.getCurrentPlayer()),s=CJ.EMPTY,o=t.getCopiedBoard();for(o[e.coord.y][e.coord.x]=s;n<=3&&t.isOnBoard(r)&&t.getPieceAt(r)===i;)n++,r=r.getNext(e.dir);return n>3?ZG.failure(GJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(r)||(o[r.y][r.x]=i,t.getPieceAt(r)===s)?ZG.success(o):qJ.isLegalRealPush(r,e,t,n,o)}static isLegalRealPush(e,t,n,r,i){let s=0;const o=CJ.ofPlayer(n.getCurrentOpponent()),a=CJ.ofPlayer(n.getCurrentPlayer());for(;s<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)s++,e=e.getNext(t.dir);return s>=r?ZG.failure(GJ.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===CJ.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===a)?ZG.failure(GJ.CANNOT_PUSH_YOUR_OWN_PIECES()):ZG.success(i)}static isLegalSideStep(e,t){let n=e.lastPiece.get();const r=e.coord.getDirectionToward(n).get();n=n.getNext(r);let i=e.coord;const s=CJ.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();for(;!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==s)return ZG.failure(GJ.MUST_ONLY_TRANSLATE_YOUR_PIECES());const n=i.getNext(e.dir);if(o[i.y][i.x]=CJ.EMPTY,n.isInRange(9,9)){if(t.isPiece(n))return ZG.failure(GJ.TRANSLATION_IMPOSSIBLE());t.getPieceAt(n)===CJ.EMPTY&&(o[n.y][n.x]=s)}i=i.getNext(r)}return ZG.success(o)}static getGameStatus(e){const t=e.gameState.getScores();return t[0]>5?zJ.ZERO_WON:t[1]>5?zJ.ONE_WON:zJ.ONGOING}applyLegalMove(e,t,n){return new RJ(n,t.turn+1)}isLegal(e,t){return qJ.isLegal(e,t)}getGameStatus(e){return qJ.getGameStatus(e)}}class WJ extends TJ{getListMoves(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<9;i++)for(let e=0;e<9;e++){const s=new yJ(e,i);if(!1!==n.getPieceAt(s).is(r))for(const e of EJ.factory.all){const r=LJ.fromSingleCoord(s,e).get();if(this.isAcceptablePush(r,n)){t.push(r);for(const r of EJ.factory.all)for(let i=1;i<=2&&!r.equals(e);i++){const o=s.getNext(r,i);if(!o.isInRange(9,9))break;{const r=LJ.fromDoubleCoord(s,o,e).get();qJ.isLegal(r,n).isSuccess()&&t.push(r)}}}}}return new AJ(t).toList()}isAcceptablePush(e,t){const n=t.getScores(),r=qJ.isLegal(e,t);if(r.isSuccess()){const e=t.getCurrentOpponent().value;return!(new RJ(r.get(),t.turn+1).getScores()[e]>n[e])}return!1}getBoardValue(e){const t=qJ.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState.getScores();return new IJ(n[1]-n[0])}}class jJ{constructor(e,t,n){this.title=e,this.instruction=t,this.state=n,this.previousMove=Mw.empty()}static fromMove(e,t,n,r,i,s){return new YJ(e,t,n,r,i,s)}static forClick(e,t,n,r,i,s){return new QJ(e,t,n,r,i,s)}static anyMove(e,t,n,r,i){return new KJ(e,t,n,r,i)}static fromPredicate(e,t,n,r,i,s){return new JJ(e,t,n,r,i,s)}static informational(e,t,n){return new XJ(e,t,n)}isMove(){return!1}isAnyMove(){return!1}isClick(){return!1}isPredicate(){return!1}isInformation(){return!1}hasSolution(){return!1}withPreviousMove(e){return this.previousMove=Mw.of(e),this}}class ZJ extends jJ{constructor(e,t,n,r){super(e,t,n),this.successMessage=r}hasSolution(){return!0}getSuccessMessage(){return this.successMessage}}class YJ extends ZJ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedMoves=r,this.failureMessage=s,nq(r.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational")}isMove(){return!0}getSolution(){return this.acceptedMoves[0]}getFailureMessage(){return this.failureMessage}}class KJ extends ZJ{constructor(e,t,n,r,i){super(e,t,n,i),this.solutionMove=r}getSolution(){return this.solutionMove}isAnyMove(){return!0}}class QJ extends ZJ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedClicks=r,this.failureMessage=s}isClick(){return!0}getSolution(){return this.acceptedClicks[0]}getFailureMessage(){return this.failureMessage}}class JJ extends ZJ{constructor(e,t,n,r,i,s){super(e,t,n,s),this.solutionMove=r,this.predicate=i}getSolution(){return this.solutionMove}isPredicate(){return!0}}class XJ extends jJ{isInformation(){return!0}}const eX=CJ.EMPTY,tX=CJ.UNREACHABLE,nX=CJ.ZERO,rX=CJ.ONE;class iX{constructor(){this.tutorial=[jJ.informational($localize`Initial board and goal of the game`,$localize`At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!`,RJ.getInitialState()),jJ.anyMove($localize`Moving a piece`,$localize`At each turn, move one, two, or three pieces either along their line, or on their side.
        For your moves you can therefore choose between up to 6 directions.
        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).
        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>
        You're playing Dark, make any move!`,RJ.getInitialState(),LJ.fromSingleCoord(new yJ(2,6),EJ.UP).get(),$localize`Congratulations!`),jJ.fromMove($localize`Pushing`,$localize`To push one opponent piece, you must move at least two of your pieces.
        To push two opponent pieces, you must move three of your pieces.
        If one of your pieces is in the way, it will be impossible to push.
        You cannot move more than three pieces.<br/><br/>
        Only one push towards the right is possible here, find it. (You're playing Dark).`,new RJ([[tX,tX,tX,tX,eX,nX,nX,rX,rX],[tX,tX,tX,eX,eX,eX,eX,eX,eX],[tX,tX,eX,nX,nX,nX,rX,nX,eX],[tX,eX,eX,eX,eX,eX,eX,eX,eX],[eX,eX,eX,eX,nX,nX,nX,rX,rX],[eX,eX,eX,eX,eX,eX,eX,eX,tX],[eX,eX,eX,eX,nX,rX,eX,tX,tX],[eX,eX,eX,nX,eX,eX,tX,tX,tX],[eX,eX,nX,eX,eX,tX,tX,tX,tX]],0),[LJ.fromSingleCoord(new yJ(4,4),EJ.RIGHT).get()],$localize`Congratulations! You know everything you need to start a game!`,$localize`Failed!`)]}}function sX(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onPieceClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ia("id","piece_",e,"_",t,""),ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.getCenterBy(e,t).x)("cy",n.getCenterBy(e,t).y)("r",.5*n.SPACE_SIZE)}}function oX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",4),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onCaseClick(t,n)}),fa(),la(2,sX,1,6,"circle",5),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Ia("id","case_",t,"_",r,""),ha("ngClass",i.getSquareClasses(t,r)),ra("points",i.getHexaCoordsBy(t,r)),Ts(1),ha("ngIf",i.isPiece(n))}}function aX(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,oX,3,5,"g",3),fa()),2&e){const e=t.$implicit,n=ba(2);Ts(1),ha("ngIf",n.isBoard(e))}}function lX(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,aX,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function cX(e,t){1&e&&(Cn(),pa(0,"marker",7),ga(1,"polygon",8),fa()),2&e&&Ta("id","arrowhead_",t.$implicit.dir.toString(),"")}function uX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),ga(1,"line",9),pa(2,"line",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),pa(3,"polygon",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),Ta("id","line_start_",e.dir.toString(),""),ra("x1",e.startCenter.x)("y1",e.startCenter.y)("x2",e.middle.x)("y2",e.middle.y),Ts(1),Ta("id","line_end_",e.dir.toString(),""),ra("x1",e.middle.x)("y1",e.middle.y)("x2",e.landingCenter.x)("y2",e.landingCenter.y),Ts(1),Ta("id","direction_",e.dir.toString(),""),ra("transform",e.transformation)}}class hX{constructor(e,t,n,r,i,s){this.startCenter=e,this.middle=t,this.landingCenter=n,this.landing=r,this.dir=i,this.transformation=s}}let dX=(()=>{class e extends _J{constructor(e){super(e),this.moveds=[],this.directions=[],this.selecteds=[],this.rules=new qJ(RJ),this.availableMinimaxes=[new WJ(this.rules,"Dummy")],this.encoder=LJ.encoder,this.tutorial=(new iX).tutorial,this.scores=Mw.of([0,0]),this.SPACE_SIZE=30,this.hexaLayout=new wJ(this.SPACE_SIZE,new yJ(-8*this.SPACE_SIZE,2*this.SPACE_SIZE),bJ.INSTANCE),this.updateBoard()}updateBoard(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=Mw.of(this.rules.node.gameState.getScores())}hidePreviousMove(){this.moveds=[]}cancelMoveAttempt(){this.directions=[],this.selecteds=[]}showPreviousMove(){const e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}showPushingMove(e){const t=this.rules.node.mother.get().gameState;let n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}showSideStepMove(e){let t=e.lastPiece.get();const n=e.coord.getDirectionToward(t).get();t=t.getNext(n);let r=e.coord;for(;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}onPieceClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#piece_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=n.rules.node.gameState.getCurrentOpponent();return n.hexaBoard[t][e].is(i)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t)})()}opponentClick(e,t){var n=this;return Pw(function*(){return(yield n.tryChoosingDirection(e,t)).isSuccess()?QG.SUCCESS:n.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE())})()}firstClick(e,t){var n=this;return Pw(function*(){return n.selecteds=[new yJ(e,t)],n.showPossibleDirections(),QG.SUCCESS})()}showPossibleDirections(){this.directions=[],this.showDirection(1===this.selecteds.length)}showDirection(e){const t=this.rules.node.gameState,n=CJ.ofPlayer(t.getCurrentPlayer()),r=this.selecteds[0],i=this.selecteds[this.selecteds.length-1];for(const s of EJ.factory.all){let o,a=r.getNext(s,1);if(t.isOnBoard(a)&&t.getPieceAt(a)===n){if(e)continue;if(a=i.getNext(s,1),t.isOnBoard(a)&&t.getPieceAt(a)===n)continue}if(o=e?LJ.fromSingleCoord(r,s).get():LJ.fromDoubleCoord(r,i,s).get(),this.rules.isLegal(o,t).isSuccess()){const e=this.getCenterAt(r),t=this.getCenterAt(a),n=this.getMiddleOfArrow(s,a,t),i=t.x+" "+t.y,o=EJ.getAngle(s)+150,l=new hX(e,n,t,a,s,"rotate("+o+" "+i+") translate("+i+")");this.directions.push(l)}}}getMiddleOfArrow(e,t,n){const r=t.getPrevious(e),i=this.getCenterAt(r);return new yJ(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}isBoard(e){return e!==CJ.UNREACHABLE}isPiece(e){return e!==CJ.EMPTY}secondClick(e,t){var n=this;return Pw(function*(){const r=n.selecteds[0],i=new yJ(e,t);if(i.equals(r))return n.cancelMoveAttempt(),QG.SUCCESS;if(!1===i.isHexagonallyAlignedWith(r))return n.cancelMoveAttempt(),n.firstClick(e,t);const s=i.getDistance(r);if(s>2)return n.cancelMove(GJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES());const o=r.getDirectionToward(i).get();n.selecteds=[r];for(let e=0;e<s;e++)n.selecteds.push(r.getNext(o,e+1));if(3===n.selecteds.length){const r=n.selecteds[1],i=n.rules.node.gameState.getCurrentPlayer();if(!1===n.hexaBoard[r.y][r.x].is(i))return n.cancelMoveAttempt(),n.firstClick(e,t)}return n.showPossibleDirections(),QG.SUCCESS})()}thirdClick(e,t){var n=this;return Pw(function*(){const r=new yJ(e,t),i=n.selecteds[0];if(r.equals(i))return n.deselectExtremity(!0);const s=n.selecteds[n.selecteds.length-1];return r.equals(s)?n.deselectExtremity(!1):3===n.selecteds.length&&r.equals(n.selecteds[1])?(n.cancelMoveAttempt(),QG.SUCCESS):n.tryExtension(r,i,s)})()}tryExtension(e,t,n){var r=this;return Pw(function*(){const i=fJ.factory.fromMove(t,e);if(i.isSuccess()){const s=fJ.factory.fromMove(n,e);if(i.equals(s)){const i=t.getDistance(e),s=n.getDistance(e);return 2===Math.max(i,s)?(r.selecteds.push(e),fK.sortByDescending(r.selecteds,LJ.sortCoord),r.showPossibleDirections(),QG.SUCCESS):r.cancelMove(GJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES())}}const s=r.cancelMove(GJ.LINE_AND_COORD_NOT_ALIGNED());return yield r.firstClick(e.x,e.y),s})()}deselectExtremity(e){var t=this;return Pw(function*(){return t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),QG.SUCCESS})()}chooseDirection(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#direction_"+e.toString());return n.isFailure()?t.cancelMove(n.getReason()):t._chooseDirection(e)})()}_chooseDirection(e){var t=this;return Pw(function*(){const n=t.rules.node.gameState;let r;const i=t.selecteds[0];return r=1===t.selecteds.length?LJ.fromSingleCoord(i,e).get():LJ.fromDoubleCoord(i,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(r,n,t.scores.get())})()}onCaseClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#case_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.tryChoosingDirection(e,t)})()}tryChoosingDirection(e,t){var n=this;return Pw(function*(){const r=new yJ(e,t);for(const e of n.directions)if(e.landing.equals(r))return n._chooseDirection(e.dir);return QG.failure("not a direction")})()}getSquareClasses(e,t){const n=new yJ(e,t),r=[];return this.moveds.some(e=>e.equals(n))&&r.push("moved"),r}getPieceClasses(e,t){const n=new yJ(e,t),r=cK.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(e=>e.equals(n))&&i.push("highlighted"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-abalone"]],features:[Go],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,lX,2,1,"g",1),pa(2,"defs"),la(3,cX,2,1,"marker",2),fa(),la(4,uX,4,12,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.hexaBoard),Ts(2),ha("ngForOf",t.directions),Ts(1),ha("ngForOf",t.directions))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class pX{constructor(e){this.x=e}static from(e){switch(e){case 0:return pX.ZERO;case 1:return pX.ONE;case 2:return pX.TWO;default:return nq(3===e,"Invalid Apagos Coord "+e),pX.THREE}}equals(e){return this.x===e.x}}pX.ZERO=new pX(0),pX.ONE=new pX(1),pX.TWO=new pX(2),pX.THREE=new pX(3);let fX=(()=>{class e{}return e.PIECE_SHOULD_MOVE_DOWNWARD=()=>$localize`Pieces should only move downward!`,e.CANNOT_LAND_ON_A_FULL_SQUARE=()=>$localize`That square is already full, you cannot put a piece in it!`,e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=()=>$localize`You have no pieces in that square, select one that contains at least one of your pieces!`,e.NO_PIECE_REMAINING_TO_DROP=()=>$localize`There are no remaining pieces of that color to drop!`,e.NO_POSSIBLE_TRANSFER_REMAINS=()=>$localize`There is no possible transfer from that square!`,e})();class gX extends xJ{constructor(e,t,n){super(),this.landing=e,this.piece=t,this.starting=n}static drop(e,t){return Ow.getNonNullable(gX.ALL_MOVES.find(n=>n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(Mw.empty())))}static transfer(e,t){if(e.x<=t.x)return ZG.failure(fX.PIECE_SHOULD_MOVE_DOWNWARD());const n=Ow.getNonNullable(gX.ALL_MOVES.find(n=>n.landing.equals(t)&&n.piece.equals(Mw.empty())&&n.starting.equals(Mw.of(e))));return ZG.success(n)}isDrop(){return this.piece.isPresent()}toString(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}equals(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}gX.ALL_MOVES=[new gX(pX.ZERO,Mw.of(cK.ZERO),Mw.empty()),new gX(pX.ONE,Mw.of(cK.ZERO),Mw.empty()),new gX(pX.TWO,Mw.of(cK.ZERO),Mw.empty()),new gX(pX.THREE,Mw.of(cK.ZERO),Mw.empty()),new gX(pX.ZERO,Mw.of(cK.ONE),Mw.empty()),new gX(pX.ONE,Mw.of(cK.ONE),Mw.empty()),new gX(pX.TWO,Mw.of(cK.ONE),Mw.empty()),new gX(pX.THREE,Mw.of(cK.ONE),Mw.empty()),new gX(pX.TWO,Mw.empty(),Mw.of(pX.THREE)),new gX(pX.ONE,Mw.empty(),Mw.of(pX.THREE)),new gX(pX.ZERO,Mw.empty(),Mw.of(pX.THREE)),new gX(pX.ONE,Mw.empty(),Mw.of(pX.TWO)),new gX(pX.ZERO,Mw.empty(),Mw.of(pX.TWO)),new gX(pX.ZERO,Mw.empty(),Mw.of(pX.ONE))],gX.encoder=new class extends aK{maxValue(){return gX.ALL_MOVES.length}encodeNumber(e){const t=gX.ALL_MOVES.findIndex(t=>t.equals(e));return nq(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}decodeNumber(e){return nq(e<gX.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),gX.ALL_MOVES[e]}};class mX{constructor(e){this.containing=e}static from(e,t,n){if(e+t>n)return ZG.failure("invalid starting space");const r=new UJ([{key:cK.ZERO,value:e},{key:cK.ONE,value:t},{key:uK.NONE,value:n}]);r.makeImmutable();const i=new mX(r);return ZG.success(i)}isFull(){return this.count(cK.ZERO)+this.count(cK.ONE)>=this.count(uK.NONE)}count(e){return this.containing.get(e).get()}addPiece(e){let t=this.count(cK.ZERO),n=this.count(cK.ONE);const r=this.count(uK.NONE);return e===cK.ZERO?t++:n++,mX.from(t,n,r).get()}substractPiece(e){let t=this.count(cK.ZERO),n=this.count(cK.ONE);const r=this.count(uK.NONE);return e===cK.ZERO?t--:n--,mX.from(t,n,r).get()}getDominatingPlayer(){const e=this.count(cK.ZERO),t=this.count(cK.ONE);return e>t?cK.ZERO:t>e?cK.ONE:uK.NONE}equals(e){return this.containing.equals(e.containing)}}let yX=(()=>{class e extends MJ{constructor(e,t,n){super(e),this.board=t,this.remaining=n,this.remaining.makeImmutable()}static getInitialState(){return e.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}static fromRepresentation(t,n,r,i){const s=[];for(let e=0;e<4;e++){const t=mX.from(n[0][e],n[1][e],n[2][e]).get();s.push(t)}const o=new UJ;return o.set(cK.ZERO,r),o.set(cK.ONE,i),new e(t,s,o)}getPieceAt(e){return this.board[e.x]}updateAt(t,n){const r=[];for(let e=0;e<4;e++)r.push(t.x===e?n:this.board[e]);const i=this.getRemainingCopy();return new e(this.turn,r,i)}getRemainingCopy(){return this.remaining.getCopy()}getRemaining(e){return this.remaining.get(e).get()}equals(e){return this.turn===e.turn&&fK.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}return e.PIECES_PER_PLAYER=10,e})();class vX extends HJ{static get(){return vX.singleton.isAbsent()&&(vX.singleton=Mw.of(new vX(yX))),this.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}applyLegalDrop(e,t){const n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);const i=new yX(t.turn+1,t.board,n),s=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(s);if(e.landing===pX.THREE)return i.updateAt(e.landing,o);{const t=pX.from(e.landing.x+1),n=i.getPieceAt(t);return i.updateAt(e.landing,n).updateAt(t,o)}}applyLegalTransfer(e,t){const n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),s=t.getPieceAt(e.landing).addPiece(n);let o=t.updateAt(r,i);return o=o.updateAt(e.landing,s),new yX(o.turn+1,o.board,o.remaining)}isLegal(e,t){return t.getPieceAt(e.landing).isFull()?ZG.failure(fX.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}isLegalDrop(e,t){return t.getRemaining(e.piece.get())<=0?ZG.failure(fX.NO_PIECE_REMAINING_TO_DROP()):ZG.success(void 0)}isLegalSlideDown(e,t){const n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?ZG.failure(fX.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):ZG.success(void 0)}getGameStatus(e){const t=e.gameState;for(let r=0;r<4;r++)if(!1===t.getPieceAt(pX.from(r)).isFull())return zJ.ONGOING;const n=t.getPieceAt(pX.THREE).getDominatingPlayer();return nq(n.isPlayer(),"winner can only be a player if the game is finished"),zJ.getVictory(n)}}vX.singleton=Mw.empty();class _X extends TJ{getListMoves(e){const t=e.gameState;return gX.ALL_MOVES.filter(function(e){return vX.get().isLegal(e,t).isSuccess()})}getBoardValue(e){const t=vX.get().getGameStatus(e);if(t.isEndGame)return IJ.fromWinner(t.winner);const n=e.gameState.board[3].getDominatingPlayer();return n.isPlayer()?new IJ(n.getScoreModifier()):new IJ(0)}}class CX{constructor(){this.tutorial=[jJ.informational($localize`Initial board and goal of the game`,$localize`At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!`,yX.getInitialState()),jJ.anyMove($localize`Drop`,$localize`There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You're playing Light.<br/><br/>Drop a piece on one of those three squares.`,yX.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),gX.drop(pX.ZERO,cK.ZERO),$localize`Congratulations!`),jJ.fromPredicate($localize`Transfer`,$localize`The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!`,yX.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),gX.transfer(pX.TWO,pX.ZERO).get(),(e,t)=>e.isDrop()?QG.failure($localize`This move is a drop, please do a transfer!`):QG.SUCCESS,$localize`Congratulations!`),jJ.fromPredicate($localize`Victory`,$localize`When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!`,yX.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),gX.drop(pX.TWO,cK.ONE),(e,t)=>e.isDrop()?e.piece.equalsValue(cK.ONE)?QG.SUCCESS:QG.failure($localize`You actively made your opponent win!`):QG.failure($localize`Wrong choice, your opponent will win in the next turn no matter which piece is dropped!`),$localize`Congratulations!`)]}}function EX(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=t.$implicit,n=ba();ra("cx",(e+1)*n.PIECE_RADIUS)("cy",n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function wX(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.PlayerOrNone.ZERO)}),fa()}if(2&e){const e=ba().index,t=ba();Ta("id","dropArrow_zero_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ZERO)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ZERO))}}function SX(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.PlayerOrNone.ONE)}),fa()}if(2&e){const e=ba().index,t=ba();Ta("id","dropArrow_one_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ONE)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ONE))}}function bX(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",8),Ea("click",function(){Gt(e);const t=ba().index;return ba().onSquareClick(t)}),fa(),ya()}if(2&e){const e=t.$implicit,n=ba(),r=n.index,i=n.$implicit,s=ba();Ts(1),ka("id","square_",r,"_piece_",e,"_out_of_",i.count(s.PlayerOrNone.NONE),""),ha("ngClass",s.getPieceClasses(r,e,i)),ra("cx",s.getCircleCenter(r,e,i).x)("cy",s.getCircleCenter(r,e,i).y)}}function PX(e,t){if(1&e){const e=va();Cn(),ma(0),la(1,wX,1,4,"polygon",6),la(2,SX,1,4,"polygon",6),pa(3,"rect",7),Ea("click",function(){const t=Gt(e).index;return ba().onSquareClick(t)}),fa(),la(4,bX,2,6,"ng-container",3),ya()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ZERO)),Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ONE)),Ts(1),Ta("id","square_",n,""),ha("ngClass",r.getSquareClasses(n)),ra("x",n*r.SPACE_SIZE)("y",(5-n)*r.SPACE_SIZE*.25)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngForOf",r.range(e.count(r.PlayerOrNone.NONE)))}}function OX(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=t.$implicit,n=ba();ra("cx",4*n.SPACE_SIZE-(e+1)*n.PIECE_RADIUS)("cy",2.25*n.SPACE_SIZE+3*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}let TX=(()=>{class e extends vJ{constructor(t){super(t),this.PlayerOrNone=uK,this.ARROW_COORD=e.getArrowCoord(),this.PIECES_PER_PLAYER=yX.PIECES_PER_PLAYER,this.selectedPiece=Mw.empty(),this.leftPiece=Mw.empty(),this.droppedPiece=Mw.empty(),this.displayableArrow=[],this.rules=new vX(yX),this.availableMinimaxes=[new _X(this.rules,"ApagosDummyMinimax")],this.encoder=gX.encoder,this.tutorial=(new CX).tutorial,this.PIECE_RADIUS=200/(this.PIECES_PER_PLAYER+1),this.updateBoard()}static getArrowCoord(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}cancelMoveAttempt(){this.selectedPiece=Mw.empty(),this.showPossibleDrops()}updateBoard(){const e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(cK.ZERO).get(),this.remainingOne=e.remaining.get(cK.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}hideLastMove(){this.movedSquare=[],this.droppedPiece=Mw.empty(),this.leftPiece=Mw.empty(),this.selectedPiece=Mw.empty()}showLastMove(){const e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}showLastDrop(e){const t=e.piece.get();let n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));const r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=Mw.of({square:n,piece:r})}getLowestPlayerPiece(e,t){const n=e.count(t);return t===cK.ZERO?n-1:e.count(uK.NONE)-n}showLastTransfer(e){const t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=Mw.of({square:r,piece:i});const s=e.landing.x,o=this.getLowestPlayerPiece(this.board[s],n);this.droppedPiece=Mw.of({square:s,piece:o})}showPossibleDrops(){this.displayableArrow=[];const e=this.rules.node.gameState;for(let t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(cK.ZERO).get()>0&&this.displayableArrow.push({x:t,player:cK.ZERO}),e.remaining.get(cK.ONE).get()>0&&this.displayableArrow.push({x:t,player:cK.ONE}))}getCircleCenter(e,t,n){const r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(uK.NONE))return new yJ(r,i);const s=n.count(uK.NONE),o=2*t*Math.PI/s-Math.PI/2,a=.3*this.SPACE_SIZE,l=a*Math.cos(o),c=a*Math.sin(o);return new yJ(r+l,i+c)}canDisplayArrow(e,t){return this.displayableArrow.some(n=>n.x===e&&n.player.equals(t))}getArrowClasses(e,t){return[this.getPlayerClass(t)]}getArrowTransform(e,t){let n=t===cK.ZERO?0:.5*this.SPACE_SIZE;return n+=e*this.SPACE_SIZE,"translate("+n+", "+(3-e)*this.SPACE_SIZE*.25+")"}getSquareClasses(e){const t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}onArrowClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#dropArrow_"+(t===cK.ZERO?"zero":"one")+"_"+e);if(r.isFailure())return n.cancelMove(r.getReason());const i=pX.from(e);let s;if(n.selectedPiece.isPresent()){const e=n.selectedPiece.get().square;s=gX.transfer(pX.from(e),i).get()}else s=gX.drop(i,t);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e,t,n){const r={square:e,piece:t},i=[];let s=n.count(cK.ZERO),o=n.count(cK.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===cK.ZERO?s++:o++}const a=n.count(uK.NONE)-(o+s),l=this.getPieceColor(t,s,a);return""!==l&&i.push(l),i}getPieceColor(e,t,n){return e<t?"player0":e>=t+n?"player1":""}onSquareClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#square_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.selectedPiece.isPresent()&&t.selectedPiece.get().square===e)return t.cancelMoveAttempt(),QG.SUCCESS;const r=t.rules.node.gameState.getCurrentPlayer(),i=t.board[e];return i.count(r)<=0?t.cancelMove(fX.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=Mw.of({square:e,piece:t.getLowestPlayerPiece(i,r)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(fX.NO_POSSIBLE_TRANSFER_REMAINS()):QG.SUCCESS)})()}showAndGetPossibleTranfers(){this.displayableArrow=[];let e=this.selectedPiece.get().square-1;const t=this.rules.node.gameState.getCurrentPlayer();for(;0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-apagos"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,EX,1,3,"circle",1),pa(2,"g",2),la(3,PX,5,9,"ng-container",3),fa(),la(4,OX,1,3,"circle",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.range(t.remainingZero)),Ts(1),ra("transform","translate(0, "+2*t.PIECE_RADIUS+")"),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.range(t.remainingOne)))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),IX=(()=>{class e extends vJ{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class kX extends NJ{constructor(e,t,n){super(e,t),this.captured=n}static getInitialState(){const e=fK.createTable(6,2,4);return new kX(e,0,[0,0])}getCapturedCopy(){return[this.captured[0],this.captured[1]]}}let AX=(()=>{class e{}return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=()=>$localize`You cannot distribute from the opponent's home.`,e.MUST_CHOOSE_NONEMPTY_HOUSE=()=>$localize`You should choose a non-empty house to distribute.`,e.SHOULD_DISTRIBUTE=()=>$localize`You should distribute but you do not.`,e})(),MX=(()=>{class e extends HJ{applyLegalMove(t,n,r){Tw(e.VERBOSE,{called:"AwaleRules.applyLegalMove",move:t,state:n});const i=t.x,s=n.getCurrentPlayer().value,o=n.getCurrentPlayer().getOpponent().value;let a=n.getCopiedBoard();const l=e.distribute(i,s,a);if(l.y===s)return new kX(a,n.turn+1,n.captured);{let t=[0,0];const r=fK.copyBiArray(a);return t[s]=e.capture(l.x,o,s,a),t[s]>0&&e.isStarving(o,a)&&(a=r,t=[0,0]),e.isStarving(s,a)&&!1===e.canDistribute(o,a)&&(t[o]+=e.mansoon(o,a)),t[0]+=n.captured[0],t[1]+=n.captured[1],new kX(a,n.turn+1,t)}}static mansoon(e,t){let n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}static isLegal(t,n){const r=n.getCurrentPlayer().value,i=n.getCurrentPlayer().getOpponent().value,s=t.x;if(0===n.getPieceAtXY(s,r))return ZG.failure(AX.MUST_CHOOSE_NONEMPTY_HOUSE());const o=e.isStarving(i,n.board),a=!1===e.doesDistribute(s,r,n.board);return o&&a?ZG.failure(AX.SHOULD_DISTRIBUTE()):ZG.success(void 0)}isLegal(t,n){return e.isLegal(t,n)}static doesDistribute(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}static canDistribute(t,n){for(let r=0;r<6;r++)if(e.doesDistribute(r++,t,n))return!0;return!1}static isStarving(e,t){let n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}static distribute(e,t,n){const r=e,i=t;let s=n[t][e];for(n[t][e]=0;s>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,s--);return new yJ(e,t)}static capture(e,t,n,r){nq(t!==n,"AwaleRules.capture called with wrong values of x and player");let i=r[t][e];if(i<2||i>3)return 0;let s=0,o=-1,a=-1;0===n&&(o=1,a=6);do{s+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==a&&(2===i||3===i));return s}static getGameStatus(e){const t=e.gameState;return t.captured[0]>24?zJ.ZERO_WON:t.captured[1]>24?zJ.ONE_WON:24===t.captured[0]&&24===t.captured[1]?zJ.DRAW:zJ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class NX extends xJ{constructor(e){super(),this.x=e}static from(e){switch(e){case 0:return NX.ZERO;case 1:return NX.ONE;case 2:return NX.TWO;case 3:return NX.THREE;case 4:return NX.FOUR;default:return nq(5===e,"Invalid x for AwaleMove: "+e),NX.FIVE}}equals(e){return e===this||e.x===this.x}toString(){return"AwaleMove("+this.x+")"}}NX.ZERO=new NX(0),NX.ONE=new NX(1),NX.TWO=new NX(2),NX.THREE=new NX(3),NX.FOUR=new NX(4),NX.FIVE=new NX(5),NX.encoder=new class extends aK{maxValue(){return 5}encodeNumber(e){return e.x}decodeNumber(e){return NX.from(e)}};class RX extends TJ{getListMoves(e){const t=[],n=e.gameState,r=n.turn%2;let i,s=0;do{0!==n.getPieceAtXY(s,r)&&(i=NX.from(s),MX.isLegal(i,n).isSuccess()&&(i=NX.from(s),t.push(i))),s++}while(s<6);return this.orderMoves(e,t)}orderMoves(e,t){const n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return fK.sortByDescending(t,t=>{const i=e.gameState.getCopiedBoard(),s=i[n][t.x],o=MX.distribute(t.x,n,i);let a,l=0;return o.y===n?(a=0,s<=6&&(l=10)):a=MX.capture(o.x,r,n,i),100*a+l-s}),t}getBoardValue(e){const t=MX.getGameStatus(e);if(t.isEndGame)return IJ.fromWinner(t.winner);const n=e.gameState.getCapturedCopy();return new IJ(n[1]-n[0])}}class xX{constructor(){this.tutorial=[jJ.anyMove($localize`Sowing`,$localize`Awal is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.
         Let's see how seeds are sown.
         As you're playing first, the 6 houses on the top are yours.<br/><br>
         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house.`,kX.getInitialState(),NX.ZERO,$localize`Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.
        This is how seeds are sown:
        one by one from the house next to the one they come from, clockwise.`),jJ.anyMove($localize`Big sowing`,$localize`You are now the second player (on the bottom).
        When there are enough seeds to make a full turn, something else happens.<br/><br/>
        Sow the house that contains 12 seeds.`,new kX([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),NX.ONE,$localize`See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds).`),jJ.fromMove($localize`Simple capture`,$localize`After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.
         Then, the player looks at the preceding house:
         if it is still in the opponent's side and contains two or three seeds, they are also captured.
         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>
         You are the second player, try to capture some pieces!`,new kX([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[NX.ZERO],$localize`Well done! This was a simple capture, now let us see how to make multiple captures.`,$localize`Failed. Try again and sow from the leftmost house.`),jJ.fromMove($localize`Multiple captures`,$localize`By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.
        As these are consecutive houses, all seeds in them will be captured.<br/><br/>
        Capture them.`,new kX([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[NX.ZERO],$localize`Nice, you win 3 points from the first house, and 2 from the second!`,$localize`Failed. Try again.`),jJ.fromMove($localize`Interrupted capture`,$localize`By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>
        Do it.`,new kX([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[NX.ZERO],$localize`Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house.`,$localize`Failed. Try again.`),jJ.fromMove($localize`Capture on the other side only`,$localize`Try to capture the two leftmost houses of the opponent.`,new kX([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[NX.ONE],$localize`Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!`,$localize`You have only captured one house, try again!`),jJ.fromMove($localize`Do not starve`,$localize`You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>
        Try it.`,new kX([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[NX.ZERO],$localize`Sadly, you cannot capture here, otherwise the opponent could not play after you.
        When this happens, the move can be made, but no capture takes place!`,$localize`Failed. Try again.`),jJ.anyMove($localize`Feeding is mandatory`,$localize`You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>
        Go ahead!`,new kX([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),NX.THREE,$localize`Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.
        It is often a good way to have easy captures!`),jJ.anyMove($localize`End of the game`,$localize`A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>
         Sow the house on the top right.`,new kX([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),NX.FIVE,$localize`Also, as soon as on player cannot play, the other player captures all the seeds in its own side.
         Here, it was the first player's turn, and the second player has taken all the remaining seeds.`)]}}function DX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"text",5),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),Qa(3),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("cx",50+100*n)("cy",50+120*r),Ts(1),ra("x",50+100*n)("y",66+120*r),Ts(1),Xa(" ",e," ")}}function LX(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,DX,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let FX=(()=>{class e extends IX{constructor(e){super(e),this.last=Mw.empty(),this.captured=[],this.moved=[],this.scores=Mw.of([0,0]),this.rules=new MX(kX),this.availableMinimaxes=[new RX(this.rules,"AwaleMinimax")],this.encoder=NX.encoder,this.tutorial=(new xX).tutorial,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState;this.scores=Mw.of(e.getCapturedCopy()),this.hidePreviousMove();const t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){const n=e.getCurrentOpponent().value;this.last=Mw.of(new yJ(t.get().x,n)),this.showPreviousMove()}else this.last=Mw.empty()}hidePreviousMove(){this.captured=[],this.moved=[]}showPreviousMove(){const e=this.rules.node.mother.get().gameState;for(let t=0;t<=1;t++)for(let n=0;n<=5;n++){const r=new yJ(n,t),i=this.board[t][n],s=e.getPieceAt(r);this.last.equalsValue(r)||(i<s?this.captured.push(r):i>s&&this.moved.push(r))}}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(t!==n.rules.node.gameState.getCurrentPlayer().value)return n.cancelMove(AX.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME());n.last=Mw.empty();const i=NX.from(e);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}getSquareClasses(e,t){const n=new yJ(e,t);return this.captured.some(e=>e.equals(n))?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(e=>e.equals(n))?["moved"]:[]}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-awale-component"]],features:[Go],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,LX,2,1,"g",2),ga(3,"line",3),fa()),2&e&&(Ts(2),ha("ngForOf",t.board))},directives:[tp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class UX extends DJ{constructor(e,t){if(super(e.x,e.y),e.equals(t))throw new Error(OJ.MOVE_CANNOT_BE_STATIC());this.end=t}static getEncoder(e,t,n){return new class extends aK{constructor(){super(...arguments),this.shiftAX=t,this.shiftDY=this.shiftAX*e,this.shiftDX=this.shiftDY*t}maxValue(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}decodeNumber(r){const i=r%t;r/=t;const s=new yJ((r-=r%1)%e,i);r/=e;const o=(r-=r%1)%t;r/=t;const a=new yJ((r-=r%1)%e,o);return n(a,s)}}}length(){return this.coord.getDistance(this.end)}getDirection(){return fJ.factory.fromMove(this.coord,this.end)}}let BX=(()=>{class e{}return e.LANDING_ON_OCCUPIED_CASE=()=>$localize`You cannot land on an occupied square.`,e.THRONE_IS_LEFT_FOR_GOOD=()=>$localize`Once you left the central throne, you cannot return to it.`,e.SOLDIERS_CANNOT_SIT_ON_THRONE=()=>$localize`Soldiers cannot sit on the throne.`,e.MOVE_MUST_BE_ORTHOGONAL=()=>$localize`Tafl moves must be orthogonal.`,e})();class VX extends UX{constructor(e,t){if(super(e,t),e.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(t.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+t.toString()+".");const n=e.getDirectionToward(t);if(n.isFailure()||n.get().isDiagonal())throw new Error(BX.MOVE_MUST_BE_ORTHOGONAL())}equals(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"TaflMove("+this.coord+"->"+this.end+")"}}class $X extends VX{static of(e,t){return new $X(e,t)}static from(e,t){try{const n=new $X(e,t);return ZG.success(n)}catch(n){return ZG.failure(n.message)}}getMaximalDistance(){return 7}}$X.encoder=UX.getEncoder(7,7,$X.of);const zX={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:cK.ZERO};class HX{constructor(e,t){this.owner=e,this.king=t}isKing(){return this.king}getOwner(){return this.owner}}HX.UNOCCUPIED=new HX(uK.NONE,!1),HX.PLAYER_ONE_KING=new HX(cK.ONE,!0),HX.INVADERS=new HX(cK.ZERO,!1),HX.DEFENDERS=new HX(cK.ONE,!1);class GX{constructor(e){this.value=e}}GX.NONE=new GX("NONE"),GX.OPPONENT=new GX("OPPONENT"),GX.PLAYER=new GX("PLAYER");class qX extends NJ{isCentralThrone(e){return e.equals(this.getCentralThrone())}getCentralThrone(){const e=(this.board.length-1)/2;return new yJ(e,e)}getRelativeOwner(e,t){const n=this.getAbsoluteOwner(t);let r;return r=n===uK.NONE?GX.NONE:e===n?GX.PLAYER:GX.OPPONENT,r}getAbsoluteOwner(e){return this.getPieceAt(e).getOwner()}}class WX extends qX{static getInitialState(){const e=HX.UNOCCUPIED,t=HX.INVADERS,n=HX.DEFENDERS;return new WX([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,n,e,e,e],[t,t,n,HX.PLAYER_ONE_KING,n,t,t],[e,e,e,n,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}from(e,t){return new WX(e,t)}}let jX=(()=>{class e extends HJ{constructor(e,t,n){super(e),this.config=t,this.generateMove=n}isLegal(t,n){Tw(e.VERBOSE,{tablutRules_isLegal:{move:t,state:n}});const r=n.getCurrentPlayer(),i=this.getMoveValidity(r,t,n);return i.isFailure()?ZG.failure(i.getReason()):ZG.success(void 0)}getMoveValidity(e,t,n){const r=n.getRelativeOwner(e,t.coord);if(r===GX.NONE)return QG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE());if(r===GX.OPPONENT)return QG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==GX.NONE)return QG.failure(BX.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return QG.failure(BX.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return QG.failure(BX.THRONE_IS_LEFT_FOR_GOOD())}const i=t.coord.getDirectionToward(t.end).get(),s=t.coord.getOrthogonalDistance(t.end);let o=t.coord.getNext(i);for(let a=1;a<s;a++){if(n.getPieceAt(o)!==HX.UNOCCUPIED)return QG.failure(OJ.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return QG.SUCCESS}isThrone(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}isExternalThrone(e){const t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}tryCapture(e,t,n,r){const i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===GX.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):Mw.empty()}captureKing(e,t,n,r){const i=t.getNext(n),{backCoord:s,back:o,backInRange:a,left:l,leftCoord:c,right:u,rightCoord:h}=this.getSurroundings(i,n,e,r);return!1===a?this.captureKingAgainstTheWall(l,u,i):o===GX.NONE&&this.isThrone(r,s)?this.captureKingAgainstThrone(s,i,l,u):o===GX.PLAYER?this.captureKingWithAtLeastASandwich(r,i,l,c,u,h):Mw.empty()}getSurroundings(e,t,n,r){const i=e.getNext(t),s=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=s?r.getRelativeOwner(n,i):GX.NONE,a=e.getLeft(t),l=a.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,a):GX.NONE,c=e.getRight(t),u=c.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,c):GX.NONE;return{backCoord:i,back:o,backInRange:s,leftCoord:a,left:l,rightCoord:c,right:u}}captureKingAgainstTheWall(t,n,r){let i=t===GX.PLAYER?1:0;return i+=n===GX.PLAYER?1:0,2===i&&this.config.BORDER_CAN_SURROUND_KING?(Tw(e.VERBOSE||!1,"king captured by 3 invaders against 1 border"),Mw.of(r)):Mw.empty()}captureKingAgainstThrone(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return Mw.of(t)}else{const e=r===GX.PLAYER,i=n===GX.PLAYER||e;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&i)return Mw.of(t)}return Mw.empty()}capturePawn(t,n,r,i){const s=!1,o=n.getNext(r),a=o.getNext(r);let l=GX.NONE;return a.isInRange(this.config.WIDTH,this.config.WIDTH)&&(l=i.getRelativeOwner(t,a)),l===GX.NONE?!1===this.isThrone(i,a)?(Tw(e.VERBOSE||s,"cannot capture a pawn without an ally; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),Mw.empty()):(Tw(e.VERBOSE||s,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.of(o)):l===GX.PLAYER?(Tw(e.VERBOSE||s,"pawn captured by 2 opponents; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.of(o)):(Tw(e.VERBOSE||s,"no captures; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.empty())}captureKingWithAtLeastASandwich(t,n,r,i,s,o){if(!1===this.kingTouchCentralThrone(t,n)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return Mw.of(n);const a=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,l=this.isThrone(t,i),c=r===GX.PLAYER||l&&a,u=this.isThrone(t,o);return c&&(s===GX.PLAYER||u&&a)?(Tw(e.VERBOSE||!1,"king captured by 4 invaders"),Mw.of(n)):Mw.empty()}kingTouchCentralThrone(e,t){const n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}applyLegalMove(t,n){Tw(e.VERBOSE,{TablutRules_applyLegalMove:{move:t,state:n}});const r=n.turn,i=n.getCopiedBoard(),s=n.getCurrentPlayer(),o=t.coord,a=t.end;i[a.y][a.x]=i[o.y][o.x],i[o.y][o.x]=HX.UNOCCUPIED;for(const e of gJ.ORTHOGONALS){const r=this.tryCapture(s,t.end,e,n);r.isPresent()&&(i[r.get().y][r.get().x]=HX.UNOCCUPIED)}return n.from(i,r+1)}getGameStatus(e){const t=this.getWinner(e.gameState);return t.isPresent()?zJ.getVictory(t.get()):zJ.ONGOING}getWinner(e){const t=!1,n=this.getKingCoord(e);if(n.isAbsent())return Tw(t,"The king is dead, victory to invader"),Mw.of(this.getInvader());const r=n.get();return this.isExternalThrone(r)?(Tw(t,"The king escape, victory to defender"),Mw.of(this.getDefender())):this.isPlayerImmobilized(cK.ZERO,e)?(Tw(t,"Zero has no move, victory to one"),Mw.of(cK.ONE)):this.isPlayerImmobilized(cK.ONE,e)?(Tw(t,"One has no move, victory to zero"),Mw.of(cK.ZERO)):(Tw(t,"no victory"),Mw.empty())}getKingCoord(t){Tw(e.VERBOSE,{TablutRules_getKingCoord:{state:t,con:this.config}});for(let e=0;e<this.config.WIDTH;e++)for(let n=0;n<this.config.WIDTH;n++)if(t.getPieceAtXY(n,e).isKing())return Mw.of(new yJ(n,e));return Mw.empty()}getInvader(){return this.config.INVADER}getDefender(){return this.config.INVADER.getOpponent()}isPlayerImmobilized(e,t){return 0===this.getPlayerListMoves(e,t).length}getPlayerListMoves(t,n){const r=[],i=this.getPlayerListPawns(t,n);Tw(e.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:t,state:n}});for(const e of i){const t=this.getPossibleDestinations(e,n);for(const n of t){const t=this.generateMove(e,n);r.push(t)}}return r}getPlayerListPawns(e,t){const n=[];for(let r=0;r<this.config.WIDTH;r++)for(let i=0;i<this.config.WIDTH;i++){const s=new yJ(i,r);t.getAbsoluteOwner(s)===e&&n.push(s)}return n}getPossibleDestinations(e,t){const n=[];let r;for(const i of gJ.ORTHOGONALS){r=e.getNext(i,1);let s=!1;for(;r.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(r)===uK.NONE?this.isExternalThrone(r)?t.getPieceAt(e).isKing()&&n.push(r):t.isCentralThrone(r)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&n.push(r):n.push(r):s=!0,r=r.getNext(i,1)}return n}}return e.VERBOSE=!1,e})();class ZX extends jX{constructor(){super(WX,zX,$X.of)}static get(){return null==ZX.singleton&&(ZX.singleton=new ZX),$J.ruler=this.singleton,ZX.singleton}}class YX extends IX{constructor(e,t,n){super(e),this.VERBOSE=t,this.generateMove=n,this.viewInfo={pieceClasses:[]},this.EMPTY=HX.UNOCCUPIED,this.captureds=[],this.chosen=new yJ(-1,-1),this.lastMove=Mw.empty()}getViewBox(){const e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}updateBoard(){Tw(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove(),this.updateViewInfo()}showPreviousMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState.getCurrentOpponent();for(const n of gJ.ORTHOGONALS){const r=this.lastMove.get().end.getNext(n,1);if(r.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){const n=e.getRelativeOwner(t,r)===GX.OPPONENT,i=this.rules.node.gameState.getPieceAt(r)===HX.UNOCCUPIED;n&&i&&this.captureds.push(r)}}}updateViewInfo(){const e=[];for(let t=0;t<this.board.length;t++){const n=[];for(let e=0;e<this.board[0].length;e++){let r=[];r=this.board[t][e].getOwner()===uK.NONE?[""]:this.getPieceClasses(e,t),n.push(r)}e.push(n)}this.viewInfo={pieceClasses:e}}onClick(e,t){var n=this;return Pw(function*(){Tw(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")");const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t)})()}chooseDestination(e,t){var n=this;return Pw(function*(){Tw(n.VERBOSE,"TaflComponent.chooseDestination");const r=n.chosen,i=new yJ(e,t),s=n.generateMove(r,i);return s.isSuccess()?(n.cancelMove(),yield n.chooseMove(s.get(),n.rules.node.gameState)):n.cancelMove(s.getReason())})()}choosePiece(e,t){return Tw(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===HX.UNOCCUPIED?this.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new yJ(e,t),this.updateViewInfo(),Tw(this.VERBOSE,"selected piece = ("+e+", "+t+")"),QG.SUCCESS):this.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE())}pieceBelongToCurrentPlayer(e,t){const n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new yJ(e,t);return n.getRelativeOwner(r,i)===GX.PLAYER}cancelMoveAttempt(){this.chosen=new yJ(-1,-1)}isThrone(e,t){return this.rules.isThrone(this.rules.node.gameState,new yJ(e,t))}isCentralThrone(e,t){return!1===this.rules.node.gameState.isCentralThrone(new yJ(e,t))}getPieceClasses(e,t){const n=[],r=new yJ(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}getRectClasses(e,t){const n=[],r=new yJ(e,t);if(this.captureds.some(e=>e.equals(r)))n.push("captured");else if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;(r.equals(e)||r.equals(t))&&n.push("moved")}return n}getClickables(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new yJ(n,t));return e}isClickable(e,t){return this.pieceBelongToCurrentPlayer(e,t)}isInvader(e,t){return this.board[t][e]===HX.INVADERS}isKing(e,t){return this.board[t][e].isKing()}}class KX extends TJ{getListMoves(e){Tw(!1,{TaflMinimax_getListMoves:{node:e}});const t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}orderMoves(e,t){const n=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?fK.sortByDescending(t,e=>-e.end.getOrthogonalDistance(n)):fK.sortByDescending(t,e=>e.coord.equals(n)?this.ruler.isExternalThrone(e.end)?2:1:0),t}getBoardValue(e){const t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new IJ(n.get().getVictoryValue());const r=this.ruler.getPlayerListPawns(cK.ZERO,t).length,i=this.ruler.getPlayerListPawns(cK.ONE,t).length;let s=[1,2][this.ruler.config.INVADER.value];s*=cK.ZERO.getScoreModifier();let o=[2,1][this.ruler.config.INVADER.value];return o*=cK.ONE.getScoreModifier(),new IJ(r*s+i*o)}}class QX{constructor(e,t){this.directThreats=e,this.mover=t}equals(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}class JX extends QX{constructor(e,t){super(new AJ([e]),t),this.directThreat=e,this.mover=t}}class XX extends AJ{constructor(e){if(super(),this.map=[],this.values=[],void 0!==e)for(const t of e)this.add(t)}add(e){const t=this.toFields(e);let n=this.map;for(const i of t[0])void 0===n[i]&&(n[i]=[]),n=n[i];const r=t[1];return void 0===n[r]&&(n[r]=!0,this.values.push(e),!0)}contains(e){const t=this.toFields(e);let n=this.map;for(const r of t[0]){if(void 0===n[r])return!1;n=n[r]}return void 0!==n[t[1]]}[Symbol.iterator](){return this.values.values()}}class e1 extends XX{toFields(e){return[[e.y],e.x]}}class t1 extends KX{constructor(e,t){super(e,t),this.width=this.ruler.config.WIDTH,this.maxInfluence=16*(2*this.width-2),this.scoreByThreatenedPiece=16*this.maxInfluence+1,this.scoreBySafePiece=16*this.scoreByThreatenedPiece+1}getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState,r=HX.UNOCCUPIED;let i=0;const s=this.getPiecesMap(n),o=this.getThreatMap(n,s),a=this.filterThreatMap(o,n);for(const l of cK.PLAYERS)for(const e of s.get(l).get())if(a.get(e).isPresent())i+=l.getScoreModifier()*this.scoreByThreatenedPiece;else{i+=l.getScoreModifier()*this.scoreBySafePiece;let t=0;for(const i of gJ.ORTHOGONALS){let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&n.getPieceAt(s)===r;)t++,s=s.getNext(i,1)}i+=t*l.getScoreModifier()}return new IJ(i)}getPiecesMap(e){const t=HX.UNOCCUPIED,n=[],r=[];for(let i=0;i<this.width;i++)for(let s=0;s<this.width;s++){const o=new yJ(s,i);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===cK.ZERO?n.push(o):r.push(o))}return new UJ([{key:cK.ZERO,value:new e1(n)},{key:cK.ONE,value:new e1(r)}])}getThreatMap(e,t){const n=new UJ;for(const r of cK.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreats(i,e);this.isThreatReal(i,e,t)&&n.set(i,new AJ(t))}return n}getThreats(e,t){const n=t.getAbsoluteOwner(e);nq(n.isPlayer(),"TaflPieceAndInfluenceMinimax.getThreats should be called with an occupied coordinate");const r=n.getOpponent(),i=[];for(const s of gJ.ORTHOGONALS){const n=e.getPrevious(s,1);if(this.isAThreat(n,t,r)){const o=[];for(const n of gJ.ORTHOGONALS){if(n===s.getOpposite())continue;let i=e.getNext(s,1);for(;i.isInRange(this.width,this.width)&&t.getPieceAt(i)===HX.UNOCCUPIED;)i=i.getNext(n);i.isInRange(this.width,this.width)&&t.getAbsoluteOwner(i)===r&&!1===e.getNext(s,1).equals(i)&&o.push(i)}i.push(new JX(n,new e1(o)))}}return i}isAThreat(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==cK.ONE&&t.getPieceAt(e)!==HX.UNOCCUPIED))}isThreatReal(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;for(const r of n)if(r.mover.size()>0)return!0;return!1}filterThreatMap(e,t){const n=new UJ,r=e.listKeys(),i=r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentPlayer()),s=new e1(r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentOpponent()));for(const o of i){const t=e.get(o).get(),r=[];for(const e of t)if(!1===s.contains(e.directThreat)){const t=[];for(const n of e.mover)!1===s.contains(n)&&t.push(n);t.length>0&&r.push(new JX(e.directThreat,new e1(t)))}r.length>0&&n.set(o,new AJ(r))}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}class n1 extends t1{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=HX.UNOCCUPIED;let s=0;const o=this.getPiecesMap(n),a=this.getThreatMap(n,o),l=this.filterThreatMap(a,n);for(const c of cK.PLAYERS){const e=new e1;for(const t of o.get(c).get())if(l.get(t).isPresent())s+=c.getScoreModifier()*n1.SCORE_BY_THREATENED_PIECE;else{s+=c.getScoreModifier()*n1.SCORE_BY_SAFE_PIECE;for(const s of gJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=n1.CONTROL_VALUE[t.y][t.x];s+=c.getScoreModifier()*e}}return new IJ(s)}}n1.SCORE_BY_THREATENED_PIECE=530,n1.SCORE_BY_SAFE_PIECE=16*n1.SCORE_BY_THREATENED_PIECE+1,n1.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];class r1 extends n1{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=HX.UNOCCUPIED;let s=0,o=0,a=0;const l=this.getPiecesMap(n),c=this.getThreatMap(n,l),u=this.filterThreatMap(c,n);for(const d of cK.PLAYERS){const e=new e1;for(const t of l.get(d).get())if(u.get(t).isPresent())o+=d.getScoreModifier();else{s+=d.getScoreModifier();for(const s of gJ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=n1.CONTROL_VALUE[t.y][t.x];a+=d.getScoreModifier()*e}}const h=this.getStepForEscape(n);return new IJ(531*h*17*17+531*s*17+531*o+a)}getStepForEscape(e){const t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}_getStepForEscape(e,t,n,r){const i=this.getNextGen(e,n,r);return 0===i.length?Mw.empty():i.some(e=>this.ruler.isExternalThrone(e))?Mw.of(t):(t++,r.push(...i),this._getStepForEscape(e,t,i,r))}getNextGen(e,t,n){const r=[];for(const i of t)for(const t of gJ.ORTHOGONALS){let s=i.getNext(t,1);for(;s.isInRange(this.ruler.config.WIDTH,this.ruler.config.WIDTH)&&e.getPieceAt(s)===HX.UNOCCUPIED;)n.every(e=>!1===e.equals(s))&&r.push(s),s=s.getNext(t,1)}return r}}r1.SCORE_BY_THREATENED_PIECE=530,r1.SCORE_BY_SAFE_PIECE=16*n1.SCORE_BY_THREATENED_PIECE+1,r1.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];const i1=HX.UNOCCUPIED,s1=HX.INVADERS,o1=HX.DEFENDERS,a1=HX.PLAYER_ONE_KING;class l1{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne.`,WX.getInitialState()),jJ.anyMove($localize`Moving`,$localize`All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move.`,WX.getInitialState(),$X.of(new yJ(3,1),new yJ(1,1)),$localize`Congratulations!`),jJ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new WX([[i1,i1,i1,s1,i1,i1,i1],[i1,i1,i1,s1,i1,i1,i1],[s1,i1,i1,o1,i1,i1,i1],[i1,i1,o1,a1,o1,s1,s1],[i1,i1,s1,i1,i1,i1,i1],[i1,i1,i1,o1,i1,s1,i1],[i1,i1,i1,s1,i1,i1,i1]],1),[$X.of(new yJ(3,5),new yJ(2,5))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),jJ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new WX([[i1,i1,i1,s1,i1,i1,i1],[i1,i1,s1,i1,i1,i1,i1],[i1,i1,i1,o1,i1,i1,i1],[s1,o1,i1,i1,o1,s1,s1],[i1,o1,i1,i1,i1,i1,i1],[i1,s1,i1,a1,i1,s1,i1],[i1,i1,i1,s1,i1,i1,i1]],12),[$X.of(new yJ(2,1),new yJ(3,1)),$X.of(new yJ(3,0),new yJ(3,1))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),jJ.fromMove($localize`Capturing the king on his throne`,$localize`To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king.`,new WX([[i1,i1,i1,i1,i1,i1,i1],[i1,i1,i1,o1,i1,i1,i1],[i1,i1,i1,s1,i1,i1,i1],[i1,s1,i1,a1,s1,i1,i1],[i1,i1,i1,s1,i1,i1,i1],[i1,o1,i1,i1,i1,i1,i1],[i1,i1,i1,i1,i1,i1,i1]],72),[$X.of(new yJ(1,3),new yJ(2,3))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),jJ.fromMove($localize`Capturing the king next to his throne`,$localize`Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king.`,new WX([[i1,i1,s1,i1,i1,i1,i1],[i1,i1,i1,s1,i1,i1,i1],[i1,i1,i1,a1,s1,i1,i1],[i1,s1,o1,i1,o1,i1,i1],[i1,i1,i1,s1,i1,i1,i1],[i1,i1,i1,i1,i1,i1,i1],[i1,i1,i1,i1,i1,i1,i1]],72),[$X.of(new yJ(2,0),new yJ(2,2))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`),jJ.fromMove($localize`Capturing the king far from his throne`,$localize`When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king.`,new WX([[i1,i1,i1,i1,i1,i1,i1],[i1,i1,i1,i1,i1,i1,i1],[i1,s1,i1,s1,i1,i1,i1],[s1,i1,i1,i1,o1,i1,i1],[i1,i1,i1,o1,i1,i1,i1],[i1,i1,i1,i1,i1,i1,i1],[i1,a1,i1,s1,i1,i1,i1]],72),[$X.of(new yJ(3,6),new yJ(2,6))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function c1(e,t){1&e&&(Cn(),ga(0,"polyline",8))}function u1(e,t){1&e&&(Cn(),ga(0,"polyline",9))}function h1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,c1,1,0,"polyline",6),la(2,u1,1,0,"ng-template",null,7,Ku),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function d1(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10),ga(4,"line",10),ga(5,"line",10),fa()),2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.1*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.9*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.15*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.85*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE)}}function p1(e,t){if(1&e&&(Cn(),ga(0,"polyline",15)),2&e){const e=ba(3).index,t=ba().index;ha("ngClass",ba().viewInfo.pieceClasses[t][e])}}function f1(e,t){if(1&e&&(Cn(),ga(0,"line",10),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10)),2&e){const e=ba(3).index,t=ba().index,n=ba();ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.04*n.SPACE_SIZE)("y1",.5*n.SPACE_SIZE)("x2",.96*n.SPACE_SIZE)("y2",.5*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.2*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.8*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.8*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.2*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE)}}function g1(e,t){if(1&e&&(Cn(),la(0,p1,1,1,"polyline",13),la(1,f1,4,20,"ng-template",null,14,Ku)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ha("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function m1(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",10),la(2,d1,6,25,"g",11),la(3,g1,3,2,"ng-template",null,12,Ku),fa()),2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngClass",r.viewInfo.pieceClasses[n][t]),ra("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)("cx",.5*r.SPACE_SIZE)("cy",.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function y1(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(1,"rect",4),la(2,h1,4,2,"g",5),la(3,m1,5,6,"g",5),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ia("id","click_",e,"_",n,""),ra("transform","translate("+r.SPACE_SIZE*e+", "+r.SPACE_SIZE*n+")"),Ts(1),ha("ngClass",r.getRectClasses(e,n)),ra("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function v1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,y1,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function _1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",16),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let C1=(()=>{class e extends YX{constructor(e){super(e,!1,$X.from),this.rules=ZX.get(),this.availableMinimaxes=[new KX(this.rules,"DummyBot"),new t1(this.rules,"Piece > Influence"),new n1(this.rules,"Piece > Control"),new r1(this.rules,"Escape > Piece > Control")],this.encoder=$X.encoder,this.tutorial=(new l1).tutorial}ngOnInit(){this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-brandhub"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,v1,2,1,"g",1),la(2,_1,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[tp,Xd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),E1=(()=>{class e extends vJ{constructor(){super(...arguments),this.SPACE_SIZE=50}getTriangleCornerCoords(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}getTriangleCoordinate(e,t){return this.getTriangleCornerCoords(e,t).map(e=>e.x+","+e.y).reduce((e,t)=>e+","+t)}getDownwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new yJ(.5*this.SPACE_SIZE*e,i);return[o,new yJ(n,s),new yJ(r,i),o]}getUpwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new yJ(.5*this.SPACE_SIZE*e,s);return[o,new yJ(n,i),new yJ(r,s),o]}getPyramidCoordinate(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}getDownwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}getUpwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),w1=(()=>{class e{}return e.INVALID_DISTANCE=()=>$localize`Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is.`,e.NOT_ENOUGH_TILES_TO_EXCHANGE=()=>$localize`You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it.`,e.FIRST_CLICK_SHOULD_NOT_BE_NULL=()=>$localize`Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles.`,e.CANNOT_CAPTURE_FROM_EMPTY=()=>$localize`You cannot capture from an empty space.`,e.CANNOT_CAPTURE_OWN_PIECES=()=>$localize`You cannot capture your own pieces.`,e})();class S1{constructor(e,t){this.direction=e,this.str=t}static fromCoords(e,t){const n=e.getVectorToward(t),r=S1.STEPS.findIndex(e=>e.direction.equals(n));if(-1===r)throw new Error(w1.INVALID_DISTANCE());return S1.STEPS[r]}toInt(){return S1.STEPS.findIndex(e=>e.direction.equals(this.direction))}equals(e){return this===e}toString(){return this.str}}S1.LEFT=new S1(new hJ(-2,0),"LEFT"),S1.UP_LEFT=new S1(fJ.UP_LEFT,"UP_LEFT"),S1.UP_RIGHT=new S1(fJ.UP_RIGHT,"UP_RIGHT"),S1.RIGHT=new S1(new hJ(2,0),"RIGHT"),S1.DOWN_LEFT=new S1(fJ.DOWN_LEFT,"DOWN_LEFT"),S1.DOWN_RIGHT=new S1(fJ.DOWN_RIGHT,"DOWN_RIGHT"),S1.STEPS=[S1.LEFT,S1.UP_LEFT,S1.UP_RIGHT,S1.RIGHT,S1.DOWN_LEFT,S1.DOWN_RIGHT];class b1 extends xJ{constructor(e,t,n,r){super(),this.start=e,this.step=t,this.landingCoord=n,this.capture=r}static fromMovement(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");const n=new yJ(e.x+t.direction.x,e.y+t.direction.y);if(n.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new b1(Mw.of(e),Mw.of(t),Mw.of(n),Mw.empty())}static fromTilesExchange(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new b1(Mw.empty(),Mw.empty(),Mw.empty(),Mw.of(e))}static fromCoordToCoord(e,t){const n=S1.fromCoords(e,t);return b1.fromMovement(e,n)}isTileExchange(){return this.capture.isPresent()}toString(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}equals(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}b1.encoder=new class extends aK{maxValue(){return 1035}encodeNumber(e){if(e.isTileExchange()){const t=e.capture.get().y;return 10*e.capture.get().x+t}{const t=e.start.get().y,n=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*n+t}}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?b1.fromTilesExchange(new yJ(n,t)):b1.fromMovement(new yJ(n,t),S1.STEPS[e-1])}};class P1{static getNeighbors(e){let t;const n=new yJ(e.x-1,e.y),r=new yJ(e.x+1,e.y);return t=(e.x+e.y)%2==1?[n,r,new yJ(e.x,e.y-1)]:[n,r,new yJ(e.x,e.y+1)],t}static getFakeNeighbors(e){return new yJ(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}static getCommonNeighbor(e,t){const n=P1.getNeighbors(e),r=P1.getNeighbors(t);let i=0;for(;i<n.length;){const e=n[i];let t=0;for(;t<r.length;){if(e.equals(r[t]))return Mw.of(e);t++}i++}return Mw.empty()}}class O1 extends NJ{static getEmptyNeighbors(e,t,n){const r=[];for(const i of P1.getNeighbors(t))i.isInRange(e[0].length,e.length)&&e[i.y][i.x]===n&&r.push(i);return r}getEmptyNeighboors(e,t){return O1.getEmptyNeighbors(this.board,e,t)}}class T1 extends O1{constructor(e,t,n,r){super(e,t),this.tiles=n,this.captures=r}static getTilesUpperLeftCoord(e){const t=e.x-e.x%3;let n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new yJ(t,n)}static getPresentNeighboorEntrances(e){return[new yJ(e.x+1,e.y-1),new yJ(e.x+3,e.y+0),new yJ(e.x+3,e.y+1),new yJ(e.x+1,e.y+2),new yJ(e.x-1,e.y+1),new yJ(e.x-1,e.y+0)].filter(T1.isInRange)}static getInitialState(){const e=CJ.EMPTY,t=CJ.UNREACHABLE,n=CJ.ZERO,r=CJ.ONE;return new T1([[t,t,t,t,t,t,n,e,n,t,t,t,t,t,t],[t,t,t,e,e,n,e,e,e,n,e,e,t,t,t],[e,r,e,r,e,e,n,e,n,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[e,n,e,n,e,e,e,e,e,e,e,n,e,n,e],[n,e,e,e,n,e,e,e,e,e,n,e,e,e,n],[e,n,e,n,e,e,r,e,r,e,e,n,e,n,e],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t]],0,[0,0],[0,0])}applyLegalMovement(e){Tw(T1.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});const t=e.start.get(),n=e.landingCoord.get(),r=this.getCopiedBoard();return r[n.y][n.x]=CJ.ofPlayer(this.getCurrentPlayer()),r[t.y][t.x]=CJ.EMPTY,new T1(r,this.turn,this.tiles,this.captures)}doMovementCaptures(e){Tw(T1.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});const t=this.getCapturedNeighbors(e.landingCoord.get());let n=this;for(const r of t)n=n.capture(r);return n}getCapturedNeighbors(e){const t=this.getCurrentOpponent();return P1.getNeighbors(e).filter(e=>!e.isNotInRange(15,10)&&!!this.getPieceAt(e).is(t)&&this.isSurrounded(e))}isSurrounded(e){return 0===this.getEmptyNeighboors(e,CJ.EMPTY).length}capture(e){Tw(T1.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});const t=this.getCopiedBoard(),n=[this.captures[0],this.captures[1]];return Tw(T1.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=CJ.EMPTY,n[this.getCurrentPlayer().value]+=1,new T1(t,this.turn,this.tiles,n)}removeTilesIfNeeded(e,t){Tw(T1.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});let n=this;const r=T1.getTilesUpperLeftCoord(e);if(this.isTileEmpty(r)&&this.isDeconnectable(r)){n=this.deconnectTile(r,t);const e=T1.getPresentNeighboorEntrances(r);for(const r of e){const e=n.getPieceAt(r);e===CJ.EMPTY?n=n.removeTilesIfNeeded(r,t):e.is(this.getCurrentOpponent())&&n.isSurrounded(r)&&(n=n.capture(r))}}return n}isTileEmpty(e){nq(this.getPieceAt(e)!==CJ.UNREACHABLE,"Should not call isTileEmpty on removed tile");for(let t=0;t<2;t++)for(let n=0;n<3;n++){const r=e.getNext(new hJ(n,t),1);if(this.getPieceAt(r)!==CJ.EMPTY)return!1}return!0}isDeconnectable(e){const t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;let n=0;for(let r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}areNeighboor(e,t){return e+1===t||0===e&&5===t}getPresentNeighboorTilesRelativeIndexes(e){const t=[];let n=Mw.empty();for(let r=0;r<6;r++){const i=e.getNext(T1.NEIGHBOORS_TILES_DIRECTIONS[r],1);i.isInRange(15,10)&&this.getPieceAt(i)!==CJ.UNREACHABLE&&(n.isAbsent()&&(n=Mw.of(r)),t.push(r-n.get()))}return t}deconnectTile(e,t){Tw(T1.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});const n=this.getCopiedBoard(),r=e.x,i=e.y;for(let o=0;o<2;o++)for(let e=0;e<3;e++)n[i+o][r+e]=CJ.UNREACHABLE;const s=[this.tiles[0],this.tiles[1]];return t&&(s[this.getCurrentPlayer().value]+=1),new T1(n,this.turn,s,this.captures)}getLegalLandings(e){const t=[];for(const n of S1.STEPS){const r=e.getNext(n.direction,1);this.isOnBoard(r)&&this.getPieceAt(r)===CJ.EMPTY&&t.push(r)}return t}getPiecesByFreedom(){const e=[[0,0,0,0],[0,0,0,0]];for(let t=0;t<10;t++)for(let n=0;n<15;n++){const r=this.board[t][n];if(r.isPlayer()){const i=this.getEmptyNeighboors(new yJ(n,t),CJ.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}T1.VERBOSE=!1,T1.NEIGHBOORS_TILES_DIRECTIONS=[new hJ(0,-2),new hJ(3,-1),new hJ(3,1),new hJ(0,2),new hJ(-3,1),new hJ(-3,-1)],T1.isInRange=e=>e.isInRange(15,10);let I1=(()=>{class e extends HJ{applyLegalMove(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}applyLegalTileExchange(t,n){const r=n.getCopiedBoard(),i=t.capture.get();r[i.y][i.x]=CJ.EMPTY;const s=[n.captures[0],n.captures[1]];s[n.getCurrentPlayer().value]+=1;const o=[n.tiles[0],n.tiles[1]];o[n.getCurrentPlayer().value]-=2;const a=new T1(r,n.turn,o,s),l=a.removeTilesIfNeeded(i,!1),c=new T1(l.getCopiedBoard(),l.turn+1,l.tiles,l.captures);return Tw(e.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:n,afterCapture:a,afterTileRemoval:l,resultingState:c}}),c}applyLegalMovement(t,n){const r=n.applyLegalMovement(t),i=r.removeTilesIfNeeded(t.start.get(),!0),s=i.doMovementCaptures(t),o=new T1(s.board,n.turn+1,s.tiles,s.captures);return Tw(e.VERBOSE,{ab_state:n,afterMovement:r,afterTilesRemoved:i,afterCaptures:s,resultingState:o}),o}isLegal(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}isLegalTileExchange(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return ZG.failure(w1.NOT_ENOUGH_TILES_TO_EXCHANGE());const n=t.getPieceAt(e.capture.get());return n===CJ.UNREACHABLE||n===CJ.EMPTY?ZG.failure(w1.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?ZG.failure(w1.CANNOT_CAPTURE_OWN_PIECES()):ZG.success(void 0)}isLegalMovement(e,t){if(t.getPieceAt(e.start.get())===CJ.UNREACHABLE){const t="Cannot start with a coord outside the board "+e.start.get().toString()+".";return ZG.failure(t)}if(t.getPieceAt(e.landingCoord.get())===CJ.UNREACHABLE){const t="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return ZG.failure(t)}const n=t.getPieceAt(e.start.get());return n===CJ.EMPTY?ZG.failure(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n.is(t.getCurrentOpponent())?ZG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE()):ZG.success(void 0)}static getGameStatus(e){const t=e.gameState;return t.captures[0]>=18?zJ.ZERO_WON:t.captures[1]>=18?zJ.ONE_WON:zJ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class k1 extends TJ{getListMoves(e){let t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}getListExchanges(e){const t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=CJ.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(let s=0;s<10;s++)for(let e=0;e<15;e++){const r=new yJ(e,s);if(n.getPieceAt(r)===i){const e=b1.fromTilesExchange(r);t.push(e)}}return t}getListMovement(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<10;i++)for(let e=0;e<15;e++){const s=new yJ(e,i);if(n.getPieceAt(s).is(r)){const e=n.getLegalLandings(s);for(const n of e){const e=b1.fromCoordToCoord(s,n);t.push(e)}}}return t}getBoardValue(e){const t=I1.getGameStatus(e);if(t.isEndGame)return IJ.fromWinner(t.winner);const n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new IJ(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}getPiecesScore(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}getPlayerPiecesScore(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}putCaptureFirst(e,t){return fK.sortByDescending(t,t=>this.moveCapturesList(e,t).length),t}moveCapturesList(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}let A1=(()=>{class e extends k1{getBoardValue(t){const n=I1.getGameStatus(t);if(n.isEndGame)return IJ.fromWinner(n.winner);const r=t.gameState,i=this.getPiecesMap(r),s=this.getThreatMap(r,i),o=this.filterThreatMap(s,r);let a=0;for(const l of cK.PLAYERS)for(const t of i.get(l).get())o.get(t).isPresent()?a+=l.getScoreModifier()*e.SCORE_BY_THREATENED_PIECE:a+=l.getScoreModifier()*e.SCORE_BY_SAFE_PIECE;return a+=r.tiles[1]-r.tiles[0],new IJ(a)}getPiecesMap(e){const t=new UJ,n=[],r=[];for(let i=0;i<10;i++)for(let t=0;t<15;t++){const s=new yJ(t,i),o=e.getPieceAt(s);o===CJ.ZERO?n.push(s):o===CJ.ONE&&r.push(s)}return t.set(cK.ZERO,new e1(n)),t.set(cK.ONE,new e1(r)),t}getThreatMap(e,t){const n=new UJ;for(const r of cK.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreat(i,e);t.isPresent()&&n.set(i,t.get())}return n}getThreat(e,t){const n=cK.of(t.getPieceAt(e).value).getOpponent();let r=Mw.empty();const i=[],s=P1.getNeighbors(e).filter(e=>e.isInRange(15,10));for(const o of s){const e=t.getPieceAt(o);if(e.is(n))i.push(o);else if(e===CJ.EMPTY){if(r.isPresent())return Mw.empty();r=Mw.of(o)}}if(r.isPresent()){const e=[];for(const s of S1.STEPS){const o=r.get().getNext(s.direction,1);o.isInRange(15,10)&&t.getPieceAt(o).is(n)&&i.every(e=>!1===e.equals(o))&&e.push(o)}if(e.length>0)return Mw.of(new QX(new e1(i),new e1(e)))}return Mw.empty()}filterThreatMap(e,t){const n=new UJ,r=e.listKeys(),i=r.filter(e=>t.getPieceAt(e).is(t.getCurrentPlayer())),s=new e1(r.filter(e=>t.getPieceAt(e).is(t.getCurrentOpponent())));for(const o of i){const t=e.get(o).get();nq(1===t.directThreats.size(),"oldThreat must contain exactly one direct threat");const r=t.directThreats.getAnyElement().get();let i=Mw.empty();if(!1===s.contains(r)){const e=[];for(const n of t.mover)!1===s.contains(n)&&e.push(n);e.length>0&&(i=Mw.of(new QX(t.directThreats,new e1(e))))}i.isPresent()&&n.set(o,i.get())}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e})();const M1=CJ.EMPTY,N1=CJ.UNREACHABLE,R1=CJ.ZERO,x1=CJ.ONE;class D1{constructor(){this.tutorial=[jJ.informational($localize`Board and goal of the game`,$localize`Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.
         The triangles are the spaces on which pieces move during the game.
         The tiles can be removed from the board (you will see how later).
         The dark pieces belong to the first player and can only move on the dark spaces,
         while the light pieces belong to the second player and can only move on the light spaces.
         The goal of the game is to capture all of the opponent's pieces.`,T1.getInitialState()),jJ.anyMove($localize`Move`,$localize`To move a piece, you need to:
        <ol>
          <li>Click on one of your pieces.</li>
          <li>Click on one of the triangular space highlighted in yellow.</li>
        </ol>
        You can pass through the opponent's pieces.
        You're playing first, hence you're playing Dark.<br/><br/>
        Perform any move.`,T1.getInitialState(),b1.fromCoordToCoord(new yJ(3,5),new yJ(5,5)),$localize`Congratulations! Let's see captures now.`),jJ.fromMove($localize`Capture`,$localize`Every piece has three neighboring triangular spaces (2 on the sides).
        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!
        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>
        You're playing Light, make a capture.`,new T1([[N1,N1,N1,N1,N1,N1,R1,M1,R1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,R1,M1,M1,M1,M1,M1,R1,M1,M1,N1,N1,N1],[M1,x1,M1,x1,R1,x1,M1,M1,R1,M1,M1,x1,M1,x1,M1],[x1,M1,M1,M1,M1,M1,M1,M1,M1,M1,x1,M1,M1,M1,x1],[M1,x1,M1,x1,M1,M1,M1,M1,M1,M1,M1,x1,M1,x1,M1],[M1,R1,M1,R1,M1,M1,M1,M1,M1,M1,M1,R1,M1,R1,M1],[R1,M1,M1,M1,R1,M1,M1,M1,M1,M1,R1,M1,M1,M1,R1],[M1,R1,M1,R1,M1,M1,x1,M1,x1,M1,M1,R1,M1,R1,M1],[N1,N1,N1,M1,M1,x1,M1,M1,M1,x1,M1,M1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,x1,M1,x1,N1,N1,N1,N1,N1,N1]],3,[0,0],[0,0]),[b1.fromCoordToCoord(new yJ(5,2),new yJ(4,1)),b1.fromCoordToCoord(new yJ(3,4),new yJ(4,3))],$localize`Congratulations!`,$localize`Failed, you have not captured any piece.`),jJ.fromMove($localize`Gain a tile`,$localize`When a tile is empty, it can become removable from the board.
        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.
        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.
        For example, here, the topmost dark piece will not disconnect its tile when leaving it.
        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>
        Perform a move that lets you gain two tiles.`,new T1([[N1,N1,N1,N1,N1,N1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,x1,M1,M1,N1,N1,N1,N1,N1,N1],[M1,M1,M1,N1,N1,N1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[M1,M1,x1,M1,M1,M1,M1,R1,M1,N1,N1,N1,N1,N1,N1],[M1,M1,M1,x1,M1,M1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[M1,M1,M1,M1,M1,M1,M1,M1,M1,M1,M1,R1,N1,N1,N1],[M1,M1,R1,M1,M1,x1,M1,M1,M1,M1,R1,M1,M1,M1,R1],[M1,M1,M1,M1,M1,M1,x1,M1,x1,M1,M1,R1,M1,R1,M1],[N1,N1,N1,M1,M1,x1,M1,M1,M1,x1,M1,M1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,x1,M1,x1,N1,N1,N1,N1,N1,N1]],2,[0,0],[0,0]),[b1.fromCoordToCoord(new yJ(2,6),new yJ(4,6)),b1.fromCoordToCoord(new yJ(2,6),new yJ(3,5)),b1.fromCoordToCoord(new yJ(2,6),new yJ(3,7))],$localize`Congratulations!`,$localize`Failed, you have not gained the two tiles that you could, try again!`),jJ.fromMove($localize`Exchanging a tile`,$localize`When you have a tile, you can see it on the left of the board.
        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.
        This will cost you two tiles.
        If any tiles are removed during that turn, nobody will get them.<br/><br/>
        Gain some time and capture the last piece!`,new T1([[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,R1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,M1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,M1,x1,M1,x1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,x1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,x1,M1,x1,N1,N1,N1,N1,N1,N1]],1,[0,2],[0,0]),[b1.fromTilesExchange(new yJ(5,5))],$localize`Congratulations!`,$localize`It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!`),jJ.fromMove($localize`Special capture`,$localize`When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!
        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>
        A move that demonstrate both of these things can be done on this board by Light. Try it!`,new T1([[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,M1,M1,R1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,R1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,R1,x1,M1,x1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,x1,R1,M1,M1,M1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,M1,M1,x1,N1,N1,N1,N1,N1,N1,N1,N1,N1],[N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1,N1]],1,[0,0],[0,0]),[b1.fromCoordToCoord(new yJ(7,6),new yJ(6,5)),b1.fromCoordToCoord(new yJ(7,6),new yJ(8,5))],$localize`Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.
        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space.`,$localize`Failed!`)]}}function L1(e,t){if(1&e&&(Cn(),ga(0,"polygon",13)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPyramidClass(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function F1(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getEmptyClass(e,t)),ra("points",n.getTriangleCoordinate(e,t))}}function U1(e,t){if(1&e&&(Cn(),la(0,F1,1,2,"polygon",14)),2&e){const e=ba().index,t=ba().index;ha("ngIf",ba().isEmptyCase(e,t))}}function B1(e,t){if(1&e&&(Cn(),ga(0,"polygon",16)),2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function V1(e,t){if(1&e&&(Cn(),ga(0,"polygon",17)),2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function $1(e,t){if(1&e){const e=va();Cn(),pa(0,"g",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),la(1,L1,1,2,"polygon",9),la(2,U1,1,1,"ng-template",null,10,Ku),la(4,B1,1,3,"polygon",11),la(5,V1,1,3,"polygon",12),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(3),i=ba().index,s=ba();Ia("id","click_",n,"_",i,""),Ts(1),ha("ngIf",s.isPyramid(n,i))("ngIfElse",r),Ts(3),ha("ngIf",e!==s.NONE),Ts(1),ha("ngIf",e!==s.NONE)}}function z1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,$1,6,6,"g",7),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function H1(e,t){if(1&e&&(Cn(),ga(0,"polygon",18)),2&e){const e=t.$implicit;ra("points",ba().getTriangleCoordinate(e.x,e.y))}}function G1(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastStart.get().x,e.lastStart.get().y))}}function q1(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastEnd.get().x,e.lastEnd.get().y))}}function W1(e,t){if(1&e&&(Cn(),ga(0,"polygon",20)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}function j1(e,t){if(1&e&&(Cn(),pa(0,"g",21),ga(1,"polygon",22),pa(2,"text",23),Qa(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,0))("stroke",e.lastTurnWasTilesExchange(0)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+0*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Ja(e.tiles[0])}}function Z1(e,t){if(1&e&&(Cn(),pa(0,"g",24),ga(1,"polygon",25),pa(2,"text",26),Qa(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,9))("stroke",e.lastTurnWasTilesExchange(1)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+9*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Ja(e.tiles[1])}}let Y1=(()=>{class e extends E1{constructor(e){super(e),this.tiles=[0,0],this.NONE=CJ.UNREACHABLE,this.chosenCoord=Mw.empty(),this.lastStart=Mw.empty(),this.lastEnd=Mw.empty(),this.highlights=[],this.scores=Mw.of([0,0]),this.rules=new I1(T1),this.availableMinimaxes=[new k1(this.rules,"Normal"),new A1(this.rules,"Piece > Threat > Tiles")],this.encoder=b1.encoder,this.tutorial=(new D1).tutorial,this.SPACE_SIZE=70,this.updateBoard()}updateBoard(){this.chosenCoord=Mw.empty(),this.state=this.rules.node.gameState,this.scores=Mw.of(this.state.captures),this.tiles=this.state.tiles;const e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=Mw.empty(),this.lastEnd=Mw.empty()),this.board=this.rules.node.gameState.board}showHighlight(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.highlights=[]}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new yJ(e,t);return n.chosenCoord.isAbsent()?n.firstClick(i):n.secondClick(i)})()}firstClick(e){var t=this;return Pw(function*(){const n=t.state.getPieceAt(e);if(n.is(t.state.getCurrentOpponent())){const n=b1.fromTilesExchange(e);return t.chooseMove(n,t.state,t.state.captures)}return n.is(t.state.getCurrentPlayer())?(t.chosenCoord=Mw.of(e),t.showHighlight(),QG.SUCCESS):t.cancelMove(w1.FIRST_CLICK_SHOULD_NOT_BE_NULL())})()}secondClick(e){var t=this;return Pw(function*(){if(e.equals(t.chosenCoord.get()))return t.cancelMoveAttempt(),QG.SUCCESS;if(t.highlights.some(t=>t.equals(e))){const n=b1.fromCoordToCoord(t.chosenCoord.get(),e);return t.chooseMove(n,t.state,t.state.captures)}return t.cancelMove(w1.INVALID_DISTANCE())})()}isPyramid(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}wasOpponent(e,t){const n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}getPyramidClass(e,t){const n=this.board[t][e];return n===CJ.ZERO?this.getPlayerClass(cK.ZERO):n===CJ.ONE?this.getPlayerClass(cK.ONE):"captured"}isEmptyCase(e,t){return this.board[t][e]===CJ.EMPTY||this.wasRemoved(e,t)}wasRemoved(e,t){const n=this.rules.node.mother;if(this.board[t][e]===CJ.UNREACHABLE&&n.isPresent()){const r=n.get().gameState.getPieceAtXY(e,t);return r===CJ.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}getEmptyClass(e,t){return this.board[t][e]===CJ.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}getTilesCountCoordinate(e,t){const n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}getLineCoordinate(e,t){const n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}mustShowTilesOf(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}lastTurnWasTilesExchange(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-coerceo"]],features:[Go],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,z1,2,1,"g",1),la(2,H1,1,1,"polygon",2),la(3,G1,1,1,"polygon",3),la(4,q1,1,1,"polygon",3),la(5,W1,1,1,"polygon",4),la(6,j1,4,6,"g",5),la(7,Z1,4,6,"g",6),fa()),2&e&&(ra("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.highlights),Ts(1),ha("ngIf",t.lastStart.isPresent()),Ts(1),ha("ngIf",t.lastEnd.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()),Ts(1),ha("ngIf",t.mustShowTilesOf(0)),Ts(1),ha("ngIf",t.mustShowTilesOf(1)))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),K1=(()=>{class e{}return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=()=>$localize`Your piece should land on a neighboring square.`,e.CANNOT_DROP_AFTER_TURN_40=()=>$localize`You cannot drop a piece during the moving phase.`,e.CANNOT_MOVE_BEFORE_TURN_40=()=>$localize`You cannot move a piece before both players have dropped all of their pieces.`,e.MUST_JUMP_OVER_PIECES=()=>$localize`A jump must be made over a piece, not over an empty square.`,e.MUST_DROP_IN_CENTRAL_ZONE=()=>$localize`A drop must occur in the central zone of the board.`,e.INVALID_JUMP=()=>$localize`A jump must land two squares from its original position, and be done in a straight line in any direction.`,e.SAME_LOCATION_VISITED_IN_JUMP=()=>$localize`You are visiting the same location twice in a move, you are not allowed to do so.`,e})();class Q1 extends NJ{static getInitialState(){const e=fK.createTable(Q1.WIDTH,Q1.HEIGHT,uK.NONE);return new Q1(e,0)}isShelter(e){return 0===e.x||e.x===Q1.WIDTH-1?Q1.SHELTERS_INDICES.some(t=>e.y===t):(0===e.y||e.y===Q1.HEIGHT-1)&&Q1.SHELTERS_INDICES.some(t=>e.x===t)}isCentralZone(e){return e.x>=Q1.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=Q1.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=Q1.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=Q1.CENTRAL_ZONE_BOTTOM_RIGHT.y}isDropPhase(){return this.turn<40}getSidePieces(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}Q1.WIDTH=17,Q1.HEIGHT=17,Q1.CENTRAL_ZONE_TOP_LEFT=new yJ(4,6),Q1.CENTRAL_ZONE_BOTTOM_RIGHT=new yJ(12,10),Q1.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],Q1.ALL_SHELTERS=new AJ(Q1.SHELTERS_INDICES.flatMap(e=>[new yJ(e,0),new yJ(e,Q1.HEIGHT-1),new yJ(0,e),new yJ(Q1.WIDTH-1,e)])).toList();class J1 extends DJ{constructor(e){super(e.x,e.y)}static of(e){return e.isInRange(Q1.WIDTH,Q1.HEIGHT)?ZG.success(new J1(e)):ZG.failure("Move out of board")}toString(){return`ConspirateursMoveDrop(${this.coord.toString()})`}equals(e){return!!e.isDrop()&&this.coord.equals(e.coord)}isDrop(){return!0}isSimple(){return!1}isJump(){return!1}}J1.encoder=class{static getEncoder(e,t,n){return new class extends aK{constructor(){super(...arguments),this.shiftX=t}maxValue(){return(e-1)*this.shiftX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftX+e.coord.y}decodeNumber(r){const i=r%t;r/=t;const s=new yJ((r-=r%1)%e,i);return n(s)}}}}.getEncoder(Q1.WIDTH,Q1.HEIGHT,e=>J1.of(e).get());class X1 extends UX{constructor(e,t){super(e,t)}static of(e,t){return e.isInRange(Q1.WIDTH,Q1.HEIGHT)&&t.isInRange(Q1.WIDTH,Q1.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?ZG.success(new X1(e,t)):ZG.failure(K1.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):ZG.failure("Move out of board")}toString(){return`ConspirateursMoveSimple(${this.coord.toString()} -> ${this.end.toString()})`}equals(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}isDrop(){return!1}isSimple(){return!0}isJump(){return!1}}X1.encoder=UX.getEncoder(Q1.WIDTH,Q1.HEIGHT,(e,t)=>X1.of(e,t).get());class e0 extends xJ{constructor(e){super(),this.coords=e}static of(e){if(e.length<2)return ZG.failure("ConspirateursMoveJump requires at least one jump, so two coords");for(const t of e)if(t.isNotInRange(Q1.WIDTH,Q1.HEIGHT))return ZG.failure("Move out of board");for(let t=1;t<e.length;t++)if(e[t-1].getDirectionToward(e[t]).isFailure()||2!==e[t-1].getDistance(e[t]))return ZG.failure(K1.INVALID_JUMP());return new e1(e).size()===e.length?ZG.success(new e0(e)):ZG.failure(K1.SAME_LOCATION_VISITED_IN_JUMP())}addJump(e){const t=fK.copyImmutableArray(this.coords);return t.push(e),e0.of(t)}getStartingCoord(){return this.coords[0]}getEndingCoord(){return this.coords[this.coords.length-1]}getLandingCoords(){return this.coords.slice(1)}getJumpedOverCoords(){const e=[];for(let t=1;t<this.coords.length;t++){const n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}toString(){return`ConspirateursMoveJump(${this.coords.map(e=>e.toString()).reduce((e,t)=>e+" -> "+t)})`}equals(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}isDrop(){return!1}isSimple(){return!1}isJump(){return!0}}e0.encoder=new class extends oK{constructor(){super(...arguments),this.coordEncoder=yJ.numberEncoder(Q1.WIDTH,Q1.HEIGHT)}encodeMove(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}decodeMove(e){nq(null!=Ow.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");const t=Ow.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return e0.of(t).get()}};const t0=oK.disjunction3(J1.encoder,X1.encoder,e0.encoder,e=>e.isDrop(),e=>e.isSimple());class n0 extends HJ{constructor(){super(Q1)}static get(){return n0.singleton.isAbsent()&&(n0.singleton=Mw.of(new n0)),n0.singleton.get()}applyLegalMove(e,t,n){const r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=uK.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{const n=e.getStartingCoord(),i=e.getEndingCoord();r[n.y][n.x]=uK.NONE,r[i.y][i.x]=t.getCurrentPlayer()}return new Q1(r,t.turn+1)}isLegal(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}dropLegality(e,t){return t.turn>=40?ZG.failure(K1.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord).isPlayer()?ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?ZG.failure(K1.MUST_DROP_IN_CENTRAL_ZONE()):ZG.success(void 0)}simpleMoveLegality(e,t){return t.turn<40?ZG.failure(K1.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end).isPlayer()?ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE()):ZG.success(void 0)}jumpLegality(e,t){if(t.turn<40)return ZG.failure(K1.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE());for(const n of e.getJumpedOverCoords())if(t.getPieceAt(n)===uK.NONE)return ZG.failure(K1.MUST_JUMP_OVER_PIECES());for(const n of e.getLandingCoords())if(t.getPieceAt(n).isPlayer())return ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE());return ZG.success(void 0)}jumpTargetsFrom(e){const t=[new yJ(e.x+2,e.y),new yJ(e.x-2,e.y),new yJ(e.x,e.y+2),new yJ(e.x,e.y-2),new yJ(e.x+2,e.y+2),new yJ(e.x+2,e.y-2),new yJ(e.x-2,e.y+2),new yJ(e.x-2,e.y-2)],n=[];for(const r of t)e0.of([e,r]).isSuccess()&&n.push(r);return n}nextJumps(e,t){const n=e.getEndingCoord(),r=[];for(const i of this.jumpTargetsFrom(n)){const n=e.addJump(i);n.isSuccess()&&this.jumpLegality(n.get(),t).isSuccess()&&r.push(n.get())}return r}jumpHasPossibleNextTargets(e,t){return this.nextJumps(e,t).length>0}getGameStatus(e){const t=e.gameState,n=[0,0];for(const r of Q1.ALL_SHELTERS){const e=t.getPieceAt(r);if(e.isPlayer()&&(n[e.value]+=1,20===n[e.value]))return zJ.getVictory(e)}return zJ.ONGOING}}n0.singleton=Mw.empty();class r0 extends TJ{getListMoves(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}getListMovesDrop(e){const t=[],n=Q1.CENTRAL_ZONE_TOP_LEFT,r=Q1.CENTRAL_ZONE_BOTTOM_RIGHT;for(let i=n.y;i<=r.y;i++)for(let s=n.x;s<=r.x;s++)e.getPieceAtXY(s,i)===uK.NONE&&t.push(J1.of(new yJ(s,i)).get());return t}getListMovesAfterDrop(e){let t=[];const n=e.getCurrentPlayer();for(let r=0;r<Q1.HEIGHT;r++)for(let i=0;i<Q1.WIDTH;i++){const s=new yJ(i,r);e.getPieceAt(s)===n&&(t=t.concat(this.getListSimpleMoves(e,s)),t=t.concat(this.getListJumps(e,s)))}return t}getListSimpleMoves(e,t){const n=[],r=[new yJ(t.x+1,t.y),new yJ(t.x-1,t.y),new yJ(t.x,t.y+1),new yJ(t.x,t.y-1),new yJ(t.x+1,t.y+1),new yJ(t.x+1,t.y-1),new yJ(t.x-1,t.y+1),new yJ(t.x-1,t.y-1)];for(const i of r){const r=X1.of(t,i);r.isSuccess()&&n0.get().simpleMoveLegality(r.get(),e).isSuccess()&&n.push(r.get())}return n}getListJumps(e,t){const n=new AJ;for(const r of n0.get().jumpTargetsFrom(t)){const i=e0.of([t,r]).get();n0.get().jumpLegality(i,e).isSuccess()&&(n.add(i),n.union(this.getListJumpStartingFrom(e,i)))}return n.toList()}getListJumpStartingFrom(e,t){const n=n0.get().nextJumps(t,e),r=new AJ(n);for(const i of n)r.union(this.getListJumpStartingFrom(e,i));return r}getBoardValue(e){const t=e.gameState;let n=0;const r=new UJ([{key:cK.ZERO,value:0},{key:cK.ONE,value:0}]);for(let i=0;i<Q1.HEIGHT;i++)for(let e=0;e<Q1.WIDTH;e++){const s=new yJ(e,i),o=t.getPieceAt(s);if(o.isPlayer())if(t.isShelter(s)){if(n+=20*o.getScoreModifier(),r.replace(o,r.get(o).get()+1),20===r.get(o).get())return new IJ(o.getVictoryValue())}else{let e=100;for(const n of Q1.ALL_SHELTERS)if(t.getPieceAt(n)===uK.NONE){const t=s.getOrthogonalDistance(n);e=Math.min(e,t)}n-=o.getScoreModifier()*e}}return new IJ(n)}}const i0=uK.NONE,s0=cK.ZERO,o0=cK.ONE;class a0{constructor(){this.tutorial=[jJ.informational($localize`Board and aim of the game`,$localize`Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially.`,Q1.getInitialState()),jJ.anyMove($localize`Initial phase`,$localize`In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone.`,Q1.getInitialState(),J1.of(new yJ(7,7)).get(),$localize`Congratulations!`),jJ.fromPredicate($localize`Simple move`,$localize`Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move.`,new Q1([[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,s0,o0,o0,s0,s0,o0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,o0,s0,o0,s0,s0,s0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,o0,i0,i0,i0,i0,i0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,s0,o0,o0,o0,s0,s0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,o0,o0,o0,o0,o0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0]],40),X1.of(new yJ(4,6),new yJ(3,5)).get(),(e,t)=>e.isSimple()?QG.SUCCESS:QG.failure($localize`You have made a jump, not a simple move. Try again!`),$localize`Congratulations!`),jJ.fromPredicate($localize`Jumps`,$localize`The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful).`,new Q1([[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,s0,o0,o0,s0,s0,o0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,o0,s0,o0,s0,s0,s0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,o0,i0,i0,i0,i0,i0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,s0,o0,o0,o0,s0,s0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,o0,o0,o0,o0,o0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0]],40),e0.of([new yJ(6,7),new yJ(6,5)]).get(),(e,t)=>e.isJump()?QG.SUCCESS:QG.failure($localize`You have not performed a jump. Try again!`),$localize`Congratulations!`),jJ.fromMove($localize`Chaining jumps in a single move`,$localize`Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it.`,new Q1([[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,o0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,o0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,o0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,s0,i0,o0,s0,s0,o0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,i0,s0,o0,s0,s0,s0,s0,o0,i0,i0,i0,i0],[i0,i0,i0,i0,s0,o0,i0,i0,i0,i0,i0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,s0,o0,o0,o0,s0,s0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,o0,s0,o0,o0,o0,o0,o0,o0,s0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0],[i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0,i0]],40),[e0.of([new yJ(8,6),new yJ(6,4),new yJ(6,2),new yJ(6,0)]).get()],$localize`Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does.`,$localize`You have not performed a triple jump. Try again!`)]}}function l0(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",9),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba().$implicit,t=ba(2);ra("x",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.x+t.STROKE_WIDTH)("y",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.y+t.STROKE_WIDTH)("width",t.SPACE_SIZE-3*t.STROKE_WIDTH)("height",t.SPACE_SIZE-3*t.STROKE_WIDTH)}}function c0(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function u0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t.coord)}),fa(),la(2,l0,1,4,"rect",7),la(3,c0,1,6,"circle",8),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isShelter),Ts(1),ha("ngIf",e.hasPiece)}}function h0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,u0,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function d0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngClass",n.viewInfo.boardInfo[e.y][e.x].shelterClasses),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function p0(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=t.$implicit,n=ba();Ta("id","sidePiece_0_",e,""),ra("cx",-n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function f0(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Ta("id","sidePiece_1_",e,""),ra("cx",1715+n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function g0(e,t){if(1&e&&(Cn(),ga(0,"rect",13)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.CENTRAL_ZONE_START.x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.CENTRAL_ZONE_START.y+e.STROKE_WIDTH)("width",e.CENTRAL_ZONE_SIZE.x*e.SPACE_SIZE)("height",e.CENTRAL_ZONE_SIZE.y*e.SPACE_SIZE)}}let m0=(()=>{class e extends vJ{constructor(e){super(e),this.ALL_SHELTERS=Q1.ALL_SHELTERS,this.CENTRAL_ZONE_START=Q1.CENTRAL_ZONE_TOP_LEFT,this.CENTRAL_ZONE_SIZE=new hJ(Q1.CENTRAL_ZONE_BOTTOM_RIGHT.x-Q1.CENTRAL_ZONE_TOP_LEFT.x+1,Q1.CENTRAL_ZONE_BOTTOM_RIGHT.y-Q1.CENTRAL_ZONE_TOP_LEFT.y+1),this.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},this.selected=Mw.empty(),this.jumpInConstruction=Mw.empty(),this.PIECE_RADIUS=this.SPACE_SIZE/2-this.STROKE_WIDTH,this.rules=n0.get(),this.availableMinimaxes=[new r0(this.rules,"ConspirateursMinimax")],this.encoder=t0,this.tutorial=(new a0).tutorial}ngOnInit(){this.updateBoard()}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}updateViewInfo(){const e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(let t=0;t<Q1.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(let n=0;n<Q1.WIDTH;n++){const r=new yJ(n,t),i=e.getPieceAt(r),s={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i.isPlayer(),isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(s)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}updateOccupiedShelters(){for(const e of Q1.ALL_SHELTERS){const t=this.viewInfo.boardInfo[e.y][e.x];t.isShelter=!0,t.hasPiece&&t.shelterClasses.push("highlighted")}}updateSelected(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){const e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;for(const r of e.coords)this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}else{const e=this.selected.get();this.viewInfo.boardInfo[e.y][e.x].pieceClasses.push("selected")}}updateVictory(){const e=this.getState(),t=n0.get().getGameStatus(this.rules.node);if(!0===t.isEndGame)for(const n of Q1.ALL_SHELTERS)e.getPieceAt(n)===t.winner&&this.viewInfo.boardInfo[n.y][n.x].squareClasses.push("victory")}showLastMove(){const e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";for(const t of e.coords)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=t.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=t.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}cancelMoveAttempt(){this.jumpInConstruction=Mw.empty(),this.selected=Mw.empty(),this.updateBoard()}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());const r=t.getState();if(r.getPieceAt(e)===t.getCurrentPlayer())return t.selected=Mw.of(e),t.jumpInConstruction=Mw.empty(),t.updateViewInfo(),QG.SUCCESS;if(t.jumpInConstruction.isPresent())return t.constructJump(e);if(t.selected.isPresent())return t.selectNextCoord(e);if(r.isDropPhase()){const n=J1.of(e);return nq(n.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(n.get(),r)}return t.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE())})()}constructJump(e){var t=this;return Pw(function*(){const n=t.jumpInConstruction.get(),r=t.getState();if(e.equals(n.getEndingCoord()))return t.chooseMove(n,r);{const i=n.addJump(e);if(i.isFailure())return t.cancelMove(i.getReason());const s=t.rules.jumpLegality(i.get(),r);return s.isFailure()?t.cancelMove(s.getReason()):t.updateJump(i.get())}})()}updateJump(e){var t=this;return Pw(function*(){const n=t.getState();return t.rules.jumpHasPossibleNextTargets(e,n)?(t.jumpInConstruction=Mw.of(e),t.updateViewInfo(),QG.SUCCESS):t.chooseMove(e,n)})()}selectNextCoord(e){var t=this;return Pw(function*(){const n=t.selected.get(),r=X1.of(n,e);if(r.isSuccess())return t.chooseMove(r.get(),t.getState());{const r=e0.of([n,e]);return r.isFailure()?t.cancelMove(r.getReason()):t.updateJump(r.get())}})()}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-conspirateurs"]],features:[Go],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,h0,2,1,"g",1),la(2,d0,2,5,"g",1),la(3,p0,1,4,"circle",2),la(4,f0,1,4,"circle",3),la(5,g0,1,4,"rect",4),ga(6,"polyline",5),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.ALL_SHELTERS),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[0])),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[1])),Ts(1),ha("ngIf",t.viewInfo.dropPhase),Ts(1),ra("points",t.viewInfo.lastMoveArrow))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class y0{constructor(e,t){this.owner=e,this.otherPieceType=t}static of(e,t){return e===cK.ZERO?t?y0.ZERO_SECOND:y0.ZERO_FIRST:e===cK.ONE?t?y0.ONE_SECOND:y0.ONE_FIRST:y0.EMPTY}toString(){return`DiamPiece(${this.owner}, ${this.otherPieceType})`}}y0.encoder=aK.tuple([cK.numberEncoder,aK.booleanEncoder],e=>[e.owner,e.otherPieceType],e=>y0.of(e[0],e[1])),y0.EMPTY=new y0(uK.NONE,!1),y0.ZERO_FIRST=new y0(cK.ZERO,!1),y0.ZERO_SECOND=new y0(cK.ZERO,!0),y0.ONE_FIRST=new y0(cK.ONE,!1),y0.ONE_SECOND=new y0(cK.ONE,!0),y0.PLAYER_PIECES=[y0.ZERO_FIRST,y0.ZERO_SECOND,y0.ONE_FIRST,y0.ONE_SECOND];class v0 extends xJ{constructor(e,t){if(super(),this.target=e,this.piece=t,t===y0.EMPTY)throw new Error("Cannot drop an empty piece")}isDrop(){return!0}getTarget(){return this.target}equals(e){return!(this.target!==e.target||this.piece!==e.piece)}toString(){return`DiamMoveDrop(${this.target}, ${this.piece})`}}v0.encoder=aK.tuple([aK.numberEncoder(7),y0.encoder],e=>[e.target,e.piece],e=>new v0(e[0],e[1]));class _0 extends xJ{constructor(e,t){super(),this.start=e,this.moveDirection=t}static fromRepresentation(e,t){return new _0(new yJ(e.x,3-e.y),t)}isDrop(){return!1}getTarget(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}equals(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}toString(){return`DiamMoveShift(${this.start}, ${this.moveDirection})`}}_0.encoder=aK.tuple([yJ.numberEncoder(8,4),aK.booleanEncoder],e=>[e.start,"clockwise"===e.moveDirection],e=>new _0(e[0],e[1]?"clockwise":"counterclockwise"));const C0=aK.disjunction(v0.encoder,_0.encoder,e=>e.isDrop());let E0=(()=>{class e{}return e.NO_MORE_PIECES_OF_THIS_TYPE=()=>$localize`You do not have any pieces of this type anymore.`,e.SPACE_IS_FULL=()=>$localize`You cannot play here: this space is already full.`,e.TARGET_STACK_TOO_HIGH=()=>$localize`You cannot add more pieces to the target stack, as it will contain more than 4 pieces.`,e.MUST_SHIFT_TO_NEIGHBOR=()=>$localize`To perform a shift, you must move the pieces to a neighboring space.`,e.MUST_SELECT_PIECE_FIRST=()=>$localize`You must first select either a piece from the side, or a stack of pieces to shift on the board.`,e})(),w0=(()=>{class e extends NJ{constructor(e,t,n){super(e,n),this.remainingPieces=t}static getInitialState(){const t=y0.EMPTY;return new e([[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t]],[4,4,4,4],0)}static fromRepresentation(t,n){const r=t.reverse(),i=[4,4,4,4];for(let s=0;s<e.HEIGHT;s++)for(let t=0;t<e.WIDTH;t++){const n=r[s][t];r[s][t]!==y0.EMPTY&&i[e.pieceIndex(n)]--}return nq(i.every(e=>e>=0),"Invalid DiamState representation uses too many pieces"),new e(r,i,n)}static pieceIndex(e){switch(e){case y0.ZERO_FIRST:return 0;case y0.ZERO_SECOND:return 1;case y0.ONE_FIRST:return 2;default:return Ow.expectToBe(e,y0.ONE_SECOND),3}}getRemainingPiecesOf(t){return this.remainingPieces[e.pieceIndex(t)]}getStackHeight(t){let n=0;for(let r=0;r<e.HEIGHT&&this.getPieceAtXY(t,r)!==y0.EMPTY;r++)n++;return n}}return e.WIDTH=8,e.HEIGHT=4,e})();class S0 extends HJ{constructor(){super(w0)}static get(){return S0.singleton.isAbsent()&&(S0.singleton=Mw.of(new S0)),S0.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}applyLegalDrop(e,t){const n=fK.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;const r=fK.copyImmutableArray(t.remainingPieces);return r[w0.pieceIndex(e.piece)]-=1,new w0(n,r,t.turn+1)}applyLegalShift(e,t){const n=fK.copyBiArray(t.board),r=e.getTarget();let i=t.getStackHeight(r),s=e.start.y;for(;s<w0.HEIGHT&&t.getPieceAtXY(e.start.x,s)!==y0.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,s),n[s][e.start.x]=y0.EMPTY,i++,s++;return new w0(n,t.remainingPieces,t.turn+1)}isLegal(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}isDropLegal(e,t){return e.piece.owner!==t.getCurrentPlayer()?ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?ZG.failure(E0.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}dropHeightValidity(e,t){return t.getStackHeight(e.target)===w0.HEIGHT?ZG.failure(E0.SPACE_IS_FULL()):ZG.success(void 0)}isShiftLegal(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}shiftHeightValidity(e,t){const n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>w0.HEIGHT?ZG.failure(E0.TARGET_STACK_TOO_HIGH()):ZG.success(void 0)}getGameStatus(e){const t=this.findHighestAlignment(e.gameState);if(t.isPresent()){const n=e.gameState.getPieceAt(t.get());return nq(n.owner.isPlayer(),"highest alignment is owned by a player"),zJ.getVictory(n.owner)}return zJ.ONGOING}findHighestAlignment(e){for(let t=0;t<w0.WIDTH/2;t++)for(let n=w0.HEIGHT-1;n>0;n--){const r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+w0.WIDTH/2,n);if(r!==y0.EMPTY&&r===i)return Mw.of(new yJ(t,n))}return Mw.empty()}pieceCanMove(e,t){return!!this.isShiftLegal(new _0(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new _0(t,"counterclockwise"),e).isSuccess()}}S0.singleton=Mw.empty();class b0 extends TJ{getListMoves(e){const t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}getListShifts(e){const t=[],n=this.getShiftSources(e);for(const r of n)for(const n of[new _0(r,"clockwise"),new _0(r,"counterclockwise")])S0.get().shiftHeightValidity(n,e).isSuccess()&&t.push(n);return t}getListDrops(e){const t=this.getRemainingPiecesForCurrentPlayer(e),n=[];for(let r=0;r<w0.WIDTH;r++)for(const i of t){const t=new v0(r,i);S0.get().dropHeightValidity(t,e).isSuccess()&&n.push(t)}return n}getRemainingPiecesForCurrentPlayer(e){const t=[];for(const n of y0.PLAYER_PIECES)this.currentPlayerCanDropPiece(e,n)&&t.push(n);return t}currentPlayerCanDropPiece(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}getShiftSources(e){const t=[],n=e.getCurrentPlayer();for(let r=0;r<w0.HEIGHT;r++)for(let i=0;i<w0.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new yJ(i,r));return t}getBoardValue(e){const t=S0.get().getGameStatus(e);return new IJ(t.isEndGame?t.toBoardValue():0)}}const P0=y0.EMPTY,O0=y0.ZERO_FIRST,T0=y0.ZERO_SECOND,I0=y0.ONE_FIRST,k0=y0.ONE_SECOND;class A0{constructor(){this.tutorial=[jJ.informational($localize`Initial board and player pieces`,$localize`Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right.`,w0.getInitialState()),jJ.fromMove($localize`Goal of the game`,$localize`At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!`,w0.fromRepresentation([[P0,P0,P0,P0,P0,P0,P0,P0],[P0,P0,P0,P0,P0,P0,P0,P0],[P0,P0,P0,P0,I0,P0,P0,P0],[O0,P0,P0,P0,O0,P0,P0,P0]],3),[new v0(0,y0.ONE_FIRST)],$localize`Congratulations, you won!`,$localize`Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board.`),jJ.fromMove($localize`Types of move`,$localize`You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board.`,w0.fromRepresentation([[P0,P0,P0,P0,P0,P0,P0,P0],[P0,P0,P0,P0,k0,P0,P0,P0],[P0,P0,P0,P0,O0,P0,P0,P0],[I0,P0,P0,P0,T0,P0,P0,P0]],4),[_0.fromRepresentation(new yJ(4,3),"counterclockwise"),_0.fromRepresentation(new yJ(4,3),"clockwise"),_0.fromRepresentation(new yJ(4,2),"counterclockwise"),_0.fromRepresentation(new yJ(4,2),"clockwise")],$localize`Congratulations!`,$localize`Failed, try to move one of your piece that is already on the board.`),jJ.fromMove($localize`Special case`,$localize`It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!`,w0.fromRepresentation([[P0,P0,P0,P0,O0,P0,P0,P0],[P0,P0,P0,P0,k0,P0,P0,O0],[P0,P0,P0,P0,O0,P0,P0,k0],[P0,I0,P0,P0,T0,P0,P0,I0]],8),[_0.fromRepresentation(new yJ(4,2),"counterclockwise")],$localize`Congratulations!`,$localize`Failed, try to shift a stack of pieces to the left.`)]}}function M0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"path",6),Ea("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),pa(2,"path",7),Ea("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ta("id","click_",e,""),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.BOARD_PATHS[e]),Ts(1),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.DECORATION_PATHS[e])}}function N0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",9),Ea("click",function(){const t=Gt(e).$implicit,n=ba().$implicit;return ba().onPieceInGameClick(n,t.y)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",ba().$implicit,"_",e.y,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}function R0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,N0,3,8,"g",8),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.viewInfo.boardInfo[e].pieces)}}function x0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",12),Ea("click",function(){const t=Gt(e).$implicit;return ba().onRemainingPieceClick(t.actualPiece)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","piece_",e.actualPiece.owner.value,"_",e.actualPiece.otherPieceType?1:0,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}const D0=function(){return[0,1,2,3,4,5,6,7]},L0=function(){return[2,1,3,0,4,7,5,6]};class F0 extends vJ{constructor(e){super(e),this.BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],this.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],this.selected=Mw.empty(),this.viewInfo={boardInfo:[],remainingPieces:[]},this.rules=S0.get(),this.availableMinimaxes=[new b0(this.rules,"DiamDummyMinimax")],this.encoder=C0,this.tutorial=(new A0).tutorial}ngOnInit(){this.updateBoard()}onSpaceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e);return n.isFailure()?t.cancelMove(n.getReason()):t.onSpaceClickAfterCheck(e)})()}onSpaceClickAfterCheck(e){var t=this;return Pw(function*(){if(t.selected.isPresent()){const n=t.selected.get();let r;if("pieceFromReserve"===n.type)r=new v0(e,n.piece);else if((n.position.x+1)%w0.WIDTH===e)r=new _0(n.position,"clockwise");else{if((n.position.x+(w0.WIDTH-1))%w0.WIDTH!==e)return t.cancelMove(E0.MUST_SHIFT_TO_NEIGHBOR());r=new _0(n.position,"counterclockwise")}return t.chooseMove(r,t.getState())}return t.cancelMove(E0.MUST_SELECT_PIECE_FIRST())})()}onPieceInGameClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=Mw.of({type:"pieceFromBoard",position:new yJ(e,t)}),n.updateViewInfo(),QG.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE())})()}onRemainingPieceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay(t.getPieceId(e));return n.isFailure()?t.cancelMove(n.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=Mw.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),QG.SUCCESS):t.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE())})()}getPieceId(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}getLastMovedFromDrop(e,t){const n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),s=this.getDrawPositionOnBoard(r,i),o=new yJ(r,i);return[{start:Mw.empty(),end:o,startDrawPosition:n,endDrawPosition:s}]}getLastMovedFromShift(e,t){const n=e.start.x,r=e.getTarget();let i=t.getStackHeight(r);const s=[];for(let o=e.start.y;o<w0.HEIGHT&&t.getPieceAtXY(n,o)!==y0.EMPTY;o++,i++)s.push({start:Mw.of(new yJ(n,o)),end:new yJ(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return s}updateViewInfo(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}updateBoardInfo(){for(let e=0;e<w0.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}showLastMove(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}showLastMoveOnSpaces(){const e=this.rules.node.move;nq(e.isPresent(),"showLastMoveOnSpaces called without a last move");const t=e.get();for(let n=0;n<w0.WIDTH;n++){const e=[];t.isDrop()?t.getTarget()===n&&e.push("moved"):(t.getTarget()===n||t.start.x===n)&&e.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=e}}showLastMoveOnPieces(){const e=this.rules.node.move;nq(e.isPresent(),"showLastMoveOnPieces called without a last move");const t=e.get(),n=this.getPreviousState();let r=[];r=t.isDrop()?this.getLastMovedFromDrop(t,n):this.getLastMovedFromShift(t,n);for(const i of r)this.viewInfo.boardInfo[i.end.x].pieces[i.end.y].foregroundClasses.push("last-move")}updateRemainingPiecesInfo(){const e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];const t=this.isPlayerTurn();for(const n of y0.PLAYER_PIECES){const r=this.getState().getRemainingPiecesOf(n);for(let i=0;i<r;i++){const s=[];this.isTopPieceOfReserveAndSelected(i,r,n)&&s.push("selected"),t&&i===r-1&&n.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+n.owner.value+(n.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionRemainingPiece(n,i),actualPiece:n})}}}isTopPieceOfReserveAndSelected(e,t,n){if(this.selected.isPresent()){const r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}getDrawPositionRemainingPiece(e,t){let n,r;return n=e.owner===cK.ZERO?-100:600,r=e.otherPieceType?100:450,new yJ(n,r).getNext(new hJ(0,-t*F0.PIECE_HEIGHT))}getPieces(e){const t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[];for(let i=0;i<w0.HEIGHT;i++){const s=this.getState().getPieceAtXY(e,i),o=new yJ(e,i);if(s!==y0.EMPTY){const a=[];this.pieceFromBoardIsSelected(e,i)&&a.push("selected"),this.isVictory(e,i,t)&&a.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&a.push("clickable-hover"),r.push({backgroundClasses:["player"+s.owner.value+(s.otherPieceType?"-alternate":"")],foregroundClasses:a,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:s})}}return r}pieceFromBoardIsSelected(e,t){if(this.selected.isPresent()){const n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}isVictory(e,t,n){if(n.isPresent()){const r=n.get();return r.x%4==e%4&&r.y===t}return!1}getDrawPositionOnBoard(e,t){return F0.CENTER[e].getNext(new hJ(0,-t*F0.PIECE_HEIGHT))}cancelMoveAttempt(){this.selected=Mw.empty(),this.updateBoard()}}F0.CENTER=[new yJ(40,160),new yJ(100,50),new yJ(255,2),new yJ(400,50),new yJ(460,160),new yJ(400,270),new yJ(255,320),new yJ(100,270)],F0.PIECE_HEIGHT=36,F0.\u0275fac=function(e){return new(e||F0)(ua(eq))},F0.\u0275cmp=Xe({type:F0,selectors:[["app-diam"]],features:[Go],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"g",1),ga(3,"path",2),ga(4,"ellipse",3),fa(),fa(),la(5,M0,3,5,"g",4),la(6,R0,2,1,"g",4),la(7,x0,3,8,"g",5),fa()),2&e&&(Ts(5),ha("ngForOf",wu(3,D0)),Ts(1),ha("ngForOf",wu(4,L0)),Ts(1),ha("ngForOf",t.viewInfo.remainingPieces))},directives:[tp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class U0{constructor(e,t){this.offset=e,this.constant=t}static fromTwoCoords(e,t){const n=e.x,r=t.x,i=e.y,s=t.y,o=n+i,a=r+s;return n===r&&i!==s&&o!==a?Mw.of(U0.constantQ(n)):n!==r&&i===s&&o!==a?Mw.of(U0.constantR(i)):n!==r&&i!==s&&o===a?Mw.of(U0.constantS(o)):Mw.empty()}static constantQ(e){return new U0(e,"q")}static constantR(e){return new U0(e,"r")}static constantS(e){return new U0(e,"s")}static areOnSameLine(e){if(e.length<2)return!0;const t=U0.fromTwoCoords(e[0],e[1]);if(t.isAbsent())return!1;const n=t.get();for(const r of e.slice(2))if(!1===n.contains(r))return!1;return!0}toString(){return`Line(${this.constant}, ${this.offset})`}equals(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}contains(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}getDirection(){switch(this.constant){case"q":return EJ.DOWN;case"r":return EJ.RIGHT;case"s":return EJ.DOWN_LEFT}}}class B0 extends NJ{constructor(e,t,n,r,i,s){super(t,e),this.board=t,this.width=n,this.height=r,this.excludedCases=i,this.empty=s,nq(this.excludedCases.length<this.height/2+1,"Invalid excluded cases specification for HexagonalGameState.")}static neighbors(e,t){return[new yJ(e.x+t,e.y-t),new yJ(e.x+t,e.y),new yJ(e.x-t,e.y+t),new yJ(e.x-t,e.y),new yJ(e.x,e.y+t),new yJ(e.x,e.y-t)]}setAt(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}equalsT(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(let n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;for(const n of this.allCoords())if(!1===t(this.getPieceAt(n),e.getPieceAt(n)))return!1;return!0}allCoords(){const e=[];return this.forEachCoord(t=>{e.push(t)}),e}allLines(){const e=[];for(let t=0;t<this.width;t++)e.push(U0.constantQ(t));for(let t=0;t<this.height;t++)e.push(U0.constantR(t));for(let t=this.excludedCases.length;t<this.height+this.excludedCases.length;t++)e.push(U0.constantS(t));return e}getEntranceOnLine(e){let t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new yJ(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new yJ(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new yJ(e.offset,0):new yJ(this.width-1,e.offset-this.width+1))}}findEntranceFrom(e,t){const n=e.getDirection();let r=t;for(let s=0;s<Math.max(this.width,this.height);s++){if(this.isOnBoard(r))return r;r=r.getNext(n)}const i=tq.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(i.getReason())}}class V0{constructor(e,t,n){this.owner=e,this.size=t,this.source=n}static append(e,t){return new V0(e.owner,e.size+t.size,e.source||t.source)}getValue(){return V0.encoder.encodeNumber(this)}getOwner(){return this.owner}belongsTo(e){return this.owner===e}containsSource(){return this.source}isEmpty(){return 0===this.size}getSize(){return this.size}toString(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}V0.sizeEncoder=aK.numberEncoder(49),V0.encoder=aK.tuple([aK.booleanEncoder,cK.numberEncoder,V0.sizeEncoder],e=>[e.source,e.owner,e.size],e=>new V0(e[1],e[2],e[0])),V0.MAX_SIZE=49,V0.EMPTY=new V0(uK.NONE,0,!1),V0.UNREACHABLE=new V0(uK.NONE,-1,!1),V0.PLAYER_ZERO=new V0(cK.ZERO,1,!1),V0.PLAYER_ONE=new V0(cK.ONE,1,!1),V0.SOURCE=new V0(uK.NONE,1,!0);let $0=(()=>{class e extends B0{constructor(t,n,r){super(n,t,e.WIDTH,e.HEIGHT,e.EXCLUDED_CASES,V0.EMPTY),this.alreadyPassed=r}static balancedBoard(){const e=V0.UNREACHABLE,t=V0.PLAYER_ZERO,n=V0.PLAYER_ONE,r=V0.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}static isOnBoard(t){return!t.isNotInRange(e.WIDTH,e.HEIGHT)&&e.balancedBoard()[t.y][t.x]!==V0.UNREACHABLE}static getInitialState(){return new e(e.balancedBoard(),0,!1)}getAllPieces(){const t=[];for(let n=0;n<e.HEIGHT;n++)for(let r=0;r<e.WIDTH;r++){const e=new yJ(r,n);this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()&&t.push(e)}return t}numberOfNeighbors(e){return B0.neighbors(e,1).filter(e=>this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()).length}setAtUnsafe(t,n){const r=fK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.turn,this.alreadyPassed)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==V0.UNREACHABLE}}return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e})();class z0 extends UX{constructor(e,t){super(e,t)}static of(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return z0.PASS;if(!$0.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!$0.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new z0(e,t);if(e.x===t.x)return new z0(e,t);if(e.x+e.y===t.x+t.y)return new z0(e,t);throw new Error("Invalid move")}toString(){return this===z0.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}length(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}z0.PASS=new z0(new yJ(-1,-1),new yJ(-2,-2)),z0.encoder=new class extends aK{maxValue(){return 42148}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return z0.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new z0(new yJ((e=e/16|0)%16,r),new yJ(n,t))}};let H0=(()=>{class e{}return e.NOT_PLAYER_PIECE=()=>$localize`You must select a piece or a stack of your color.`,e.EMPTY_STACK=()=>$localize`You must select a stack.`,e.TOO_MANY_NEIGHBORS=()=>$localize`This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors.`,e.CANT_REACH_TARGET=()=>$localize`This stack cannot move because it could never land on another piece.`,e.INVALID_MOVE_LENGTH=()=>$localize`A stack must always be moved by as many spaces as there are pieces in the stack.`,e.EMPTY_TARGET_STACK=()=>$localize`The stack must land on an occupied space.`,e})();class G0 extends HJ{static getGameStatus(e){const t=e.gameState,n=G0.getScores(t);return 0===G0.getMovablePieces(t).length?n[0]>n[1]?zJ.ZERO_WON:n[0]<n[1]?zJ.ONE_WON:zJ.DRAW:zJ.ONGOING}static getMovablePieces(e){return G0.getFreePieces(e).filter(t=>G0.pieceHasTarget(e,t))}static getFreePieces(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6)}static pieceHasTarget(e,t){const n=e.getPieceAt(t).getSize();return void 0!==B0.neighbors(t,n).find(t=>e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty())}static pieceTargets(e,t){const n=e.getPieceAt(t).getSize();return B0.neighbors(t,n).filter(t=>e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty())}static getScores(e){let t=0,n=0;return e.getAllPieces().map(r=>{const i=e.getPieceAt(r);i.belongsTo(cK.ZERO)?t+=i.getSize():i.belongsTo(cK.ONE)&&(n+=i.getSize())}),[t,n]}isMovablePiece(e,t){nq(e.isOnBoard(t),"piece is not on the board");const n=e.getPieceAt(t);return n.getSize()<1?QG.failure(H0.EMPTY_STACK()):n.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?QG.failure(H0.TOO_MANY_NEIGHBORS()):G0.pieceHasTarget(e,t)?QG.SUCCESS:QG.failure(H0.CANT_REACH_TARGET()):QG.failure(H0.NOT_PLAYER_PIECE())}canOnlyPass(e){return 0===G0.getMovablePieces(e).length}sourceCoords(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).containsSource())}markPiecesConnectedTo(e,t,n){B0.neighbors(t,1).forEach(t=>{e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,this.markPiecesConnectedTo(e,t,n))})}removeDisconnectedPieces(e){const t=fK.createTable($0.WIDTH,$0.HEIGHT,!1);this.sourceCoords(e).forEach(n=>{t[n.y][n.x]=!0,this.markPiecesConnectedTo(e,n,t)});let n=e;return n.getAllPieces().forEach(e=>{t[e.y][e.x]||(n=n.setAt(e,V0.EMPTY))}),n}applyLegalMove(e,t,n){if(e===z0.PASS)return new $0(t.board,t.turn+1,!0);{const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end),i=t.setAt(e.coord,V0.EMPTY).setAt(e.end,V0.append(n,r));return this.removeDisconnectedPieces(new $0(i.board,t.turn+1,!1))}}isLegal(e,t){if(0===G0.getMovablePieces(t).length)return e!==z0.PASS||t.alreadyPassed?ZG.failure(OJ.MUST_PASS()):ZG.success(void 0);if(e===z0.PASS)return ZG.failure(OJ.CANNOT_PASS());const n=this.isMovablePiece(t,e.coord);if(n.isFailure())return n.toFailedFallible();const r=t.getPieceAt(e.coord);return e.length()!==r.getSize()?ZG.failure(H0.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?ZG.failure(H0.EMPTY_TARGET_STACK()):ZG.success(void 0)}getGameStatus(e){return G0.getGameStatus(e)}}class q0 extends TJ{getListMoves(e){const t=e.move,n=e.gameState,r=[];return G0.getMovablePieces(n).forEach(e=>G0.pieceTargets(n,e).forEach(t=>{const n=z0.of(e,t);r.push(n)})),0===r.length&&!1===t.equalsValue(z0.PASS)&&r.push(z0.PASS),r}getBoardValue(e){const t=e.gameState,n=G0.getScores(t);return 0===G0.getMovablePieces(t).length?new IJ(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new IJ(n[0]-n[1])}}class W0 extends q0{getListMoves(e){const t=e.gameState,n=super.getListMoves(e),r=t.getCurrentPlayer().getOpponent();return fK.sortByDescending(n,e=>{nq(e!==z0.PASS,"Cannot sort with DvonnMove.PASS");const n=t.getPieceAt(e.end);return n.belongsTo(r)?n.getSize():0}),n}getBoardValue(e){const t=G0.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState,r=G0.getScores(n),i=n.getAllPieces(),s=i.length,o=i.filter(e=>n.getPieceAt(e).belongsTo(cK.ZERO)).length,a=i.filter(e=>n.getPieceAt(e).belongsTo(cK.ONE)).length;return new IJ((a*r[1]-o*r[0])/s)}}const j0=V0.EMPTY,Z0=V0.UNREACHABLE,Y0=V0.SOURCE,K0=V0.PLAYER_ZERO,Q0=V0.PLAYER_ONE,J0=new V0(cK.ZERO,2,!1),X0=new V0(cK.ONE,2,!1),e2=new V0(cK.ZERO,4,!1),t2=new V0(cK.ONE,4,!1);class n2{constructor(){this.tutorial=[jJ.anyMove($localize`Moving`,$localize`At Dvonn, each hexagonal space contains a stack of pieces.
        If no number is indicated on a stack, it means that it only contains one piece.
        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.
        The owner of a stack is the one that has a piece at the top of the stack.
        Only the owner of a stack can move it.
        A stack cannot be moved if it is surrounded by 6 other stacks.
        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.
        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.
        Therefore, there are six possible directions.
        The player with dark pieces starts.<br/><br/>
        You're playing Dark, click on a stack and move it by one space.`,$0.getInitialState(),z0.of(new yJ(2,0),new yJ(3,0)),$localize`Congratulations!`),jJ.fromPredicate($localize`Disconnection`,$localize`Pieces with a lightning strike are called "sources".
        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>
        You're playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!`,new $0([[Z0,Z0,Q0,Y0,j0,j0,j0,j0,j0,j0,j0],[Z0,j0,K0,j0,j0,j0,j0,j0,j0,j0,j0],[j0,j0,t2,j0,j0,j0,j0,Q0,Y0,j0,j0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0,Z0]],0,!1),z0.of(new yJ(2,1),new yJ(2,0)),(e,t)=>e.end.equals(new yJ(3,0))?QG.failure($localize`You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it.`):(nq(e.end.equals(new yJ(2,0)),"player made an impossible move"),QG.SUCCESS),$localize`Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!
        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.
        Disconnected stacks will not be visible at the next turn.`),jJ.fromPredicate($localize`Moving on a source`,$localize`You are allowed to move your stacks on any other stack.
        This means that you can take control of a source by moving one of your stack on top of it.
        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>
        You're playing Dark and you can take control of a source, do it!`,new $0([[Z0,Z0,Y0,Q0,j0,j0,j0,j0,j0,j0,j0],[Z0,K0,K0,j0,j0,j0,j0,j0,j0,j0,j0],[j0,Q0,K0,Q0,j0,j0,K0,X0,Y0,j0,j0],[j0,j0,Q0,j0,j0,j0,j0,j0,j0,j0,Z0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0,Z0]],0,!1),z0.of(new yJ(2,1),new yJ(2,0)),(e,t)=>e.end.equals(new yJ(2,0))?QG.SUCCESS:QG.failure($localize`You have not taken possession of a source, try again.`),$localize`Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!`),jJ.informational($localize`Passing`,$localize`It can happen that you have no possible move to make.
        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>
        This is a situation that occurs here for Dark.`,new $0([[Z0,Z0,Y0,j0,j0,j0,j0,j0,j0,j0,j0],[Z0,j0,J0,j0,j0,j0,j0,j0,j0,j0,j0],[j0,j0,X0,j0,j0,j0,j0,X0,Y0,e2,j0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0,Z0]],0,!1)),jJ.fromMove($localize`End of the game`,$localize`When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>
        Make your last move.`,new $0([[Z0,Z0,Y0,j0,j0,j0,j0,j0,j0,j0,j0],[Z0,j0,K0,j0,j0,j0,j0,j0,j0,j0,j0],[j0,j0,j0,j0,j0,j0,j0,j0,Y0,e2,j0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0],[j0,j0,j0,j0,j0,j0,j0,j0,j0,Z0,Z0]],0,!1),[z0.of(new yJ(2,1),new yJ(2,0))],$localize`Congratulations, you won 6 - 0!`,$localize`Bad idea, by moving on the source you would have won a point.`)]}}function r2(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ha("ngClass",n.getPieceClasses(e)),ra("cx",n.getCenterAt(t).x)("cy",n.getCenterAt(t).y)("r",n.SPACE_SIZE)}}function i2(e,t){if(1&e&&(Cn(),ga(0,"polygon",11)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("transform",1===e.getSize()?"translate("+(n.getCenterAt(t).x-18)+" "+(n.getCenterAt(t).y-16)+") scale(0.10)":"translate("+(n.getCenterAt(t).x-3)+" "+(n.getCenterAt(t).y-12)+") scale(0.07)")}}function s2(e,t){if(1&e){const e=va();Cn(),pa(0,"text",12),Ea("click",function(){Gt(e);const t=ba(2).$implicit;return ba().onClick(t.x,t.y)}),Qa(1),fa()}if(2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("x",e.containsSource()?n.getCenterAt(t).x-7:n.getCenterAt(t).x)("y",n.getCenterAt(t).y),Ts(1),Ja(e.getSize())}}function o2(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t.x,t.y)}),ga(1,"polyline",6),la(2,r2,1,4,"circle",7),la(3,i2,1,1,"polygon",8),la(4,s2,2,3,"text",9),fa()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ia("id","click_",n.x,"_",n.y,""),Ts(1),ra("points",r.getHexaCoordsAt(n)),Ts(1),ha("ngIf",e.getSize()>0),Ts(1),ha("ngIf",e.containsSource()),Ts(1),ha("ngIf",e.getSize()>1)}}const a2=function(e){return[e]};function l2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,o2,5,6,"g",4),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",Su(1,a2,n.state.getPieceAt(e)))}}function c2(e,t){if(1&e&&(Cn(),pa(0,"text",16),Qa(1),fa()),2&e){const e=ba().$implicit,t=ba();ra("x",t.getCenterAt(e.coord).x)("y",t.getCenterAt(e.coord).y),Ts(1),Ja(e.caseContent.getSize())}}function u2(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",13),ga(2,"circle",14),la(3,c2,2,3,"text",15),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ra("points",n.getHexaCoordsAt(e.coord)),Ts(1),Ia("id","captured_",e.coord.x,"_",e.coord.y,""),ha("ngClass",n.getPieceClasses(e.caseContent)),ra("cx",n.getCenterAt(e.coord).x)("cy",n.getCenterAt(e.coord).y)("r",n.SPACE_SIZE),Ts(1),ha("ngIf",e.caseContent.getSize()>1)}}function h2(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",17),ga(2,"polyline",17),ya()),2&e){const e=ba();Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().coord)),Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().end))}}function d2(e,t){if(1&e&&(Cn(),ga(0,"polyline",18)),2&e){const e=ba();ra("points",e.getHexaCoordsAt(e.chosen.get()))}}let p2=(()=>{class e extends _J{constructor(e){super(e),this.lastMove=Mw.empty(),this.chosen=Mw.empty(),this.disconnecteds=[],this.rules=new G0($0),this.availableMinimaxes=[new q0(this.rules,"DvonnMinimax"),new W0(this.rules,"DvonnMinimaxMaximizeStacks")],this.encoder=z0.encoder,this.tutorial=(new n2).tutorial,this.SPACE_SIZE=30,this.canPass=!1,this.scores=Mw.of(G0.getScores(this.rules.node.gameState)),this.hexaLayout=new wJ(1.5*this.SPACE_SIZE,new yJ(-this.SPACE_SIZE,2*this.SPACE_SIZE),bJ.INSTANCE),this.state=this.rules.node.gameState,this.hexaBoard=this.rules.node.gameState.board}hideLastMove(){this.lastMove=Mw.empty()}updateBoard(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=Mw.of(G0.getScores(this.state))}calculateDisconnecteds(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState;for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[n].length;r++){const i=new yJ(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){const s=t.getPieceAt(i),o=e.getPieceAt(i);if(s.isEmpty()&&!o.isEmpty()){const e={coord:new yJ(r,n),caseContent:o};this.disconnecteds.push(e)}}}}cancelMoveAttempt(){this.chosen=Mw.empty()}pass(){var e=this;return Pw(function*(){return nq(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),yield e.chooseMove(z0.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosen.isAbsent()?n.choosePiece(e,t):n.chosen.equalsValue(new yJ(e,t))?(n.cancelMoveAttempt(),QG.SUCCESS):yield n.chooseDestination(e,t)})()}choosePiece(e,t){const n=new yJ(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=Mw.of(n),QG.SUCCESS):this.cancelMove(r.getReason())}chooseDestination(e,t){var n=this;return Pw(function*(){const r=n.chosen.get(),i=new yJ(e,t),s=z0.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];const t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-dvonn"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","semi-transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,l2,2,3,"g",1),la(2,u2,4,8,"g",1),la(3,h2,3,2,"ng-container",2),la(4,d2,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.state.allCoords()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();var f2=(()=>(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(f2||(f2={})),f2))();class g2{constructor(e){this.value=e}static of(e){switch(e){case 0:return g2.SMALL_BLACK;case 1:return g2.SMALL_WHITE;case 2:return g2.MEDIUM_BLACK;case 3:return g2.MEDIUM_WHITE;case 4:return g2.BIG_BLACK;case 5:return g2.BIG_WHITE;case 6:return g2.EMPTY;default:throw new Error("Invalid value "+e+" for EncapsulePiece")}}static ofSizeAndPlayer(e,t){return t===cK.ZERO&&e===f2.BIG?g2.BIG_BLACK:t===cK.ZERO&&e===f2.MEDIUM?g2.MEDIUM_BLACK:t===cK.ZERO&&e===f2.SMALL?g2.SMALL_BLACK:t===cK.ONE&&e===f2.BIG?g2.BIG_WHITE:t===cK.ONE&&e===f2.MEDIUM?g2.MEDIUM_WHITE:t===cK.ONE&&e===f2.SMALL?g2.SMALL_WHITE:g2.EMPTY}getPlayer(){switch(this){case g2.SMALL_BLACK:case g2.MEDIUM_BLACK:case g2.BIG_BLACK:return cK.ZERO;case g2.SMALL_WHITE:case g2.MEDIUM_WHITE:case g2.BIG_WHITE:return cK.ONE;default:return uK.NONE}}getSize(){switch(this){case g2.BIG_BLACK:case g2.BIG_WHITE:return f2.BIG;case g2.MEDIUM_BLACK:case g2.MEDIUM_WHITE:return f2.MEDIUM;case g2.SMALL_BLACK:case g2.SMALL_WHITE:return f2.SMALL;default:return Ow.expectToBe(this,g2.EMPTY),f2.NONE}}belongsTo(e){return this.getPlayer()===e}equals(e){return this===e}toString(){switch(this){case g2.BIG_BLACK:return"BIG_BLACK";case g2.BIG_WHITE:return"BIG_WHITE";case g2.MEDIUM_BLACK:return"MEDIUM_BLACK";case g2.MEDIUM_WHITE:return"MEDIUM_WHITE";case g2.SMALL_BLACK:return"SMALL_BLACK";case g2.SMALL_WHITE:return"SMALL_WHITE";default:return Ow.expectToBe(this,g2.EMPTY),"EMPTY"}}}g2.SMALL_BLACK=new g2(0),g2.SMALL_WHITE=new g2(1),g2.MEDIUM_BLACK=new g2(2),g2.MEDIUM_WHITE=new g2(3),g2.BIG_BLACK=new g2(4),g2.BIG_WHITE=new g2(5),g2.EMPTY=new g2(6);class m2 extends NJ{constructor(e,t,n){super(e,t),this.remainingPieces=n}static getInitialState(){const e=new y2(uK.NONE,uK.NONE,uK.NONE).encode(),t=fK.createTable(3,3,e),n=fK.mapBiArray(t,e=>y2.decode(e));return new m2(n,0,[g2.BIG_BLACK,g2.BIG_BLACK,g2.BIG_WHITE,g2.BIG_WHITE,g2.MEDIUM_BLACK,g2.MEDIUM_BLACK,g2.MEDIUM_WHITE,g2.MEDIUM_WHITE,g2.SMALL_BLACK,g2.SMALL_BLACK,g2.SMALL_WHITE,g2.SMALL_WHITE])}getRemainingPieces(){return fK.copyImmutableArray(this.remainingPieces)}getRemainingPiecesOfPlayer(e){return this.getRemainingPieces().filter(t=>t.getPlayer()===e)}pieceBelongsToCurrentPlayer(e){return e.belongsTo(this.getCurrentPlayer())}isDroppable(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}isInRemainingPieces(e){return this.remainingPieces.some(t=>t===e)}getPlayerRemainingPieces(){return this.remainingPieces.filter(e=>this.pieceBelongsToCurrentPlayer(e))}}class y2{constructor(e,t,n){this.small=e,this.medium=t,this.big=n}static decode(e){nq(e%1==0,"EncapsuleCase must be encoded as integer: "+e),nq(e>=0,"To small representation for EncapsuleCase: "+e),nq(e<=26,"To big representation for EncapsuleCase: "+e);const t=cK.numberEncoder.decodeNumber(e%3);e-=t.value;const n=cK.numberEncoder.decodeNumber((e/=3)%3);e-=n.value;const r=cK.numberEncoder.decodeNumber(e/=3);return new y2(t,n,r)}isEmpty(){return this.small===uK.NONE&&this.medium===uK.NONE&&this.big===uK.NONE}toList(){const e=[];return this.small.isPlayer()&&e.push(g2.ofSizeAndPlayer(f2.SMALL,this.small)),this.medium.isPlayer()&&e.push(g2.ofSizeAndPlayer(f2.MEDIUM,this.medium)),this.big.isPlayer()&&e.push(g2.ofSizeAndPlayer(f2.BIG,this.big)),e}toOrderedPieceNames(){const e=g2.ofSizeAndPlayer(f2.SMALL,this.small),t=g2.ofSizeAndPlayer(f2.MEDIUM,this.medium),n=g2.ofSizeAndPlayer(f2.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}getBiggest(){return this.big===cK.ZERO?g2.BIG_BLACK:this.big===cK.ONE?g2.BIG_WHITE:this.medium===cK.ZERO?g2.MEDIUM_BLACK:this.medium===cK.ONE?g2.MEDIUM_WHITE:this.small===cK.ZERO?g2.SMALL_BLACK:this.small===cK.ONE?g2.SMALL_WHITE:g2.EMPTY}tryToSuperposePiece(e){const t=this.getBiggest().getSize();if(e===g2.EMPTY)throw new Error("Cannot move EMPTY on a space");return e.getSize()>t?Mw.of(this.put(e)):Mw.empty()}removeBiggest(){const e=this.getBiggest();if(e===g2.EMPTY)throw new Error("Cannot removed piece from empty space");let t;const n=e.getSize();switch(n){case f2.BIG:t=new y2(this.small,this.medium,uK.NONE);break;case f2.MEDIUM:t=new y2(this.small,uK.NONE,uK.NONE);break;default:Ow.expectToBe(n,f2.SMALL),t=new y2(uK.NONE,uK.NONE,uK.NONE)}return{removedCase:t,removedPiece:e}}put(e){if(e===g2.EMPTY)throw new Error("Cannot put EMPTY on space");const t=e.getPlayer(),n=e.getSize();switch(n){case f2.BIG:return new y2(this.small,this.medium,t);case f2.MEDIUM:return nq(this.big===uK.NONE,"Cannot put a piece on top of a bigger one"),new y2(this.small,t,this.big);default:return Ow.expectToBe(n,f2.SMALL),nq(this.big===uK.NONE,"Cannot put a piece on top of a bigger one"),nq(this.medium===uK.NONE,"Cannot put a piece on top of a bigger one"),new y2(t,this.medium,this.big)}}encode(){return this.small.value+3*this.medium.value+9*this.big.value}belongsTo(e){return this.getBiggest().getPlayer()===e}toString(){const e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}y2.EMPTY=new y2(uK.NONE,uK.NONE,uK.NONE);let v2=(()=>{class e{}return e.PIECE_OUT_OF_STOCK=()=>$localize`You do not have pieces of this type anymore.`,e.INVALID_PLACEMENT=()=>$localize`You must put your piece on an empty square or on a smaller piece.`,e.NOT_DROPPABLE=()=>$localize`You must pick your piece among the remaining ones.`,e.INVALID_PIECE_SELECTED=()=>$localize`You must pick one of your remaining pieces or one piece on the board that is the biggest of its square.`,e.SAME_DEST_AS_ORIGIN=()=>$localize`You must select a different landing square than the square where the move originates from.`,e.END_YOUR_MOVE=()=>$localize`You are performing a move, you must select a landing square.`,e})();class _2 extends HJ{static isVictory(e){const t=e.getCopiedBoard();for(const n of _2.LINES){const e=_2.isVictoriousLine([t[n[0].y][n[0].x],t[n[1].y][n[1].x],t[n[2].y][n[2].x]]);if(e.isPresent())return e}return Mw.empty()}static isVictoriousLine(e){const t=e.map(e=>e.getBiggest()).map(e=>e.getPlayer());return t[0]===uK.NONE?Mw.empty():t[0]===t[1]&&t[1]===t[2]?Mw.of(t[0]):Mw.empty()}static isLegal(e,t){let n;if(Tw(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return ZG.failure(v2.PIECE_OUT_OF_STOCK())}else{const r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE())}const r=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return r.isPresent()?ZG.success(r.get()):ZG.failure(v2.INVALID_PLACEMENT())}isLegal(e,t){return _2.isLegal(e,t)}applyLegalMove(e,t,n){const r=t.getCopiedBoard();let i=t.getRemainingPieces();const s=t.turn+1;let o;if(r[e.landingCoord.y][e.landingCoord.x]=y2.decode(n.encode()),e.isDropping()){o=e.piece.get();const t=i.indexOf(o);i=i.slice(0,t).concat(i.slice(t+1))}else{const t=e.startingCoord.get(),n=r[t.y][t.x].encode(),i=y2.decode(n).removeBiggest();r[t.y][t.x]=y2.decode(i.removedCase.encode()),o=i.removedPiece}return new m2(r,s,i)}static getGameStatus(e){const t=_2.isVictory(e.gameState);return t.isPresent()?zJ.getVictory(t.get()):zJ.ONGOING}getGameStatus(e){return _2.getGameStatus(e)}}_2.LINES=[[new yJ(0,0),new yJ(0,1),new yJ(0,2)],[new yJ(1,0),new yJ(1,1),new yJ(1,2)],[new yJ(2,0),new yJ(2,1),new yJ(2,2)],[new yJ(0,0),new yJ(1,0),new yJ(2,0)],[new yJ(0,1),new yJ(1,1),new yJ(2,1)],[new yJ(0,2),new yJ(1,2),new yJ(2,2)],[new yJ(0,0),new yJ(1,1),new yJ(2,2)],[new yJ(0,2),new yJ(1,1),new yJ(2,0)]];class C2 extends xJ{constructor(e,t,n){super(),this.startingCoord=e,this.landingCoord=t,this.piece=n}static fromMove(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new C2(Mw.of(e),t,Mw.empty())}static fromDrop(e,t){return new C2(Mw.empty(),t,Mw.of(e))}isDropping(){return this.startingCoord.isAbsent()}equals(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}toString(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}C2.encoder=new class extends aK{maxValue(){return 161}encodeNumber(e){const t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){const r=0;return 18*e.piece.get().value+6*t+2*n+r}{const r=1,i=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*i+6*t+2*n+r}}decodeNumber(e){const t=e%2;e-=t;const n=(e/=2)%3;e-=n;const r=(e/=3)%3;e-=r,e/=3;const i=new yJ(r,n);if(0===t){const t=g2.of(e);return C2.fromDrop(t,i)}{const t=e%3;e-=t;const n=new yJ((e/=3)%3,t);return C2.fromMove(n,i)}}};class E2 extends TJ{getBoardValue(e){const t=_2.getGameStatus(e);return new IJ(t.toBoardValue())}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),s=kJ.toComparableObjectSet(n.getPlayerRemainingPieces());for(let o=0;o<3;o++)for(let e=0;e<3;e++){const a=new yJ(e,o);for(const e of s){const r=C2.fromDrop(e,a);_2.isLegal(r,n).isSuccess()&&t.push(r)}if(r[o][e].belongsTo(i))for(let e=0;e<3;e++)for(let r=0;r<3;r++){const i=new yJ(r,e);if(!i.equals(a)){const e=C2.fromMove(a,i);_2.isLegal(e,n).isSuccess()&&t.push(e)}}}return t}}const w2=new y2(uK.NONE,uK.NONE,uK.NONE),S2=new y2(cK.ZERO,uK.NONE,uK.NONE),b2=new y2(uK.NONE,cK.ZERO,uK.NONE),P2=new y2(uK.NONE,uK.NONE,cK.ZERO),O2=new y2(cK.ONE,uK.NONE,uK.NONE),T2=new y2(uK.NONE,uK.NONE,cK.ONE),I2=new y2(cK.ONE,cK.ZERO,uK.NONE),k2=new y2(cK.ZERO,cK.ZERO,uK.NONE);class A2{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`The goal of Encapsule is to align three of your pieces.
        Here, we have a victory of the dark player.`,new m2([[S2,O2,T2],[w2,b2,w2],[w2,w2,P2]],0,[g2.SMALL_BLACK,g2.MEDIUM_BLACK,g2.BIG_BLACK,g2.SMALL_WHITE,g2.MEDIUM_WHITE,g2.MEDIUM_WHITE,g2.BIG_WHITE])),jJ.anyMove($localize`Putting a piece`,$localize`This is the initial board. You're playing Dark.<br/><br/>
        Pick one of your piece on the side of the board and put it on the board.`,m2.getInitialState(),C2.fromDrop(g2.SMALL_BLACK,new yJ(1,1)),$localize`Congratulations!`),jJ.fromMove($localize`Moving`,$localize`Another possible action is to move one of your pieces that is already on the board.<br/><br/>
        Click on your dark piece and then on any empty square of the board.`,new m2([[S2,T2,w2],[w2,w2,w2],[w2,w2,w2]],0,[]),[C2.fromMove(new yJ(0,0),new yJ(2,0)),C2.fromMove(new yJ(0,0),new yJ(0,1)),C2.fromMove(new yJ(0,0),new yJ(1,1)),C2.fromMove(new yJ(0,0),new yJ(2,1)),C2.fromMove(new yJ(0,0),new yJ(0,2)),C2.fromMove(new yJ(0,0),new yJ(1,2)),C2.fromMove(new yJ(0,0),new yJ(2,2))],$localize`Congratulations!`,$localize`Failed. Try again.`),jJ.fromPredicate($localize`Particularity`,$localize`At Encapsule, pieces encapsulate each other.
        It is therefore possible to have up to three pieces per square!
        However, only the biggest piece of each square counts:
        you cannot win with a piece that is "hidden" by a bigger piece.
        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.
        Finally, you cannot encapsulate a piece with a smaller piece.
        You're playing Dark and you can win now in various ways.<br/><br/>
        Try to win by making a move, and not by putting a new piece on the board.`,new m2([[I2,w2,O2],[k2,T2,T2],[w2,w2,w2]],0,[g2.MEDIUM_BLACK,g2.BIG_BLACK,g2.MEDIUM_WHITE,g2.MEDIUM_WHITE]),C2.fromMove(new yJ(0,1),new yJ(0,2)),(e,t)=>{if(e.landingCoord.equals(new yJ(0,2))){if(e.isDropping())return QG.failure($localize`You won, but the exercise is to win while moving a piece!`);if(e.startingCoord.equalsValue(new yJ(0,1)))return QG.SUCCESS}return QG.failure($localize`Failed. Try again.`)},$localize`Congratulations!`)]}}function M2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(0,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Ta("id","piece_0_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(0,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}function N2(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onBoardClick(t,n)}),fa()}if(2&e){const e=t.$implicit,n=ba().index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(e)),ra("r",i.getPieceRadius(e))("cx",i.SPACE_SIZE*n+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function R2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),la(2,N2,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getRectClasses(n,r)),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngForOf",i.getListPieces(e))}}function x2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,R2,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function D2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",9),Ea("click",function(){const t=Gt(e).$implicit;return ba().onBoardClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function L2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(1,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Ta("id","piece_1_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(1,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}let F2=(()=>{class e extends IX{constructor(e){super(e),this.INTER_PIECE_SPACE=20,this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.chosenCoord=Mw.empty(),this.chosenPiece=Mw.empty(),this.remainingPieceLeftX=[],this.rules=new _2(m2),this.availableMinimaxes=[new E2(this.rules,"EncapsuleMinimax")],this.encoder=C2.encoder,this.tutorial=(new A2).tutorial,this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard();const e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=Mw.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty())}getListPieces(e){return e.toList()}getRemainingPieces(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(cK.of(e))}onBoardClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new yJ(e,t),s=n.rules.node.gameState;if(n.chosenCoord.isAbsent()){if(n.chosenCoord=Mw.of(i),n.chosenPiece.isPresent()){const e=C2.fromDrop(n.chosenPiece.get(),i);return n.chooseMove(e,n.rules.node.gameState)}return!1===s.getPieceAt(i).belongsTo(s.getCurrentPlayer())?n.cancelMove(v2.INVALID_PIECE_SELECTED()):QG.SUCCESS}if(n.chosenCoord.equalsValue(i))return n.cancelMove(v2.SAME_DEST_AS_ORIGIN());{const e=C2.fromMove(n.chosenCoord.get(),i);return n.chooseMove(e,n.rules.node.gameState)}})()}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.chosenPiece=Mw.empty(),this.chosenPieceIndex=-1}onPieceClick(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t.toString());return i.isFailure()?r.cancelMove(i.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(v2.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=Mw.of(t),r.chosenPieceIndex=n,QG.SUCCESS):r.cancelMove(v2.END_YOUR_MOVE())})()}getRectClasses(e,t){return this.isSelected(e,t)?"moved":""}isSelected(e,t){const n=new yJ(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}getPieceClasses(e){return[this.getPieceStrokeClass(e)]}getPieceStrokeClass(e){const t=e.getPlayer();return nq(t.isPlayer(),"EncapsuleComponent.getPieceStrokeClass should only be called with actual pieces!"),"player"+t.value+"-stroke"}getPieceRadius(e){switch(e.getSize()){case f2.BIG:return this.SPACE_SIZE/2-1*this.STROKE_WIDTH;case f2.MEDIUM:return this.SPACE_SIZE/2-2*this.STROKE_WIDTH-3;default:return Ow.expectToBe(e.getSize(),f2.SMALL),this.SPACE_SIZE/2-3*this.STROKE_WIDTH-6}}getHighlightedCases(){const e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}getSidePieceClasses(e,t){const n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}isSelectedPiece(e){return this.chosenPiece.equalsValue(e)}calculateLeftX(){this.remainingPieceLeftX=[];for(let e=0;e<=1;e++){this.remainingPieceLeftX.push([]);const t=this.getRemainingPieces(e);for(let n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{const r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}getPieceLeftX(e,t){return this.remainingPieceLeftX[e][t]}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-encapsule"]],features:[Go],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",null,1),la(3,M2,2,5,"g",2),fa(),pa(4,"g",null,3),la(6,x2,2,1,"g",2),la(7,D2,2,4,"g",2),fa(),pa(8,"g",null,4),la(10,L2,2,5,"g",2),fa(),fa()),2&e&&(Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", 0)"),Ts(2),ha("ngForOf",t.getRemainingPieces(0)),Ts(1),ra("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCases()),Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),Ts(2),ha("ngForOf",t.getRemainingPieces(1)))},directives:[tp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class U2 extends DJ{constructor(e,t,n,r,i){if(super(e,t),this.movedPieces=n,this.stepSize=r,this.direction=i,this.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+this.coord.toString()+".");if(n<1)throw new Error("Must select minimum one piece (got "+n+").");if(r<1)throw new Error("Step size must be minimum one (got "+r+").");if(r>n)throw new Error("Cannot move a phalanx further than its size (got step size "+r+" for "+n+" pieces).")}toString(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}equals(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}U2.encoder=new class extends aK{maxValue(){return 122303}encodeNumber(e){const t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%8;e-=t;const n=(e/=8)%7;e-=n;const r=(e/=7)%13;e-=r;const i=(e/=13)%12;e-=i;const s=e/=12,o=fJ.factory.fromInt(t);return new U2(s,i,r+1,n+1,o.get())}};class B2 extends NJ{static getInitialState(){const e=uK.NONE,t=cK.ONE,n=cK.ZERO;return new B2([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[n,n,n,n,n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n,n,n,n,n]],0)}count(e,t){let n=0;for(let r=0;r<14;r++)this.board[t][r]===e&&n++;return n}doesOwnPiece(e){for(let t=0;t<12;t++)for(let n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}let V2=(()=>{class e{}return e.PHALANX_IS_LEAVING_BOARD=()=>$localize`The move distance of your phalanx puts it out of the board.`,e.SOMETHING_IN_PHALANX_WAY=()=>$localize`There is something in the way of your phalanx.`,e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=()=>$localize`Your phalanx must be bigger than the one you are capturing.`,e.CASE_NOT_ALIGNED_WITH_SELECTED=()=>$localize`This square is not aligned with the selected piece.`,e.SINGLE_PIECE_MUST_MOVE_BY_ONE=()=>$localize`A single piece can only move by one square.`,e.SINGLE_PIECE_CANNOT_CAPTURE=()=>$localize`A single piece cannot make a capture.`,e.CASE_NOT_ALIGNED_WITH_PHALANX=()=>$localize`This square is not aligned with the direction of the phalanx.`,e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=()=>$localize`A phalanx can't contain pieces outside of the board.`,e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=()=>$localize`A phalanx cannot contain an empty square.`,e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=()=>$localize`A phalanx cannot contain a piece of the opponent.`,e})();class $2 extends HJ{static isLegal(e,t){const n=this.getPhalanxValidity(t,e);if(n.isFailure())return ZG.failure(n.getReason());const r=this.getLandingStatus(t,e);if(r.isFailure())return r;const i=fK.copyBiArray(r.get()),s=t.getCurrentOpponent(),o=$2.getCaptureValidity(t,i,e,s);return o.isFailure()?o:ZG.success(o.get())}static getPhalanxValidity(e,t){let n=t.coord,r=0;const i=e.getCurrentOpponent();for(;r<t.movedPieces;){if(n.isNotInRange(14,12))return QG.failure(V2.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());const s=e.getPieceAt(n);if(s===uK.NONE)return QG.failure(V2.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(s===i)return QG.failure(V2.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());n=n.getNext(t.direction,1),r++}return QG.SUCCESS}static getLandingStatus(e,t){const n=e.getCopiedBoard(),r=e.getCurrentPlayer();let i=t.coord,s=t.coord.getNext(t.direction,t.movedPieces),o=0;for(;o+1<t.stepSize;){if(n[i.y][i.x]=uK.NONE,n[s.y][s.x]=r,s.isNotInRange(14,12))return ZG.failure(V2.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(s).isPlayer())return ZG.failure(V2.SOMETHING_IN_PHALANX_WAY());o++,s=s.getNext(t.direction,1),i=i.getNext(t.direction,1)}return s.isNotInRange(14,12)?ZG.failure(V2.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(s)===r?ZG.failure(OJ.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=uK.NONE,n[s.y][s.x]=r,ZG.success(n))}static getCaptureValidity(e,t,n,r){let i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1),s=0;for(;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(s>0&&(t[i.y][i.x]=uK.NONE),s++,s>=n.movedPieces)return ZG.failure(V2.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return ZG.success(t)}isLegal(e,t){return $2.isLegal(e,t)}applyLegalMove(e,t,n){return new B2(n,t.turn+1)}getGameStatus(e){const t=e.gameState,n=t.count(cK.ZERO,0),r=t.count(cK.ONE,11);if(t.turn%2==0){if(n>r)return zJ.ZERO_WON}else if(r>n)return zJ.ONE_WON;return!1===t.doesOwnPiece(cK.ZERO)?zJ.ONE_WON:!1===t.doesOwnPiece(cK.ONE)?zJ.ZERO_WON:zJ.ONGOING}}class z2 extends TJ{static getListMoves(e){const t=e.gameState.getCurrentPlayer(),n=e.gameState.getCurrentOpponent(),r=uK.NONE;let i=[];const s=e.gameState;let o;for(let a=0;a<12;a++)for(let e=0;e<14;e++){const l=new yJ(e,a);if(s.getPieceAt(l)===t)for(const c of fJ.DIRECTIONS){let u=1,h=l.getNext(c,1);for(;h.isInRange(14,12)&&s.getPieceAt(h)===t;)u+=1,h=h.getNext(c,1);let d=1;for(;h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===r;)o=new U2(e,a,u,d,c),i=this.addMove(i,o,s),d++,h=h.getNext(c,1);h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===n&&(o=new U2(e,a,u,d,c),i=this.addMove(i,o,s))}}return i}static addMove(e,t,n){return $2.isLegal(t,n).isSuccess()&&e.push(t),e}getListMoves(e){const t=z2.getListMoves(e);return fK.sortByDescending(t,e=>e.stepSize),t}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new IJ(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}getPieceCountPlusRowDomination(e){let t=0;for(let n=0;n<12;n++){let r=0;const i=[0,0];for(let s=0;s<14;s++){const o=new yJ(s,n),a=e.getPieceAt(o);if(a.isPlayer()){const n=a.getScoreModifier();t+=2002*n,i[a.value]=n,r+=n;for(const r of[fJ.UP_LEFT,fJ.UP,fJ.UP_RIGHT]){let i=o.getNext(r,1);for(;i.isInRange(14,12)&&e.getPieceAt(i)===a;)t+=1*n,i=i.getNext(r,1)}}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce((e,t)=>e+t)}return t}}class H2 extends TJ{getListMoves(e){const t=z2.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}orderMovesByPhalanxSizeAndFilter(e,t){return fK.sortByDescending(e,e=>e.movedPieces),e.length>40?e.filter(e=>!!this.moveIsCapture(e,t)||e.movedPieces*Math.random()>1):e}moveIsCapture(e,t){const n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new IJ(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}getPieceCountThenSupportThenAdvancement(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=new yJ(r,n),s=e.getPieceAt(i);if(s.isPlayer()){let r,o;s===cK.ZERO?(r=12-n,o=[fJ.UP_LEFT,fJ.UP,fJ.UP_RIGHT]):(r=n+1,o=[fJ.DOWN_LEFT,fJ.DOWN,fJ.DOWN_RIGHT]);const a=s.getScoreModifier();t+=r*a,t+=149629*a;for(const n of o){let r=i.getNext(n,1);for(;r.isInRange(14,12)&&e.getPieceAt(r)===s;)t+=337*a,r=r.getNext(n,1)}}}return t}}class G2 extends z2{constructor(){super(...arguments),this.DOMINANCE_FACTOR=20,this.DEFENSE_FACTOR=5,this.TERRITORY_FACTOR=2,this.OFFENSE_FACTOR=10,this.CENTER_FACTOR=5,this.MOBILITY_FACTOR=.12}getDominance(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new yJ(r,n));i.isPlayer()&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}getDefense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new yJ(n,11))===cK.ZERO&&(t+=cK.ZERO.getScoreModifier()),e.getPieceAt(new yJ(n,0))===cK.ONE&&(t+=cK.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}getTerritory(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new yJ(r,n));if(i.isPlayer()){for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const a=new yJ(r+s,n+o);if(a.isInRange(14,12)){const n=e.getPieceAt(a);(n===i||n===uK.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}getOffense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new yJ(n,0))===cK.ZERO&&(t+=cK.ZERO.getScoreModifier()),e.getPieceAt(new yJ(n,11))===cK.ONE&&(t+=cK.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}getCenter(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new yJ(r,n));i.isPlayer()&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}getMobility(e){let t=0,n=0,r=0;for(let i=0;i<12;i++)for(let s=0;s<14;s++){const o=new yJ(s,i),a=e.getPieceAt(o);if(a.isPlayer())for(const i of fJ.DIRECTIONS){let s=1,l=o.getNext(i,1);for(;l.isInRange(14,12)&&e.getPieceAt(l)===a;)s+=1,l=l.getNext(i,1);let c=1;for(;l.isInRange(14,12)&&c<=s&&e.getPieceAt(l)===uK.NONE;)c++,l=l.getNext(i,1);t+=c*c*a.getScoreModifier(),a===cK.ZERO?n=Math.max(n,c):a===cK.ONE&&(r=Math.max(r,c))}}return(t+n*cK.ZERO.getScoreModifier()+r*cK.ONE.getScoreModifier())*this.MOBILITY_FACTOR}getBoardValue(e){const t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new IJ(n.toBoardValue());const r=this.getDominance(t),i=this.getDefense(t),s=this.getTerritory(t),o=this.getCenter(t),a=this.getOffense(t),l=this.getMobility(t);return new IJ(r+i+s+o+a+l)}}const q2=uK.NONE,W2=cK.ZERO,j2=cK.ONE;class Z2{constructor(){this.tutorial=[jJ.informational($localize`Initial board`,$localize`This is the initial board of Epaminondas.
        The top line is the starting line of Light.
        The bottom line is the starting line of Dark.`,B2.getInitialState()),jJ.informational($localize`Goal of the game (1/2)`,$localize`After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line
        than the number of pieces the opponent has on the player's starting line, the player wins.
        Here, it's Dark's turn to play: Dark has therefore won.`,new B2([[q2,q2,q2,q2,q2,W2,q2,q2,j2,j2,j2,j2,j2,j2],[q2,q2,q2,q2,q2,W2,q2,q2,q2,q2,q2,q2,j2,j2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,j2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,W2,W2,W2,W2,q2,q2,q2]],0)),jJ.informational($localize`Goal of the game (2/2)`,$localize`Here, it is Light's turn.
        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line.`,new B2([[q2,q2,q2,q2,q2,W2,q2,q2,q2,q2,j2,j2,j2,j2],[q2,q2,q2,q2,q2,W2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,j2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,j2,j2,q2,q2,q2,W2,W2,q2,W2,W2,W2,W2]],1)),jJ.fromPredicate($localize`Moving a piece`,$localize`Here is the starting board. Dark plays first.
        Let's start with moving a single piece:
        <ol>
            <li>Click on a piece.</li>
            <li>Click on a empty neighboring square.</li>
        </ol>`,B2.getInitialState(),new U2(0,10,1,1,fJ.UP),(e,t)=>1===e.movedPieces?QG.SUCCESS:QG.failure($localize`Congratulations, you are in advance. But this is not the exercise here, try again.`),$localize`This is how you move a single piece.`),jJ.fromPredicate($localize`Moving a phalanx`,$localize`Let us now see how to move multiple pieces along a line, which is called a phalanx:
        <ol>
            <li>Click on the first piece of the phalanx.</li>
            <li>Click on the last piece of the phalanx.</li>
            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>
        </ol><br/>
        Move a phalanx!`,B2.getInitialState(),new U2(0,11,2,1,fJ.UP),(e,t)=>e.movedPieces>1?QG.SUCCESS:QG.failure($localize`Failed! You moved only one piece.`),$localize`Congratulations!
        The moved pieces can be horizontally, vertically, or diagonally aligned.
        The move should be made along this axis, forward or backwards.
        There can be no opponent nor holes in the phalanx.`),jJ.fromMove($localize`Capture`,$localize`In order to capture pieces of the opponent:
        <ol>
            <li>It must be aligned with the phalanx you are moving.</li>
            <li>It must be strictly shorter than your phalanx.</li>
            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>
        </ol><br/>
        Capture a phalanx.`,new B2([[q2,q2,q2,q2,q2,q2,q2,q2,j2,j2,j2,j2,j2,j2],[q2,q2,q2,q2,q2,q2,j2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,j2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,j2,q2,j2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,j2,j2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,j2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,W2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,W2,q2,q2,q2,q2,j2,q2,q2,q2,q2,q2,q2],[q2,q2,W2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,W2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2,q2],[q2,q2,q2,q2,q2,q2,q2,W2,W2,W2,W2,W2,W2,W2]],0),[new U2(2,10,4,2,fJ.UP)],$localize`Congratulations, you made it!
        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment.`,$localize`Failed, you have not captured the phalanx.`)]}}function Y2(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",4),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE*e+n.STROKE_WIDTH+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.STROKE_WIDTH+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function K2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,Y2,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e+r.STROKE_WIDTH)("y",r.SPACE_SIZE*n+r.STROKE_WIDTH)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.NONE)}}function Q2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,K2,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function J2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",5),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let X2=(()=>{class e extends IX{constructor(e){super(e),this.NONE=uK.NONE,this.firstPiece=Mw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=Mw.empty(),this.phalanxDirection=Mw.empty(),this.phalanxMiddles=[],this.moveds=[],this.captureds=[],this.rules=new $2(B2),this.availableMinimaxes=[new z2(this.rules,"Normal"),new H2(this.rules,"Positional"),new G2(this.rules,"Attack")],this.encoder=U2.encoder,this.tutorial=(new Z2).tutorial,this.updateBoard()}updateBoard(){this.firstPiece=Mw.empty(),this.lastPiece=Mw.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}showPreviousMove(){const e=this.rules.node.move.get();let t=e.coord;this.moveds=[t];for(let i=1;i<e.stepSize+e.movedPieces;i++)t=t.getNext(e.direction,1),this.moveds.push(t);const n=this.rules.node.mother.get(),r=n.gameState.getCurrentOpponent();for(;t.isInRange(14,12)&&n.gameState.getPieceAt(t)===r;)this.captureds.push(t),t=t.getNext(e.direction,1)}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t)})()}firstClick(e,t){var n=this;return Pw(function*(){const r=n.rules.node.gameState.getCurrentOpponent(),i=n.rules.node.gameState.getCurrentPlayer();switch(n.board[t][e]){case i:return n.firstPiece=Mw.of(new yJ(e,t)),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),QG.SUCCESS;case r:return n.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE());default:return Ow.expectToBe(n.board[t][e],uK.NONE),n.cancelMove(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())}})()}hidePreviousMove(){this.captureds=[],this.moveds=[]}getValidExtensions(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}getFirstPieceExtensions(e){const t=[];for(const n of fJ.DIRECTIONS){let r=this.firstPiece.get().getNext(n,1);for(;r.isInRange(14,12)&&this.board[r.y][r.x]===e;)t.push(r),r=r.getNext(n,1)}return t}getPhalanxValidExtensions(e){let t=fJ.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get();const n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();const i=this.firstPiece.get().getNext(t,1),s=this.getExtensionsToward(i,t,e);return r.concat(s)}getExtensionsToward(e,t,n){const r=[];for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}getPhalanxValidLandings(){if(this.lastPiece.isPresent()){const e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1;let s=fJ.factory.fromMove(e,t).get();const o=t.getNext(s,1),a=this.getLandingsToward(o,s,i);s=s.getOpposite();const l=e.getNext(s,1);return this.getLandingsToward(l,s,i).concat(a)}return this.getNeighbooringEmptyCases()}getNeighbooringEmptyCases(){const e=[];for(const t of fJ.DIRECTIONS){const n=this.firstPiece.get().getNext(t,1);n.isInRange(14,12)&&this.board[n.y][n.x]===uK.NONE&&e.push(n)}return e}getLandingsToward(e,t,n){const r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),s=[];for(;e.isInRange(14,12)&&s.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&s.push(e),s;s.push(e),e=e.getNext(t,1)}return s}getPhalanxLength(e,t,n){let r=0;for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}cancelMoveAttempt(){this.firstPiece=Mw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=Mw.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}secondClick(e,t){var n=this;return Pw(function*(){const r=new yJ(e,t),i=n.firstPiece.get();if(r.equals(i))return n.cancelMoveAttempt(),QG.SUCCESS;const s=n.rules.node.gameState.getCurrentOpponent(),o=n.rules.node.gameState.getCurrentPlayer();if(!r.isAlignedWith(i))return n.cancelMove(V2.CASE_NOT_ALIGNED_WITH_SELECTED());const a=r.getDistance(i),l=i.getDirectionToward(r).get();switch(n.board[t][e]){case uK.NONE:return 1===a?n.tryMove(new U2(i.x,i.y,1,1,l)):n.cancelMove(V2.SINGLE_PIECE_MUST_MOVE_BY_ONE());case s:return n.cancelMove(V2.SINGLE_PIECE_CANNOT_CAPTURE());default:Ow.expectToBe(n.board[t][e],o);const c=new U2(i.x,i.y,a,1,l),u=$2.getPhalanxValidity(n.rules.node.gameState,c);return u.isFailure()?n.cancelMove(u.getReason()):(n.lastPiece=Mw.of(r),n.validExtensions=n.getValidExtensions(o),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=i.getCoordsToward(r),n.phalanxDirection=Mw.of(l),QG.SUCCESS)}})()}thirdClick(e,t){var n=this;return Pw(function*(){const r=n.rules.node.gameState.getCurrentPlayer(),i=new yJ(e,t);if(n.firstPiece.equalsValue(i))return n.moveFirstPiece(r);if(n.lastPiece.equalsValue(i))return n.moveLastPiece(r);const s=n.firstPiece.get(),o=n.lastPiece.get();if(!i.isAlignedWith(s))return n.cancelMove(V2.CASE_NOT_ALIGNED_WITH_PHALANX());let a=fJ.factory.fromMove(s,o).get();const l=fJ.factory.fromMove(s,i).get();if(a===l.getOpposite()&&(n.firstPiece=Mw.of(o),n.lastPiece=Mw.of(s),a=l),a!==l)return n.cancelMove(V2.CASE_NOT_ALIGNED_WITH_PHALANX());if(n.board[t][e]===r){n.lastPiece=Mw.of(i);const e=n.firstPiece.get().getDistance(i)+1,t=new U2(n.firstPiece.get().x,n.firstPiece.get().y,e,1,a),s=$2.getPhalanxValidity(n.rules.node.gameState,t);return s.isFailure()?n.cancelMove(s.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(r),n.phalanxValidLandings=n.getPhalanxValidLandings(),QG.SUCCESS)}{const e=n.firstPiece.get().getDistance(n.lastPiece.get())+1,t=n.lastPiece.get().getDistance(i),r=new U2(n.firstPiece.get().x,n.firstPiece.get().y,e,t,a);return n.tryMove(r)}})()}moveFirstPiece(e){var t=this;return Pw(function*(){return t.firstPiece=Mw.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?yield t.moveOnlyPiece(e):(t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e)),t.phalanxValidLandings=t.getPhalanxValidLandings(),QG.SUCCESS})()}moveLastPiece(e){var t=this;return Pw(function*(){return t.lastPiece=Mw.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),QG.SUCCESS)})()}moveOnlyPiece(e){var t=this;return Pw(function*(){return t.lastPiece=Mw.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=Mw.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),QG.SUCCESS})()}tryMove(e){const t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}getPieceClasses(e,t){const n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}getPieceStrokeClasses(e,t){const n=new yJ(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(e=>e.equals(n))?["highlighted"]:[]}getRectClasses(e,t){const n=new yJ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:this.moveds.some(e=>e.equals(n))?["moved"]:[]}getHighlightedCoords(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}getCurrentPlayerPieces(){const e=[],t=this.rules.node.gameState.getCurrentPlayer();for(let n=0;n<this.board.length;n++)for(let r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new yJ(r,n));return e}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-epaminondas"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,Q2,2,1,"g",1),la(2,J2,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCoords()))},directives:[tp,Xd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();function e3(e){return new class extends sK{encode(t){return t.isPresent()?e.encode(t.get()):null}decode(t){return null===t?Mw.empty():Mw.of(e.decode(t))}}}class t3{constructor(e){if(e.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===U0.areOnSameLine(e))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=fK.copyImmutableArray(e).sort((e,t)=>{if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});let t=Mw.empty();for(const n of this.capturedSpaces){if(t.isPresent()&&1!==t.get().getDistance(n))throw new Error("Cannot create a GipfCapture with non-consecutive cases");t=Mw.of(n)}}toString(){let e="";for(const t of this.capturedSpaces)""!==e&&(e+=","),e+=t.toString();return e}size(){return this.capturedSpaces.length}forEach(e){this.capturedSpaces.forEach(e)}contains(e){for(let t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}intersectsWith(e){return this.capturedSpaces.some(t=>e.contains(t))}getLine(){return U0.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}equals(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(let t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}t3.encoder=new class extends sK{encode(e){return e.capturedSpaces.map(e=>yJ.encoder.encode(e))}decode(e){return new t3(e.map(e=>yJ.encoder.decode(e)))}};class n3{constructor(e,t){this.coord=e,this.direction=t}toString(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}equals(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}n3.encoder=new class extends sK{constructor(){super(...arguments),this.optionalDirectionEncoder=e3(EJ.encoder)}encode(e){return{coord:yJ.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}decode(e){const t=e;return nq(null!=t.coord,"Invalid encoded GipfPlacement"),new n3(yJ.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}};class r3 extends xJ{constructor(e,t,n){super(),this.placement=e,this.initialCaptures=t,this.finalCaptures=n}toString(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}equals(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===fK.compareArray(this.initialCaptures,e.initialCaptures)||!1===fK.compareArray(this.finalCaptures,e.finalCaptures))}encode(){return r3.encoder.encode(this)}decode(e){return r3.encoder.decode(e)}}r3.encoder=new class extends oK{encodeMove(e){const t={placement:n3.encoder.encode(e.placement)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=t3.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=t3.encoder.encode(e)}),t}decodeMove(e){const t=e;return nq(null!=t.placement,"Invalid encoded GipfMove"),new r3(n3.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",t3.encoder.decode),this.decodeArray(t,"finalCapture",t3.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class i3 extends B0{constructor(e,t,n,r){super(t,e,7,7,[3,2,1],CJ.EMPTY),this.sidePieces=n,this.capturedPieces=r}static getInitialState(){const e=CJ.EMPTY,t=CJ.UNREACHABLE,n=CJ.ZERO,r=CJ.ONE;return new i3([[t,t,t,r,e,e,n],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[n,e,e,e,e,e,r],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[r,e,e,n,t,t,t]],0,[12,12],[0,0])}equals(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&fK.compareTable(this.board,e.board)}getNumberOfPiecesToPlace(e){return this.sidePieces[e.value]}getNumberOfPiecesCaptured(e){return this.capturedPieces[e.value]}setAtUnsafe(e,t){const n=fK.copyBiArray(this.board);return n[e.y][e.x]=t,new i3(n,this.turn,this.sidePieces,this.capturedPieces)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==CJ.UNREACHABLE}}let s3=(()=>{class e{}return e.CAPTURE_MUST_BE_ALIGNED=()=>$localize`You can only capture when 4 or more of your pieces are aligned, and it is not the case.`,e.INVALID_CAPTURED_PIECES=()=>$localize`You must select a valid capture that contains 4 pieces or more.`,e.MISSING_CAPTURES=()=>$localize`There are still possible captures to be done.`,e.PLACEMENT_NOT_ON_BORDER=()=>$localize`Pieces must be inserted in spaces on the edge of the board.`,e.INVALID_PLACEMENT_DIRECTION=()=>$localize`You must select a valid placement direction.`,e.PLACEMENT_WITHOUT_DIRECTION=()=>$localize`You must select a placement with a direction alongside the insertion space.`,e.PLACEMENT_ON_COMPLETE_LINE=()=>$localize`You cannot place a piece on a complete line.`,e.AMBIGUOUS_CAPTURE_COORD=()=>$localize`This piece belongs to two captures. Please select another piece in the capture you'd like to make.`,e.CLICK_FURTHER_THAN_ONE_COORD=()=>$localize`You must click on an arrow to select your destination.`,e.NO_DIRECTIONS_AVAILABLE=()=>$localize`You cannot insert a piece here, as all lines are full. Select another space.`,e})();class o3 extends HJ{applyLegalMove(e,t,n){return new i3(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}static applyCaptures(e,t){let n=e;return t.forEach(e=>{n=o3.applyCapture(n,e)}),n}static applyCapture(e,t){const n=e.getCurrentPlayer();let r=e;const i=[e.sidePieces[0],e.sidePieces[1]],s=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(t=>{const o=e.getPieceAt(t);r=r.setAt(t,CJ.EMPTY),o.is(n)?i[n.value]+=1:s[n.value]+=1}),new i3(r.board,e.turn,i,s)}static getPlacements(e){const t=[];return PJ.INSTANCE.getAllBorders(e).forEach(n=>{e.getPieceAt(n)===CJ.EMPTY?t.push(new n3(n,Mw.empty())):o3.getAllDirectionsForEntrance(e,n).forEach(r=>{!1===o3.isLineComplete(e,n,r)&&t.push(new n3(n,Mw.of(r)))})}),t}static isLineComplete(e,t,n){return o3.nextGapInLine(e,t,n).isAbsent()}static nextGapInLine(e,t,n){for(let r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===CJ.EMPTY)return Mw.of(r);return Mw.empty()}static applyPlacement(e,t){const n=e.getCurrentPlayer();let r=e,i=CJ.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){const n=t.coord;if(e.getPieceAt(n)!==CJ.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(n,i)}else for(let o=t.coord;r.isOnBoard(o)&&i!==CJ.EMPTY;o=o.getNext(t.direction.get())){const t=e.getPieceAt(o);r=r.setAt(o,i),i=t}const s=[e.sidePieces[0],e.sidePieces[1]];return s[n.value]-=1,new i3(r.board,e.turn,s,e.capturedPieces)}getPiecesMoved(e,t,n){const r=o3.applyCaptures(e,t);if(n.direction.isAbsent())return[n.coord];{const e=n.direction.get(),t=[];t.push(n.coord);let i=n.coord.getNext(e);for(;r.isOnBoard(i)&&r.getPieceAt(i)!==CJ.EMPTY;)t.push(i),i=i.getNext(e);return nq(r.isOnBoard(i)&&r.getPieceAt(i)===CJ.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),t.push(i),t}}static getAllDirectionsForEntrance(e,t){if(PJ.INSTANCE.isTopLeftCorner(e,t))return[EJ.RIGHT,EJ.DOWN,EJ.UP_RIGHT];if(PJ.INSTANCE.isTopCorner(e,t))return[EJ.DOWN,EJ.DOWN_LEFT,EJ.RIGHT];if(PJ.INSTANCE.isTopRightCorner(e,t))return[EJ.DOWN_LEFT,EJ.DOWN,EJ.LEFT];if(PJ.INSTANCE.isBottomLeftCorner(e,t))return[EJ.UP_RIGHT,EJ.UP,EJ.RIGHT];if(PJ.INSTANCE.isBottomCorner(e,t))return[EJ.UP,EJ.LEFT,EJ.UP_RIGHT];if(PJ.INSTANCE.isBottomRightCorner(e,t))return[EJ.LEFT,EJ.UP,EJ.DOWN_LEFT];if(PJ.INSTANCE.isOnTopLeftBorder(e,t))return[EJ.RIGHT,EJ.DOWN];if(PJ.INSTANCE.isOnLeftBorder(e,t))return[EJ.UP_RIGHT,EJ.RIGHT];if(PJ.INSTANCE.isOnBottomLeftBorder(e,t))return[EJ.UP,EJ.UP_RIGHT];if(PJ.INSTANCE.isOnBottomRightBorder(e,t))return[EJ.LEFT,EJ.UP];if(PJ.INSTANCE.isOnRightBorder(e,t))return[EJ.LEFT,EJ.DOWN_LEFT];if(PJ.INSTANCE.isOnTopRightBorder(e,t))return[EJ.DOWN_LEFT,EJ.DOWN];throw new Error("not a border")}isLegal(e,t){const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=o3.applyCaptures(t,e.initialCaptures),i=this.noMoreCapturesValidity(r);if(i.isFailure())return i.toFailedFallible();const s=this.placementValidity(r,e.placement);if(s.isFailure())return s.toFailedFallible();const o=o3.applyPlacement(r,e.placement),a=this.capturesValidity(o,e.finalCaptures);if(a.isFailure())return a.toFailedFallible();const l=o3.applyCaptures(o,e.finalCaptures),c=this.noMoreCapturesValidity(l);return c.isFailure()?c.toFailedFallible():ZG.success(l)}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=o3.applyCapture(n,r)}return QG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer(),r=o3.getLinePortionWithFourPiecesOfPlayer(e,n,t.getLine());if(r.isAbsent())return QG.failure(s3.CAPTURE_MUST_BE_ALIGNED());const i=r.get();return o3.getCapturable(e,i).equals(t)?QG.SUCCESS:QG.failure(s3.INVALID_CAPTURED_PIECES())}static getLinePortionsWithFourPiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=o3.getLinePortionWithFourPiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}static getLinePortionWithFourPiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o=i;for(let a=i;e.isOnBoard(a);a=a.getNext(s))if(e.getPieceAt(a).is(t)?(0===r&&(o=a),r+=1):r=0,4===r)return Mw.of({0:o,1:a,2:s});return Mw.empty()}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===o3.getLinePortionsWithFourPiecesOfPlayer(e,t).length?QG.SUCCESS:QG.failure(s3.MISSING_CAPTURES())}placementValidity(e,t){const n=this.placementCoordValidity(e,t.coord);if(n.isFailure())return n;if(e.getPieceAt(t.coord)!==CJ.EMPTY){if(t.direction.isAbsent())return QG.failure(s3.PLACEMENT_WITHOUT_DIRECTION());if(o3.isLineComplete(e,t.coord,t.direction.get()))return QG.failure(s3.PLACEMENT_ON_COMPLETE_LINE());for(const n of o3.getAllDirectionsForEntrance(e,t.coord))if(n===t.direction.get())return QG.SUCCESS;return QG.failure(s3.INVALID_PLACEMENT_DIRECTION())}return QG.SUCCESS}placementCoordValidity(e,t){return PJ.INSTANCE.isOnBorder(e,t)?QG.SUCCESS:QG.failure(s3.PLACEMENT_NOT_ON_BORDER())}static getCapturable(e,t){const n=[],r=t[0],i=t[1],s=t[2],o=s.getOpposite();let a=r.getNext(o);for(;e.isOnBoard(a)&&e.getPieceAt(a)!==CJ.EMPTY;)n.push(a),a=a.getNext(o);for(let l=r;!l.equals(i);l=l.getNext(s))n.push(l);for(let l=i;e.isOnBoard(l)&&e.getPieceAt(l)!==CJ.EMPTY;l=l.getNext(s))n.push(l);return new t3(n)}static getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return o3.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(t=>{n.push(o3.getCapturable(e,t))}),n}static getPlayerScore(e,t){const n=e.getNumberOfPiecesToPlace(t);if(0===n&&0===o3.getPossibleCaptures(e).length)return Mw.empty();const r=e.getNumberOfPiecesCaptured(t);return Mw.of(n+3*r)}static isGameOver(e){const t=o3.getPlayerScore(e,cK.ZERO),n=o3.getPlayerScore(e,cK.ONE);return t.isAbsent()||n.isAbsent()}getGameStatus(e){const t=e.gameState,n=o3.getPlayerScore(t,cK.ZERO),r=o3.getPlayerScore(t,cK.ONE);return n.isAbsent()?zJ.ONE_WON:r.isAbsent()?zJ.ZERO_WON:zJ.ONGOING}}class a3 extends TJ{static getPossibleCaptureCombinationsFromPossibleCaptures(e){const t=a3.computeIntersections(e);let n=[[]];return e.forEach((e,r)=>{if(0===t[r].length)n.forEach(e=>{e.push(r)});else{const e=[],i=t[r].some(e=>e>r);for(const s of n)!0===s.some(e=>t[r].some(t=>e===t))?e.push(fK.copyImmutableArray(s)):i?(e.push(fK.copyImmutableArray(s)),s.push(r),e.push(fK.copyImmutableArray(s))):(s.push(r),e.push(fK.copyImmutableArray(s)));n=e}}),n.map(t=>t.map(t=>e[t]))}static computeIntersections(e){const t=[];return e.forEach((n,r)=>{t.push([]),e.forEach((e,i)=>{r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}getBoardValue(e){const t=e.gameState,n=o3.getPlayerScore(t,cK.ZERO),r=o3.getPlayerScore(t,cK.ONE);return n.isAbsent()?new IJ(cK.ONE.getVictoryValue()):r.isAbsent()?new IJ(cK.ZERO.getVictoryValue()):new IJ(n.get()-r.get())}getListMoves(e){return this.getListMoveFromState(e.gameState)}getListMoveFromState(e){const t=[];return o3.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(n=>{const r=o3.applyCaptures(e,n);o3.getPlacements(r).forEach(e=>{const i=o3.applyPlacement(r,e);this.getPossibleCaptureCombinations(i).forEach(r=>{const i=new r3(e,n,r);t.push(i)})})}),t}getPossibleCaptureCombinations(e){const t=o3.getPossibleCaptures(e);return a3.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}class l3{constructor(e,t,n,r,i,s){this.source=e,this.destination=t,this.x1=n,this.y1=r,this.x2=i,this.y2=s}}const c3=CJ.UNREACHABLE,u3=CJ.EMPTY,h3=CJ.ZERO,d3=CJ.ONE;class p3{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.
        This is the initial board.
        Each player has 12 pieces on the side and 3 pieces on the board.
        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.
        The first player plays with the dark pieces, the second player plays with the light pieces.`,i3.getInitialState()),jJ.anyMove($localize`Pushing`,$localize`Pieces can only enter the board through the edges. To insert a new piece:
        <ol>
            <li>Click on a space on the edge of the board.</li>
            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>
        </ol>
        You cannot push when a line is full.<br/><br/>
        You're playing Dark, insert a piece.`,i3.getInitialState(),new r3(new n3(new yJ(3,0),Mw.of(EJ.DOWN)),[],[]),$localize`Congratulations!`),jJ.fromMove($localize`Capture (1/3)`,$localize`To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.
        There are multiple important aspects of a capture:
        <ol>
            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>
            <li>As soon as there is an empty space on the line, the capture stops.</li>
            <li>Your own pieces that are captured go back to your stock.
                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>
            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.
                This means that a turn happens in three phases:
                <ol type="A">
                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>
                    <li>Make your insertion.</li>
                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>
                </ol>
            </li>
        </ol><br/>
        You're playing Dark, you can make a capture, do it.`,new i3([[c3,c3,c3,h3,d3,u3,u3],[c3,c3,u3,u3,u3,u3,u3],[c3,u3,u3,u3,u3,u3,u3],[h3,h3,h3,u3,u3,u3,u3],[d3,u3,u3,u3,u3,u3,c3],[u3,u3,u3,d3,u3,c3,c3],[u3,u3,u3,d3,c3,c3,c3]],42,[8,8],[0,0]),[new r3(new n3(new yJ(0,3),Mw.of(EJ.RIGHT)),[],[new t3([new yJ(0,3),new yJ(1,3),new yJ(2,3),new yJ(3,3)])])],$localize`Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.
        Let's now see how captures can really be useful.`,$localize`Failed!`),jJ.fromMove($localize`Capture (2/3)`,$localize`Here, there are three different ways of capturing.
        <ol>
          <li>One way does not capture any of your opponent's pieces.</li>
          <li>Another way captures one of your opponent's pieces.</li>
          <li>The last way captures two of your opponent's pieces.</li>
        </ol>
        <br/><br/>
        Pick the last one.`,new i3([[c3,c3,c3,u3,u3,u3,u3],[c3,c3,u3,d3,u3,u3,u3],[c3,u3,u3,h3,u3,u3,u3],[h3,h3,h3,d3,u3,u3,u3],[u3,u3,u3,h3,u3,u3,c3],[u3,u3,u3,h3,u3,c3,c3],[u3,u3,u3,d3,c3,c3,c3]],42,[8,4],[2,3]),[new r3(new n3(new yJ(0,3),Mw.of(EJ.RIGHT)),[],[new t3([new yJ(3,1),new yJ(3,2),new yJ(3,3),new yJ(3,4),new yJ(3,5),new yJ(3,6)])])],$localize`Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.
        The most you can get is 3 per capture.`,$localize`Failed, the best capture was taking 2 of your opponent's pieces`),jJ.fromMove($localize`Capture (3/3)`,$localize`Here, you must capture at the beginning of your turn.
        This is due to a move of your opponent at the previous turn
        (even though this is a fictitious board for pedagogical purpose).
        After your capture, by performing the right move you can even capture two more of your opponent's pieces!
        Keep it mind that the most useful in a capture is to take your opponent's pieces.`,new i3([[c3,c3,c3,h3,u3,u3,h3],[c3,c3,u3,h3,u3,u3,h3],[c3,h3,h3,u3,h3,d3,h3],[u3,u3,u3,h3,u3,u3,h3],[u3,u3,u3,h3,u3,u3,c3],[h3,h3,h3,d3,d3,c3,c3],[u3,u3,u3,h3,c3,c3,c3]],42,[8,4],[2,3]),[new r3(new n3(new yJ(3,6),Mw.of(EJ.UP)),[new t3([new yJ(6,0),new yJ(6,1),new yJ(6,2),new yJ(6,3)])],[new t3([new yJ(0,5),new yJ(1,5),new yJ(2,5),new yJ(3,5),new yJ(4,5)]),new t3([new yJ(1,2),new yJ(2,2),new yJ(3,2),new yJ(4,2),new yJ(5,2)])]),new r3(new n3(new yJ(4,6),Mw.of(EJ.UP)),[new t3([new yJ(6,0),new yJ(6,1),new yJ(6,2),new yJ(6,3)])],[new t3([new yJ(0,5),new yJ(1,5),new yJ(2,5),new yJ(3,5),new yJ(4,5)]),new t3([new yJ(3,0),new yJ(3,1),new yJ(3,2),new yJ(3,3),new yJ(3,4)])]),new r3(new n3(new yJ(3,6),Mw.of(EJ.UP)),[new t3([new yJ(6,0),new yJ(6,1),new yJ(6,2),new yJ(6,3)])],[new t3([new yJ(1,2),new yJ(2,2),new yJ(3,2),new yJ(4,2),new yJ(5,2)]),new t3([new yJ(0,5),new yJ(1,5),new yJ(2,5),new yJ(3,5),new yJ(4,5)])])],$localize`Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces.`,$localize`Failed, the best capture takes 2 of your opponent's pieces.`)]}}function f3(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba().$implicit,t=ba();ha("ngClass",t.getPieceClass(e)),ra("cx",t.getCenterAt(e).x)("cy",t.getCenterAt(e).y)("r",t.SPACE_SIZE)}}function g3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",8),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),ga(2,"polyline",9),la(3,f3,1,4,"circle",10),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),Ts(1),Ia("id","case_",e.x,"_",e.y,""),ha("ngClass",n.getSpaceClass(e)),ra("points",n.getHexaCoordsAt(e)),Ts(1),ha("ngIf",n.isPiece(e))}}function m3(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t)}),fa()}if(2&e){const e=t.$implicit;ra("points",ba(2).getHexaCoordsAt(e))}}function y3(e,t){if(1&e&&(Cn(),pa(0,"g",12),la(1,m3,1,1,"polyline",13),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e.capturedSpaces)}}function v3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"line",15),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.destination)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),ra("x1",e.x1)("y1",e.y1)("x2",e.x2)("y2",e.y2)}}function _3(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getSidePieceClass(n)),ra("cx",10+e*r.SPACE_SIZE*.5)("cy",10+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function C3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,_3,2,6,"g",5),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function E3(e,t){if(1&e&&(Cn(),ga(0,"line",17)),2&e){const e=ba();ra("x1",e.inserted.get().x1)("y1",e.inserted.get().y1)("x2",e.inserted.get().x2)("y2",e.inserted.get().y2)}}const w3=function(){return[0,1]};let S3=(()=>{class e extends _J{constructor(t){super(t),this.inserted=Mw.empty(),this.arrows=[],this.captured=[],this.moved=[],this.movePhase=e.PHASE_PLACEMENT_COORD,this.possibleCaptures=[],this.initialCaptures=[],this.placement=Mw.empty(),this.placementEntrance=Mw.empty(),this.finalCaptures=[],this.scores=Mw.of([0,0]),this.rules=new o3(i3),this.availableMinimaxes=[new a3(this.rules,"GipfMinimax")],this.encoder=r3.encoder,this.tutorial=(new p3).tutorial,this.SPACE_SIZE=40,this.constructedState=this.rules.node.gameState,this.hexaLayout=new wJ(1.5*this.SPACE_SIZE,new yJ(2*this.SPACE_SIZE,0),PJ.INSTANCE)}updateBoard(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}showLastMove(){this.inserted=Mw.empty();const e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){const t=e.get().placement;this.inserted=Mw.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}arrowTowards(e,t){const n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new l3(n,e,i.x,i.y,r.x,r.y)}markCapture(e){e.forEach(e=>{this.captured.push(e)})}getAllCoords(){return this.constructedState.allCoords()}getPlayerSidePieces(e){const t=this.constructedState.getNumberOfPiecesToPlace(cK.of(e)),n=[];for(let r=0;r<t;r+=1)n.push(r);return n}isPiece(e){return this.getPiece(e)!==CJ.EMPTY}getPiece(e){return this.constructedState.getPieceAt(e)}onClick(t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+t.x+"_"+t.y);if(r.isFailure())return n.cancelMove(r.getReason());switch(n.movePhase){case e.PHASE_INITIAL_CAPTURE:case e.PHASE_FINAL_CAPTURE:return n.selectCapture(t);case e.PHASE_PLACEMENT_COORD:return n.selectPlacementCoord(t);default:Ow.expectToBe(n.movePhase,e.PHASE_PLACEMENT_DIRECTION);const r=n.placementEntrance.get();if(!1===r.isAlignedWith(t))return n.cancelMove(s3.INVALID_PLACEMENT_DIRECTION());if(1!==r.getDistance(t))return n.cancelMove(s3.CLICK_FURTHER_THAN_ONE_COORD());const i=EJ.factory.fromMove(r,t);return n.selectPlacementDirection(i.toOptional())}})()}selectCapture(t){var n=this;return Pw(function*(){const r=[];if(n.possibleCaptures.forEach(e=>{e.contains(t)&&r.push(e)}),r.length>1)return n.cancelMove(s3.AMBIGUOUS_CAPTURE_COORD());if(0===r.length)return n.cancelMove(s3.MISSING_CAPTURES());const i=r[0];switch(n.constructedState=o3.applyCapture(n.constructedState,i),n.markCapture(i),n.possibleCaptures=o3.getPossibleCaptures(n.constructedState),n.movePhase){case e.PHASE_INITIAL_CAPTURE:return n.initialCaptures.push(i),0===n.possibleCaptures.length?n.moveToPlacementPhase():QG.SUCCESS;default:return Ow.expectToBe(n.movePhase,e.PHASE_FINAL_CAPTURE),n.finalCaptures.push(i),0===n.possibleCaptures.length?n.tryMove(n.initialCaptures,n.placement.get(),n.finalCaptures):QG.SUCCESS}})()}moveToPlacementPhase(){return this.movePhase=e.PHASE_PLACEMENT_COORD,QG.SUCCESS}moveToInitialCaptureOrPlacementPhase(){return this.possibleCaptures=o3.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?e.PHASE_PLACEMENT_COORD:e.PHASE_INITIAL_CAPTURE,QG.SUCCESS}moveToFinalCapturePhaseOrTryMove(){var t=this;return Pw(function*(){return t.possibleCaptures=o3.getPossibleCaptures(t.constructedState),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):(t.movePhase=e.PHASE_FINAL_CAPTURE,QG.SUCCESS)})()}computeArrows(e){this.arrows=[];for(const t of o3.getAllDirectionsForEntrance(this.constructedState,e))if(!1===o3.isLineComplete(this.constructedState,e,t)){const n=e.getNext(t),r=this.getCenterAt(e),i=this.getCenterAt(n);this.arrows.push(new l3(e,n,r.x,r.y,i.x,i.y))}}selectPlacementCoord(t){var n=this;return Pw(function*(){const r=n.rules.placementCoordValidity(n.constructedState,t);return r.isFailure()?n.cancelMove(r.getReason()):(n.placementEntrance=Mw.of(t),n.constructedState.getPieceAt(t)===CJ.EMPTY?n.selectPlacementDirection(Mw.empty()):(n.movePhase=e.PHASE_PLACEMENT_DIRECTION,n.computeArrows(t),0===n.arrows.length&&n.cancelMove(s3.NO_DIRECTIONS_AVAILABLE()),QG.SUCCESS))})()}selectPlacementDirection(e){var t=this;return Pw(function*(){t.placement=Mw.of(new n3(t.placementEntrance.get(),e));const n=t.rules.placementValidity(t.constructedState,t.placement.get());return n.isFailure()?t.cancelMove(n.getReason()):(t.arrows=[],t.constructedState=o3.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove())})()}tryMove(e,t,n){var r=this;return Pw(function*(){const i=new r3(t,e,n);return yield r.chooseMove(i,r.rules.node.gameState,r.scores.get())})()}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];const e=this.rules.node.move;if(e.isPresent()){const t=e.get(),n=this.rules.node.mother.get().gameState;t.initialCaptures.forEach(e=>this.markCapture(e)),t.finalCaptures.forEach(e=>this.markCapture(e)),this.moved=this.rules.getPiecesMoved(n,t.initialCaptures,t.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=Mw.empty(),this.placement=Mw.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}getSpaceClass(e){return this.captured.some(t=>t.equals(e))?"captured":this.moved.some(t=>t.equals(e))?"moved":""}getPieceClass(e){const t=this.getPiece(e);return this.getPlayerClass(cK.of(t.value))}getSidePieceClass(e){return this.getPlayerClass(cK.of(e))}}return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-gipf"]],features:[Go],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),pa(4,"marker",3),ga(5,"polygon",4),fa(),fa(),la(6,g3,4,7,"g",5),la(7,y3,2,1,"g",6),la(8,v3,2,4,"g",5),la(9,C3,2,1,"g",5),la(10,E3,1,4,"line",7),fa()),2&e&&(Ts(6),ha("ngForOf",t.getAllCoords()),Ts(1),ha("ngForOf",t.possibleCaptures),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",wu(5,w3)),Ts(1),ha("ngIf",t.inserted.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class b3 extends DJ{equals(e){return this===e||this.coord.equals(e.coord)}toString(){return this===b3.PASS?"GoMove.PASS":this===b3.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}b3.PASS=new b3(-1,0),b3.ACCEPT=new b3(-2,0),b3.PASS_NUMBER=-1,b3.ACCEPT_NUMBER=-2,b3.encoder=new class extends aK{maxValue(){return 360}encodeNumber(e){return 19*e.coord.y+e.coord.x}decodeNumber(e){if(e===b3.PASS_NUMBER)return b3.PASS;const t=e%19;return new b3(t,(e-t)/19)}};class P3{constructor(e,t){this.player=e,this.type=t}equals(e){return e===this}toString(){switch(this){case P3.BLACK:return"GoPiece.BLACK";case P3.WHITE:return"GoPiece.WHITE";case P3.EMPTY:return"GoPiece.EMPTY";case P3.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case P3.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case P3.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return nq(this===P3.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}static pieceBelongTo(e,t){return t===e.player&&"territory"!==e.type}static ofPlayer(e){return e===cK.ZERO?P3.BLACK:P3.WHITE}isOccupied(){return[P3.BLACK,P3.WHITE,P3.DEAD_BLACK,P3.DEAD_WHITE].includes(this)}isEmpty(){return[P3.BLACK_TERRITORY,P3.WHITE_TERRITORY,P3.EMPTY].includes(this)}isDead(){return[P3.DEAD_BLACK,P3.DEAD_WHITE].includes(this)}isTerritory(){return[P3.BLACK_TERRITORY,P3.WHITE_TERRITORY].includes(this)}getOwner(){return this.player}nonTerritory(){return nq(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),P3.EMPTY}}P3.BLACK=new P3(cK.ZERO,"alive"),P3.WHITE=new P3(cK.ONE,"alive"),P3.EMPTY=new P3(uK.NONE,"empty"),P3.DEAD_BLACK=new P3(cK.ZERO,"dead"),P3.DEAD_WHITE=new P3(cK.ONE,"dead"),P3.BLACK_TERRITORY=new P3(uK.NONE,"territory"),P3.WHITE_TERRITORY=new P3(uK.NONE,"territory");var O3=(()=>(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(O3||(O3={})),O3))();let T3=(()=>{class e extends NJ{constructor(e,t,n,r,i){super(e,n),this.captured=t,this.koCoord=r,this.phase=i}static getInitialState(){const t=e.getStartingBoard();return new e(t,[0,0],0,Mw.empty(),O3.PLAYING)}getCapturedCopy(){return[this.captured[0],this.captured[1]]}static getStartingBoard(){return fK.createTable(e.WIDTH,e.HEIGHT,P3.EMPTY)}copy(){return new e(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}isDead(e){return this.getPieceAt(e).isDead()}isTerritory(e){return this.getPieceAt(e).isTerritory()}}return e.WIDTH=13,e.HEIGHT=13,e})(),I3=(()=>{class e{constructor(e){this.color=e}selfContains(e){return this.getCoords().some(t=>t.equals(e))}static insertAsEntryPoint(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}return e.VERBOSE=!1,e})();class k3 extends I3{constructor(e,t,n,r,i,s){super(e),this.emptyCoords=t,this.blackCoords=n,this.whiteCoords=r,this.deadBlackCoords=i,this.deadWhiteCoords=s}getCoords(){return this.color===P3.BLACK?this.blackCoords:this.color===P3.WHITE?this.whiteCoords:this.color===P3.DEAD_BLACK?this.deadBlackCoords:this.color===P3.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}contains(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(t=>t.equals(e))}addPawn(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case P3.BLACK:this.blackCoords=I3.insertAsEntryPoint(this.blackCoords,e);break;case P3.WHITE:this.whiteCoords=I3.insertAsEntryPoint(this.whiteCoords,e);break;case P3.DEAD_BLACK:this.deadBlackCoords=I3.insertAsEntryPoint(this.deadBlackCoords,e);break;case P3.DEAD_WHITE:this.deadWhiteCoords=I3.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:Ow.expectToBeMultiple(t,[P3.EMPTY,P3.BLACK_TERRITORY,P3.WHITE_TERRITORY]),this.emptyCoords=I3.insertAsEntryPoint(this.emptyCoords,e)}}isMonoWrapped(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}getWrapper(){const e=new UJ([{key:P3.EMPTY,value:this.emptyCoords.length},{key:P3.BLACK,value:this.blackCoords.length+this.deadWhiteCoords.length},{key:P3.WHITE,value:this.whiteCoords.length+this.deadBlackCoords.length}]);e.put(this.color.nonTerritory(),0);const t=e.filter((e,t)=>t>0);if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}getNeighboorsEntryPoint(){const e=[];return this.color!==P3.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==P3.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==P3.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==P3.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==P3.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}class A3 extends class{getGroupDatas(e,t){Tw(I3.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");const n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}_getGroupDatas(e,t,n){Tw(I3.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});const r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color)for(const i of this.getDirections()){const r=e.getNext(i);r.isInRange(t[0].length,t.length)&&(n.contains(r)||(n=this._getGroupDatas(r,t,n)))}return n}}{getNewInstance(e){return new k3(e,[],[],[],[],[])}getDirections(){return gJ.ORTHOGONALS}}let M3=(()=>{class e{}return e.ILLEGAL_KO=()=>$localize`This move is a ko, you must play somewhere else before you can play in this intersection again.`,e.CANNOT_PASS_AFTER_PASSED_PHASE=()=>$localize`We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn.`,e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=()=>$localize`You cannot accept before the counting phase.`,e.OCCUPIED_INTERSECTION=()=>$localize`This intersection is already occupied.`,e.CANNOT_COMMIT_SUICIDE=()=>$localize`You cannot commit suicide.`,e})(),N3=(()=>{class e extends HJ{static isLegal(t,n){const r=!1;if(Tw(e.VERBOSE||r,{isLegal:{move:t,state:n}}),e.isPass(t)){const t=n.phase===O3.PLAYING,i=n.phase===O3.PASSED;return Tw(e.VERBOSE||r,"GoRules.isLegal at "+n.phase+(t||i?" forbid":" allowed")+" passing on "+n.getCopiedBoard()),t||i?ZG.success([]):ZG.failure(M3.CANNOT_PASS_AFTER_PASSED_PHASE())}if(e.isAccept(t)){const e=n.phase===O3.ACCEPT;return n.phase===O3.COUNTING||e?ZG.success([]):ZG.failure(M3.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return e.isOccupied(t.coord,n.getCopiedBoard())?(Tw(e.VERBOSE||r,"GoRules.isLegal: move is marking"),e.isLegalDeadMarking(t,n)?ZG.success([]):ZG.failure(M3.OCCUPIED_INTERSECTION())):(Tw(e.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+t.toString()),e.isLegalNormalMove(t,n))}static getNewKo(e,t,n){if(1===n.length){const r=n[0],i=e.coord,s=t[i.y][i.x],o=(new A3).getGroupDatas(i,t),a=o.emptyCoords,l=P3.pieceBelongTo(s,cK.ZERO)?o.blackCoords:o.whiteCoords;if(1===a.length&&a[0].equals(r)&&1===l.length)return Mw.of(r)}return Mw.empty()}static markTerritoryAndCount(t){Tw(e.VERBOSE,{markTerritoryAndCount:{state:t}});const n=t.getCopiedBoard(),r=e.getTerritoryLikeGroup(t),i=t.getCapturedCopy();for(const e of r){const t=e.getWrapper();if(t===P3.WHITE){i[1]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=P3.WHITE_TERRITORY}else{nq(t===P3.BLACK,"territory should be wrapped by black or white, not by "+t.toString()),i[0]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=P3.BLACK_TERRITORY}}return new T3(n,i,t.turn,t.koCoord,t.phase)}static removeAndSubstractTerritory(e){const t=e.getCopiedBoard(),n=e.getCapturedCopy();let r;for(let i=0;i<e.board.length;i++)for(let s=0;s<e.board[0].length;s++)r=t[i][s],r===P3.BLACK_TERRITORY?(t[i][s]=P3.EMPTY,n[0]=n[0]-1):r===P3.WHITE_TERRITORY&&(t[i][s]=P3.EMPTY,n[1]=n[1]-1);return new T3(t,n,e.turn,e.koCoord,e.phase)}static getEmptyZones(t){return e.getGroupsDatasWhere(t.getCopiedBoard(),e=>e.isEmpty())}static getGroupsDatasWhere(e,t){const n=[];let r,i,s;const o=new A3;for(let a=0;a<e.length;a++)for(let l=0;l<e[0].length;l++)r=new yJ(l,a),s=e[a][l],t(s)&&(n.some(e=>e.selfContains(r))||(i=o.getGroupDatas(r,e),n.push(i)));return n}static addDeadToScore(e){const t=e.getCapturedCopy();let n,r=t[1],i=t[0];for(let s=0;s<e.board.length;s++)for(let t=0;t<e.board[0].length;t++)n=e.getPieceAtXY(t,s),n===P3.DEAD_BLACK?r++:n===P3.DEAD_WHITE&&i++;return[i,r]}static switchAliveness(e,t){const n=t.getCopiedBoard();nq(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");const r=(new A3).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case P3.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;for(const e of r.deadBlackCoords)n[e.y][e.x]=P3.BLACK;break;case P3.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;for(const e of r.deadWhiteCoords)n[e.y][e.x]=P3.WHITE;break;case P3.WHITE:i[0]+=2*r.whiteCoords.length;for(const e of r.whiteCoords)n[e.y][e.x]=P3.DEAD_WHITE;break;default:Ow.expectToBe(r.color,P3.BLACK),i[1]+=2*r.blackCoords.length;for(const e of r.blackCoords)n[e.y][e.x]=P3.DEAD_BLACK}return new T3(n,i,t.turn,t.koCoord,t.phase)}static getGameStatus(e){const t=e.gameState;return t.phase===O3.FINISHED?t.captured[0]>t.captured[1]?zJ.ZERO_WON:t.captured[1]>t.captured[0]?zJ.ONE_WON:zJ.DRAW:zJ.ONGOING}static isPass(e){return e.equals(b3.PASS)}static isAccept(e){return e.equals(b3.ACCEPT)}static isLegalDeadMarking(t,n){return e.isOccupied(t.coord,n.getCopiedBoard())&&(n.phase===O3.COUNTING||n.phase===O3.ACCEPT)}static isLegalNormalMove(t,n){const r=n.getCopiedBoard();if(e.isKo(t,n))return ZG.failure(M3.ILLEGAL_KO());[O3.COUNTING,O3.ACCEPT].includes(n.phase)&&(n=e.resurrectStones(n));const i=e.getCaptureState(t,n);if(R3.isCapturing(i))return ZG.success(i.capturedCoords);{r[t.coord.y][t.coord.x]=n.turn%2==0?P3.BLACK:P3.WHITE;const e=0===(new A3).getGroupDatas(t.coord,r).emptyCoords.length;return r[t.coord.y][t.coord.x]=P3.EMPTY,e?ZG.failure(M3.CANNOT_COMMIT_SUICIDE()):ZG.success([])}}static isOccupied(e,t){return t[e.y][e.x].isOccupied()}static isKo(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}static getCaptureState(t,n){Tw(e.VERBOSE||!1,{getCaptureState:{move:t,state:n}});const r=new R3;let i;for(const s of gJ.ORTHOGONALS)i=e.getCapturedInDirection(t.coord,s,n),i.length>0&&r.capturedCoords.every(e=>!i[0].equals(e))&&(r.capturedCoords=r.capturedCoords.concat(i));return r}static getCapturedInDirection(t,n,r){const i=r.getCopiedBoard(),s=t.getNext(n);if(s.isInRange(r.board[0].length,r.board.length)&&i[s.y][s.x]===(r.turn%2==0?P3.WHITE:P3.BLACK)){Tw(e.VERBOSE||!1,"a group could be captured");const t=(new A3).getGroupDatas(s,i);if(e.isCapturableGroup(t,r.koCoord))return Tw(e.VERBOSE||!1,{neightbooringGroupCoord:t.getCoords(),message:"is capturable"}),t.getCoords()}return[]}static isCapturableGroup(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}static getTerritoryLikeGroup(t){return e.getEmptyZones(t).filter(e=>e.isMonoWrapped())}static applyPass(t){const n=t.getCopiedBoard(),r=t.getCapturedCopy(),i=t.turn;let s,o;return t.phase===O3.PASSED?(s=O3.COUNTING,o=new T3(n,r,i+1,Mw.empty(),s),o=e.markTerritoryAndCount(o)):(nq(t.phase===O3.PLAYING,"Cannot pass in counting phase!"),s=O3.PASSED,o=new T3(n,r,i+1,Mw.empty(),s)),o}static applyLegalAccept(e){const t=e.getCopiedBoard();let n;return n=e.phase===O3.COUNTING?O3.ACCEPT:O3.FINISHED,new T3(t,e.getCapturedCopy(),e.turn+1,Mw.empty(),n)}static applyNormalLegalMove(t,n,r){let i;Tw(e.VERBOSE,{applyNormalLegal:{currentState:t,legalMove:n,status}}),i=[O3.COUNTING,O3.ACCEPT].includes(t.phase)?e.resurrectStones(t):t.copy();const s=n.coord.x,o=n.coord.y,a=i.getCopiedBoard(),l=i.turn,c=P3.ofPlayer(i.getCurrentPlayer()),u=l+1;a[o][s]=c;for(const e of r)a[e.y][e.x]=P3.EMPTY;const h=e.getNewKo(n,a,r),d=i.getCapturedCopy();return d[c.player.value]+=r.length,new T3(a,d,u,h,O3.PLAYING)}static resurrectStones(t){for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[0].length;r++)t.getPieceAtXY(r,n).isDead()&&(t=e.switchAliveness(new yJ(r,n),t));return e.removeAndSubstractTerritory(t)}static applyDeadMarkingMove(t,n){Tw(e.VERBOSE,{applyDeadMarkingMove:{legalMove:t,state:n}});const r=e.removeAndSubstractTerritory(n),i=e.switchAliveness(t.coord,r),s=new T3(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,Mw.empty(),O3.COUNTING);return e.markTerritoryAndCount(s)}isLegal(t,n){return e.isLegal(t,n)}applyLegalMove(t,n,r){return Tw(e.VERBOSE,{applyLegalMove:{legalMove:t,state:n,status:r}}),e.isPass(t)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isPass"),e.applyPass(n)):e.isAccept(t)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isAccept"),e.applyLegalAccept(n)):e.isLegalDeadMarking(t,n)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),e.applyDeadMarkingMove(t,n)):(Tw(e.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),e.applyNormalLegalMove(n,t,r))}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class R3{constructor(){this.capturedCoords=[]}static isCapturing(e){return e.capturedCoords.length>0}}class x3 extends TJ{getListMoves(e){Tw(N3.VERBOSE||!1,"GoRules.getListMoves");const t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===O3.PLAYING||t.phase===O3.PASSED)return n.push(b3.PASS),n;{Tw(N3.VERBOSE||!1,"GoRules.getListMoves in counting phase");const e=this.getCountingMovesList(t);return 0===e.length?[b3.ACCEPT]:e}}getPlayingMovesList(e){const t=[];let n;for(let r=0;r<e.board.length;r++)for(let i=0;i<e.board[0].length;i++)n=new b3(i,r),e.getPieceAt(n.coord)===P3.EMPTY&&N3.isLegal(n,e).isSuccess()&&t.push(n);return t}getCountingMovesList(e){const t=[],n=this.getCorrectBoard(e).getCopiedBoard(),r=N3.getGroupsDatasWhere(n,e=>e!==P3.EMPTY);for(const i of r){const r=i.getCoords()[0],s=n[r.y][r.x];if(e.getPieceAt(r)!==s){const e=new b3(r.x,r.y);return t.push(e),t}}return t}getCorrectBoard(e){const t=this.mapBoard(e.getCopiedBoard(),e=>e===P3.BLACK?P3.DEAD_BLACK:e===P3.WHITE?P3.DEAD_WHITE:e.isTerritory()?P3.EMPTY:e),n=new T3(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=N3.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}mapBoard(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}setAliveUniqueWrapper(e,t){let n,r=e.copy();for(const i of t){n=i.deadBlackCoords.concat(i.deadWhiteCoords);for(const e of n)r.isDead(e)&&(r=N3.switchAliveness(e,r))}return r}getBoardValue(e){const t=e.gameState,n=N3.getGameStatus(e);if(n.isEndGame)return new IJ(n.toBoardValue());Tw(N3.VERBOSE||!1,"GoRules.getBoardValue");const r=N3.markTerritoryAndCount(t),i=r.getCapturedCopy(),s=this.getDeadStones(r);return new IJ(i[1]+2*s[0]-(i[0]+2*s[1]))}getDeadStones(e){const t=[0,0];for(let n=0;n<e.board.length;n++)for(let r=0;r<e.board[0].length;r++){const i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}const D3=P3.WHITE,L3=P3.BLACK,F3=P3.DEAD_WHITE,U3=P3.WHITE_TERRITORY,B3=P3.BLACK_TERRITORY,V3=P3.EMPTY;class $3{constructor(){this.tutorial=[jJ.informational($localize`Preliminary information`,$localize`The game of Go is played on a board called a Goban, and the stones are placed on the intersections.
        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.
        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).
        For this tutorial, we will use a smaller board for pedagogical purposes.`,T3.getInitialState()),jJ.informational($localize`Goal of the game`,$localize`The goal of the game is to have the most points at the end of the game.
        We call "territories" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.
        Here, Dark has 9 territories on the left, and Light has 8 on the right.
        The top part belongs to no one.
        Each player's score at the end of the game is the sum of that player's territories and captures.`,new T3([[V3,L3,V3,V3,D3,D3],[V3,L3,V3,V3,D3,V3],[V3,L3,L3,D3,D3,V3],[V3,V3,L3,D3,V3,V3],[V3,V3,L3,D3,V3,V3],[V3,V3,L3,D3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING)),jJ.fromMove($localize`Simple capture`,$localize`An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).
        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.
        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>
        The light piece only has one liberty left, play there.`,new T3([[V3,V3,V3,V3,V3],[V3,V3,L3,V3,V3],[V3,L3,D3,V3,V3],[V3,V3,L3,V3,V3],[V3,V3,V3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING),[new b3(3,2)],$localize`Congratulations, you have earned one point.`,$localize`Failed, try again by playing on one of the intersections directly next to the light stone.`),jJ.fromMove($localize`Capturing multiple stones`,$localize`Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>
        The light group here only has one liberty left, capture it.`,new T3([[V3,L3,V3,V3,V3],[L3,D3,V3,V3,V3],[L3,D3,D3,L3,V3],[V3,L3,L3,V3,V3],[V3,V3,V3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING),[new b3(2,1)],$localize`Congratulations, you have earned three points and formed a territory.`,$localize`Failed, you have not captured the group. Play on the last liberty of that group.`),jJ.informational($localize`Suicide`,$localize`In Go, suicide is forbidden.
        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.
        Here, the top left intersection is a suicide for Light.
        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player.`,new T3([[V3,L3,V3,V3,V3],[L3,V3,V3,V3,V3],[L3,V3,V3,V3,D3],[D3,L3,V3,D3,V3],[V3,D3,V3,D3,L3]],[0,0],0,Mw.empty(),O3.PLAYING)),jJ.informational($localize`Life and death (death)`,$localize`From the capture rule follows the life and death notion:
        dead stones are stones that are definitely capturable (without losing anything else).
        Alive stones are stones that can never be captured.
        From the capture rule, Dark can play inside Light's territory and make a capture.
        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).
        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories.`,new T3([[V3,V3,V3,V3,V3],[L3,L3,L3,V3,V3],[D3,D3,L3,V3,V3],[V3,D3,L3,V3,V3],[D3,D3,L3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING)),jJ.informational($localize`Life and death (eyes)`,$localize`Here, Light cannot play on the top left, nor on the bottom left.
        Light will never be able to capture Dark.
        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive.`,new T3([[V3,L3,D3,V3,V3],[D3,L3,D3,V3,V3],[L3,L3,D3,V3,V3],[D3,L3,D3,V3,V3],[V3,L3,D3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING)),jJ.informational($localize`Seki`,$localize`If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.
        Similarly, if Light plays on the middle line, Dark will capture Light.
        In other words, there is no point in playing on the middle line.
        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral.`,new T3([[V3,D3,L3,V3,D3,L3,V3],[V3,D3,L3,L3,D3,L3,V3],[V3,D3,L3,L3,D3,L3,V3],[V3,D3,L3,L3,D3,L3,V3],[V3,D3,L3,D3,D3,L3,V3],[V3,D3,L3,D3,D3,L3,V3],[V3,D3,L3,V3,D3,L3,V3]],[0,0],0,Mw.empty(),O3.PLAYING)),jJ.fromMove($localize`Ko`,$localize`A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>
        Capture the light stone.`,new T3([[V3,V3,V3,V3,V3,V3,V3],[V3,V3,V3,V3,V3,V3,V3],[V3,V3,V3,L3,D3,V3,V3],[V3,V3,L3,D3,V3,D3,V3],[V3,V3,V3,L3,D3,V3,V3],[V3,V3,V3,V3,V3,V3,V3],[V3,V3,V3,V3,V3,V3,V3]],[0,0],0,Mw.empty(),O3.PLAYING),[new b3(4,3)],$localize`Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.
        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.
        This rule is called the Ko.
        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after.`,$localize`Failed!`),jJ.fromMove($localize`End of the game`,$localize`When a player feels that there is no advantage to putting a new stone, that player can pass a turn.
        The game phase stops when both players pass consecutively, and we move on to the counting phase.
        The dead groups are then marked by clicking on them.
        Every intersection in a player's territory earns that player a point.
        The winner is the one with most points.<br/><br/>
        A last stone is dead, mark it.`,new T3([[D3,L3,L3,L3,L3,L3,B3,B3,B3],[D3,D3,D3,D3,L3,L3,L3,B3,B3],[D3,U3,D3,D3,L3,F3,F3,L3,B3],[L3,D3,D3,D3,D3,L3,B3,B3,B3],[V3,D3,U3,D3,L3,L3,F3,L3,B3],[D3,U3,D3,D3,L3,L3,L3,L3,L3],[D3,D3,L3,L3,L3,D3,D3,L3,D3],[L3,L3,L3,D3,D3,D3,U3,D3,D3],[B3,B3,L3,L3,L3,D3,D3,U3,U3]],[0,0],0,Mw.empty(),O3.COUNTING),[new b3(0,3)],$localize`Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.
        The intersections where the prisoners are count as Dark's territory
        Light has 8 territories and 1 prisoner.
        The end result is therefore 18 - 9 for Dark.`,$localize`Failed, try again.`)]}}function z3(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2).index,t=ba().index;ra("cx",25+50*e)("cy",25+50*t)("r",22)}}function H3(e,t){if(1&e){const e=va();Cn(),pa(0,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index;ra("x1",50*e)("y1",50*t)("x2",50+50*e)("y2",50+50*t)}}function G3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,z3,1,3,"circle",8),la(3,H3,1,4,"line",9),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.getSpaceClass(e,t)),ra("cx",25+50*e)("cy",25+50*t)("r",22),Ts(1),ha("ngIf",n.isLastCase(e,t)),Ts(1),ha("ngIf",n.isDead(e,t))}}function q3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",15),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",25+50*t)("cy",25+50*r)("r",10)("class",n===i.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function W3(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",12),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(1,"line",13),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",13),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(3,q3,1,4,"circle",14)}if(2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","click_",e,"_",t,""),ra("x",50*e)("y",50*t),Ts(1),ra("x1",50*e)("y1",25+50*t)("x2",50+50*e)("y2",25+50*t),Ts(1),ra("x1",25+50*e)("y1",50*t)("x2",25+50*e)("y2",50+50*t),Ts(1),ha("ngIf",n.isTerritory(e,t))}}function j3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,G3,4,6,"g",5),la(2,W3,4,13,"ng-template",null,6,Ku),fa()),2&e){const e=t.index,n=ca(3),r=ba().index,i=ba();Ts(1),ha("ngIf",i.caseIsFull(e,r))("ngIfElse",n)}}function Z3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,j3,4,2,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function Y3(e,t){if(1&e&&(Cn(),ga(0,"rect",16)),2&e){const e=ba();ra("x",12.5+50*e.ko.get().x)("y",12.5+50*e.ko.get().y)}}function K3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",17),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit;ra("cx",25+50*e.x)("cy",25+50*e.y)("r",7)}}let Q3=(()=>{class e extends IX{constructor(e){super(e),this.ko=Mw.empty(),this.last=Mw.empty(),this.captures=[],this.GoPiece=P3,this.scores=Mw.of([0,0]),this.rules=new N3(T3),this.availableMinimaxes=[new x3(this.rules,"GoMinimax")],this.encoder=b3.encoder,this.tutorial=(new $3).tutorial,this.canPass=!0,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.last=Mw.empty();const i=new b3(e,t);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){Tw(e.VERBOSE,"updateBoard");const t=this.rules.node.gameState,n=this.rules.node.move,r=t.phase;this.board=t.getCopiedBoard(),this.scores=Mw.of(t.getCapturedCopy()),this.ko=t.koCoord,n.isPresent()?this.showCaptures():this.captures=[],this.last=n.map(e=>e.coord),this.canPass=r!==O3.FINISHED}showCaptures(){const e=this.rules.node.mother.get().gameState;this.captures=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[0].length;n++){const r=new yJ(n,t),i=!1===e.getPieceAt(r).isEmpty(),s=this.board[t][n]===P3.EMPTY,o=!1===this.ko.equalsValue(r);i&&s&&o&&this.captures.push(r)}}pass(){var e=this;return Pw(function*(){const t=e.rules.node.gameState.phase;return t===O3.PLAYING||t===O3.PASSED?e.onClick(b3.PASS.coord.x,b3.PASS.coord.y):(nq(t===O3.COUNTING||t===O3.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(b3.ACCEPT.coord.x,b3.ACCEPT.coord.y))})()}getSpaceClass(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}caseIsFull(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==P3.EMPTY&&!this.isTerritory(e,t)}isLastCase(e,t){if(this.last.isPresent()){const n=this.last.get();return e===n.x&&t===n.y}return!1}isDead(e,t){return this.rules.node.gameState.isDead(new yJ(e,t))}isTerritory(e,t){return this.rules.node.gameState.isTerritory(new yJ(e,t))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-go"]],features:[Go],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,Z3,2,1,"g",2),la(3,Y3,1,2,"rect",3),la(4,K3,1,3,"circle",4),fa()),2&e&&(ra("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),Ts(1),ra("width",50*t.board.length)("height",50*t.board.length),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.ko.isPresent()),Ts(1),ha("ngForOf",t.captures))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class J3{constructor(e,t,n){this.value=e,this.name=t,this.rgb=n}static of(e){switch(e){case 0:return J3.ANY;case 1:return J3.ORANGE;case 2:return J3.BLUE;case 3:return J3.PURPLE;case 4:return J3.PINK;case 5:return J3.YELLOW;case 6:return J3.RED;case 7:return J3.GREEN;default:return Ow.expectToBe(e,8,"Invalid value "+e+" for KamisadoColor"),J3.BROWN}}}J3.ANY=new J3(0,"any","#000"),J3.ORANGE=new J3(1,"orange","#d67421"),J3.BLUE=new J3(2,"blue","#006bac"),J3.PURPLE=new J3(3,"purple","#6f3787"),J3.PINK=new J3(4,"pink","#d2719e"),J3.YELLOW=new J3(5,"yellow","#e2c200"),J3.RED=new J3(6,"red","#d23339"),J3.GREEN=new J3(7,"green","#009157"),J3.BROWN=new J3(8,"brown","#562500");class X3{constructor(e,t){this.player=e,this.color=t}static of(e,t){return new X3(e,J3.of(t))}static createPlayerColors(e){return{ORANGE:new X3(e,J3.ORANGE),BLUE:new X3(e,J3.BLUE),PURPLE:new X3(e,J3.PURPLE),PINK:new X3(e,J3.PINK),YELLOW:new X3(e,J3.YELLOW),RED:new X3(e,J3.RED),GREEN:new X3(e,J3.GREEN),BROWN:new X3(e,J3.BROWN)}}equals(e){return e.player===this.player&&e.color===this.color}isEmpty(){return this.player.equals(uK.NONE)}belongsTo(e){return this.player===e}}X3.EMPTY=new X3(uK.NONE,J3.ANY),X3.ZERO=X3.createPlayerColors(cK.ZERO),X3.ONE=X3.createPlayerColors(cK.ONE);class e4{static getColorAt(e,t){return e4.COLORS[t][e]}static getInitialBoard(){const e=X3.EMPTY;return[[1,2,3,4,5,6,7,8].map(e=>X3.of(cK.ONE,e)),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(e=>X3.of(cK.ZERO,e))]}static isEmptyAt(e,t){return e[t.y][t.x].equals(X3.EMPTY)}static allPieceCoords(e){const t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++){const i=new yJ(r,n);e4.isEmptyAt(e,i)||t.push(i)}return t}}e4.INITIAL=e4.getInitialBoard(),e4.SIZE=8,e4.COLORS=fK.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],J3.of);class t4 extends UX{constructor(e,t){super(e,t)}static of(e,t){if(e.isNotInRange(e4.SIZE,e4.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(e4.SIZE,e4.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new t4(e,t)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return this===t4.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}t4.PASS=new t4(new yJ(-2,-2),new yJ(-3,-3)),t4.encoder=new class extends aK{maxValue(){return 34952}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return t4.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new t4(new yJ((e=e/16|0)%16,r),new yJ(n,t))}};class n4 extends NJ{constructor(e,t,n,r,i){super(fK.copyBiArray(i),e),this.colorToPlay=t,this.coordToPlay=n,this.alreadyPassed=r}static getInitialState(){return new n4(0,J3.ANY,Mw.empty(),!1,e4.INITIAL)}}let r4=(()=>{class e{}return e.NOT_RIGHT_COLOR=()=>$localize`This piece is not of the color you have to play.`,e.DIRECTION_NOT_ALLOWED=()=>$localize`You can only move forward, orthogonally or diagonally.`,e.MOVE_BLOCKED=()=>$localize`This move is blocked by another piece.`,e.PLAY_WITH_SELECTED_PIECE=()=>$localize`You must play with the selected piece.`,e})();class i4 extends HJ{static getColorMatchingPiece(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new yJ(0,7),new yJ(1,7),new yJ(2,7),new yJ(3,7),new yJ(4,7),new yJ(5,7),new yJ(6,7),new yJ(7,7)]}static getMovablePieces(e){return i4.getColorMatchingPiece(e).filter(t=>{for(const n of this.playerDirections(e.getCurrentPlayer())){const r=t.getNext(n);if(e.isOnBoard(r)&&e4.isEmptyAt(e.board,r))return!0}return!1})}static playerDirections(e){return e===cK.ONE?[fJ.DOWN,fJ.DOWN_LEFT,fJ.DOWN_RIGHT]:[fJ.UP,fJ.UP_LEFT,fJ.UP_RIGHT]}static directionAllowedForPlayer(e,t){return t===cK.ZERO?e.y<0:e.y>0}static getListMovesFromState(e){const t=i4.getMovablePieces(e);return 0===t.length?(nq(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[t4.PASS]):i4.getListMovesFromNonBlockedState(e,t)}static getListMovesFromNonBlockedState(e,t){const n=[],r=e.getCurrentPlayer();for(const i of t)for(const t of i4.playerDirections(r))for(let r=1;r<e4.SIZE;r++){const s=i.getNext(t,r);if(!e.isOnBoard(s)||!e4.isEmptyAt(e.board,s))break;{const e=t4.of(i,s);n.push(e)}}return n}static mustPass(e){return 0===this.getMovablePieces(e).length}static getFurthestPiecePositions(e){let t=7,n=0;return e4.allPieceCoords(e.board).forEach(r=>{const i=e.getPieceAt(r);nq(i!==X3.EMPTY,"allPieceCoords failed to filter KamisadoPiece.EMPTY"),i.player===cK.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}static isLegal(e,t){const n=e.coord,r=e.end,i=t.colorToPlay;if(e===t4.PASS)return this.isLegalPass(t);if(i4.isVictory(t))return ZG.failure("You should never see this message");const s=t.getPieceAt(n);if(!s.belongsTo(t.getCurrentPlayer()))return ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE());if(i!==J3.ANY&&s.color!==i)return ZG.failure(r4.NOT_RIGHT_COLOR());if(!t.getPieceAt(r).isEmpty())return ZG.failure(OJ.MUST_CLICK_ON_EMPTY_SPACE());const o=fJ.factory.fromMove(n,r);if(o.isFailure())return ZG.failure(r4.DIRECTION_NOT_ALLOWED());const a=o.get();if(!i4.directionAllowedForPlayer(a,t.getCurrentPlayer()))return ZG.failure(r4.DIRECTION_NOT_ALLOWED());let l=n;for(;!l.equals(r);)if(l=l.getNext(a),!t.getPieceAt(l).isEmpty())return ZG.failure(r4.MOVE_BLOCKED());return ZG.success(void 0)}static isLegalPass(e){return this.mustPass(e)&&!e.alreadyPassed?ZG.success(void 0):ZG.failure(OJ.CANNOT_PASS())}static isVictory(e){const[t,n]=this.getFurthestPiecePositions(e);return 0===t||7===n}nextCoordToPlay(e,t){return Mw.ofNullable(e4.allPieceCoords(e.board).find(n=>{const r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}applyLegalMove(e,t,n){if(e===t4.PASS){const e=this.nextCoordToPlay(t,t.colorToPlay);return new n4(t.turn+1,t.colorToPlay,e,!0,t.board)}const r=e.coord,i=e.end,s=t.getCopiedBoard();s[i.y][i.x]=s[r.y][r.x],s[r.y][r.x]=X3.EMPTY;const o=e4.getColorAt(i.x,i.y),a=this.nextCoordToPlay(t,o);return new n4(t.turn+1,o,a,!1,s)}isLegal(e,t){return i4.isLegal(e,t)}getGameStatus(e){const t=e.gameState,n=t.getCurrentPlayer();if(i4.mustPass(t)&&t.alreadyPassed)return zJ.getDefeat(n);const[r,i]=i4.getFurthestPiecePositions(t);return 7===i?zJ.ONE_WON:0===r?zJ.ZERO_WON:zJ.ONGOING}}class s4 extends TJ{getListMoves(e){const t=i4.getListMovesFromState(e.gameState);return fK.sortByDescending(t,e=>e.length()),t}getBoardValue(e){const t=e.gameState,n=t.getCurrentPlayer();if(i4.mustPass(t)&&t.alreadyPassed)return new IJ(n.getDefeatValue());const[r,i]=i4.getFurthestPiecePositions(t);return new IJ(7===i?cK.ONE.getVictoryValue():0===r?cK.ZERO.getVictoryValue():i-(7-r))}}const o4=X3.EMPTY,a4=X3.ZERO.ORANGE,l4=X3.ONE.ORANGE,c4=X3.ZERO.BLUE,u4=X3.ONE.BLUE,h4=X3.ZERO.PURPLE,d4=X3.ONE.PURPLE,p4=X3.ZERO.PINK,f4=X3.ONE.PINK,g4=X3.ZERO.YELLOW,m4=X3.ONE.YELLOW,y4=X3.ZERO.RED,v4=X3.ONE.RED,_4=X3.ZERO.GREEN,C4=X3.ONE.GREEN,E4=X3.ZERO.BROWN,w4=X3.ONE.BROWN;class S4{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`At Kamisado, there are two ways to win the game:
        either by moving one of your pieces on the opponent's starting line,
        or by forcing the opponent to make a move that blocks the entire game.
        Here, Dark wins because its brown piece is on Light's starting line, on the top left.`,new n4(5,J3.ORANGE,Mw.empty(),!1,[[E4,u4,d4,f4,m4,v4,C4,w4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,l4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,_4,y4,g4,p4,h4,c4,a4]])).withPreviousMove(t4.of(new yJ(0,7),new yJ(0,0))),jJ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
        At Kamisado, pieces can only move forward, vertically or diagonally.
        You're playing first, with dark pieces, you can make your first move.<br/><br/>
        Click on the piece of your choice and click on the landing square.`,n4.getInitialState(),t4.of(new yJ(7,7),new yJ(3,3)),$localize`Perfect! Note that each of your piece has a different color.`),jJ.fromMove($localize`Moving`,$localize`Let us now consider the move of Light, after the blue piece has been moved by Dark.
        All moves after the initial move must be made from the piece that corresponds to the color
        of the square upon which the last move ended.
        Here, the last move ended on the pink square, hence the pink piece must move.
        It is already selected, you do not have to click on it.<br/><br/>
        Move it on a blue square.`,new n4(1,J3.PINK,Mw.of(new yJ(3,0)),!1,[[l4,u4,d4,f4,m4,v4,C4,w4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,c4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[E4,_4,y4,g4,p4,h4,o4,a4]]),[t4.of(new yJ(3,0),new yJ(3,6)),t4.of(new yJ(3,0),new yJ(4,1))],$localize`Congratulations!`,$localize`You have not moved your pink piece on a blue square!`).withPreviousMove(t4.of(new yJ(6,7),new yJ(6,5))),jJ.informational($localize`Stuck situation`,$localize`Dark moved to another pink square, hence you have to move your pink piece again.
        However, your pink piece is stuck! In this case, you must pass your turn.
        Dark will now have to play by moving its pink piece.`,new n4(1,J3.PINK,Mw.of(new yJ(3,6)),!1,[[l4,u4,d4,o4,m4,v4,C4,w4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,o4,c4],[o4,o4,o4,o4,o4,o4,o4,o4],[o4,o4,o4,f4,o4,o4,o4,o4],[E4,_4,y4,g4,p4,h4,o4,a4]])).withPreviousMove(t4.of(new yJ(6,5),new yJ(7,4))),jJ.fromMove($localize`Victory by blocking`,$localize`At any time, if a player blocks the entire game, that player loses.
        In other words, if a player forces its opponent to move a piece that the opponent cannot move,
        and the player cannot move its own piece of the same color, then that player loses.
        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>
        Try to make this move.`,new n4(2,J3.RED,Mw.of(new yJ(2,4)),!1,[[o4,u4,d4,o4,o4,v4,o4,o4],[o4,o4,o4,m4,o4,o4,o4,o4],[o4,o4,o4,f4,o4,d4,o4,o4],[o4,o4,o4,g4,o4,o4,o4,o4],[o4,o4,y4,o4,o4,o4,o4,o4],[o4,o4,o4,o4,o4,o4,C4,o4],[l4,o4,o4,o4,o4,p4,o4,w4],[E4,_4,o4,o4,o4,o4,c4,a4]]),[t4.of(new yJ(2,4),new yJ(0,2))],$localize`Perfect!
         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.
         Your orange piece will be stuck and you will have to pass your turn.
         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.
         In this case, the last player to have moved a piece loses.
         Here, your opponent will have moved its green piece last, you therefore win!`,$localize`Failed!`).withPreviousMove(t4.of(new yJ(4,0),new yJ(3,1)))]}}function b4(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",i.SPACE_SIZE/2+t*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("fill",i.pieceColor(n))("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)}}function P4(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=ba(),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.piecePlayerClass(t)),ra("x",i.SPACE_SIZE/2+n*i.SPACE_SIZE-i.SPACE_SIZE/8)("y",i.SPACE_SIZE/2+r*i.SPACE_SIZE-i.SPACE_SIZE/8)("rx",i.isPlayerZero(t)?i.SPACE_SIZE:0)("ry",i.isPlayerZero(t)?i.SPACE_SIZE:0)("width",i.SPACE_SIZE/4)("height",i.SPACE_SIZE/4)}}function O4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(2,"rect",5),la(3,b4,1,4,"circle",6),la(4,P4,1,7,"rect",7),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)("fill",i.backgroundColor(n,r)),Ts(1),ha("ngIf",e!==i.UNOCCUPIED),Ts(1),ha("ngIf",e!==i.UNOCCUPIED)}}function T4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O4,5,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function I4(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"rect",10),ga(2,"rect",10),fa()),2&e){const e=ba();Ts(1),ra("x",e.lastMove.get().coord.x*e.SPACE_SIZE)("y",e.lastMove.get().coord.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE),Ts(1),ra("x",e.lastMove.get().end.x*e.SPACE_SIZE)("y",e.lastMove.get().end.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function k4(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba();ra("cx",e.SPACE_SIZE/2+e.chosen.get().x*e.SPACE_SIZE)("cy",e.SPACE_SIZE/2+e.chosen.get().y*e.SPACE_SIZE)}}let A4=(()=>{class e extends IX{constructor(e){super(e),this.UNOCCUPIED=X3.EMPTY,this.lastMove=Mw.empty(),this.chosen=Mw.empty(),this.chosenAutomatically=!1,this.rules=new i4(n4),this.availableMinimaxes=[new s4(this.rules,"KamisadoMinimax")],this.encoder=t4.encoder,this.tutorial=(new S4).tutorial,this.canPass=!1,this.updateBoard()}backgroundColor(e,t){return e4.getColorAt(e,t).rgb}isPlayerZero(e){return e.player===cK.ZERO}pieceColor(e){return e.color.rgb}piecePlayerClass(e){return this.getPlayerClass(e.player)}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=i4.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=Mw.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}pass(){var e=this;return Pw(function*(){return nq(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(t4.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new yJ(e,t);if(n.canPass)return n.cancelMove(OJ.MUST_PASS());if(n.chosen.isAbsent())return n.choosePiece(e,t);if(!1===n.chosenAutomatically&&n.chosen.equalsValue(i))return n.cancelMoveAttempt(),QG.SUCCESS;{const r=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer();return r.belongsTo(s)?n.chosenAutomatically?n.cancelMove(r4.PLAY_WITH_SELECTED_PIECE()):(n.chosen=Mw.of(i),QG.SUCCESS):yield n.chooseDestination(e,t)}})()}choosePiece(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=Mw.of(new yJ(e,t)),QG.SUCCESS)}chooseDestination(e,t){var n=this;return Pw(function*(){const r=n.chosen.get(),i=new yJ(e,t),s=t4.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}cancelMoveAttempt(){this.chosenAutomatically||(this.chosen=Mw.empty())}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-kamisado"]],features:[Go],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,T4,2,1,"g",1),la(2,I4,3,8,"g",2),la(3,k4,1,2,"circle",3),fa()),2&e&&(ra("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),M4=(()=>{class e extends NJ{static getInitialState(){const t=uK.NONE,n=cK.ZERO,r=cK.ONE;return new e([[t,n,n,n,n,n,n,t],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[t,n,n,n,n,n,n,t]],0)}static isOnBoard(t){return t.isInRange(e.SIZE,e.SIZE)}}return e.SIZE=8,e})();class N4 extends UX{constructor(e,t,n){super(e,t),this.direction=n,this.direction=fJ.factory.fromMove(e,t).get()}static of(e,t){const n=fJ.factory.fromMove(e,t);return n.isFailure()?ZG.failure(n.getReason()):e.isNotInRange(M4.SIZE,M4.SIZE)?ZG.failure("start coord is not in range"):t.isNotInRange(M4.SIZE,M4.SIZE)?ZG.failure("end coord is not in range"):ZG.success(new N4(e,t,n.get()))}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}encode(){return N4.encoder.encode(this)}decode(e){return N4.encoder.decode(e)}}N4.encoder=UX.getEncoder(M4.SIZE,M4.SIZE,(e,t)=>N4.of(e,t).get());let R4=(()=>{class e{}return e.INVALID_MOVE_LENGTH=()=>$localize`Your move should have a length equal to the number of pieces that exist on the same line.`,e.CANNOT_JUMP_OVER_OPPONENT=()=>$localize`You cannot jump over the opponent's pieces.`,e.PIECE_CANNOT_MOVE=()=>$localize`This piece has no possible move, select another one.`,e.INVALID_DIRECTION=()=>$localize`A move must be orthogonal or diagonal.`,e})();class x4 extends HJ{static getListMovesFromState(e){const t=[];if(x4.getVictory(e).isPresent())return t;for(let n=0;n<M4.SIZE;n++)for(let r=0;r<M4.SIZE;r++){const i=new yJ(r,n);if(e.getPieceAt(i).isPlayer())for(const n of x4.possibleTargets(e,i)){const e=N4.of(i,n).get();t.push(e)}}return t}static getNumberOfGroups(e){const t=fK.createTable(M4.SIZE,M4.SIZE,-1),n=[0,0];let r=0;for(let i=0;i<M4.SIZE;i++)for(let s=0;s<M4.SIZE;s++)if(-1===t[i][s]){const o=e.getPieceAt(new yJ(s,i));o.isPlayer()&&(r+=1,x4.markGroupStartingAt(e,t,new yJ(s,i),r),n[o.value]+=1)}return n}static markGroupStartingAt(e,t,n,r){const i=[n],s=e.getPieceAt(n);for(;i.length>0;){const n=Ow.getNonNullable(i.pop());if(-1===t[n.y][n.x]){const o=e.getPieceAt(n);if(o===s){t[n.y][n.x]=r;for(const t of fJ.DIRECTIONS){const r=n.getNext(t);e.isOnBoard(r)&&i.push(r)}}else o===uK.NONE&&(t[n.y][n.x]=0)}}}applyLegalMove(e,t,n){const r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=uK.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new M4(r,t.turn+1)}static isLegal(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?ZG.failure(R4.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(e=>t.getPieceAt(e)===t.getCurrentOpponent())?ZG.failure(R4.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?ZG.failure(OJ.CANNOT_SELF_CAPTURE()):ZG.success(void 0)}isLegal(e,t){return x4.isLegal(e,t)}static numberOfPiecesOnLine(e,t,n){let r=0;for(const i of x4.getLineCoords(t,n))e.getPieceAt(i).isPlayer()&&(r+=1);return r}static getLineCoords(e,t){const n=x4.getEntranceAndForwardDirection(e,t);let r=n[0];const i=n[1],s=[];for(;M4.isOnBoard(r);)s.push(r),r=r.getNext(i);return s}static getEntranceAndForwardDirection(e,t){switch(t){case fJ.UP:case fJ.DOWN:return[new yJ(e.x,0),fJ.DOWN];case fJ.LEFT:case fJ.RIGHT:return[new yJ(0,e.y),fJ.RIGHT];case fJ.UP_RIGHT:case fJ.DOWN_LEFT:return[new yJ(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),fJ.UP_RIGHT];default:return Ow.expectToBeMultiple(t,[fJ.UP_LEFT,fJ.DOWN_RIGHT]),[new yJ(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),fJ.DOWN_RIGHT]}}static getVictory(e){const[t,n]=x4.getNumberOfGroups(e);return 1===t&&1===n?Mw.of(uK.NONE):1===t?Mw.of(cK.ZERO):1===n?Mw.of(cK.ONE):Mw.empty()}static possibleTargets(e,t){const n=[];for(const r of fJ.DIRECTIONS){const i=x4.numberOfPiecesOnLine(e,t,r),s=t.getNext(r,i);if(e.isOnBoard(s)){const r=N4.of(t,s).get();x4.isLegal(r,e).isSuccess()&&n.push(s)}}return n}getGameStatus(e){const t=e.gameState,[n,r]=x4.getNumberOfGroups(t);return 1===n&&r>1?zJ.ZERO_WON:n>1&&1===r?zJ.ONE_WON:zJ.ONGOING}}class D4 extends TJ{getListMoves(e){return x4.getListMovesFromState(e.gameState)}getBoardValue(e){const t=e.gameState,[n,r]=x4.getNumberOfGroups(t);return new IJ(1===n&&r>1?cK.ZERO.getVictoryValue():n>1&&1===r?cK.ONE.getVictoryValue():100/n*cK.ZERO.getScoreModifier()+100/r*cK.ONE.getScoreModifier())}}const L4=uK.NONE,F4=cK.ZERO,U4=cK.ONE;class B4{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.
        Here, Dark wins the game:
        Dark's pieces are forming a single group, while Light's pieces form three groups.`,new M4([[L4,L4,L4,L4,L4,L4,L4,L4],[U4,L4,L4,L4,F4,L4,L4,U4],[L4,L4,F4,F4,U4,L4,L4,L4],[L4,L4,L4,F4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4]],0)),jJ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
         Moves can be made orthogonally or diagonally.
         The length of a move is equal to the number of pieces that are on the line of the move.
         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>
         You're playing Dark, make the first move!`,M4.getInitialState(),N4.of(new yJ(1,7),new yJ(1,5)).get(),$localize`Congratulations!`),jJ.fromMove($localize`Jumping`,$localize`During a move, it is possible to jump above your own pieces.
        But it is forbidden to jump over the opponent's pieces.<br/><br/>
        You're playing Dark, make a jump over one of your pieces on the following board.`,new M4([[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,U4,F4,F4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,L4,L4,F4]],0),[N4.of(new yJ(3,1),new yJ(6,1)).get()],$localize`Congratulations!`,$localize`Failed. You did not jump over one of your pieces.`),jJ.fromMove($localize`Moving`,$localize`Here is a different board. Pick the dark piece in the middle (line 4, column 4)
        and observe its possible moves.
        Horizontally, this piece can move only of one square because it is the only piece on this line.
        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.
        But it can only go up, as below it the landing square is occupied by one of your pieces.
        Diagonally, only one move is possible: on the diagonal that contains three pieces,
        only in the direction where it does not jump over one of the opponent's pieces.
        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>
        Make one of these moves.`,new M4([[L4,L4,L4,L4,L4,L4,U4,L4],[L4,L4,L4,L4,L4,F4,L4,L4],[L4,L4,L4,L4,U4,L4,L4,L4],[L4,L4,L4,F4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,U4,L4,U4],[L4,L4,L4,F4,L4,L4,U4,U4],[L4,L4,L4,F4,L4,L4,L4,L4]],0),[N4.of(new yJ(3,3),new yJ(3,0)).get(),N4.of(new yJ(3,3),new yJ(0,0)).get(),N4.of(new yJ(3,3),new yJ(2,3)).get(),N4.of(new yJ(3,3),new yJ(4,3)).get()],$localize`Congratulations!`,$localize`Failed. This was not one of the expected moves.`),jJ.fromMove($localize`Capturing`,$localize`If a move ends on an opponent's pieces, this one is captured and removed from the board.
        However, a move cannot end on one of the player's pieces.
        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!
        If a player has only one piece, that player wins the game.<br/><br/>
        On the following board, try to capture one piece with Dark.`,new M4([[L4,F4,L4,F4,F4,F4,F4,L4],[U4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,F4,L4,U4,L4,L4,L4],[U4,L4,L4,L4,L4,L4,L4,U4],[U4,L4,L4,L4,L4,L4,L4,U4],[U4,L4,L4,L4,L4,L4,L4,U4],[U4,L4,L4,L4,L4,L4,L4,U4],[L4,F4,F4,F4,F4,F4,F4,L4]],0),[N4.of(new yJ(2,2),new yJ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`),jJ.fromMove($localize`Tie`,$localize`In the special case where a move ends up connecting all pieces of both player, simultaneously,
        then the game ends up with a tie.<br/><br/>
        You're playing Dark, force the tie in one move.`,new M4([[L4,L4,L4,L4,L4,L4,L4,L4],[L4,L4,L4,L4,L4,L4,L4,L4],[F4,L4,L4,F4,U4,F4,L4,L4],[L4,L4,L4,F4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,L4,L4,U4],[L4,L4,L4,L4,L4,L4,L4,L4]],0),[N4.of(new yJ(0,2),new yJ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`)]}}function V4(e,t){if(1&e&&(Cn(),ga(0,"circle",3)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE/2+e*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+t*n.SPACE_SIZE)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function $4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(2,"rect",3),la(3,V4,1,4,"circle",4),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ha("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function z4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,$4,4,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function H4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",5),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}let G4=(()=>{class e extends IX{constructor(e){super(e),this.INDICATOR_SIZE=20,this.EMPTY=uK.NONE,this.targets=[],this.selected=Mw.empty(),this.lastMove=Mw.empty(),this.captured=Mw.empty(),this.rules=new x4(M4),this.availableMinimaxes=[new D4(this.rules,"LinesOfActionMinimax")],this.encoder=N4.encoder,this.tutorial=(new B4).tutorial,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new yJ(e,t);if(n.selected.isPresent()){if(n.getState().getPieceAt(i)===n.getState().getCurrentPlayer())return n.select(i);{const r=N4.of(n.selected.get(),new yJ(e,t));return r.isSuccess()?n.chooseMove(r.get(),n.rules.node.gameState):n.cancelMove(R4.INVALID_DIRECTION())}}return n.select(i)})()}select(e){var t=this;return Pw(function*(){return t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=Mw.of(e),t.targets=x4.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(R4.PIECE_CANNOT_MOVE()):QG.SUCCESS)})()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}updateBoard(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end).isPlayer()?Mw.of(e.end):Mw.empty()}}cancelMoveAttempt(){this.selected=Mw.empty(),this.targets=[]}getSquareClasses(e,t){const n=new yJ(e,t);if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(e)||n.equals(t))return["moved"]}return[]}getPieceClasses(e,t){const n=this.board[t][e],r=new yJ(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-linesofaction"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,z4,2,1,"g",1),la(2,H4,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.targets))},directives:[tp,Xd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class q4 extends DJ{constructor(e,t,n,r={top:0,bottom:0,left:0,right:0}){super(e.x,e.y),this.direction=t,this.orientation=n,this.captures=r}toString(){return`LodestoneMove(${this.coord.toString()}, ${this.direction}, ${this.orientation}, { top: ${this.captures.top}, bottom: ${this.captures.bottom}, left: ${this.captures.left}, right: ${this.captures.right} })`}equals(e){return this===e||!(!1===this.coord.equals(e.coord)||this.orientation!==e.orientation||this.direction!==e.direction||this.captures.top!==e.captures.top||this.captures.bottom!==e.captures.bottom||this.captures.left!==e.captures.left||this.captures.right!==e.captures.right)}}q4.encoder=new class extends oK{encodeMove(e){return{coord:yJ.encoder.encode(e.coord),direction:e.direction,orientation:e.orientation,captures:e.captures}}decodeMove(e){const t=e;return nq(null!=t.coord,"Invalid encoded LodestoneMove"),nq(null!=t.direction,"Invalid encoded LodestoneMove"),nq(null!=t.orientation,"Invalid encoded LodestoneMove"),nq(null!=t.captures,"Invalid encoded LodestoneMove"),new q4(yJ.encoder.decode(t.coord),t.direction,t.orientation,t.captures)}};let W4=(()=>{class e{}return e.MUST_FLIP_LODESTONE=()=>$localize`You must flip your lodestone before putting it back on the board.`,e.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES=()=>$localize`As long as there are pressure plates, you must place all the pieces that you have captured on them.`,e.TARGET_IS_CRUMBLED=()=>$localize`You must place your lodestone on a non-crumbled square!`,e.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE=()=>$localize`You placed too many captures on the same pressure plate, which has not enough space left.`,e.MUST_PLACE_CAPTURES=()=>$localize`You must place your captures on the pressure plates, on the side of the board.`,e.NO_CAPTURES_TO_PLACE_YET=()=>$localize`You cannot place any capture now, you must first place your lodestone on the board!`,e})();class j4{constructor(e){this.unreachable=e}isLodestone(){return!1}isPlayerPiece(){return!1}isEmpty(){return!0}isUnreachable(){return this.unreachable}equals(e){return this===e}}j4.UNREACHABLE=new j4(!0),j4.EMPTY=new j4(!1);class Z4{constructor(e){this.owner=e}static of(e){return e===cK.ZERO?Z4.ZERO:Z4.ONE}isLodestone(){return!1}isPlayerPiece(){return!0}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}Z4.ZERO=new Z4(cK.ZERO),Z4.ONE=new Z4(cK.ONE);class Y4{constructor(e,t,n){this.owner=e,this.direction=t,this.orientation=n}static of(e,t){return Y4.LODESTONES[e.value][t.direction][t.orientation]}isLodestone(){return!0}isPlayerPiece(){return!1}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}Y4.LODESTONES={0:{push:{diagonal:new Y4(cK.ZERO,"push","diagonal"),orthogonal:new Y4(cK.ZERO,"push","orthogonal")},pull:{diagonal:new Y4(cK.ZERO,"pull","diagonal"),orthogonal:new Y4(cK.ZERO,"pull","orthogonal")}},1:{push:{diagonal:new Y4(cK.ONE,"push","diagonal"),orthogonal:new Y4(cK.ONE,"push","orthogonal")},pull:{diagonal:new Y4(cK.ONE,"pull","diagonal"),orthogonal:new Y4(cK.ONE,"pull","orthogonal")}}};class K4{constructor(e,t){this.width=e,this.pieces=t}remainingSpaces(){return 5===this.width?8-this.pieces.length:3-this.pieces.length}addCaptured(e,t){if(this.pieces.length+t>=this.width)return 5===this.width?K4.EMPTY_3.addCaptured(e,t+this.pieces.length-5):(nq(this.pieces.length+t===3,"should never put more pieces than the plate can support"),Mw.empty());{const n=fK.copyImmutableArray(this.pieces);for(let r=0;r<t;r++)n.push(Z4.of(e));return Mw.of(new K4(this.width,n))}}getPieceAt(e){return e<this.pieces.length?this.pieces[e]:j4.EMPTY}}K4.POSITIONS=["top","bottom","left","right"],K4.EMPTY_5=new K4(5,[]),K4.EMPTY_3=new K4(3,[]);let Q4=(()=>{class e extends NJ{constructor(e,t,n,r){super(e,t),this.lodestones=n,this.pressurePlates=r}static getInitialState(){const t=j4.EMPTY,n=Z4.ZERO,r=Z4.ONE;return new e([[t,t,n,r,n,r,t,t],[t,n,r,n,r,n,r,t],[n,r,n,r,n,r,n,r],[r,n,r,t,t,n,r,n],[n,r,n,t,t,r,n,r],[r,n,r,n,r,n,r,n],[t,r,n,r,n,r,n,t],[t,t,r,n,r,n,t,t]],0,new UJ,{top:Mw.of(K4.EMPTY_5),bottom:Mw.of(K4.EMPTY_5),left:Mw.of(K4.EMPTY_5),right:Mw.of(K4.EMPTY_5)})}withBoard(t){return new e(t,this.turn,this.lodestones,this.pressurePlates)}remainingSpaces(){const e=this.remainingSpacesDetails();return e.top+e.bottom+e.left+e.right}remainingSpacesDetails(){const e={top:0,bottom:0,left:0,right:0};for(const t of K4.POSITIONS){const n=this.pressurePlates[t];n.isPresent()&&(e[t]=n.get().remainingSpaces())}return e}numberOfPieces(){const t=[0,0];for(let n=0;n<e.SIZE;n++)for(let r=0;r<e.SIZE;r++){const e=this.getPieceAtXY(r,n);e.isPlayerPiece()&&(t[e.owner.value]+=1)}return t}getScores(){const e=this.numberOfPieces();return[24-e[1],24-e[0]]}nextLodestoneDirection(){const e=this.getCurrentPlayer(),t=this.lodestones.get(e);if(!t.isPresent())return Mw.empty();{const e=this.getPieceAt(t.get());switch(nq(e.isLodestone(),"Piece must be lodestone (invariant from LodestoneState)"+t.get()),e.direction){case"push":return Mw.of("pull");case"pull":return Mw.of("push")}}}}return e.SIZE=8,e})();class J4 extends HJ{constructor(){super(Q4)}static get(){return J4.singleton.isAbsent()&&(J4.singleton=Mw.of(new J4)),J4.singleton.get()}applyLegalMove(e,t,n){const r=t.getCurrentPlayer(),i=r.getOpponent(),s=fK.copyBiArray(n.board),o=t.lodestones.getCopy();o.put(r,e.coord);const a={...t.pressurePlates};return this.updatePressurePlates(s,a,o,i,e.captures),new Q4(s,t.turn+1,o,a)}updatePressurePlates(e,t,n,r,i){for(const s of K4.POSITIONS)t[s]=this.updatePressurePlate(e,s,t[s],n,r,i[s])}updatePressurePlate(e,t,n,r,i,s){if(n.isPresent()){const o=n.get().addCaptured(i,s),a=J4.THREATENED_COORD_RANGE.get(t).get();return o.isAbsent()?(this.removePressurePlate(e,a.startForBigPlate,a.direction,r),this.removePressurePlate(e,a.startForSmallPlate,a.direction,r)):o.get().width<n.get().width&&this.removePressurePlate(e,a.startForBigPlate,a.direction,r),o}return n}removePressurePlate(e,t,n,r){for(let i=t;i.isInRange(Q4.SIZE,Q4.SIZE);i=i.getNext(n)){for(const e of cK.PLAYERS)r.get(e).equalsValue(i)&&r.delete(e);e[i.y][i.x]=j4.UNREACHABLE}}isLegal(e,t){const n=this.isLegalWithoutCaptures(t,e.coord,e.direction);if(n.isFailure())return ZG.failure(n.getReason());const r=this.applyMoveWithoutPlacingCaptures(t,e.coord,e);if(e.captures.top+e.captures.bottom+e.captures.left+e.captures.right!==Math.min(r.captures.length,t.remainingSpaces()))return ZG.failure(W4.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES());for(const i of K4.POSITIONS){const n=t.pressurePlates[i];if(n.isPresent()&&n.get().remainingSpaces()<e.captures[i])return ZG.failure(W4.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE())}return ZG.success(r)}applyMoveWithoutPlacingCaptures(e,t,n){let r;const i=fK.copyBiArray(e.board),s=e.lodestones.get(e.getCurrentPlayer());if(s.isPresent()){const e=s.get();i[e.y][e.x]=j4.EMPTY}return r="pull"===n.direction?this.applyPull(e,i,t,n.orientation):this.applyPush(e,i,t,n.orientation),r.board[t.y][t.x]=Y4.of(e.getCurrentPlayer(),n),r.moved.push(t),r}applyPull(e,t,n,r){const i=e.getCurrentPlayer(),s=i.getOpponent(),o=[],a=[],l="diagonal"===r?fJ.DIAGONALS:fJ.ORTHOGONALS;for(const c of l)for(let r=n.getNext(c);e.isOnBoard(r);r=r.getNext(c)){const n=t[r.y][r.x],l=r.getNext(c);if(e.isOnBoard(l)){const e=t[l.y][l.x];e.isPlayerPiece()&&e.owner===i&&(n.isEmpty()?(a.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=j4.EMPTY):n.isPlayerPiece()&&n.owner===s&&(o.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=j4.EMPTY))}}return{board:t,captures:o,moved:a}}applyPush(e,t,n,r){const i=e.getCurrentPlayer().getOpponent(),s=[],o=[],a="diagonal"===r?fJ.DIAGONALS:fJ.ORTHOGONALS;for(const l of a)for(let r=n.getNext(l,Q4.SIZE);!1===r.equals(n);r=r.getPrevious(l))if(e.isOnBoard(r)){const n=t[r.y][r.x];if(n.isPlayerPiece()&&n.owner===i){const i=r.getNext(l);if(e.isOnBoard(i)){const e=t[i.y][i.x];e.isUnreachable()?(s.push(r),t[r.y][r.x]=j4.EMPTY):e.isEmpty()&&(o.push(i),t[i.y][i.x]=n,o.push(r),t[r.y][r.x]=j4.EMPTY)}else s.push(r),t[r.y][r.x]=j4.EMPTY}}return{board:t,captures:s,moved:o}}isLegalWithoutCaptures(e,t,n){const r=this.isTargetLegal(e,t);if(r.isFailure())return r;const i=e.nextLodestoneDirection();return!1===(i.isAbsent()||i.equalsValue(n))?QG.failure(W4.MUST_FLIP_LODESTONE()):QG.SUCCESS}isTargetLegal(e,t){const n=e.getPieceAt(t);if(n.isUnreachable())return QG.failure(W4.TARGET_IS_CRUMBLED());if(n.isPlayerPiece())return QG.failure(OJ.MUST_CLICK_ON_EMPTY_SQUARE());const r=e.getCurrentPlayer();return n.isLodestone()&&n.owner!==r?QG.failure(OJ.MUST_CLICK_ON_EMPTY_SQUARE()):QG.SUCCESS}getGameStatus(e){const t=e.gameState.numberOfPieces();return 0===t[0]&&0===t[1]?zJ.DRAW:0===t[0]?zJ.ONE_WON:0===t[1]?zJ.ZERO_WON:zJ.ONGOING}}J4.THREATENED_COORD_RANGE=UJ.from({top:{startForBigPlate:new yJ(0,0),startForSmallPlate:new yJ(0,1),direction:fJ.RIGHT},bottom:{startForBigPlate:new yJ(0,Q4.SIZE-1),startForSmallPlate:new yJ(0,Q4.SIZE-2),direction:fJ.RIGHT},left:{startForBigPlate:new yJ(0,0),startForSmallPlate:new yJ(1,0),direction:fJ.DOWN},right:{startForBigPlate:new yJ(Q4.SIZE-1,0),startForSmallPlate:new yJ(Q4.SIZE-2,0),direction:fJ.DOWN}}),J4.singleton=Mw.empty();class X4 extends TJ{getListMoves(e){const t=e.gameState;return this.flatMapEmptyCoords(t,e=>{const n=[];for(const r of this.nextDirection(t)){const i=["diagonal","orthogonal"];for(const s of i){const i=J4.get().applyMoveWithoutPlacingCaptures(t,e,{direction:r,orientation:s}).captures.length;for(const o of this.captureCombinations(t,i))n.push(new q4(e,r,s,o))}}return n})}captureCombinations(e,t){if(0===t)return new AJ([{top:0,bottom:0,left:0,right:0}]);{const n=new AJ,r=e.remainingSpacesDetails(),i=this.captureCombinations(e,t-1);for(const e of i)e.top+1<=r.top&&n.add({...e,top:e.top+1}),e.bottom+1<=r.bottom&&n.add({...e,bottom:e.bottom+1}),e.left+1<=r.left&&n.add({...e,left:e.left+1}),e.right+1<=r.right&&n.add({...e,right:e.right+1});return 0===n.size()?i:n}}flatMapEmptyCoords(e,t){let n=[];for(let r=0;r<Q4.SIZE;r++)for(let i=0;i<Q4.SIZE;i++){const s=new yJ(i,r),o=e.getPieceAt(s);(o.isEmpty()&&!1===o.isUnreachable()||o.isLodestone()&&o.owner===e.getCurrentPlayer())&&(n=n.concat(t(s)))}return n}nextDirection(e){const t=e.nextLodestoneDirection();return t.isPresent()?[t.get()]:["push","pull"]}getBoardValue(e){const t=e.gameState.getScores();let n;return n=24===t[0]&&24!==t[1]?cK.ZERO.getVictoryValue():24!==t[0]&&24===t[1]?cK.ONE.getVictoryValue():t[0]*cK.ZERO.getScoreModifier()+t[1]*cK.ONE.getScoreModifier(),new IJ(n)}}const e5=j4.UNREACHABLE,t5=j4.EMPTY,n5=Z4.ZERO,r5=Z4.ONE,i5=Y4.of(cK.ONE,{direction:"push",orientation:"orthogonal"}),s5={top:Mw.of(K4.EMPTY_5),bottom:Mw.of(K4.EMPTY_5),left:Mw.of(K4.EMPTY_5),right:Mw.of(K4.EMPTY_5)};class o5{constructor(){this.tutorial=[jJ.informational($localize`Board and aim of the game`,$localize`Lodestone is played on a 8x8 board, which contains so-called <i>pressure plates</i> along the board, that will contain captured pieces. The initial board is shown here. The aim of the game is to be the only player with pieces remaining on the board. To do so, you will have to either push your opponent's pieces off the board, or to crush them with your pieces. You will do it by using a lodestone.`,Q4.getInitialState()),jJ.forClick($localize`Selecting a lodestone`,$localize`To perform a move, you have to place your lodestone on the board. Your lodestone has two sides: <ul><li>its <i>repelling</i> side with which it will repel the opponent's pieces (indicated by the outward triangles of your opponent's color on the lodestone), and</li><li>its <i>attracting</i> side with which it will attract your pieces (indicated by the inward triangles of your color on the lodestone).</li></ul>Your lodestone can be placed to move pieces orthogonally or diagonally. All available lodestone sides and orientation are shown below the board.<br/><br/>You're playing Dark. Select the lodestone that repels your opponent's pieces diagonally.`,Q4.getInitialState(),["#lodestone_push_diagonal"],$localize`Congratulations!`,$localize`This is not the right lodestone, try again.`),jJ.informational($localize`The repelling lodestone`,$localize`Upon placing a lodestone on the board, it will move all pieces it acts upon (according to its direction and orientation) simultaneously. Let us first see how the repelling lodestone acts on the pieces. All the opponent's pieces aligned with the lodestone, as indicated by the triangles' orientations, will be pushed one square away from the lodestone. An opponent's piece will be blocked in case it encounters on its way either one of your piece, a lodestone, or another blocked piece. Finally, if an opponent's piece falls out of the board, it is captured.`,Q4.getInitialState()),jJ.informational($localize`The attracting lodestone`,$localize`When the lodestone is on its attracting side it will pull your pieces one square towards it. In case one of your pieces encounters a lodestone on its way or another blocked piece, it is blocked. However, if it encounter an opponent's piece, it will capture it.`,Q4.getInitialState()),jJ.informational($localize`Flipping the lodestone`,$localize`Note that, after every move, you must flip your lodestone: if it was on its repelling side, you must use it on its attracting side, and vice versa. Also, you are allowed to place your lodestone on the same location as it was on your previous turn.`,Q4.getInitialState()),jJ.fromPredicate($localize`Capturing`,$localize`To summarize, it is possible to capture the opponent's pieces in two ways:<ul><li>with a repelling lodestone, by pushing your opponent's pieces out of the board, or</li><li>with an attracting lodestone, by moving your pieces on your opponent's pieces.</li></ul>Once a lodestone is placed and the pieces have been moved and/or captured, in case any of the opponent's pieces have been captured, you have to place them on the <i>pressure plates</i> that lie around the board. To do so, click on an empty space of the pressure plate of your choice for each capture. You can cancel this by clicking again on a piece you just put on a pressure plate.<br/><br/>You're playing Dark. Try to perform a move that captures at least one of your opponent's piece, and place your capture(s) on pressure plates.`,Q4.getInitialState(),new q4(new yJ(0,6),"pull","orthogonal",{top:2,bottom:1,left:1,right:1}),(e,t)=>32===t.remainingSpaces()?QG.failure($localize`You have not captured any of the opponent's pieces, try again!`):QG.SUCCESS,"Congratulations!"),jJ.fromPredicate($localize`Crumbling a first pressure plate`,$localize`When a pressure plate is full, it will crumble and take a full row or column of the board with it! All pieces that are on the crumbled squares are considered lost, but will not have to be placed on pressure plates. You have here a board with a pressure plate that only requires one more piece to crumble.<br/><br/>You're playing Dark. Perform a move that captures at least one piece, and fill that pressure plate to make it crumble.`,new Q4([[t5,t5,t5,t5,r5,t5,t5,t5],[t5,t5,n5,t5,t5,r5,t5,t5],[t5,t5,i5,t5,t5,t5,t5,n5],[t5,t5,t5,t5,r5,t5,t5,n5],[t5,t5,t5,t5,t5,n5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5]],0,new UJ([{key:cK.ONE,value:new yJ(2,2)}]),{...s5,top:K4.EMPTY_5.addCaptured(cK.ONE,4)}),new q4(new yJ(6,2),"push","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>5===t.pressurePlates.top.get().width?QG.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble!`):QG.SUCCESS,"Congratulations!"),jJ.fromPredicate($localize`Crumbling a second pressure plate`,$localize`Once a pressure plate has crumbled, a shorter pressure plate takes it place. It is the case here, where only 3 spots are available on the top pressure plate.<br/><br/>You're playing Dark. Perform a move that captures enough pieces to fill the top pressure plate, and make it crumble.`,new Q4([[e5,e5,e5,e5,e5,e5,e5,e5],[t5,t5,t5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,n5],[t5,t5,t5,t5,t5,n5,t5,n5],[t5,i5,t5,t5,r5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,r5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5]],0,new UJ([{key:cK.ONE,value:new yJ(1,4)}]),{...s5,top:K4.EMPTY_3.addCaptured(cK.ONE,2)}),new q4(new yJ(3,5),"pull","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>t.pressurePlates.top.isPresent()?QG.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble a second time!`):QG.SUCCESS,"Congratulations!"),jJ.informational($localize`Minimal board`,$localize`After a pressure plate has crumbled for a second time, there is no more pressure plate available on that side. In case all pressure plates have crumbled, the board is reduced to a 4x4 board.`,new Q4([[e5,e5,e5,e5,e5,e5,e5,e5],[e5,e5,e5,e5,e5,e5,e5,e5],[e5,e5,n5,r5,t5,t5,e5,e5],[e5,e5,i5,r5,t5,t5,e5,e5],[e5,e5,t5,n5,n5,t5,e5,e5],[e5,e5,n5,t5,t5,t5,e5,e5],[e5,e5,e5,e5,e5,e5,e5,e5],[e5,e5,e5,e5,e5,e5,e5,e5]],0,new UJ([{key:cK.ONE,value:new yJ(2,3)}]),{top:Mw.empty(),bottom:Mw.empty(),left:Mw.empty(),right:Mw.empty()})),jJ.fromMove($localize`Making the lodestone fall`,$localize`If, at any point during the game, your lodestone is situated on a square that crumbles with a pressure plate, you will be allowed to select any lodestone side on your next turn.<br/><br/>In this board, playing Dark, you can place your lodestone and make a pressure plate crumble so that your lodestone falls too, allowing to choose more freely its side on your next turn. Do it!`,new Q4([[t5,t5,t5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,t5,r5,t5,t5],[t5,t5,t5,i5,t5,t5,n5,t5],[t5,t5,n5,n5,r5,t5,t5,n5],[t5,t5,t5,t5,t5,n5,t5,t5],[t5,t5,n5,t5,t5,t5,t5,t5],[t5,t5,r5,t5,t5,t5,t5,t5],[t5,t5,t5,t5,t5,t5,t5,t5]],0,new UJ([{key:cK.ONE,value:new yJ(3,2)}]),{...s5,top:K4.EMPTY_5.addCaptured(cK.ONE,4)}),[new q4(new yJ(4,0),"pull","diagonal",{top:1,bottom:0,left:0,right:0})],$localize`Congratulations! At your next turn, you will be allowed to place your lodestone on any side.`,$localize`Failed, try again.`),jJ.fromMove($localize`End of the game`,$localize`In order to win, you must take out all of your opponent's pieces.<br/><br/>Here, you can win in a single move, do it!`,new Q4([[e5,e5,e5,e5,e5,e5,e5,e5],[e5,e5,e5,e5,e5,e5,e5,e5],[e5,r5,n5,r5,t5,t5,e5,e5],[e5,r5,i5,t5,r5,t5,e5,e5],[e5,t5,t5,n5,n5,t5,e5,e5],[e5,r5,n5,t5,r5,t5,e5,e5],[e5,t5,t5,t5,n5,t5,e5,e5],[e5,e5,e5,e5,e5,e5,e5,e5]],0,new UJ([{key:cK.ONE,value:new yJ(2,3)}]),{top:Mw.empty(),bottom:K4.EMPTY_3.addCaptured(cK.ZERO,2),left:Mw.of(K4.EMPTY_3),right:Mw.empty()}),[new q4(new yJ(4,2),"pull","orthogonal",{top:0,bottom:0,left:3,right:0})],$localize`Congratulations, you won!`,$localize`This is not the winning move. Try again.`)]}}function a5(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function l5(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba().$implicit,t=ba(3).$implicit,n=ba(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_OUT)}}function c5(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba().$implicit,t=ba(3).$implicit,n=ba(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_IN)}}function u5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,l5,1,3,"polygon",14),la(2,c5,1,3,"polygon",14),fa()),2&e){const e=ba(3).$implicit;Ts(1),ha("ngIf","push"===e.lodestone.direction),Ts(1),ha("ngIf","pull"===e.lodestone.direction)}}const h5=function(){return[0,1,2,3]};function d5(e,t){if(1&e&&(Cn(),pa(0,"g",11),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,u5,3,2,"g",1),fa(),fa()),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("transform",i.getSquareTransform(t,r)),Ts(1),ha("ngClass",n.lodestone.selectedClass),ra("r",i.PIECE_RADIUS),Ts(1),ha("ngClass",n.lodestone.pieceClasses),ra("r",i.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===n.lodestone.orientation?45:0,")"),Ts(1),ha("ngForOf",wu(7,h5))}}function p5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).selectCoord(t.coord)}),ga(1,"rect",7),la(2,a5,1,6,"circle",8),la(3,d5,5,8,"g",9),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","square_",t,"_",r,""),Ts(1),ha("ngClass",n.squareClasses),ra("x",i.SPACE_SIZE*t+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",n.hasPiece),Ts(1),ha("ngIf",n.lodestone)}}function f5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,p5,4,9,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",!1===e.crumbled)}}function g5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,f5,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function m5(e,t){if(1&e&&(Cn(),pa(0,"g",16),ga(1,"circle",17),fa()),2&e){const e=t.$implicit,n=t.index,r=ba();Ta("id","capture_",n,""),ra("transform",r.getCaptureTransform(n)),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS)}}function y5(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polygon",15),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),aa("transform","rotate(",90*e,")"),ha("ngClass",n.movingClass),ra("points","push"===n.direction?r.TRIANGLE_OUT:r.TRIANGLE_IN)}}function v5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){const t=Gt(e).$implicit;return ba().selectLodestone(t)}),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,y5,2,3,"g",1),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ia("id","lodestone_",e.direction,"_",e.orientation,""),ra("transform",r.getAvailableLodestoneTransform(n)),Ts(1),ha("ngClass",e.selectedClass),ra("r",r.PIECE_RADIUS),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===e.orientation?45:0,")"),Ts(1),ha("ngForOf",wu(9,h5))}}function _5(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().$implicit,i=ba();Ia("id","platePiece_",r.position,"_",t,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*n.coord.x+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*n.coord.y+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function C5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",6),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index,i=ba().$implicit;return ba().onPressurePlateClick(n.temporary,i.position,r)}),ga(2,"rect",18),la(3,_5,1,6,"circle",8),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().$implicit,i=ba();ra("transform",i.getPressurePlateTransform(r.position)),Ts(1),Ia("id","plate_",r.position,"_",n,""),Ts(1),Ia("id","plateSquare_",r.position,"_",n,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*e.coord.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*e.coord.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.hasPiece)}}function E5(e,t){if(1&e&&(Cn(),pa(0,"g",16),la(1,C5,4,11,"g",1),fa()),2&e){const e=t.$implicit;Ta("id","pressurePlate_",e.position,""),Ts(1),ha("ngForOf",e.coords)}}function w5(e,t){if(1&e&&(Cn(),ga(0,"rect",19)),2&e){const e=ba();Ia("id","selection_",e.viewInfo.selected.get().x,"_",e.viewInfo.selected.get().y,""),ra("x",e.SPACE_SIZE*e.viewInfo.selected.get().x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.viewInfo.selected.get().y+e.STROKE_WIDTH)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}class S5 extends vJ{constructor(e){super(e),this.viewInfo={availableLodestones:[],capturesToPlace:[],boardInfo:[],currentPlayerClass:"",opponentClass:"",pressurePlates:[],selected:Mw.empty(),pressurePlateShift:{top:new hJ(0,0),left:new hJ(0,0),right:new hJ(0,0),bottom:new hJ(0,0)}},this.stateAfterPlacingLodestone=Mw.empty(),this.lastInfos=Mw.empty(),this.capturesToPlace=0,this.selectedCoord=Mw.empty(),this.selectedLodestone=Mw.empty(),this.captures={top:0,bottom:0,left:0,right:0},this.rules=J4.get(),this.tutorial=(new o5).tutorial,this.availableMinimaxes=[new X4(this.rules,"LodestoneDummyMinimax")],this.encoder=q4.encoder,this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH);const t=.8*this.PIECE_RADIUS,n=.3*this.PIECE_RADIUS,r=.2*this.PIECE_RADIUS;this.TRIANGLE_OUT=`${t},0 ${n},${r} ${n},-${r}`,this.TRIANGLE_IN=`${n},0 ${t},${n} ${t},-${n}`,this.displayedState=this.rules.node.gameState,this.scores=Mw.of([0,0])}ngOnInit(){this.updateBoard()}selectCoord(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#square_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.capturesToPlace>0)return t.cancelMove(W4.MUST_PLACE_CAPTURES());const r=J4.get().isTargetLegal(t.getState(),e);return r.isFailure()?t.cancelMove(r.getReason()):t.selectedLodestone.isPresent()?(t.selectedCoord=Mw.of(e),t.putLodestone()):(t.selectedCoord=Mw.of(e),t.updateViewInfo(),QG.SUCCESS)})()}selectLodestone(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#lodestone_"+e.direction+"_"+e.orientation);if(n.isFailure())return t.cancelMove(n.getReason());nq(0===t.capturesToPlace,"should not be able to click on a lodestone when captures need to be placed");const r=t.getCurrentPlayer();return t.selectedLodestone=Mw.of(Y4.of(r,e)),t.selectedCoord.isPresent()?t.putLodestone():(t.updateViewInfo(),QG.SUCCESS)})()}putLodestone(){var e=this;return Pw(function*(){nq(e.selectedCoord.isPresent(),"coord should have been selected"),nq(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=e.getState();nq(J4.get().isLegalWithoutCaptures(r,t,n.direction).isSuccess(),"Lodestone component should only allow creation of legal moves");const i=J4.get().applyMoveWithoutPlacingCaptures(r,t,n);return e.lastInfos=Mw.of(i),e.capturesToPlace=Math.min(i.captures.length,r.remainingSpaces()),0===e.capturesToPlace?e.applyMove():(e.displayedState=e.displayedState.withBoard(i.board),e.stateAfterPlacingLodestone=Mw.of(e.displayedState),e.updateViewInfo(),QG.SUCCESS)})()}applyMove(){var e=this;return Pw(function*(){nq(e.selectedCoord.isPresent(),"coord should have been selected"),nq(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=new q4(t,n.direction,n.orientation,e.captures);return e.chooseMove(r,e.getState())})()}onPressurePlateClick(e,t,n){return e?this.deselectPressurePlate(t,n):this.selectPressurePlate(t,n)}selectPressurePlate(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(0===n.capturesToPlace)return n.cancelMove(W4.NO_CAPTURES_TO_PLACE_YET());n.capturesToPlace--,n.captures[e]++;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=fK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return J4.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new Q4(o,i.turn,l,a),0===n.capturesToPlace?n.applyMove():(n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),QG.SUCCESS)})()}deselectPressurePlate(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.capturesToPlace++,n.captures[e]--;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=fK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return J4.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new Q4(o,i.turn,l,a),n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),QG.SUCCESS})()}updateBoard(){this.cancelMoveAttempt(),this.rules.node.move.isPresent()&&this.showLastMove(),this.scores=Mw.of(this.getState().getScores())}cancelMoveAttempt(){this.displayedState=this.getState(),this.stateAfterPlacingLodestone=Mw.empty(),this.lastInfos=Mw.empty();const e=this.displayedState.lodestones.get(this.getCurrentPlayer());if(e.isPresent()){const t=fK.copyBiArray(this.displayedState.board);t[e.get().y][e.get().x]=j4.EMPTY,this.displayedState=this.displayedState.withBoard(t)}this.selectedCoord=Mw.empty(),this.selectedLodestone=Mw.empty(),this.capturesToPlace=0,this.captures={top:0,bottom:0,left:0,right:0},this.updateViewInfo()}updateViewInfo(){const e=this.getState().getCurrentPlayer();this.viewInfo.currentPlayerClass=this.getPlayerClass(e),this.viewInfo.opponentClass=this.getPlayerClass(e.getOpponent()),this.showBoard(),this.showAvailableLodestones(),this.showCapturesToPlace(),this.showPressurePlates(),this.computePressurePlateShift(),this.lastInfos.isPresent()&&this.showMovedAndCaptured(this.lastInfos.get())}showBoard(){this.viewInfo.boardInfo=[];for(let e=0;e<Q4.SIZE;e++){this.viewInfo.boardInfo.push([]);for(let t=0;t<Q4.SIZE;t++){const n=new yJ(t,e);this.viewInfo.boardInfo[e].push(this.getSquareInfo(n))}}this.viewInfo.selected=this.selectedCoord.isPresent()&&!1===this.displayedState.getPieceAt(this.selectedCoord.get()).isUnreachable()?this.selectedCoord:Mw.empty()}getSquareInfo(e){const t=this.displayedState.getPieceAt(e),n={coord:e,squareClasses:[],crumbled:t.isUnreachable(),hasPiece:t.isPlayerPiece(),pieceClasses:[]};return t.isPlayerPiece()&&(n.pieceClasses=[this.getPlayerClass(t.owner)]),t.isLodestone()&&(n.lodestone={direction:t.direction,pieceClasses:[this.getPlayerClass(t.owner)],selectedClass:"",movingClass:"",orientation:t.orientation},n.lodestone.movingClass=this.getPlayerClass("push"===t.direction?t.owner.getOpponent():t.owner)),n}showAvailableLodestones(){if(this.capturesToPlace>0)this.viewInfo.availableLodestones=[];else{const e=this.getState().getCurrentPlayer(),t=this.getState().nextLodestoneDirection();if(t.isPresent()){const n=t.get();this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:n,orientation:"orthogonal"}),this.nextLodestone(e,{direction:n,orientation:"diagonal"})]}else this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:"push",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"push",orientation:"diagonal"}),this.nextLodestone(e,{direction:"pull",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"pull",orientation:"diagonal"})]}}showCapturesToPlace(){const e=this.getCurrentPlayer().getOpponent();this.viewInfo.capturesToPlace=[];for(let t=0;t<this.capturesToPlace;t++)this.viewInfo.capturesToPlace.push({pieceClasses:[this.getPlayerClass(e)]})}nextLodestone(e,t){const n=Y4.of(e,t),r={direction:n.direction,orientation:n.orientation,pieceClasses:[this.getPlayerClass(n.owner)],movingClass:"",selectedClass:""};return r.movingClass=this.getPlayerClass("push"===n.direction?n.owner.getOpponent():n.owner),this.selectedLodestone.equalsValue(n)&&(r.selectedClass="selected"),r}showPressurePlates(){this.viewInfo.pressurePlates=[];for(const e of K4.POSITIONS){const t=[],n=this.displayedState.pressurePlates[e];if(n.isPresent()){const r=S5.PRESSURE_PLATES_POSITIONS.get(e).get(),i=n.get().width;let s=5===i?r.startForBigPlate:r.startForSmallPlate;for(let e=0;e<i;e++){s=s.getNext(r.direction);const i=n.get().getPieceAt(e);let o="";i.isPlayerPiece()&&(o=this.getPlayerClass(i.owner)),t.push({coord:s,hasPiece:i.isPlayerPiece(),pieceClasses:[o],squareClasses:[],temporary:!1})}}this.viewInfo.pressurePlates.push({position:e,coords:t})}}showLastMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.move.get();this.lastInfos=Mw.of(J4.get().applyMoveWithoutPlacingCaptures(e,t.coord,t)),this.updateViewInfo();const n=this.getState();this.showPressurePlateDifferences(e,n,!1)}showPressurePlateDifferences(e,t,n){for(const r of K4.POSITIONS)this.showPressurePlateDifference(e.pressurePlates[r],t.pressurePlates[r],r,n)}showPressurePlateDifference(e,t,n,r){if(e.isPresent()&&t.isPresent()){const i=e.get(),s=t.get(),o=Ow.getNonNullable(this.viewInfo.pressurePlates.find(e=>e.position===n));if(i.width===s.width)for(let e=0;e<s.width;e++){const t=i.getPieceAt(e),n=s.getPieceAt(e);!1===t.equals(n)&&(o.coords[e].squareClasses.push("moved"),o.coords[e].temporary=r,r&&o.coords[e].pieceClasses.push("semi-transparent"))}else for(const e of o.coords)e.squareClasses.push("moved")}}showMovedAndCaptured(e){for(const t of e.moved)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved");for(const t of e.captures)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("captured")}computePressurePlateShift(){const e=this.displayedState,t=this.getPressurePlateShift(e.pressurePlates.left),n=this.getPressurePlateShift(e.pressurePlates.right),r=this.getPressurePlateShift(e.pressurePlates.top),i=this.getPressurePlateShift(e.pressurePlates.bottom);this.viewInfo.pressurePlateShift.top=new yJ(.5*(t-n),0),this.viewInfo.pressurePlateShift.bottom=new yJ(.5*(t-n),0),this.viewInfo.pressurePlateShift.left=new yJ(0,.5*(r-i)),this.viewInfo.pressurePlateShift.right=new yJ(0,.5*(r-i))}getPressurePlateShift(e){return e.isAbsent()?2:3===e.get().width?1:0}getSquareTransform(e,t){return`translate(${e*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2}, ${t*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getCaptureTransform(e){return`translate(${(e+(Q4.SIZE/2-this.viewInfo.capturesToPlace.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${-2*this.SPACE_SIZE-30+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getAvailableLodestoneTransform(e){return`translate(${(e+(Q4.SIZE/2-this.viewInfo.availableLodestones.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${30+9*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getPressurePlateTransform(e){return`translate(${this.viewInfo.pressurePlateShift[e].x*this.SPACE_SIZE}, ${this.viewInfo.pressurePlateShift[e].y*this.SPACE_SIZE})`}}S5.PRESSURE_PLATE_EXTRA_SHIFT=.2,S5.PRESSURE_PLATES_POSITIONS=UJ.from({top:{startForBigPlate:new yJ(.5,-1-S5.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new yJ(1.5,0-S5.PRESSURE_PLATE_EXTRA_SHIFT),direction:fJ.RIGHT},bottom:{startForBigPlate:new yJ(.5,8+S5.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new yJ(1.5,7+S5.PRESSURE_PLATE_EXTRA_SHIFT),direction:fJ.RIGHT},left:{startForBigPlate:new yJ(-1-S5.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new yJ(0-S5.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:fJ.DOWN},right:{startForBigPlate:new yJ(8+S5.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new yJ(7+S5.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:fJ.DOWN}}),S5.\u0275fac=function(e){return new(e||S5)(ua(eq))},S5.\u0275cmp=Xe({type:S5,selectors:[["app-lodestone"]],features:[Go],decls:6,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 -220 1016 1256","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],["class","base no-fill selected",3,"id",4,"ngIf"],[3,"id","click",4,"ngIf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"id","ngClass",4,"ngIf"],["class","lodestone",4,"ngIf"],[1,"base",3,"id","ngClass"],[1,"lodestone"],["cx","0","cy","0",1,"base","black-fill","outside",3,"ngClass"],["cx","0","cy","0",1,"base","no-stroke",3,"ngClass"],["class","base no-stroke",3,"ngClass",4,"ngIf"],[1,"base","no-stroke",3,"ngClass"],[3,"id"],["cx","0","cy","0",1,"base",3,"ngClass"],["rx","20","ry","20",1,"base",3,"id","ngClass"],[1,"base","no-fill","selected",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,g5,2,1,"g",1),la(2,m5,2,4,"g",2),la(3,v5,5,10,"g",3),la(4,E5,2,2,"g",2),la(5,w5,1,6,"rect",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.viewInfo.capturesToPlace),Ts(1),ha("ngForOf",t.viewInfo.availableLodestones),Ts(1),ha("ngForOf",t.viewInfo.pressurePlates),Ts(1),ha("ngIf",t.viewInfo.selected.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let b5=(()=>{class e{}return e.START_COORD_OUT_OF_RANGE=()=>$localize`Start coord cannot be out of range`,e.END_COORD_OUT_OF_RANGE=()=>$localize`End coord cannot be out of range`,e.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP=()=>$localize`Pawns must move one step diagonally.`,e.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS=()=>$localize`Drones must move one or two steps in any direction.`,e})();class P5 extends UX{constructor(e,t,n){super(e,t),this.calledTheClock=n}static from(e,t,n=!1){if(e.isNotInRange(4,8))return ZG.failure(b5.START_COORD_OUT_OF_RANGE());if(t.isNotInRange(4,8))return ZG.failure(b5.END_COORD_OUT_OF_RANGE());if(t.equals(e))return ZG.failure(OJ.MOVE_CANNOT_BE_STATIC());const r=fJ.factory.fromDelta(t.x-e.x,t.y-e.y);return r.isFailure()?ZG.failure(r.getReason()):ZG.success(new P5(e,t,n))}toString(){return"MartianChessMove(("+this.coord.x+", "+this.coord.y+") -> ("+this.end.x+", "+this.end.y+")"+(this.calledTheClock?", CALL_THE_CLOCK":"")+")"}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.end.equals(e.end)&&this.calledTheClock===e.calledTheClock}isValidForPawn(){const e=Math.abs(this.coord.x-this.end.x),t=Math.abs(this.coord.y-this.end.y);return 1===e&&1===t}isValidForDrone(){return this.coord.getDistance(this.end)<=2}isUndoneBy(e){if(e.isAbsent())return!1;const t=e.get();return t.end.equals(this.coord)&&t.coord.equals(this.end)}}P5.encoder=aK.tuple([yJ.numberEncoder(4,8),yJ.numberEncoder(4,8),aK.booleanEncoder],e=>[e.coord,e.end,e.calledTheClock],e=>P5.from(e[0],e[1],e[2]).get());class O5{constructor(e){this.value=e}static tryMerge(e,t){nq(e!==O5.EMPTY&&t!==O5.EMPTY,"tryMerge cannot be called with empty pieces");const n=e.value+t.value;return 2===n||3===n?Mw.of(O5.from(n)):Mw.empty()}static from(e){switch(e){case O5.DRONE.value:return O5.DRONE;default:return Ow.expectToBe(e,O5.QUEEN.value),O5.QUEEN}}getValue(){return this.value}equals(e){return this.getValue()===e.getValue()}}O5.EMPTY=new O5(0),O5.PAWN=new O5(1),O5.DRONE=new O5(2),O5.QUEEN=new O5(3);class T5 extends TJ{constructor(e,t){super(e,t),this.ruler=e}getListMoves(e){const t=e.gameState,n=t.getCurrentPlayer(),r=t.getPlayerTerritory(n);let i=[];for(const s of r)for(let e=0;e<4;e++)switch(t.getPieceAtXY(e,s)){case O5.PAWN:i=i.concat(this.getMovesForPawnAt(t,e,s));break;case O5.DRONE:i=i.concat(this.getMovesForDroneAt(t,e,s));break;case O5.QUEEN:i=i.concat(this.getMovesForQueenAt(t,e,s))}return i}getMovesForPawnAt(e,t,n){const r=new yJ(t,n),i=[];for(const s of fJ.DIAGONALS){const e=r.getNext(s);e.isInRange(4,8)&&i.push(e)}return this.addLegalMoves(e,r,i)}addLegalMoves(e,t,n){const r=[],i=e.getPieceAt(t),s=!1===e.isTherePieceOnPlayerSide(O5.DRONE),o=!1===e.isTherePieceOnPlayerSide(O5.QUEEN),a=e.lastMove;for(const l of n){const n=e.getPieceAt(l);if(n===O5.EMPTY)this.add(r,P5.from(t,l).get(),a);else if(e.isInPlayerTerritory(l)){const e=O5.tryMerge(n,i);if(e.isPresent()){const n=e.get(),i=P5.from(t,l).get();(n===O5.DRONE&&s||n===O5.QUEEN&&o)&&this.add(r,i,a)}}else this.add(r,P5.from(t,l).get(),a)}return r}add(e,t,n){!1===t.isUndoneBy(n)&&e.push(t)}getMovesForDroneAt(e,t,n){const r=new yJ(t,n),i=this.getLandingCoordsForLinearMove(r,e,2);return this.addLegalMoves(e,r,i)}getLandingCoordsForLinearMove(e,t,n){const r=[];for(const i of fJ.DIRECTIONS){let s=1,o=e.getNext(i,s),a=t.tryToGetPieceAt(o),l=a.equalsValue(O5.EMPTY);for(;l;)r.push(o),s++,o=e.getNext(i,s),a=t.tryToGetPieceAt(o),l=a.equalsValue(O5.EMPTY)&&s<n;a.isPresent()&&r.push(o)}return r}getMovesForQueenAt(e,t,n){const r=new yJ(t,n),i=this.getLandingCoordsForQueen(r,e);return this.addLegalMoves(e,r,i)}getLandingCoordsForQueen(e,t){return this.getLandingCoordsForLinearMove(e,t,8)}getBoardValue(e){const t=this.ruler.getGameStatus(e);let n;if(t.isEndGame)n=t.toBoardValue();else{const t=e.gameState.getScoreOf(cK.ZERO);n=e.gameState.getScoreOf(cK.ONE)-t}return new IJ(n)}}class I5{constructor(e){this.captures=e,e.makeImmutable()}static from(e){const t=new UJ;for(const n of e)I5.addToMap(t,n);return new I5(t)}static addToMap(e,t){const n=e.get(t);n.isPresent()?e.replace(t,n.get()+1):e.set(t,1)}toValue(){let e=0;return this.captures.forEach(t=>{e+=t.key.getValue()*t.value}),e}add(e){const t=this.captures.getCopy();return I5.addToMap(t,e),new I5(t)}}class k5 extends NJ{constructor(e,t,n=Mw.empty(),r=Mw.empty(),i){super(e,t),this.lastMove=n,this.countDown=r,null==i&&(i=new UJ([{key:cK.ZERO,value:I5.from([])},{key:cK.ONE,value:I5.from([])}])),i.makeImmutable(),this.captured=i}static getInitialState(){const e=O5.EMPTY,t=O5.PAWN,n=O5.DRONE,r=O5.QUEEN;return new k5([[r,r,n,e],[r,n,t,e],[n,t,t,e],[e,e,e,e],[e,e,e,e],[e,t,t,n],[e,t,n,r],[e,n,r,r]],0,Mw.empty())}getPlayerTerritory(e){return e===cK.ZERO?k5.PLAYER_ZERO_TERRITORY:k5.PLAYER_ONE_TERRITORY}isTherePieceOnPlayerSide(e){const t=this.getCurrentPlayer(),n=this.getPlayerTerritory(t);for(const r of n)for(let t=0;t<4;t++)if(this.getPieceAtXY(t,r)===e)return!0;return!1}getScoreOf(e){return this.captured.get(e).get().toValue()}getEmptyTerritory(){return this.isTerritoryEmpty(cK.ZERO)?Mw.of(cK.ZERO):this.isTerritoryEmpty(cK.ONE)?Mw.of(cK.ONE):Mw.empty()}isTerritoryEmpty(e){const t=this.getPlayerTerritory(e);for(const n of t)for(let e=0;e<4;e++)if(this.getPieceAtXY(e,n)!==O5.EMPTY)return!1;return!0}isInOpponentTerritory(e){const t=this.getCurrentOpponent();return this.getPlayerTerritory(t).contains(e.y)}isInPlayerTerritory(e){const t=this.getCurrentPlayer();return this.getPlayerTerritory(t).contains(e.y)}getCapturesOf(e){const t=this.captured.get(cK.fromTurn(e)).get();return[t.captures.get(O5.PAWN).getOrElse(0),t.captures.get(O5.DRONE).getOrElse(0),t.captures.get(O5.QUEEN).getOrElse(0)]}}k5.PLAYER_ZERO_TERRITORY=new AJ([0,1,2,3]),k5.PLAYER_ONE_TERRITORY=new AJ([4,5,6,7]);let A5=(()=>{class e{}return e.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY=()=>$localize`You must pick a piece from your side of the board in order to move it.`,e.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT=()=>$localize`This is not a valid promotion nor a valid capture.`,e.CANNOT_UNDO_LAST_MOVE=()=>$localize`You cannot perform a move that is the reverse of the previous one.`,e})();class M5 extends HJ{applyLegalMove(e,t,n){const r=t.getCopiedBoard();r[e.coord.y][e.coord.x]=O5.EMPTY,r[e.end.y][e.end.x]=n.finalPiece;const i=n.score;let s=t.countDown;if(s.isPresent())if(this.isCapture(e,t))s=M5.STARTING_COUNT_DOWN;else{const e=t.countDown.get();s=Mw.of(e-1)}return e.calledTheClock&&(s=M5.STARTING_COUNT_DOWN),new k5(r,t.turn+1,Mw.of(e),s,i)}isLegal(e,t){this.assertNonDoubleClockCall(e,t);const n=this.isLegalMove(e,t);if(n.isFailure())return ZG.failure(n.getReason());if(e.isUndoneBy(t.lastMove))return ZG.failure(A5.CANNOT_UNDO_LAST_MOVE());if(this.isFieldPromotion(e,t))return this.isLegalFieldPromotion(e,t);const r=t.getPieceAt(e.coord),i=t.captured.getCopy();if(this.isCapture(e,t)){const n=t.getCurrentPlayer();let r=i.get(n).get();const s=t.getPieceAt(e.end);r=r.add(s),i.replace(n,r),i.makeImmutable()}return ZG.success({finalPiece:r,score:i})}assertNonDoubleClockCall(e,t){nq(!1===(t.countDown.isPresent()&&e.calledTheClock),"Should not call the clock twice")}isCapture(e,t){const n=t.isInOpponentTerritory(e.end),r=t.getPieceAt(e.end)!==O5.EMPTY;return n&&r}isFieldPromotion(e,t){const n=t.isInPlayerTerritory(e.end),r=t.getPieceAt(e.end)!==O5.EMPTY;return n&&r}isLegalFieldPromotion(e,t){const n=this.getPromotedPiece(e,t);if(n.isAbsent())return ZG.failure(A5.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());const r=n.get();if(t.isTherePieceOnPlayerSide(r))return ZG.failure(A5.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());{const e={finalPiece:r,score:t.captured.getCopy()};return ZG.success(e)}}isLegalMove(e,t){if(!1===t.isInPlayerTerritory(e.coord))return ZG.failure(A5.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY());const n=t.getPieceAt(e.coord);if(n===O5.EMPTY)return ZG.failure(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(n===O5.PAWN)return e.isValidForPawn()?ZG.success(void 0):ZG.failure(b5.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP());if(n===O5.DRONE&&!1===e.isValidForDrone())return ZG.failure(b5.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS());for(const r of e.coord.getUntil(e.end))if(t.getPieceAt(r)!==O5.EMPTY)return ZG.failure(OJ.SOMETHING_IN_THE_WAY());return ZG.success(void 0)}getPromotedPiece(e,t){const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end);return O5.tryMerge(n,r)}getGameStatus(e){const t=e.gameState;if(t.countDown.equalsValue(0))return this.getGameStatusScoreVictoryOr(t,zJ.DRAW);if(t.getEmptyTerritory().isPresent()){const e=t.getCurrentOpponent(),n=zJ.getVictory(e);return this.getGameStatusScoreVictoryOr(t,n)}return zJ.ONGOING}getGameStatusScoreVictoryOr(e,t){const n=e.getScoreOf(cK.ZERO),r=e.getScoreOf(cK.ONE);return n>r?zJ.ZERO_WON:r>n?zJ.ONE_WON:t}}M5.STARTING_COUNT_DOWN=Mw.of(7);let N5=(()=>{class e{}return e.YOU_DID_NOT_CAPTURE_ANY_PIECE=()=>$localize`Failed, you did not capture any piece.`,e})();const R5=O5.EMPTY,x5=O5.PAWN,D5=O5.DRONE,L5=O5.QUEEN,F5=()=>$localize`This is not a field promotion!`;class U5{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`At Martian Chess, the goal is to have the most points at the end of the game. Each piece is assigned a value, you win this value when capturing the piece. The board is divided in two by a line called the canal. There is one side for each player. You do not own pieces, but you control the ones on your side of the canal. Pieces are colored to help you: they will change color when crossing the canal.`,k5.getInitialState()),jJ.informational($localize`The pieces`,$localize`The pieces are dark on the side of the first player, the light ones on the side of the second one. There are 3 kind of pieces: <ul><li>The Queens: represented as circles with 3 dots.</li><li>The Drones: represented as circles with 2 dots.</li><li>The Pawns: represented as circles with one dot.</li></ul>`,k5.getInitialState()),jJ.fromPredicate($localize`Moving pawns`,$localize`Pawns are worth one point. They can move one step diagonally.<br/><br/>You're playing Dark, move a pawn.`,k5.getInitialState(),P5.from(new yJ(1,2),new yJ(2,3)).get(),(e,t)=>t.getPieceAt(e.end)===O5.PAWN?QG.SUCCESS:QG.failure($localize`This is not a pawn!`),$localize`Congratulations!`),jJ.fromPredicate($localize`Moving drones`,$localize`Drones are worth two points. They can move one or two steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a drone.`,k5.getInitialState(),P5.from(new yJ(2,0),new yJ(3,0)).get(),(e,t)=>t.getPieceAt(e.end)===O5.DRONE?QG.SUCCESS:QG.failure($localize`This is not a drone!`),$localize`Congratulations!`),jJ.fromPredicate($localize`Moving queens`,$localize`Queens are worth three points. They can move any number of steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a queen.`,new k5([[D5,x5,R5,R5],[L5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,L5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[L5,D5,x5,R5]],0),P5.from(new yJ(2,3),new yJ(2,7)).get(),(e,t)=>t.getPieceAt(e.end)===O5.QUEEN?QG.SUCCESS:QG.failure($localize`This is not a queen!`),$localize`Congratulations!`),jJ.fromMove($localize`Capture`,$localize`When a piece crosses the canal and lands on another piece, you capture it and gain the value of that captured piece. However, you lose control of your piece as it crosses the canal!<br/><br/>A capture is possible for Dark, do it.`,new k5([[D5,x5,x5,R5],[R5,R5,R5,R5],[L5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,x5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,D5,x5,R5]],0),[P5.from(new yJ(0,2),new yJ(2,4)).get()],$localize`Congratulations! By capturing that pawn, you won one point.`,N5.YOU_DID_NOT_CAPTURE_ANY_PIECE()),jJ.fromMove($localize`Field Promotion (1/2)`,$localize`It is sometimes possible to perform what is called a field promotion. If you are out of one type of piece, you can merge two pieces to add their value and get a new piece. For example, if you have no drones, you can merge two pawns into a drone. To merge two pawns, move one of your pawns on another.<br/><br/>Such a move is possible for Dark. Do it.`,new k5([[R5,R5,R5,L5],[R5,x5,R5,R5],[R5,R5,x5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,L5],[R5,R5,D5,R5],[R5,x5,R5,R5]],0),[P5.from(new yJ(1,1),new yJ(2,2)).get(),P5.from(new yJ(2,2),new yJ(1,1)).get()],$localize`Congratulations!`,F5()),jJ.fromPredicate($localize`Field Promotion (2/2)`,$localize`The other kind of field promotion is to merge a drone and a pawn to obtain a queen.<br/><br/>Such a move is possible for Light. Do it.`,new k5([[x5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,D5,R5],[R5,x5,R5,R5]],1),P5.from(new yJ(1,7),new yJ(2,6)).get(),(e,t)=>t.getPieceAt(e.end)===O5.QUEEN?QG.SUCCESS:QG.failure(F5()),$localize`Congratulations!`),jJ.fromPredicate($localize`Call the clock`,$localize`When the game seems to be going nowhere, you can "call the clock" during your turn. To do so, click on the clock symbol on the right, then perform your move. Once the clock is called, seven more turn will be played.<br/><br/>You're playing Dark. Call the clock and perform a move.`,k5.getInitialState(),P5.from(new yJ(2,2),new yJ(3,3),!0).get(),(e,t)=>e.calledTheClock?QG.SUCCESS:QG.failure($localize`You did not call the clock!`),$localize`Congratulations!`),jJ.fromMove($localize`Restarting the clock`,$localize`If the clock has been called, whenever a capture is done the countdown restarts.<br/><br/>You are playing Dark, do a capture to restart the countdown.`,new k5([[R5,R5,R5,R5],[R5,x5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,x5],[R5,R5,D5,R5],[R5,x5,R5,R5]],14,Mw.empty(),Mw.of(1)),[P5.from(new yJ(1,1),new yJ(2,2)).get()],$localize`Congratulations!`,$localize`This is not a capture, the game is now over, please retry!`),jJ.anyMove($localize`End game (by clock)`,$localize`When seven turns have passed after the clock has been called, the player with the most points win. If both player have the same number of points, it is a tie.<br/><br/>You are playing Dark, do the last move.`,new k5([[R5,R5,R5,L5],[R5,x5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[D5,R5,R5,R5],[R5,R5,R5,R5],[R5,D5,R5,R5]],14,Mw.empty(),Mw.of(1)),P5.from(new yJ(1,1),new yJ(2,2)).get(),$localize`Congratulations!`),jJ.fromPredicate($localize`End by emptyness`,$localize`When a player's last piece is moved into the opponent territory, the game ends. If both players have the same number of points, the last player win!<br/><br/>Light player can win this way, do it!`,new k5([[R5,R5,R5,L5],[R5,x5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,x5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5],[R5,R5,R5,R5]],1),P5.from(new yJ(2,4),new yJ(1,3)).get(),(e,t)=>3===e.end.y?QG.SUCCESS:QG.failure($localize`Your piece is still in you territory!`),$localize`Congratulations!`)]}}function B5(e,t){if(1&e&&(Cn(),ga(0,"g",20)),2&e){const e=ba(2).index,t=ba().index,n=ba();Va(n.style),Ia("mainShapeId","pawn_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function V5(e,t){if(1&e&&(Cn(),ga(0,"g",21)),2&e){const e=ba(2).index,t=ba().index,n=ba();Va(n.style),Ia("mainShapeId","drone_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function $5(e,t){if(1&e&&(Cn(),ga(0,"g",22)),2&e){const e=ba(2).index,t=ba().index,n=ba();Va(n.style),Ia("mainShapeId","queen_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function z5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,B5,1,5,"g",17),la(2,V5,1,5,"g",18),la(3,$5,1,5,"g",19),fa()),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("transform",i.getPieceLocation(t,r)),Ts(1),ha("ngIf",n===i.pieces.PAWN),Ts(1),ha("ngIf",n===i.pieces.DRONE),Ts(1),ha("ngIf",n===i.pieces.QUEEN)}}function H5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",15),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(1,"rect",16),la(2,z5,4,4,"g",14),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ia("id","click_",n,"_",r,""),ra("transform","translate(0,  "+(r<=3?0:2*i.STROKE_WIDTH)+")"),Ts(1),Ia("id","square_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.pieces.EMPTY)}}function G5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",23),Ea("click",function(){const t=Gt(e).$implicit;return ba(3).onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(3);Ts(1),Ia("id","indicator_",e.x,"_",e.y,""),ra("transform","translate(0,  "+(e.y<=3?0:2*n.STROKE_WIDTH)+")")("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}function q5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,G5,2,7,"g",1),fa()),2&e){const e=ba(2);Ts(1),ha("ngForOf",e.selectedPieceInfo.get().legalLandings)}}function W5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,H5,3,11,"g",13),la(2,q5,2,1,"g",14),fa()),2&e){const e=t.$implicit,n=ba();ra("transform","translate("+n.SPACE_SIZE+", 0)"),Ts(1),ha("ngForOf",e),Ts(1),ha("ngIf",n.selectedPieceInfo.isPresent())}}function j5(e,t){if(1&e&&(Cn(),pa(0,"text",24),Qa(1),fa()),2&e){const e=ba();ha("ngClass","player"+e.getCurrentPlayer().value)("ngClass",e.getClockCircleClasses()),ra("x",.5*e.SPACE_SIZE)("y",.5*e.SPACE_SIZE),Ts(1),Ja(e.countDown.get())}}function Z5(e,t){if(1&e&&(Cn(),ga(0,"polyline",25)),2&e){const e=ba();ha("ngClass",e.getClockCircleClasses()),ra("points",e.clockNeedlesPoints)}}const Y5=function(e){return[e]};function K5(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"g",28),Ea("click",function(){const t=Gt(e).index;return ba(2).chooseStyle(t)}),fa(),ya()}if(2&e){const e=t.$implicit,n=t.index,r=ba(2);Ts(1),Va(e.style),ha("id",e.name)("pieceClasses",Su(5,Y5,"player"+r.getCurrentPlayer().value)),ra("transform","translate(0, "+-(n+1)*r.SPACE_SIZE+")")}}function Q5(e,t){if(1&e&&(Cn(),pa(0,"g",26),ga(1,"rect",27),la(2,K5,2,7,"ng-container",1),fa()),2&e){const e=ba();Ts(1),ra("x",0)("y",-e.listOfStyles.length*e.SPACE_SIZE)("width",1*e.SPACE_SIZE)("height",e.listOfStyles.length*e.SPACE_SIZE),Ts(1),ha("ngForOf",e.listOfStyles)}}function J5(e,t){if(1&e&&(Cn(),pa(0,"text",34),Qa(1),fa()),2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba();ha("ngClass","player"+(0===t?1:0)),ra("x",n.SPACE_SIZE/2)("y",n.SPACE_SIZE/2),Ts(1),Ja(e+" x ")}}function X5(e,t){if(1&e&&(Cn(),ga(0,"g",35)),2&e){const e=ba(3).$implicit;Va(ba().style),ha("pieceClasses",Su(3,Y5,"player"+(0===e?1:0)))}}function e6(e,t){if(1&e&&(Cn(),ga(0,"g",36)),2&e){const e=ba(3).$implicit;Va(ba().style),ha("pieceClasses",Su(3,Y5,"player"+(0===e?1:0)))}}function t6(e,t){if(1&e&&(Cn(),ga(0,"g",37)),2&e){const e=ba(3).$implicit;Va(ba().style),ha("pieceClasses",Su(3,Y5,"player"+(0===e?1:0)))}}function n6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,J5,2,4,"text",30),pa(2,"g",29),la(3,X5,1,5,"g",31),la(4,e6,1,5,"g",32),la(5,t6,1,5,"g",33),fa(),fa()),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().$implicit,i=ba();ra("transform","translate(0, "+2*t*i.SPACE_SIZE+")"),Ts(1),ha("ngIf",n>1),Ts(1),Ia("id","piece_",t,"_player_",r,""),ra("transform","translate("+i.SPACE_SIZE+", 0)"),Ts(1),ha("ngIf",0===t),Ts(1),ha("ngIf",1===t),Ts(1),ha("ngIf",2===t)}}function r6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,n6,6,8,"g",14),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",e>0)}}function i6(e,t){if(1&e&&(Cn(),pa(0,"g"),pa(1,"g",29),la(2,r6,2,1,"g",1),fa(),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),Ta("id","capture_of_player_",e,""),ra("transform","scale(0.5, 0.5) translate("+-n.SPACE_SIZE/2+", "+(n.SPACE_SIZE/2+e*(10*n.SPACE_SIZE+4*n.STROKE_WIDTH))+")"),Ts(1),ha("ngForOf",n.state.getCapturesOf(e))}}const s6=function(){return[0,1]};let o6=(()=>{class e extends IX{constructor(t){super(t),this.INDICATOR_SIZE=20,this.LEFT=e.SPACE_SIZE/-4+e.STROKE_WIDTH/-2,this.UP=-e.STROKE_WIDTH/2,this.WIDTH=6.5*e.SPACE_SIZE+e.STROKE_WIDTH,this.HEIGHT=8*e.SPACE_SIZE+3*e.STROKE_WIDTH,this.MartianChessComponent=e,this.style={shape:"Circle",points:"Horizontal Points"},this.pieces=O5,this.selectedPieceInfo=Mw.empty(),this.countDown=Mw.empty(),this.callTheClock=!1,this.displayModePanel=!1,this.listOfStyles=[{name:"Star",style:{shape:"Star",points:"Dots"}},{name:"Polygon",style:{shape:"Polygon",points:"Concentric Circles"}},{name:"Simple",style:{shape:"Circle",points:"Horizontal Points"}},{name:"Circely",style:{shape:"Circle",points:"Concentric Circles"}}],this.rules=new M5(k5),this.availableMinimaxes=[new T5(this.rules,"Martian Chess Dummy Minimax")],this.SPACE_SIZE=e.SPACE_SIZE,this.configCogTransformation=this.getConfigCogTransformation(),this.configViewTranslation=this.getConfigViewTranslation(),this.clockNeedlesPoints=this.getClockNeedlesPoints(),this.encoder=P5.encoder,this.tutorial=(new U5).tutorial,this.scores=Mw.of([0,0]),this.updateBoard()}static getRegularPolygon(t,n=0){const r=e.getRegularPolygonCoords(t,n);return e.mapCoordsToString(r)}static getNPointedStar(t,n){const r=this.getNPointedStarCoords(t,n);return e.mapCoordsToString(r)}static getNPointedStarCoords(t,n){const r=[],i=.5*e.SPACE_SIZE,s=.5*e.SPACE_SIZE;t*=2;for(let o=0;o<t;o++){const a=(o*(360/t)+n)/180*Math.PI,l=o%2==0?e.SPACE_SIZE/2:e.SPACE_SIZE/6,c=i+.8*l*Math.cos(a),u=s+.8*l*Math.sin(a);r.push(new yJ(c,u))}return r}static getRegularPolygonCoords(t,n=0){const r=[],i=.5*e.SPACE_SIZE,s=.5*e.SPACE_SIZE;for(let o=0;o<t;o++){const a=(o*(360/t)-90)/180*Math.PI,l=.5*e.SPACE_SIZE,c=i+.8*l*Math.cos(a),u=s+.8*l*Math.sin(a)+n;r.push(new yJ(c,u))}return r}static mapCoordsToString(e){let t="";for(const n of e)t+=n.x+", "+n.y+" ";return t}static getRadius(e){return this.SPACE_SIZE*e/10}getConfigViewTranslation(){return"translate("+(5.25*this.SPACE_SIZE+0)+", "+(7*this.SPACE_SIZE+0+2*this.STROKE_WIDTH)+")"}getConfigCogTransformation(){const e=this.STROKE_WIDTH,t=(this.SPACE_SIZE-e)/40;return"translate("+1*e+", "+1*e+") scale("+t+" "+t+")"}getClockNeedlesPoints(){const e=.5*this.SPACE_SIZE;return e+" "+.1*this.SPACE_SIZE+", "+e+" "+e+", "+.75*this.SPACE_SIZE+" "+e}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board;const e=this.state.getScoreOf(cK.ZERO),t=this.state.getScoreOf(cK.ONE);this.countDown=this.state.countDown,this.scores=Mw.of([e,t])}getPieceLocation(e,t){return"translate("+this.SPACE_SIZE*e+", "+this.SPACE_SIZE*t+")"}getPieceClasses(e,t){const n=new yJ(e,t),r=[];return r.push(t<=3?"player0":"player1"),this.selectedPieceInfo.isPresent()&&this.selectedPieceInfo.get().selectedPiece.equals(n)&&r.push("highlighted"),this.rules.node.move.isPresent()&&this.rules.node.move.get().end.equals(n)&&this.rules.node.mother.get().gameState.getPieceAt(n)!==O5.EMPTY&&this.rules.node.gameState.isInOpponentTerritory(new yJ(0,t))&&r.push("highlighted"),r}onClick(e,t){var n=this;return Pw(function*(){n.displayModePanel=!1;const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new yJ(e,t);return n.selectedPieceInfo.isPresent()?n.secondClick(i):n.firstClick(i)})()}firstClick(e){var t=this;return Pw(function*(){return t.isOneOfUsersPieces(e)?t.selectAsFirstPiece(e):(t.cancelMoveAttempt(),QG.SUCCESS)})()}selectAsFirstPiece(e){var t=this;return Pw(function*(){const n=t.getLegalLandings(e);return t.selectedPieceInfo=Mw.of({selectedPiece:e,legalLandings:n}),QG.SUCCESS})()}getLegalLandings(e){const t=this.state.getPieceAt(e);let n;return n=t===O5.PAWN?fJ.DIAGONALS.map(t=>e.getNext(t)):this.getValidLinearLandingSquareUntil(e,t===O5.DRONE?2:8),n.filter(t=>{const n=P5.from(e,t);return!!n.isSuccess()&&this.rules.isLegal(n.get(),this.getState()).isSuccess()})}getValidLinearLandingSquareUntil(e,t){return fJ.DIRECTIONS.flatMap(n=>{const r=[];let i=e.getNext(n),s=1;for(;i.isInRange(4,8)&&s<=t&&(r.push(i),this.getState().getPieceAt(i)===O5.EMPTY);)i=i.getNext(n),s++;return r})}secondClick(e){var t=this;return Pw(function*(){const n=t.selectedPieceInfo.get();if(n.selectedPiece.equals(e))return t.cancelMoveAttempt(),QG.SUCCESS;if(n.legalLandings.some(t=>t.equals(e))){const r=P5.from(n.selectedPiece,e,t.callTheClock);nq(r.isSuccess(),"MartianChessComponent or Rules did a mistake thinking this would have been a legal move!");const i=t.rules.node.gameState;return t.chooseMove(r.get(),i)}if(t.isOneOfUsersPieces(e))return t.selectAsFirstPiece(e);{const r=P5.from(n.selectedPiece,e,t.callTheClock);return r.isSuccess()?t.chooseMove(r.get(),t.getState()):t.cancelMove(r.getReason())}})()}isOneOfUsersPieces(e){return this.state.getPieceAt(e)!==O5.EMPTY&&this.state.isInPlayerTerritory(e)}cancelMoveAttempt(){this.selectedPieceInfo=Mw.empty(),this.callTheClock=!1}onClockClick(){var e=this;return Pw(function*(){const t=e.canUserPlay("#clockOrCountDownView");return t.isFailure()?e.cancelMove(t.getReason()):(e.getState().countDown.isAbsent()&&(e.callTheClock=!e.callTheClock),QG.SUCCESS)})()}getClockCircleClasses(){const e=["base"];return this.callTheClock&&e.push("highlighted"),this.getCurrentPlayer()===cK.ZERO?e.push("player0-stroke"):e.push("player1-stroke"),e}getSquareClasses(e,t){const n=new yJ(e,t),r=["base"];if(this.rules.node.move.isPresent()){const e=this.rules.node,i=e.move.get();i.coord.equals(n)?r.push("moved"):i.end.equals(n)&&(e.mother.get().gameState.getPieceAt(n)===O5.EMPTY||e.gameState.isInOpponentTerritory(new yJ(0,t))?r.push("moved"):r.push("captured"))}return r}onModeCogClick(){this.displayModePanel=!this.displayModePanel}chooseStyle(e){this.style=this.listOfStyles[e].style,this.displayModePanel=!1}}return e.SPACE_SIZE=100,e.STROKE_WIDTH=8,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-martian-chess"]],features:[Go],decls:15,vars:25,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["id","clockOrCountDownView",3,"click"],["x","0","y","0",1,"transparent"],["id","clockOrCountDownCircle",3,"ngClass"],["id","countDownText","class","text-giant text-center",3,"ngClass",4,"ngIf"],["class","base","stroke-linecap","round",3,"ngClass",4,"ngIf"],["id","canal",3,"ngClass"],["id","modeCogView"],["id","modeCog",3,"click"],["d","M35.497,15.111h-1.656c-0.282-0.924-0.653-1.807-1.102-2.646l1.176-1.175c1.364-1.366,1.366-3.582,0-4.949l-1.258-1.258 c-0.656-0.656-1.548-1.025-2.476-1.025l0,0c-0.93,0-1.818,0.369-2.477,1.025l-1.176,1.175c-0.838-0.446-1.721-0.817-2.645-1.102 V3.501c0-1.934-1.566-3.5-3.5-3.5h-1.778c-1.934,0-3.5,1.566-3.5,3.5v1.655c-0.923,0.282-1.807,0.653-2.645,1.102l-1.174-1.175 c-1.367-1.367-3.584-1.367-4.951,0L5.081,6.34c-1.367,1.366-1.367,3.583,0,4.949l1.174,1.175c-0.446,0.84-0.818,1.723-1.102,2.646 H3.5c-1.934,0-3.5,1.566-3.5,3.5v1.778c0,1.932,1.566,3.5,3.5,3.5h1.654c0.283,0.922,0.654,1.807,1.102,2.645l-1.175,1.176 c-1.366,1.365-1.366,3.582-0.001,4.949l1.258,1.258c0.656,0.654,1.547,1.023,2.475,1.023h0.001c0.929,0,1.818-0.369,2.475-1.023 l1.176-1.176c0.837,0.447,1.722,0.818,2.644,1.102v1.656c0,1.932,1.566,3.5,3.5,3.5h1.778c1.934,0,3.5-1.568,3.5-3.5v-1.656 c0.924-0.283,1.807-0.654,2.645-1.102l1.177,1.176c0.655,0.656,1.547,1.023,2.476,1.023c0.93,0,1.817-0.369,2.477-1.023 l1.256-1.258c1.366-1.367,1.365-3.582,0-4.949l-1.176-1.174c0.447-0.84,0.818-1.725,1.102-2.646h1.656c1.934,0,3.5-1.568,3.5-3.5 v-1.777C38.997,16.679,37.43,15.111,35.497,15.111z M19.499,27.499c-4.41,0-8-3.588-8-8c0-4.411,3.59-8,8-8c4.412,0,8,3.589,8,8 C27.499,23.911,23.911,27.499,19.499,27.499z",3,"ngClass"],["id","modePanel",4,"ngIf"],["id","captures"],[3,"id","click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"id","click"],[3,"id","ngClass"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId","style",4,"ngIf"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses"],[1,"indicator",3,"id","click"],["id","countDownText",1,"text-giant","text-center",3,"ngClass"],["stroke-linecap","round",1,"base",3,"ngClass"],["id","modePanel"],["stroke-width","8",1,"base"],["app-martian-chess-queen","",3,"id","pieceClasses","click"],[3,"id"],["class","text-giant text-center",3,"ngClass",4,"ngIf"],["app-martian-chess-pawn","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-queen","",3,"pieceClasses","style",4,"ngIf"],[1,"text-giant","text-center",3,"ngClass"],["app-martian-chess-pawn","",3,"pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses"],["app-martian-chess-queen","",3,"pieceClasses"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,W5,3,3,"g",1),pa(2,"g",2),Ea("click",function(){return t.onClockClick()}),ga(3,"rect",3),ga(4,"circle",4),la(5,j5,2,5,"text",5),la(6,Z5,1,2,"polyline",6),fa(),ga(7,"line",7),pa(8,"g",8),pa(9,"g",9),Ea("click",function(){return t.onModeCogClick()}),ga(10,"rect",3),ga(11,"path",10),fa(),la(12,Q5,3,5,"g",11),fa(),pa(13,"g",12),la(14,i6,3,3,"g",1),fa(),fa()),2&e&&(ra("viewBox",t.LEFT+" "+t.UP+" "+t.WIDTH+" "+t.HEIGHT),Ts(1),ha("ngForOf",t.board),Ts(1),ra("transform","translate("+5.25*t.SPACE_SIZE+", 0)"),Ts(1),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngClass",t.getClockCircleClasses()),ra("cx",.5*t.SPACE_SIZE)("cy",.5*t.SPACE_SIZE)("r",.4*t.SPACE_SIZE),Ts(1),ha("ngIf",t.countDown.isPresent()),Ts(1),ha("ngIf",t.countDown.isAbsent()),Ts(1),ha("ngClass","player"+t.getCurrentPlayer().value),ra("x1",t.SPACE_SIZE)("y1",5*t.SPACE_SIZE+8)("x2",5*t.SPACE_SIZE)("y2",5*t.SPACE_SIZE+8)("stroke-width",2*t.STROKE_WIDTH),Ts(1),ra("transform",t.configViewTranslation),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngClass","player"+t.getCurrentPlayer().value),ra("transform",t.configCogTransformation),Ts(1),ha("ngIf",t.displayModePanel),Ts(2),ha("ngForOf",wu(24,s6)))},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();const a6=Number.MAX_SAFE_INTEGER,l6=Number.MIN_SAFE_INTEGER;class c6 extends NJ{constructor(e,t){super(fK.copyBiArray(c6.initialBoard),e),this.turn=e,this.location=t}static getInitialState(){return new c6(0,new yJ(0,0))}}c6.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],c6.BOARD_1=[[0,+a6,-1,-1],[1,2,+a6,-1],[+l6,3,4,-1],[-1,+l6,+l6,-1]],c6.BOARD_2=[[0,+a6,-1,-1],[+a6,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],c6.BOARD_3=[[0,1,+l6,-1],[1,+l6,-1,-1],[+l6,-1,-1,-1],[-1,-1,-1,-1]],c6.BOARD_4=[[0,1,+l6,-1],[1,+l6,-1,-1],[+l6,-1,-1,-1],[-1,-1,-1,1]],c6.initialBoard=c6.BOARD_0;class u6 extends HJ{static getGameStatus(e){const t=e.gameState,n=t.getPieceAt(t.location);return n===cK.ZERO.getVictoryValue()?zJ.ZERO_WON:n===cK.ONE.getVictoryValue()?zJ.ONE_WON:t.location.equals(new yJ(3,3))?0===n?zJ.DRAW:n>0?zJ.ONE_WON:zJ.ZERO_WON:zJ.ONGOING}applyLegalMove(e,t,n){const r=new yJ(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new c6(t.turn+1,r)}isLegal(e,t){const n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?ZG.failure("incorrect move"):ZG.success(void 0)}getGameStatus(e){return u6.getGameStatus(e)}}class h6 extends xJ{constructor(e){super(),this.right=e}equals(e){return this===e||this.right===e.right}toString(){return this.right?"Move RIGHT":"Move DOWN"}}h6.RIGHT=new h6(!0),h6.DOWN=new h6(!1),h6.encoder=new class extends aK{maxValue(){return 1}decodeNumber(e){return 0===e?h6.RIGHT:h6.DOWN}encodeNumber(e){return e.right?0:1}};class d6 extends TJ{getBoardValue(e){const t=u6.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());const n=e.gameState;return new IJ(n.getPieceAt(n.location))}getListMoves(e){const t=[],n=e.gameState;return n.location.x<3&&t.push(h6.RIGHT),n.location.y<3&&t.push(h6.DOWN),t}}function p6(e,t){1&e&&(ma(0),Qa(1,"("),ya())}function f6(e,t){1&e&&(ma(0),Qa(1,")"),ya())}function g6(e,t){if(1&e&&(pa(0,"td"),la(1,p6,2,0,"ng-container",3),Qa(2),la(3,f6,2,0,"ng-container",3),fa()),2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r),Ts(1),Xa(" ",e," "),Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r)}}function m6(e,t){if(1&e&&(pa(0,"tr"),la(1,g6,4,3,"td",0),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let y6=(()=>{class e extends IX{constructor(e){super(e),this.coord=new yJ(-1,-1),this.rules=new u6(c6),this.availableMinimaxes=[new d6(this.rules,"MinimaxTestingMinimax")],this.encoder=h6.encoder}chooseRight(){var e=this;return Pw(function*(){const t=e.canUserPlay("#click_right");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(h6.RIGHT,e.rules.node.gameState)})()}chooseDown(){var e=this;return Pw(function*(){const t=e.canUserPlay("#click_down");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(h6.DOWN,e.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-minimax-testing"]],features:[Go],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(pa(0,"table"),la(1,m6,2,1,"tr",0),pa(2,"div",1),Ea("click",function(){return t.chooseRight()}),Qa(3," goRight "),fa(),pa(4,"div",2),Ea("click",function(){return t.chooseDown()}),Qa(5," goDown "),fa(),pa(6,"div"),Qa(7),fa(),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(6),Xa(" ",t.coord," "))},directives:[tp,rp],encapsulation:2}),e})();class v6 extends NJ{static getInitialState(){const e=fK.createTable(7,6,uK.NONE);return new v6(e,0)}}class _6 extends xJ{constructor(e){super(),this.x=e}static of(e){switch(e){case 0:return _6.ZERO;case 1:return _6.ONE;case 2:return _6.TWO;case 3:return _6.THREE;case 4:return _6.FOUR;case 5:return _6.FIVE;case 6:return _6.SIX;default:throw new Error("Invalid P4Move")}}equals(e){return this===e}toString(){return"P4Move("+this.x+")"}}_6.ZERO=new _6(0),_6.ONE=new _6(1),_6.TWO=new _6(2),_6.THREE=new _6(3),_6.FOUR=new _6(4),_6.FIVE=new _6(5),_6.SIX=new _6(6),_6.encoder=new class extends aK{maxValue(){return 6}encodeNumber(e){return e.x}decodeNumber(e){return _6.of(e)}};let C6=(()=>{class e{}return e.COLUMN_IS_FULL=()=>$localize`Please put your piece in an incomplete column.`,e})(),E6=(()=>{class e extends HJ{static getVictoriousCoords(t){const n=[];for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new yJ(r,i));(s===cK.ZERO.getVictoryValue()||s===cK.ONE.getVictoryValue())&&n.push(new yJ(r,i))}return n}static getBoardValueFromScratch(t){Tw(e.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:t}});let n=0;for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new yJ(r,i));if($J.getScoreStatus(s)!==FJ.DEFAULT)return Tw(e.VERBOSE,{preVictoryOrVictory:{state:t,tmpScore:s,coord:{x:r,y:i}}}),new IJ(s);n+=s}return new IJ(n)}static getLowestUnoccupiedCase(e,t){let n=0;for(;n<6&&e[n][t]===uK.NONE;)n++;return n-1}static getNumberOfFreeSpacesAndAllies(e,t,n,r,i){let s=0,o=0,a=!0,l=new yJ(t.x+n.x,t.y+n.y);for(;l.isInRange(7,6)&&3!==s;){const t=e[l.y][l.x];if(t===r)return[s,o];t===i&&a?o++:a=!1,t!==r&&t!==i&&s++,l=l.getNext(n)}return[s,o]}static getOpponent(e,t){const n=e[t.y][t.x];return nq(n.isPlayer(),"getOpponent should not be called with PlayerOrNone.NONE"),n===cK.ONE?cK.ZERO:cK.ONE}static getSquareScore(t,n){Tw(e.VERBOSE,"getSquareScore(board, "+n.x+", "+n.y+") called"),Tw(e.VERBOSE,t);let r=0;const i=e.getOpponent(t,n),s=i.getOpponent(),o=new UJ,a=new UJ;for(const l of fJ.DIRECTIONS){const r=e.getNumberOfFreeSpacesAndAllies(t,n,l,i,s);o.set(l,r[0]),a.set(l,r[1])}for(const l of[fJ.UP,fJ.UP_RIGHT,fJ.RIGHT,fJ.DOWN_RIGHT]){const i=a.get(l).get()+a.get(l.getOpposite()).get();if(i>2)return Tw(e.VERBOSE,{text:"there is some kind of victory here ("+n.x+", "+n.y+")\nline allies : "+i+"\n",board:t}),s.getVictoryValue();const c=o.get(l).get()+o.get(l.getOpposite()).get();3===c?r+=2:c>3&&(r+=c-2)}return r*s.getScoreModifier()}static getListMoves(t){Tw(e.VERBOSE,{context:"P4Rules.getListMoves",node:t});const n=t.gameState,r=[];for(let e=0;e<7;e++)if(n.getPieceAtXY(e,0)===uK.NONE){const t=_6.of(e);r.push(t)}return r}static getBoardValue(t){return Tw(e.VERBOSE,{text:"P4Rules.getBoardValue called",board:t.getCopiedBoard()}),e.getBoardValueFromScratch(t)}applyLegalMove(t,n,r){const i=t.x,s=n.getCopiedBoard(),o=e.getLowestUnoccupiedCase(s,i),a=n.turn;return s[o][i]=n.getCurrentPlayer(),new v6(s,a+1)}isLegal(t,n){return Tw(e.VERBOSE,{context:"P4Rules.isLegal",move:t.toString(),state:n}),n.getPieceAtXY(t.x,0).isPlayer()?ZG.failure(C6.COLUMN_IS_FULL()):ZG.success(void 0)}getGameStatus(t){const n=t.gameState;for(let r=0;r<7;r++)for(let t=5;t>=0&&n.board[t][r].isPlayer();t--){const i=e.getSquareScore(n.board,new yJ(r,t));if($J.getScoreStatus(i)===FJ.VICTORY)return zJ.getVictory(n.getCurrentOpponent())}return 42===n.turn?zJ.DRAW:zJ.ONGOING}}return e.VERBOSE=!1,e})();class w6 extends TJ{getListMoves(e){return E6.getListMoves(e)}getBoardValue(e){const t=e.gameState;return Tw(E6.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),E6.getBoardValue(t)}}const S6=cK.ZERO,b6=cK.ONE,P6=uK.NONE;class O6{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.
        The first player plays Dark, the second plays Light.
        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally).`,v6.getInitialState()),jJ.anyMove($localize`Dropping a piece`,$localize`Click on any space in any column.`,v6.getInitialState(),_6.THREE,$localize`As you can see, the piece falls at the bottom of the column.`),jJ.fromMove($localize`Victory`,$localize`You're playing Dark.
        Place your piece so that you create a horizontal alignment of 4 of your pieces.`,new v6([[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,b6,P6,P6,P6],[P6,P6,P6,b6,P6,P6,P6],[P6,P6,S6,S6,S6,b6,P6]],0),[_6.of(1)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`),jJ.fromMove($localize`Other victory`,$localize`You can also align 4 pieces diagonally or vertically.`,new v6([[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,P6,P6,P6,P6],[P6,P6,P6,S6,b6,P6,P6],[P6,P6,S6,S6,b6,P6,P6],[P6,S6,b6,S6,S6,P6,P6]],0),[_6.of(3),_6.of(4)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`)]}}function T6(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getSquareFillClass(e,t)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function I6(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){const t=Gt(e).index;return ba(2).onClick(t)}),ga(1,"rect",6),la(2,T6,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ta("id","click_",n,""),Ts(1),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY_CASE)}}function k6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,I6,3,6,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function A6(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.last.get().x)("y",e.SPACE_SIZE*e.last.get().y)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function M6(e,t){if(1&e&&(Cn(),ga(0,"rect",10)),2&e){const e=t.$implicit,n=ba();Ia("id","victory_coord_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let N6=(()=>{class e extends IX{constructor(e){super(e),this.EMPTY_CASE=uK.NONE,this.victoryCoords=[],this.rules=new E6(v6),this.availableMinimaxes=[new w6(this.rules,"P4Minimax")],this.encoder=_6.encoder,this.tutorial=(new O6).tutorial,this.updateBoard()}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e);if(n.isFailure())return t.cancelMove(n.getReason());const r=_6.of(e);return yield t.chooseMove(r,t.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=E6.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}showLastMove(){const e=this.rules.node.move,t=E6.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=Mw.of(new yJ(e.get().x,t))}hideLastMove(){this.last=Mw.empty()}getSquareFillClass(e,t){return[this.getPlayerClass(this.board[t][e])]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-p4"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,k6,2,1,"g",1),la(2,A6,1,4,"rect",2),la(3,M6,1,6,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.last.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class R6 extends DJ{constructor(e,t,n,r=!1){if(super(e,t),this.blockTurned=n,this.turnedClockwise=r,this.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+this.coord.toString())}static withRotation(e,t,n,r){if(n<0||3<n)throw new Error("This block do not exist: "+n);return new R6(e,t,Mw.of(n),r)}static rotationless(e,t){return new R6(e,t,Mw.empty())}toString(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}R6.encoder=new class extends oK{encodeMove(e){const t={coord:yJ.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}decodeMove(e){const t=e,n=yJ.encoder.decode(t.coord),r=Mw.ofNullable(t.blockTurned);if(r.isPresent()){const e=t.turnedClockwise;return R6.withRotation(n.x,n.y,r.get(),e)}return R6.rotationless(n.x,n.y)}};let x6=(()=>{class e{}return e.CANNOT_ROTATE_NEUTRAL_BLOCK=()=>$localize`If the quadrant to turn is neutral, please just use move without rotation.`,e.MUST_CHOOSE_BLOCK_TO_ROTATE=()=>$localize`No quadrant is neutral, you must pick a quadrant to rotate.`,e})();class D6 extends NJ{constructor(e,t){super(e,t),this.neutralBlocks=this.getBlocksNeutralities()}static getInitialState(){const e=fK.createTable(6,6,uK.NONE);return new D6(e,0)}getBlocksNeutralities(){const e=[];for(let t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}getBlockNeutrality(e){const t=D6.getBlockCenter(e),n=this.getPieceAt(t.getNext(fJ.UP,1)),r=this.getPieceAt(t.getNext(fJ.UP_LEFT,1));return this.getPieceAt(t.getNext(fJ.RIGHT,1))===n&&this.getPieceAt(t.getNext(fJ.DOWN,1))===n&&this.getPieceAt(t.getNext(fJ.LEFT,1))===n&&this.getPieceAt(t.getNext(fJ.UP_RIGHT,1))===r&&this.getPieceAt(t.getNext(fJ.DOWN_RIGHT,1))===r&&this.getPieceAt(t.getNext(fJ.DOWN_LEFT,1))===r}static getBlockCenter(e){return new yJ(1+(e%2==0?0:3),1+(e<2?0:3))}applyLegalDrop(e){const t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new D6(t,this.turn)}applyLegalMove(e){const t=this.applyLegalDrop(e),n=t.getCopiedBoard();if(e.blockTurned.isPresent()){const r=D6.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise)for(const e of D6.ROTATION_MAP){const i=e[0].getNext(r),s=e[1].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}else for(const e of D6.ROTATION_MAP){const i=e[1].getNext(r),s=e[0].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}}return new D6(n,this.turn+1)}blockIsNeutral(e){return this.neutralBlocks.includes(e)}}D6.ROTATION_MAP=[[new yJ(-1,-1),new yJ(1,-1)],[new yJ(0,-1),new yJ(1,0)],[new yJ(1,-1),new yJ(1,1)],[new yJ(1,0),new yJ(0,1)],[new yJ(1,1),new yJ(-1,1)],[new yJ(0,1),new yJ(-1,0)],[new yJ(-1,1),new yJ(-1,-1)],[new yJ(-1,0),new yJ(0,-1)]];class L6 extends HJ{static get(){return L6.singleton.isAbsent()&&(L6.singleton=Mw.of(new L6(D6))),L6.singleton.get()}applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){if(t.getPieceAt(e.coord).isPlayer())return ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE());const n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return ZG.failure(x6.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){const t=e.blockTurned.get();if(n.neutralBlocks.includes(t))return ZG.failure(x6.CANNOT_ROTATE_NEUTRAL_BLOCK())}return ZG.success(void 0)}getVictoryCoords(e){let t=[];for(const n of L6.VICTORY_SOURCE){const r=e.getPieceAt(n[0]),i=[n[0]];if(r.isPlayer()){let s=n[0].getNext(n[1]),o=!0;for(let t=0;t<3&&o;t++)e.getPieceAt(s)!==r?o=!1:(i.push(s),s=s.getNext(n[1]));if(o&&(e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i)),n[2])){const s=n[0].getPrevious(n[1],1);e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i))}}}return t}getGameStatus(e){const t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1];for(let i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?zJ.DRAW:zJ.ZERO_WON:!0===r[1]?zJ.ONE_WON:36===t.turn?zJ.DRAW:zJ.ONGOING}}L6.singleton=Mw.empty(),L6.VICTORY_SOURCE=[[new yJ(1,0),new hJ(1,1),!1],[new yJ(0,1),new hJ(1,1),!1],[new yJ(4,0),new hJ(-1,1),!1],[new yJ(5,1),new hJ(-1,1),!1],[new yJ(1,1),new hJ(1,1),!0],[new yJ(4,1),new hJ(-1,1),!0],[new yJ(0,1),new hJ(0,1),!0],[new yJ(1,1),new hJ(0,1),!0],[new yJ(2,1),new hJ(0,1),!0],[new yJ(3,1),new hJ(0,1),!0],[new yJ(4,1),new hJ(0,1),!0],[new yJ(5,1),new hJ(0,1),!0],[new yJ(1,0),new hJ(1,0),!0],[new yJ(1,1),new hJ(1,0),!0],[new yJ(1,2),new hJ(1,0),!0],[new yJ(1,3),new hJ(1,0),!0],[new yJ(1,4),new hJ(1,0),!0],[new yJ(1,5),new hJ(1,0),!0]];class F6 extends TJ{getListMoves(e){const t=[],n=e.gameState.neutralBlocks;if(0===e.gameState.turn)return F6.FIRST_TURN_MOVES;const r=this.getLegalDrops(e.gameState);for(const i of r){const r=R6.rotationless(i.x,i.y),s=e.gameState.applyLegalDrop(r),o=this.getLegalRotations(s,n);for(const e of o)t.push(R6.withRotation(i.x,i.y,e[0],e[1]));0===s.neutralBlocks.length==0&&t.push(r)}return t}getLegalDrops(e){const t=[];for(let n=0;n<6;n++)for(let r=0;r<6;r++){const i=new yJ(r,n);e.getPieceAt(i)===uK.NONE&&t.push(i)}return t}getLegalRotations(e,t){const n=0===e.neutralBlocks.length,r=[];for(let i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}getBoardValue(e){return new IJ(L6.get().getGameStatus(e).toBoardValue())}}F6.FIRST_TURN_MOVES=[R6.rotationless(0,0),R6.rotationless(1,0),R6.rotationless(2,0),R6.rotationless(0,1),R6.rotationless(1,1),R6.rotationless(0,2)];const U6=uK.NONE,B6=cK.ONE,V6=cK.ZERO;class $6{constructor(){this.tutorial=[jJ.informational($localize`Initial board`,$localize`The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate.`,D6.getInitialState()),jJ.informational($localize`Goal of the game`,$localize`The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins.`,new D6([[V6,U6,U6,V6,B6,U6],[V6,B6,U6,U6,U6,U6],[V6,U6,B6,U6,U6,U6],[V6,U6,U6,U6,U6,B6],[V6,U6,U6,U6,B6,U6],[U6,U6,U6,U6,U6,U6]],10)).withPreviousMove(R6.withRotation(0,0,0,!1)),jJ.fromPredicate($localize`Simple move`,$localize`At their turn, players put a piece on the board and possibly rotate one quadrant.
        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.
        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>
        Do it.`,new D6([[U6,U6,U6,U6,U6,U6],[U6,V6,U6,U6,B6,U6],[U6,U6,U6,U6,U6,U6],[U6,U6,U6,U6,U6,U6],[U6,B6,U6,U6,V6,U6],[U6,U6,U6,U6,U6,U6]],10),R6.rotationless(2,2),(e,t)=>e.blockTurned.isPresent()?QG.failure($localize`You have made a move with a rotation. This tutorial step is about moves without rotations!`):QG.SUCCESS,$localize`Congratulations!`),jJ.fromPredicate($localize`Move with rotation`,$localize`After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>
        Click on one of them and see the rotation!`,new D6([[U6,U6,U6,U6,U6,U6],[U6,V6,U6,U6,B6,U6],[U6,U6,U6,U6,U6,U6],[U6,U6,U6,U6,U6,U6],[U6,B6,U6,U6,V6,U6],[U6,U6,U6,U6,U6,U6]],10),R6.withRotation(0,0,0,!0),(e,t)=>e.blockTurned.isPresent()?QG.SUCCESS:QG.failure($localize`You made a move without rotation, try again!`),$localize`Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation.`)]}}function z6(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",9),Ea("click",function(){const t=Gt(e).$implicit,n=ba().$implicit,r=ba().index,i=ba().index;return ba().onClick(3*r+t,3*i+n)}),fa(),ya()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba(),i=r.index,s=r.$implicit,o=ba(),a=o.index,l=o.$implicit,c=ba();Ts(1),Ia("id","click_",3*i+e,"_",3*a+n,""),ha("ngClass",c.getSquareClasses(3*i+e,3*a+n)),ra("cx",s+2*c.STROKE_WIDTH+(e+.5)*c.SPACE_SIZE)("cy",l+2*c.STROKE_WIDTH+(n+.5)*c.SPACE_SIZE)("r",(c.SPACE_SIZE-c.STROKE_WIDTH)/2)}}const H6=function(){return[0,1,2]};function G6(e,t){1&e&&(Cn(),ma(0),la(1,z6,2,6,"ng-container",3),ya()),2&e&&(Ts(1),ha("ngForOf",wu(1,H6)))}function q6(e,t){if(1&e&&(Cn(),ma(0),ga(1,"rect",8),la(2,G6,2,2,"ng-container",3),ya()),2&e){const e=t.$implicit,n=t.index,r=ba(),i=r.index,s=r.$implicit,o=ba();Ts(1),ha("ngClass",o.getBlockClasses(n,i)),ra("x",o.STROKE_WIDTH+e)("y",o.STROKE_WIDTH+s)("rx",3*o.STROKE_WIDTH)("ry",3*o.STROKE_WIDTH)("width",o.BLOCK_WIDTH)("height",o.BLOCK_WIDTH),Ts(1),ha("ngForOf",wu(8,H6))}}const W6=function(e){return[0,e]};function j6(e,t){if(1&e&&(Cn(),ma(0),la(1,q6,3,9,"ng-container",3),ya()),2&e){const e=ba();Ts(1),ha("ngForOf",Su(1,W6,e.BLOCK_SEPARATION))}}function Z6(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba();Ia("id","currentDrop_",e.currentDrop.get().x,"_",e.currentDrop.get().y,""),ha("ngClass",e.getPlayerClass(e.rules.node.gameState.getCurrentPlayer())),ra("cx",e.getCenter(e.currentDrop.get().x))("cy",e.getCenter(e.currentDrop.get().y))("r",(e.SPACE_SIZE-e.STROKE_WIDTH)/2)}}function Y6(e,t){if(1&e){const e=va();Cn(),pa(0,"path",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().rotate(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","rotate_",e[1],"_",e[2]?"clockwise":"counterclockwise",""),ra("d",e[0])("stroke-width",2*n.STROKE_WIDTH)}}function K6(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Ia("id","victoryCoord_",e.x,"_",e.y,""),ha("ngClass",n.getSquareClasses(e.x,e.y)),ra("cx",n.getCenter(e.x))("cy",n.getCenter(e.y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)("stroke-width",n.STROKE_WIDTH)}}function Q6(e,t){if(1&e){const e=va();Cn(),pa(0,"g",13),Ea("click",function(){return Gt(e),ba().skipRotation()}),ga(1,"circle",14),ga(2,"line",15),fa()}if(2&e){const e=ba();Ts(1),ra("cx",e.BLOCK_SEPARATION)("cy",e.BLOCK_SEPARATION)("r",.75*e.SPACE_SIZE)("stroke-width",2*e.STROKE_WIDTH),Ts(1),ra("x1",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("y1",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("x2",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("y2",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("stroke-width",2*e.STROKE_WIDTH)}}let J6=(()=>{class e extends IX{constructor(e){super(e),this.arrows=[],this.victoryCoords=[],this.rules=new L6(D6),this.availableMinimaxes=[new F6(this.rules,"PentagoMinimax")],this.encoder=R6.encoder,this.tutorial=(new $6).tutorial,this.BLOCK_WIDTH=3*this.SPACE_SIZE+2*this.STROKE_WIDTH,this.BLOCK_SEPARATION=this.BLOCK_WIDTH+2*this.STROKE_WIDTH,this.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*this.SPACE_SIZE,this.ARROWS=this.generateArrowsCoord(),this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}showLastMove(){const e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{const t=e.get();this.movedBlock=t.blockTurned;const n=new yJ(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new yJ(0,0))&&this.coordBelongToBlock(t)){let e;e=t.turnedClockwise?Ow.getNonNullable(D6.ROTATION_MAP.find(e=>e[0].equals(n)))[1]:Ow.getNonNullable(D6.ROTATION_MAP.find(e=>e[1].equals(n)))[0];const r=t.blockTurned.get();e=e.getNext(new hJ(r%2==0?1:4,r<2?1:4),1),this.lastDrop=Mw.of(e)}else this.lastDrop=Mw.of(t.coord)}}coordBelongToBlock(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}hidePreviousMove(){this.lastDrop=Mw.empty(),this.movedBlock=Mw.empty(),this.victoryCoords=[]}generateArrowsCoord(){const e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}cancelMoveAttempt(){this.arrows=[],this.currentDrop=Mw.empty(),this.canSkipRotation=!1}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.board[t][e].isPlayer())return n.cancelMove(OJ.MUST_LAND_ON_EMPTY_SPACE());const i=R6.rotationless(e,t),s=n.rules.node.gameState,o=s.applyLegalDrop(i);if(4===o.neutralBlocks.length)return n.chooseMove(i,s);const a=n.rules.getGameStatus(n.rules.node);return n.canSkipRotation=o.neutralBlocks.length>0&&!1===a.isEndGame,n.currentDrop=Mw.of(new yJ(e,t)),n.displayArrows(o.neutralBlocks),QG.SUCCESS})()}getCenter(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}displayArrows(e){this.arrows=[];for(let t=0;t<4;t++)if(!1===e.includes(t)){const e=this.ARROWS.filter(e=>e[1]===t);this.arrows=this.arrows.concat(e)}}getBlockClasses(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}getSquareClasses(e,t){const n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new yJ(e,t))&&n.push("last-move"),n}rotate(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"));if(n.isFailure())return t.cancelMove(n.getReason());const r=t.currentDrop.get(),i=R6.withRotation(r.x,r.y,e[1],e[2]);return t.chooseMove(i,t.rules.node.gameState)})()}skipRotation(){var e=this;return Pw(function*(){const t=e.canUserPlay("#skipRotation");if(t.isFailure())return e.cancelMove(t.getReason());const n=e.currentDrop.get(),r=R6.rotationless(n.x,n.y);return e.chooseMove(r,e.rules.node.gameState)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-pentago"]],features:[Go],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),fa(),la(4,j6,2,3,"ng-container",3),la(5,Z6,1,6,"circle",4),la(6,Y6,1,4,"path",5),la(7,K6,1,7,"circle",6),la(8,Q6,3,9,"g",7),fa()),2&e&&(Ts(4),ha("ngForOf",Su(5,W6,t.BLOCK_SEPARATION)),Ts(1),ha("ngIf",t.currentDrop.isPresent()),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngIf",t.canSkipRotation))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class X6 extends yJ{constructor(e,t,n){if(super(e,t),this.z=n,e<0||e>3)throw new Error(`PylosCoord: Invalid X: ${e}.`);if(t<0||t>3)throw new Error(`PylosCoord: Invalid Y: ${t}.`);if(n<0||n>3)throw new Error(`PylosCoord: Invalid Z: ${n}.`);const r=4-n;if(this.isNotInRange(r,r))throw new Error(this.toString()+" is not in range.")}static encodeOptional(e){let t;return t=e.isPresent()?X6.encode(e.get())+1:0,t}static encode(e){return 16*e.x+4*e.y+e.z}static decodeToOptional(e){return 0===e?Mw.empty():Mw.of(X6.decode(e-1))}static decode(e){const t=e%4;e-=t;const n=(e/=4)%4;return e-=n,new X6(e/=4,n,t)}toString(){return"PylosCoord"+this.toShortString()}toShortString(){return"("+this.x+", "+this.y+", "+this.z+")"}equals(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}isUpperThan(e){return this.z>e.z}getLowerPieces(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");const e=this.z-1;return[new X6(this.x,this.y,e),new X6(this.x+1,this.y,e),new X6(this.x,this.y+1,e),new X6(this.x+1,this.y+1,e)]}getHigherPieces(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");const e=this.z+1,t=new yJ(this.x-1,this.y-1),n=new yJ(this.x,this.y-1),r=new yJ(this.x-1,this.y),i=new yJ(this.x,this.y),s=4-e;return[t,n,r,i].filter(e=>e.isInRange(s,s)).map(t=>new X6(t.x,t.y,e))}getNextValid(e){const t=new yJ(this.x,this.y).getNext(e),n=4-this.z;return t.isNotInRange(n,n)?Mw.empty():Mw.of(new X6(t.x,t.y,this.z))}}class e8 extends xJ{constructor(e,t,n,r){super(),this.startingCoord=e,this.landingCoord=t,this.firstCapture=n,this.secondCapture=r}static fromClimb(e,t,n){const r=Mw.of(e),i=e8.checkCaptures(n),s=new e8(r,t,i.firstCapture,i.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return s}static checkCaptures(e){let t=Mw.empty(),n=Mw.empty();if(e.length>0&&(t=Mw.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=Mw.of(e[1]),e[1].isUpperThan(e[0])&&(t=Mw.of(e[1]),n=Mw.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}static fromDrop(e,t){const n=Mw.empty(),r=e8.checkCaptures(t);return new e8(n,e,r.firstCapture,r.secondCapture)}static changeCapture(e,t){const n=e8.checkCaptures(t);return new e8(e.startingCoord,e.landingCoord,n.firstCapture,n.secondCapture)}isClimb(){return this.startingCoord.isPresent()}toString(){const e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}equals(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}e8.encoder=new class extends aK{maxValue(){return 17575999}encodeNumber(e){const t=X6.encode(e.landingCoord),n=X6.encodeOptional(e.startingCoord),r=X6.encodeOptional(e.firstCapture);return 270400*X6.encodeOptional(e.secondCapture)+4160*r+64*n+t}decodeNumber(e){const t=X6.decode(e%64);e-=e%64;const n=X6.decodeToOptional((e/=64)%65);e-=e%65;const r=X6.decodeToOptional((e/=65)%65);e-=e%65;const i=X6.decodeToOptional(e/=65);return new e8(n,t,r,i)}};class t8 extends MJ{constructor(e,t){super(t),this.boards=e}static getInitialState(){const e=fK.createTable(4,4,uK.NONE),t=fK.createTable(3,3,uK.NONE),n=fK.createTable(2,2,uK.NONE);return new t8([e,t,n,[[uK.NONE]]],0)}getPieceAt(e){return this.boards[e.z][e.y][e.x]}applyLegalMove(e){const t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:uK.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:uK.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:uK.NONE}),this.setBoardAts(t,this.turn+1)}setBoardAts(e,t){const n=[fK.copyBiArray(this.boards[0]),fK.copyBiArray(this.boards[1]),fK.copyBiArray(this.boards[2]),fK.copyBiArray(this.boards[3])];for(const r of e){const e=r.coord;n[e.z][e.y][e.x]=r.value}return new t8(n,t)}isLandable(e){if(this.getPieceAt(e).isPlayer())return!1;if(0===e.z)return!0;const t=e.getLowerPieces();for(const n of t)if(this.getPieceAt(n)===uK.NONE)return!1;return!0}isSupporting(e){if(3===e.z)return!1;const t=e.getHigherPieces();for(const n of t)if(this.getPieceAt(n).isPlayer())return!0;return!1}getPiecesRepartition(){const e={};e[uK.NONE.value]=0,e[cK.ZERO.value]=0,e[cK.ONE.value]=0;for(let t=0;t<3;t++)for(let n=0;n<4-t;n++)for(let r=0;r<4-t;r++){const i=new X6(r,n,t),s=this.getPieceAt(i);e[s.value]=1+e[s.value]}return e}}let n8=(()=>{class e{}return e.MUST_MOVE_UPWARD=()=>$localize`You must move your pieces upward.`,e.SHOULD_HAVE_SUPPORTING_PIECES=()=>$localize`Your piece must land on the board or on 4 other pieces.`,e.CANNOT_LAND=()=>$localize`You cannot land on this space.`,e.CANNOT_CAPTURE=()=>$localize`You cannot capture.`,e.INVALID_FIRST_CAPTURE=()=>$localize`Your first capture is invalid.`,e.INVALID_SECOND_CAPTURE=()=>$localize`Your second capture is invalid.`,e})();class r8 extends HJ{static getStateInfo(e){const t=[],n=[];for(let r=0;r<3;r++)for(let i=0;i<4-r;i++)for(let s=0;s<4-r;s++){const o=new X6(s,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}static getClimbingMoves(e){const t=[];for(const n of e.freeToMove)for(const r of e.landable)if(r.isUpperThan(n)&&!1===r.getLowerPieces().some(e=>n.equals(e))){const e=e8.fromClimb(n,r,[]);t.push(e)}return t}static getDropMoves(e){const t=[];for(const n of e.landable){const e=e8.fromDrop(n,[]);t.push(e)}return t}static canCapture(e,t){const n=e.getCurrentPlayer();for(const r of[gJ.UP,gJ.DOWN]){const i=t.getNextValid(r);if(i.isPresent()&&e.getPieceAt(i.get())===n)for(const t of[gJ.LEFT,gJ.RIGHT]){const s=i.get().getNextValid(t);if(s.isPresent()&&e.getPieceAt(s.get())===n){const t=r.getOpposite(),i=s.get().getNextValid(t).get();if(e.getPieceAt(i)===n)return!0}}}return!1}static getPossibleCaptures(e,t,n){const r=[],i=(e=e.filter(e=>!1===t.equalsValue(e))).concat(n);for(let s=0;s<i.length;s++){const e=i[s];r.push([e]);for(let t=s+1;t<i.length;t++)r.push([i[t],e])}return r}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}static isValidCapture(e,t,n){const r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(n=>e.getPieceAt(n).isPlayer()&&!1===n.equals(t.firstCapture.get())).length>0)}static getGameStatus(e){const t=e.gameState.getPiecesRepartition();return 15===t[cK.ZERO.value]?zJ.ONE_WON:15===t[cK.ONE.value]?zJ.ZERO_WON:zJ.ONGOING}applyLegalMove(e,t,n){return r8.applyLegalMove(e,t,n)}isLegal(e,t){if(t.getPieceAt(e.landingCoord).isPlayer())return ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE());const n=t.getCurrentOpponent();if(e.startingCoord.isPresent()){const r=e.startingCoord.get(),i=t.getPieceAt(r);if(i===n)return ZG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(i===uK.NONE)return ZG.failure(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(r.getHigherPieces().filter(n=>t.getPieceAt(n).isPlayer()||n.equals(e.landingCoord)).length>0)return ZG.failure(n8.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return ZG.failure(n8.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===r8.canCapture(t,e.landingCoord))return ZG.failure(n8.CANNOT_CAPTURE());if(!r8.isValidCapture(t,e,e.firstCapture.get()))return ZG.failure(n8.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!r8.isValidCapture(t,e,e.secondCapture.get()))return ZG.failure(n8.INVALID_SECOND_CAPTURE())}return ZG.success(void 0)}getGameStatus(e){return r8.getGameStatus(e)}}class i8 extends TJ{static getListMoves(e){const t=e.gameState,n=[],r=r8.getStateInfo(t),i=r8.getClimbingMoves(r),s=r8.getDropMoves(r),o=i.concat(s);for(const a of o){let e=[[]];r8.canCapture(t,a.landingCoord)&&(e=r8.getPossibleCaptures(r.freeToMove,a.startingCoord,a.landingCoord));for(const t of e){const e=e8.changeCapture(a,t);n.push(e)}}return n}getListMoves(e){return i8.getListMoves(e)}getBoardValue(e){const t=r8.getGameStatus(e);if(t.isEndGame)return new IJ(t.toBoardValue());{const t=e.gameState.getPiecesRepartition();return new IJ(t[cK.ZERO.value]-t[cK.ONE.value])}}}class s8 extends i8{static countStoneUsed(e){let t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}static sumMoveEmplacementByValue(e){let t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}getListMoves(e){const t=i8.getListMoves(e);return this.orderMoves(t)}orderMoves(e){return e.sort((e,t)=>{const n=12*s8.countStoneUsed(e),r=12*s8.countStoneUsed(t);return n+s8.sumMoveEmplacementByValue(e)-(r+s8.sumMoveEmplacementByValue(t))})}}const o8=uK.NONE,a8=cK.ZERO,l8=cK.ONE;class c8{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`At Pylos, the goal is to be the last to play.
        To do this, you have to save up your pieces.
        As soon as a player puts its last piece, that player loses the game immediately.
        Here is what the initial board looks like, it is a board of 4 x 4 squares.
        This board will become a pyramid, little by little.
        It will be filled by the pieces of your stock. Each player has 15 pieces.`,t8.getInitialState()),jJ.anyMove($localize`Dropping a piece`,$localize`When it is your turn, you can always drop one of your piece on an empty square.
        The gray squares are where you can drop your pieces.<br/><br/>
        Click on one of the squares to drop a piece there.`,t8.getInitialState(),e8.fromDrop(new X6(1,1,0),[]),$localize`There you go, as simple as that.`),jJ.fromMove($localize`Climbing`,$localize`When 4 pieces form a square, it is possible to put a fifth piece on top.
        However, when that happens, you can save a piece by climbing instead of dropping a piece.
        To climb:
        <ol>
            <li>Click on one of your free pieces, which should be lower than the landing square.</li>
            <li>Click on an empty landing square, higher than your selected piece.</li>
        </ol><br/>
        Go ahead, climb!`,new t8([[[a8,l8,o8,o8],[l8,a8,o8,o8],[o8,o8,o8,o8],[o8,o8,o8,a8]],[[o8,o8,o8],[o8,o8,o8],[o8,o8,o8]],[[o8,o8],[o8,o8]],[[o8]]],0),[e8.fromClimb(new X6(3,3,0),new X6(0,0,1),[])],$localize`Congratulations!<br/>
        Some important notes:
        <ol>
            <li>You cannot move a piece that is directly below another one.</li>
            <li>Of course, you cannot move the opponent's pieces.</li>
            <li>You can only climb when the landing square is higher than the starting square.</li>
        </ol>`,$localize`Failed!`),jJ.fromMove($localize`Square (1/2)`,$localize`When the piece you just moved or dropped is the fourth one of a square of your color,
        you can choose anywhere on the board one or two of your pieces.
        These pieces will be removed from the board, allowing you to save up one or two pieces.
        A chosen piece must not be directly below another piece.
        A chosen piece can be the piece you just placed.
        You're playing Dark.<br/><br/>
        Form a square, then click twice on one of the four pieces to remove only that one.`,new t8([[[a8,a8,o8,o8],[o8,a8,o8,o8],[o8,o8,o8,o8],[o8,o8,o8,o8]],[[o8,o8,o8],[o8,o8,o8],[o8,o8,o8]],[[o8,o8],[o8,o8]],[[o8]]],0),[e8.fromDrop(new X6(0,1,0),[new X6(0,0,0)]),e8.fromDrop(new X6(0,1,0),[new X6(0,1,0)]),e8.fromDrop(new X6(0,1,0),[new X6(1,0,0)]),e8.fromDrop(new X6(0,1,0),[new X6(1,1,0)])],$localize`Congratulations, you have saved up one piece.`,$localize`Failed!`),jJ.fromPredicate($localize`Square (2/2)`,$localize`You're playing Dark.<br/><br/>
        Do like in the previous step, but this time click on two different pieces.`,new t8([[[a8,a8,o8,o8],[o8,a8,o8,o8],[o8,o8,o8,o8],[o8,o8,o8,o8]],[[o8,o8,o8],[o8,o8,o8],[o8,o8,o8]],[[o8,o8],[o8,o8]],[[o8]]],0),e8.fromDrop(new X6(0,1,0),[new X6(0,0,0),new X6(1,0,0)]),(e,t)=>e.secondCapture.isPresent()?QG.SUCCESS:e.firstCapture.isPresent()?QG.failure($localize`Failed, you only captured one piece.`):QG.failure(N5.YOU_DID_NOT_CAPTURE_ANY_PIECE()),$localize`Congratulations, you have saved up two pieces.`)]}}function u8(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",4),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getPlayerPieceClass(n)),ra("cx",.5*r.SPACE_SIZE+(800-r.SPACE_SIZE)/14*e)("cy",860+(r.SPACE_SIZE+10)*n)("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)}}function h8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,u8,2,6,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function d8(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onPieceClick(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();ka("id","piece_",e,"_",t,"_",n,""),ha("ngClass",r.getPieceClasses(e,t,n)),ra("r",r.getPieceRadius(n)-r.STROKE_WIDTH)("cx",r.getPieceCx(e,t,n))("cy",r.getPieceCy(e,t,n))}}function p8(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",8),Ea("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onDrop(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();ka("id","drop_",e,"_",t,"_",n,""),ha("ngClass",r.getSquareClasses(e,t,n)),ra("width",2*r.getPieceRadius(n))("height",2*r.getPieceRadius(n))("x",r.getPieceCx(e,t,n)-r.getPieceRadius(n))("y",r.getPieceCy(e,t,n)-r.getPieceRadius(n))}}function f8(e,t){if(1&e&&(Cn(),ma(0),la(1,d8,1,7,"circle",6),la(2,p8,1,8,"ng-template",null,7,Ku),ya()),2&e){const e=ca(3),t=ba().$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ha("ngIf",i.isOccupied(t,n,r))("ngIfElse",e)}}function g8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,f8,4,2,"ng-container",5),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ha("ngIf",i.isDrawable(e,n,r))}}function m8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,g8,2,1,"g",1),fa()),2&e){const e=ba().$implicit,t=ba();Ts(1),ha("ngForOf",t.getLevelRange(e))}}function y8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,m8,2,1,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getLevelRange(e))}}function v8(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=ba();ka("id","highCapture_",e.highCapture.get().x,"_",e.highCapture.get().y,"_",e.highCapture.get().z,""),ra("width",2*e.getPieceRadius(e.highCapture.get().z))("height",2*e.getPieceRadius(e.highCapture.get().z))("x",e.getPieceCx(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))("y",e.getPieceCy(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))}}const _8=function(){return[0,1]},C8=function(){return[0,1,2]};let E8=(()=>{class e extends vJ{constructor(e){super(e),this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.lastFirstCapture=Mw.empty(),this.lastSecondCapture=Mw.empty(),this.highCapture=Mw.empty(),this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty(),this.chosenFirstCapture=Mw.empty(),this.lastMove=Mw.empty(),this.remainingPieces={0:15,1:15},this.rules=new r8(t8),this.availableMinimaxes=[new i8(this.rules,"PylosMinimax"),new s8(this.rules,"PylosOrderedMinimax")],this.encoder=e8.encoder,this.tutorial=(new c8).tutorial,this.SPACE_SIZE=this.getPieceRadius(0),this.updateBoard()}getLevelRange(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return Ow.expectToBe(e,2),[0,1]}}isDrawable(e,t,n){const r=new X6(e,t,n);return this.state.getPieceAt(r)!==uK.NONE||this.state.isLandable(r)}onPieceClick(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new X6(e,t,n);return r.state.getPieceAt(s)===r.state.getCurrentOpponent()?r.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=Mw.of(s),QG.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=Mw.of(s),QG.SUCCESS):r.chosenFirstCapture.equalsValue(s)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),s])})()}concludeMoveWithCapture(e){var t=this;return Pw(function*(){let n;return n=t.chosenStartingCoord.isAbsent()?e8.fromDrop(t.chosenLandingCoord.get(),e):e8.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(n,t.state)})()}tryMove(e,t){var n=this;return Pw(function*(){return n.cancelMove(),n.chooseMove(e,t)})()}cancelMoveAttempt(){this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty(),this.chosenFirstCapture=Mw.empty()}onDrop(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#drop_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new X6(e,t,n);return r8.canCapture(r.state,s)?(r.chosenLandingCoord=Mw.of(s),QG.SUCCESS):r.isCapturelessMoveFinished(s)?(r.chosenLandingCoord=Mw.of(s),r.concludeMoveWithCapture([])):r.cancelMove(n8.MUST_MOVE_UPWARD())})()}isCapturelessMoveFinished(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}getSquareClasses(e,t,n){const r=new X6(e,t,n);if(this.lastMove.isPresent()){const e=this.lastMove.get();if(e.firstCapture.equalsValue(r)||e.secondCapture.equalsValue(r))return["captured"];if(r.equals(e.landingCoord)||e.startingCoord.equalsValue(r))return["moved"]}return[]}getPieceRadius(e){return 90+5*e}getPieceCx(e,t,n){return 100+100*n+200*e}getPieceCy(e,t,n){return 100+100*n+200*t}isOccupied(e,t,n){const r=new X6(e,t,n),i=this.rules.node.gameState.getPieceAt(r).isPlayer(),s=this.chosenLandingCoord.equalsValue(r);return i||s}getPieceClasses(e,t,n){const r=new X6(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}getPieceFillClass(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}getPlayerPieceClass(e){return this.getPlayerClass(cK.of(e))}getPlayerSidePieces(e){const t=this.remainingPieces[e],n=[];for(let r=0;r<t;r++)n.push(r);return n}updateBoard(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;const e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=Mw.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.lastFirstCapture=Mw.empty(),this.lastSecondCapture=Mw.empty(),this.chosenFirstCapture=Mw.empty(),this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty())}showLastMove(){const e=this.lastMove.get();this.lastLandingCoord=Mw.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}isDrawableCoord(e){return this.isDrawable(e.x,e.y,e.z)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-pylos"]],features:[Go],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,h8,2,1,"g",1),ga(2,"rect",2),la(3,y8,2,1,"g",1),la(4,v8,1,7,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",wu(3,_8)),Ts(2),ha("ngForOf",wu(4,C8)),Ts(1),ha("ngIf",t.highCapture.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class w8{constructor(e){this.value=e}static fromInt(e){if(0<=e&&e<=15)return w8.pieces[e];if(16===e)return w8.EMPTY;throw new Error("Invalid piece ("+e+")")}equals(e){return this===e}toString(){return"QuartoPiece("+this.value+")"}isRectangle(){return this.value%4<2}}w8.AAAA=new w8(0),w8.AAAB=new w8(1),w8.AABA=new w8(2),w8.AABB=new w8(3),w8.ABAA=new w8(4),w8.ABAB=new w8(5),w8.ABBA=new w8(6),w8.ABBB=new w8(7),w8.BAAA=new w8(8),w8.BAAB=new w8(9),w8.BABA=new w8(10),w8.BABB=new w8(11),w8.BBAA=new w8(12),w8.BBAB=new w8(13),w8.BBBA=new w8(14),w8.BBBB=new w8(15),w8.EMPTY=new w8(16),w8.pieces=[w8.AAAA,w8.AAAB,w8.AABA,w8.AABB,w8.ABAA,w8.ABAB,w8.ABBA,w8.ABBB,w8.BAAA,w8.BAAB,w8.BABA,w8.BABB,w8.BBAA,w8.BBAB,w8.BBBA,w8.BBBB];class S8 extends DJ{constructor(e,t,n){super(e,t),this.piece=n}toString(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}equals(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}S8.encoder=new class extends aK{maxValue(){return 496}encodeNumber(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}decodeNumber(e){const t=e%32;e-=t;const n=(e/=32)%4;return e-=n,new S8(e/=4,n,w8.fromInt(t))}};class b8 extends NJ{constructor(e,t,n){super(e,t),this.pieceInHand=n}static getInitialState(){const e=fK.createTable(4,4,w8.EMPTY);return new b8(e,0,w8.AAAA)}static isGivable(e,t,n){return e!==n&&!1===b8.isAlreadyOnBoard(e,t)}static isAlreadyOnBoard(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}getRemainingPieces(){const e=w8.pieces,t=[];for(const n of e)b8.isGivable(n,this.board,this.pieceInHand)&&t.push(n);return t}}let P8=(()=>{class e{}return e.MUST_GIVE_A_PIECE=()=>$localize`You must give a piece.`,e.PIECE_ALREADY_ON_BOARD=()=>$localize`That piece is already on the board.`,e.CANNOT_GIVE_PIECE_IN_HAND=()=>$localize`You cannot give the piece that was in your hands.`,e})();class O8{constructor(e){this.subCriterion=[Mw.empty(),Mw.empty(),Mw.empty(),Mw.empty()],this.subCriterion[0]=Mw.of(8==(8&e.value)),this.subCriterion[1]=Mw.of(4==(4&e.value)),this.subCriterion[2]=Mw.of(2==(2&e.value)),this.subCriterion[3]=Mw.of(1==(1&e.value))}mergeWith(e){let t=4;for(let n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=Mw.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}mergeWithQuartoPiece(e){const t=new O8(e);return this.mergeWith(t)}areAllAbsent(){for(let e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}match(e){for(let t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}matchPiece(e){return this.match(new O8(e))}toString(){return"Criterion{"+this.subCriterion.map(e=>e.isPresent()?e.get()?"1":"0":"x").join(" ")+"}"}}class T8{constructor(e,t){this.initialCoord=e,this.direction=t}allCoords(){const e=[];for(let t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}class I8 extends HJ{static isOccupied(e){return e!==w8.EMPTY}static isLegal(e,t){const n=e.coord.x,r=e.coord.y,i=e.piece,s=t.getCopiedBoard(),o=t.pieceInHand;return I8.isOccupied(s[r][n])?QG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE()):i===w8.EMPTY?15===t.turn?QG.SUCCESS:QG.failure(P8.MUST_GIVE_A_PIECE()):b8.isAlreadyOnBoard(i,s)?QG.failure(P8.PIECE_ALREADY_ON_BOARD()):o===i?QG.failure(P8.CANNOT_GIVE_PIECE_IN_HAND()):QG.SUCCESS}isLegal(e,t){return I8.isLegal(e,t).toFallible(void 0)}applyLegalMove(e,t){const n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new b8(n,t.turn+1,e.piece)}static updateBoardStatus(e,t,n){return n.score===FJ.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:FJ.VICTORY,sensitiveSquares:new e1}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}static isThereAVictoriousLine(e,t){let n=e.initialCoord,r=t.getPieceAt(n);const i=new O8(r);for(let s=0;s<3&&!1!==I8.isOccupied(r)&&!i.areAllAbsent();s++)n=n.getNext(e.direction,1),r=t.getPieceAt(n),i.mergeWithQuartoPiece(r);return!(!I8.isOccupied(r)||i.areAllAbsent())}static searchForVictoryOrPreVictoryInLine(e,t,n){const r=I8.getLineInfos(e,t,n);if(r.boardStatus.isPresent())return r.boardStatus.get();const i=r.commonCriterion,s=r.sensitiveCoord;if(i.isPresent()&&!1===i.get().areAllAbsent()){if(s.isAbsent())return{score:FJ.VICTORY,sensitiveSquares:new e1};{i.get().matchPiece(t.pieceInHand)&&(n.score=FJ.PRE_VICTORY);const e=s.get();n.sensitiveSquares.add(e)}}return n}static getLineInfos(e,t,n){let r=Mw.empty(),i=Mw.empty(),s=e.initialCoord;for(let o=0;o<4;o++){const o=t.getPieceAt(s);if(o===w8.EMPTY){if(!r.isAbsent())return{sensitiveCoord:Mw.of(s),commonCriterion:i,boardStatus:Mw.of(n)};r=Mw.of(s)}else i.isAbsent()?(i=Mw.of(new O8(o)),Tw(I8.VERBOSE,"set commonCrit to "+i.toString())):(i.get().mergeWithQuartoPiece(o),Tw(I8.VERBOSE,"update commonCrit: "+i.toString()));s=s.getNext(e.direction,1)}return{commonCriterion:i,sensitiveCoord:r,boardStatus:Mw.empty()}}static scoreToGameStatus(e,t){const n=cK.of(t%2);return e===FJ.VICTORY?zJ.getDefeat(n):16===t?zJ.DRAW:zJ.ONGOING}getGameStatus(e){const t=e.gameState;let n={score:FJ.DEFAULT,sensitiveSquares:new e1};for(const r of I8.lines)if(n=I8.updateBoardStatus(r,t,n),n.score===FJ.VICTORY)return I8.scoreToGameStatus(n.score,t.turn);return I8.scoreToGameStatus(n.score,t.turn)}getVictoriousCoords(e){for(const t of I8.lines)if(I8.isThereAVictoriousLine(t,e))return t.allCoords();return[]}}I8.VERBOSE=!1,I8.lines=[new T8(new yJ(0,0),fJ.DOWN),new T8(new yJ(1,0),fJ.DOWN),new T8(new yJ(2,0),fJ.DOWN),new T8(new yJ(3,0),fJ.DOWN),new T8(new yJ(0,0),fJ.RIGHT),new T8(new yJ(0,1),fJ.RIGHT),new T8(new yJ(0,2),fJ.RIGHT),new T8(new yJ(0,3),fJ.RIGHT),new T8(new yJ(0,0),fJ.DOWN_RIGHT),new T8(new yJ(0,3),fJ.UP_RIGHT)];class k8 extends TJ{static scoreToBoardValue(e,t){if(e===FJ.DEFAULT)return new IJ(0);{const n=cK.of(t%2);return new IJ(e===FJ.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),s=n.pieceInHand;let o;for(let a=0;a<4;a++)for(let e=0;e<4;e++)if(r[a][e]===w8.EMPTY){if(o=n.getCopiedBoard(),o[a][e]=s,15===n.turn){const n=new S8(e,a,w8.EMPTY);return t.push(n),t}for(const n of i){const r=new S8(e,a,n);t.push(r)}}return t}getBoardValue(e){const t=e.gameState;let n={score:FJ.DEFAULT,sensitiveSquares:new e1};for(const r of I8.lines)if(n=I8.updateBoardStatus(r,t,n),n.score===FJ.VICTORY)break;return k8.scoreToBoardValue(n.score,t.turn)}}const A8=w8.AABA,M8=w8.AABB,N8=w8.ABAA,R8=w8.ABAB,x8=w8.ABBA,D8=w8.BAAA,L8=w8.BAAB,F8=w8.BABB,U8=w8.BBAA,B8=w8.BBAB,V8=w8.BBBA,$8=w8.BBBB,z8=w8.EMPTY;class H8{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`Quarto is an alignment game.
        The goal is to align four pieces that have at least one common aspect:
        <ul>
          <li>their color (light or dark),</li>
          <li>their size (big or small),</li>
          <li>their pattern (empty or dotted),</li>
          <li>their shape (round or square).</li>
        </ul>
        Here, we have a board with a victory by an alignment of dark pieces.`,new b8([[V8,U8,N8,A8],[z8,z8,z8,z8],[z8,z8,z8,z8],[z8,z8,z8,z8]],7,w8.ABAB)),jJ.anyMove($localize`Placement`,$localize`Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,
        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.
        If you prefer, the order of these two steps can be reversed.
        Keep in mind that the second click confirms the move.<br/><br/>
        Make a move.`,new b8([[V8,M8,x8,z8],[z8,z8,z8,z8],[z8,D8,z8,z8],[z8,z8,z8,z8]],7,w8.ABAA),new S8(2,2,w8.BAAB),$localize`Perfect!`),jJ.fromMove($localize`Situation`,$localize`We have here a tricky situation.<br/><br/>
        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move.`,new b8([[$8,V8,B8,z8],[N8,F8,U8,z8],[R8,D8,L8,z8],[z8,z8,z8,z8]],7,w8.AABA),[new S8(3,3,w8.AABB)],$localize`Well done!`,$localize`Failed!`)]}}function G8(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(t.value)),ra("x",i.SPACE_SIZE*n+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("y",i.SPACE_SIZE*r+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("width",2*i.getPieceSize(t.value))("height",2*i.getPieceSize(t.value))}}function q8(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(t.value)),ra("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(t.value))}}function W8(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function j8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,G8,1,5,"rect",9),la(2,q8,1,4,"ng-template",null,10,Ku),la(4,W8,1,3,"circle",3),fa()),2&e){const e=ca(3),t=ba().$implicit,n=ba(2);Ts(1),ha("ngIf",t.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",n.pieceHasDot(t.value))}}function Z8(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().chooseCoord(t,n)}),fa(),la(2,j8,5,3,"g",3),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","chooseCoord_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function Y8(e,t){if(1&e&&(Cn(),pa(0,"g",null,7),la(2,Z8,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(2),ha("ngForOf",e)}}function K8(e,t){if(1&e&&(Cn(),ga(0,"rect",15)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("y",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function Q8(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",e.getPieceSize(e.pieceInHand.value))}}function J8(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2);ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",10)}}function X8(e,t){if(1&e&&(Cn(),pa(0,"g",null,12),ga(2,"rect",13),la(3,K8,1,5,"rect",14),la(4,Q8,1,4,"ng-template",null,10,Ku),la(6,J8,1,3,"circle",3),fa()),2&e){const e=ca(5),t=ba();ra("transform","translate("+t.chosen.get().x*t.SPACE_SIZE+" "+t.chosen.get().y*t.SPACE_SIZE+")"),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function e7(e,t){if(1&e&&(Cn(),pa(0,"g",null,16),ga(2,"rect",17),fa()),2&e){const e=t.$implicit,n=ba();Ts(2),ra("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)("transform","translate("+e.x*n.SPACE_SIZE+" "+e.y*n.SPACE_SIZE+")")}}function t7(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",0)("y",.75*e.SPACE_SIZE)("transform","translate("+-e.getPieceSize(e.pieceInHand.value)+", "+-e.getPieceSize(e.pieceInHand.value)+")")("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function n7(e,t){if(1&e&&(Cn(),ga(0,"circle",19)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cy",.75*e.SPACE_SIZE)("r",e.getPieceSize(e.pieceInHand.value))}}function r7(e,t){1&e&&(Cn(),ga(0,"circle",20)),2&e&&ra("cy",.75*ba(2).SPACE_SIZE)("r",10)}function i7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,t7,1,6,"rect",9),la(2,n7,1,3,"ng-template",null,10,Ku),la(4,r7,1,2,"circle",18),fa()),2&e){const e=ca(3),t=ba();Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function s7(e,t){if(1&e&&(Cn(),ga(0,"rect",27)),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("x",n.SPACE_SIZE*e)("y",n.SPACE_SIZE*t)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function o7(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(4*t+e)),ra("x",n.SPACE_SIZE*e+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("y",n.SPACE_SIZE*t+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("width",2*n.getPieceSize(4*t+e))("height",2*n.getPieceSize(4*t+e))}}function a7(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(4*t+e)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.getPieceSize(4*t+e))}}function l7(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function c7(e,t){if(1&e){const e=va();Cn(),pa(0,"g",25),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().choosePiece(4*n+t)}),la(1,s7,1,4,"rect",26),la(2,o7,1,5,"rect",9),la(3,a7,1,4,"ng-template",null,10,Ku),la(5,l7,1,3,"circle",3),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ta("id","choosePiece_",4*n+t,""),Ts(1),ha("ngIf",r.pieceToGive.value===4*n+t),Ts(1),ha("ngIf",(4*n+t)%4<2)("ngIfElse",e),Ts(3),ha("ngIf",r.pieceHasDot(4*n+t))}}function u7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,c7,6,5,"g",24),fa()),2&e){const e=t.index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isRemaining(4*n+e))}}function h7(e,t){if(1&e&&(Cn(),pa(0,"g",null,21),ga(2,"rect",22,23),la(4,u7,2,1,"g",2),fa()),2&e){const e=t.$implicit,n=ba();ra("transform","translate(0 "+6.5*n.SPACE_SIZE+")"),Ts(2),ra("x",-.125*n.SPACE_SIZE)("y",-.125*n.SPACE_SIZE)("width",4.25*n.SPACE_SIZE)("height",4.25*n.SPACE_SIZE),Ts(2),ha("ngForOf",e)}}let d7=(()=>{class e extends IX{constructor(e){super(e),this.EMPTY=w8.EMPTY,this.chosen=Mw.empty(),this.lastMove=Mw.empty(),this.pieceInHand=w8.EMPTY,this.pieceToGive=w8.EMPTY,this.victoriousCoords=[],this.rules=new I8(b8),this.availableMinimaxes=[new k8(this.rules,"QuartoMinimax")],this.encoder=S8.encoder,this.tutorial=(new H8).tutorial,this.pieceInHand=this.rules.node.gameState.pieceInHand,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=Mw.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(e=>e.coord)}chooseCoord(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#chooseCoord_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.hideLastMove(),n.board[t][e]===w8.EMPTY){if(n.showPieceInHandOnBoard(e,t),15===n.rules.node.gameState.turn){const r=new S8(e,t,w8.EMPTY);return n.chooseMove(r,n.rules.node.gameState)}if(n.pieceToGive===w8.EMPTY)return QG.SUCCESS;{const r=new S8(e,t,n.pieceToGive);return n.chooseMove(r,n.rules.node.gameState)}}return n.cancelMove(OJ.MUST_CLICK_ON_EMPTY_SPACE())})()}choosePiece(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#choosePiece_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.hideLastMove(),t.pieceToGive=w8.fromInt(e),t.chosen.isAbsent())return QG.SUCCESS;{const e=t.chosen.get(),n=new S8(e.x,e.y,t.pieceToGive);return t.chooseMove(n,t.rules.node.gameState)}})()}hideLastMove(){this.lastMove=Mw.empty()}cancelMoveAttempt(){this.hideLastMove(),this.pieceToGive=w8.EMPTY}showPieceInHandOnBoard(e,t){this.chosen=Mw.of(new yJ(e,t))}isRemaining(e){return b8.isGivable(w8.fromInt(e),this.board,this.pieceInHand)}getSquareClasses(e,t){const n=new yJ(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}getPieceClasses(e){const t=[];return t.push(e%2==0?"player0":"player1"),t}getPieceSize(e){return e<8?40:25}pieceHasDot(e){return e!==w8.EMPTY.value&&e%8<4}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-quarto"]],features:[Go],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",1),la(2,Y8,3,1,"g",2),la(3,X8,7,6,"g",3),la(4,e7,3,3,"g",2),pa(5,"g",null,4),ga(7,"rect",5,6),la(9,i7,5,3,"g",3),fa(),la(10,h7,5,6,"g",2),fa(),fa()),2&e&&(ra("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosen.isPresent()),Ts(1),ha("ngForOf",t.victoriousCoords),Ts(1),ra("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),Ts(2),ra("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),Ts(2),ha("ngIf",t.chosen.isAbsent()),Ts(1),ha("ngForOf",t.board))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),p7=(()=>{class e{}return e.NO_INSIDE_CLICK=()=>$localize`You must pick a space from the edge of the board.`,e})();class f7 extends DJ{constructor(e,t,n){super(e,t),this.direction=n;const r=f7.isValidCoord(this.coord);if(r.isFailure())throw new Error(r.getReason());if(0===e&&n===gJ.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&n===gJ.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===t&&n===gJ.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===t&&n===gJ.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.")}static isValidCoord(e){return e.isNotInRange(5,5)?QG.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?QG.failure(p7.NO_INSIDE_CLICK()):QG.SUCCESS}toString(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}f7.encoder=new class extends aK{maxValue(){return 128}encodeNumber(e){const t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}decodeNumber(e){const t=gJ.factory.fromInt(e%4).get();e-=e%4;const n=(e/=4)%5;return e-=e%5,new f7(e/=5,n,t)}};class g7 extends NJ{static getInitialState(){const e=fK.createTable(5,5,uK.NONE);return new g7(e,0)}applyLegalMove(e){const t=this.getCopiedBoard(),n=this.turn+1;let r=e.coord,i=e.coord.getNext(e.direction);for(;i.isInRange(5,5);)t[r.y][r.x]=t[i.y][i.x],r=r.getNext(e.direction),i=i.getNext(e.direction);return t[r.y][r.x]=this.getCurrentPlayer(),new g7(t,n)}}class m7 extends HJ{static getVerticalCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new yJ(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new yJ(4,r));return n}static getHorizontalCenterCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new yJ(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new yJ(r,4));return n}static getPossibleDirections(e){const t=[];return 0!==e.x&&t.push(gJ.LEFT),0!==e.y&&t.push(gJ.UP),4!==e.x&&t.push(gJ.RIGHT),4!==e.y&&t.push(gJ.DOWN),t}static getLinesSums(e){const t={};t[cK.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[cK.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(let n=0;n<5;n++)for(let r=0;r<5;r++){const i=e.getPieceAtXY(r,n);if(i.isPlayer()){const e=i.value;t[e].columns[r]=t[e].columns[r]+1,t[e].rows[n]=t[e].rows[n]+1,r===n&&(t[e].diagonals[0]=t[e].diagonals[0]+1),r+n===4&&(t[e].diagonals[1]=t[e].diagonals[1]+1)}}return t}static getVictoriousCoords(e){const t=m7.getLinesSums(e),n=[];for(let r=0;r<2;r++){for(let e=0;e<5;e++){if(5===t[r].columns[e])for(let t=0;t<5;t++)n.push(new yJ(e,t));if(5===t[r].rows[e])for(let t=0;t<5;t++)n.push(new yJ(t,e))}if(5===t[r].diagonals[0])for(let e=0;e<5;e++)n.push(new yJ(e,e));if(5===t[r].diagonals[1])for(let e=0;e<5;e++)n.push(new yJ(e,4-e))}return n}static getFullestLine(e){const t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max(...t)}applyLegalMove(e,t,n){return m7.applyLegalMove(e,t,n)}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?ZG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):ZG.success(void 0)}getGameStatus(e){const t=e.gameState,n=m7.getLinesSums(t),r=m7.getFullestLine(n[cK.ZERO.value]),i=m7.getFullestLine(n[cK.ONE.value]),s=t.getCurrentPlayer();return 5===r&&(s===cK.ZERO||i<5)?zJ.ZERO_WON:5===i?zJ.ONE_WON:zJ.ONGOING}}class y7 extends TJ{getListMoves(e){const t=[],n=m7.getVerticalCoords(e),r=m7.getHorizontalCenterCoords(e).concat(n);for(const i of r){const e=m7.getPossibleDirections(i);for(const n of e){const e=new f7(i.x,i.y,n);t.push(e)}}return t}getBoardValue(e){const t=e.gameState,n=m7.getLinesSums(t),r=m7.getFullestLine(n[cK.ZERO.value]),i=m7.getFullestLine(n[cK.ONE.value]),s=t.getCurrentPlayer();return new IJ(5===r&&(s===cK.ZERO||i<5)?cK.ZERO.getVictoryValue():5===i?cK.ONE.getVictoryValue():i-r)}}class v7{static getArrowTransform(e,t,n){let r,i,s;switch(n){case gJ.UP:r=0,i=-1,s=-90;break;case gJ.DOWN:r=0,i=1,s=90;break;case gJ.LEFT:r=-1,i=0,s=180;break;default:Ow.expectToBe(n,gJ.RIGHT),r=1,i=0,s=0}return[`translate(${t.x*e+e/2+r*e/4} ${t.y*e+e/2+i*e/4})`,"scale(2.5)",`rotate(${s})`].join(" ")}}const _7=uK.NONE,C7=cK.ZERO,E7=cK.ONE;class w7{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game.`,$localize`At Quixo, the goal is to align 5 of your pieces.
        The first player plays with dark pieces, the second with light pieces.
        The board is made of 25 spaces spread over a 5x5 square.
        Every piece has a neutral side, a light side, and a dark side.`,g7.getInitialState()),jJ.fromMove($localize`What a move looks like (without animation)`,$localize`When it is your turn:
        <ol>
            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.
                You can only choose a piece from the edge of the board.</li>
            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>
        </ol>
        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.
        Once on the other side, all pieces will move by one space in the opposing direction.
        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>
        For example, take the bottom right neutral piece, and move it to the left (you're playing Light).`,new g7([[_7,_7,_7,_7,_7],[_7,_7,_7,_7,_7],[_7,_7,_7,_7,_7],[_7,_7,_7,_7,_7],[C7,C7,C7,C7,_7]],1),[new f7(4,4,gJ.LEFT)],$localize`See how the four dark pieces have been moved one space to the right.
        The neutral piece has been move 4 pieces to the left and has become light.`,$localize`Failed!`),jJ.fromMove($localize`Victory`,$localize`You already know everything you need in order to play, but there is one last particularity.
        If you create a line of 5 of your pieces, you win.
        If you create a line of 5 of your opponent's pieces, you lose.
        If you create both, you lose too!<br/><br/>
        You can win with this board, try it.
        You're playing Light.`,new g7([[_7,E7,_7,E7,E7],[_7,C7,C7,_7,C7],[E7,E7,E7,C7,E7],[C7,_7,C7,E7,E7],[E7,C7,_7,E7,C7]],31),[new f7(3,0,gJ.DOWN)],$localize`Congratulations, you won!`,$localize`Failed!`)]}}function S7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getPieceClasses(e,n)),ra("cx",50+100*e)("cy",50+100*n)}}function b7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,S7,2,5,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function P7(e,t){if(1&e){const e=va();Cn(),pa(0,"use",6),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ta("id","chooseDirection_",e,""),ra("transform",n.getArrowTransform(n.chosenCoord.get(),e))}}function O7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,P7,1,2,"use",5),fa()),2&e){const e=ba();Ts(1),ha("ngForOf",e.getPossiblesDirections())}}let T7=(()=>{class e extends IX{constructor(e){super(e),this.lastMoveCoord=Mw.empty(),this.chosenCoord=Mw.empty(),this.victoriousCoords=[],this.rules=new m7(g7),this.availableMinimaxes=[new y7(this.rules,"QuixoMinimax")],this.encoder=f7.encoder,this.tutorial=(new w7).tutorial,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(e=>e.coord),this.victoriousCoords=m7.getVictoriousCoords(this.state)}cancelMoveAttempt(){this.chosenCoord=Mw.empty()}getPieceClasses(e,t){const n=new yJ(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(e=>e.equals(n))&&r.push("victory-stroke"),r}onBoardClick(e,t){const n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=new yJ(e,t),i=f7.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=Mw.of(r),QG.SUCCESS)}getPossiblesDirections(){const e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}chooseDirection(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#chooseDirection_"+e);return n.isFailure()?t.cancelMove(n.getReason()):(t.chosenDirection=gJ.factory.fromString(e).get(),yield t.tryMove())})()}tryMove(){var e=this;return Pw(function*(){const t=e.chosenCoord.get(),n=new f7(t.x,t.y,e.chosenDirection);return e.cancelMove(),e.chooseMove(n,e.rules.node.gameState)})()}getArrowTransform(e,t){return v7.getArrowTransform(this.SPACE_SIZE,e,gJ.factory.fromString(t).get())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-quixo"]],features:[Go],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),fa(),la(3,b7,2,1,"g",2),la(4,O7,2,1,"g",3),fa()),2&e&&(Ts(3),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),I7=(()=>{class e extends NJ{static getInitialState(){const t=fK.createTable(e.BOARD_WIDTH,e.BOARD_HEIGHT,uK.NONE);return t[3][3]=cK.ZERO,t[4][4]=cK.ZERO,t[3][4]=cK.ONE,t[4][3]=cK.ONE,new e(t,0)}static getNeighbooringPawnLike(e,t,n,r){let i;const s=[];for(let o=-1;o<2;o++)for(let a=-1;a<2;a++)i=new yJ(n+a,r+o),i.isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&s.push(i);return s}countScore(){const t=[0,0];for(let n=0;n<e.BOARD_HEIGHT;n++)for(let r=0;r<e.BOARD_WIDTH;r++){const e=this.board[n][r];e.isPlayer()&&(t[e.value]+=1)}return t}}return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e})();class k7 extends DJ{equals(e){return e===this||e.coord.equals(this.coord)}toString(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}k7.encoder=new class extends aK{maxValue(){return(I7.BOARD_HEIGHT-1)*I7.BOARD_WIDTH+(I7.BOARD_WIDTH-1)}encodeNumber(e){return e.coord.y*I7.BOARD_WIDTH+e.coord.x}decodeNumber(e){const t=e%I7.BOARD_WIDTH;return new k7(t,(e-t)/I7.BOARD_WIDTH)}},k7.PASS=new k7(-1,-1),k7.PASS_NUMBER=k7.encoder.encodeNumber(k7.PASS);let A7=(()=>{class e{}return e.NO_ELEMENT_SWITCHED=()=>$localize`Your move should switch at least one piece.`,e})();class M7{constructor(e,t){this.move=e,this.switched=t}}let N7=(()=>{class e extends HJ{static getGameStatus(t){const n=t.gameState;if(!1===e.isGameEnded(n))return zJ.ONGOING;const r=n.countScore(),i=r[1]-r[0];return i<0?zJ.ZERO_WON:i>0?zJ.ONE_WON:zJ.DRAW}applyLegalMove(e,t,n){const r=t.turn,i=t.getCurrentPlayer(),s=t.getCopiedBoard();if(e.equals(k7.PASS))return new I7(s,r+1);for(const o of n)s[o.y][o.x]=i;return s[e.coord.y][e.coord.x]=i,new I7(s,r+1)}static getAllSwitcheds(t,n,r){const i=[],s=n.getOpponent();for(const o of fJ.DIRECTIONS){const a=t.coord.getNext(o);if(a.isInRange(I7.BOARD_WIDTH,I7.BOARD_HEIGHT)&&r[a.y][a.x]===s){const t=e.getSandwicheds(n,o,a,r);for(const e of t)i.push(e)}}return i}static getSandwicheds(e,t,n,r){const i=[n];let s=n.getNext(t);for(;s.isInRange(I7.BOARD_WIDTH,I7.BOARD_HEIGHT);){const n=r[s.y][s.x];if(n===e)return i;if(n===uK.NONE)return[];i.push(s),s=s.getNext(t)}return[]}static isGameEnded(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}getGameStatus(t){return e.getGameStatus(t)}static playerCanOnlyPass(e){const t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(k7.PASS)}static nextPlayerCantOnlyPass(e){const t=e.getCopiedBoard(),n=new I7(t,e.turn+1);return this.playerCanOnlyPass(n)}static getListMoves(t){const n=[];let r;const i=t.getCurrentPlayer(),s=t.getCurrentOpponent();for(let o=0;o<8;o++)for(let a=0;a<8;a++)if(t.getPieceAtXY(a,o)===uK.NONE&&(r=t.getCopiedBoard(),I7.getNeighbooringPawnLike(r,s,a,o).length>0)){const s=new k7(a,o),l=e.getAllSwitcheds(s,i,r);if(l.length>0){for(const e of l)nq(i!==t.getPieceAt(e),e+"was already switched!"),r[e.y][e.x]=i;r[o][a]=i,n.push(new M7(s,l.length))}}return 0===n.length&&n.push(new M7(k7.PASS,0)),n}isLegal(t,n){if(t.equals(k7.PASS))return e.playerCanOnlyPass(n)?ZG.success([]):ZG.failure(OJ.MUST_PASS());if(n.getPieceAt(t.coord).isPlayer())return Tw(e.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),ZG.failure(OJ.MUST_CLICK_ON_EMPTY_SPACE());const r=n.getCopiedBoard(),i=e.getAllSwitcheds(t,n.getCurrentPlayer(),r);return Tw(e.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?ZG.failure(A7.NO_ELEMENT_SWITCHED()):ZG.success(i)}}return e.VERBOSE=!1,e})();class R7 extends TJ{getBoardValue(e){const t=N7.getGameStatus(e);if(t.isEndGame)return IJ.fromWinner(t.winner);const n=e.gameState.getCopiedBoard();let r=0,i=0;for(let s=0;s<I7.BOARD_HEIGHT;s++)for(let e=0;e<I7.BOARD_WIDTH;e++){const t=(0===e||e===I7.BOARD_WIDTH-1?4:1)*(0===s||s===I7.BOARD_HEIGHT-1?4:1);n[s][e]===cK.ZERO&&(r+=t),n[s][e]===cK.ONE&&(i+=t)}return r*=cK.ZERO.getScoreModifier(),i*=cK.ONE.getScoreModifier(),new IJ(i+r)}getListMoves(e){const t=N7.getListMoves(e.gameState);return fK.sortByDescending(t,e=>R7.bestCoords.some(t=>e.move.coord.equals(t))?100:e.switched),t.map(e=>e.move)}}R7.bestCoords=[new yJ(0,0),new yJ(0,I7.BOARD_HEIGHT-1),new yJ(I7.BOARD_WIDTH-1,0),new yJ(I7.BOARD_WIDTH-1,I7.BOARD_HEIGHT-1)];const x7=uK.NONE,D7=cK.ZERO,L7=cK.ONE;class F7{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.
        When one piece is flipped, its owner changes.
        The player owning the most pieces at the end of the game wins.
        Here, Dark has 28 points and Light has 36, hence Light wins.`,new I7([[D7,D7,D7,D7,D7,D7,D7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,D7,D7,D7,D7,D7,D7,D7]],60)),jJ.anyMove($localize`Capture (1/2)`,$localize`At the beginning of the game, pieces are placed as shown here.
        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>
        Do any move by clicking to put your piece
        Dark plays first.`,I7.getInitialState(),new k7(2,4),$localize`Congratulations!`),jJ.fromMove($localize`Capture (2/2)`,$localize`A move can also capture a bigger line, and more than one lines at a time
        You're playing light here.<br/><br/>
        Play on the bottom left to see an example.`,new I7([[x7,x7,x7,x7,x7,x7,x7,x7],[x7,x7,x7,x7,x7,x7,x7,x7],[x7,x7,x7,x7,x7,x7,x7,x7],[x7,x7,x7,x7,L7,x7,x7,x7],[x7,x7,x7,D7,x7,x7,x7,x7],[x7,x7,D7,x7,x7,x7,x7,x7],[D7,D7,x7,x7,x7,x7,x7,x7],[x7,D7,L7,D7,L7,D7,x7,x7]],1),[new k7(0,7)],$localize`Congratulations!`,$localize`Lower and more to the left, please.`),jJ.informational($localize`Passing a turn`,$localize`If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass
        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way.`,new I7([[L7,D7,D7,D7,D7,D7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[D7,L7,L7,L7,L7,L7,L7,D7],[L7,L7,L7,L7,L7,L7,x7,x7],[D7,D7,D7,D7,D7,D7,x7,x7]],60))]}}function U7(e,t){if(1&e&&(Cn(),ga(0,"circle",4)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClass(e,t)),ra("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)}}function B7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,U7,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function V7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,B7,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let $7=(()=>{class e extends IX{constructor(e){super(e),this.EMPTY=uK.NONE,this.lastMove=new yJ(-2,-2),this.captureds=[],this.scores=Mw.of([2,2]),this.rules=new N7(I7),this.availableMinimaxes=[new R7(this.rules,"ReversiMinimax")],this.encoder=k7.encoder,this.tutorial=(new F7).tutorial,this.canPass=!1,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new k7(e,t);return yield n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new yJ(-2,-2),this.scores=Mw.of(e.countScore()),this.canPass=N7.playerCanOnlyPass(e)}showPreviousMove(){this.lastMove=this.rules.node.move.get().coord;const e=this.rules.node.gameState.getCurrentPlayer(),t=this.rules.node.gameState.getCurrentOpponent();for(const n of fJ.DIRECTIONS){let r=this.lastMove.getNext(n,1);for(;r.isInRange(I7.BOARD_WIDTH,I7.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(r)===t&&this.rules.node.mother.get().gameState.getPieceAt(r)===e;)this.captureds.push(r),r=r.getNext(n,1)}}getRectClasses(e,t){const n=new yJ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:n.equals(this.lastMove)?["moved"]:[]}getPieceClass(e,t){return this.getPlayerClass(this.board[t][e])}pass(){var e=this;return Pw(function*(){return nq(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(k7.PASS.coord.x,k7.PASS.coord.y)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-reversi"]],features:[Go],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,V7,2,1,"g",1),fa()),2&e&&(ra("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board))},directives:[tp,Xd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),z7=(()=>{class e extends O1{static getInitialState(){const t=CJ.UNREACHABLE,n=CJ.ZERO,r=CJ.ONE,i=CJ.EMPTY;return new e([[t,t,n,r,i,i,i,n,r,t,t],[t,i,i,i,i,i,i,i,i,i,t],[r,i,i,i,i,i,i,i,i,i,n],[n,i,i,i,i,i,i,i,i,i,r],[t,i,i,i,i,i,i,i,i,i,t],[t,t,r,n,i,i,i,r,n,t,t]],0)}}return e.HEIGHT=6,e.WIDTH=11,e})(),H7=(()=>{class e{}return e.CAN_ONLY_REBOUND_ON_BLACK=()=>$localize`You can only rebound on dark spaces.`,e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=()=>$localize`You can only rebound on empty spaces.`,e.MUST_CHOOSE_PYRAMID_FIRST=()=>$localize`You must pick one of your pyramids first.`,e.MUST_CHOOSE_OWN_PYRAMID=()=>$localize`You must pick one of your pyramids.`,e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=()=>$localize`Those two spaces are not neighbors.`,e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=()=>$localize`Those two spaces have no intermediary neighbor.`,e})();class G7 extends UX{constructor(e,t){super(e,t)}static checkDistanceAndLocation(e,t){const n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return QG.failure(OJ.MOVE_CANNOT_BE_STATIC());if(1===n){const n=P1.getFakeNeighbors(e);if(t.equals(n))return QG.failure(H7.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return QG.failure($localize`You can move one or two spaces, not ${n}.`);if((e.x+e.y)%2==0)return QG.failure(H7.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return QG.failure(H7.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return QG.SUCCESS}static from(e,t){if(!e.isInRange(z7.WIDTH,z7.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(z7.WIDTH,z7.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");const n=G7.checkDistanceAndLocation(e,t);return n.isFailure()?n.toFailedFallible():ZG.success(new G7(e,t))}isSimpleStep(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"SaharaMove("+this.coord+"->"+this.end+")"}}G7.encoder=new class extends aK{maxValue(){return 396*z7.WIDTH+66*z7.HEIGHT+6*z7.WIDTH+z7.HEIGHT}encodeNumber(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}decodeNumber(e){const t=e%6;e-=t;const n=(e/=6)%11;e-=n;const r=(e/=11)%6;return e-=r,G7.from(new yJ(e/=6,r),new yJ(n,t)).get()}};let q7=(()=>{class e extends HJ{static getStartingCoords(e,t){const n=[];for(let r=0;r<z7.HEIGHT;r++)for(let i=0;i<z7.WIDTH;i++)e[r][i].is(t)&&n.push(new yJ(i,r));return n}static getBoardValuesFor(t,n){const r=e.getStartingCoords(t,n),i=[];for(const e of r){const n=O1.getEmptyNeighbors(t,e,CJ.EMPTY).length;if(0===n)return[0];i.push(n)}return i.sort((e,t)=>e-t)}applyLegalMove(t,n,r){Tw(e.VERBOSE,"Legal move "+t.toString()+" applied");const i=n.getCopiedBoard();return i[t.end.y][t.end.x]=i[t.coord.y][t.coord.x],i[t.coord.y][t.coord.x]=CJ.EMPTY,new z7(i,n.turn+1)}isLegal(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return ZG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==CJ.EMPTY)return ZG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE());const n=P1.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===CJ.EMPTY?ZG.success(void 0):ZG.failure(H7.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):ZG.success(void 0)}getGameStatus(t){const n=t.gameState.getCopiedBoard(),r=e.getBoardValuesFor(n,cK.ZERO),i=e.getBoardValuesFor(n,cK.ONE);return e.getGameStatusFromFreedoms(r,i)}static getGameStatusFromFreedoms(e,t){return 0===e[0]?zJ.ONE_WON:0===t[0]?zJ.ZERO_WON:zJ.ONGOING}}return e.VERBOSE=!1,e})();class W7 extends TJ{getListMoves(e){const t=[],n=e.gameState.getCopiedBoard(),r=e.gameState.getCurrentPlayer(),i=q7.getStartingCoords(n,r);for(const s of i){const e=O1.getEmptyNeighbors(n,s,CJ.EMPTY);for(const r of e){const e=G7.from(s,r).get();if(n[r.y][r.x]=n[s.y][s.x],n[s.y][s.x]=CJ.EMPTY,t.push(e),(r.y+r.x)%2==0){const e=O1.getEmptyNeighbors(n,r,CJ.EMPTY);for(const i of e)if(!i.equals(s)){const e=G7.from(s,i).get();n[i.y][i.x]=n[r.y][r.x],n[r.y][r.x]=CJ.EMPTY,t.push(e),n[r.y][r.x]=n[i.y][i.x],n[i.y][i.x]=CJ.EMPTY}}n[s.y][s.x]=n[r.y][r.x],n[r.y][r.x]=CJ.EMPTY}}return t}getBoardValue(e){const t=e.gameState.getCopiedBoard(),n=q7.getBoardValuesFor(t,cK.ZERO),r=q7.getBoardValuesFor(t,cK.ONE),i=q7.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return IJ.fromWinner(i.winner);let s=0;for(;s<6&&n[s]===r[s];)s++;return new IJ(r[s%6]-n[s%6])}}const j7=CJ.UNREACHABLE,Z7=CJ.ZERO,Y7=CJ.ONE,K7=CJ.EMPTY;class Q7{constructor(){this.tutorial=[jJ.informational($localize`Initial board`,$localize`Shr is played on a board where each space is a triangle.
        Each player has six pyramids.`,z7.getInitialState()),jJ.informational($localize`Goal of the game`,$localize`At Shr, the goal of the game is to immobilize one of the opponent's pyramids.
        To do so, you have to occupy all neighboring space of that pyramid.
        Here, Light has lost because its leftmost pyramid is immobilized.`,new z7([[j7,j7,K7,K7,Y7,K7,K7,Z7,Y7,j7,j7],[j7,K7,K7,K7,K7,K7,K7,K7,K7,K7,j7],[Y7,Z7,K7,K7,K7,K7,K7,K7,K7,K7,Z7],[Z7,K7,K7,K7,K7,K7,K7,K7,K7,K7,Y7],[j7,K7,K7,K7,K7,K7,K7,K7,K7,K7,j7],[j7,j7,Y7,Z7,K7,K7,K7,Y7,Z7,j7,j7]],3)),jJ.fromPredicate($localize`Simple step`,$localize`To immobilize your opponent, you have to move your pyramids.
        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).
        You're the first player, playing with the dark pyramids.
        <ol>
            <li>Click on one of your pyramids.</li>
            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>
        </ol><br/>
        Do any simple step.`,z7.getInitialState(),G7.from(new yJ(2,0),new yJ(2,1)).get(),(e,t)=>e.isSimpleStep()?QG.SUCCESS:QG.failure($localize`You have made a double step, which is good but it is the next exercise!`),$localize`Congratulations!`),jJ.fromPredicate($localize`Double step`,$localize`When a pyramid shares its vertices with dark spaces, it can move one or two steps.
        To do so:
        <ol>
            <li>Click on the pyramid to move.</li>
            <li>Click on one of the 6 destinations that you can reach in two steps:
                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.
        </ol>`,z7.getInitialState(),G7.from(new yJ(7,0),new yJ(5,0)).get(),(e,t)=>e.isSimpleStep()?QG.failure($localize`Failed! You have made a single step.`):QG.SUCCESS,$localize`Congratulations!`)]}}function J7(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",6),fa()),2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.getPlayerClassFor(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function X7(e,t){if(1&e&&(Cn(),ga(0,"polyline",9)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function e9(e,t){if(1&e&&(Cn(),ga(0,"polyline",10)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function t9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,X7,1,1,"polyline",7),la(2,e9,1,1,"polyline",8),fa()),2&e){const e=ba().index,t=ba().index;Ts(1),ha("ngIf",(e+t)%2==1),Ts(1),ha("ngIf",(e+t)%2==0)}}function n9(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),la(1,J7,2,2,"g",2),la(2,t9,3,2,"g",2),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",t.index,"_",ba().index,""),Ts(1),ha("ngIf",e.isPlayer()),Ts(1),ha("ngIf",2===e.value)}}function r9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,n9,3,4,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function i9(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",11),ga(2,"polyline",11),ya()),2&e){const e=ba();Ts(1),ra("points",e.getTriangleCoordinate(e.lastCoord.get().x,e.lastCoord.get().y)),Ts(1),ra("points",e.getTriangleCoordinate(e.lastMoved.get().x,e.lastMoved.get().y))}}function s9(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}let o9=(()=>{class e extends E1{constructor(e){super(e),this.lastCoord=Mw.empty(),this.lastMoved=Mw.empty(),this.chosenCoord=Mw.empty(),this.rules=new q7(z7),this.availableMinimaxes=[new W7(this.rules,"SaharaMinimax")],this.encoder=G7.encoder,this.tutorial=(new Q7).tutorial,this.updateBoard()}cancelMoveAttempt(){this.chosenCoord=Mw.empty()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t)})()}choosePiece(e,t){return this.board[t][e]===CJ.EMPTY?this.cancelMove(H7.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=Mw.of(new yJ(e,t)),QG.SUCCESS):this.cancelMove(H7.MUST_CHOOSE_OWN_PYRAMID())}chooseLandingCoord(e,t){var n=this;return Pw(function*(){const r=new yJ(e,t),i=n.rules.node.gameState.getCurrentPlayer(),s=CJ.ofPlayer(i);if(n.board[t][e]===s)return n.chosenCoord=Mw.of(new yJ(e,t)),QG.SUCCESS;const o=G7.from(n.chosenCoord.get(),r);return o.isFailure()?n.cancelMove(o.getReason()):yield n.chooseMove(o.get(),n.rules.node.gameState)})()}updateBoard(){this.chosenCoord=Mw.empty();const e=this.rules.node.move;this.lastCoord=e.map(e=>e.coord),this.lastMoved=e.map(e=>e.end),this.board=this.rules.node.gameState.board}getPlayerClassFor(e,t){return this.getPlayerClass(cK.of(this.board[t][e].value))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-sahara"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,r9,2,1,"g",1),la(2,i9,3,2,"ng-container",2),la(3,s9,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMoved.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class a9 extends DJ{constructor(e,t,n,r){super(e,t),this.x=e,this.y=t,this.moveDirection=n,this.landingOrientation=r,this.checkValidity()}checkValidity(){const e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}isRotation(){return this.moveDirection.isAbsent()}equals(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}toString(){const e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}isInsertion(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}a9.encoder=new class extends aK{maxValue(){return 2408}encodeNumber(e){const t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}decodeNumber(e){const t=e%7;e-=t;const n=(e/=7)%7;e-=n;const r=(e/=7)%5,i=4===r?Mw.empty():gJ.factory.fromInt(r).toOptional();e-=r;const s=gJ.factory.fromInt(e/=5).get();return new a9(n-1,t-1,i,s)}};class l9{constructor(e){this.value=e}static decode(e){switch(e){case 0:return l9.EMPTY;case 1:return l9.WHITE_UP;case 2:return l9.WHITE_RIGHT;case 3:return l9.WHITE_DOWN;case 4:return l9.WHITE_LEFT;case 5:return l9.BLACK_UP;case 6:return l9.BLACK_RIGHT;case 7:return l9.BLACK_DOWN;case 8:return l9.BLACK_LEFT;case 9:return l9.MOUNTAIN}}belongTo(e){return e===cK.ZERO?1<=this.value&&this.value<=4:5<=this.value&&this.value<=8}isEmptyOrMountain(){return 0===this.value||9===this.value}isPiece(){return!this.isEmptyOrMountain()}getOwner(){return 1<=this.value&&this.value<=4?cK.ZERO:5<=this.value&&this.value<=8?cK.ONE:uK.NONE}getOptionalDirection(){switch(this.value){case 0:return Mw.empty();case 1:case 5:return Mw.of(gJ.UP);case 2:case 6:return Mw.of(gJ.RIGHT);case 3:case 7:return Mw.of(gJ.DOWN);case 4:case 8:return Mw.of(gJ.LEFT);default:return Ow.expectToBe(this.value,9),Mw.empty()}}static of(e,t){return t===cK.ZERO?e===gJ.UP?l9.WHITE_UP:e===gJ.RIGHT?l9.WHITE_RIGHT:e===gJ.DOWN?l9.WHITE_DOWN:l9.WHITE_LEFT:e===gJ.UP?l9.BLACK_UP:e===gJ.RIGHT?l9.BLACK_RIGHT:e===gJ.DOWN?l9.BLACK_DOWN:l9.BLACK_LEFT}getDirection(){return this.getOptionalDirection().get()}toString(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return Ow.expectToBe(this.value,9),"MOUNTAIN"}}}l9.EMPTY=new l9(0),l9.WHITE_UP=new l9(1),l9.WHITE_RIGHT=new l9(2),l9.WHITE_DOWN=new l9(3),l9.WHITE_LEFT=new l9(4),l9.BLACK_UP=new l9(5),l9.BLACK_RIGHT=new l9(6),l9.BLACK_DOWN=new l9(7),l9.BLACK_LEFT=new l9(8),l9.MOUNTAIN=new l9(9);class c9 extends NJ{static getInitialState(){const e=fK.createTable(5,5,l9.EMPTY);return e[2][1]=l9.MOUNTAIN,e[2][2]=l9.MOUNTAIN,e[2][3]=l9.MOUNTAIN,new c9(e,0)}countPlayerPawn(){let e=0;for(let t=0;t<5;t++)for(let n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}let u9=(()=>{class e{}return e.CANNOT_INSERT_WHEN_SELECTED=()=>$localize`You cannot insert a piece when you have already selected a piece.`,e.NO_REMAINING_PIECE_TO_INSERT=()=>$localize`You cannot insert a piece, all your pieces are already on the board.`,e.NOT_ENOUGH_FORCE_TO_PUSH=()=>$localize`You do not have enough strength to push.`,e.ILLEGAL_ROTATION=()=>$localize`You cannot push and turn at the same time.`,e.ILLEGAL_PUSH=()=>$localize`Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board.`,e.MUST_INSERT_OR_CHOOSE_YOUR_PIECE=()=>$localize`You should insert or choose one of your pieces!`,e})();class h9{constructor(e,t){this.resultingBoard=e,this.moved=t}}let d9=(()=>{class e extends HJ{isLegal(t,n){if(Tw(e.VERBOSE,{SiamRules_isLegal:{move:t,state:n}}),!t.isInsertion()&&!n.getPieceAt(t.coord).belongTo(n.getCurrentPlayer()))return ZG.failure(OJ.MUST_CHOOSE_PLAYER_PIECE());if(t.isRotation())return Tw(e.VERBOSE,"Move is rotation"),this.isLegalRotation(t,n);{let r;if(t.isInsertion()){Tw(e.VERBOSE,"Move is insertion");const i=this.isLegalInsertion(t.coord,n);if(i.legal.isFailure())return ZG.failure(i.legal.getReason());r=i.insertedPiece}else Tw(e.VERBOSE,"Move is forward"),r=n.getPieceAt(t.coord);return e.isLegalForwarding(t,n,r)}}isLegalInsertion(t,n){const r=n.countPlayerPawn(),i=n.getCurrentPlayer(),s=r<5?QG.SUCCESS:QG.failure(u9.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:e.getInsertedPiece(t,i),legal:s}}static getInsertedPiece(e,t){return l9.of(-1===e.x?gJ.RIGHT:-1===e.y?gJ.DOWN:5===e.x?gJ.LEFT:gJ.UP,t)}static isLegalForwarding(t,n,r){Tw(e.VERBOSE,{isLegalForwarding:{move:t.toString(),state:n,firstPiece:r}});const i=[];let s=l9.of(t.landingOrientation,n.getCurrentPlayer());const o=t.moveDirection.get();let a=t.coord.getNext(o);if(a.isInRange(5,5)&&n.getPieceAt(a)!==l9.EMPTY&&!1===e.isStraight(r,t))return Tw(e.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),ZG.failure(u9.ILLEGAL_PUSH());let l=Mw.of(o);const c=o.getOpposite();let u=0;const h=n.getCopiedBoard();t.coord.isInRange(5,5)&&(h[t.coord.y][t.coord.x]=l9.EMPTY,i.push(t.coord));let d=a.isInRange(5,5)&&s!==l9.EMPTY;for(;d;){l.equalsValue(o)?u++:l.equalsValue(c)&&u--,Tw(e.VERBOSE,{totalForce:u,movingPiece:s,landingCoord:a});const t=h[a.y][a.x];t===l9.MOUNTAIN&&(u-=.9),h[a.y][a.x]=s,i.push(a),s=t,a=a.getNext(o),l=s.getOptionalDirection(),d=a.isInRange(5,5)&&s!==l9.EMPTY&&u>0}return a.isNotInRange(5,5)&&(Tw(e.VERBOSE,"This movement would push "+s+" outside the board"),l.equalsValue(o)?u++:l.equalsValue(c)&&u--),u<=0?(Tw(e.VERBOSE,"This move is an illegal push: "+h),ZG.failure(u9.NOT_ENOUGH_FORCE_TO_PUSH())):(Tw(e.VERBOSE,"This move is a legal push: "+h),ZG.success(new h9(h,i)))}static isStraight(e,t){const n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}isLegalRotation(t,n){Tw(e.VERBOSE,{isLegalRotation:{rotation:t,state:n}});const r=t.coord,i=n.getPieceAt(r),s=n.getCurrentPlayer();if(i.getDirection()===t.landingOrientation)return ZG.failure(u9.ILLEGAL_ROTATION());const o=n.getCopiedBoard();return o[r.y][r.x]=l9.of(t.landingOrientation,s),ZG.success(new h9(o,[r]))}applyLegalMove(e,t,n){const r=fK.copyBiArray(n.resultingBoard);return new c9(r,t.turn+1)}static getBoardValueInfo(t,n){const r=e.getMountainsRowsAndColumns(n),i=r.rows,s=r.columns,o=e.getWinner(n,t,r.nbMountain);if(o.isPlayer())return o===cK.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER};{const t=e.getPushers(n,s,i);let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const a=n.getCurrentPlayer();for(const e of t)e.coord.isInRange(5,5)?n.getPieceAt(e.coord).belongTo(cK.ZERO)?r=Math.min(r,e.distance):o=Math.min(o,e.distance):a===cK.ZERO?r=Math.min(r,e.distance):o=Math.min(o,e.distance);return{shortestZero:r,shortestOne:o,boardValue:e.getScoreFromShortestDistances(r,o,a)}}}static getScoreFromShortestDistances(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);const r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}static getMountainsRowsAndColumns(e){const t=[],n=[];let r=0;for(let i=0;i<5;i++)for(let s=0;s<5;s++)e.getPieceAtXY(s,i)===l9.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(s)||n.push(s),r++);return{rows:t,columns:n,nbMountain:r}}static getWinner(t,n,r){return 2===r?e.getPusher(t,n.get()):uK.NONE}static getPusher(t,n){const r=n.coord;let i;i=r.isInRange(5,5)?t.getPieceAt(r.getNext(n.landingOrientation)):e.getInsertedPiece(r,t.getCurrentOpponent());const s=i.getDirection(),o=e.getPusherCoord(t,s,r),a=t.getPieceAt(o).getOwner();return Tw(e.VERBOSE,r.toString()+" belong to "+t.getCurrentOpponent().value+", "+o.toString()+" belong to "+a.value+", "+a.value+" win"),a}static getPusherCoord(e,t,n){let r=n.getNext(t),i=n;for(;r.isInRange(5,5);){n=r,r=r.getNext(t);const s=e.getPieceAt(n);s!==l9.MOUNTAIN&&s.getDirection()===t&&(i=n)}return i}static getPushers(t,n,r){Tw(e.VERBOSE,{getPushers:{state:t,mountainsColumn:n,mountainsRow:r}});let i=[];const s=[];for(const e of n){let t=gJ.DOWN,n=new yJ(e,4);s.push({direction:t,fallingCoord:n}),t=gJ.UP,n=new yJ(e,0),s.push({direction:t,fallingCoord:n})}for(const e of r){let t=gJ.LEFT,n=new yJ(0,e);s.push({direction:t,fallingCoord:n}),t=gJ.RIGHT,n=new yJ(4,e),s.push({direction:t,fallingCoord:n})}for(const o of s)i=e.addPotentialDirectionPusher(t,o.fallingCoord,o.direction,i);return i}static addPotentialDirectionPusher(t,n,r,i){const s=e.getLineClosestPusher(t,n,r);if(s.isAbsent())return i;const o=s.get(),a=o.distance;return Tw(e.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:a}),i}static getLineClosestPusher(t,n,r){Tw(e.VERBOSE,{getDirectionClosestPusher:{state:t,fallingCoord:n,direction:r.toString()}});const i=r.getOpposite();let s=1,o=t.getPieceAt(n),a=n,l=Mw.empty(),c=!1,u=!1,h=0;for(;a.isInRange(5,5)&&!1===c;){const e=t.getPieceAt(a);if(e.isEmptyOrMountain())e===l9.MOUNTAIN?(h+=.9,u=!0):s++;else{const t=e.getDirection();t===r?u&&(h-=1,h<=0&&(c=!0,a=a.getNext(r))):t===i?(h+=1,u||s++):u?(l=Mw.of(a),o!==l9.EMPTY&&s++):s++}o=e,a=a.getPrevious(r)}if(!1===c&&l.isPresent())for(s++,h-=1;!1===a.equals(l.get());)a=a.getNext(r),s--;return a.isNotInRange(5,5)&&(h-=1,5===t.countPlayerPawn())||h>0?Mw.empty():Mw.of({distance:s,coord:a})}static getPushingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[];for(let s=0;s<5;s++)r.push(new a9(-1,s,Mw.of(gJ.RIGHT),gJ.RIGHT)),i.push(l9.of(gJ.RIGHT,n)),r.push(new a9(5,s,Mw.of(gJ.LEFT),gJ.LEFT)),i.push(l9.of(gJ.LEFT,n)),r.push(new a9(s,-1,Mw.of(gJ.DOWN),gJ.DOWN)),i.push(l9.of(gJ.DOWN,n)),r.push(new a9(s,5,Mw.of(gJ.UP),gJ.UP)),i.push(l9.of(gJ.UP,n));for(let s=0;s<r.length;s++)this.isLegalForwarding(r[s],e.gameState,i[s]).isSuccess()&&t.push(r[s]);return t}static getDerapingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer();let r,i,s;for(let o=1;o<=3;o++)r=new a9(-1,o,Mw.of(gJ.RIGHT),gJ.UP),i=l9.of(gJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new a9(-1,o,Mw.of(gJ.RIGHT),gJ.DOWN),i=l9.of(gJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new a9(5,o,Mw.of(gJ.LEFT),gJ.UP),i=l9.of(gJ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new a9(5,o,Mw.of(gJ.LEFT),gJ.DOWN),i=l9.of(gJ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));for(let o=1;o<=3;o++)r=new a9(o,-1,Mw.of(gJ.DOWN),gJ.LEFT),i=l9.of(gJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new a9(o,-1,Mw.of(gJ.DOWN),gJ.RIGHT),i=l9.of(gJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new a9(o,5,Mw.of(gJ.UP),gJ.LEFT),i=l9.of(gJ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new a9(o,5,Mw.of(gJ.UP),gJ.RIGHT),i=l9.of(gJ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));return t}static getCoordDirection(e,t,n){const r=new yJ(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}getGameStatus(t){const n=e.getMountainsRowsAndColumns(t.gameState),r=e.getWinner(t.gameState,t.move,n.nbMountain);return r.isPlayer()?zJ.getVictory(r):zJ.ONGOING}}return e.VERBOSE=!1,e})();class p9 extends TJ{getBoardValue(e){return new IJ(d9.getBoardValueInfo(e.move,e.gameState).boardValue)}getListMoves(e){let t=[];const n=e.gameState.getCurrentPlayer();let r;for(let i=0;i<5;i++)for(let s=0;s<5;s++)if(r=e.gameState.getPieceAtXY(s,i),r.belongTo(n)){const o=r.getDirection();for(const a of gJ.ORTHOGONALS){if(a!==o){const r=e.gameState.getCopiedBoard(),o=new a9(s,i,Mw.empty(),a);r[i][s]=l9.of(a,n),t.push(o)}let l;l=new yJ(s+a.x,i+a.y).isInRange(5,5)?gJ.ORTHOGONALS:[a];for(const n of l){const o=new a9(s,i,Mw.of(a),n);d9.isLegalForwarding(o,e.gameState,r).isSuccess()&&t.push(o)}}}return e.gameState.countPlayerPawn()<5&&(t=t.concat(d9.getPushingInsertions(e)),t=t.concat(d9.getDerapingInsertions(e))),Tw(d9.VERBOSE,{getListMovesResult:t}),t}}const f9=l9.EMPTY,g9=l9.MOUNTAIN,m9=l9.WHITE_UP,y9=l9.WHITE_LEFT,v9=l9.WHITE_RIGHT,_9=l9.WHITE_DOWN,C9=l9.BLACK_UP,E9=l9.BLACK_LEFT,w9=l9.BLACK_RIGHT,S9=l9.BLACK_DOWN;class b9{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`The goal at Siam is to be the first to push a mountain out of the board.
        The initial board contains three mountains, and no pieces are initially on the board.
        During its turn, a player can do one of the following three actions:
        <ol>
            <li>Put a new piece on the board.</li>
            <li>Change the orientation of one of its piece, and optionally move it.</li>
            <li>Take one of its pieces out of the board.</li>
        </ol>`,c9.getInitialState()),jJ.anyMove($localize`Inserting a piece`,$localize`Each player has 5 pieces in total.
        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:
        <ol>
            <li>Click on one of the big arrows alongside the board.</li>
            <li>Click on one of the small arrows that appeared on the landing square of your piece.
                This is the direction in which your piece will be oriented.</li>
        </ol><br/>
        Insert a piece on the board.`,c9.getInitialState(),new a9(2,-1,Mw.of(gJ.DOWN),gJ.DOWN),$localize`Congratulations!`),jJ.fromMove($localize`Moving a piece`,$localize`We will distinguish here "moving" and "pushing".
        A move is made from a piece's square to an empty neighboring square, horizontally or vertically.
        During that move, you can also move the piece out of the board.
        To move a piece:
        <ol>
            <li>Click on it.</li>
            <li>Click on one of the 4 arrows to pick the direction in which it will move.
                You can also click on the middle dot to change the piece's orientation without moving it.</li>
            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>
        </ol><br/>
        Try to move the piece that is on the board one square upwards and to orient it downwards.`,new c9([[f9,f9,f9,f9,f9],[f9,f9,f9,f9,f9],[f9,g9,g9,g9,f9],[f9,f9,f9,f9,f9],[f9,f9,m9,f9,f9]],0),[new a9(2,4,Mw.of(gJ.UP),gJ.DOWN)],$localize`Congratulations, you made a side-slip!`,$localize`Failed!`),jJ.fromMove($localize`Moving a piece out of the board`,$localize`To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>
        Get that piece out of the board!`,new c9([[f9,f9,f9,f9,f9],[f9,f9,f9,f9,f9],[f9,g9,g9,g9,f9],[f9,f9,f9,f9,f9],[f9,f9,m9,f9,f9]],0),[new a9(2,4,Mw.of(gJ.DOWN),gJ.DOWN)],$localize`Congratulations, even if in this context it was not a useful move.`,$localize`Failed, the piece is still on the board.`),jJ.fromMove($localize`Pushing`,$localize`When the landing square of your move is occupied, we use the term "push".
        In order to push, multiple conditions must hold:
        <ol>
            <li>Your piece must already be oriented in the direction of the push.</li>
            <li>The number of the pieces (opponent's or not) that are facing yours (called the resistants)
                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>
            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>
        </ol>
        Your piece on the top right cannot push because there is one mountain too much.
        Your piece on the bottom right can push.<br/><br/>
        Do it.`,new c9([[v9,g9,g9,E9,y9],[f9,f9,f9,f9,f9],[f9,f9,f9,g9,f9],[f9,f9,f9,f9,f9],[f9,f9,w9,E9,y9]],0),[new a9(4,4,Mw.of(gJ.LEFT),gJ.LEFT)],$localize`Congratulations!`,$localize`Failed!`),jJ.fromMove($localize`Victory`,$localize`The game ends when a mountain is pushed out of the board.
        If you pushed it and nobody is in front of you, you're the winner.
        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.
        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>
        You have two ways of ending the game here: you can either win, or lose. Choose correctly!`,new c9([[f9,f9,f9,f9,f9],[f9,f9,f9,f9,f9],[g9,C9,y9,f9,_9],[f9,f9,f9,f9,S9],[f9,f9,f9,f9,g9]],0),[new a9(2,2,Mw.of(gJ.LEFT),gJ.LEFT)],$localize`Congratulations, you won!`,$localize`Failed, you lost.`)]}}function P9(e,t){if(1&e){const e=va();Cn(),pa(0,"use",7),Ea("click",function(){const t=Gt(e).$implicit;return ba(3).insertAt(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit,n=ba(3);Ia("id","insertAt_",e.x,"_",e.y,""),ra("transform",n.getInsertionArrowTransform(e.x+1,e.y+1,e.dir))}}const O9=function(e,t){return{dir:"DOWN",x:e,y:t}},T9=function(e){return{dir:"UP",x:e,y:5}},I9=function(e,t){return{dir:"RIGHT",x:e,y:t}},k9=function(e){return{dir:"LEFT",x:5,y:e}},A9=function(e,t,n,r){return[e,t,n,r]};function M9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,P9,1,3,"use",6),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",Pu(11,A9,bu(1,O9,e,-1),Su(4,T9,e),bu(6,I9,-1,e),Su(9,k9,e)))}}const N9=function(){return[0,1,2,3,4]};function R9(e,t){1&e&&(Cn(),ma(0),la(1,M9,2,16,"g",5),ya()),2&e&&(Ts(1),ha("ngForOf",wu(1,N9)))}function x9(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return ba(5).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(3).index,r=ba().index,i=ba();Ta("id","chooseDirection_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}const D9=function(){return["RIGHT","DOWN","LEFT","UP"]};function L9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",11),Ea("click",function(){return Gt(e),ba(4).chooseDirection("")}),fa(),la(2,x9,1,2,"use",12),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("cx",(e+1)*n.SPACE_SIZE+n.SPACE_SIZE/2)("cy",(t+1)*n.SPACE_SIZE+n.SPACE_SIZE/2),Ts(1),ha("ngForOf",wu(3,D9))}}function F9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"use",10),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().clickPiece(t,n)}),fa(),la(2,L9,3,4,"g",4),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Ia("id","clickPiece_",t,"_",r,""),ha("ngClass",i.getPieceClasses(n)),ra("transform",i.getPieceTransform(t,r)),Ts(1),ha("ngIf",i.choosingDirection(t,r))}}function U9(e,t){if(1&e&&(Cn(),ga(0,"use",14)),2&e){const e=ba().index,t=ba().index,n=ba();ra("transform","translate("+(e+1)*n.SPACE_SIZE+" "+(t+1)*n.SPACE_SIZE+")")}}function B9(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return ba(4).chooseOrientation(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2).index,r=ba().index,i=ba();Ta("id","chooseOrientation_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}function V9(e,t){1&e&&(Cn(),pa(0,"g"),la(1,B9,1,2,"use",12),fa()),2&e&&(Ts(1),ha("ngForOf",wu(1,D9)))}function $9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().insertAt(t,n)}),fa(),la(2,F9,3,5,"g",4),la(3,U9,1,1,"use",9),la(4,V9,2,2,"g",4),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","insertAt_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*(n+1))("y",i.SPACE_SIZE*(r+1))("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isPiece()),Ts(1),ha("ngIf",i.isMountain(e)),Ts(1),ha("ngIf",i.choosingOrientation(n,r))}}function z9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,$9,5,10,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let H9=(()=>{class e extends IX{constructor(e){super(e),this.lastMove=Mw.empty(),this.chosenCoord=Mw.empty(),this.landingCoord=Mw.empty(),this.chosenDirection=Mw.empty(),this.chosenOrientation=Mw.empty(),this.movedPieces=[],this.rules=new d9(c9),this.availableMinimaxes=[new p9(this.rules,"SiamMinimax")],this.encoder=a9.encoder,this.tutorial=(new b9).tutorial,this.updateBoard()}updateBoard(){if(Tw(e.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.chosenDirection=Mw.empty(),this.landingCoord=Mw.empty(),this.chosenOrientation=Mw.empty()}clickPiece(e,t){const n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(OJ.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=Mw.of(new yJ(e,t)),QG.SUCCESS)}chooseDirection(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.chooseDirection("+t+")");const r=n.canUserPlay("#chooseDirection_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(""===t)n.chosenDirection=Mw.empty(),n.landingCoord=n.chosenCoord;else{const r=gJ.factory.fromString(t).get();if(n.chosenDirection=Mw.of(r),n.landingCoord=Mw.of(n.chosenCoord.get().getNext(r)),n.landingCoord.get().isNotInRange(5,5))return Tw(e.VERBOSE,"orientation and direction should be the same: "+r),n.chosenOrientation=Mw.of(r),yield n.tryMove()}return QG.SUCCESS})()}chooseOrientation(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.chooseOrientation("+t+")");const r=n.canUserPlay("#chooseOrientation_"+t);return r.isFailure()?n.cancelMove(r.getReason()):(n.chosenOrientation=Mw.of(gJ.factory.fromString(t).get()),yield n.tryMove())})()}insertAt(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.insertAt("+t+", "+n+")");const i=r.canUserPlay("#insertAt_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());if(r.chosenCoord.isPresent())return r.cancelMove(u9.CANNOT_INSERT_WHEN_SELECTED());{const e=new yJ(t,n);if(r.getState().isOnBoard(e)&&r.getState().getPieceAtXY(t,n).isEmptyOrMountain())return r.cancelMove(u9.MUST_INSERT_OR_CHOOSE_YOUR_PIECE());r.chosenCoord=Mw.of(e);const i=d9.getCoordDirection(t,n,r.rules.node.gameState);return r.chosenDirection=Mw.of(i),r.landingCoord=Mw.of(r.chosenCoord.get().getNext(i)),QG.SUCCESS}})()}tryMove(){var e=this;return Pw(function*(){const t=e.chosenCoord.get(),n=new a9(t.x,t.y,e.chosenDirection,e.chosenOrientation.get());return e.cancelMove(),yield e.chooseMove(n,e.rules.node.gameState)})()}isMountain(e){return e===l9.MOUNTAIN}choosingOrientation(t,n){const r=new yJ(t,n);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(Tw(e.VERBOSE,"choosing orientation now"),!0)}choosingDirection(t,n){const r=new yJ(t,n);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(Tw(e.VERBOSE,"choosing direction now"),!0)}getInsertionArrowTransform(e,t,n){const r=`rotate(${90*(gJ.factory.fromString(n).get().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}getPieceTransform(e,t){const n=`rotate(${90*(this.board[t][e].getDirection().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}getArrowTransform(e,t,n){return v7.getArrowTransform(this.SPACE_SIZE,new yJ(e,t),gJ.factory.fromString(n).get())}getPieceClasses(e){return[this.getPlayerClass(e.getOwner())]}getSquareClasses(e,t){const n=new yJ(e,t);return this.movedPieces.some(e=>e.equals(n))?["moved"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-siam"]],features:[Go],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],["class","arrow selected-fill no-stroke",0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),ga(3,"polygon",2),ga(4,"polygon",3),fa(),la(5,R9,2,2,"ng-container",4),la(6,z9,2,1,"g",5),fa()),2&e&&(Ts(5),ha("ngIf",t.isPlayerTurn()),Ts(1),ha("ngForOf",t.board))},directives:[rp,tp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),G9=(()=>{class e{}return e.NO_MOVEMENT_BEFORE_TURN_40=()=>$localize`You cannot move yet. Pick a space where you will put a new piece.`,e.MUST_CUT=()=>$localize`Several groups are of the same size, you must pick the one to keep.`,e.CANNOT_CHOOSE_TO_KEEP=()=>$localize`You cannot choose which part to keep when one is smaller than the other.`,e.CAN_NO_LONGER_DROP=()=>$localize`You cannot put new pieces anymore. Pick a piece to move.`,e.MUST_CAPTURE_BIGGEST_GROUPS=()=>$localize`You must choose one of the biggest groups to keep it.`,e.CANNOT_KEEP_EMPTY_COORD=()=>$localize`You cannot pick an empty space. Pick one of the biggest groups.`,e.MUST_DROP_NEXT_TO_OTHER_PIECE=()=>$localize`You must put this piece next to another piece.`,e})();class q9 extends MJ{constructor(e,t,n){super(t),this.pieces=e;const r=this.getCalculatedScale();this.pieces=r.pieces,this.width=r.width,this.height=r.height,this.offset=n??r.offset,this.pieces.makeImmutable()}static getInitialState(){return q9.fromRepresentation([[cK.ZERO.value],[cK.ONE.value]],0)}static fromRepresentation(e,t,n){const r=new BJ;for(let i=0;i<e.length;i++)for(let t=0;t<e[0].length;t++)e[i][t]!==uK.NONE.value&&r.set(new yJ(t,i),cK.of(e[i][t]));return new q9(r,t,n)}static deplacePiece(e,t){const n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}static getGroups(e,t){let n=new BJ,r=0;for(const o of EJ.factory.all){const i=t.getNext(o,1);n=q9.putCoordInGroup(e,i,n,""+r),r++}const i=n.reverse(),s=new AJ;for(let o=0;o<i.size();o++)s.add(i.getByIndex(o).value);return s}static putCoordInGroup(e,t,n,r){if(e.get(t).isPresent()&&n.get(t).isAbsent()){n.set(t,r);for(const i of EJ.factory.all){const s=t.getNext(i,1);n=q9.putCoordInGroup(e,s,n,r)}}return n}getCalculatedScale(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const o of this.pieces.listKeys())e=Math.min(o.x,e),t=Math.max(o.x,t),n=Math.min(o.y,n),r=Math.max(o.y,r);let i=new BJ;const s=new hJ(-e,-n);if(0!==e||0!==n)for(const o of this.pieces.listKeys()){const e=this.pieces.delete(o),t=o.getNext(s);i.set(t,e)}else i=this.pieces;return{width:t+1-e,height:r+1-n,pieces:i,offset:s}}toRepresentation(){const e=fK.createTable(this.width,this.height,uK.NONE.value);for(const t of this.pieces.listKeys()){const n=this.getPieceAt(t).value;e[t.y][t.x]=n}return e}isIllegalLandingZone(e,t){return this.pieces.containsKey(e)?QG.failure(OJ.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?QG.SUCCESS:QG.failure(G9.MUST_DROP_NEXT_TO_OTHER_PIECE())}isCoordConnected(e,t){for(const n of EJ.factory.all){const r=e.getNext(n,1);if(this.pieces.containsKey(r)&&!1===t.equalsValue(r))return!0}return!1}isOnBoard(e){return this.pieces.containsKey(e)}getPieceAt(e){return this.isOnBoard(e)?this.pieces.get(e).get():uK.NONE}applyLegalDrop(e){const t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new q9(t,this.turn+1)}applyLegalDeplacement(e,t){const n=q9.deplacePiece(this,e);let r=new BJ;if(t.size()>0){r=new BJ;for(const e of t)r.set(e,n.get(e).get())}else r=n.getCopy();return new q9(r,this.turn+1)}countPieces(){const e=this.pieces.reverse(),t=e.get(cK.ZERO).getOrElse(new e1),n=e.get(cK.ONE).getOrElse(new e1);return[t.size(),n.size()]}switchPiece(e){const t=this.pieces.getCopy(),n=this.getPieceAt(e);if(n.isPlayer())return t.replace(e,n.getOpponent()),new q9(t,this.turn,this.offset);tq.logErrorAndFail("SixState","Cannot switch piece if there is no piece!",{coord:e.toString()})}equals(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}class W9 extends xJ{constructor(e,t,n){if(super(),this.start=e,this.landing=t,this.keep=n,e.equalsValue(t))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(n))throw new Error("Cannot keep starting coord, since it will always be empty after move!")}static fromDrop(e){return new W9(Mw.empty(),e,Mw.empty())}static fromMovement(e,t){return new W9(Mw.of(e),t,Mw.empty())}static fromCut(e,t,n){return new W9(Mw.of(e),t,Mw.of(n))}isDrop(){return this.start.isAbsent()}isCut(){return this.keep.isPresent()}toString(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}equals(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}W9.encoder=new class extends oK{encodeMove(e){return{start:e.start.isPresent()?yJ.encoder.encode(e.start.get()):null,landing:yJ.encoder.encode(e.landing),keep:e.keep.isPresent()?yJ.encoder.encode(e.keep.get()):null}}decodeMove(e){const t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");const n=yJ.encoder.decode(t.landing);if(null==t.start)return W9.fromDrop(n);const r=yJ.encoder.decode(t.start);if(null==t.keep)return W9.fromMovement(r,n);{const e=yJ.encoder.decode(t.keep);return W9.fromCut(r,n,e)}}};class j9 extends HJ{constructor(){super(...arguments),this.VERBOSE=!1}applyLegalMove(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}isLegal(e,t){Tw(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});const n=t.isIllegalLandingZone(e.landing,e.start);return n.isFailure()?n.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):j9.isLegalPhaseTwoMove(e,t)}static getLegalLandings(e){const t=new e1;for(const n of e.pieces.listKeys())for(const r of EJ.factory.all){const i=n.getNext(r,1);e.getPieceAt(i)===uK.NONE&&t.add(i)}return t.toList()}isLegalDrop(e,t){return!1===e.isDrop()?ZG.failure(G9.NO_MOVEMENT_BEFORE_TURN_40()):ZG.success(t.pieces.getKeySet())}static isLegalPhaseTwoMove(e,t){if(e.isDrop())return ZG.failure(G9.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case uK.NONE:return ZG.failure(OJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return ZG.failure(OJ.CANNOT_CHOOSE_OPPONENT_PIECE())}const n=q9.deplacePiece(t,e),r=q9.getGroups(n,e.start.get());if(j9.isSplit(r)){const t=this.getBiggerGroups(r);return 1===t.size()?e.keep.isPresent()?ZG.failure(G9.CANNOT_CHOOSE_TO_KEEP()):ZG.success(t.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,t,n)}return ZG.success(new e1)}static isSplit(e){return e.size()>1}static getBiggerGroups(e){let t=0,n=new AJ;for(const r of e){const e=r.size();e>t?(t=e,n=new AJ([r])):e===t&&n.add(r)}return n}static moveKeepBiggerGroup(e,t,n){if(e.isAbsent())return ZG.failure(G9.MUST_CUT());if(n.get(e.get()).isAbsent())return ZG.failure(G9.CANNOT_KEEP_EMPTY_COORD());const r=e.get();for(const i of t)if(i.contains(r))return ZG.success(i);return ZG.failure(G9.MUST_CAPTURE_BIGGEST_GROUPS())}getGameStatus(e){const t=e.gameState,n=t.getCurrentOpponent();let r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return zJ.getVictory(n);if(t.turn>39){const e=t.countPieces(),n=e[0],r=e[1];return n<6&&r<6?n<r?zJ.ONE_WON:r<n?zJ.ZERO_WON:zJ.DRAW:n<6?zJ.getDefeat(cK.ZERO):r<6?zJ.getDefeat(cK.ONE):zJ.ONGOING}return zJ.ONGOING}startSearchingVictorySources(){Tw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}getShapeVictory(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();const n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(EJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return[];const t=(e+i.length)%6;i.push(s),s=s.getNext(EJ.factory.all[t],1)}return i}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=EJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return[];a=!0,i=i.getOpposite(),s=s.getNext(i,o.length)}s=s.getNext(i,1)}return o}searchVictoryOnlyForTriangleCorner(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=EJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.length%2==0&&(i=EJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return s}searchVictoryOnlyForTriangleEdge(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=EJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.push(o),s.length%2==0&&(i=EJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return s}}class Z9 extends TJ{calculateBoardValue(e,t){this.startSearchingVictorySources();let n={status:FJ.DEFAULT,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};for(;this.hasNextVictorySource();){const r=this.getNextVictorySource();let i;if(i=n.status===FJ.PRE_VICTORY?this.searchVictoryOnly(r,e,t):this.getBoardInfo(r,e,t,n),i.status===FJ.VICTORY)return i;n={status:i.status,victory:Mw.empty(),preVictory:i.preVictory,sum:n.sum+i.sum}}return n}}class Y9 extends IJ{constructor(e,t){super(e),this.value=e,this.preVictory=t}}class K9 extends Z9{constructor(){super(...arguments),this.VERBOSE=!1}static get(){if(null==K9.INSTANCE){const e=new j9(q9);K9.INSTANCE=new K9(e,"SixMinimax")}return K9.INSTANCE}getListMoves(e){const t=K9.get(),n=e.getOwnValue(t);if(n.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(n):this.createForcedDeplacement(e,n);const r=j9.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(r):this.getListDeplacement(e.gameState,r)}createForcedDrop(e){Tw(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});const t=[],n=W9.fromDrop(e.preVictory.get());return t.push(n),t}createForcedDeplacement(e,t){Tw(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});const n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}getDeplacementFrom(e,t,n){const r=[];for(const i of t)for(const t of n){const n=W9.fromMovement(i,t);if(e.isCoordConnected(t,Mw.of(i))){const s=q9.deplacePiece(e,n),o=q9.getGroups(s,n.start.get());if(j9.isSplit(o))for(const e of o){const n=e.getAnyElement().get(),s=W9.fromCut(i,t,n);r.push(s)}else r.push(n)}}return r}getSafelyMovablePieceOrFirstOne(e){const t=e.gameState,n=t.pieces.reverse(),r=t.getCurrentPlayer(),i=n.get(r).get(),s=i.getAnyElement().get(),o=[];for(const a of i)!1===this.isPieceBlockingAVictory(t,a)&&o.push(a);return new e1(0===o.length?[s]:o)}isPieceBlockingAVictory(e,t){const n=e.switchPiece(t),r=W9.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===FJ.VICTORY)return!0;return!1}getListDrop(e){const t=[];for(const n of e){const e=W9.fromDrop(n);t.push(e)}return t}getListDeplacement(e,t){const n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}getBoardValue(e){const t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue();let s={status:FJ.DEFAULT,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};t.isPresent()&&(s=this.calculateBoardValue(t.get(),n));let o=Mw.empty();if(s.status===FJ.DEFAULT&&s.preVictory.isPresent()&&(o=Mw.of(s.preVictory.get())),s.status===FJ.VICTORY)return new Y9(i,Mw.empty());if(n.turn>39){const e=n.countPieces(),t=e[0],r=e[1];return t<6&&r<6?new Y9(t<r?cK.ONE.getVictoryValue():r<t?cK.ZERO.getVictoryValue():0,Mw.empty()):t<6?new Y9(cK.ZERO.getDefeatValue(),Mw.empty()):r<6?new Y9(cK.ONE.getDefeatValue(),Mw.empty()):new Y9(t-r,o)}return new Y9(s.status===FJ.PRE_VICTORY?r.getPreVictory():s.sum*r.getScoreModifier(),o)}startSearchingVictorySources(){Tw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(EJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return{status:FJ.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};const t=(e+i.length)%6;i.push(s),s=s.getNext(EJ.factory.all[t],1)}return{status:FJ.VICTORY,victory:Mw.of(i),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=EJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return{status:FJ.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};a=!0,i=i.getOpposite(),s=s.getNext(i,o.length-1)}s=s.getNext(i,1)}return{status:FJ.VICTORY,victory:Mw.of(o),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForTriangleCorner(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=EJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:FJ.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};s.length%2==0&&(i=EJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return{status:FJ.VICTORY,victory:Mw.of(s),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForTriangleEdge(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=EJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:FJ.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};s.push(o),s.length%2==0&&(i=EJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return{status:FJ.VICTORY,victory:Mw.of(s),preVictory:Mw.empty(),sum:0}}getBoardInfo(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});const i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}getBoardInfoForCircle(e,t,n,r){Tw(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer(),s=[t];let o=t.getNext(EJ.factory.all[e],1),a=0,l=Mw.empty();for(;s.length<6;){const t=n.getPieceAt(o);if(t===i)return r;const c=(e+s.length)%6;s.push(o);const u=EJ.factory.all[c];t===uK.NONE?(a+=.16,l=Mw.of(o)):a++,o=o.getNext(u,1)}return this.getBoardInfoResult(a,l,s,r)}getBoardInfoResult(e,t,n,r){let i=r.preVictory;if(4.16===e){if(Tw(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:FJ.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};i=t}else if(5===e)return{status:FJ.VICTORY,victory:Mw.of(n),preVictory:Mw.empty(),sum:0};return{status:r.status,victory:Mw.empty(),preVictory:i,sum:r.sum+e}}getBoardInfoForLine(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});const i=EJ.factory.all[e];let s=t.getPrevious(i,5),o=[],a=[],l=Mw.empty();for(let f=0;f<6;f++){const e=this.updateEncounterAndReturnLastEmpty(n,s,a);e.isPresent()&&(l=e),o.push(s),s=s.getNext(i,1)}let c=r.status,u=r.preVictory,h=0,d=0;for(;h<6;){const e=a.reduce((e,t)=>e+t);if(6===e)return{status:FJ.VICTORY,victory:Mw.of(o),preVictory:Mw.empty(),sum:0};5.16===e&&c===FJ.DEFAULT&&(u.isPresent()?(nq(!1===u.equals(l),"Impossible to have point aligned with differents line to a same point"),c=FJ.PRE_VICTORY):u=l),d=Math.max(d,e),o=o.slice(1,6),o.push(s),a=a.slice(1,6);const t=this.updateEncounterAndReturnLastEmpty(n,s,a);t.isPresent()&&(l=t),h++,s=s.getNext(i,1)}const p={status:c,victory:Mw.of(o),preVictory:u,sum:d};return this.getBoardInfoResult(d,l,o,p)}updateEncounterAndReturnLastEmpty(e,t,n){const r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),Mw.empty();case uK.NONE:return n.push(.16),Mw.of(t);default:return n.push(1),Mw.empty()}}getBoardInfoForTriangleCorner(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=EJ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=Mw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===uK.NONE?(l+=.16,c=Mw.of(a)):l++,o.length%2==0&&(s=EJ.factory.all[(e+o.length)%6]),o.push(a),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}getBoardInfoForTriangleEdge(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=EJ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=Mw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===uK.NONE?(l+=.16,c=Mw.of(a)):l++,o.push(a),o.length%2==0&&(s=EJ.factory.all[(e+o.length)%6]),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}}const Q9=uK.NONE.value,J9=cK.ZERO.value,X9=cK.ONE.value;let eee=(()=>{class e{}return e.MOVEMENT_NOT_DISCONNECTING=()=>$localize`This move does not disconnect your opponent's pieces. Try again with another piece.`,e.MOVEMENT_SELF_DISCONNECTING=()=>$localize`You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!`,e})();class tee{constructor(){this.tutorial=[jJ.informational($localize`Six`,$localize`Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.
        Each player has 21 pieces, with one for each player already on the board.
        The goal of the game is to form one of the three winning shapes with your pieces.`,q9.getInitialState()),jJ.fromMove($localize`Victory (line)`,$localize`On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>
        Find the victory. You're playing Dark.`,q9.fromRepresentation([[J9,X9,X9,X9,X9,J9],[Q9,J9,X9,Q9,J9,Q9],[X9,X9,J9,Q9,Q9,Q9],[Q9,Q9,J9,Q9,Q9,Q9],[Q9,J9,Q9,Q9,Q9,Q9],[J9,Q9,Q9,Q9,Q9,Q9]],0),[W9.fromDrop(new yJ(3,2))],$localize`Congratulations!`,$localize`Failed!`),jJ.fromMove($localize`Victory (circle)`,$localize`On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,q9.fromRepresentation([[Q9,Q9,Q9,X9,Q9,Q9],[Q9,Q9,X9,X9,J9,J9],[Q9,X9,Q9,J9,X9,Q9],[X9,J9,J9,J9,J9,X9]],0),[W9.fromDrop(new yJ(5,2))],$localize`Congratulations! Note that if a piece is inside the circle, it does not change anything.`,$localize`Failed!`),jJ.fromMove($localize`Victory (triangle)`,$localize`On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,q9.fromRepresentation([[Q9,Q9,Q9,X9,Q9,Q9],[Q9,J9,X9,J9,J9,J9],[Q9,J9,Q9,J9,J9,Q9],[X9,X9,X9,Q9,X9,Q9]],0),[W9.fromDrop(new yJ(3,3))],$localize`Congratulations!`,$localize`Failed!`),jJ.fromPredicate($localize`Second phase`,$localize`After 40 turns, your pieces have all been placed and we move on to the second phase of the game.
        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.
        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>
        You're playing Dark. Make a move that disconnects one of your opponent's pieces.`,q9.fromRepresentation([[Q9,Q9,Q9,Q9,Q9,Q9,Q9,X9,Q9],[Q9,Q9,Q9,Q9,Q9,Q9,J9,Q9,Q9],[Q9,Q9,Q9,Q9,J9,J9,J9,Q9,Q9],[Q9,Q9,Q9,Q9,X9,X9,Q9,X9,J9],[Q9,J9,X9,X9,J9,J9,X9,Q9,Q9],[J9,J9,J9,J9,X9,X9,X9,J9,Q9],[X9,X9,J9,Q9,X9,X9,J9,Q9,Q9],[Q9,J9,Q9,J9,J9,Q9,Q9,Q9,Q9],[X9,X9,X9,X9,Q9,Q9,Q9,Q9,Q9],[Q9,J9,Q9,X9,Q9,Q9,Q9,Q9,Q9]],40),W9.fromMovement(new yJ(6,1),new yJ(5,1)),(e,t)=>{const n=t.countPieces();return 19===n[0]?18===n[1]?QG.SUCCESS:QG.failure(eee.MOVEMENT_NOT_DISCONNECTING()):QG.failure(eee.MOVEMENT_SELF_DISCONNECTING())},$localize`Congratulations, your opponent now has one piece less and you're closer to victory!`),jJ.fromPredicate($localize`Victory by disconnection`,$localize`During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.
        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.
        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>
        Here, you're playing Dark and you can win. Do it!`,q9.fromRepresentation([[Q9,Q9,Q9,Q9,Q9,X9],[Q9,Q9,Q9,Q9,J9,X9],[Q9,Q9,Q9,X9,J9,J9],[Q9,Q9,J9,Q9,X9,J9],[X9,X9,Q9,Q9,Q9,J9],[J9,X9,Q9,Q9,Q9,Q9],[J9,Q9,Q9,Q9,Q9,Q9]],40),W9.fromMovement(new yJ(2,3),new yJ(3,3)),(e,t)=>e.start.equalsValue(new yJ(2,3))?QG.SUCCESS:QG.failure(eee.MOVEMENT_NOT_DISCONNECTING()),$localize`Congratulations, you won!`),jJ.fromPredicate($localize`Special disconnection`,$localize`During a disconnection, two or more groups could have the same size,
        in which case you will have to click on the group you wish to keep.<br/><br/>
        You're playing Dark, play such a move!`,q9.fromRepresentation([[Q9,Q9,Q9,Q9,Q9,X9],[Q9,Q9,Q9,Q9,J9,X9],[Q9,Q9,Q9,X9,J9,J9],[J9,Q9,J9,Q9,Q9,X9],[X9,X9,Q9,Q9,Q9,Q9],[J9,J9,Q9,Q9,Q9,Q9],[J9,Q9,Q9,Q9,Q9,Q9]],40),W9.fromCut(new yJ(2,3),new yJ(2,5),new yJ(2,5)),(e,t)=>e.keep.isAbsent()?QG.failure($localize`This move has not cut the board in two equal halves.`):t.getPieceAt(e.landing.getNext(t.offset))===uK.NONE?QG.failure($localize`Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again.`):QG.SUCCESS,$localize`Congratulations, you won!`)]}}function nee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().onPieceClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","piece_",e.x,"_",e.y,""),ha("ngClass",n.getPieceClass(e)),ra("points",n.getHexaCoordsAt(e))}}function ree(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().onNeighborClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","neighbor_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function iee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.chosenLanding.get())}),fa()}if(2&e){const e=ba();Ia("id","chosenLanding_",e.chosenLanding.get().x,"_",e.chosenLanding.get().y,""),ha("ngClass",e.getPlayerClass(e.state.getCurrentPlayer())),ra("points",e.getHexaCoordsAt(e.chosenLanding.get()))}}function see(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=t.$implicit,n=ba();Ia("id","disconnected_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function oee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",13),Ea("click",function(){Gt(e);const t=ba();return t.onNeighborClick(t.leftCoord.get())}),fa()}if(2&e){const e=ba();Ia("id","leftCoord_",e.leftCoord.get().x,"_",e.leftCoord.get().y,""),ra("points",e.getHexaCoordsAt(e.leftCoord.get()))}}function aee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.lastDrop.get())}),fa()}if(2&e){const e=ba();Ia("id","lastDrop_",e.lastDrop.get().x,"_",e.lastDrop.get().y,""),ra("points",e.getHexaCoordsAt(e.lastDrop.get()))}}function lee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",15),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.selectedPiece.get())}),fa()}if(2&e){const e=ba();Ia("id","selectedPiece_",e.selectedPiece.get().x,"_",e.selectedPiece.get().y,""),ha("ngClass",e.getSelectedPieceClass()),ra("points",e.getHexaCoordsAt(e.selectedPiece.get()))}}function cee(e,t){if(1&e&&(Cn(),ga(0,"polyline",16)),2&e){const e=t.$implicit,n=ba();Ia("id","victoryCoord_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function uee(e,t){if(1&e){const e=va();Cn(),pa(0,"g",19),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onPieceClick(t)}),ga(1,"polyline",20),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(1),Ia("id","cuttable_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function hee(e,t){if(1&e&&(Cn(),pa(0,"g",17),la(1,uee,2,3,"g",18),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let dee=(()=>{class e extends _J{constructor(e){super(e),this.disconnecteds=[],this.cuttableGroups=[],this.leftCoord=Mw.empty(),this.lastDrop=Mw.empty(),this.selectedPiece=Mw.empty(),this.chosenLanding=Mw.empty(),this.nextClickShouldSelectGroup=!1,this.rules=new j9(q9),this.availableMinimaxes=[new K9(this.rules,"SixMinimax")],this.encoder=W9.encoder,this.tutorial=(new tee).tutorial,this.SPACE_SIZE=30,this.hexaLayout=new wJ(1.5*this.SPACE_SIZE,new yJ(2*this.SPACE_SIZE,0),PJ.INSTANCE),this.updateBoard()}cancelMoveAttempt(){this.selectedPiece=Mw.empty(),this.chosenLanding=Mw.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=Mw.empty(),this.lastDrop=Mw.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}getViewBox(){const e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}mapAbstractCoordToCornerCoords(){const e=this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(e=>this.hexaLayout.getHexaCoordsAt(e));let t=[];for(const n of e)t=t.concat(n);return t}getLimits(e){let t=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;for(const s of e)s.x<r&&(r=s.x),s.y<i&&(i=s.y),t=Math.max(t,s.x),n=Math.max(n,s.y);return{minX:r,minY:i,maxX:t,maxY:n}}showLastMove(){const e=this.rules.node.move.get();this.lastDrop=Mw.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?Mw.of(e.start.get().getNext(this.state.offset,1)):Mw.empty();const t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}getDisconnected(){const e=this.rules.node.mother.get().gameState.pieces.listKeys(),t=this.rules.node.gameState.pieces.listKeys(),n=[];for(const i of e)!1===this.rules.node.move.get().start.equalsValue(i)&&!1===t.some(e=>e.equals(i.getNext(this.state.offset,1)))&&n.push(i.getNext(this.state.offset,1));const r=this.lastDrop.get();return!1===this.pieces.some(e=>e.equals(r))&&!1===t.some(e=>e.equals(r))&&n.push(r),n}getEmptyNeighbors(){let e=j9.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){const t=this.chosenLanding.get();e=e.filter(e=>!1===e.equals(t))}return e}getPieceClass(e){const t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}onPieceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#piece_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.state.turn<40)return t.cancelMove(G9.NO_MOVEMENT_BEFORE_TURN_40());if(t.chosenLanding.isAbsent())return t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(OJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=Mw.of(e),QG.SUCCESS);{const n=W9.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e);return t.chooseMove(n,t.state)}})()}onNeighborClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#neighbor_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.nextClickShouldSelectGroup)return t.cancelMove(G9.MUST_CUT());if(t.state.turn<40)return t.chooseMove(W9.fromDrop(e),t.state);if(t.selectedPiece.isAbsent())return t.cancelMove(G9.CAN_NO_LONGER_DROP());{const n=W9.fromMovement(t.selectedPiece.get(),e),r=j9.isLegalPhaseTwoMove(n,t.state);return t.neededCutting(r)?(t.chosenLanding=Mw.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,QG.SUCCESS):t.chooseMove(n,t.state)}})()}neededCutting(e){return e.isFailure()&&e.getReason()===G9.MUST_CUT()}moveVirtuallyPiece(){const e=this.selectedPiece.get();this.pieces=this.pieces.filter(t=>!1===t.equals(e)),this.neighbors=this.getEmptyNeighbors()}showCuttable(){const e=W9.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=q9.deplacePiece(this.state,e),n=q9.getGroups(t,e.start.get()),r=j9.getBiggerGroups(n);this.cuttableGroups=[];for(const i of r)this.cuttableGroups.push(i.toList())}getSelectedPieceClass(){return this.chosenLanding.isPresent()?"moved":"selected"}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-six"]],features:[Go],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,nee,1,4,"polyline",1),la(2,ree,1,3,"polyline",2),la(3,iee,1,4,"polyline",3),la(4,see,1,3,"polyline",4),la(5,oee,1,3,"polyline",5),la(6,aee,1,3,"polyline",6),la(7,lee,1,4,"polyline",7),la(8,cee,1,3,"polyline",8),la(9,hee,2,1,"g",9),fa()),2&e&&(ra("viewBox",t.viewBox),Ts(1),ha("ngForOf",t.pieces),Ts(1),ha("ngForOf",t.neighbors),Ts(1),ha("ngIf",t.chosenLanding.isPresent()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.leftCoord.isPresent()),Ts(1),ha("ngIf",t.lastDrop.isPresent()),Ts(1),ha("ngIf",t.selectedPiece.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngForOf",t.cuttableGroups))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class pee extends VX{static of(e,t){return new pee(e,t)}static from(e,t){try{const n=new pee(e,t);return ZG.success(n)}catch(n){return ZG.failure(n.message)}}getMaximalDistance(){return 9}}pee.encoder=UX.getEncoder(9,9,pee.of);const fee={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:cK.ZERO};class gee extends qX{static getInitialState(){const e=HX.UNOCCUPIED,t=HX.INVADERS,n=HX.DEFENDERS;return new gee([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,n,e,e,e,e],[t,e,e,e,n,e,e,e,t],[t,t,n,n,HX.PLAYER_ONE_KING,n,n,t,t],[t,e,e,e,n,e,e,e,t],[e,e,e,e,n,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}from(e,t){return new gee(e,t)}}class mee extends jX{constructor(){super(gee,fee,pee.of)}static get(){return null==mee.singleton&&(mee.singleton=new mee),$J.ruler=this.singleton,mee.singleton}}const yee=HX.UNOCCUPIED,vee=HX.INVADERS,_ee=HX.DEFENDERS,Cee=HX.PLAYER_ONE_KING;class Eee{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`Tablut is a strategy game that was played by the Vikings.
        The goal of the game is different for each player.
        The attacker plays first. Its pieces (dark) are close to the edges.
        Its goal is to capture the king, which is in the center of the board.
        The defender plays second. Its pieces (light) are in the middle.
        Its goal is to move the king on one of the 4 thrones in the corners.
        Note that the square in which the king starts, in the center of the board, is also a throne.`,gee.getInitialState()),jJ.anyMove($localize`Moving`,$localize`All pieces move the same way.
        Similarly to a rook in chess, a piece can move:
        <ol>
            <li>By as many squares as you want.</li>
            <li>Without going over another piece or stopping on another piece.</li>
            <li>Horizontally or vertically.</li>
            <li>Only the king can land on a throne.</li>
        </ol>
        To move a piece, click on it and then on its landing square.<br/><br/>
        You're playing Dark, do the first move.`,gee.getInitialState(),pee.of(new yJ(4,1),new yJ(1,1)),$localize`Congratulations!`),jJ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new gee([[yee,yee,yee,vee,vee,vee,yee,yee,yee],[yee,yee,yee,yee,vee,yee,yee,yee,yee],[yee,yee,yee,yee,_ee,yee,yee,yee,yee],[yee,yee,yee,vee,_ee,yee,yee,yee,vee],[vee,vee,_ee,_ee,Cee,_ee,_ee,vee,vee],[yee,yee,yee,yee,_ee,yee,yee,yee,vee],[yee,yee,yee,yee,_ee,yee,yee,yee,yee],[yee,yee,yee,yee,vee,yee,yee,yee,yee],[yee,yee,yee,vee,vee,vee,yee,yee,yee]],1),[pee.of(new yJ(2,4),new yJ(2,3)),pee.of(new yJ(4,2),new yJ(3,2))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),jJ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new gee([[yee,yee,yee,vee,vee,vee,yee,yee,yee],[yee,yee,yee,yee,vee,yee,yee,yee,yee],[yee,yee,yee,yee,_ee,yee,yee,yee,yee],[yee,yee,_ee,yee,Cee,yee,_ee,yee,vee],[vee,vee,yee,_ee,yee,_ee,_ee,vee,vee],[yee,yee,yee,yee,_ee,yee,yee,yee,vee],[yee,yee,yee,yee,_ee,yee,yee,yee,yee],[yee,yee,yee,yee,vee,yee,yee,yee,yee],[yee,yee,yee,vee,vee,vee,yee,yee,yee]],12),[pee.of(new yJ(1,4),new yJ(2,4))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),jJ.fromMove($localize`Capturing the king (1/2)`,$localize`To capture the king, two soldiers are not enough.
        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.
        This also works if the king is on the throne.<br/><br/>
        Capture the king.`,new gee([[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,vee,yee,yee,yee,yee,yee,yee,yee],[vee,Cee,yee,vee,yee,yee,yee,yee,yee],[yee,vee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee]],72),[pee.of(new yJ(3,4),new yJ(2,4))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),jJ.fromMove($localize`Capturing the king (2/2)`,$localize`Another way to capture the king is to immobilize it against an edge of the board.
        Note that the king cannot be captured next to a throne.<br/><br/>
        Capture the king.`,new gee([[yee,yee,vee,Cee,vee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,vee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee],[yee,yee,yee,yee,yee,yee,yee,yee,yee]],72),[pee.of(new yJ(3,3),new yJ(3,1))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function wee(e,t){1&e&&(Cn(),ga(0,"polyline",8))}function See(e,t){1&e&&(Cn(),ga(0,"polyline",9))}function bee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,wee,1,0,"polyline",6),la(2,See,1,0,"ng-template",null,7,Ku),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function Pee(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10),ga(4,"line",10),ga(5,"line",10),fa()),2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.1*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.9*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.15*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.85*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE)}}function Oee(e,t){if(1&e&&(Cn(),ga(0,"polyline",15)),2&e){const e=ba(3).index,t=ba().index;ha("ngClass",ba().viewInfo.pieceClasses[t][e])}}function Tee(e,t){if(1&e&&(Cn(),ga(0,"line",10),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10)),2&e){const e=ba(3).index,t=ba().index,n=ba();ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.04*n.SPACE_SIZE)("y1",.5*n.SPACE_SIZE)("x2",.96*n.SPACE_SIZE)("y2",.5*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.2*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.8*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.8*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.2*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE)}}function Iee(e,t){if(1&e&&(Cn(),la(0,Oee,1,1,"polyline",13),la(1,Tee,4,20,"ng-template",null,14,Ku)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ha("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function kee(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",10),la(2,Pee,6,25,"g",11),la(3,Iee,3,2,"ng-template",null,12,Ku),fa()),2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngClass",r.viewInfo.pieceClasses[n][t]),ra("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)("cx",.5*r.SPACE_SIZE)("cy",.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function Aee(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(1,"rect",4),la(2,bee,4,2,"g",5),la(3,kee,5,6,"g",5),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ia("id","click_",e,"_",n,""),ra("transform","translate("+r.SPACE_SIZE*e+", "+r.SPACE_SIZE*n+")"),Ts(1),ha("ngClass",r.getRectClasses(e,n)),ra("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function Mee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Aee,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function Nee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",16),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let Ree=(()=>{class e extends YX{constructor(e){super(e,!1,pee.from),this.rules=mee.get(),this.availableMinimaxes=[new KX(this.rules,"DummyBot"),new t1(this.rules,"Piece > Influence"),new n1(this.rules,"Piece > Control"),new r1(this.rules,"Escape > Piece > Control")],this.encoder=pee.encoder,this.tutorial=(new Eee).tutorial,this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["app-tablut"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,Mee,2,1,"g",1),la(2,Nee,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[tp,Xd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class xee{}xee.PLACEMENT_AFTER_INITIAL_PHASE=()=>$localize`You cannot put a new ring after the tenth turn.`,xee.NO_MARKERS_IN_INITIAL_PHASE=()=>$localize`You cannot put a marker in a ring before placing all of your rings.`,xee.MISSING_CAPTURES=s3.MISSING_CAPTURES,xee.MOVE_DIRECTION_INVALID=()=>$localize`The direction of your move is invalid: a move is made along a straight line.`,xee.CAN_ONLY_CAPTURE_YOUR_MARKERS=()=>$localize`You can only capture your own markers.`,xee.SHOULD_SELECT_PLAYER_RING=()=>$localize`You must pick one of your own rings to move.`,xee.SHOULD_END_MOVE_ON_EMPTY_SPACE=()=>$localize`Your ring must land on an empty space.`,xee.MOVE_SHOULD_NOT_PASS_ABOVE_RING=()=>$localize`A ring can only jump over markers or empty spaces, not over another ring.`,xee.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=()=>$localize`Your ring must land on the first empty space after a group of markers.`,xee.AMBIGUOUS_CAPTURE_COORD=s3.AMBIGUOUS_CAPTURE_COORD,xee.CAPTURE_SHOULD_TAKE_RING=()=>$localize`When you capture markers, you must take one of your ring as well by clicking on it.`;class Dee{constructor(e,t){this.player=e,this.isRing=t}static of(e,t){return e===uK.NONE?Dee.EMPTY:t?Dee.RINGS[e.value]:Dee.MARKERS[e.value]}equals(e){return this===e}flip(){return nq(!1===this.isRing,"cannot flip a ring (it should never happen)"),nq(this.player.isPlayer(),"cannot flip a non-player piece"),Dee.of(this.player.getOpponent(),this.isRing)}toString(){switch(this){case Dee.UNREACHABLE:return"NONE";case Dee.EMPTY:return"EMPTY";case Dee.MARKER_ZERO:return"MARKER_ZERO";case Dee.MARKER_ONE:return"MARKER_ONE";case Dee.RING_ZERO:return"RING_ZERO";default:return Ow.expectToBe(this,Dee.RING_ONE),"RING_ONE"}}}Dee.encoder=aK.tuple([cK.numberEncoder,aK.booleanEncoder],e=>[e.player,e.isRing],e=>Dee.of(e[0],e[1])),Dee.UNREACHABLE=new Dee(uK.NONE,!1),Dee.EMPTY=new Dee(uK.NONE,!1),Dee.MARKER_ZERO=new Dee(cK.ZERO,!1),Dee.MARKER_ONE=new Dee(cK.ONE,!1),Dee.MARKERS=[Dee.MARKER_ZERO,Dee.MARKER_ONE],Dee.RING_ZERO=new Dee(cK.ZERO,!0),Dee.RING_ONE=new Dee(cK.ONE,!0),Dee.RINGS=[Dee.RING_ZERO,Dee.RING_ONE];let Lee=(()=>{class e extends B0{constructor(t,n,r){super(r,t,e.SIZE,e.SIZE,[6,4,3,2,1],Dee.EMPTY),this.sideRings=n}static getInitialState(){const t=Dee.EMPTY,n=Dee.UNREACHABLE;return new e([[n,n,n,n,n,n,t,t,t,t,n],[n,n,n,n,t,t,t,t,t,t,t],[n,n,n,t,t,t,t,t,t,t,t],[n,n,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,n,n],[t,t,t,t,t,t,t,t,n,n,n],[t,t,t,t,t,t,t,n,n,n,n],[n,t,t,t,t,n,n,n,n,n,n]],[5,5],0)}isInitialPlacementPhase(){return this.turn<10}countScores(){return this.turn<10?[0,0]:this.sideRings}equals(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&fK.compareTable(this.board,e.board)}getRingCoords(e){const t=[];return this.forEachCoord((n,r)=>{r.isRing&&r.player===e&&t.push(n)}),t}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==Dee.UNREACHABLE}setAtUnsafe(t,n){const r=fK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.sideRings,this.turn)}}return e.SIZE=11,e})();class Fee extends t3{constructor(e,t){if(super(e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");this.ringTaken=Mw.ofNullable(t)}static of(e,t,n){const r=[],i=EJ.factory.fromMove(e,t).get();for(let s=e;!1===s.equals(t);s=s.getNext(i))r.push(s);return r.push(t),new Fee(r,n)}setRingTaken(e){return new Fee(this.capturedSpaces,e)}equals(e){return!(!1===super.equals(e)||!1===this.ringTaken.equals(e.ringTaken))}}Fee.encoder=new class extends sK{encode(e){return{captured:e.capturedSpaces.map(e=>yJ.encoder.encode(e)),ringTaken:yJ.encoder.encode(e.ringTaken.get())}}decode(e){const t=e;return nq(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new Fee(t.captured.map(e=>yJ.encoder.decode(e)),yJ.encoder.decode(t.ringTaken))}};class Uee extends xJ{constructor(e,t,n,r){super(),this.initialCaptures=e,this.start=t,this.end=n,this.finalCaptures=r}isInitialPlacement(){return this.end.isAbsent()}equals(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===fK.compareArray(this.initialCaptures,e.initialCaptures)||!1===fK.compareArray(this.finalCaptures,e.finalCaptures))}toString(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}}Uee.coordOptionalEncoder=e3(yJ.encoder),Uee.encoder=new class extends oK{encodeMove(e){const t={moveStart:yJ.encoder.encode(e.start),moveEnd:Uee.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=Fee.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=Fee.encoder.encode(e)}),t}decodeMove(e){const t=e;return nq(null!=t.moveStart,"Invalid encoded YinshMove"),new Uee(this.decodeArray(t,"initialCapture",Fee.encoder.decode),yJ.encoder.decode(t.moveStart),Uee.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",Fee.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class Bee extends TJ{getBoardValue(e){const t=this.ruler.getGameStatus(e);return t.isEndGame?IJ.fromWinner(t.winner):new IJ(e.gameState.sideRings[0]*cK.ZERO.getScoreModifier()+e.gameState.sideRings[1]*cK.ONE.getScoreModifier())}getListMoves(e){const t=[],n=e.gameState;if(n.isInitialPlacementPhase())for(const[r,i]of n.getCoordsAndContents())i===Dee.EMPTY&&t.push(new Uee([],r,Mw.empty(),[]));else{const e=this.ruler;this.getPossibleCaptureCombinations(n).forEach(r=>{const i=e.applyCaptures(n,r);this.getRingMoves(i).forEach(n=>{const s=e.applyRingMoveAndFlip(i,n.start,n.end);this.getPossibleCaptureCombinations(s).forEach(e=>{const i=new Uee(r,n.start,Mw.of(n.end),e);t.push(i)})})})}return t}getPossibleCaptureCombinations(e){const t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return a3.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(e=>class{static getCombinations(e,t){return nq(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(e=>this.getPermutations(e)).reduce((e,t)=>e.concat(t))}static getPermutations(e){const t=e.length,n=[e.slice()],r=new Array(t).fill(0);let i=1;for(;i<t;)if(r[i]<i){const t=i%2&&r[i],s=e[i];e[i]=e[t],e[t]=s,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}static getSubsetsOfSize(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];{const i=[];for(;r<=e.length-n;){const s=e[r];for(const e of t(n-1,r+1))e.push(s),i.push(e);++r}return i}}(t,0)}}.getCombinations(n,e.length).map(t=>e.map((e,n)=>new Fee(e.capturedSpaces,t[n])))).reduce((e,t)=>e.concat(t),[])}getRingMoves(e){const t=this.ruler,n=[];for(const r of this.getRingCoords(e))for(const i of t.getRingTargets(e,r))n.push({start:r,end:i});return n}getRingCoords(e){const t=e.getCurrentPlayer().value,n=[];return e.forEachCoord((e,r)=>{r===Dee.RINGS[t]&&n.push(e)}),n}}class Vee extends HJ{applyLegalMove(e,t,n){return new Lee(n.board,n.sideRings,n.turn+1)}applyCaptures(e,t){let n=e;return t.forEach(e=>{n=this.applyCapture(n,e)}),n}applyCapture(e,t){const n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new Lee(n,e.sideRings,e.turn),t.ringTaken.get())}takeRing(e,t){const n=e.getCurrentPlayer().value,r=e.setAt(t,Dee.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new Lee(r,i,e.turn)}applyCaptureWithoutTakingRing(e,t){return t.forEach(t=>{e=e.setAt(t,Dee.EMPTY)}),e.board}ringSelectionValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)===Dee.RINGS[n]?QG.SUCCESS:QG.failure(xee.CAPTURE_SHOULD_TAKE_RING())}applyRingMoveAndFlip(e,t,n){const r=e.getCurrentPlayer().value;let i=e.setAt(t,Dee.MARKERS[r]);i=i.setAt(n,Dee.RINGS[r]);const s=EJ.factory.fromMove(t,n).get();for(let o=t.getNext(s);!1===o.equals(n);o=o.getNext(s)){const e=i.getPieceAt(o);e!==Dee.EMPTY&&(i=i.setAt(o,e.flip()))}return i}isLegal(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return ZG.failure(xee.NO_MARKERS_IN_INITIAL_PHASE());const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();const s=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(s,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();const a=this.applyCaptures(s,e.finalCaptures),l=this.noMoreCapturesValidity(a);return l.isFailure()?l.toFailedFallible():ZG.success(a)}initialPlacementValidity(e,t){if(!0!==e.isInitialPlacementPhase())return ZG.failure(xee.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==Dee.EMPTY)return ZG.failure(OJ.MUST_CLICK_ON_EMPTY_SPACE());const n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;const i=e.setAt(t,Dee.of(n,!0)).board,s=new Lee(i,r,e.turn);return ZG.success(s)}moveStartValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==Dee.RINGS[n]?QG.failure(xee.SHOULD_SELECT_PLAYER_RING()):QG.SUCCESS}moveValidity(e,t,n){const r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==Dee.EMPTY)return QG.failure(xee.SHOULD_END_MOVE_ON_EMPTY_SPACE());const i=EJ.factory.fromMove(t,n);if(i.isFailure())return QG.failure(xee.MOVE_DIRECTION_INVALID());const s=i.get();let o=!1;for(let a=t.getNext(s);!1===a.equals(n);a=a.getNext(s)){const t=e.getPieceAt(a);if(t===Dee.EMPTY){if(o)return QG.failure(xee.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(t.isRing)return QG.failure(xee.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return QG.SUCCESS}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=this.applyCapture(n,r)}return QG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer().value;for(const r of t.capturedSpaces)if(e.getPieceAt(r)!==Dee.MARKERS[n])return QG.failure(xee.CAN_ONLY_CAPTURE_YOUR_MARKERS());return e.getPieceAt(t.ringTaken.get())!==Dee.RINGS[n]?QG.failure(xee.CAPTURE_SHOULD_TAKE_RING()):QG.SUCCESS}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?QG.SUCCESS:QG.failure(xee.MISSING_CAPTURES())}getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=this.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o,a=i;for(o=i;e.isOnBoard(o);o=o.getNext(s)){const n=e.getPieceAt(o);if(n.player===t&&!1===n.isRing)0===r&&(a=o),r+=1;else{if(r>=5)break;r=0}}return r>=5?Mw.of({start:a,end:o,dir:s}):Mw.empty()}getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(e=>{for(let t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(Fee.of(t,t.getNext(e.dir,4)))}),n}getRingTargets(e,t){const n=[];for(const r of EJ.factory.all){let i=!1;for(let s=t.getNext(r);e.isOnBoard(s);s=s.getNext(r)){const t=e.getPieceAt(s);if(t===Dee.EMPTY){if(n.push(s),i)break}else{if(t.isRing)break;i=!0}}}return n}getGameStatus(e){return e.gameState.isInitialPlacementPhase()?zJ.ONGOING:e.gameState.sideRings[0]>=3?zJ.ZERO_WON:e.gameState.sideRings[1]>=3?zJ.ONE_WON:zJ.ONGOING}}const $ee=Dee.EMPTY,zee=Dee.UNREACHABLE,Hee=Dee.MARKER_ZERO,Gee=Dee.RING_ZERO,qee=Dee.MARKER_ONE,Wee=Dee.RING_ONE;let jee=(()=>{class e{}return e.MUST_ALIGN_FIVE=()=>$localize`Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time.`,e.MUST_CAPTURE_TWO=()=>$localize`Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again.`,e})();class Zee{constructor(){this.tutorial=[jJ.informational($localize`Goal of the game`,$localize`The goal at Yinsh is to capture three rings in total.
        The rings taken are shown on the top left for the dark player,
        and on the bottom right for the light player. Here, Dark won the game.
        Note that on the board you have two types of pieces for each player:
        rings (empty circles) and markers (full circles).`,new Lee([[zee,zee,zee,zee,zee,zee,$ee,$ee,$ee,$ee,zee],[zee,zee,zee,zee,$ee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,zee,Hee,Wee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,$ee,Hee,$ee,Wee,$ee,qee,$ee,$ee,$ee],[zee,$ee,Gee,qee,$ee,$ee,Wee,Hee,$ee,$ee,$ee],[zee,$ee,$ee,Hee,qee,$ee,$ee,$ee,$ee,$ee,zee],[$ee,$ee,$ee,Hee,$ee,$ee,$ee,Wee,$ee,$ee,zee],[$ee,$ee,$ee,qee,Hee,Gee,$ee,$ee,$ee,zee,zee],[$ee,$ee,$ee,$ee,$ee,$ee,$ee,$ee,zee,zee,zee],[$ee,$ee,$ee,$ee,$ee,$ee,$ee,zee,zee,zee,zee],[zee,$ee,$ee,$ee,$ee,zee,zee,zee,zee,zee,zee]],[3,1],20)),jJ.anyMove($localize`Initial board and placement phase`,$localize`The initial board is empty.
        At the beginning of the game, each player puts one of its ring on the board at their turn.
        This phase stops when all rings have been placed on the board.
        Put one of your ring on the board by clicking the space where you want to place it.`,new Lee(Lee.getInitialState().board,[5,5],0),new Uee([],new yJ(5,5),Mw.empty(),[]),$localize`Congratulations!`),jJ.anyMove($localize`Putting a marker`,$localize`Once the initial phase is done and all rings are on the board, you need to place markers on the board.
        To do so, put a marker in a ring by clicking on that ring.
        Then, the ring must be moved in a straight line, in any direction.
        A ring cannot pass through other rings during its move.
        If it goes over a group of markers, your move must stop at the first empty space after that group.
        All markers in the group are then flipped and their color change.<br/><br/>
        You're playing Dark, do a move.`,new Lee([[zee,zee,zee,zee,zee,zee,$ee,$ee,$ee,$ee,zee],[zee,zee,zee,zee,$ee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,zee,Wee,$ee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,Wee,$ee,$ee,Wee,$ee,$ee,$ee,$ee,$ee],[zee,$ee,Gee,qee,$ee,$ee,Wee,$ee,$ee,$ee,$ee],[zee,$ee,$ee,qee,$ee,$ee,$ee,$ee,$ee,$ee,zee],[$ee,$ee,$ee,$ee,Gee,$ee,$ee,Wee,$ee,$ee,zee],[$ee,$ee,$ee,$ee,$ee,Gee,$ee,$ee,$ee,zee,zee],[$ee,$ee,$ee,Gee,$ee,$ee,$ee,zee,zee,zee,zee],[$ee,$ee,$ee,$ee,$ee,$ee,$ee,zee,zee,zee,zee],[zee,$ee,$ee,$ee,$ee,zee,zee,zee,zee,zee,zee]],[0,0],20),new Uee([],new yJ(2,4),Mw.of(new yJ(4,4)),[]),$localize`Congratulations!`),jJ.fromPredicate($localize`Getting a ring by aligning 5 markers`,$localize`Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.
        To do so, you need to align 5 markers of your color.
        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.
        You will then have one more point.
        You must capture when you can.<br/><br/>
        You're playing Dark, perform a capture!`,new Lee([[zee,zee,zee,zee,zee,zee,$ee,$ee,$ee,$ee,zee],[zee,zee,zee,zee,$ee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,zee,Wee,$ee,$ee,$ee,$ee,$ee,$ee,$ee],[zee,zee,Wee,$ee,$ee,Wee,$ee,$ee,$ee,$ee,$ee],[zee,$ee,Hee,Hee,Gee,qee,qee,$ee,$ee,$ee,$ee],[zee,$ee,$ee,Wee,$ee,$ee,$ee,$ee,$ee,$ee,zee],[$ee,$ee,$ee,$ee,Gee,$ee,$ee,Wee,$ee,$ee,zee],[$ee,$ee,$ee,$ee,$ee,Gee,$ee,$ee,$ee,zee,zee],[$ee,$ee,$ee,Gee,$ee,$ee,$ee,Gee,zee,zee,zee],[$ee,$ee,$ee,$ee,$ee,$ee,$ee,zee,zee,zee,zee],[zee,$ee,$ee,$ee,$ee,zee,zee,zee,zee,zee,zee]],[0,0],20),new Uee([],new yJ(4,4),Mw.of(new yJ(7,4)),[Fee.of(new yJ(2,4),new yJ(6,4),new yJ(7,4))]),(e,t)=>1===t.sideRings[cK.ZERO.value]?QG.SUCCESS:QG.failure(jee.MUST_ALIGN_FIVE()),$localize`Congratulations!`),jJ.fromPredicate($localize`Compound captures`,$localize`During a turn, you could have to choose between multiple captures,
        or you could even capture multiple times!
        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>
        Here, you can capture two rings, do it!`,new Lee([[zee,zee,zee,zee,zee,zee,$ee,$ee,$ee,$ee,zee],[zee,zee,zee,zee,Gee,$ee,$ee,Wee,Wee,Gee,$ee],[zee,zee,zee,Gee,$ee,$ee,qee,Wee,$ee,Gee,$ee],[zee,zee,$ee,Gee,$ee,$ee,$ee,$ee,$ee,Wee,$ee],[zee,$ee,$ee,$ee,$ee,Hee,$ee,$ee,Wee,$ee,$ee],[zee,$ee,$ee,$ee,Hee,Hee,$ee,qee,$ee,$ee,zee],[$ee,$ee,$ee,Hee,$ee,Hee,$ee,$ee,$ee,$ee,zee],[$ee,$ee,Hee,$ee,$ee,Hee,$ee,$ee,$ee,zee,zee],[$ee,Hee,$ee,$ee,$ee,Hee,$ee,$ee,zee,zee,zee],[$ee,$ee,$ee,$ee,$ee,Hee,$ee,zee,zee,zee,zee],[zee,$ee,$ee,$ee,$ee,zee,zee,zee,zee,zee,zee]],[0,0],10),new Uee([Fee.of(new yJ(5,4),new yJ(1,8),new yJ(3,2)),Fee.of(new yJ(5,9),new yJ(5,5),new yJ(3,3))],new yJ(4,1),Mw.of(new yJ(4,2)),[]),(e,t)=>2===t.sideRings[cK.ZERO.value]?QG.SUCCESS:QG.failure(jee.MUST_CAPTURE_TWO()),$localize`Congratulations!`)]}}function Yee(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringOuterSize)}}function Kee(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","ring_",t,"_",r,""),ha("ngClass",n.ringClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.ringMidSize)}}function Qee(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringInnerSize)}}function Jee(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","marker_",t,"_",r,""),ha("ngClass",n.markerClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.markerSize)}}function Xee(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),ga(1,"polyline",4),pa(2,"g",5),la(3,Yee,1,3,"circle",6),la(4,Kee,1,6,"circle",7),la(5,Qee,1,3,"circle",6),la(6,Jee,1,6,"circle",8),fa(),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index;Ia("id","click_",t,"_",r,""),Ts(1),Ia("id","space_",t,"_",r,""),ha("ngClass",n.spaceClasses),ra("points",n.coordinates),Ts(1),Ia("id","pieceGroup_",t,"_",r,""),ha("ngClass",n.removedClass),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isMarker)}}function ete(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Xee,7,13,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",null!=e)}}function tte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,ete,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function nte(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",12),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","selected_",e.x,"_",e.y,""),ra("points",n.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function rte(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t)}),fa()}if(2&e){const e=ba().$implicit,t=ba();Ia("id","selectable_",e.x,"_",e.y,""),ra("points",t.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function ite(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,rte,1,3,"polyline",13),fa()),2&e){const e=ba();Ts(1),ha("ngIf",e.isPlayerTurn())}}function ste(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",15),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.viewInfo.spaceInfo[e.y][e.x].center.x-n.viewInfo.indicatorSize/2)("y",n.viewInfo.spaceInfo[e.y][e.x].center.y-n.viewInfo.indicatorSize/2)("width",n.viewInfo.indicatorSize)("height",n.viewInfo.indicatorSize)}}function ote(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),ga(2,"circle",9),ga(3,"circle",17),fa()),2&e){const e=t.index,n=ba().$implicit,r=ba();Ts(1),Ia("id","player_",n,"_sideRing_",e+1,""),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringOuterSize),Ts(1),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringInnerSize),Ts(1),ha("ngClass",r.viewInfo.sideRingClass[n]),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringMidSize)}}const ate=function(){return[]};function lte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,ote,4,12,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",wu(1,ate).constructor(n.viewInfo.sideRings[e]))}}const cte=function(){return[0,1]};class ute extends _J{constructor(e){super(e),this.movePhase="MOVE_START",this.moveStart=Mw.empty(),this.moveEnd=Mw.empty(),this.currentlyMoved=[],this.currentCapture=Mw.empty(),this.initialCaptures=[],this.finalCaptures=[],this.possibleCaptures=[],this.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:ute.MARKER_SIZE,ringOuterSize:ute.RING_OUTER_SIZE,ringMidSize:ute.RING_MID_SIZE,ringInnerSize:ute.RING_INNER_SIZE,indicatorSize:ute.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},this.scores=Mw.of([0,0]),this.rules=new Vee(Lee),this.availableMinimaxes=[new Bee(this.rules,"YinshMinimax")],this.encoder=Uee.encoder,this.tutorial=(new Zee).tutorial,this.hexaLayout=new wJ(1.5*ute.RING_OUTER_SIZE,new yJ(2*ute.RING_OUTER_SIZE,0),PJ.INSTANCE),this.constructedState=this.rules.node.gameState,this.constructedState.allCoords().forEach(e=>{null==this.viewInfo.spaceInfo[e.y]&&(this.viewInfo.spaceInfo[e.y]=[]),this.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:this.getHexaCoordsAt(e),center:this.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}})}updateBoard(){this.cancelMoveAttempt(),this.scores=Mw.of(this.rules.node.gameState.countScores())}updateViewInfo(){this.constructedState.allCoords().forEach(e=>{this.viewInfo.spaceInfo[e.y][e.x].spaceClasses=this.getSpaceClasses(e);const t=this.constructedState.getPieceAt(e);this.viewInfo.spaceInfo[e.y][e.x].removedClass="",this.setRingInfo(e,t),this.setMarkerInfo(e,t)});for(const e of cK.PLAYERS)this.viewInfo.sideRings[e.value]=this.constructedState.sideRings[e.value];switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];for(const e of this.possibleCaptures)for(const t of e.capturedSpaces)this.viewInfo.selectableCoords.push(t);break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}showCurrentMoveCaptures(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());for(const e of this.initialCaptures)this.markCurrentCapture(e);for(const e of this.finalCaptures)this.markCurrentCapture(e)}getSpaceClasses(e){return this.currentlyMoved.some(t=>t.equals(e))?["moved"]:[]}setRingInfo(e,t){if(t.isRing){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}setMarkerInfo(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==Dee.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=Mw.empty(),this.moveStart=Mw.empty(),this.moveEnd=Mw.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}showLastMove(){const e=this.rules.node.move;if(e.isPresent()){const t=e.get();if(t.isInitialPlacement())this.viewInfo.spaceInfo[t.start.y][t.start.x].spaceClasses=["moved"];else{for(const n of this.coordsBetween(t.start,t.end.get()))this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["moved"];const e=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();t.initialCaptures.forEach(t=>this.showLastMoveCapture(t,e)),t.finalCaptures.forEach(t=>this.showLastMoveCapture(t,e))}}}coordsBetween(e,t){const n=[],r=EJ.factory.fromMove(e,t).get();for(let i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==Dee.EMPTY&&n.push(i),n.push(t);return n}showLastMoveCapture(e,t){for(const n of e.capturedSpaces)this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["captured"],t&&this.markRemovedMarker(n,this.rules.node.gameState.getCurrentPlayer().getOpponent());this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}moveToInitialCaptureOrMovePhase(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),QG.SUCCESS}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());switch(t.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_FIRST":return t.selectCaptureFirstCoord(e);case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_LAST":return t.selectCaptureLastCoord(e);case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":return t.selectRing(e);case"MOVE_START":return t.selectMoveStart(e);case"MOVE_END":return t.selectMoveEnd(e)}})()}selectCaptureFirstCoord(e){var t=this;return Pw(function*(){const n=[];if(t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1)t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(n);else{if(0===n.length)return t.cancelMove(xee.MISSING_CAPTURES());t.selectCapture(n[0])}return QG.SUCCESS})()}moveToCaptureSelectLast(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;for(const t of e)for(const e of t.capturedSpaces)this.viewInfo.selectableCoords.push(e);switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}selectCaptureLastCoord(e){var t=this;return Pw(function*(){const n=[];return t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1?t.cancelMove(xee.AMBIGUOUS_CAPTURE_COORD()):0===n.length?t.cancelMove(xee.MISSING_CAPTURES()):t.selectCapture(n[0])})()}selectCapture(e){switch(this.currentCapture=Mw.of(e),this.constructedState=new Lee(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),QG.SUCCESS}markCurrentCapture(e){for(const t of e.capturedSpaces)this.viewInfo.selectedCoords.push(t),this.markRemovedMarker(t,this.rules.node.gameState.getCurrentPlayer());e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}markRemovedMarker(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setMarkerInfo(e,Dee.MARKERS[t.value])}markRemovedRing(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setRingInfo(e,Dee.RINGS[t.value])}selectRing(e){var t=this;return Pw(function*(){const n=t.rules.ringSelectionValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.constructedState=t.rules.takeRing(t.constructedState,e);const r=t.currentCapture.get().setRingTaken(e);switch(t.currentCapture=Mw.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase){case"INITIAL_CAPTURE_SELECT_RING":return t.initialCaptures.push(r),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),QG.SUCCESS);default:return Ow.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(r),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),QG.SUCCESS)}})()}moveToMovePhase(){return this.movePhase="MOVE_START",this.updateViewInfo(),QG.SUCCESS}tryMove(){var e=this;return Pw(function*(){const t=new Uee(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures);return yield e.chooseMove(t,e.rules.node.gameState,e.scores.get())})()}selectMoveStart(e){var t=this;return Pw(function*(){if(t.constructedState.isInitialPlacementPhase()){const n=t.rules.initialPlacementValidity(t.constructedState,e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveStart=Mw.of(e),t.tryMove())}{const n=t.rules.moveStartValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.moveStart=Mw.of(e),t.movePhase="MOVE_END",t.updateViewInfo()}return QG.SUCCESS})()}selectMoveEnd(e){var t=this;return Pw(function*(){const n=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveEnd=Mw.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove())})()}moveToFinalCapturePhaseOrTryMove(){var e=this;return Pw(function*(){return e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),QG.SUCCESS)})()}}function hte(e,t){if(1&e&&(pa(0,"option",5),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.urlName),Ts(1),Ja(e.name)}}ute.RING_OUTER_SIZE=40,ute.RING_MID_SIZE=34,ute.RING_INNER_SIZE=28,ute.MARKER_SIZE=ute.RING_INNER_SIZE,ute.INDICATOR_SIZE=10,ute.\u0275fac=function(e){return new(e||ute)(ua(eq))},ute.\u0275cmp=Xe({type:ute,selectors:[["app-yinsh"]],features:[Go],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,tte,2,1,"g",1),la(2,nte,2,3,"g",1),la(3,ite,2,1,"g",1),la(4,ste,2,4,"g",1),la(5,lte,2,2,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.spaceInfo),Ts(1),ha("ngForOf",t.viewInfo.selectedCoords),Ts(1),ha("ngForOf",t.viewInfo.selectableCoords),Ts(1),ha("ngForOf",t.viewInfo.targets),Ts(1),ha("ngForOf",wu(5,cte)))},directives:[tp,rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let dte=(()=>{class e{}return e.ABALONE=()=>$localize`Use simple mechanics to push 6 of the opponent's pieces out of the board!`,e.APAGOS=()=>$localize`Very simple game, but, will you be able to win everytime?`,e.AWALE=()=>$localize`The international version of the famous African strategy game!`,e.BRANDHUB=()=>$localize`The Irish version of the Tafl game family!`,e.COERCEO=()=>$localize`Get rid of all of your opponent's pieces on a board that shrinks little by little!`,e.CONSPIRATEURS=()=>$localize`Hide all of your pieces before your opponent does, or risk to be discovered!`,e.DIAM=()=>$localize`Drop your pieces and move them around to align two pieces of the same color across the board to win!`,e.DVONN=()=>$localize`Stack your pieces and control as many stacks as you can to win!`,e.ENCAPSULE=()=>$localize`An enhanced tic-tac-toe where piece can encapsule other and prevent them to win.`,e.EPAMINONDAS=()=>$localize`An antiquity-war inspired game. Be the first to pierce your opponent's lines!`,e.GIPF=()=>$localize`A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!`,e.GO=()=>$localize`The oldest strategy game still practiced widely. A territory control game.`,e.KAMISADO=()=>$localize`Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!`,e.LINES_OF_ACTION=()=>$localize`Regroup your pieces to win. But your possible moves will often change!`,e.LODESTONE=()=>$localize`Push and crush your opponent's pieces using magnetic forces!`,e.MARTIAN_CHESS=()=>$localize`Win points by capturing pieces, but you only control pieces on your side of the board!`,e.P4=()=>$localize`The classical 4 in a row game!`,e.PENTAGO=()=>$localize`Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!`,e.PYLOS=()=>$localize`Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!`,e.QUARTO=()=>$localize`Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!`,e.QUIXO=()=>$localize`Align 5 of your pieces on a board where pieces slide!`,e.REVERSI=()=>$localize`Sandwich your opponent's pieces to dominate the board!`,e.SAHARA=()=>$localize`Immobilize one of your opponent's pyramids before your opponent does!`,e.SIAM=()=>$localize`Be the first to push a mountain out of the board!`,e.SIX=()=>$localize`Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!`,e.TABLUT=()=>$localize`The Viking board game! Invaders must capture the king, defender must make him escape!`,e.YINSH=()=>$localize`Align your pieces to score points, but beware, pieces can flip!`,e})(),pte=(()=>{class e{constructor(e,t,n,r,i,s=!0){this.name=e,this.urlName=t,this.component=n,this.creationDate=r,this.description=i,this.display=s}}return e.ALL_GAMES=()=>[new e("MinimaxTesting","MinimaxTesting",y6,new Date("1970-01-01"),"",!1),new e($localize`Four in a Row`,"P4",N6,new Date("2018-08-28"),dte.P4()),new e($localize`Awal`,"Awale",FX,new Date("2018-11-29"),dte.AWALE()),new e($localize`Quarto`,"Quarto",d7,new Date("2018-12-09"),dte.QUARTO()),new e($localize`Tablut`,"Tablut",Ree,new Date("2018-12-27"),dte.TABLUT()),new e($localize`Reversi`,"Reversi",$7,new Date("2019-01-16"),dte.REVERSI()),new e($localize`Go`,"Go",Q3,new Date("2019-12-21"),dte.GO()),new e($localize`Encapsule`,"Encapsule",F2,new Date("2019-12-30"),dte.ENCAPSULE()),new e($localize`Siam`,"Siam",H9,new Date("2020-01-11"),dte.SIAM()),new e($localize`Sahara`,"Sahara",o9,new Date("2020-02-29"),dte.SAHARA()),new e($localize`Pylos`,"Pylos",E8,new Date("2020-10-02"),dte.PYLOS()),new e($localize`Kamisado`,"Kamisado",A4,new Date("2020-10-03"),dte.KAMISADO()),new e($localize`Quixo`,"Quixo",T7,new Date("2020-10-15"),dte.QUIXO()),new e($localize`Dvonn`,"Dvonn",p2,new Date("2020-10-21"),dte.DVONN()),new e($localize`Epaminondas`,"Epaminondas",X2,new Date("2021-01-16"),dte.EPAMINONDAS()),new e($localize`Gipf`,"Gipf",S3,new Date("2021-02-22"),dte.GIPF()),new e($localize`Coerceo`,"Coerceo",Y1,new Date("2021-03-21"),dte.COERCEO()),new e($localize`Six`,"Six",dee,new Date("2021-04-08"),dte.SIX()),new e($localize`Lines of Action`,"LinesOfAction",G4,new Date("2021-04-28"),dte.LINES_OF_ACTION()),new e($localize`Pentago`,"Pentago",J6,new Date("2021-05-23"),dte.PENTAGO()),new e($localize`Abalone`,"Abalone",dX,new Date("2021-07-13"),dte.ABALONE()),new e($localize`Yinsh`,"Yinsh",ute,new Date("2021-07-31"),dte.YINSH()),new e($localize`Apagos`,"Apagos",TX,new Date("2021-11-04"),dte.APAGOS()),new e($localize`Diam`,"Diam",F0,new Date("2021-11-30"),dte.DIAM()),new e($localize`Brandhub`,"Brandhub",C1,new Date("2021-12-07"),dte.BRANDHUB()),new e($localize`Conspirateurs`,"Conspirateurs",m0,new Date("2021-12-30"),dte.CONSPIRATEURS()),new e($localize`Lodestone`,"Lodestone",S5,new Date("2022-06-24"),dte.LODESTONE()),new e($localize`Martian Chess`,"MartianChess",o6,new Date("2022-07-01"),dte.MARTIAN_CHESS())].sort((e,t)=>e.name.localeCompare(t.name)),e})(),fte=(()=>{class e{constructor(){this.games=pte.ALL_GAMES().filter(e=>!0===e.display),this.pickGame=new xu}onChange(e){this.pickGame.emit(e.target.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){let e;return e=$localize`Pick a game`,[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],e,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"select",1),Ea("change",function(e){return t.onChange(e)}),pa(2,"option",2),sc(3,3),fa(),la(4,hte,2,2,"option",4),fa(),fa()),2&e&&(Ts(4),ha("ngForOf",t.games))},directives:[Pg,kg,tp],encapsulation:2}),e})();function gte(e,t){if(1&e){const e=va();pa(0,"div",26),pa(1,"div",27),Ea("click",function(){return Gt(e),ba().closeInfo()}),fa(),pa(2,"div",28),pa(3,"header",29),pa(4,"p",30),Qa(5),fa(),pa(6,"button",31),Ea("click",function(){return Gt(e),ba().closeInfo()}),fa(),fa(),pa(7,"section",32),pa(8,"div",6),pa(9,"div",33),pa(10,"p",34),ga(11,"img",35),fa(),fa(),pa(12,"div",7),pa(13,"div",13),Qa(14),fa(),fa(),fa(),pa(15,"div",6),pa(16,"div",33),pa(17,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createGame(t.gameInfoDetails.get().urlName)}),ga(18,"fa-icon",37),Qa(19,"\xa0"),pa(20,"span"),sc(21,38),fa(),fa(),fa(),pa(22,"div",33),pa(23,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createLocalGame(t.gameInfoDetails.get().urlName)}),ga(24,"fa-icon",37),Qa(25,"\xa0"),pa(26,"span"),sc(27,39),fa(),fa(),fa(),pa(28,"div",33),pa(29,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createTutorial(t.gameInfoDetails.get().urlName)}),ga(30,"fa-icon",37),Qa(31,"\xa0"),pa(32,"span"),sc(33,40),fa(),fa(),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba();Ts(5),Ja(e.gameInfoDetails.get().name),Ts(6),Ia("src","assets/images/",e.theme,"/",e.gameInfoDetails.get().urlName,".png",_i),Ts(3),Xa(" ",e.gameInfoDetails.get().description," "),Ts(4),ha("icon",e.iconOnlineGame),Ts(6),ha("icon",e.iconLocalGame),Ts(6),ha("icon",e.iconTutorial)}}function mte(e,t){if(1&e){const e=va();pa(0,"div",8),pa(1,"div",9),pa(2,"p",10),Qa(3),fa(),fa(),pa(4,"div",42),pa(5,"figure",34),pa(6,"img",43),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),fa(),pa(7,"figcaption",44),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),pa(8,"div",45),Qa(9,"?"),fa(),fa(),pa(10,"figcaption",46),pa(11,"a",47),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createGame(t.urlName)}),ga(12,"fa-icon",37),fa(),pa(13,"a",48),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createLocalGame(t.urlName)}),ga(14,"fa-icon",37),fa(),pa(15,"a",49),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createTutorial(t.urlName)}),ga(16,"fa-icon",37),fa(),fa(),fa(),fa(),pa(17,"div",50),Qa(18),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(3),Ja(e.name),Ts(3),Ta("id","image_",e.urlName,""),Ia("src","assets/images/",n.theme,"/",e.urlName,".png",_i),Ts(5),Ta("id","playOnline_",e.urlName,""),Ts(1),ha("icon",n.iconOnlineGame),Ts(1),Ta("id","playLocally_",e.urlName,""),Ts(1),ha("icon",n.iconLocalGame),Ts(1),Ta("id","startTutorial_",e.urlName,""),Ts(1),ha("icon",n.iconTutorial),Ts(2),Xa(" ",e.description," ")}}function yte(e,t){if(1&e&&(pa(0,"div",7),la(1,mte,19,11,"div",41),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let vte=(()=>{class e{constructor(e,t){this.router=e,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=PK,this.iconLocalGame=SK,this.iconTutorial=EK,this.gameInfoDetails=Mw.empty(),this.theme=t.getTheme();const n=pte.ALL_GAMES().filter(e=>!0===e.display);let r=0;for(let i=0;i<n.length;i++)i<this.numberOfColumns&&this.games.push([]),this.games[r].push(n[i]),r=(r+1)%this.numberOfColumns}createGame(e){var t=this;return Pw(function*(){return t.router.navigate(["/play",e])})()}createLocalGame(e){var t=this;return Pw(function*(){return t.router.navigate(["/local",e])})()}createTutorial(e){return this.router.navigate(["/tutorial",e])}openInfo(e){this.gameInfoDetails=Mw.of(e)}closeInfo(){this.gameInfoDetails=Mw.empty()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(CK))},e.\u0275cmp=Xe({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`EveryBoard`,t=$localize`EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.${"\ufffd#6\ufffd\ufffd/#6\ufffd"}:LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn.`,n=$localize`Play online`,r=$localize`Create an online game`,i=$localize`See the game list`,s=$localize`Play offline`,o=$localize`Play`,a=$localize`Learn`,l=$localize`Play online`,c=$localize`Play offline`,u=$localize`Learn the rules`,h=$localize`Play online`,d=$localize`Play offline`,p=$localize`Learn the rules`,[[1,"hero"],[1,"hero-body"],[1,"title"],e,[1,"subtitle"],t,[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],n,[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],r,["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],i,s,[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],o,["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],a,["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],l,c,u,["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",h,1,"button",3,"id","click"],["data-tooltip",d,1,"button",3,"id","click"],["data-tooltip",p,1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(pa(0,"section",0),pa(1,"div",1),pa(2,"p",2),sc(3,3),fa(),pa(4,"p",4),rc(5,5),ga(6,"br"),ic(),fa(),fa(),pa(7,"div",6),pa(8,"div",7),pa(9,"div",8),pa(10,"header",9),pa(11,"p",10),sc(12,11),fa(),fa(),pa(13,"div",12),pa(14,"div",13),pa(15,"button",14),sc(16,15),fa(),pa(17,"button",16),sc(18,17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",7),pa(20,"div",8),pa(21,"header",9),pa(22,"p",10),sc(23,18),fa(),fa(),pa(24,"div",12),pa(25,"div",19),pa(26,"button",20),sc(27,21),fa(),pa(28,"button",22),sc(29,23),fa(),fa(),fa(),fa(),fa(),fa(),la(30,gte,34,7,"div",24),pa(31,"div",6),la(32,yte,2,1,"div",25),fa(),fa()),2&e&&(Ts(30),ha("ngIf",t.gameInfoDetails.isPresent()),Ts(2),ha("ngForOf",t.games))},directives:[m_,rp,tp,QQ],encapsulation:2}),e})(),_te=(()=>{class e{constructor(e){this.element=e}ngAfterViewInit(){this.element.nativeElement.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(Sc))},e.\u0275dir=st({type:e,selectors:[["","autofocus",""]]}),e})(),Cte=(()=>{class e{constructor(e){this.shown=!1,this.input=e.nativeElement.parentNode.previousSibling,e.nativeElement.addEventListener("click",e=>{this.toggle()})}toggle(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(Sc))},e.\u0275dir=st({type:e,selectors:[["","toggleVisibility",""]]}),e})();function Ete(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),sc(2,31),fa(),pa(3,"div",32),Qa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ja(e.errorMessage)}}const wte=function(){return["/register"]},Ste=function(){return["/reset-password"]};let bte=(()=>{class e{constructor(e,t){this.router=e,this.connectedUserService=t,this.faEye=bK,this.loginForm=new sg({email:new ig,password:new ig})}ngOnInit(){var e=this;this.connectedUserService.getUserObs().subscribe(function(){var t=Pw(function*(t){t!==eK.NOT_CONNECTED&&(yield e.redirect())});return function(e){return t.apply(this,arguments)}}())}loginWithEmail(e){var t=this;return Pw(function*(){const n=yield t.connectedUserService.doEmailLogin(e.email,e.password);n.isFailure()&&(t.errorMessage=n.getReason())})()}loginWithGoogle(){var e=this;return Pw(function*(){const t=yield e.connectedUserService.doGoogleLogin();t.isFailure()&&(e.errorMessage=t.getReason())})()}redirect(){var e=this;return Pw(function*(){return e.router.navigate(["/lobby"])})()}canLogin(){return!(""===(this.loginForm.value.email??"")||""===(this.loginForm.value.password??""))}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h;return e=$localize`Log in`,t=$localize`Email`,n=$localize`Email`,r=$localize`Password`,i=$localize`Password`,s=$localize`Log in`,o=$localize`Log in with Google`,a=$localize`No account?`,l=$localize`Register`,c=$localize`Forgot your password?`,u=$localize`Reset your password`,h=$localize`Connection error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",n,"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],r,[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",i,"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],s,["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],o,["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],a,[3,"routerLink"],l,c,u,["role","alert",1,"message","is-danger"],[1,"message-header"],h,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),sc(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),fa(),fa(),fa(),fa(),pa(12,"div",4),pa(13,"div",5),pa(14,"label",12),sc(15,13),fa(),fa(),pa(16,"div",8),pa(17,"div",9),pa(18,"div",14),ga(19,"input",15),pa(20,"span",16),ga(21,"fa-icon",17),fa(),fa(),fa(),fa(),fa(),pa(22,"div",4),ga(23,"div",5),pa(24,"div",8),pa(25,"div",9),pa(26,"div",10),pa(27,"button",18),Ea("click",function(){return t.loginWithEmail(t.loginForm.value)}),sc(28,19),fa(),fa(),fa(),fa(),fa(),pa(29,"div",4),ga(30,"div",5),pa(31,"div",8),pa(32,"div",9),pa(33,"div",10),pa(34,"button",20),Ea("click",function(){return t.loginWithGoogle()}),sc(35,21),fa(),fa(),fa(),fa(),fa(),la(36,Ete,5,1,"div",22),pa(37,"p",23),ma(38),sc(39,24),ya(),Qa(40,"\xa0 "),pa(41,"a",25),sc(42,26),fa(),fa(),pa(43,"p",23),ma(44),sc(45,27),ya(),Qa(46,"\xa0 "),pa(47,"a",25),sc(48,28),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.loginForm),Ts(18),ha("icon",t.faEye),Ts(6),ha("disabled",!t.canLogin()),Ts(9),ha("ngIf",t.errorMessage),Ts(5),ha("routerLink",wu(6,wte)),Ts(6),ha("routerLink",wu(7,Ste)))},directives:[pg,Df,_g,rf,xf,Eg,_te,Mg,QQ,Cte,rp,y_],encapsulation:2}),e})(),Pte=(()=>{class e{constructor(e){this.partDAO=e,this.unsubscribe=Mw.empty(),this.activePartsBS=new Em([]),this.activePartsObs=this.activePartsBS.asObservable()}getActivePartsObs(){return this.activePartsObs}startObserving(){nq(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");const e=new cq(e=>{const t=this.activePartsBS.value.concat(...e);this.activePartsBS.next(t)},e=>{const t=this.activePartsBS.value;for(const n of e)t.forEach(e=>{e.id===n.id&&(e.data=n.data)});this.activePartsBS.next(t)},e=>{const t=[];for(const n of this.activePartsBS.value)e.some(e=>e.id===n.id)||t.push(n);this.activePartsBS.next(t)});this.unsubscribe=Mw.of(this.partDAO.observeActiveParts(e))}stopObserving(){nq(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=Mw.empty()}}return e.\u0275fac=function(t){return new(t||e)(Or(sq))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),Ote=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}navigateToOnlineGameCreation(){var e=this;return Pw(function*(){yield e.router.navigate(["/play",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Create an online game`,[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.navigateToOnlineGameCreation()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[fte],encapsulation:2}),e})(),Tte=(()=>{class e{transform(e){return xd(1e3*e.seconds,"HH:mm:ss","en-US")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"firebaseDate",type:e,pure:!0}),e})();const Ite=["chatDiv"];function kte(e,t){1&e&&(ma(0),sc(1,5),ya())}function Ate(e,t){1&e&&sc(0,6),2&e&&(oc(ba().unreadMessagesText),ac(0))}function Mte(e,t){if(1&e){const e=va();pa(0,"button",11),Ea("click",function(){return Gt(e),ba(2).scrollToBottom()}),Qa(1),fa()}if(2&e){const e=ba(2);Ts(1),Xa("",e.unreadMessagesText," \u2193")}}function Nte(e,t){if(1&e&&(pa(0,"p"),Qa(1),ku(2,"firebaseDate"),pa(3,"b",12),Qa(4),fa(),pa(5,"span",13),Qa(6),fa(),fa()),2&e){const e=t.$implicit;Ts(1),Xa(" [",Au(2,3,e.postedTime),"] "),Ts(3),Xa("",e.sender.name," : "),Ts(2),Ja(e.content)}}function Rte(e,t){if(1&e){const e=va();pa(0,"div"),la(1,Mte,2,1,"button",7),pa(2,"div",8,9),Ea("scroll",function(){return Gt(e),ba().updateCurrentScrollPosition()}),la(4,Nte,7,5,"p",10),fa(),fa()}if(2&e){const e=ba();Ts(1),ha("ngIf",e.showUnreadMessagesButton),Ts(3),ha("ngForOf",e.chat)}}const xte=function(){return{standalone:!0}};function Dte(e,t){if(1&e){const e=va();pa(0,"form",14),Ea("onSubmit",function(){return Gt(e),ba().sendMessage()}),pa(1,"div",15),pa(2,"div",16),pa(3,"input",17,18),Ea("ngModelChange",function(t){return Gt(e),ba().userMessage=t}),fa(),pa(5,"p",19),Qa(6),fa(),fa(),pa(7,"div",20),pa(8,"button",21),Ea("click",function(){return Gt(e),ba().sendMessage()}),ga(9,"fa-icon",22),fa(),fa(),fa(),pa(10,"div",23),pa(11,"p"),pa(12,"strong"),sc(13,24),fa(),fa(),fa(),fa()}if(2&e){const e=ca(4),t=ba();Ts(3),ha("ngModel",t.userMessage)("ngModelOptions",wu(4,xte)),Ts(3),Xa("",e.value.length,"/128"),Ts(3),ha("icon",t.faReply)}}let Lte=(()=>{class e{constructor(t,n){this.chatService=t,this.connectedUserService=n,this.userMessage="",this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=OK,this.isNearBottom=!0,this.notYetScrolled=!0,Tw(e.VERBOSE,"ChatComponent constructor")}ngOnInit(){Tw(e.VERBOSE,`ChatComponent.ngOnInit for chat ${this.chatId}`),nq(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.loadChatContent()}ngAfterViewChecked(){this.scrollToBottomIfNeeded()}loadChatContent(){const e=e=>{this.updateMessages(e.flatMap(e=>null==e.data.postedTime?[]:[e.data]))},t=new cq(e,e,()=>{});this.chatService.startObserving(this.chatId,t)}updateMessages(e){this.chat=this.chat.concat(e);const t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}updateUnreadMessagesText(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize`no new message`,this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize`1 new message`:$localize`${e} new messages`}scrollToBottomIfNeeded(){this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}updateCurrentScrollPosition(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}scrollToBottom(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}scrollTo(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}sendMessage(){var e=this;return Pw(function*(){const t=e.userMessage;e.userMessage="";const n=e.connectedUserService.user.get().toMinimalUser();yield e.chatService.sendMessage(n,t,e.turn)})()}ngOnDestroy(){this.chatService.stopObserving()}switchChatVisibility(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(lq),ua(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&ju(Ite,5),2&e){let e;Wu(e=Zu())&&(t.chatDiv=e.first)}},inputs:{chatId:"chatId",turn:"turn"},decls:7,vars:4,consts:function(){let e,t,n,r;return e=$localize`Hide chat`,t=$localize`Show chat (${"\ufffd0\ufffd"}:INTERPOLATION:)`,n=$localize`Type your message here`,r=$localize`Be polite`,[["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],e,t,["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],[1,"chat-sender"],[1,"chat-message"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",n,"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],[1,"clickable-icon",3,"icon"],[1,"content","is-small"],r]},template:function(e,t){if(1&e&&(pa(0,"div"),pa(1,"button",0),Ea("click",function(){return t.switchChatVisibility()}),la(2,kte,2,0,"ng-container",1),la(3,Ate,1,1,"ng-template",null,2,Ku),fa(),la(5,Rte,5,2,"div",3),la(6,Dte,14,5,"form",4),fa()),2&e){const e=ca(4);Ts(2),ha("ngIf",t.visible)("ngIfElse",e),Ts(3),ha("ngIf",t.visible),Ts(1),ha("ngIf",t.visible)}},directives:[rp,tp,pg,Df,cg,rf,Rg,xf,dg,QQ],pipes:[Tte],encapsulation:2}),e})();function Fte(e,t){if(1&e&&(ma(0),Qa(1),ya()),2&e){const e=ba().$implicit;Ts(1),Ja(e.data.playerOne)}}function Ute(e,t){1&e&&(ma(0),sc(1,26),ya())}function Bte(e,t){if(1&e){const e=va();pa(0,"tr",22),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).joinGame(t.id,t.data.typeGame)}),pa(1,"td",23),Qa(2),fa(),pa(3,"td",23),Qa(4),fa(),pa(5,"td",23),la(6,Fte,2,1,"ng-container",24),la(7,Ute,2,0,"ng-template",null,25,Ku),fa(),pa(9,"td",23),Qa(10),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(8);Ta("id","part_",n,""),Ts(2),Ja(e.data.typeGame),Ts(2),Ja(e.data.playerZero),Ts(2),ha("ngIf",e.data.playerOne)("ngIfElse",r),Ts(4),Ja(e.data.turn)}}function Vte(e,t){if(1&e&&(pa(0,"div",13),pa(1,"div",14),pa(2,"table",15),pa(3,"thead"),pa(4,"tr"),pa(5,"th",16),sc(6,17),fa(),pa(7,"th",16),sc(8,18),fa(),pa(9,"th",16),sc(10,19),fa(),pa(11,"th",16),sc(12,20),fa(),fa(),fa(),pa(13,"tbody"),la(14,Bte,11,6,"tr",21),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(14),ha("ngForOf",e.activeParts)}}function $te(e,t){1&e&&(pa(0,"div",27),ga(1,"app-online-game-selection",28),fa())}function zte(e,t){if(1&e&&(pa(0,"li",39),Qa(1),ku(2,"firebaseDate"),fa()),2&e){const e=ba().$implicit;Oa("id",e.data.username),Ts(1),el("",e.data.username,": ",Au(2,3,e.data.last_changed),"")}}function Hte(e,t){if(1&e&&(ma(0),la(1,zte,3,5,"li",38),ya()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",e.data.last_changed)}}function Gte(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),pa(2,"div",31),ga(3,"app-chat",32),fa(),fa(),pa(4,"div",33),pa(5,"div",34),pa(6,"p"),sc(7,35),fa(),pa(8,"ul",36),la(9,Hte,2,1,"ng-container",37),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(3),ha("turn",-1),Ts(6),ha("ngForOf",e.activeUsers)}}let qte=(()=>{class e{constructor(e,t,n){this.router=e,this.userService=t,this.activePartsService=n,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}ngOnInit(){Tw(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(e=>{this.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(e=>{this.activeParts=e})}ngOnDestroy(){Tw(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}joinGame(e,t){var n=this;return Pw(function*(){yield n.router.navigate(["/play",t,e])})()}selectTab(e){this.currentTab=e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(dq),ua(Pte))},e.\u0275cmp=Xe({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Games`,t=$localize`Create`,n=$localize`Chat`,r=$localize`Game`,i=$localize`First player`,s=$localize`Second player`,o=$localize`Turn`,a=$localize`Waiting for opponent`,l=$localize`Connected users:`,[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],e,["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],t,["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],n,["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],r,i,s,o,[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],a,["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-9"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3"],["id","onlineUsers",1,"box"],l,["id","activeUsersList"],[4,"ngFor","ngForOf"],[3,"id",4,"ngIf"],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"ul"),pa(2,"li",1),pa(3,"a",2),Ea("click",function(){return t.selectTab("games")}),sc(4,3),fa(),fa(),pa(5,"li",4),pa(6,"a",5),Ea("click",function(){return t.selectTab("create")}),sc(7,6),fa(),fa(),pa(8,"li",7),pa(9,"a",8),Ea("click",function(){return t.selectTab("chat")}),sc(10,9),fa(),fa(),fa(),fa(),la(11,Vte,15,1,"div",10),la(12,$te,2,0,"div",11),la(13,Gte,10,2,"div",12)),2&e&&(Ts(11),ha("ngIf","games"===t.currentTab),Ts(1),ha("ngIf","create"===t.currentTab),Ts(1),ha("ngIf","chat"===t.currentTab))},directives:[Xd,rp,tp,Ote,Lte],pipes:[Tte],encapsulation:2}),e})(),Wte=(()=>{class e{constructor(e){this.route=e,this.message=e.snapshot.paramMap.get("message")??$localize`This page does not exist.`}}return e.\u0275fac=function(t){return new(t||e)(ua(Wy))},e.\u0275cmp=Xe({type:e,selectors:[["app-not-found"]],decls:5,vars:1,consts:function(){let e;return e=$localize`Not found`,[[1,"message","is-danger"],[1,"message-header"],e,[1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),sc(2,2),fa(),pa(3,"div",3),Qa(4),fa(),fa()),2&e&&(Ts(4),Ja(t.message))},encapsulation:2}),e})();function jte(e,t){}let Zte=(()=>{class e{constructor(t){this.viewContainerRef=t,Tw(e.VERBOSE,"GameIncluderComponent constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(au))},e.\u0275cmp=Xe({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&la(0,jte,0,0,"ng-template")},encapsulation:2}),e})(),Yte=(()=>{class e{static NO_MATCHING_GAME(e){return $localize`This game (${e}) does not exist.`}}return e.NOT_YOUR_TURN=()=>$localize`It is not your turn!`,e.NO_CLONING_FEATURE=()=>$localize`You cannot clone a game. This feature might be implemented later.`,e})(),Kte=(()=>{class e{constructor(t,n,r,i,s){this.componentFactoryResolver=t,this.actRoute=n,this.connectedUserService=r,this.router=i,this.messageDisplayer=s,this.players=[Mw.empty(),Mw.empty()],this.endGame=!1,Tw(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}getMatchingComponent(t){return Tw(e.VERBOSE,"GameWrapper.getMatchingComponent"),Mw.ofNullable(pte.ALL_GAMES().find(e=>e.urlName===t)).map(e=>e.component)}afterGameIncluderViewInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit");const n=yield t.createGameComponent();return n&&t.gameComponent.rules.setInitialBoard(),n})()}createGameComponent(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"GameWrapper.createGameComponent");const n=Ow.getNonNullable(t.actRoute.snapshot.paramMap.get("compo")),r=t.getMatchingComponent(n);if(r.isAbsent())return yield t.router.navigate(["/notFound",Yte.NO_MATCHING_GAME(n)],{skipLocationChange:!0}),!1;nq(null!=t.gameIncluder,"GameIncluder should be present");const i=t.componentFactoryResolver.resolveComponentFactory(r.get()),s=t.gameIncluder.viewContainerRef.createComponent(i);return t.gameComponent=s.instance,t.gameComponent.chooseMove=(e,n,r)=>t.receiveValidMove(e,n,r),t.gameComponent.canUserPlay=e=>t.onUserClick(e),t.gameComponent.isPlayerTurn=()=>t.isPlayerTurn(),t.gameComponent.cancelMoveOnWrapper=e=>{t.onCancelMove(e)},t.gameComponent.observerRole=t.observerRole,t.canPass=t.gameComponent.canPass,!0})()}receiveValidMove(t,n,r){var i=this;return Pw(function*(){if(Tw(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),!i.isPlayerTurn())return QG.failure(Yte.NOT_YOUR_TURN());if(i.endGame)return QG.failure($localize`The game has ended.`);const s=i.gameComponent.rules.isLegal(t,n);return s.isFailure()?(i.gameComponent.cancelMove(s.getReason()),QG.ofFallible(s)):(i.gameComponent.cancelMoveAttempt(),yield i.onLegalUserMove(t,r),Tw(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),QG.SUCCESS)})()}onUserClick(e){if(this.observerRole===uK.NONE.value){const e=Yte.NO_CLONING_FEATURE();return QG.failure(e)}return this.isPlayerTurn()?QG.SUCCESS:QG.failure(Yte.NOT_YOUR_TURN())}onCancelMove(e){}isPlayerTurn(){if(this.observerRole===uK.NONE.value||null==this.gameComponent)return!1;const t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return Tw(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}getBoardHighlight(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(Wy),ua(tK),ua(f_),ua(eq))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&ju(Zte,5),2&e){let e;Wu(e=Zu())&&(t.gameIncluder=e.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class Qte{constructor(e,t,n){this.added=e,this.modified=t,this.removed=n}static from(e,t){const n=new Qte({},{},{});if(null==e)return n.added={...t},n;if(null==t)return n.removed={...e},n;const r=Object.keys(e),i=Object.keys(t),s=r.filter(e=>!1===i.includes(e)),o=r.filter(e=>i.includes(e)),a=i.filter(e=>!1===r.includes(e));return n.addNewKeys(a,t),n.addCommonKeys(o,t,e),n.addRemovedKeys(s,e),n}static differs(e,t){return Qte.from(e,t).countChanges()>0}addNewKeys(e,t){for(const n of e)null!=t[n]&&(this.added[n]=t[n])}addCommonKeys(e,t,n){for(const r of e)this.addCommonKey(r,n[r],t[r])}addCommonKey(e,t,n){if(null==n)null!=t&&(this.removed[e]=t);else if(null==t)this.added[e]=n;else if(["string","boolean","number"].includes(typeof t))t!==n&&(this.modified[e]=n);else if(Array.isArray(t)){if(!Array.isArray(n))throw new Error("Thing should not change type");t.length===n.length?this.addCommonKeyList(e,t,n):this.modified[e]=n}else{nq("object"==typeof t,`ObjectDifference: expected JSON, but got a ${typeof t} in ${e}`),nq("object"==typeof n,`ObjectDifference: expected JSON, but got a ${typeof n} in ${e}`);const r=Qte.from(t,n);r.countChanges()>0&&(this.modified[e]=r)}}addCommonKeyList(e,t,n){let r=!0;for(let i=0;r&&i<t.length;i++)typeof t[i]==typeof n[i]&&"object"==typeof t[i]?Qte.differs(t[i],n[i])&&(r=!1,this.modified[e]=n):t[i]!==n[i]&&(r=!1,this.modified[e]=n)}addRemovedKeys(e,t){for(const n of e)this.removed[n]=t[n]}countChanges(){const e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}isPresent(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}function Jte(e){return 1e3*e.seconds+e.nanoseconds/1e6}function Xte(e,t){return Jte(t)-Jte(e)}function ene(e){return R((t,n)=>{Y(e).subscribe(new x(n,()=>n.complete(),f)),!n.closed&&t.subscribe(n)})}let tne=(()=>{class e{transform(e){const t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize`${r} hours`):1===r&&i.push($localize`1 hour`),n>1?i.push($localize`${n} minutes`):1===n&&i.push($localize`1 minute`),t>1?i.push($localize`${t} seconds`):1===t&&i.push($localize`1 second`),0===i.length)return $localize`0 seconds`;if(1===i.length)return i[0];{const e=i.slice(0,-1).join(", "),t=i.slice(-1)[0];return $localize`${e} and ${t}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"humanDuration",type:e,pure:!0}),e})();function nne(e,t){if(1&e&&(ma(0),Qa(1),ya()),2&e){const e=ba(3);Ts(1),Ja(e.viewInfo.chosenOpponent)}}function rne(e,t){1&e&&sc(0,44)}function ine(e,t){if(1&e&&(pa(0,"div",45),pa(1,"div",8),pa(2,"label",46),ma(3),sc(4,47),ya(),pa(5,"output"),Qa(6),ku(7,"humanDuration"),fa(),fa(),pa(8,"div",37),ga(9,"input",48),fa(),fa(),pa(10,"div",8),pa(11,"label",49),rc(12,50),ga(13,"output"),ku(14,"humanDuration"),ic(),fa(),pa(15,"div",37),ga(16,"input",51),fa(),fa(),fa()),2&e){const e=ba(3);Ts(6),Ja(Au(7,2,e.viewInfo.maximalMoveDuration||0)),Ts(8),oc(Au(14,4,e.viewInfo.totalPartDuration||0)),ac(12)}}function sne(e,t){1&e&&(pa(0,"div"),rc(1,52),ga(2,"br"),ic(),fa())}function one(e,t){1&e&&(pa(0,"button",64),sc(1,65),fa())}function ane(e,t){if(1&e){const e=va();pa(0,"tr",60),Ea("click",function(){const t=Gt(e).$implicit;return ba(4).selectOpponent(t)}),pa(1,"td",61),Qa(2),fa(),pa(3,"td",62),la(4,one,2,0,"button",63),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(4);Ta("id","presenceOf_",e,""),ha("ngClass",n.viewInfo.candidateClasses[e]),Ts(1),ha("id",n.viewInfo.chosenOpponent===e?"selected_"+e:"candidate_"+e),Ts(1),Ja(e),Ts(2),ha("ngIf",n.viewInfo.chosenOpponent!==e)}}function lne(e,t){if(1&e&&(ma(0),sc(1,53),ya(),pa(2,"div",54),pa(3,"table",55),pa(4,"thead"),pa(5,"tr"),pa(6,"th",56),sc(7,57),fa(),pa(8,"th",56),sc(9,58),fa(),fa(),fa(),pa(10,"tbody"),la(11,ane,5,5,"tr",59),fa(),fa(),fa()),2&e){const e=ba(3);Ts(11),ha("ngForOf",e.viewInfo.candidates)}}function cne(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),ba(3).changeConfig()}),sc(1,67),fa()}}function une(e,t){if(1&e){const e=va();pa(0,"div"),pa(1,"h1",4),sc(2,5),fa(),pa(3,"form",6),pa(4,"fieldset",7),pa(5,"div",8),pa(6,"label",9),sc(7,10),fa(),pa(8,"div",11),pa(9,"button",12),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("RANDOM")}),sc(10,13),fa(),pa(11,"button",14),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("CREATOR")}),sc(12,15),fa(),pa(13,"button",16),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("CHOSEN_PLAYER")}),la(14,nne,2,1,"ng-container",17),la(15,rne,1,0,"ng-template",null,18,Ku),fa(),fa(),fa(),pa(17,"div",8),pa(18,"label",9),sc(19,19),fa(),pa(20,"div",11),pa(21,"div",20),Ea("click",function(){return Gt(e),ba(2).selectPartType("STANDARD")}),pa(22,"div",21),pa(23,"span"),sc(24,22),fa(),fa(),pa(25,"div",23),pa(26,"div",24),pa(27,"div",25),pa(28,"p"),ma(29),sc(30,26),ya(),pa(31,"strong"),Qa(32),ku(33,"humanDuration"),fa(),ga(34,"br"),ma(35),rc(36,27),ga(37,"strong"),ku(38,"humanDuration"),ic(),ya(),fa(),fa(),fa(),fa(),fa(),pa(39,"div",28),Ea("click",function(){return Gt(e),ba(2).selectPartType("BLITZ")}),pa(40,"div",21),pa(41,"span"),sc(42,29),fa(),fa(),pa(43,"div",23),pa(44,"div",24),pa(45,"div",25),pa(46,"p"),ma(47),sc(48,30),ya(),pa(49,"strong"),Qa(50),ku(51,"humanDuration"),fa(),ga(52,"br"),ma(53),rc(54,31),ga(55,"strong"),ku(56,"humanDuration"),ic(),ya(),fa(),fa(),fa(),fa(),fa(),pa(57,"button",32),Ea("click",function(){return Gt(e),ba(2).selectPartType("CUSTOM")}),sc(58,33),fa(),fa(),fa(),la(59,ine,17,6,"div",34),pa(60,"div",8),pa(61,"label",35),sc(62,36),fa(),pa(63,"div",37),la(64,sne,3,0,"div",17),la(65,lne,12,1,"ng-template",null,38,Ku),fa(),fa(),fa(),pa(67,"div",8),pa(68,"div",11),pa(69,"button",39),Ea("click",function(){return Gt(e),ba(2).proposeConfig()}),sc(70,40),fa(),la(71,cne,2,0,"button",41),pa(72,"button",42),Ea("click",function(){return Gt(e),ba(2).cancelGameCreation()}),sc(73,43),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ca(16),t=ca(66),n=ba(2);Ts(3),ha("formGroup",n.configFormGroup),Ts(1),ha("disabled",!n.viewInfo.canEditConfig),Ts(5),ha("ngClass",n.viewInfo.firstPlayerClasses.RANDOM),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CREATOR),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),Ts(1),ha("ngIf",n.viewInfo.chosenOpponent)("ngIfElse",e),Ts(7),ha("ngClass",n.viewInfo.partTypeClasses.STANDARD),Ts(11),Ja(Au(33,19,n.partType.NORMAL_MOVE_DURATION)),Ts(6),oc(Au(38,21,n.partType.NORMAL_PART_DURATION)),ac(36),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.BLITZ),Ts(11),Ja(Au(51,23,n.partType.BLITZ_MOVE_DURATION)),Ts(6),oc(Au(56,25,n.partType.BLITZ_PART_DURATION)),ac(54),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.CUSTOM),Ts(2),ha("ngIf",n.viewInfo.showCustomTime),Ts(5),ha("ngIf",0===n.viewInfo.candidates.length)("ngIfElse",t),Ts(5),ha("disabled",!n.viewInfo.canProposeConfig),Ts(2),ha("ngIf",n.viewInfo.canReviewConfig)}}function hne(e,t){if(1&e&&(pa(0,"div",74),pa(1,"p"),rc(2,75),ga(3,"br"),ic(),fa(),fa()),2&e){const e=ba(3);Ts(3),oc(e.viewInfo.creator),ac(2)}}function dne(e,t){if(1&e&&(pa(0,"span"),sc(1,81),fa()),2&e){const e=ba(4);Ts(1),oc(e.viewInfo.creator),ac(1)}}function pne(e,t){1&e&&(pa(0,"span"),sc(1,82),fa())}function fne(e,t){1&e&&(pa(0,"span"),sc(1,83),fa())}function gne(e,t){if(1&e){const e=va();pa(0,"div",74),pa(1,"p"),sc(2,76),fa(),pa(3,"ul"),pa(4,"li"),la(5,dne,2,1,"span",2),la(6,pne,2,0,"span",2),la(7,fne,2,0,"span",2),fa(),pa(8,"li"),rc(9,77),ga(10,"strong"),ku(11,"humanDuration"),ic(),fa(),pa(12,"li"),rc(13,78),ga(14,"strong"),ku(15,"humanDuration"),ic(),fa(),fa(),pa(16,"button",79),Ea("click",function(){return Gt(e),ba(3).acceptConfig()}),sc(17,80),fa(),fa()}if(2&e){const e=ba(3);Ts(2),oc(e.viewInfo.creator)(e.viewInfo.partTypeName),ac(2),Ts(3),ha("ngIf","CREATOR"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","CHOSEN_PLAYER"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","RANDOM"===e.viewInfo.firstPlayer),Ts(4),oc(Au(11,7,e.viewInfo.maximalMoveDuration||0)),ac(9),Ts(4),oc(Au(15,9,e.viewInfo.totalPartDuration||0)),ac(13)}}function mne(e,t){if(1&e&&(pa(0,"div"),pa(1,"div",68),pa(2,"div",69),pa(3,"p"),sc(4,70),fa(),fa(),pa(5,"div",71),la(6,hne,4,1,"div",72),la(7,gne,18,11,"ng-template",null,73,Ku),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function yne(e,t){if(1&e&&(ma(0),sc(1,86),ya()),2&e){const e=ba(3);Ts(1),oc(e.viewInfo.creator),ac(1)}}function vne(e,t){if(1&e&&sc(0,87),2&e){const e=ba(3);oc(e.viewInfo.creator)(e.viewInfo.chosenOpponent),ac(0)}}function _ne(e,t){if(1&e&&(pa(0,"div",68),pa(1,"div",69),pa(2,"p"),sc(3,84),fa(),fa(),pa(4,"div",71),pa(5,"p"),la(6,yne,2,1,"ng-container",17),la(7,vne,1,2,"ng-template",null,85,Ku),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function Cne(e,t){if(1&e&&(pa(0,"div",1),la(1,une,74,27,"div",2),la(2,mne,9,2,"div",2),la(3,_ne,9,2,"div",3),fa()),2&e){const e=ba();Ts(1),ha("ngIf",e.viewInfo.userIsCreator),Ts(1),ha("ngIf",e.viewInfo.userIsChosenOpponent),Ts(1),ha("ngIf",e.viewInfo.userIsObserver)}}class Ene{constructor(e,t,n,r,i,s,o,a){this.router=e,this.connectedUserService=t,this.gameService=n,this.joinerService=r,this.chatService=i,this.userService=s,this.formBuilder=o,this.messageDisplayer=a,this.partType=rK,this.gameStartNotification=new xu,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.ngUnsubscribe=new A,this.allUserInterval=Mw.empty(),this.ownTokenInterval=Mw.empty(),this.selfSubscription=()=>{},this.allDocDeleted=!1,Tw(Ene.VERBOSE,"PartCreationComponent constructed")}ngOnInit(){var e=this;return Pw(function*(){Tw(Ene.VERBOSE,"PartCreationComponent.ngOnInit for "+e.connectedUserService.user.get().username.get()),e.checkInputs(),e.createForms();const t=e.connectedUserService.user.get().toMinimalUser(),n=yield e.joinerService.joinGame(e.partId,t);if(n.isFailure()){const t=n.getReason();e.messageDisplayer.criticalMessage(t)}else yield e.updateUserDocWithObservedPart(),yield e.startSendingPresenceTokens(),e.gameExists=!0,e.subscribeToJoinerDoc(),e.subscribeToFormElements(),Tw(Ene.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds")})()}checkInputs(){const e=this.connectedUserService.user;nq(e.isPresent()&&e.get()!==eK.NOT_CONNECTED,"PartCreationComponent should not be created with an empty userName"),nq(""!==this.partId,"PartCreationComponent should not be created with an empty partId")}createForms(){this.configFormGroup=this.formBuilder.group({firstPlayer:[nK.RANDOM.value,uf.required],maximalMoveDuration:[rK.NORMAL_MOVE_DURATION,uf.required],partType:["STANDARD",uf.required],totalPartDuration:[rK.NORMAL_PART_DURATION,uf.required],chosenOpponent:["",uf.required]})}updateUserDocWithObservedPart(){return Tw(Ene.VERBOSE,"updateUserDocWithObservedPart of '"+this.partId+"'"),this.connectedUserService.updateObservedPart(this.partId)}subscribeToJoinerDoc(){var e=this;this.joinerService.subscribeToChanges(this.partId,function(){var t=Pw(function*(t){yield e.onCurrentJoinerUpdate(t)});return function(e){return t.apply(this,arguments)}}())}getForm(e){return Ow.getNonNullable(this.configFormGroup.get(e))}subscribeToFormElements(){this.getForm("chosenOpponent").valueChanges.pipe(ene(this.ngUnsubscribe)).subscribe(e=>{void 0!==this.viewInfo.chosenOpponent&&(this.viewInfo.candidateClasses[this.viewInfo.chosenOpponent]=[]),this.viewInfo.candidateClasses[e]=["is-selected"],this.viewInfo.chosenOpponent=e;const t=Ow.getNonNullable(this.currentJoiner).partStatus;this.viewInfo.canProposeConfig=t!==iK.CONFIG_PROPOSED.value&&""!==e}),this.getForm("partType").valueChanges.pipe(ene(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.partTypeClasses[this.viewInfo.partType]=[],this.viewInfo.partTypeClasses[e]=["is-primary","is-selected"],this.viewInfo.partType=e,this.viewInfo.showCustomTime="CUSTOM"===e}),this.getForm("maximalMoveDuration").valueChanges.pipe(ene(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.maximalMoveDuration=e}),this.getForm("totalPartDuration").valueChanges.pipe(ene(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.totalPartDuration=e}),this.getForm("firstPlayer").valueChanges.pipe(ene(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.firstPlayerClasses[this.viewInfo.firstPlayer]=[],this.viewInfo.firstPlayerClasses[e]=["is-primary","is-selected"],this.viewInfo.firstPlayer=e})}updateViewInfo(){const e=Ow.getNonNullable(this.currentJoiner),t=this.connectedUserService.user.get();switch(this.viewInfo.canReviewConfig=e.partStatus===iK.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=e.partStatus!==iK.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=t.id===e.creator.id,this.viewInfo.userIsChosenOpponent=t.id===e.chosenOpponent?.id,this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=e.partStatus!==iK.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=e.creator.name,this.viewInfo.candidates=e.candidates.map(e=>e.name),t.id===e.creator.id?this.setDataForCreator(e):(this.viewInfo.maximalMoveDuration=e.maximalMoveDuration,this.viewInfo.totalPartDuration=e.totalPartDuration,this.viewInfo.partType=e.partType,this.viewInfo.chosenOpponent=e.chosenOpponent?.name,this.viewInfo.firstPlayer=e.firstPlayer),e.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize`custom`;break;case"BLITZ":this.viewInfo.partTypeName=$localize`blitz`;break;case"STANDARD":this.viewInfo.partTypeName=$localize`standard`}}setDataForCreator(e){this.viewInfo.maximalMoveDuration=this.viewInfo.maximalMoveDuration??e.maximalMoveDuration,this.viewInfo.totalPartDuration=this.viewInfo.totalPartDuration??e.totalPartDuration;let t=this.viewInfo.chosenOpponent;null==t||""===t?t=e.chosenOpponent?.name??"":!1===e.candidates.some(e=>e.name===t)&&(t=""),this.getForm("chosenOpponent").setValue(t)}selectFirstPlayer(e){this.getForm("firstPlayer").setValue(e)}selectPartType(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue(rK.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue(rK.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue(rK.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue(rK.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}selectOpponent(e){var t=this;return Pw(function*(){Tw(Ene.VERBOSE,"PartCreationComponent.setChosenOpponent("+e+")");const n=t.getUserFromName(e);return t.joinerService.setChosenOpponent(n)})()}getUserFromName(e){const t=Ow.getNonNullable(this.currentJoiner).candidates.find(t=>t.name===e);return Ow.getNonNullable(t)}changeConfig(){var e=this;return Pw(function*(){return e.joinerService.reviewConfig()})()}proposeConfig(){var e=this;return Pw(function*(){const t=e.getForm("chosenOpponent").value,n=e.getForm("partType").value,r=e.getForm("maximalMoveDuration").value,i=e.getForm("firstPlayer").value,s=e.getForm("totalPartDuration").value,o=e.getUserFromName(t);return e.joinerService.proposeConfig(o,rK.of(n),r,nK.of(i),s)})()}cancelGameCreation(){var e=this;return Pw(function*(){e.allDocDeleted=!0,yield e.connectedUserService.removeObservedPart(),Tw(Ene.VERBOSE,"PartCreationComponent.cancelGameCreation"),yield e.chatService.deleteChat(e.partId),Tw(Ene.VERBOSE,"PartCreationComponent.cancelGameCreation: chat deleted"),yield e.joinerService.deleteJoiner(),Tw(Ene.VERBOSE,"PartCreationComponent.cancelGameCreation: chat and joiner deleted"),yield e.gameService.deletePart(e.partId),Tw(Ene.VERBOSE,"PartCreationComponent.cancelGameCreation: chat, joiner, and part deleted")})()}onCurrentJoinerUpdate(e){var t=this;return Pw(function*(){if(Tw(Ene.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(t.currentJoiner),then:JSON.stringify(e)}}),e.isAbsent())return Tw(Ene.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),t.onGameCancelled();if(t.chosenOpponentJustLeft(e.get())){const e=Ow.getNonNullable(t.currentJoiner),n=Ow.getNonNullable(e.chosenOpponent).name;t.messageDisplayer.infoMessage($localize`${n} left the game, please pick another opponent.`)}t.currentJoiner=e.get(),t.allUserInterval.isAbsent()&&(yield t.observeNeededPlayers()),t.updateViewInfo(),t.isGameStarted()&&(Tw(Ene.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),t.onGameStarted())})()}chosenOpponentJustLeft(e){return null!=this.currentJoiner&&(null!=this.currentJoiner.chosenOpponent&&null==e.chosenOpponent)}onGameCancelled(){var e=this;return Pw(function*(){Tw(Ene.VERBOSE,"PartCreationComponent.onGameCancelled"),e.messageDisplayer.infoMessage($localize`The game has been canceled!`),yield e.router.navigate(["/lobby"])})()}isGameStarted(){return Ow.getNonNullable(this.currentJoiner).partStatus===iK.PART_STARTED.value}onGameStarted(){const e=Ow.getNonNullable(this.currentJoiner);Tw(Ene.VERBOSE,{partCreationComponent_onGameStarted:{joiner:e}}),this.gameStartNotification.emit(e),this.gameStarted=!0,Tw(Ene.VERBOSE,"PartCreationComponent.onGameStarted finished")}observeNeededPlayers(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.currentJoiner),n=e.connectedUserService.user.get().id;Tw(Ene.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:t}}),e.allUserInterval=Mw.of(window.setInterval(Pw(function*(){const t=Ow.getNonNullable(e.currentJoiner),r=e.lastToken;n===t.creator.id?yield e.checkCandidatesTokensFreshness(r):yield e.checkCreatorTokenFreshness(r)}),Ene.TOKEN_INTERVAL))})()}checkCreatorTokenFreshness(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);(yield t.didUserTimeout(n.creator.id,e))&&(yield t.destroyDocIfPartDidNotStart())})()}destroyDocIfPartDidNotStart(){var e=this;return Pw(function*(){nq(!1==(Ow.getNonNullable(e.currentJoiner).partStatus===iK.PART_STARTED.value),"Should not try to cancelGameCreation when part started!"),nq(!1===e.allDocDeleted,"Should not delete doc twice"),yield e.cancelGameCreation()})()}checkCandidatesTokensFreshness(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);for(const r of n.candidates)(yield t.didUserTimeout(r.id,e))&&(yield t.removeCandidateFromLobby(r.id))})()}didUserTimeout(e,t){var n=this;return Pw(function*(){const r=yield n.userService.getUserLastChanged(e);return r.isAbsent()?(tq.logError("PartCreationComponent","found no user while observing "+e+" !"),!0):Xte(r.get(),t)>Ene.TOKEN_TIMEOUT})()}startSendingPresenceTokens(){var e=this;return Pw(function*(){yield e.connectedUserService.sendPresenceToken(),nq(e.ownTokenInterval.isAbsent(),"should not start sending presence tokens twice"),e.ownTokenInterval=Mw.of(window.setInterval(()=>{e.connectedUserService.sendPresenceToken()},Ene.TOKEN_INTERVAL));const t=e.connectedUserService.user.get().id;e.selfSubscription=e.userService.observeUser(t,t=>{nq(t.isPresent(),"connected user should exist");const n=t.get();null!=n.last_changed&&(e.lastToken=n.last_changed)})})()}stopSendingPresenceTokensAndObservingUsersIfNeeded(){this.ownTokenInterval.isPresent()&&(window.clearInterval(this.ownTokenInterval.get()),this.ownTokenInterval=Mw.empty()),this.allUserInterval.isPresent()&&window.clearInterval(this.allUserInterval.get()),this.selfSubscription()}removeCandidateFromLobby(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);nq(-1!==n.candidates.findIndex(t=>t.id===e),"PartCreationComponent: attempting to remove a user not in the lobby");const r=n.candidates.filter(t=>t.id!==e);return n.chosenOpponent?.id===e?t.joinerService.reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(r):t.joinerService.updateCandidates(r)})()}acceptConfig(){var e=this;return Pw(function*(){return Tw(Ene.VERBOSE,"PartCreationComponent.acceptConfig"),e.gameService.acceptConfig(e.partId,Ow.getNonNullable(e.currentJoiner))})()}ngOnDestroy(){var e=this;return Pw(function*(){Tw(Ene.VERBOSE,"PartCreationComponent.ngOnDestroy"),e.ngUnsubscribe.next(),e.ngUnsubscribe.complete(),e.stopSendingPresenceTokensAndObservingUsersIfNeeded(),e.gameExists&&e.joinerService.unsubscribe();const t=e.connectedUserService.user.get();if(!0!==e.gameStarted){if(null===e.currentJoiner)return void Tw(Ene.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here");t.id===e.currentJoiner.creator.id?(Tw(Ene.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),yield e.cancelGameCreation()):!1===e.allDocDeleted&&(Tw(Ene.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),yield e.connectedUserService.removeObservedPart(),yield e.joinerService.cancelJoining(t.toMinimalUser()))}})()}}function wne(e,t){if(1&e){const e=va();pa(0,"button",3),Ea("click",function(){return Gt(e),ba().addTime()}),sc(1,4),fa()}if(2&e){const e=ba();Ts(1),oc(e.timeToAdd),ac(1)}}Ene.VERBOSE=!1,Ene.TOKEN_INTERVAL=5e3,Ene.TOKEN_TIMEOUT=2*Ene.TOKEN_INTERVAL,Ene.\u0275fac=function(e){return new(e||Ene)(ua(f_),ua(tK),ua(yK),ua(mK),ua(lq),ua(dq),ua(Fg),ua(eq))},Ene.\u0275cmp=Xe({type:Ene,selectors:[["app-part-creation"]],inputs:{partId:"partId"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,S,b,P,O,T,I,k,A,M,N,R,x,D;return e=$localize`Game creation`,t=$localize`First player`,n=$localize`Random`,r=$localize`You`,i=$localize`Game type`,s=$localize`Standard`,o=$localize`Maximal turn duration: `,a=$localize`Maximal game duration: ${"\ufffd#37\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#37\ufffd"}:CLOSE_TAG_STRONG:`,l=$localize`Blitz`,c=$localize`Maximal turn duration: `,u=$localize`Maximal game duration: ${"\ufffd#55\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#55\ufffd"}:CLOSE_TAG_STRONG:`,h=$localize`Custom`,d=$localize`Opponents`,p=$localize`Propose configuration`,f=$localize`Cancel game`,g=$localize`The opponent`,m=$localize`Maximal turn duration: `,y=$localize`Maximal game duration: ${"\ufffd#13\ufffd"}:START_TAG_OUTPUT:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#13\ufffd"}:CLOSE_TAG_OUTPUT:`,v=$localize`Potential opponents that join the game will appear here.${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:LINE_BREAK:Wait for an opponent to join, so that you can pick one.`,_=$localize`Click on the opponent against which you would like to play.`,C=$localize`Name`,E=$localize`Actions`,w=$localize`Pick`,S=$localize`Change configuration`,b=$localize`Configuration proposal`,P=$localize`You have been selected as the opponent.${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:LINE_BREAK: ${"\ufffd0\ufffd"}:INTERPOLATION: is modifying the configuration.`,O=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: proposes to play a ${"\ufffd1\ufffd"}:INTERPOLATION_1: game`,T=$localize`a turn lasts at most ${"\ufffd#10\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#10\ufffd"}:CLOSE_TAG_STRONG:`,I=$localize`the game lasts at most ${"\ufffd#14\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#14\ufffd"}:CLOSE_TAG_STRONG:`,k=$localize`Accept and start`,A=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: plays first`,M=$localize`you play first`,N=$localize`the first player is selected randomly`,R=$localize`One moment...`,x=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: is configuring the game.`,D=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has proposed a configuration to ${"\ufffd1\ufffd"}:INTERPOLATION_1:.`,[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],e,[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],t,[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],n,["id","firstPlayerCreator",1,"button",3,"ngClass","click"],r,["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],i,["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],s,["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],o,a,["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],l,c,u,["id","partTypeCustom",1,"button",3,"ngClass","click"],h,["id","customTime",4,"ngIf"],[1,"label"],d,[1,"control"],["chooseOpponent",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],p,["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],f,g,["id","customTime"],["for","maximalMoveDuration",1,"label"],m,["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],y,["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],v,_,["id","chooseOpponent",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],C,E,[3,"id","ngClass","click",4,"ngFor","ngForOf"],[3,"id","ngClass","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],w,["id","reviewConfig",1,"button",3,"click"],S,[1,"message","is-primary"],[1,"message-header"],b,[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],P,O,T,I,["id","acceptConfig",1,"button","is-primary",3,"click"],k,A,M,N,R,["proposalSent",""],x,D]},template:function(e,t){1&e&&la(0,Cne,4,3,"div",0),2&e&&ha("ngIf",t.viewInfo)},directives:[rp,pg,Df,_g,Xd,rf,mg,xf,Eg,tp],pipes:[tne],encapsulation:2});let Sne=(()=>{class e{constructor(){this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new xu,this.addTimeToOpponent=new xu,this.cssClasses=e.SAFE_TIME}ngOnInit(){Tw(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}setDuration(t){if(Tw(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}changeDuration(e){let t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}displayDuration(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}start(){if(Tw(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}resume(){if(Tw(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();const t=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(()=>{this.onEndReached()},t),this.countSeconds()}onEndReached(){Tw(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}countSeconds(){this.timeoutHandleSec=window.setTimeout(()=>{this.updateShownTime()},1e3)}isIdle(){return!1===this.started||this.isPaused}pause(){if(Tw(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}stop(){if(Tw(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}isStarted(){return this.started}getTimeClass(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}updateShownTime(){const e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}clearTimeouts(){Tw(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(window.clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(window.clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}addTime(){this.addTimeToOpponent.emit()}ngOnDestroy(){this.clearTimeouts()}}return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){let e;return e=$localize`Add ${"\ufffd0\ufffd"}:INTERPOLATION:`,[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],e]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),Qa(2),ku(3,"number"),fa(),la(4,wne,2,1,"button",2),fa()),2&e&&(ha("ngClass",t.getTimeClass()),Ts(2),el("",t.displayedMinute,":",function(e,t,n,r){const i=e+20,s=zt(),o=Rt(s,i);return Nu(s,Mu(s,i)?Iu(s,Xt(),t,o.transform,n,r,o):o.transform(n,r))}(3,4,t.displayedSec,"2.0-0"),""),Ts(2),ha("ngIf",t.canAddTime))},directives:[Xd,rp],pipes:[op],encapsulation:2}),e})();const bne=["partCreation"],Pne=["chatComponent"],One=["chronoZeroGlobal"],Tne=["chronoOneGlobal"],Ine=["chronoZeroTurn"],kne=["chronoOneTurn"];function Ane(e,t){if(1&e){const e=va();pa(0,"app-part-creation",5,6),Ea("gameStartNotification",function(t){return Gt(e),ba().startGame(t)}),fa()}2&e&&ha("partId",ba().currentPartId)}function Mne(e,t){1&e&&(ma(0),sc(1,40),ya())}function Nne(e,t){if(1&e&&(ma(0),sc(1,41),ya()),2&e){const e=ba(4);Ts(1),oc(e.currentPlayer),ac(1)}}function Rne(e,t){if(1&e&&(pa(0,"p",37),la(1,Mne,2,0,"ng-container",38),la(2,Nne,2,1,"ng-template",null,39,Ku),fa()),2&e){const e=ca(3),t=ba(3);Ts(1),ha("ngIf",t.currentPlayer===t.getPlayerName())("ngIfElse",e)}}function xne(e,t){if(1&e&&(pa(0,"div",33),pa(1,"p",34),sc(2,35),fa(),la(3,Rne,4,2,"p",36),fa()),2&e){const e=ba(2);Ts(2),oc(e.currentPart.getTurn()+1),ac(2),Ts(1),ha("ngIf",!1===e.endGame)}}function Dne(e,t){if(1&e&&(pa(0,"p",42),Qa(1),fa()),2&e){const e=ba(2);ha("ngClass",e.getPlayerNameClass(0)),Ts(1),Ja(e.players[0].get())}}function Lne(e,t){if(1&e&&(pa(0,"p",43),sc(1,44),fa()),2&e){const e=ba(2);Ts(1),oc(e.gameComponent.scores.get()[0]),ac(1)}}function Fne(e,t){if(1&e&&(pa(0,"p",45),Qa(1),fa()),2&e){const e=ba(2);ha("ngClass",e.getPlayerNameClass(1)),Ts(1),Ja(e.players[1].get())}}function Une(e,t){if(1&e&&(pa(0,"p",46),sc(1,47),fa()),2&e){const e=ba(2);Ts(1),oc(e.gameComponent.scores.get()[1]),ac(1)}}function Bne(e,t){if(1&e){const e=va();pa(0,"button",56),Ea("click",function(){return Gt(e),ba(3).resign()}),sc(1,57),fa()}}function Vne(e,t){if(1&e){const e=va();pa(0,"button",58),Ea("click",function(){return Gt(e),ba(3).proposeDraw()}),sc(1,59),fa()}}function $ne(e,t){if(1&e){const e=va();pa(0,"button",60),Ea("click",function(){return Gt(e),ba(3).acceptDraw()}),sc(1,61),fa()}}function zne(e,t){if(1&e){const e=va();pa(0,"button",62),Ea("click",function(){return Gt(e),ba(3).refuseDraw()}),sc(1,63),fa()}}function Hne(e,t){if(1&e){const e=va();pa(0,"button",64),Ea("click",function(){return Gt(e),ba(3).gameComponent.pass()}),sc(1,65),fa()}}function Gne(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),ba(3).acceptTakeBack()}),sc(1,67),fa()}}function qne(e,t){if(1&e){const e=va();pa(0,"button",68),Ea("click",function(){return Gt(e),ba(3).refuseTakeBack()}),sc(1,69),fa()}}function Wne(e,t){if(1&e){const e=va();pa(0,"button",70),Ea("click",function(){return Gt(e),ba(3).askTakeBack()}),sc(1,71),fa()}}function jne(e,t){if(1&e&&(ma(0),la(1,Bne,2,0,"button",48),la(2,Vne,2,0,"button",49),la(3,$ne,2,0,"button",50),la(4,zne,2,0,"button",51),la(5,Hne,2,0,"button",52),la(6,Gne,2,0,"button",53),la(7,qne,2,0,"button",54),la(8,Wne,2,0,"button",55),ya()),2&e){const e=ba(2);Ts(1),ha("ngIf",e.canResign()),Ts(1),ha("ngIf",e.canProposeDraw()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isPlaying()&&e.gameComponent.canPass&&e.currentPlayer===e.getPlayerName()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&!1===e.isOpponentWaitingForTakeBackResponse()&&e.canAskTakeBack())}}function Zne(e,t){1&e&&(pa(0,"div"),pa(1,"p",73),sc(2,74),fa(),fa())}function Yne(e,t){1&e&&(pa(0,"p",78),sc(1,79),fa())}function Kne(e,t){1&e&&(pa(0,"p",80),sc(1,81),fa())}function Qne(e,t){1&e&&(pa(0,"p",82),sc(1,83),fa())}function Jne(e,t){if(1&e&&(pa(0,"div"),la(1,Yne,2,0,"p",75),la(2,Kne,2,0,"p",76),la(3,Qne,2,0,"p",77),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function Xne(e,t){1&e&&(pa(0,"p",86),sc(1,87),fa())}function ere(e,t){1&e&&(pa(0,"p",88),sc(1,89),fa())}function tre(e,t){if(1&e&&(pa(0,"p",88),sc(1,90),fa()),2&e){const e=ba(4);Ts(1),oc(e.currentPart.getWinner().get()),ac(1)}}function nre(e,t){if(1&e&&(pa(0,"div"),la(1,Xne,2,0,"p",84),la(2,ere,2,0,"p",85),la(3,tre,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function rre(e,t){if(1&e&&(pa(0,"p",86),sc(1,91),fa()),2&e){const e=ba(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function ire(e,t){1&e&&(pa(0,"p",88),sc(1,92),fa())}function sre(e,t){if(1&e&&(pa(0,"p",88),sc(1,93),fa()),2&e){const e=ba(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function ore(e,t){if(1&e&&(pa(0,"div"),la(1,rre,2,1,"p",84),la(2,ire,2,0,"p",85),la(3,sre,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function are(e,t){1&e&&(pa(0,"p",95),sc(1,96),fa())}function lre(e,t){if(1&e&&(pa(0,"p",95),sc(1,97),fa()),2&e){const e=ba(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function cre(e,t){if(1&e&&(pa(0,"div"),la(1,are,2,0,"p",94),la(2,lre,2,1,"p",94),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying()||e.currentPart.getWinner().get()===e.getPlayerName())}}function ure(e,t){if(1&e&&(pa(0,"div",72),ga(1,"hr"),la(2,Zne,3,0,"div",26),la(3,Jne,4,3,"div",26),la(4,nre,4,3,"div",26),la(5,ore,4,3,"div",26),la(6,cre,3,2,"div",26),fa()),2&e){const e=ba(2);Ts(2),ha("ngIf",e.currentPart.isHardDraw()),Ts(1),ha("ngIf",e.currentPart.isAgreedDraw()),Ts(1),ha("ngIf",e.currentPart.isWin()),Ts(1),ha("ngIf",e.currentPart.isTimeout()),Ts(1),ha("ngIf",e.currentPart.isResign())}}function hre(e,t){1&e&&(pa(0,"button",98),sc(1,99),fa())}function dre(e,t){if(1&e){const e=va();pa(0,"button",100),Ea("click",function(){return Gt(e),ba(2).proposeRematch()}),sc(1,101),fa()}}function pre(e,t){if(1&e){const e=va();pa(0,"button",102),Ea("click",function(){return Gt(e),ba(2).acceptRematch()}),sc(1,103),fa()}}function fre(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"div",8),pa(2,"div",9),la(3,xne,4,2,"div",10),pa(4,"div",11),la(5,Dne,2,2,"p",12),la(6,Lne,2,1,"p",13),pa(7,"app-count-down",14,15),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),pa(9,"app-count-down",16,17),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),pa(11,"p",18),sc(12,19),fa(),pa(13,"div",11),la(14,Fne,2,2,"p",20),la(15,Une,2,1,"p",21),pa(16,"app-count-down",22,23),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),pa(18,"app-count-down",24,25),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),ga(20,"hr"),la(21,jne,9,8,"ng-container",26),la(22,ure,7,5,"div",27),la(23,hre,2,0,"button",28),la(24,dre,2,0,"button",29),la(25,pre,2,0,"button",30),fa(),fa(),pa(26,"div",31),pa(27,"div",32),ga(28,"app-game-includer"),fa(),fa(),fa()}if(2&e){const e=ba();Ts(3),ha("ngIf",e.currentPart),Ts(2),ha("ngIf",e.players[0].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(5),ha("ngIf",e.players[1].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(3),ha("ngIf",e.isPlaying()),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&!1===e.rematchProposed),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&e.rematchProposed&&e.opponentProposedRematch),Ts(1),ha("ngClass",e.getBoardHighlight())}}let gre=(()=>{class e{}return e.NO_MATCHING_PART=()=>$localize`The game you tried to join does not exist.`,e})();class mre{constructor(e){this.value=e}}mre.PRE_START_DOC=new mre("PRE_START_DOC"),mre.STARTING_DOC=new mre("STARTING_DOC"),mre.DUPLICATE=new mre("DUPLICATE"),mre.MOVE_WITHOUT_TIME=new mre("MOVE_WITHOUT_TIME"),mre.MOVE=new mre("MOVE"),mre.REQUEST=new mre("REQUEST"),mre.END_GAME=new mre("END_GAME"),mre.END_GAME_WITHOUT_TIME=new mre("END_GAME_WITHOUT_TIME"),mre.ACCEPT_TAKE_BACK_WITHOUT_TIME=new mre("ACCEPT_TAKE_BACK_WITHOUT_TIME");let yre=(()=>{class e extends Kte{constructor(t,n,r,i,s,o,a){super(t,n,s,r,i),this.userService=o,this.gameService=a,this.gameStarted=!1,this.opponent=null,this.rematchProposed=!1,this.opponentProposedRematch=!1,this.hasUserPlayed=[!1,!1],this.msToSubstract=[0,0],this.opponentSubscription=Mw.empty(),this.OFFLINE_FONT_COLOR={color:"lightgrey"},this.globalTimeMessage=$localize`5 minutes`,this.turnTimeMessage=$localize`30 seconds`,Tw(e.VERBOSE,"OnlineGameWrapperComponent constructed")}extractPartIdFromURL(){return Ow.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}extractGameNameFromURL(){return Ow.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}isPlaying(){return this.observerRole===cK.ZERO.value||this.observerRole===cK.ONE.value}getPlayer(){return cK.of(this.observerRole)}getPlayerName(){return Ow.getNonNullable(this.authUser.username.get())}isPlayer(e){return this.observerRole===e.value}isOpponent(e){return this.observerRole!==e.value}redirectIfPartOrGameIsInvalid(){var e=this;return Pw(function*(){const t=e.extractGameNameFromURL();if(pte.ALL_GAMES().some(e=>e.urlName===t)){if((yield e.gameService.getPartValidity(e.currentPartId,t)).isFailure()){e.routerEventsSub.unsubscribe();const t=gre.NO_MATCHING_PART();yield e.router.navigate(["/notFound",t],{skipLocationChange:!0})}}else{e.routerEventsSub.unsubscribe();const n=Yte.NO_MATCHING_GAME(t);yield e.router.navigate(["/notFound",n],{skipLocationChange:!0})}})()}setCurrentPartIdOrRedirect(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartOrGameIsInvalid()}ngOnInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),t.routerEventsSub=t.router.events.subscribe(function(){var e=Pw(function*(e){e instanceof Vm&&(yield t.setCurrentPartIdOrRedirect())});return function(t){return e.apply(this,arguments)}}()),t.userSub=t.connectedUserService.getUserObs().subscribe(e=>{t.authUser=e}),yield t.setCurrentPartIdOrRedirect()})()}startGame(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.startGame"),nq(!1===n.gameStarted,"Should not start already started game"),n.joiner=t,n.gameStarted=!0,window.setTimeout(Pw(function*(){nq(yield n.afterGameIncluderViewInit(),"Game should be created successfully, otherwise part-creation would have redirected"),n.startPart()}),1)})()}startPart(){var t=this;Tw(e.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,function(){var e=Pw(function*(e){nq(e.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),yield t.onCurrentPartUpdate(e.get())});return function(t){return e.apply(this,arguments)}}())}onCurrentPartUpdate(t){var n=this;return Pw(function*(){const r=new iq(n.currentPartId,t);Tw(e.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:n.currentPart,then:t.data,before_part_turn:r.data.turn,before_state_turn:n.gameComponent.rules.node.gameState.turn,nbPlayedMoves:r.data.listMoves.length}});const i=n.getUpdateType(r),s=t.turn;Tw(e.VERBOSE,i===mre.REQUEST?"UpdateType: Request("+Ow.getNonNullable(r.data.request).code+") ("+s+")":"UpdateType: "+i.value+"("+s+")");const o=n.currentPart;switch(n.currentPart=r,i){case mre.REQUEST:return yield n.onRequest(Ow.getNonNullable(r.data.request),o);case mre.ACCEPT_TAKE_BACK_WITHOUT_TIME:return void(n.currentPart=o);case mre.DUPLICATE:return;case mre.END_GAME_WITHOUT_TIME:return void(n.currentPart=o);case mre.END_GAME:return n.applyEndGame();case mre.MOVE_WITHOUT_TIME:return void(n.currentPart=o);case mre.MOVE:return n.msToSubstract=n.getLastUpdateTime(o,r,i),n.doNewMoves(r);case mre.PRE_START_DOC:const e=null==n.currentPart||null!=n.currentPart.data.beginning;return void nq(null==o||null==o.data.beginning||e,"old part had no beginning time or new part has, we did not expect this!");default:return nq(i===mre.STARTING_DOC,"Unexpected update type "+i),n.setChronos(),n.setPlayersDatas(r),n.startCountDownFor(cK.ZERO)}})()}getUpdateType(t){const n=Qte.from(null!=this.currentPart?this.currentPart.data:null,t.data);Tw(e.VERBOSE,{diff:n});const r=n.countChanges();if(0===r)return mre.DUPLICATE;if(t.data.request){const e=null!=n.removed.lastUpdateTime;return"TakeBackAccepted"===t.data.request.code&&e?mre.ACCEPT_TAKE_BACK_WITHOUT_TIME:mre.REQUEST}if(this.isMove(n,r))return 1===t.data.turn?null==t.data.lastUpdateTime?mre.MOVE_WITHOUT_TIME:mre.MOVE:null==n.modified.lastUpdateTime?mre.MOVE_WITHOUT_TIME:mre.MOVE;if(null==t.data.beginning)return mre.PRE_START_DOC;if(t.data.result!==rq.UNACHIEVED.value){const e=null==n.modified.lastUpdateTime;return null!=n.modified.turn&&e?mre.END_GAME_WITHOUT_TIME:mre.END_GAME}return nq(null!=t.data.beginning&&0===t.data.listMoves.length,"Unexpected update: "+JSON.stringify(n)),mre.STARTING_DOC}isMove(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){const n=3;return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+n}return!1}getLastUpdateTime(e,t,n){const r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);nq(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),nq(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");const s=cK.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(Ow.getNonNullable(r),Ow.getNonNullable(i),n,s)}getMoreRecentTime(e){return e.data.lastUpdateTime??e.data.beginning}getTimeUsedForLastTurn(e,t,n,r){const i=Xte(e,t),s=[0,0];return s[r.value]=i,s}setChronos(){Tw(e.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}didUserPlay(e){return this.hasUserPlayed[e.value]}doNewMoves(e){this.switchPlayer();const t=fK.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;for(;n.node.gameState.turn<t.length;){const e=n.node.gameState.turn,r=this.gameComponent.encoder.decode(t[e]),i=n.isLegal(r,n.node.gameState),s="We received an incorrect db move: "+r.toString()+" in "+t+" at turn "+e+'because "'+i.getReasonOr("")+'"';nq(i.isSuccess(),s),n.choose(r)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}switchPlayer(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");const t=cK.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();const n=t.getOpponent();this.didUserPlay(n)&&this.pauseCountDownsFor(n),this.didUserPlay(t)?(Tw(e.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(t)):this.startCountDownFor(t)}resetChronoFor(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}applyEndGame(){const t=this.currentPart,n=cK.fromTurn(t.data.turn);this.endGame=!0,[rq.VICTORY,rq.HARD_DRAW].some(e=>e.value===t.data.result)?this.doNewMoves(this.currentPart):(nq(!0===[rq.RESIGN,rq.TIMEOUT,rq.HARD_DRAW,rq.AGREED_DRAW_BY_ZERO,rq.AGREED_DRAW_BY_ONE].some(e=>e.value===t.data.result),"Unknown type of end game ("+t.data.result+")"),Tw(e.VERBOSE,"endGame est true et winner est "+t.getWinner())),this.stopCountdownsFor(n)}notifyDraw(e,t){this.endGame=!0;const n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}notifyTimeoutVictory(e,t,n,r){var i=this;return Pw(function*(){i.endGame=!0;const s=i.currentPart.setWinnerAndLoser(e,r);i.currentPart=s,yield i.gameService.notifyTimeout(i.currentPartId,t,n,e,r)})()}notifyVictory(t,n){Tw(e.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");const r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===zJ.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(nq(r===zJ.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;const i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,t,[0,0],n,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}canAskTakeBack(){return nq(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===uK.NONE}isOpponentWaitingForTakeBackResponse(){const e=this.getTakeBackRequester();return!!e.isPlayer()&&this.isOpponent(e)}getTakeBackRequester(){if(null==this.currentPart)return uK.NONE;const e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?hK.getPlayer(e):uK.NONE}canProposeDraw(){return nq(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&hK.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===uK.NONE}isOpponentWaitingForDrawResponse(){const e=this.getDrawRequester();return e!==uK.NONE&&this.isOpponent(e)}getDrawRequester(){if(null==this.currentPart)return uK.NONE;const e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?hK.getPlayer(e):uK.NONE}onRequest(t,n){var r=this;return Pw(function*(){switch(Tw(e.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:t,oldPart:n}),t.code){case"TakeBackAsked":case"TakeBackRefused":break;case"TakeBackAccepted":r.takeBackTo(r.currentPart.data.turn);break;case"RematchProposed":r.rematchProposed=!0;const n=hK.getPlayer(t).getOpponent();r.isPlayer(n)&&(Tw(e.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0);break;case"RematchAccepted":yield r.router.navigate(["/nextGameLoading"]),yield r.router.navigate(["/play",hK.getTypeGame(t),hK.getPartId(t)]);break;case"DrawProposed":case"DrawRefused":break;case"AddTurnTime":const i=3e4,s=cK.of(t.data.player);r.addTurnTimeTo(s,i);break;case"AddGlobalTime":const o=3e5,a=cK.of(t.data.player);r.addGlobalTimeTo(a,o);break;default:Ow.expectToBe(t.code,"DrawAccepted","Unknown RequestType : "+t.code+" for "+JSON.stringify(t)),yield r.acceptDraw()}})()}takeBackTo(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();const t=cK.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}setPlayersDatas(t){Tw(e.VERBOSE,{OnlineGameWrapper_setPlayersDatas:t}),this.players=[Mw.of(t.data.playerZero),Mw.ofNullable(t.data.playerOne)],nq(null!=t.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[t.data.turn%2].get();let n=Mw.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=cK.ZERO.value,n=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=cK.ONE.value,n=this.players[0]):this.observerRole=uK.NONE.value,n.isPresent()){const e=e=>{this.opponent=e[0].data},t=new cq(e,e,e=>{throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))});this.opponentSubscription=Mw.of(this.userService.observeUserByUsername(n.get(),t))}}onLegalUserMove(t,n){var r=this;return Pw(function*(){if(Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),!r.isOpponentWaitingForTakeBackResponse())return r.updateDBBoard(t,r.msToSubstract,n);r.gameComponent.message("You must answer to take back request")})()}updateDBBoard(t,n,r){var i=this;return Pw(function*(){const s=i.gameComponent.encoder.encodeMove(t);Tw(e.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+t.toString()+", "+r+")"),i.gameComponent.rules.choose(t);const o=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node);if(o.isEndGame)return o===zJ.DRAW?i.notifyDraw(s,r):i.notifyVictory(s,r);{const e=i.getPlayer();return i.gameService.updateDBBoard(i.currentPartId,e,s,n,r)}})()}resign(){var e=this;return Pw(function*(){const t=e.getLastIndex(),n=e.getPlayer(),r=e.players[e.observerRole%2].get(),i=e.players[(e.observerRole+1)%2].get();yield e.gameService.resign(e.currentPartId,t,n,i,r)})()}getLastIndex(){return this.currentPart.data.lastUpdate.index}reachedOutOfTime(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+t+")");const r=n.getLastIndex(),i=n.getPlayer();n.stopCountdownsFor(cK.of(t));const s=Ow.getNonNullable(n.opponent);if(t===n.observerRole){const e=Ow.getNonNullable(s.username);yield n.notifyTimeoutVictory(e,i,r,n.getPlayerName())}else if(nq(!1===n.endGame,"time might be better handled in the future"),n.opponentIsOffline()){const e=Ow.getNonNullable(s.username);yield n.notifyTimeoutVictory(n.getPlayerName(),i,t,e),n.endGame=!0}})()}acceptRematch(){var e=this;return Pw(function*(){nq(e.isPlaying(),"Non playing should not call acceptRematch");const t=new iq(e.currentPartId,e.currentPart.data);return yield e.gameService.acceptRematch(t,e.getLastIndex(),e.getPlayer()),!0})()}proposeRematch(){var e=this;return Pw(function*(){return nq(e.isPlaying(),"Non playing should not call proposeRematch"),yield e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer()),!0})()}proposeDraw(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptDraw(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}refuseDraw(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}askTakeBack(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptTakeBack(){var e=this;return Pw(function*(){const t=e.getPlayer();yield e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,t,e.msToSubstract),e.msToSubstract=[0,0]})()}refuseTakeBack(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}startCountDownFor(t){Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[t.value]=!0,t===cK.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}resumeCountDownFor(t,n=!0){let r;Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===cK.ZERO?(this.chronoZeroGlobal.changeDuration(Ow.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),r=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(Ow.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),r=this.chronoOneTurn),n?(r.setDuration(1e3*this.joiner.maximalMoveDuration),r.start()):r.resume()}pauseCountDownsFor(t,n=!0){let r;Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+t.value+") (turn "+this.currentPart.data.turn+")"),t===cK.ZERO?(this.chronoZeroGlobal.pause(),r=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),r=this.chronoOneTurn),n?r.stop():r.pause()}stopCountdownsFor(t){Tw(e.VERBOSE,"cdc::stopCountDownsFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===cK.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}getPlayerNameClass(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}opponentIsOffline(){return!1}canResign(){return nq(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}addGlobalTime(){const e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}addTurnTime(){const e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}addTurnTimeTo(e,t){const n=cK.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===cK.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}addGlobalTimeTo(e,t){e===cK.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}ngOnDestroy(){this.routerEventsSub.unsubscribe(),this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(Wy),ua(f_),ua(eq),ua(tK),ua(dq),ua(yK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){if(1&e&&(ju(bne,5),ju(Pne,5),ju(One,5),ju(Tne,5),ju(Ine,5),ju(kne,5)),2&e){let e;Wu(e=Zu())&&(t.partCreation=e.first),Wu(e=Zu())&&(t.chatComponent=e.first),Wu(e=Zu())&&(t.chronoZeroGlobal=e.first),Wu(e=Zu())&&(t.chronoOneGlobal=e.first),Wu(e=Zu())&&(t.chronoZeroTurn=e.first),Wu(e=Zu())&&(t.chronoOneTurn=e.first)}},features:[Go],decls:5,vars:4,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,S,b,P,O,T,I;return e=$localize`vs.`,t=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,n=$localize`It is your turn.`,r=$localize`It is ${"\ufffd0\ufffd"}:INTERPOLATION:'s turn.`,i=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Resign`,a=$localize`Propose a draw`,l=$localize`Accept draw`,c=$localize`Reject draw`,u=$localize`Pass a turn`,h=$localize`Accept take back`,d=$localize`Reject take back`,p=$localize`Ask to take back one move`,f=$localize`Draw`,g=$localize`You agreed to draw.`,m=$localize`Your draw proposal has been accepted.`,y=$localize`Players agreed to draw.`,v=$localize`You won.`,_=$localize`You lost.`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won.`,E=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit. You won.`,w=$localize`You reached your time limit.`,S=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit.`,b=$localize`You resigned.`,P=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has resigned.`,O=$localize`Go back to the game list`,T=$localize`Propose to play again`,I=$localize`Accept to play again`,[["id","partCreation",3,"partId","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],e,["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],t,["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],n,r,["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],i,["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],s,["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],o,["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],a,["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],l,["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],c,["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],u,["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],h,["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],d,["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],p,["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],f,["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],g,["id","yourOpponentAgreedToDrawIndicator",1,"title"],m,["id","playersAgreedToDraw",1,"title"],y,["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],v,[1,"title"],_,C,E,w,S,["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],b,P,["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],O,["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],T,["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],I]},template:function(e,t){1&e&&(la(0,Ane,2,1,"app-part-creation",0),la(1,fre,29,27,"div",1),pa(2,"div",2),pa(3,"div",3),ga(4,"app-chat",4),fa(),fa()),2&e&&(ha("ngIf",!1===t.gameStarted),Ts(1),ha("ngIf",t.gameStarted),Ts(3),ha("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[rp,Lte,Ene,Sne,Xd,Zte,m_],encapsulation:2}),e})();function vre(e,t){if(1&e&&(pa(0,"option",25),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Ja(e.name)}}function _re(e,t){if(1&e&&(pa(0,"option",25),sc(1,29),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),oc(e),ac(1)}}const Cre=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function Ere(e,t){if(1&e){const e=va();pa(0,"select",26),Ea("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[0]=t})("change",function(){return Gt(e),ba(2).updatePlayer(0)}),pa(1,"option",27),sc(2,28),fa(),la(3,_re,2,2,"option",16),fa()}2&e&&(ha("ngModel",ba(2).aiDepths[0]),Ts(3),ha("ngForOf",wu(2,Cre)))}function wre(e,t){if(1&e&&(pa(0,"p",30),sc(1,31),fa()),2&e){const e=ba(2);Ts(1),oc(e.gameComponent.scores.get()[0]),ac(1)}}function Sre(e,t){if(1&e&&(pa(0,"option",25),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Ja(e.name)}}function bre(e,t){if(1&e&&(pa(0,"option",25),sc(1,34),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),oc(e),ac(1)}}function Pre(e,t){if(1&e){const e=va();pa(0,"select",32),Ea("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[1]=t})("change",function(){return Gt(e),ba(2).updatePlayer(1)}),pa(1,"option",27),sc(2,33),fa(),la(3,bre,2,2,"option",16),fa()}2&e&&(ha("ngModel",ba(2).aiDepths[1]),Ts(3),ha("ngForOf",wu(2,Cre)))}function Ore(e,t){if(1&e&&(pa(0,"p",35),sc(1,36),fa()),2&e){const e=ba(2);Ts(1),oc(e.gameComponent.scores.get()[1]),ac(1)}}function Tre(e,t){if(1&e&&(pa(0,"h4"),sc(1,40),fa()),2&e){const e=ba(3);Ts(1),oc(e.winner.get()),ac(1)}}function Ire(e,t){1&e&&(pa(0,"h4",41),sc(1,42),fa())}function kre(e,t){if(1&e&&(pa(0,"div",37),la(1,Tre,2,1,"h4",38),la(2,Ire,2,0,"h4",39),fa()),2&e){const e=ba(2);Ts(1),ha("ngIf",e.winner.isPresent()),Ts(1),ha("ngIf",e.winner.isAbsent())}}function Are(e,t){if(1&e){const e=va();pa(0,"div",6),pa(1,"div",7),pa(2,"p",8),sc(3,9),fa(),fa(),pa(4,"div",10),pa(5,"div",11),pa(6,"div",12),pa(7,"select",13),Ea("change",function(){return Gt(e),ba().updatePlayer(0)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[0]=t}),pa(8,"option",14),sc(9,15),fa(),la(10,vre,2,2,"option",16),fa(),fa(),pa(11,"div",12),la(12,Ere,4,3,"select",17),fa(),la(13,wre,2,1,"p",18),fa(),pa(14,"div",19),pa(15,"div",12),pa(16,"select",20),Ea("change",function(){return Gt(e),ba().updatePlayer(1)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[1]=t}),pa(17,"option",14),sc(18,21),fa(),la(19,Sre,2,2,"option",16),fa(),fa(),pa(20,"div",12),la(21,Pre,4,3,"select",22),fa(),la(22,Ore,2,1,"p",23),fa(),fa(),la(23,kre,3,2,"div",24),fa()}if(2&e){const e=ba();Ts(3),oc(e.gameComponent.rules.node.gameState.turn+1),ac(3),Ts(4),ha("ngModel",e.playerSelection[0]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[0].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(3),ha("ngModel",e.playerSelection[1]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[1].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(1),ha("ngIf",e.endGame)}}function Mre(e,t){if(1&e&&(ma(0),Qa(1),ga(2,"br"),ya()),2&e){const e=t.$implicit,n=ba(3);Ts(1),Xa(" ",e.name+": "+e.getBoardValue(n.gameComponent.rules.node)," ")}}function Nre(e,t){if(1&e&&(ma(0),la(1,Mre,3,1,"ng-container",48),Qa(2),ga(3,"br"),Qa(4),ga(5,"br"),ya()),2&e){const e=ba(2);Ts(1),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(1),Xa(" Created ",e.getCreatedNodes()," nodes."),Ts(2),Xa(" Minimax time: ",e.getMinimaxTime(),"ms.")}}function Rre(e,t){if(1&e){const e=va();pa(0,"button",49),Ea("click",function(){return Gt(e),ba(2).gameComponent.pass()}),sc(1,50),fa()}}function xre(e,t){if(1&e){const e=va();pa(0,"button",51),Ea("click",function(){return Gt(e),ba(2).takeBack()}),sc(1,52),fa()}}function Dre(e,t){if(1&e){const e=va();pa(0,"div",43),la(1,Nre,6,3,"ng-container",38),la(2,Rre,2,0,"button",44),la(3,xre,2,0,"button",45),pa(4,"button",46),Ea("click",function(){return Gt(e),ba().restartGame()}),sc(5,47),fa(),fa()}if(2&e){const e=ba();Ts(1),ha("ngIf",e.gameComponent.rules.node.move),Ts(1),ha("ngIf",!1===e.endGame&&e.gameComponent.canPass),Ts(1),ha("ngIf",e.canTakeBack())}}let Lre=(()=>{class e extends Kte{constructor(t,n,r,i,s,o){super(t,n,r,i,s),this.cdr=o,this.aiDepths=["0","0"],this.playerSelection=["human","human"],this.winner=Mw.empty(),this.botTimeOut=1e3,this.players=[Mw.of(this.playerSelection[0]),Mw.of(this.playerSelection[1])],Tw(e.VERBOSE,"LocalGameWrapper.constructor")}getCreatedNodes(){return VJ.createdNodes}getMinimaxTime(){return VJ.minimaxTime}ngAfterViewInit(){var e=this;setTimeout(Pw(function*(){(yield e.afterGameIncluderViewInit())&&(e.restartGame(),e.cdr.detectChanges())}),1)}updatePlayer(e){this.players[e]=Mw.of(this.playerSelection[e]),this.proposeAIToPlay()}onLegalUserMove(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),n.gameComponent.rules.choose(t),n.updateBoard(),n.proposeAIToPlay()})()}updateBoard(){this.gameComponent.updateBoard();const e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner.isPlayer()&&(this.winner=Mw.of($localize`Player ${e.winner.value+1}`)))}proposeAIToPlay(){var e=this;const t=this.getPlayingAI();t.isPresent()&&window.setTimeout(Pw(function*(){yield e.doAIMove(t.get())}),this.botTimeOut)}getPlayingAI(){if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return Mw.empty();const e=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[e]?Mw.empty():Mw.ofNullable(this.gameComponent.availableMinimaxes.find(t=>this.players[e].equalsValue(t.name)))}doAIMove(e){var t=this;return Pw(function*(){const n=t.gameComponent.rules;nq(n.getGameStatus(n.node)===zJ.ONGOING,"IA should not try to play when game is over!");const r=Number.parseInt(t.aiDepths[n.node.gameState.turn%2%2]),i=n.node.findBestMove(r,e,!0);return n.choose(i)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),QG.SUCCESS):(t.messageDisplayer.criticalMessage($localize`The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!`),tq.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:i.toString()}))})()}canTakeBack(){return this.gameComponent.rules.node.gameState.turn>0}takeBack(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}isAITurn(){return this.getPlayingAI().isPresent()}restartGame(){const e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new $J(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=Mw.empty(),this.proposeAIToPlay()}getPlayerName(){return"human"}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(Wy),ua(tK),ua(f_),ua(eq),ua(Yc))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-wrapper"]],features:[Go],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,t=$localize`Human`,n=$localize`Human`,r=$localize`Pick the level`,i=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Pick the level`,a=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,l=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,c=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won`,u=$localize`Draw`,h=$localize`Start a new game`,d=$localize`Pass a turn`,p=$localize`Take back move`,[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],e,["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],t,[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],n,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],r,i,["id","scoreOne",1,"block"],s,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],o,a,["id","scoreZero",1,"block"],l,["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],c,["id","draw"],u,[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],h,[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],d,["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],p]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),la(2,Are,24,10,"div",2),la(3,Dre,6,3,"div",3),fa(),pa(4,"div",4),pa(5,"div",5),ga(6,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(2),ha("ngIf",t.gameComponent),Ts(1),ha("ngIf",t.gameComponent),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[rp,Xd,Zte,bg,xf,dg,Pg,kg,tp],encapsulation:2,changeDetection:0}),e})(),Fre=(()=>{class e{}return e.STEP_FINISHED=()=>$localize`Step finished!`,e.INFORMATIONAL_STEP=()=>$localize`This step is not expecting any move from your part.`,e})();function Ure(e,t){if(1&e&&(pa(0,"div",20),pa(1,"div",21),sc(2,22),fa(),pa(3,"div",23),Qa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ja(e.currentReason.get())}}function Bre(e,t){if(1&e){const e=va();pa(0,"button",24),Ea("click",function(){return Gt(e),ba().retry()}),sc(1,25),fa()}}function Vre(e,t){1&e&&(ma(0),sc(1,30),ya())}function $re(e,t){1&e&&(ma(0),sc(1,31),ya())}function zre(e,t){if(1&e&&la(0,$re,2,0,"ng-container",27),2&e){ba();const e=ca(5),t=ba();ha("ngIf",t.stepFinished&&t.stepFinished[t.stepIndex])("ngIfElse",e)}}function Hre(e,t){1&e&&(ma(0),sc(1,32),ya())}function Gre(e,t){if(1&e){const e=va();pa(0,"button",26),Ea("click",function(){return Gt(e),ba().next()}),la(1,Vre,2,0,"ng-container",27),la(2,zre,1,2,"ng-template",null,28,Ku),la(4,Hre,2,0,"ng-template",null,29,Ku),fa()}if(2&e){const e=ca(3),t=ba();Ts(1),ha("ngIf",t.steps[t.stepIndex]&&t.steps[t.stepIndex].isInformation())("ngIfElse",e)}}function qre(e,t){if(1&e){const e=va();pa(0,"button",33),Ea("click",function(){return Gt(e),ba().start()}),sc(1,34),fa()}}function Wre(e,t){if(1&e){const e=va();pa(0,"button",35),Ea("click",function(){return Gt(e),ba().playLocally()}),sc(1,36),fa()}}function jre(e,t){if(1&e){const e=va();pa(0,"button",37),Ea("click",function(){return Gt(e),ba().createGame()}),sc(1,38),fa()}}function Zre(e,t){if(1&e){const e=va();pa(0,"button",39),Ea("click",function(){return Gt(e),ba().showSolution()}),sc(1,40),fa()}}function Yre(e,t){if(1&e&&(ma(0),pa(1,"option",42),Qa(2),fa(),ya()),2&e){const e=ba(),t=e.index,n=e.$implicit;Ts(1),Ta("id","step_",t,""),ha("value",t),Ts(1),Ja(n.title)}}function Kre(e,t){1&e&&(ma(0),Qa(1,"v "),ya())}function Qre(e,t){1&e&&Qa(0,"x ")}function Jre(e,t){if(1&e&&(pa(0,"option",43),la(1,Kre,2,0,"ng-container",27),la(2,Qre,1,0,"ng-template",null,44,Ku),pa(4,"span",45),Qa(5),fa(),fa()),2&e){const e=ca(3),t=ba(),n=t.index,r=t.$implicit,i=ba();ha("value",n),Ts(1),ha("ngIf",i.stepFinished[n])("ngIfElse",e),Ts(3),Ta("id","step_",n,""),Ts(1),Ja(r.title)}}function Xre(e,t){if(1&e&&(ma(0),la(1,Yre,3,3,"ng-container",27),la(2,Jre,6,5,"ng-template",null,41,Ku),ya()),2&e){const e=t.index,n=ca(3),r=ba();Ts(1),ha("ngIf",e===r.stepIndex)("ngIfElse",n)}}let eie=(()=>{class e extends Kte{constructor(t,n,r,i,s,o){super(t,n,o,r,i),this.cdr=s,this.connectedUserService=o,this.COMPLETED_TUTORIAL_MESSAGE=$localize`Congratulations, you completed the tutorial.`,this.steps=[],this.successfulSteps=0,this.stepIndex=-1,this.currentMessage="",this.currentReason=Mw.empty(),this.moveAttemptMade=!1,this.stepFinished=[],this.tutorialOver=!1,Tw(e.VERBOSE,"TutorialGameWrapperComponent.constructor")}getNumberOfSteps(){return this.steps.length}getCurrentStepTitle(){return this.steps.length>0?this.steps[this.stepIndex].title:""}ngAfterViewInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),(yield t.afterGameIncluderViewInit())&&t.start()})()}start(){this.startTutorial(this.gameComponent.tutorial)}startTutorial(t){Tw(e.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:t}}),this.steps=t,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}getCompletionArray(){return this.steps.map(()=>!1)}changeStep(e){this.showStep(Number.parseInt(e.target.value,10))}showStep(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.showStep("+t+")"),this.moveAttemptMade=!1,this.stepFinished[t]=!1,this.updateSuccessCount(),this.stepIndex=t;const n=this.steps[this.stepIndex];this.currentMessage=n.instruction,this.currentReason=Mw.empty(),this.gameComponent.rules.node=new $J(n.state,Mw.empty(),n.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}onLegalUserMove(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:t}});const r=n.steps[n.stepIndex];if(nq(n.gameComponent.rules.choose(t),"It should be impossible to call onLegalUserMove with an illegal move"),Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),n.gameComponent.updateBoard(),n.moveAttemptMade=!0,r.isPredicate()){const e=n.gameComponent.rules.node.gameState,i=Ow.getNonNullable(r.predicate)(t,e);i.isSuccess()?n.showStepSuccess(r.getSuccessMessage()):n.currentReason=Mw.of(i.getReason())}else if(r.isAnyMove())Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(r.getSuccessMessage());else{nq(r.isMove(),"cannot reach here with a click step");const i=r;i.acceptedMoves.some(e=>e.equals(t))?(Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(i.getSuccessMessage())):(Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),n.currentReason=Mw.of(i.getFailureMessage()))}n.cdr.detectChanges()})()}retry(){Tw(e.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}onUserClick(t){if(Tw(e.VERBOSE,"tutorialGameWrapper.onUserClick("+t+")"),this.currentReason=Mw.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return QG.failure(Fre.STEP_FINISHED());const n=this.steps[this.stepIndex];return n.isClick()?(this.gameComponent.updateBoard(),this.moveAttemptMade=!0,Ow.getNonNullable(n.acceptedClicks).some(e=>e===t)?this.showStepSuccess(n.getSuccessMessage()):this.currentMessage=n.getFailureMessage(),QG.SUCCESS):n.isMove()||n.isPredicate()||n.isAnyMove()?(window.setTimeout(()=>{this.cdr.detectChanges()},10),QG.SUCCESS):QG.failure(Fre.INFORMATIONAL_STEP())}onCancelMove(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+t+")"),void 0!==t&&(this.currentReason=Mw.of(t)),this.cdr.detectChanges()}showStepSuccess(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=t,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}updateSuccessCount(){let e=0;for(const t of this.stepFinished)t&&e++;this.successfulSteps=e}next(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{let e=(this.stepIndex+1)%this.steps.length;for(;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}showSolution(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"tutorialGameWrapper.showSolution()");const n=t.steps[t.stepIndex];nq(n.hasSolution(),"step must have solution");const r=n,i=r.getSolution();i instanceof xJ?(t.showStep(t.stepIndex),t.gameComponent.rules.choose(i),t.gameComponent.updateBoard()):(t.showStep(t.stepIndex),window.document.querySelector(i).dispatchEvent(new Event("click"))),t.currentMessage=r.getSuccessMessage(),t.moveAttemptMade=!0,t.cdr.detectChanges()})()}playLocally(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/local",t])})()}createGame(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/play",t])})()}getPlayerName(){return""}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(Wy),ua(f_),ua(eq),ua(Yc),ua(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[Go],decls:22,vars:15,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Failure`,t=$localize`Try again`,n=$localize`Ok`,r=$localize`Continue`,i=$localize`Skip`,s=$localize`Try again`,o=$localize`Play locally`,a=$localize`Create an online game`,l=$localize`See solution`,[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],e,["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],t,["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],n,r,i,["id","restartButton",1,"button",3,"click"],s,["id","playLocallyButton",1,"button",3,"click"],o,["id","playOnlineButton",1,"button",3,"click"],a,["id","showSolutionButton",1,"button",3,"click"],l,["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),ga(3,"progress",3),pa(4,"div",4),pa(5,"p",5),Qa(6),fa(),ga(7,"p",6),fa(),la(8,Ure,5,1,"div",7),pa(9,"div",8),la(10,Bre,2,0,"button",9),la(11,Gre,6,2,"button",10),la(12,qre,2,0,"button",11),la(13,Wre,2,0,"button",12),la(14,jre,2,0,"button",13),la(15,Zre,2,0,"button",14),pa(16,"div",15),pa(17,"select",16),Ea("change",function(e){return t.changeStep(e)}),la(18,Xre,4,2,"ng-container",17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",18),pa(20,"div",19),ga(21,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(3),ra("value",t.successfulSteps)("max",t.getNumberOfSteps()),Ts(3),tl("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),Ts(1),ha("innerHTML",t.currentMessage,vi),Ts(1),ha("ngIf",t.currentReason.isPresent()),Ts(2),ha("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),Ts(1),ha("ngIf",!1===t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),Ts(3),ha("ngForOf",t.steps),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[rp,tp,Xd,Zte,Pg,kg],encapsulation:2,changeDetection:0}),e})();function tie(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),sc(2,37),fa(),pa(3,"div",38),Qa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ja(e.errorMessage)}}const nie=function(){return["/login"]};let rie=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.faEye=bK,this.registrationForm=new sg({email:new ig,username:new ig,password:new ig})}registerWithEmail(){var e=this;return Pw(function*(){const t=e.registrationForm.value.username,n=e.registrationForm.value.email,r=e.registrationForm.value.password;if(null==t||null==n||null==r)e.errorMessage=$localize`There are missing fields in the registration form, please check that you filled in all fields.`;else{const i=yield e.authService.doRegister(t,n,r);if(i.isSuccess()){const t=yield e.authService.sendEmailVerification();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()}else e.errorMessage=i.getReason()}})()}registerWithGoogle(){var e=this;return Pw(function*(){const t=yield e.authService.doGoogleLogin();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()})()}getPasswordHelpClass(){const e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}canRegister(){const e=this.registrationForm.value.password??"";return!(""===(this.registrationForm.value.email??"")||""===(this.registrationForm.value.username??"")||""===e||e.length<6)}}return e.\u0275fac=function(t){return new(t||e)(ua(tK),ua(f_))},e.\u0275cmp=Xe({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Registering`,t=$localize`Email`,n=$localize`Email`,r=$localize`A confirmation email will be sent to validate your account.`,i=$localize`Username`,s=$localize`Username`,o=$localize`Password`,a=$localize`Password`,l=$localize`The password should be at least 6 characters long`,c=$localize`Register`,u=$localize`Register with Google`,h=$localize`Have an account?`,d=$localize`Log in`,p=$localize`Registration error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",n,"type","email","autofocus","","required","",1,"input"],[1,"help"],r,["for","username",1,"label"],i,["id","username","formControlName","username","name","username","placeholder",s,"type","text","required","",1,"input"],["for","password",1,"label"],o,[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",a,"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],l,["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],c,[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],u,[1,"help","level-right"],h,[3,"routerLink"],d,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],p,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),sc(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),pa(12,"p",12),sc(13,13),fa(),fa(),fa(),fa(),fa(),pa(14,"div",4),pa(15,"div",5),pa(16,"label",14),sc(17,15),fa(),fa(),pa(18,"div",8),pa(19,"div",9),pa(20,"div",10),ga(21,"input",16),fa(),fa(),fa(),fa(),pa(22,"div",4),pa(23,"div",5),pa(24,"label",17),sc(25,18),fa(),fa(),pa(26,"div",8),pa(27,"div",9),pa(28,"div",19),ga(29,"input",20),pa(30,"span",21),ga(31,"fa-icon",22),fa(),pa(32,"p",23),sc(33,24),fa(),fa(),fa(),fa(),fa(),pa(34,"div",4),ga(35,"div",5),pa(36,"div",8),pa(37,"div",9),pa(38,"div",10),pa(39,"button",25),Ea("click",function(){return t.registerWithEmail()}),sc(40,26),fa(),fa(),fa(),fa(),fa(),pa(41,"div",4),ga(42,"div",5),pa(43,"div",27),la(44,tie,5,1,"div",28),fa(),fa(),pa(45,"div",4),ga(46,"div",5),pa(47,"div",8),pa(48,"button",29),Ea("click",function(){return t.registerWithGoogle()}),sc(49,30),fa(),fa(),fa(),pa(50,"p",31),ma(51),sc(52,32),ya(),Qa(53,"\xa0 "),pa(54,"a",33),sc(55,34),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.registrationForm),Ts(28),ha("icon",t.faEye),Ts(1),ha("ngClass",t.getPasswordHelpClass()),Ts(7),ha("disabled",!t.canRegister()),Ts(5),ha("ngIf",t.errorMessage),Ts(10),ha("routerLink",wu(6,nie)))},directives:[pg,Df,_g,rf,xf,Eg,_te,Mg,QQ,Cte,Xd,rp,y_],encapsulation:2}),e})(),iie=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}playLocally(){var e=this;return Pw(function*(){yield e.router.navigate(["local/"+e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Play offline`,[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.playLocally()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[fte],encapsulation:2}),e})(),sie=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}launchTutorial(){var e=this;return Pw(function*(){yield e.router.navigate(["/tutorial/",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Learn the rules`,[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.launchTutorial()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[fte],encapsulation:2}),e})(),oie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){let e;return e=$localize`The replay game is loading, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),sc(1,0),fa())},encapsulation:2}),e})();function aie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessQueenComponent.HEPTAGON)}}function lie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessQueenComponent.EIGHT_POINTED_STAR)}}function cie(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function uie(e,t){if(1&e&&(ma(0),Cn(),ga(1,"circle",6),ga(2,"circle",6),ga(3,"circle",6),ya()),2&e){const e=ba();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(3)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(2)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(1))}}function hie(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",7),ga(2,"circle",7),ga(3,"circle",7),fa()),2&e){const e=ba();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.45*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.45*e.MartianChessComponent.SPACE_SIZE)("cy",.55*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.55*e.MartianChessComponent.SPACE_SIZE)("cy",.55*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function die(e,t){if(1&e&&(Cn(),pa(0,"g",8),ga(1,"circle",9),ga(2,"circle",9),ga(3,"circle",9),fa()),2&e){const e=ba();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE-3*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE+3*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}class pie{constructor(){this.MartianChessQueenComponent=pie,this.MartianChessComponent=o6,this.horizontalDotsRadius=o6.SPACE_SIZE/15}}function fie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessDroneComponent.PENTAGON)}}function gie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessDroneComponent.FOUR_POINTED_STAR_VERTICAL)}}function mie(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function yie(e,t){if(1&e&&(ma(0),Cn(),ga(1,"circle",6),ga(2,"circle",6),ya()),2&e){const e=ba();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(2)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(1))}}function vie(e,t){if(1&e&&(Cn(),pa(0,"g",7),ga(1,"circle",8),ga(2,"circle",8),fa()),2&e){const e=ba();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.4*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.6*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function _ie(e,t){if(1&e&&(Cn(),pa(0,"g",7),ga(1,"circle",9),ga(2,"circle",9),fa()),2&e){const e=ba();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE-2*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE+2*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}pie.HEPTAGON=o6.getRegularPolygon(7),pie.EIGHT_POINTED_STAR=o6.getNPointedStar(8,0),pie.\u0275fac=function(e){return new(e||pie)},pie.\u0275cmp=Xe({type:pie,selectors:[["","app-martian-chess-queen",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-queen",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,aie,1,3,"polygon",0),la(1,lie,1,3,"polygon",0),la(2,cie,1,5,"circle",1),la(3,uie,4,9,"ng-container",2),la(4,hie,4,9,"g",2),la(5,die,4,10,"g",3)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class Cie{constructor(){this.MartianChessComponent=o6,this.MartianChessDroneComponent=Cie,this.horizontalDotsRadius=o6.SPACE_SIZE/15}}function Eie(e,t){if(1&e&&(Cn(),ga(0,"polygon",5)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessPawnComponent.TRIANGLE)}}function wie(e,t){if(1&e&&(Cn(),ga(0,"polygon",5)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessPawnComponent.FOUR_POINTED_STAR_DIAGONAL)}}function Sie(e,t){if(1&e&&(Cn(),ga(0,"circle",6)),2&e){const e=ba();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function bie(e,t){if(1&e&&(Cn(),ga(0,"circle",7)),2&e){const e=ba();ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE+e.getConcreteTriangleYOffset())("r",e.MartianChessComponent.getRadius(1))}}function Pie(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=ba();ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function Oie(e,t){if(1&e&&(Cn(),pa(0,"g",9),ga(1,"circle",10),fa()),2&e){const e=ba();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}Cie.FOUR_POINTED_STAR_VERTICAL=o6.getNPointedStar(4,0),Cie.PENTAGON=o6.getRegularPolygon(5),Cie.\u0275fac=function(e){return new(e||Cie)},Cie.\u0275cmp=Xe({type:Cie,selectors:[["","app-martian-chess-drone",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-drone",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[3,"ngClass"],[1,"base","mid-stroke"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,fie,1,3,"polygon",0),la(1,gie,1,3,"polygon",0),la(2,mie,1,5,"circle",1),la(3,yie,3,6,"ng-container",2),la(4,vie,3,7,"g",3),la(5,_ie,3,7,"g",3)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class Tie{constructor(){this.MartianChessComponent=o6,this.MartianChessPawnComponent=Tie,this.horizontalDotsRadius=o6.SPACE_SIZE/15}static getTriangle(){return o6.getRegularPolygon(3,Tie.TRIANGLE_Y_OFFSET)}static yOffsetForVerticalCentering(){const e=o6.getRegularPolygonCoords(3).map(e=>e.y);return(e.reduce((e,t)=>Math.min(e,t))+(100-e.reduce((e,t)=>Math.max(e,t))))/4}getConcreteTriangleYOffset(){return"Polygon"===this.style.shape?Tie.TRIANGLE_Y_OFFSET:0}}Tie.FOUR_POINTED_STAR_DIAGONAL=o6.getNPointedStar(4,45),Tie.TRIANGLE_Y_OFFSET=Tie.yOffsetForVerticalCentering(),Tie.TRIANGLE=Tie.getTriangle(),Tie.\u0275fac=function(e){return new(e||Tie)},Tie.\u0275cmp=Xe({type:Tie,selectors:[["","app-martian-chess-pawn",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-pawn",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base mid-stroke",4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,Eie,1,3,"polygon",0),la(1,wie,1,3,"polygon",0),la(2,Sie,1,5,"circle",1),la(3,bie,1,3,"circle",2),la(4,Pie,1,3,"circle",3),la(5,Oie,2,4,"g",4)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Xd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});const Iie={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1};let kie=(()=>{class e{constructor(e){this.authService=e}canActivate(){var e=this;return Pw(function*(){return new Promise(t=>{e.userSub=e.authService.getUserObs().subscribe(function(){var n=Pw(function*(n){yield e.evaluateUserPermission(n).then(t)});return function(e){return n.apply(this,arguments)}}())})})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(tK))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Aie=(()=>{class e extends kie{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(tK),Or(f_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Mie(e,t){1&e&&(pa(0,"p",20),sc(1,21),fa())}function Nie(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"p",8),sc(2,9),fa(),pa(3,"div",10),pa(4,"p",11),sc(5,12),fa(),pa(6,"button",13),Ea("click",function(){return Gt(e),ba().finalizeEmailVerification()}),sc(7,14),fa(),fa(),pa(8,"div",15),pa(9,"p",11),sc(10,16),fa(),pa(11,"button",17),Ea("click",function(){return Gt(e),ba().sendEmailVerification()}),sc(12,18),fa(),fa(),la(13,Mie,2,0,"p",19),fa()}if(2&e){const e=ba();Ts(2),oc(e.emailAddress),ac(2),Ts(11),ha("ngIf",e.success)}}function Rie(e,t){if(1&e){const e=va();pa(0,"div",24),pa(1,"div",8),sc(2,25),fa(),pa(3,"form",26),pa(4,"div",27),pa(5,"div",28),ga(6,"input",29),fa(),pa(7,"div",28),pa(8,"button",30),Ea("click",function(){Gt(e);const t=ba(2);return t.pickUsername(t.usernameForm.value)}),sc(9,31),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba(2);Ts(3),ha("formGroup",e.usernameForm)}}const xie=function(){return["/lobby"]};function Die(e,t){1&e&&(pa(0,"div",32),rc(1,33),ga(2,"a",34),ic(),fa()),2&e&&(Ts(2),ha("routerLink",wu(1,xie)))}function Lie(e,t){if(1&e&&(ma(0),la(1,Rie,10,1,"div",22),la(2,Die,3,2,"div",23),ya()),2&e){const e=ba();Ts(1),ha("ngIf",!e.success),Ts(1),ha("ngIf",e.success)}}function Fie(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),Qa(2),fa(),fa()),2&e){const e=ba();Ts(2),Ja(e.errorMessage)}}let Uie=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new sg({username:new ig})}ngOnInit(){var e=this;return Pw(function*(){e.userSub=e.authService.getUserObs().subscribe(function(){var t=Pw(function*(t){e.emailAddress=t.email.get(),t.username.isAbsent()?e.verificationType="enter-username":(e.verificationType="send-email",!0===e.triedToFinalize&&!1===t.verified&&(e.errorMessage=$localize`You have not verified your email! Click on the link in the verification email.`),!0===t.verified&&(yield e.router.navigate(["/lobby"])))});return function(e){return t.apply(this,arguments)}}())})()}pickUsername(e){var t=this;return Pw(function*(){const n=yield t.authService.setUsername(e.username);n.isSuccess()?t.success=!0:t.errorMessage=n.getReason()})()}sendEmailVerification(){var e=this;return Pw(function*(){const t=yield e.authService.sendEmailVerification();t.isSuccess()?e.success=!0:e.errorMessage=t.getReason()})()}finalizeEmailVerification(){var e=this;return Pw(function*(){e.triedToFinalize=!0,yield e.authService.reloadUser(),window.open(window.location.href,"_self")})()}ngOnDestroy(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua(tK),ua(f_))},e.\u0275cmp=Xe({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Account verification`,t=$localize`In order to finalize your account, you must click on the link that you should have received on your email address (${"\ufffd0\ufffd"}:INTERPOLATION:). The email could be in your spam folder.`,n=$localize`Once you have verified your email, click on the following button:`,r=$localize`Finalize email verification`,i=$localize`If you have not received the verification email, click on the following button:`,s=$localize`Send verification email again`,o=$localize`The email has been sent`,a=$localize`In order to finalize your account, you must choose a username.`,l=$localize`Username`,c=$localize`Pick username`,u=$localize`Your account has now been finalized, you can go back to the ${"\ufffd#2\ufffd"}:START_LINK:list of games${"\ufffd/#2\ufffd"}:CLOSE_LINK:.`,[[1,"box"],[1,"message","is-info"],[1,"message-header"],e,["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],t,[1,"block","level-left"],[1,"level-item"],n,["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],r,[1,"level-left"],i,["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],s,["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],o,["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],a,[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",l,"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],c,["id","success",1,"message-body"],u,[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),sc(3,3),fa(),la(4,Nie,14,2,"div",4),la(5,Lie,3,2,"ng-container",5),fa(),la(6,Fie,3,1,"div",6),fa()),2&e&&(Ts(4),ha("ngIf","send-email"===t.verificationType),Ts(1),ha("ngIf","enter-username"===t.verificationType),Ts(1),ha("ngIf",t.errorMessage))},directives:[rp,pg,Df,_g,rf,Mg,xf,Eg,y_],encapsulation:2}),e})(),Bie=(()=>{class e extends kie{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(tK),Or(f_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Vie=(()=>{class e extends kie{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(tK),Or(f_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function $ie(e,t){1&e&&(pa(0,"p",12),sc(1,13),fa())}function zie(e,t){if(1&e&&(pa(0,"div",14),pa(1,"div",15),sc(2,16),fa(),pa(3,"div",17),Qa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ja(e.errorMessage.get())}}const Hie=function(){return{standalone:!0}};let Gie=(()=>{class e{constructor(e){this.authService=e,this.success=!1,this.errorMessage=Mw.empty(),this.email=""}resetPassword(){var e=this;return Pw(function*(){nq(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=Mw.empty(),e.success=!1;const t=yield e.authService.sendPasswordResetEmail(e.email);t.isSuccess()?e.success=!0:e.errorMessage=Mw.of(t.getReason())})()}}return e.\u0275fac=function(t){return new(t||e)(ua(tK))},e.\u0275cmp=Xe({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){let e,t,n,r,i,s;return e=$localize`Password reset`,t=$localize`Email`,n=$localize`An email will be sent with instruction to reset your password.`,r=$localize`Reset password`,i=$localize`The email has been sent, please follow the instructions from that email.`,s=$localize`Error`,[[1,"box"],[1,"title"],e,[1,"field"],[1,"control"],["id","email","name","email","placeholder",t,"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],n,["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],r,["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],i,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],s,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"div",3),pa(4,"div",4),pa(5,"input",5),Ea("ngModelChange",function(e){return t.email=e}),fa(),pa(6,"p",6),sc(7,7),fa(),la(8,$ie,2,0,"p",8),fa(),fa(),pa(9,"button",9),Ea("click",function(){return t.resetPassword()}),sc(10,10),fa(),la(11,zie,5,1,"div",11),fa()),2&e&&(Ts(5),ha("ngModel",t.email)("ngModelOptions",wu(5,Hie)),Ts(3),ha("ngIf",t.success),Ts(1),ha("disabled",""===t.email),Ts(2),ha("ngIf",t.errorMessage.isPresent()))},directives:[rf,_te,Mg,xf,dg,rp],encapsulation:2}),e})();function qie(e,t){if(1&e&&(pa(0,"option",13),Qa(1),fa()),2&e){const e=t.$implicit,n=ba();ha("value",e.value)("selected",e.value===n.currentTheme),Ts(1),Xa(" ",e.name," ")}}function Wie(e,t){if(1&e&&(pa(0,"option",13),Qa(1),fa()),2&e){const e=t.$implicit,n=ba();ha("value",e.value)("selected",e.value===n.currentLanguage),Ts(1),Xa(" ",e.name," ")}}let jie=(()=>{class e{constructor(e,t){this.userSettingsService=e,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize`Light`},{value:"dark",name:$localize`Dark`}],this.currentTheme=t.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}changeLanguage(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}changeTheme(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}reload(){window.open(window.location.href,"_self")}}return e.\u0275fac=function(t){return new(t||e)(ua(_K),ua(CK))},e.\u0275cmp=Xe({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){let e,t,n;return e=$localize`User settings`,t=$localize`Theme`,n=$localize`Language`,[[1,"box"],[1,"title"],e,[1,"field"],["for","theme",1,"label"],t,[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],n,["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"div",3),pa(4,"label",4),sc(5,5),fa(),pa(6,"div",6),pa(7,"div",7),pa(8,"select",8),Ea("change",function(e){return t.changeTheme(e)}),la(9,qie,2,3,"option",9),fa(),fa(),fa(),fa(),pa(10,"div",3),pa(11,"label",10),sc(12,11),fa(),pa(13,"div",6),pa(14,"div",7),pa(15,"select",12),Ea("change",function(e){return t.changeLanguage(e)}),la(16,Wie,2,3,"option",9),fa(),fa(),fa(),fa(),fa()),2&e&&(Ts(9),ha("ngForOf",t.availableThemes),Ts(7),ha("ngForOf",t.availableLanguages))},directives:[tp,Pg,kg],encapsulation:2}),e})(),Zie=(()=>{class e{}return e.ALREADY_INGAME=()=>$localize`You are already in a game. Finish it or cancel it first.`,e})(),Yie=(()=>{class e{constructor(e,t,n,r,i,s){this.route=e,this.router=t,this.connectedUserService=n,this.messageDisplayer=r,this.partDAO=i,this.gameService=s}ngOnInit(){var e=this;return Pw(function*(){yield e.createGameAndRedirectOrShowError(e.extractGameFromURL())})()}extractGameFromURL(){return Ow.getNonNullable(this.route.snapshot.paramMap.get("compo"))}createGameAndRedirectOrShowError(e){var t=this;return Pw(function*(){const n=t.connectedUserService.user.get();nq(n.isConnected(),"User must be connected and have a username to reach this page");const r=n.toMinimalUser();if(!1===t.gameExists(e))return yield t.router.navigate(["/notFound",Yte.NO_MATCHING_GAME(e)],{skipLocationChange:!0}),!1;if(yield t.canCreateOnlineGame(r.name)){const n=yield t.gameService.createPartJoinerAndChat(r,e);return yield t.router.navigate(["/play",e,n]),!0}return t.messageDisplayer.infoMessage(Zie.ALREADY_INGAME()),yield t.router.navigate(["/lobby"]),!1})()}gameExists(e){return Mw.ofNullable(pte.ALL_GAMES().find(t=>t.urlName===e)).isPresent()}canCreateOnlineGame(e){var t=this;return Pw(function*(){return!1===(yield t.partDAO.userHasActivePart(e))})()}}return e.\u0275fac=function(t){return new(t||e)(ua(Wy),ua(f_),ua(tK),ua(eq),ua(sq),ua(yK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){let e;return e=$localize`Creating online game, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),sc(1,0),fa())},encapsulation:2}),e})();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[cl.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),sl[t]=e,n&&(sl[t][cl.ExtraData]=n)}(e,void 0,void 0)}(Sw());const Kie=[{path:"login",component:bte},{path:"lobby",component:qte,canActivate:[Aie]},{path:"settings",component:jie},{path:"register",component:rie,canActivate:[Vie]},{path:"reset-password",component:Gie,canActivate:[Vie]},{path:"notFound/:message",component:Wte},{path:"nextGameLoading",component:oie,canActivate:[Aie]},{path:"verify-account",component:Uie,canActivate:[Bie]},{path:"play",component:Ote,canActivate:[Aie]},{path:"play/:compo",component:Yie,canActivate:[Aie]},{path:"play/:compo/:id",component:yre,canActivate:[Aie]},{path:"local",component:iie},{path:"local/:compo",component:Lre},{path:"tutorial",component:sie},{path:"tutorial/:compo",component:eie},{path:"",component:vte},{path:"**",component:Wte}];class Qie{static app(){return function(e,...t){return{ngModule:HT,providers:[{provide:BT,useFactory:zT(e),multi:!0,deps:[vh,zo,AT,...t]}]}}(()=>(Iie.useEmulators&&(Iie.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),GT(Iie.firebaseConfig)))}static firestore(){return function(e,...t){return{ngModule:MG,providers:[{provide:TG,useFactory:IG(e),multi:!0,deps:[vh,zo,AT,UT,[new Nr,WM],[new Nr,SI],...t]}]}}(()=>{const e=BG(),t=e.toJSON().settings.host;return Iie.useEmulators&&"localhost:8080"!==t&&xG(e,"localhost",8080),e})}static database(){return function(e,...t){return{ngModule:WY,providers:[{provide:zY,useFactory:HY(e),multi:!0,deps:[vh,zo,AT,UT,[new Nr,WM],[new Nr,SI],...t]}]}}(()=>{const e=ZY();return Iie.useEmulators&&!1===e._instanceStarted&&jY(e,"localhost",9e3),e})}static auth(){return function(e,...t){return{ngModule:QM,providers:[{provide:jM,useFactory:ZM(e),multi:!0,deps:[vh,zo,AT,UT,[new Nr,SI],...t]}]}}(()=>{const e=eN();return Iie.useEmulators&&null==e.config.emulator&&JM(e,"http://localhost:9099",{disableWarnings:!0}),e})}}let Jie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e,bootstrap:[uJ]}),e.\u0275inj=be({providers:[tK,yK,mK,dq,lq,sq,CK,{provide:oh,useValue:vK.getLocale()}],imports:[[Qie.app(),Qie.firestore(),Qie.auth(),Qie.database(),Hp,Cm,k_.forRoot(Kie,{useHash:!1}),Lg,Dg,Ew,JQ]]}),e})();!function(e,t,n){const r=e.\u0275cmp;r.directiveDefs=()=>t.map(et),r.pipeDefs=()=>n.map(tt)}(o6,[tp,Xd,rp,Tie,Cie,pie],[]);"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self;"undefined"!=typeof global&&global;class Xie{constructor(e){this.digits=e}static zero(){return new Xie([0])}static one(){return new Xie([1])}clone(){return new Xie(this.digits.slice())}add(e){const t=this.clone();return t.addToSelf(e),t}addToSelf(e){const t=Math.max(this.digits.length,e.digits.length);let n=0;for(let r=0;r<t;r++){let t=n;r<this.digits.length&&(t+=this.digits[r]),r<e.digits.length&&(t+=e.digits[r]),t>=10?(this.digits[r]=t-10,n=1):(this.digits[r]=t,n=0)}n>0&&(this.digits[t]=1)}toString(){let e="";for(let t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}class ese{constructor(e){this.powerOfTwos=[e]}getValue(){return this.powerOfTwos[0]}multiplyBy(e){const t=Xie.zero();return this.multiplyByAndAddTo(e,t),t}multiplyByAndAddTo(e,t){for(let n=0;0!==e;e>>>=1,n++)if(1&e){const e=this.getMultipliedByPowerOfTwo(n);t.addToSelf(e)}}getMultipliedByPowerOfTwo(e){for(let t=this.powerOfTwos.length;t<=e;t++){const e=this.powerOfTwos[t-1];this.powerOfTwos[t]=e.add(e)}return this.powerOfTwos[e]}}class tse{constructor(e){this.base=e,this.exponents=[new ese(Xie.one())]}toThePowerOf(e){for(let t=this.exponents.length;t<=e;t++){const e=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new ese(e)}return this.exponents[e]}}function nse(e){const t=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){const t=e.charCodeAt(n+1);t>=56320&&t<=57343&&(n++,r=(r-55296<<10)+t-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e);let n=rse(t,0),r=rse(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function rse(e,t){let n,r=2654435769,i=2654435769;const s=e.length;for(n=0;n+12<=s;n+=12){r=ose(r,use(e,n,sse.Little)),i=ose(i,use(e,n+4,sse.Little));const s=ise(r,i,t=ose(t,use(e,n+8,sse.Little)));r=s[0],i=s[1],t=s[2]}return r=ose(r,use(e,n,sse.Little)),i=ose(i,use(e,n+4,sse.Little)),t=ose(t,s),ise(r,i,t=ose(t,use(e,n+8,sse.Little)<<8))[2]}function ise(e,t,n){return e=lse(e,t),e=lse(e,n),e^=n>>>13,t=lse(t,n),t=lse(t,e),t^=e<<8,n=lse(n,e),n=lse(n,t),n^=t>>>13,e=lse(e,t),e=lse(e,n),e^=n>>>12,t=lse(t,n),t=lse(t,e),t^=e<<16,n=lse(n,e),n=lse(n,t),n^=t>>>5,e=lse(e,t),e=lse(e,n),e^=n>>>3,t=lse(t,n),t=lse(t,e),t^=e<<10,n=lse(n,e),n=lse(n,t),[e,t,n^=t>>>15]}var sse=(()=>((sse=sse||{})[sse.Little=0]="Little",sse[sse.Big=1]="Big",sse))();function ose(e,t){return ase(e,t)[1]}function ase(e,t){const n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function lse(e,t){const n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function cse(e,t){return t>=e.length?0:e[t]}function use(e,t,n){let r=0;if(n===sse.Big)for(let i=0;i<4;i++)r+=cse(e,t+i)<<24-8*i;else for(let i=0;i<4;i++)r+=cse(e,t+i)<<8*i;return r}const hse=new tse(256);function dse(e,t,n,r,i=[]){const s={},o={},a=function(e,t){const{text:n,block:r}=pse(e,t);if(void 0===r)return{text:n};{const[e,...t]=r.split("\u241f"),[i,s]=e.split("@@",2);let[o,a]=i.split("|",2);return void 0===a&&(a=o,o=void 0),""===a&&(a=void 0),{text:n,meaning:o,description:a,customId:s,legacyIds:t}}}(e[0],e.raw[0]),l=[a.text],c=[];let u=a.text;for(let p=1;p<e.length;p++){const{text:n,block:r=fse(p)}=pse(e[p],e.raw[p]);u+=`{$${r}}${n}`,void 0!==t&&(s[r]=t[p-1],o[r]=i[p-1]),c.push(r),l.push(n)}const h=a.customId||function(e,t=""){let n=nse(e);if(t){const e=nse(t);n=function(e,t){const n=e[0],r=t[0],i=ase(e[1],t[1]),s=i[0],o=i[1];return[ose(ose(n,r),s),o]}(function(e,t){const n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),e)}return function(e,t){const n=hse.toThePowerOf(0).multiplyBy(t);return hse.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(u,a.meaning||""),d=a.legacyIds?a.legacyIds.filter(e=>e!==h):[];return{id:h,legacyIds:d,substitutions:s,substitutionLocations:o,text:u,customId:a.customId,meaning:a.meaning||"",description:a.description||"",messageParts:l,messagePartLocations:r,placeholderNames:c,location:n}}function pse(e,t){if(":"!==t.charAt(0))return{text:e};{const n=function(e,t){for(let n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}}function fse(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});class gse extends Error{constructor(e){super(`No translation found for ${yse(e)}.`),this.parsedMessage=e,this.type="MissingTranslationError"}}function mse(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function yse(e){const t=e.meaning&&` - "${e.meaning}"`,n=e.legacyIds&&e.legacyIds.length>0?` [${e.legacyIds.map(e=>`"${e}"`).join(", ")}]`:"";return`"${e.id}"${n} ("${e.text}"${t})`}function vse(e,t){try{return function(e,t,n){const r=dse(t,n);let i=e[r.id];if(void 0!==r.legacyIds)for(let s=0;s<r.legacyIds.length&&void 0===i;s++)i=e[r.legacyIds[s]];if(void 0===i)throw new gse(r);return[i.messageParts,i.placeholderNames.map(e=>{if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error(`There is a placeholder name mismatch with the translation provided for the message ${yse(r)}.\nThe translation contains a placeholder with name ${e}, which does not exist in the message.`)})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function _se(){Iie.production&&function(){if(Ah)throw new Error("Cannot enable prod mode after platform setup.");kh=!1}(),$p().bootstrapModule(Jie).catch(e=>console.error(e))}const Cse=vK.getLocale();"en"!==Cse?fetch(Iie.root+"assets/"+Cse+".json").then(e=>e.ok?e.json():{locale:"en",translations:{}}).then(e=>{(function(e){$localize.translate||($localize.translate=vse),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(t=>{$localize.TRANSLATIONS[t]=function(e){const t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[];for(let s=1;s<t.length-1;s+=2)r.push(t[s]),n.push(`${t[s+1]}`);const i=n.map(e=>":"===e.charAt(0)?"\\"+e:e);return{text:e,messageParts:mse(n,i),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,_se()}).catch(function(e){console.log(e)}):_se()}},function(e){e(e.s=4181)}]);